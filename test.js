/** @preserve Notice
 *
 * This file contains works from many authors under various (but compatible)
 * licenses.
 *
 */
!function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e){window.InboxSDK=e("./inboxsdk")},{"./inboxsdk":28}],2:[function(e,t){function n(e,t){return h.isUndefined(t)?""+t:!h.isNumber(t)||!isNaN(t)&&isFinite(t)?h.isFunction(t)||h.isRegExp(t)?t.toString():t:t.toString()}function i(e,t){return h.isString(e)?e.length<t?e:e.slice(0,t):e}function r(e){return i(JSON.stringify(e.actual,n),128)+" "+e.operator+" "+i(JSON.stringify(e.expected,n),128)}function a(e,t,n,i,r){throw new m.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:r})}function o(e,t){e||a(e,!0,t,"==",m.ok)}function s(e,t){if(e===t)return!0;if(h.isBuffer(e)&&h.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return h.isDate(e)&&h.isDate(t)?e.getTime()===t.getTime():h.isRegExp(e)&&h.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:h.isObject(e)||h.isObject(t)?u(e,t):e==t}function l(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function u(e,t){if(h.isNullOrUndefined(e)||h.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(l(e))return l(t)?(e=f.call(e),t=f.call(t),s(e,t)):!1;try{var n,i,r=_(e),a=_(t)}catch(o){return!1}if(r.length!=a.length)return!1;for(r.sort(),a.sort(),i=r.length-1;i>=0;i--)if(r[i]!=a[i])return!1;for(i=r.length-1;i>=0;i--)if(n=r[i],!s(e[n],t[n]))return!1;return!0}function c(e,t){return e&&t?"[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t?!0:t.call({},e)===!0?!0:!1:!1}function d(e,t,n,i){var r;h.isString(n)&&(i=n,n=null);try{t()}catch(o){r=o}if(i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:"."),e&&!r&&a(r,n,"Missing expected exception"+i),!e&&c(r,n)&&a(r,n,"Got unwanted exception"+i),e&&r&&n&&!c(r,n)||!e&&r)throw r}var h=e("util/"),f=Array.prototype.slice,p=Object.prototype.hasOwnProperty,m=t.exports=o;m.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=r(this),this.generatedMessage=!0);var t=e.stackStartFunction||a;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,o=t.name,s=i.indexOf("\n"+o);if(s>=0){var l=i.indexOf("\n",s+1);i=i.substring(l+1)}this.stack=i}}},h.inherits(m.AssertionError,Error),m.fail=a,m.ok=o,m.equal=function(e,t,n){e!=t&&a(e,t,n,"==",m.equal)},m.notEqual=function(e,t,n){e==t&&a(e,t,n,"!=",m.notEqual)},m.deepEqual=function(e,t,n){s(e,t)||a(e,t,n,"deepEqual",m.deepEqual)},m.notDeepEqual=function(e,t,n){s(e,t)&&a(e,t,n,"notDeepEqual",m.notDeepEqual)},m.strictEqual=function(e,t,n){e!==t&&a(e,t,n,"===",m.strictEqual)},m.notStrictEqual=function(e,t,n){e===t&&a(e,t,n,"!==",m.notStrictEqual)},m.throws=function(){d.apply(this,[!0].concat(f.call(arguments)))},m.doesNotThrow=function(){d.apply(this,[!1].concat(f.call(arguments)))},m.ifError=function(e){if(e)throw e};var _=Object.keys||function(e){var t=[];for(var n in e)p.call(e,n)&&t.push(n);return t}},{"util/":10}],3:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],o(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];n.apply(this,s)}else if(a(n)){for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];for(u=n.slice(),r=u.length,l=0;r>l;l++)u[l].apply(this,s)}return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var r;r=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-->0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],4:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],5:[function(e,t){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var i=[];if(t){var r=document.createElement("div"),a=new MutationObserver(function(){var e=i.slice();i.length=0,e.forEach(function(e){e()})});return a.observe(r,{attributes:!0}),function(e){i.length||r.setAttribute("yes","no"),i.push(e)}}return n?(window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(e){i.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(e,t){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,r,a){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;u>c;++c){var d,h,f,p,m=e[c].replace(s,"%20"),_=m.indexOf(r);_>=0?(d=m.substr(0,_),h=m.substr(_+1)):(d=m,h=""),f=decodeURIComponent(d),p=decodeURIComponent(h),n(o,f)?i(o[f])?o[f].push(p):o[f]=[o[f],p]:o[f]=p}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],7:[function(e,t){"use strict";function n(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,o,s){return t=t||"&",o=o||"=",null===e&&(e=void 0),"object"==typeof e?n(a(e),function(a){var s=encodeURIComponent(i(a))+o;return r(e[a])?n(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+o+encodeURIComponent(i(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],8:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":6,"./encode":7}],9:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],10:[function(e,t,n){(function(t,i){function r(e,t){var i={seen:[],stylize:o};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),m(t)?i.showHidden=t:t&&n._extend(i,t),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=a),l(i,e,i.depth)}function a(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function o(e){return e}function s(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function l(e,t,i){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return y(r)||(r=l(e,r,i)),r}var a=u(e,t);if(a)return a;var o=Object.keys(t),m=s(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),x(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return c(t);if(0===o.length){if(k(t)){var _=t.name?": "+t.name:"";return e.stylize("[Function"+_+"]","special")}if(C(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(T(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return c(t)}var g="",v=!1,w=["{","}"];if(p(t)&&(v=!0,w=["[","]"]),k(t)){var b=t.name?": "+t.name:"";g=" [Function"+b+"]"}if(C(t)&&(g=" "+RegExp.prototype.toString.call(t)),T(t)&&(g=" "+Date.prototype.toUTCString.call(t)),x(t)&&(g=" "+c(t)),0===o.length&&(!v||0==t.length))return w[0]+g+w[1];if(0>i)return C(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=v?d(e,t,i,m,o):o.map(function(n){return h(e,t,i,m,n,v)}),e.seen.pop(),f(S,g,w)}function u(e,t){if(b(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return v(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):_(t)?e.stylize("null","null"):void 0}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,i,r){for(var a=[],o=0,s=t.length;s>o;++o)a.push(D(t,String(o))?h(e,t,n,i,String(o),!0):"");return r.forEach(function(r){r.match(/^\d+$/)||a.push(h(e,t,n,i,r,!0))}),a}function h(e,t,n,i,r,a){var o,s,u;if(u=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},u.get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),D(i,r)||(o="["+r+"]"),s||(e.seen.indexOf(u.value)<0?(s=_(n)?l(e,u.value,null):l(e,u.value,n-1),s.indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),b(o)){if(a&&r.match(/^\d+$/))return s;o=JSON.stringify(""+r),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e,t,n){var i=0,r=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function _(e){return null===e}function g(e){return null==e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function b(e){return void 0===e}function C(e){return S(e)&&"[object RegExp]"===L(e)}function S(e){return"object"==typeof e&&null!==e}function T(e){return S(e)&&"[object Date]"===L(e)}function x(e){return S(e)&&("[object Error]"===L(e)||e instanceof Error)}function k(e){return"function"==typeof e}function M(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function L(e){return Object.prototype.toString.call(e)}function B(e){return 10>e?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,t=[B(e.getHours()),B(e.getMinutes()),B(e.getSeconds())].join(":");return[e.getDate(),A[e.getMonth()],t].join(" ")}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var V=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,a=i.length,o=String(e).replace(V,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}}),s=i[n];a>n;s=i[++n])o+=_(s)||!S(s)?" "+s:" "+r(s);return o},n.deprecate=function(e,r){function a(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}if(b(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(t.noDeprecation===!0)return e;var o=!1;return a};var I,P={};n.debuglog=function(e){if(b(I)&&(I=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!P[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){var i=t.pid;P[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else P[e]=function(){};return P[e]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=m,n.isNull=_,n.isNullOrUndefined=g,n.isNumber=v,n.isString=y,n.isSymbol=w,n.isUndefined=b,n.isRegExp=C,n.isObject=S,n.isDate=T,n.isError=x,n.isFunction=k,n.isPrimitive=M,n.isBuffer=e("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",E(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!S(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":9,_process:5,inherits:4}],11:[function(e,t,n){(function(e){(function(){function i(e,t,n){for(var i=(n||0)-1,r=e?e.length:0;++i<r;)if(e[i]===t)return i;return-1}function r(e,t){var n=typeof t;if(e=e.cache,"boolean"==n||null==t)return e[t]?0:-1;"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:w+t;return e=(e=e[n])&&e[r],"object"==n?e&&i(e,t)>-1?0:-1:e?0:-1}function a(e){var t=this.cache,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var i="number"==n?e:w+e,r=t[n]||(t[n]={});"object"==n?(r[i]||(r[i]=[])).push(e):r[i]=!0}}function o(e){return e.charCodeAt(0)}function s(e,t){for(var n=e.criteria,i=t.criteria,r=-1,a=n.length;++r<a;){var o=n[r],s=i[r];if(o!==s){if(o>s||"undefined"==typeof o)return 1;if(s>o||"undefined"==typeof s)return-1}}return e.index-t.index}function l(e){var t=-1,n=e.length,i=e[0],r=e[n/2|0],o=e[n-1];if(i&&"object"==typeof i&&r&&"object"==typeof r&&o&&"object"==typeof o)return!1;var s=d();s["false"]=s["null"]=s["true"]=s.undefined=!1;var l=d();for(l.array=e,l.cache=s,l.push=a;++t<n;)l.push(e[t]);return l}function u(e){return"\\"+J[e]}function c(){return g.pop()||[]}function d(){return v.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function h(e){e.length=0,g.length<C&&g.push(e)}function f(e){var t=e.cache;t&&f(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,v.length<C&&v.push(e)}function p(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var i=-1,r=n-t||0,a=Array(0>r?0:r);++i<r;)a[i]=e[t+i];return a}function m(e){function t(e){return e&&"object"==typeof e&&!Xi(e)&&Pi.call(e,"__wrapped__")?e:new n(e)}function n(e,t){this.__chain__=!!t,this.__wrapped__=e}function a(e){function t(){if(i){var e=p(i);Ai.apply(e,arguments)}if(this instanceof t){var a=v(n.prototype),o=n.apply(a,e||arguments);return Et(o)?o:a}return n.apply(r,e||arguments)}var n=e[0],i=e[2],r=e[4];return $i(t,e),t}function g(e,t,n,i,r){if(n){var a=n(e);if("undefined"!=typeof a)return a}var o=Et(e);if(!o)return e;var s=Mi.call(e);if(!z[s])return e;var l=Qi[s];switch(s){case N:case H:return new l(+e);case U:case K:return new l(e);case W:return a=l(e.source,L.exec(e)),a.lastIndex=e.lastIndex,a}var u=Xi(e);if(t){var d=!i;i||(i=c()),r||(r=c());for(var f=i.length;f--;)if(i[f]==e)return r[f];a=u?l(e.length):{}}else a=u?p(e):ar({},e);return u&&(Pi.call(e,"index")&&(a.index=e.index),Pi.call(e,"input")&&(a.input=e.input)),t?(i.push(e),r.push(a),(u?Jt:lr)(e,function(e,o){a[o]=g(e,t,n,i,r)}),d&&(h(i),h(r)),a):a}function v(e){return Et(e)?Hi(e):{}}function C(e,t,n){if("function"!=typeof e)return Xn;if("undefined"==typeof t||!("prototype"in e))return e;var i=e.__bindData__;if("undefined"==typeof i&&(Ji.funcNames&&(i=!e.name),i=i||!Ji.funcDecomp,!i)){var r=Vi.call(e);Ji.funcNames||(i=!B.test(r)),i||(i=I.test(r),$i(e,i))}if(i===!1||i!==!0&&1&i[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,a){return e.call(t,n,i,r,a)}}return An(e,t)}function J(e){function t(){var e=l?o:this;if(r){var f=p(r);Ai.apply(f,arguments)}if((a||c)&&(f||(f=p(arguments)),a&&Ai.apply(f,a),c&&f.length<s))return i|=16,J([n,d?i:-4&i,f,null,o,s]);if(f||(f=arguments),u&&(n=e[h]),this instanceof t){e=v(n.prototype);var m=n.apply(e,f);return Et(m)?m:e}return n.apply(e,f)}var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=1&i,u=2&i,c=4&i,d=8&i,h=n;return $i(t,e),t}function X(e,t){var n=-1,a=lt(),o=e?e.length:0,s=o>=b&&a===i,u=[];if(s){var c=l(t);c?(a=r,t=c):s=!1}for(;++n<o;){var d=e[n];a(t,d)<0&&u.push(d)}return s&&f(t),u}function Z(e,t,n,i){for(var r=(i||0)-1,a=e?e.length:0,o=[];++r<a;){var s=e[r];if(s&&"object"==typeof s&&"number"==typeof s.length&&(Xi(s)||ht(s))){t||(s=Z(s,t,n));var l=-1,u=s.length,c=o.length;for(o.length+=u;++l<u;)o[c++]=s[l]}else n||o.push(s)}return o}function et(e,t,n,i,r,a){if(n){var o=n(e,t);if("undefined"!=typeof o)return!!o}if(e===t)return 0!==e||1/e==1/t;var s=typeof e,l=typeof t;if(!(e!==e||e&&Q[s]||t&&Q[l]))return!1;if(null==e||null==t)return e===t;var u=Mi.call(e),d=Mi.call(t);if(u==O&&(u=G),d==O&&(d=G),u!=d)return!1;switch(u){case N:case H:return+e==+t;case U:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case W:case K:return e==Ci(t)}var f=u==R;if(!f){var p=Pi.call(e,"__wrapped__"),m=Pi.call(t,"__wrapped__");if(p||m)return et(p?e.__wrapped__:e,m?t.__wrapped__:t,n,i,r,a);if(u!=G)return!1;var _=e.constructor,g=t.constructor;if(_!=g&&!(Bt(_)&&_ instanceof _&&Bt(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t)return!1}var v=!r;r||(r=c()),a||(a=c());for(var y=r.length;y--;)if(r[y]==e)return a[y]==t;var w=0;if(o=!0,r.push(e),a.push(t),f){if(y=e.length,w=t.length,o=w==y,o||i)for(;w--;){var b=y,C=t[w];if(i)for(;b--&&!(o=et(e[b],C,n,i,r,a)););else if(!(o=et(e[w],C,n,i,r,a)))break}}else sr(t,function(t,s,l){return Pi.call(l,s)?(w++,o=Pi.call(e,s)&&et(e[s],t,n,i,r,a)):void 0}),o&&!i&&sr(e,function(e,t,n){return Pi.call(n,t)?o=--w>-1:void 0});return r.pop(),a.pop(),v&&(h(r),h(a)),o}function tt(e,t,n,i,r){(Xi(t)?Jt:lr)(t,function(t,a){var o,s,l=t,u=e[a];if(t&&((s=Xi(t))||ur(t))){for(var c=i.length;c--;)if(o=i[c]==t){u=r[c];break}if(!o){var d;n&&(l=n(u,t),(d="undefined"!=typeof l)&&(u=l)),d||(u=s?Xi(u)?u:[]:ur(u)?u:{}),i.push(t),r.push(u),d||tt(u,t,n,i,r)}}else n&&(l=n(u,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(u=l);e[a]=u})}function it(e,t){return e+Di(qi()*(t-e+1))}function rt(e,t,n){var a=-1,o=lt(),s=e?e.length:0,u=[],d=!t&&s>=b&&o===i,p=n||d?c():u;if(d){var m=l(p);o=r,p=m}for(;++a<s;){var _=e[a],g=n?n(_,a,e):_;(t?!a||p[p.length-1]!==g:o(p,g)<0)&&((n||d)&&p.push(g),u.push(_))}return d?(h(p.array),f(p)):n&&h(p),u}function at(e){return function(n,i,r){var a={};i=t.createCallback(i,r,3);var o=-1,s=n?n.length:0;if("number"==typeof s)for(;++o<s;){var l=n[o];e(a,l,i(l,o,n),n)}else lr(n,function(t,n,r){e(a,t,i(t,n,r),r)});return a}}function ot(e,t,n,i,r,o){var s=1&t,l=2&t,u=4&t,c=16&t,d=32&t;if(!l&&!Bt(e))throw new Si;c&&!n.length&&(t&=-17,c=n=!1),d&&!i.length&&(t&=-33,d=i=!1);var h=e&&e.__bindData__;if(h&&h!==!0)return h=p(h),h[2]&&(h[2]=p(h[2])),h[3]&&(h[3]=p(h[3])),!s||1&h[1]||(h[4]=r),!s&&1&h[1]&&(t|=8),!u||4&h[1]||(h[5]=o),c&&Ai.apply(h[2]||(h[2]=[]),n),d&&Ri.apply(h[3]||(h[3]=[]),i),h[1]|=t,ot.apply(null,h);var f=1==t||17===t?a:J;return f([e,t,n,i,r,o])}function st(e){return tr[e]}function lt(){var e=(e=t.indexOf)===vn?i:e;return e}function ut(e){return"function"==typeof e&&Li.test(e)}function ct(e){var t,n;return e&&Mi.call(e)==G&&(t=e.constructor,!Bt(t)||t instanceof t)?(sr(e,function(e,t){n=t}),"undefined"==typeof n||Pi.call(e,n)):!1}function dt(e){return nr[e]}function ht(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Mi.call(e)==O||!1}function ft(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1),g(e,t,"function"==typeof n&&C(n,i,1))}function pt(e,t,n){return g(e,!0,"function"==typeof t&&C(t,n,1))}function mt(e,t){var n=v(e);return t?ar(n,t):n}function _t(e,n,i){var r;return n=t.createCallback(n,i,3),lr(e,function(e,t,i){return n(e,t,i)?(r=t,!1):void 0}),r}function gt(e,n,i){var r;return n=t.createCallback(n,i,3),yt(e,function(e,t,i){return n(e,t,i)?(r=t,!1):void 0}),r}function vt(e,t,n){var i=[];sr(e,function(e,t){i.push(t,e)});var r=i.length;for(t=C(t,n,3);r--&&t(i[r--],i[r],e)!==!1;);return e}function yt(e,t,n){var i=er(e),r=i.length;for(t=C(t,n,3);r--;){var a=i[r];if(t(e[a],a,e)===!1)break}return e}function wt(e){var t=[];return sr(e,function(e,n){Bt(e)&&t.push(n)}),t.sort()}function bt(e,t){return e?Pi.call(e,t):!1}function Ct(e){for(var t=-1,n=er(e),i=n.length,r={};++t<i;){var a=n[t];r[e[a]]=a}return r}function St(e){return e===!0||e===!1||e&&"object"==typeof e&&Mi.call(e)==N||!1}function Tt(e){return e&&"object"==typeof e&&Mi.call(e)==H||!1}function xt(e){return e&&1===e.nodeType||!1}function kt(e){var t=!0;if(!e)return t;var n=Mi.call(e),i=e.length;return n==R||n==K||n==O||n==G&&"number"==typeof i&&Bt(e.splice)?!i:(lr(e,function(){return t=!1}),t)}function Mt(e,t,n,i){return et(e,t,"function"==typeof n&&C(n,i,2))}function Lt(e){return Ui(e)&&!Gi(parseFloat(e))}function Bt(e){return"function"==typeof e}function Et(e){return!(!e||!Q[typeof e])}function Dt(e){return It(e)&&e!=+e}function Vt(e){return null===e}function It(e){return"number"==typeof e||e&&"object"==typeof e&&Mi.call(e)==U||!1}function Pt(e){return e&&"object"==typeof e&&Mi.call(e)==W||!1}function At(e){return"string"==typeof e||e&&"object"==typeof e&&Mi.call(e)==K||!1}function Ft(e){return"undefined"==typeof e}function Ot(e,n,i){var r={};return n=t.createCallback(n,i,3),lr(e,function(e,t,i){r[t]=n(e,t,i)}),r}function Rt(e){var t=arguments,n=2;if(!Et(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var i=C(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(i=t[--n]);for(var r=p(arguments,1,n),a=-1,o=c(),s=c();++a<n;)tt(e,r[a],i,o,s);return h(o),h(s),e}function Nt(e,n,i){var r={};if("function"!=typeof n){var a=[];sr(e,function(e,t){a.push(t)}),a=X(a,Z(arguments,!0,!1,1));for(var o=-1,s=a.length;++o<s;){var l=a[o];r[l]=e[l]}}else n=t.createCallback(n,i,3),sr(e,function(e,t,i){n(e,t,i)||(r[t]=e)});return r}function Ht(e){for(var t=-1,n=er(e),i=n.length,r=pi(i);++t<i;){var a=n[t];r[t]=[a,e[a]]}return r}function jt(e,n,i){var r={};if("function"!=typeof n)for(var a=-1,o=Z(arguments,!0,!1,1),s=Et(e)?o.length:0;++a<s;){var l=o[a];l in e&&(r[l]=e[l])}else n=t.createCallback(n,i,3),sr(e,function(e,t,i){n(e,t,i)&&(r[t]=e)});return r}function Ut(e,n,i,r){var a=Xi(e);if(null==i)if(a)i=[];else{var o=e&&e.constructor,s=o&&o.prototype;i=v(s)}return n&&(n=t.createCallback(n,r,4),(a?Jt:lr)(e,function(e,t,r){return n(i,e,t,r)})),i}function Gt(e){for(var t=-1,n=er(e),i=n.length,r=pi(i);++t<i;)r[t]=e[n[t]];return r}function Wt(e){for(var t=arguments,n=-1,i=Z(t,!0,!1,1),r=t[2]&&t[2][t[1]]===e?1:i.length,a=pi(r);++n<r;)a[n]=e[i[n]];return a}function Kt(e,t,n){var i=-1,r=lt(),a=e?e.length:0,o=!1;return n=(0>n?Ki(0,a+n):n)||0,Xi(e)?o=r(e,t,n)>-1:"number"==typeof a?o=(At(e)?e.indexOf(t,n):r(e,t,n))>-1:lr(e,function(e){return++i>=n?!(o=e===t):void 0}),o}function zt(e,n,i){var r=!0;n=t.createCallback(n,i,3);var a=-1,o=e?e.length:0;if("number"==typeof o)for(;++a<o&&(r=!!n(e[a],a,e)););else lr(e,function(e,t,i){return r=!!n(e,t,i)});return r}function Yt(e,n,i){var r=[];n=t.createCallback(n,i,3);var a=-1,o=e?e.length:0;if("number"==typeof o)for(;++a<o;){var s=e[a];n(s,a,e)&&r.push(s)}else lr(e,function(e,t,i){n(e,t,i)&&r.push(e)});return r}function qt(e,n,i){n=t.createCallback(n,i,3);var r=-1,a=e?e.length:0;if("number"!=typeof a){var o;return lr(e,function(e,t,i){return n(e,t,i)?(o=e,!1):void 0}),o}for(;++r<a;){var s=e[r];if(n(s,r,e))return s}}function Qt(e,n,i){var r;return n=t.createCallback(n,i,3),$t(e,function(e,t,i){return n(e,t,i)?(r=e,!1):void 0}),r}function Jt(e,t,n){var i=-1,r=e?e.length:0;if(t=t&&"undefined"==typeof n?t:C(t,n,3),"number"==typeof r)for(;++i<r&&t(e[i],i,e)!==!1;);else lr(e,t);return e}function $t(e,t,n){var i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:C(t,n,3),"number"==typeof i)for(;i--&&t(e[i],i,e)!==!1;);else{var r=er(e);i=r.length,lr(e,function(e,n,a){return n=r?r[--i]:--i,t(a[n],n,a)})}return e}function Xt(e,t){var n=p(arguments,2),i=-1,r="function"==typeof t,a=e?e.length:0,o=pi("number"==typeof a?a:0);return Jt(e,function(e){o[++i]=(r?t:e[t]).apply(e,n)}),o}function Zt(e,n,i){var r=-1,a=e?e.length:0;if(n=t.createCallback(n,i,3),"number"==typeof a)for(var o=pi(a);++r<a;)o[r]=n(e[r],r,e);else o=[],lr(e,function(e,t,i){o[++r]=n(e,t,i)});return o}function en(e,n,i){var r=-1/0,a=r;if("function"!=typeof n&&i&&i[n]===e&&(n=null),null==n&&Xi(e))for(var s=-1,l=e.length;++s<l;){var u=e[s];u>a&&(a=u)}else n=null==n&&At(e)?o:t.createCallback(n,i,3),Jt(e,function(e,t,i){var o=n(e,t,i);o>r&&(r=o,a=e)});return a}function tn(e,n,i){var r=1/0,a=r;if("function"!=typeof n&&i&&i[n]===e&&(n=null),null==n&&Xi(e))for(var s=-1,l=e.length;++s<l;){var u=e[s];a>u&&(a=u)}else n=null==n&&At(e)?o:t.createCallback(n,i,3),Jt(e,function(e,t,i){var o=n(e,t,i);r>o&&(r=o,a=e)});return a}function nn(e,n,i,r){if(!e)return i;var a=arguments.length<3;n=t.createCallback(n,r,4);var o=-1,s=e.length;if("number"==typeof s)for(a&&(i=e[++o]);++o<s;)i=n(i,e[o],o,e);else lr(e,function(e,t,r){i=a?(a=!1,e):n(i,e,t,r)});return i}function rn(e,n,i,r){var a=arguments.length<3;return n=t.createCallback(n,r,4),$t(e,function(e,t,r){i=a?(a=!1,e):n(i,e,t,r)}),i}function an(e,n,i){return n=t.createCallback(n,i,3),Yt(e,function(e,t,i){return!n(e,t,i)})}function on(e,t,n){if(e&&"number"!=typeof e.length&&(e=Gt(e)),null==t||n)return e?e[it(0,e.length-1)]:_;var i=sn(e);return i.length=zi(Ki(0,t),i.length),i}function sn(e){var t=-1,n=e?e.length:0,i=pi("number"==typeof n?n:0);return Jt(e,function(e){var n=it(0,++t);i[t]=i[n],i[n]=e}),i}function ln(e){var t=e?e.length:0;return"number"==typeof t?t:er(e).length}function un(e,n,i){var r;n=t.createCallback(n,i,3);var a=-1,o=e?e.length:0;if("number"==typeof o)for(;++a<o&&!(r=n(e[a],a,e)););else lr(e,function(e,t,i){return!(r=n(e,t,i))});return!!r}function cn(e,n,i){var r=-1,a=Xi(n),o=e?e.length:0,l=pi("number"==typeof o?o:0);for(a||(n=t.createCallback(n,i,3)),Jt(e,function(e,t,i){var o=l[++r]=d();a?o.criteria=Zt(n,function(t){return e[t]}):(o.criteria=c())[0]=n(e,t,i),o.index=r,o.value=e}),o=l.length,l.sort(s);o--;){var u=l[o];l[o]=u.value,a||h(u.criteria),f(u)}return l}function dn(e){return e&&"number"==typeof e.length?p(e):Gt(e)}function hn(e){for(var t=-1,n=e?e.length:0,i=[];++t<n;){var r=e[t];r&&i.push(r)}return i}function fn(e){return X(e,Z(arguments,!0,!0,1))}function pn(e,n,i){var r=-1,a=e?e.length:0;for(n=t.createCallback(n,i,3);++r<a;)if(n(e[r],r,e))return r;return-1}function mn(e,n,i){var r=e?e.length:0;for(n=t.createCallback(n,i,3);r--;)if(n(e[r],r,e))return r;return-1}function _n(e,n,i){var r=0,a=e?e.length:0;if("number"!=typeof n&&null!=n){var o=-1;for(n=t.createCallback(n,i,3);++o<a&&n(e[o],o,e);)r++}else if(r=n,null==r||i)return e?e[0]:_;return p(e,0,zi(Ki(0,r),a))}function gn(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(e=Zt(e,n,i)),Z(e,t)}function vn(e,t,n){if("number"==typeof n){var r=e?e.length:0;n=0>n?Ki(0,r+n):n||0}else if(n){var a=Mn(e,t);return e[a]===t?a:-1}return i(e,t,n)}function yn(e,n,i){var r=0,a=e?e.length:0;if("number"!=typeof n&&null!=n){var o=a;for(n=t.createCallback(n,i,3);o--&&n(e[o],o,e);)r++}else r=null==n||i?1:n||r;return p(e,0,zi(Ki(0,a-r),a))}function wn(){for(var e=[],t=-1,n=arguments.length,a=c(),o=lt(),s=o===i,u=c();++t<n;){var d=arguments[t];(Xi(d)||ht(d))&&(e.push(d),a.push(s&&d.length>=b&&l(t?e[t]:u)))}var p=e[0],m=-1,_=p?p.length:0,g=[];e:for(;++m<_;){var v=a[0];if(d=p[m],(v?r(v,d):o(u,d))<0){for(t=n,(v||u).push(d);--t;)if(v=a[t],(v?r(v,d):o(e[t],d))<0)continue e;g.push(d)}}for(;n--;)v=a[n],v&&f(v);return h(a),h(u),g}function bn(e,n,i){var r=0,a=e?e.length:0;if("number"!=typeof n&&null!=n){var o=a;for(n=t.createCallback(n,i,3);o--&&n(e[o],o,e);)r++}else if(r=n,null==r||i)return e?e[a-1]:_;return p(e,Ki(0,a-r))}function Cn(e,t,n){var i=e?e.length:0;for("number"==typeof n&&(i=(0>n?Ki(0,i+n):zi(n,i-1))+1);i--;)if(e[i]===t)return i;return-1}function Sn(e){for(var t=arguments,n=0,i=t.length,r=e?e.length:0;++n<i;)for(var a=-1,o=t[n];++a<r;)e[a]===o&&(Oi.call(e,a--,1),r--);return e
}function Tn(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var i=-1,r=Ki(0,Bi((t-e)/(n||1))),a=pi(r);++i<r;)a[i]=e,e+=n;return a}function xn(e,n,i){var r=-1,a=e?e.length:0,o=[];for(n=t.createCallback(n,i,3);++r<a;){var s=e[r];n(s,r,e)&&(o.push(s),Oi.call(e,r--,1),a--)}return o}function kn(e,n,i){if("number"!=typeof n&&null!=n){var r=0,a=-1,o=e?e.length:0;for(n=t.createCallback(n,i,3);++a<o&&n(e[a],a,e);)r++}else r=null==n||i?1:Ki(0,n);return p(e,r)}function Mn(e,n,i,r){var a=0,o=e?e.length:a;for(i=i?t.createCallback(i,r,1):Xn,n=i(n);o>a;){var s=a+o>>>1;i(e[s])<n?a=s+1:o=s}return a}function Ln(){return rt(Z(arguments,!0,!0))}function Bn(e,n,i,r){return"boolean"!=typeof n&&null!=n&&(r=i,i="function"!=typeof n&&r&&r[n]===e?null:n,n=!1),null!=i&&(i=t.createCallback(i,r,3)),rt(e,n,i)}function En(e){return X(e,p(arguments,1))}function Dn(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Xi(n)||ht(n))var i=i?rt(X(i,n).concat(X(n,i))):n}return i||[]}function Vn(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,n=e?en(fr(e,"length")):0,i=pi(0>n?0:n);++t<n;)i[t]=fr(e,t);return i}function In(e,t){var n=-1,i=e?e.length:0,r={};for(t||!i||Xi(e[0])||(t=[]);++n<i;){var a=e[n];t?r[a]=t[n]:a&&(r[a[0]]=a[1])}return r}function Pn(e,t){if(!Bt(t))throw new Si;return function(){return--e<1?t.apply(this,arguments):void 0}}function An(e,t){return arguments.length>2?ot(e,17,p(arguments,2),null,t):ot(e,1,null,null,t)}function Fn(e){for(var t=arguments.length>1?Z(arguments,!0,!1,1):wt(e),n=-1,i=t.length;++n<i;){var r=t[n];e[r]=ot(e[r],1,null,null,e)}return e}function On(e,t){return arguments.length>2?ot(t,19,p(arguments,2),null,e):ot(t,3,null,null,e)}function Rn(){for(var e=arguments,t=e.length;t--;)if(!Bt(e[t]))throw new Si;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}}function Nn(e,t){return t="number"==typeof t?t:+t||e.length,ot(e,4,null,null,null,t)}function Hn(e,t,n){var i,r,a,o,s,l,u,c=0,d=!1,h=!0;if(!Bt(e))throw new Si;if(t=Ki(0,t)||0,n===!0){var f=!0;h=!1}else Et(n)&&(f=n.leading,d="maxWait"in n&&(Ki(t,n.maxWait)||0),h="trailing"in n?n.trailing:h);var p=function(){var n=t-(mr()-o);if(0>=n){r&&Ei(r);var d=u;r=l=u=_,d&&(c=mr(),a=e.apply(s,i),l||r||(i=s=null))}else l=Fi(p,n)},m=function(){l&&Ei(l),r=l=u=_,(h||d!==t)&&(c=mr(),a=e.apply(s,i),l||r||(i=s=null))};return function(){if(i=arguments,o=mr(),s=this,u=h&&(l||!f),d===!1)var n=f&&!l;else{r||f||(c=o);var _=d-(o-c),g=0>=_;g?(r&&(r=Ei(r)),c=o,a=e.apply(s,i)):r||(r=Fi(m,_))}return g&&l?l=Ei(l):l||t===d||(l=Fi(p,t)),n&&(g=!0,a=e.apply(s,i)),!g||l||r||(i=s=null),a}}function jn(e){if(!Bt(e))throw new Si;var t=p(arguments,1);return Fi(function(){e.apply(_,t)},1)}function Un(e,t){if(!Bt(e))throw new Si;var n=p(arguments,2);return Fi(function(){e.apply(_,n)},t)}function Gn(e,t){if(!Bt(e))throw new Si;var n=function(){var i=n.cache,r=t?t.apply(this,arguments):w+arguments[0];return Pi.call(i,r)?i[r]:i[r]=e.apply(this,arguments)};return n.cache={},n}function Wn(e){var t,n;if(!Bt(e))throw new Si;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Kn(e){return ot(e,16,p(arguments,1))}function zn(e){return ot(e,32,null,p(arguments,1))}function Yn(e,t,n){var i=!0,r=!0;if(!Bt(e))throw new Si;return n===!1?i=!1:Et(n)&&(i="leading"in n?n.leading:i,r="trailing"in n?n.trailing:r),Y.leading=i,Y.maxWait=t,Y.trailing=r,Hn(e,t,Y)}function qn(e,t){return ot(t,16,[e])}function Qn(e){return function(){return e}}function Jn(e,t,n){var i=typeof e;if(null==e||"function"==i)return C(e,t,n);if("object"!=i)return ni(e);var r=er(e),a=r[0],o=e[a];return 1!=r.length||o!==o||Et(o)?function(t){for(var n=r.length,i=!1;n--&&(i=et(t[r[n]],e[r[n]],null,!0)););return i}:function(e){var t=e[a];return o===t&&(0!==o||1/o==1/t)}}function $n(e){return null==e?"":Ci(e).replace(rr,st)}function Xn(e){return e}function Zn(e,i,r){var a=!0,o=i&&wt(i);i&&(r||o.length)||(null==r&&(r=i),s=n,i=e,e=t,o=wt(i)),r===!1?a=!1:Et(r)&&"chain"in r&&(a=r.chain);var s=e,l=Bt(s);Jt(o,function(t){var n=e[t]=i[t];l&&(s.prototype[t]=function(){var t=this.__chain__,i=this.__wrapped__,r=[i];Ai.apply(r,arguments);var o=n.apply(e,r);if(a||t){if(i===o&&Et(o))return this;o=new s(o),o.__chain__=t}return o})})}function ei(){return e._=ki,this}function ti(){}function ni(e){return function(t){return t[e]}}function ii(e,t,n){var i=null==e,r=null==t;if(null==n&&("boolean"==typeof e&&r?(n=e,e=1):r||"boolean"!=typeof t||(n=t,r=!0)),i&&r&&(t=1),e=+e||0,r?(t=e,e=0):t=+t||0,n||e%1||t%1){var a=qi();return zi(e+a*(t-e+parseFloat("1e-"+((a+"").length-1))),t)}return it(e,t)}function ri(e,t){if(e){var n=e[t];return Bt(n)?e[t]():n}}function ai(e,n,i){var r=t.templateSettings;e=Ci(e||""),i=or({},i,r);var a,o=or({},i.imports,r.imports),s=er(o),l=Gt(o),c=0,d=i.interpolate||V,h="__p += '",f=bi((i.escape||V).source+"|"+d.source+"|"+(d===E?M:V).source+"|"+(i.evaluate||V).source+"|$","g");e.replace(f,function(t,n,i,r,o,s){return i||(i=r),h+=e.slice(c,s).replace(P,u),n&&(h+="' +\n__e("+n+") +\n'"),o&&(a=!0,h+="';\n"+o+";\n__p += '"),i&&(h+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),c=s+t.length,t}),h+="';\n";var p=i.variable,m=p;m||(p="obj",h="with ("+p+") {\n"+h+"\n}\n"),h=(a?h.replace(T,""):h).replace(x,"$1").replace(k,"$1;"),h="function("+p+") {\n"+(m?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var g="\n/*\n//# sourceURL="+(i.sourceURL||"/lodash/template/source["+F++ +"]")+"\n*/";try{var v=gi(s,"return "+h+g).apply(_,l)}catch(y){throw y.source=h,y}return n?v(n):(v.source=h,v)}function oi(e,t,n){e=(e=+e)>-1?e:0;var i=-1,r=pi(e);for(t=C(t,n,1);++i<e;)r[i]=t(i);return r}function si(e){return null==e?"":Ci(e).replace(ir,dt)}function li(e){var t=++y;return Ci(null==e?"":e)+t}function ui(e){return e=new n(e),e.__chain__=!0,e}function ci(e,t){return t(e),e}function di(){return this.__chain__=!0,this}function hi(){return Ci(this.__wrapped__)}function fi(){return this.__wrapped__}e=e?nt.defaults($.Object(),e,nt.pick($,A)):$;var pi=e.Array,mi=e.Boolean,_i=e.Date,gi=e.Function,vi=e.Math,yi=e.Number,wi=e.Object,bi=e.RegExp,Ci=e.String,Si=e.TypeError,Ti=[],xi=wi.prototype,ki=e._,Mi=xi.toString,Li=bi("^"+Ci(Mi).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Bi=vi.ceil,Ei=e.clearTimeout,Di=vi.floor,Vi=gi.prototype.toString,Ii=ut(Ii=wi.getPrototypeOf)&&Ii,Pi=xi.hasOwnProperty,Ai=Ti.push,Fi=e.setTimeout,Oi=Ti.splice,Ri=Ti.unshift,Ni=function(){try{var e={},t=ut(t=wi.defineProperty)&&t,n=t(e,e,e)&&t}catch(i){}return n}(),Hi=ut(Hi=wi.create)&&Hi,ji=ut(ji=pi.isArray)&&ji,Ui=e.isFinite,Gi=e.isNaN,Wi=ut(Wi=wi.keys)&&Wi,Ki=vi.max,zi=vi.min,Yi=e.parseInt,qi=vi.random,Qi={};Qi[R]=pi,Qi[N]=mi,Qi[H]=_i,Qi[j]=gi,Qi[G]=wi,Qi[U]=yi,Qi[W]=bi,Qi[K]=Ci,n.prototype=t.prototype;var Ji=t.support={};Ji.funcDecomp=!ut(e.WinRTError)&&I.test(m),Ji.funcNames="string"==typeof gi.name,t.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:t}},Hi||(v=function(){function t(){}return function(n){if(Et(n)){t.prototype=n;var i=new t;t.prototype=null}return i||e.Object()}}());var $i=Ni?function(e,t){q.value=t,Ni(e,"__bindData__",q)}:ti,Xi=ji||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Mi.call(e)==R||!1},Zi=function(e){var t,n=e,i=[];if(!n)return i;if(!Q[typeof e])return i;for(t in n)Pi.call(n,t)&&i.push(t);return i},er=Wi?function(e){return Et(e)?Wi(e):[]}:Zi,tr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},nr=Ct(tr),ir=bi("("+er(nr).join("|")+")","g"),rr=bi("["+er(tr).join("")+"]","g"),ar=function(e,t,n){var i,r=e,a=r;if(!r)return a;var o=arguments,s=0,l="number"==typeof n?2:o.length;if(l>3&&"function"==typeof o[l-2])var u=C(o[--l-1],o[l--],2);else l>2&&"function"==typeof o[l-1]&&(u=o[--l]);for(;++s<l;)if(r=o[s],r&&Q[typeof r])for(var c=-1,d=Q[typeof r]&&er(r),h=d?d.length:0;++c<h;)i=d[c],a[i]=u?u(a[i],r[i]):r[i];return a},or=function(e,t,n){var i,r=e,a=r;if(!r)return a;for(var o=arguments,s=0,l="number"==typeof n?2:o.length;++s<l;)if(r=o[s],r&&Q[typeof r])for(var u=-1,c=Q[typeof r]&&er(r),d=c?c.length:0;++u<d;)i=c[u],"undefined"==typeof a[i]&&(a[i]=r[i]);return a},sr=function(e,t,n){var i,r=e,a=r;if(!r)return a;if(!Q[typeof r])return a;t=t&&"undefined"==typeof n?t:C(t,n,3);for(i in r)if(t(r[i],i,e)===!1)return a;return a},lr=function(e,t,n){var i,r=e,a=r;if(!r)return a;if(!Q[typeof r])return a;t=t&&"undefined"==typeof n?t:C(t,n,3);for(var o=-1,s=Q[typeof r]&&er(r),l=s?s.length:0;++o<l;)if(i=s[o],t(r[i],i,e)===!1)return a;return a},ur=Ii?function(e){if(!e||Mi.call(e)!=G)return!1;var t=e.valueOf,n=ut(t)&&(n=Ii(t))&&Ii(n);return n?e==n||Ii(e)==n:ct(e)}:ct,cr=at(function(e,t,n){Pi.call(e,n)?e[n]++:e[n]=1}),dr=at(function(e,t,n){(Pi.call(e,n)?e[n]:e[n]=[]).push(t)}),hr=at(function(e,t,n){e[n]=t}),fr=Zt,pr=Yt,mr=ut(mr=_i.now)&&mr||function(){return(new _i).getTime()},_r=8==Yi(S+"08")?Yi:function(e,t){return Yi(At(e)?e.replace(D,""):e,t||0)};return t.after=Pn,t.assign=ar,t.at=Wt,t.bind=An,t.bindAll=Fn,t.bindKey=On,t.chain=ui,t.compact=hn,t.compose=Rn,t.constant=Qn,t.countBy=cr,t.create=mt,t.createCallback=Jn,t.curry=Nn,t.debounce=Hn,t.defaults=or,t.defer=jn,t.delay=Un,t.difference=fn,t.filter=Yt,t.flatten=gn,t.forEach=Jt,t.forEachRight=$t,t.forIn=sr,t.forInRight=vt,t.forOwn=lr,t.forOwnRight=yt,t.functions=wt,t.groupBy=dr,t.indexBy=hr,t.initial=yn,t.intersection=wn,t.invert=Ct,t.invoke=Xt,t.keys=er,t.map=Zt,t.mapValues=Ot,t.max=en,t.memoize=Gn,t.merge=Rt,t.min=tn,t.omit=Nt,t.once=Wn,t.pairs=Ht,t.partial=Kn,t.partialRight=zn,t.pick=jt,t.pluck=fr,t.property=ni,t.pull=Sn,t.range=Tn,t.reject=an,t.remove=xn,t.rest=kn,t.shuffle=sn,t.sortBy=cn,t.tap=ci,t.throttle=Yn,t.times=oi,t.toArray=dn,t.transform=Ut,t.union=Ln,t.uniq=Bn,t.values=Gt,t.where=pr,t.without=En,t.wrap=qn,t.xor=Dn,t.zip=Vn,t.zipObject=In,t.collect=Zt,t.drop=kn,t.each=Jt,t.eachRight=$t,t.extend=ar,t.methods=wt,t.object=In,t.select=Yt,t.tail=kn,t.unique=Bn,t.unzip=Vn,Zn(t),t.clone=ft,t.cloneDeep=pt,t.contains=Kt,t.escape=$n,t.every=zt,t.find=qt,t.findIndex=pn,t.findKey=_t,t.findLast=Qt,t.findLastIndex=mn,t.findLastKey=gt,t.has=bt,t.identity=Xn,t.indexOf=vn,t.isArguments=ht,t.isArray=Xi,t.isBoolean=St,t.isDate=Tt,t.isElement=xt,t.isEmpty=kt,t.isEqual=Mt,t.isFinite=Lt,t.isFunction=Bt,t.isNaN=Dt,t.isNull=Vt,t.isNumber=It,t.isObject=Et,t.isPlainObject=ur,t.isRegExp=Pt,t.isString=At,t.isUndefined=Ft,t.lastIndexOf=Cn,t.mixin=Zn,t.noConflict=ei,t.noop=ti,t.now=mr,t.parseInt=_r,t.random=ii,t.reduce=nn,t.reduceRight=rn,t.result=ri,t.runInContext=m,t.size=ln,t.some=un,t.sortedIndex=Mn,t.template=ai,t.unescape=si,t.uniqueId=li,t.all=zt,t.any=un,t.detect=qt,t.findWhere=qt,t.foldl=nn,t.foldr=rn,t.include=Kt,t.inject=nn,Zn(function(){var e={};return lr(t,function(n,i){t.prototype[i]||(e[i]=n)}),e}(),!1),t.first=_n,t.last=bn,t.sample=on,t.take=_n,t.head=_n,lr(t,function(e,i){var r="sample"!==i;t.prototype[i]||(t.prototype[i]=function(t,i){var a=this.__chain__,o=e(this.__wrapped__,t,i);return a||null!=t&&(!i||r&&"function"==typeof t)?new n(o,a):o})}),t.VERSION="2.4.1",t.prototype.chain=di,t.prototype.toString=hi,t.prototype.value=fi,t.prototype.valueOf=fi,Jt(["join","pop","shift"],function(e){var i=Ti[e];t.prototype[e]=function(){var e=this.__chain__,t=i.apply(this.__wrapped__,arguments);return e?new n(t,e):t}}),Jt(["push","reverse","sort","unshift"],function(e){var n=Ti[e];t.prototype[e]=function(){return n.apply(this.__wrapped__,arguments),this}}),Jt(["concat","slice","splice"],function(e){var i=Ti[e];t.prototype[e]=function(){return new n(i.apply(this.__wrapped__,arguments),this.__chain__)}}),t}var _,g=[],v=[],y=0,w=+new Date+"",b=75,C=40,S=" 	\f \n\r\u2028\u2029 ᠎             　",T=/\b__p \+= '';/g,x=/\b(__p \+=) '' \+/g,k=/(__e\(.*?\)|\b__t\)) \+\n'';/g,M=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,L=/\w*$/,B=/^\s*function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,D=RegExp("^["+S+"]*0+(?=.$)"),V=/($^)/,I=/\bthis\b/,P=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],F=0,O="[object Arguments]",R="[object Array]",N="[object Boolean]",H="[object Date]",j="[object Function]",U="[object Number]",G="[object Object]",W="[object RegExp]",K="[object String]",z={};z[j]=!1,z[O]=z[R]=z[N]=z[H]=z[U]=z[G]=z[W]=z[K]=!0;var Y={leading:!1,maxWait:0,trailing:!1},q={configurable:!1,enumerable:!1,value:null,writable:!1},Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},J={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},$=Q[typeof window]&&window||this,X=Q[typeof n]&&n&&!n.nodeType&&n,Z=Q[typeof t]&&t&&!t.nodeType&&t,et=Z&&Z.exports===X&&X,tt=Q[typeof e]&&e;!tt||tt.global!==tt&&tt.window!==tt||($=tt);var nt=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?($._=nt,define(function(){return nt})):X&&Z?et?(Z.exports=nt)._=nt:X._=nt:$._=nt}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,t){(function(e){/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.14
 */
(function(){"use strict";function n(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function i(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function r(e,t){return"onerror"===e?void $.on("error",t):2!==arguments.length?$[e]:void($[e]=t)}function a(e){return"function"==typeof e||"object"==typeof e&&null!==e}function o(e){return"function"==typeof e}function s(e){return"object"==typeof e&&null!==e}function l(){}function u(){}function c(e){try{return e.then}catch(t){return st.error=t,st}}function d(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function h(e,t,n){$.async(function(e){var i=!1,r=d(n,t,function(n){i||(i=!0,t!==n?m(e,n):g(e,n))},function(t){i||(i=!0,v(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,v(e,r))},e)}function f(e,t){t._state===at?g(e,t._result):e._state===ot?v(e,t._result):y(t,void 0,function(n){t!==n?m(e,n):g(e,n)},function(t){v(e,t)})}function p(e,t){if(t.constructor===e.constructor)f(e,t);else{var n=c(t);n===st?v(e,st.error):void 0===n?g(e,t):o(n)?h(e,t,n):g(e,t)}}function m(e,t){e===t?g(e,t):a(t)?p(e,t):g(e,t)}function _(e){e._onerror&&e._onerror(e._result),w(e)}function g(e,t){e._state===rt&&(e._result=t,e._state=at,0===e._subscribers.length?$.instrument&&it("fulfilled",e):$.async(w,e))}function v(e,t){e._state===rt&&(e._state=ot,e._result=t,$.async(_,e))}function y(e,t,n,i){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+at]=n,r[a+ot]=i,0===a&&e._state&&$.async(w,e)}function w(e){var t=e._subscribers,n=e._state;if($.instrument&&it(n===at?"fulfilled":"rejected",e),0!==t.length){for(var i,r,a=e._result,o=0;o<t.length;o+=3)i=t[o],r=t[o+n],i?S(n,i,r,a):r(a);e._subscribers.length=0}}function b(){this.error=null}function C(e,t){try{return e(t)}catch(n){return lt.error=n,lt}}function S(e,t,n,i){var r,a,s,l,u=o(n);if(u){if(r=C(n,i),r===lt?(l=!0,a=r.error,r=null):s=!0,t===r)return void v(t,new TypeError("A promises callback cannot return that same promise."))}else r=i,s=!0;t._state!==rt||(u&&s?m(t,r):l?v(t,a):e===at?g(t,r):e===ot&&v(t,r))}function T(e,t){try{t(function(t){m(e,t)},function(t){v(e,t)})}catch(n){v(e,n)}}function x(e,t,n){return e===at?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function k(e,t,n,i){this._instanceConstructor=e,this.promise=new e(u,i),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?g(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&g(this.promise,this._result))):v(this.promise,this._validationError())}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function B(e,t){this._id=mt++,this._label=t,this._state=void 0,this._result=void 0,this._subscribers=[],$.instrument&&it("created",this),u!==e&&(o(e)||M(),this instanceof B||L(),T(this,e))}function E(){this.value=void 0}function D(e){try{return e.then}catch(t){return gt.value=t,gt}}function V(e,t,n){try{e.apply(t,n)}catch(i){return gt.value=i,gt}}function I(e,t){for(var n,i,r={},a=e.length,o=new Array(a),s=0;a>s;s++)o[s]=e[s];for(i=0;i<t.length;i++)n=t[i],r[n]=o[i+1];return r}function P(e){for(var t=e.length,n=new Array(t-1),i=1;t>i;i++)n[i-1]=e[i];return n}function A(e,t){return{then:function(n,i){return e.call(t,n,i)}}}function F(e,t,n,i){var r=V(n,i,t);return r===gt&&v(e,r.value),e}function O(e,t,n,i){return _t.all(t).then(function(t){var r=V(n,i,t);return r===gt&&v(e,r.value),e})}function R(e){return e&&"object"==typeof e?e.constructor===_t?!0:D(e):!1}function N(e,t,n){this._superConstructor(e,t,!1,n)}function H(e,t,n){this._superConstructor(e,t,!0,n)}function j(e,t,n){this._superConstructor(e,t,!1,n)}function U(){return function(){e.nextTick(z)}}function G(){var e=0,t=new Ft(z),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function W(){var e=new MessageChannel;return e.port1.onmessage=z,function(){e.port2.postMessage(0)}}function K(){return function(){setTimeout(z,1)}}function z(){for(var e=0;It>e;e+=2){var t=Rt[e],n=Rt[e+1];t(n),Rt[e]=void 0,Rt[e+1]=void 0}It=0}function Y(e,t){$.async(e,t)}function q(){$.on.apply($,arguments)}function Q(){$.off.apply($,arguments)}var J={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=void 0,e},on:function(e,t){var r,a=i(this);r=a[e],r||(r=a[e]=[]),-1===n(r,t)&&r.push(t)},off:function(e,t){var r,a,o=i(this);return t?(r=o[e],a=n(r,t),void(-1!==a&&r.splice(a,1))):void(o[e]=[])},trigger:function(e,t){var n,r,a=i(this);if(n=a[e])for(var o=0;o<n.length;o++)(r=n[o])(t)}},$={instrument:!1};J.mixin($);var X;X=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var Z=X,et=Date.now||function(){return(new Date).getTime()},tt=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return l.prototype=e,new l},nt=[],it=function(e,t,n){1===nt.push({name:e,payload:{guid:t._guidKey+t._id,eventName:e,detail:t._result,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:et(),stack:new Error(t._label).stack}})&&setTimeout(function(){for(var e,t=0;t<nt.length;t++)e=nt[t],$.trigger(e.name,e.payload);nt.length=0},50)},rt=void 0,at=1,ot=2,st=new b,lt=new b;k.prototype._validateInput=function(e){return Z(e)},k.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},k.prototype._init=function(){this._result=new Array(this.length)};var ut=k;k.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,i=0;t._state===rt&&e>i;i++)this._eachEntry(n[i],i)},k.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;s(e)?e.constructor===n&&e._state!==rt?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(at,t,e))},k.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===rt&&(this._remaining--,this._abortOnReject&&e===ot?v(i,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&g(i,this._result)},k.prototype._makeResult=function(e,t,n){return n},k.prototype._willSettleAt=function(e,t){var n=this;y(e,void 0,function(e){n._settledAt(at,t,e)},function(e){n._settledAt(ot,t,e)})};var ct=function(e,t){return new ut(this,e,!0,t).promise},dt=function(e,t){function n(e){m(a,e)}function i(e){v(a,e)}var r=this,a=new r(u,t);if(!Z(e))return v(a,new TypeError("You must pass an array to race.")),a;for(var o=e.length,s=0;a._state===rt&&o>s;s++)y(r.resolve(e[s]),void 0,n,i);return a},ht=function(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var i=new n(u,t);return m(i,e),i},ft=function(e,t){var n=this,i=new n(u,t);return v(i,e),i},pt="rsvp_"+et()+"-",mt=0,_t=B;B.cast=ht,B.all=ct,B.race=dt,B.resolve=ht,B.reject=ft,B.prototype={constructor:B,_guidKey:pt,_onerror:function(e){$.trigger("error",e)},then:function(e,t,n){var i=this,r=i._state;if(r===at&&!e||r===ot&&!t)return $.instrument&&it("chained",this,this),this;i._onerror=null;var a=new this.constructor(u,n),o=i._result;if($.instrument&&it("chained",i,a),r){var s=arguments[r-1];$.async(function(){S(r,a,s,o)})}else y(i,a,e,t);return a},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}};var gt=new E,vt=new E,yt=function(e,t){var n=function(){for(var n,i=this,r=arguments.length,a=new Array(r+1),o=!1,s=0;r>s;++s){if(n=arguments[s],!o){if(o=R(n),o===vt){var l=new _t(u);return v(l,vt.value),l}o&&o!==!0&&(n=A(o,n))}a[s]=n}var c=new _t(u);return a[r]=function(e,n){e?v(c,e):void 0===t?m(c,n):t===!0?m(c,P(arguments)):Z(t)?m(c,I(arguments,t)):m(c,n)},o?O(c,a,e,i):F(c,a,e,i)};return n.__proto__=e,n},wt=function(e,t){return _t.all(e,t)};N.prototype=tt(ut.prototype),N.prototype._superConstructor=ut,N.prototype._makeResult=x,N.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var bt=function(e,t){return new N(_t,e,t).promise},Ct=function(e,t){return _t.race(e,t)},St=H;H.prototype=tt(ut.prototype),H.prototype._superConstructor=ut,H.prototype._init=function(){this._result={}},H.prototype._validateInput=function(e){return e&&"object"==typeof e},H.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},H.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var i in t)e._state===rt&&t.hasOwnProperty(i)&&n.push({position:i,entry:t[i]});var r=n.length;this._remaining=r;for(var a,o=0;e._state===rt&&r>o;o++)a=n[o],this._eachEntry(a.entry,a.position)};var Tt=function(e,t){return new St(_t,e,t).promise};j.prototype=tt(St.prototype),j.prototype._superConstructor=ut,j.prototype._makeResult=x,j.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var xt,kt=function(e,t){return new j(_t,e,t).promise},Mt=function(e){throw setTimeout(function(){throw e}),e},Lt=function(e){var t={};return t.promise=new _t(function(e,n){t.resolve=e,t.reject=n},e),t},Bt=function(e,t,n){return _t.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as map's second argument.");for(var i=e.length,r=new Array(i),a=0;i>a;a++)r[a]=t(e[a]);return _t.all(r,n)})},Et=function(e,t){return _t.resolve(e,t)},Dt=function(e,t){return _t.reject(e,t)},Vt=function(e,t,n){return _t.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as filter's second argument.");for(var i=e.length,r=new Array(i),a=0;i>a;a++)r[a]=t(e[a]);return _t.all(r,n).then(function(t){for(var n=new Array(i),r=0,a=0;i>a;a++)t[a]&&(n[r]=e[a],r++);return n.length=r,n})})},It=0,Pt=function(e,t){Rt[It]=e,Rt[It+1]=t,It+=2,2===It&&xt()},At="undefined"!=typeof window?window:{},Ft=At.MutationObserver||At.WebKitMutationObserver,Ot="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Rt=new Array(1e3);xt="undefined"!=typeof e&&"[object process]"==={}.toString.call(e)?U():Ft?G():Ot?W():K(),$.async=Pt;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var Nt=window.__PROMISE_INSTRUMENTATION__;r("instrument",!0);for(var Ht in Nt)Nt.hasOwnProperty(Ht)&&q(Ht,Nt[Ht])}var jt={race:Ct,Promise:_t,allSettled:bt,hash:Tt,hashSettled:kt,denodeify:yt,on:q,off:Q,map:Bt,filter:Vt,resolve:Et,reject:Dt,all:wt,rethrow:Mt,defer:Lt,EventTarget:J,configure:r,async:Y};"function"==typeof define&&define.amd?define(function(){return jt}):"undefined"!=typeof t&&t.exports?t.exports=jt:"undefined"!=typeof this&&(this.RSVP=jt)}).call(this)}).call(this,e("_process"))},{_process:5}],13:[function(e,t){function n(e){return a(e&&"string"==typeof e.url,"URL must be given"),new r.Promise(function(t,n){e.method||(e.method="GET"),e.data&&("string"!=typeof e.data&&(e.data=o.stringify(e.data)),"GET"===e.method&&(e.url+=(/\?/.test(e.url)?"&":"?")+e.data,delete e.data));var r=new XMLHttpRequest;i.extend(r,e.xhrFields),r.onerror=function(t){var i=new Error("Failed to load "+e.url);i.event=t,i.xhr=r,n(i)},r.onload=function(){t({text:r.responseText,xhr:r})},r.open(e.method,e.url,!0),i.each(e.headers,function(e,t){r.setRequestHeader(t,e)}),r.send(e.data)})}var i=e("lodash"),r=e("rsvp"),a=e("assert"),o=e("querystring");t.exports=n},{assert:2,lodash:11,querystring:8,rsvp:12}],14:[function(e,t){function n(){var e=new Error("Stack saver");return"string"!=typeof e.stack?e.stack:e.stack.replace(/^([^\n]*\n){2}/,"")}t.exports=n},{}],15:[function(e,t){function n(e,t){var n=document.createElement("script");n.type="text/javascript",t&&(n.crossOrigin="anonymous");var i=new a.Promise(function(t,i){n.addEventListener("error",function(t){i(t.error||new Error(t.message||"Load failure: "+e,t.filename,t.lineno,t.column))},!1),n.addEventListener("load",function(){r.defer(t)},!1)});return n.src=e,document.head.appendChild(n),i}function i(e,t){return s()?o({url:e}).then(function(n){var i=n.text,r=eval;t&&t.nowrap||(i="(function(){"+i+"\n});");var a=r(i+"\n//# sourceURL="+e+"\n");t&&t.nowrap||a()}):n(e,!0).catch(function(){return n(e,!1).then(function(){console.warn("Script "+e+" included without CORS headers. Error logs might be censored by the browser.")})})}var r=e("lodash"),a=e("rsvp"),o=e("./ajax"),s=r.once(function(){return"undefined"!=typeof chrome&&chrome.extension?!0:"undefined"!=typeof safari&&safari.extension?!0:!1});t.exports=i},{"./ajax":13,lodash:11,rsvp:12}],16:[function(e,t){function n(e){return function(t,n,o){var s=arguments;try{if(t instanceof Error&&(o=o||n,n=t,t=n.message),n&&n.__alreadyLoggedBySDK)return;var l=a(),u=["Got an error:",t,n];n&&n.stack&&(u=u.concat(["\n\nOriginal error stack:\n"+n.stack])),o&&(u=u.concat(["\n\nError details:",o])),u=u.concat(["\n\nError logged from:",l]),console.error.apply(console,u);var c={nowStack:l,stuffToLog:u};r.resolve().then(function(){return e(c,t,n,o)}).catch(function(e){i(e,s)})}catch(d){i(d,s)}finally{if(n)try{Object.defineProperty(n,"__alreadyLoggedBySDK",{value:!0,enumerable:!1})}catch(h){}}}}function i(e,t){console.error("ERROR REPORTING ERROR",e),console.error("ORIGINAL ERROR",t)}var r=e("rsvp"),a=e("./get-stack-trace");t.exports=n},{"./get-stack-trace":14,rsvp:12}],17:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e};n.extend(i.prototype,{registerComposeViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Compose","ComposeView",e)},getComposeView:function(){return this._platformImplementationLoader.load().then(function(e){return e.Views.getComposeView()})}}),t.exports=i},{lodash:11}],18:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e};n.extend(i.prototype,{registerThreadViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Conversations","ThreadView",e)},registerMessageViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Conversations","MessageView",e)}}),t.exports=i},{lodash:11}],19:[function(e,t){var n=e("lodash"),i=e("events").EventEmitter,r=function(e){i.call(this),this._platformImplementationLoader=e};r.prototype=Object.create(i.prototype),n.extend(r.prototype,{registerThreadRowViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Mailbox","ThreadRowView",e)}}),t.exports=r},{events:3,lodash:11}],20:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e,this._modalViewImplementation=null,this._closeEarly=!1};n.extend(i.prototype,{show:function(e){var t=this;this._platformImplementationLoader.load().then(function(n){t._closeEarly||(t._modalViewImplementation=n.Modal.createModalView(e),t._modalViewImplementation.show())})},close:function(){this._modalViewImplementation&&!this._closeEarly&&this._modalViewImplementation.close(),this._closeEarly=!0}}),t.exports=i},{lodash:11}],21:[function(e,t){var n=e("lodash"),i=e("./modal-view"),r=function(e){this._platformImplementationLoader=e};n.extend(r.prototype,{show:function(e){var t=new i(this._platformImplementationLoader);return t.show(e),t}}),t.exports=r},{"./modal-view":20,lodash:11}],22:[function(e,t){var n=e("lodash"),i=e("events").EventEmitter,r=(e("rsvp"),function(e){i.call(this),this._platformImplementation=e,this._removed=!1,this._implementation=null,this._subItems=[]});r.prototype=Object.create(i.prototype),n.extend(r.prototype,{addNavItem:function(e){if(this._removed)return console.warn("This nav item is removed so nothing will happen"),new r(this._platformImplementation);var t=new r(this._platformImplementation),n=this._implementation.addNavItem(e);return t.setImplementation(n),this._subItems.push(t),t},remove:function(){this._subItems.forEach(function(e){e.remove()}),this._implementation.remove(),this._removed=!0},isCollapsed:function(){return this._removed?(console.warn("This nav item is removed"),null):this._implementation.isCollapsed()},setCollapsed:function(e){this._implementation.setCollapsed(e)},setImplementation:function(e){this._implementation=e,this._bindToImplementationEvents()},_bindToImplementationEvents:function(){this._implementation.getEventStream().onEnd(this,"emit","unload");var e=this;this._implementation.getEventStream().onValue(function(t){e.emit(t.eventName,t.data)})}}),t.exports=r},{events:3,lodash:11,rsvp:12}],23:[function(e,t){var n=e("lodash"),i=e("./nav-item"),r=function(e){this._platformImplementationLoader=e,this._setupSentItem()};n.extend(r.prototype,{addNavItem:function(e){var t=new i(this._platformImplementationLoader.getPlatformImplementation(),e),n=this._platformImplementationLoader.getPlatformImplementation().NavMenu.addNavItem(e);return t.setImplementation(n),t},_setupSentItem:function(){}}),t.exports=r},{"./nav-item":22,lodash:11}],24:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e};n.extend(i.prototype,{createNewRoute:function(e){this._platformImplementationLoader.load().then(function(t){t.Router.createNewRoute(e)})},createLink:function(e,t){if(!this._platformImplementationLoader.getPlatformImplementation())throw new Error("Called before InboxSDK finished loading");return this._platformImplementationLoader.getPlatformImplementation().Router.createLink(e,t)},"goto":function(e,t){if(!this._platformImplementationLoader.getPlatformImplementation())throw new Error("Called before InboxSDK finished loading");return this._platformImplementationLoader.getPlatformImplementation().Router.goto(e,t)},registerRouteViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Router","RouteView",e)},gotoView:function(e,t){this.goto(e,t)},registerCustom:function(e){this.createNewRoute(e)}}),t.exports=i},{lodash:11}],25:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e};n.extend(i.prototype,{registerThreadSidebarViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Sidebar","ThreadSidebarView",e)},registerMessageSidebarViewHandler:function(e){return this._platformImplementationLoader.registerHandler("Sidebar","MessageSidebarView",e)}}),t.exports=i},{lodash:11}],26:[function(e,t){var n=e("lodash"),i=function(e){this._platformImplementationLoader=e};n.extend(i.prototype,{registerThreadListNoSelectionsButton:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadListNoSelectionsButton(e)})},registerThreadListWithSelectionsButton:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadListWithSelectionsButton(e)})},registerThreadViewButton:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadViewButton(e)})},registerThreadListNoSelectionsMoreItem:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadListNoSelectionsMoreItem(e)})},registerThreadListWithSelectionsMoreItem:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadListWithSelectionsMoreItem(e)})},registerThreadViewMoreItem:function(e){this._platformImplementationLoader.load().then(function(t){t.Toolbars.registerThreadViewMoreItem(e)})}}),t.exports=i},{lodash:11}],27:[function(e,t){function n(e){if(!e.TEMPORARY_INTERNAL_skipWeakMapRequirement&&"undefined"==typeof WeakMap)throw new Error("Browser does not support WeakMap")}t.exports=n},{}],28:[function(e,t){var n=e("lodash"),i=e("rsvp"),r=e("./loading/platform-implementation-loader"),a=e("./check-requirements"),o=e("./api-definitions/compose"),s=e("./api-definitions/conversations"),l=e("./api-definitions/mailbox"),u=e("./api-definitions/nav-menu"),c=e("./api-definitions/sidebar"),d=e("./tracker"),h=e("./api-definitions/router"),f=e("./api-definitions/toolbars"),p=e("./api-definitions/modal"),m=function(t,i){if(!(this instanceof m))throw new Error("new must be used");console.warn("Deprecation warning: Use InboxSDK.load(...) instead."),i=n.extend({globalErrorLogging:!0},i,{VERSION:m.LOADER_VERSION}),a(i),this._appId=t,this._platformImplementationLoader=new r(this._appId,i),this._tracker=new d(this._platformImplementationLoader,i),this.Compose=new o(this._platformImplementationLoader),this.Conversations=new s(this._platformImplementationLoader),this.Router=new h(this._platformImplementationLoader),this.FullscreenViews=this.Router,this.Mailbox=new l(this._platformImplementationLoader),this.Modal=new p(this._platformImplementationLoader),this.NavMenu=new u(this._platformImplementationLoader),this.Sidebar=new c(this._platformImplementationLoader),this.Toolbars=new f(this._platformImplementationLoader),this.Util={loadScript:e("../common/load-script"),logError:this._tracker.logError.bind(this._tracker),track:this._tracker.track.bind(this._tracker)};this._platformImplementationLoader.load().then(function(e){m.IMPL_VERSION=m.prototype.IMPL_VERSION=e.IMPL_VERSION}).catch(function(e){console.error("Failed to load implementation:",e)})};m.LOADER_VERSION="0.7.6-612213e7ed499c62",m.load=function(e,t,o){o=n.extend({globalErrorLogging:!0},o,{VERSION:m.LOADER_VERSION,REQUESTED_API_VERSION:e}),i._errorHandlerSetup||(i._errorHandlerSetup=!0,i.on("error",function(e){console.error("Possibly uncaught promise rejection",e)})),a(o);var s=new r(t,o),l=s.load();return l.catch(function(e){console.error("Failed to load implementation:",e)}),l},m.loadScript=e("../common/load-script"),t.exports=m},{"../common/load-script":15,"./api-definitions/compose":17,"./api-definitions/conversations":18,"./api-definitions/mailbox":19,"./api-definitions/modal":21,"./api-definitions/nav-menu":23,"./api-definitions/router":24,"./api-definitions/sidebar":25,"./api-definitions/toolbars":26,"./check-requirements":27,"./loading/platform-implementation-loader":29,"./tracker":30,lodash:11,rsvp:12}],29:[function(e,t){(function(n){var i=e("rsvp"),r=e("lodash"),a=function(e,t){var a=this;this.load=r.once(function(){return i.resolve().then(function(){return n.__InboxSDKImpLoader?void 0:a._loadScript().then(function(){if(!n.__InboxSDKImpLoader)throw new Error("Implementation file did not load correctly")})}).then(function(){return a._platformImplementation=n.__InboxSDKImpLoader.load("0.1",e,t),a._platformImplementation})})};r.extend(a.prototype,{_loadScript:function(){var t=e("../../common/load-script");return t("https://www.inboxsdk.com/build/platform-implementation.js")},registerHandler:function(e,t,n){var i=null,r=!1;return this.load().then(function(a){r||(i=a[e]["register"+t+"Handler"](n))}),function(){i?i():r=!0}},getPlatformImplementation:function(){return this._platformImplementation}}),t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../common/load-script":15,lodash:11,rsvp:12}],30:[function(e,t){function n(e){function t(){var t=arguments;return e.load().then(function(e){return e.Utils.logErrorToServer.apply(e.Utils,t)})}this._platformImplementationLoader=e,this.logError=a(t),i._errorHandlerSetup||(i._errorHandlerSetup=!0,i.on("error",function(e){setTimeout(function(){throw e},1)}))}var i=e("rsvp"),r=e("assert"),a=e("../common/log-error-factory");n.prototype.track=function(e,t){if(r.equal(typeof e,"string","eventName must be a string"),t&&(r.equal(typeof t,"object","details must be an object"),JSON.stringify(t)),arguments.length>2)throw new Error("Too many parameters");this._platformImplementationLoader.load().then(function(n){n.Utils.track(e,t)})},t.exports=n},{"../common/log-error-factory":16,assert:2,rsvp:12}]},{},[1]);function initMessenger(e){Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);this.length=e<0?this.length+e:e;return this.push.apply(this,n)};var t;t={el:null,ob_els:{},ob_callbacks:{},init:function(e){this.el=document.getElementById("messengerEventPasser");if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id","messengerEventPasser");this.el.setAttribute("style","display:none;");document.body.appendChild(this.el)}if(e)e(this)},observe:function(e,t,n){var i=this;if(!n){n="noid"}if(!this.ob_els[e]){var r=document.getElementById(e+"_eventPasser");if(!r){r=document.createElement("div");r.setAttribute("id",e+"_eventPasser");r.setAttribute("style","display:none");this.el.appendChild(r)}this.ob_els[e]=r}this.ob_els[e].addEventListener(e,function(t){var r=null;var a=i.listToArray(this.childNodes);for(var o=0;el=a[o];o++){var s=el.getAttribute("id").split("_")[1];if(n=="all"||s==n){var l=i.listToArray(el.childNodes);var u=l[l.length-1];try{r=JSON.parse(u.innerText)}catch(c){}el.parentNode.removeChild(el);var d=[];var h=i.ob_callbacks[e][n].length;for(var f=0;f<h;f++){var p=i.ob_callbacks[e][n][f];if(!p.runOnce){d.push(p)}p(r,s)}if(el){el.innerText=""}if(i.ob_callbacks[e][n]){for(var m=h;m<i.ob_callbacks[e][n].length;m++){d.push(i.ob_callbacks[e][n][m])}}i.ob_callbacks[e][n]=d}}});if(!this.ob_callbacks[e])this.ob_callbacks[e]={};if(!this.ob_callbacks[e][n])this.ob_callbacks[e][n]=[];this.ob_callbacks[e][n].push(t)},unobserve:function(e,t){delete this.ob_callbacks[e][t]},sendMessage:function(e,t,n,i,r){var a=document.getElementById(e+"_eventPasser");if(a){if(!r){r="noid"}if(n){if(i){i.runOnce=true;this.observe(n,i,r)}}var o=document.createEvent("Event");o.initEvent(e,true,true);o.callId=r;var s=document.getElementById(e+"_"+r+"_eventPasser");if(!s){s=this.createElement(e+"_"+r+"_eventPasser");a.appendChild(s)}var l=document.createElement("div");l.setAttribute("style","display:none");s.appendChild(l);var u={};try{var c=Object.getOwnPropertyNames(t);for(var d=0;d<c.length;d++){var h=c[d];try{u[h]=t[h]}catch(f){u[h]=null}}}catch(p){}try{l.innerText=JSON.stringify(u)}catch(f){}a.dispatchEvent(o)}},storeData:function(e,t){var n="messenger_"+e+"_dataStore";var i=document.getElementById(n);if(!i){i=document.createElement("div");i.setAttribute("style","display:none;");i.setAttribute("id",n);this.el.appendChild(i)}i.innerText=JSON.stringify(t)},getData:function(e){var t="messenger_"+e+"_dataStore";var n=document.getElementById(t);if(n){try{return JSON.parse(n.innerText)}catch(i){}}},createElement:function(e){var t=document.createElement("div");t.setAttribute("style","display:none");t.setAttribute("id",e);return t},listToArray:function(e){var t=[];for(var n=0;node=e[n];n++){t.push(node)}return t}};e.Messenger=t;t.init()}if(top.document==document){initMessenger(window)}var Streak=window.Streak={};Streak.clientVersion="6.1813";Streak.optimizelyAccountID=173001298;Streak.optimizelyExperimentID=181337382;Streak.optimizelyOriginalVariationID=181261759;Streak.stripePublishableKey="pk_live_hOZ1AIegCBt7wAuQuXPxgSKd";Streak.googleAnalyticsID="UA-25304962-3";Streak.extVersion=Messenger.getData("extVersion");Streak.server=Messenger.getData("server");Streak.combinedPath=Messenger.getData("combinedPath");Streak.devRealtimeServer=Messenger.getData("devRealtimeServer");Streak.isSafari=Messenger.getData("isSafari");Streak.getCombined=function(e,t){return(t?Streak.server:"")+Streak.combinedPath+"combined-"+Streak.extVersion+"."+e};if(!top.document.getElementById("js_frame")){throw new Error("not in gmail")}Streak.iframe=document.createElement("iframe");Streak.iframe.style.display="none";document.body.appendChild(Streak.iframe);Streak.Date=Streak.iframe.contentWindow.Date;(function(e){var t=t||function(e,t){var n={};var i=n.lib={};var r=i.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;if(t){n.mixIn(t)}if(!n.hasOwnProperty("init")){n.init=function(){n.$super.init.apply(this,arguments)}}n.init.prototype=n;n.$super=this;return n},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}if(e.hasOwnProperty("toString")){this.toString=e.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var a=i.WordArray=r.extend({init:function(e,n){e=this.words=e||[];if(n!=t){this.sigBytes=n}else{this.sigBytes=e.length*4}},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words;var n=e.words;var i=this.sigBytes;var r=e.sigBytes;this.clamp();if(i%4){for(var a=0;a<r;a++){var o=n[a>>>2]>>>24-a%4*8&255;t[i+a>>>2]|=o<<24-(i+a)%4*8}}else if(n.length>65535){for(var a=0;a<r;a+=4){t[i+a>>>2]=n[a>>>2]}}else{t.push.apply(t,n)}this.sigBytes+=r;return this},clamp:function(){var t=this.words;var n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8;t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){var n=[];for(var i=0;i<t;i+=4){n.push(e.random()*4294967296|0)}return new a.init(n,t)}});var o=n.enc={};var s=o.Hex={stringify:function(e){var t=e.words;var n=e.sigBytes;var i=[];for(var r=0;r<n;r++){var a=t[r>>>2]>>>24-r%4*8&255;i.push((a>>>4).toString(16));i.push((a&15).toString(16))}return i.join("")},parse:function(e){var t=e.length;var n=[];for(var i=0;i<t;i+=2){n[i>>>3]|=parseInt(e.substr(i,2),16)<<24-i%8*4}return new a.init(n,t/2)}};var l=o.Latin1={stringify:function(e){var t=e.words;var n=e.sigBytes;var i=[];for(var r=0;r<n;r++){var a=t[r>>>2]>>>24-r%4*8&255;i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){var t=e.length;var n=[];for(var i=0;i<t;i++){n[i>>>2]|=(e.charCodeAt(i)&255)<<24-i%4*8}return new a.init(n,t)}};var u=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}};var c=i.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(e){if(typeof e=="string"){e=u.parse(e)}this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data;var i=n.words;var r=n.sigBytes;var o=this.blockSize;var s=o*4;var l=r/s;if(t){l=e.ceil(l)}else{l=e.max((l|0)-this._minBufferSize,0)}var u=l*o;var c=e.min(u*4,r);if(u){for(var d=0;d<u;d+=o){this._doProcessBlock(i,d)}var h=i.splice(0,u);n.sigBytes-=c}return new a.init(h,c)},clone:function(){var e=r.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0});var d=i.Hasher=c.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){if(e){this._append(e)}var t=this._doFinalize();return t},blockSize:512/32,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);e.CryptoJS=t})(Streak);(function(e,t){var n=t.CryptoJS;var i=n.lib;var r=i.WordArray;var a=i.Hasher;var o=n.algo;var s=[];(function(){for(var t=0;t<64;t++){s[t]=e.abs(e.sin(t+1))*4294967296|0}})();var l=o.MD5=a.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var i=t+n;var r=e[i];e[i]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360}var a=this._hash.words;var o=e[t+0];var l=e[t+1];var f=e[t+2];var p=e[t+3];var m=e[t+4];var _=e[t+5];var g=e[t+6];var v=e[t+7];var y=e[t+8];var w=e[t+9];var b=e[t+10];var C=e[t+11];var S=e[t+12];var T=e[t+13];var x=e[t+14];var k=e[t+15];var M=a[0];var L=a[1];var B=a[2];var E=a[3];M=u(M,L,B,E,o,7,s[0]);E=u(E,M,L,B,l,12,s[1]);B=u(B,E,M,L,f,17,s[2]);L=u(L,B,E,M,p,22,s[3]);M=u(M,L,B,E,m,7,s[4]);E=u(E,M,L,B,_,12,s[5]);B=u(B,E,M,L,g,17,s[6]);L=u(L,B,E,M,v,22,s[7]);M=u(M,L,B,E,y,7,s[8]);E=u(E,M,L,B,w,12,s[9]);B=u(B,E,M,L,b,17,s[10]);
L=u(L,B,E,M,C,22,s[11]);M=u(M,L,B,E,S,7,s[12]);E=u(E,M,L,B,T,12,s[13]);B=u(B,E,M,L,x,17,s[14]);L=u(L,B,E,M,k,22,s[15]);M=c(M,L,B,E,l,5,s[16]);E=c(E,M,L,B,g,9,s[17]);B=c(B,E,M,L,C,14,s[18]);L=c(L,B,E,M,o,20,s[19]);M=c(M,L,B,E,_,5,s[20]);E=c(E,M,L,B,b,9,s[21]);B=c(B,E,M,L,k,14,s[22]);L=c(L,B,E,M,m,20,s[23]);M=c(M,L,B,E,w,5,s[24]);E=c(E,M,L,B,x,9,s[25]);B=c(B,E,M,L,p,14,s[26]);L=c(L,B,E,M,y,20,s[27]);M=c(M,L,B,E,T,5,s[28]);E=c(E,M,L,B,f,9,s[29]);B=c(B,E,M,L,v,14,s[30]);L=c(L,B,E,M,S,20,s[31]);M=d(M,L,B,E,_,4,s[32]);E=d(E,M,L,B,y,11,s[33]);B=d(B,E,M,L,C,16,s[34]);L=d(L,B,E,M,x,23,s[35]);M=d(M,L,B,E,l,4,s[36]);E=d(E,M,L,B,m,11,s[37]);B=d(B,E,M,L,v,16,s[38]);L=d(L,B,E,M,b,23,s[39]);M=d(M,L,B,E,T,4,s[40]);E=d(E,M,L,B,o,11,s[41]);B=d(B,E,M,L,p,16,s[42]);L=d(L,B,E,M,g,23,s[43]);M=d(M,L,B,E,w,4,s[44]);E=d(E,M,L,B,S,11,s[45]);B=d(B,E,M,L,k,16,s[46]);L=d(L,B,E,M,f,23,s[47]);M=h(M,L,B,E,o,6,s[48]);E=h(E,M,L,B,v,10,s[49]);B=h(B,E,M,L,x,15,s[50]);L=h(L,B,E,M,_,21,s[51]);M=h(M,L,B,E,S,6,s[52]);E=h(E,M,L,B,p,10,s[53]);B=h(B,E,M,L,b,15,s[54]);L=h(L,B,E,M,l,21,s[55]);M=h(M,L,B,E,y,6,s[56]);E=h(E,M,L,B,k,10,s[57]);B=h(B,E,M,L,g,15,s[58]);L=h(L,B,E,M,T,21,s[59]);M=h(M,L,B,E,m,6,s[60]);E=h(E,M,L,B,C,10,s[61]);B=h(B,E,M,L,f,15,s[62]);L=h(L,B,E,M,w,21,s[63]);a[0]=a[0]+M|0;a[1]=a[1]+L|0;a[2]=a[2]+B|0;a[3]=a[3]+E|0},_doFinalize:function(){var t=this._data;var n=t.words;var i=this._nDataBytes*8;var r=t.sigBytes*8;n[r>>>5]|=128<<24-r%32;var a=e.floor(i/4294967296);var o=i;n[(r+64>>>9<<4)+15]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;n[(r+64>>>9<<4)+14]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360;t.sigBytes=(n.length+1)*4;this._process();var s=this._hash;var l=s.words;for(var u=0;u<4;u++){var c=l[u];l[u]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360}return s},clone:function(){var e=a.clone.call(this);e._hash=this._hash.clone();return e}});function u(e,t,n,i,r,a,o){var s=e+(t&n|~t&i)+r+o;return(s<<a|s>>>32-a)+t}function c(e,t,n,i,r,a,o){var s=e+(t&i|n&~i)+r+o;return(s<<a|s>>>32-a)+t}function d(e,t,n,i,r,a,o){var s=e+(t^n^i)+r+o;return(s<<a|s>>>32-a)+t}function h(e,t,n,i,r,a,o){var s=e+(n^(t|~i))+r+o;return(s<<a|s>>>32-a)+t}n.MD5=a._createHelper(l);n.HmacMD5=a._createHmacHelper(l)})(Math,Streak);(function(e){var t={addRule:function(t){var n=e.document.styleSheets;var i=null;var r=null;if(n.length==0){var a=a=document.head||document.getElementsByTagName("head")[0];var o=document.createElement("style");o.type="text/css";a.appendChild(o);n=e.document.styleSheets}for(var s=0;s<n.length;s++){try{r=n[s];i=r.insertRule(t,0);break}catch(l){}}return{stylesheet:r,rule:i,destroy:function(){r.removeRule(t)}}}};e.CSSStyleManipulator=t})(Streak);(function(e){var t=",";var n=",".charCodeAt(0);e.csvParser={parse:function(t,n){var i;return this.parseRows(t,function(t,r){if(i)return i(t,r-1);var a=e.newFunction("d","return {"+t.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=n?function(e,t){return n(a(e),t)}:a})},parseRows:function(e,t){var i={},r={},a=[],o=e.length,s=0,l=0,u,c;function d(){if(s>=o)return r;if(c)return c=false,i;var t=s;if(e.charCodeAt(t)===34){var a=t;while(a++<o){if(e.charCodeAt(a)===34){if(e.charCodeAt(a+1)!==34)break;++a}}s=a+2;var l=e.charCodeAt(a+1);if(l===13){c=true;if(e.charCodeAt(a+2)===10)++s}else if(l===10){c=true}return e.substring(t+1,a).replace(/""/g,'"')}while(s<o){var l=e.charCodeAt(s++),u=1;if(l===10)c=true;else if(l===13){c=true;if(e.charCodeAt(s)===10)++s,++u}else if(l!==n)continue;return e.substring(t,s-u)}return e.substring(t)}while((u=d())!==r){var h=[];while(u!==i&&u!==r){h.push(u);u=d()}if(t&&!(h=t(h,l++)))continue;a.push(h)}return a}}})(Streak);(function(e){var t=e.Date;var n=Object,i=Array,r=RegExp,a=t,o=String,s=Number,l=Math,u;var c=n.prototype.toString;var d=typeof global!=="undefined"?global:this;var h={};var f=n.defineProperty&&n.defineProperties;var p="Array,Boolean,Date,Function,Number,String,RegExp".split(",");var m=C(p[0]);var _=C(p[1]);var g=C(p[2]);var v=C(p[3]);var y=C(p[4]);var w=C(p[5]);var b=C(p[6]);function C(e){var t,n;if(/String|Number|Boolean/.test(e)){t=e.toLowerCase()}n=e==="Array"&&i.isArray||function(n){if(t&&typeof n===t){return true}return S(n)==="[object "+e+"]"};h[e]=n;return n}function S(e){return c.call(e)}function T(){x(n);x(a);N(p,function(e,t){x(d[t])})}function x(e){if(e["SugarMethods"])return;E(e,"SugarMethods",{});k(e,false,false,{extend:function(t,n,i){k(e,i!==false,n,t)},sugarRestore:function(){return L(e,arguments,function(e,t,n){E(e,t,n.method)})},sugarRevert:function(){return L(e,arguments,function(e,t,n){if(n.existed){E(e,t,n.original)}else{delete e[t]}})}})}function k(e,t,n,i){var r=t?e.prototype:e;x(e);N(i,function(i,a){var o=r[i];var s=R(r,i);if(typeof n==="function"){a=B(r[i],a,n)}if(n!==false||!r[i]){E(r,i,a)}e["SugarMethods"][i]={instance:t,method:a,original:o,existed:s}})}function M(e,t,n,i,r){var a={};i=w(i)?i.split(","):i;i.forEach(function(e,t){r(a,e,t)});k(e,t,n,a)}function L(e,t,n){var i=t.length===0,r=D(t),a=false;N(e["SugarMethods"],function(t,o){if(i||r.indexOf(t)>-1){a=true;n(o.instance?e.prototype:e,t,o)}});return a}function B(e,t,n){return function(){var i;if(e&&(n===true||!n.apply(this,arguments))){i=e}else{i=t}return i.apply(this,arguments)}}function E(e,t,i){if(f){n.defineProperty(e,t,{value:i,configurable:true,enumerable:false,writable:true})}else{e[t]=i}}function D(e,t){var n=[],i,r;for(i=0,r=e.length;i<r;i++){n.push(e[i]);if(t)t.call(e,e[i],i)}return n}function V(e,t,n){D(i.prototype.concat.apply([],i.prototype.slice.call(e,n||0)),t)}function I(e){if(!e||!e.call){throw new TypeError("Callback is not callable")}}function P(e){return e!==u}function A(e){return e===u}function F(e){return e&&typeof e==="object"}function O(e){return!!e&&S(e)==="[object Object]"&&"hasOwnProperty"in e}function R(e,t){return n["hasOwnProperty"].call(e,t)}function N(e,t){var n;for(n in e){if(!R(e,n))continue;if(t.call(e,n,e[n],e)===false)break}}function H(e,t){N(t,function(n){e[n]=t[n]});return e}function j(e){H(this,e)}j.prototype.constructor=n;function U(e,t,n,i){var r=[],a=parseInt(e),o=i<0;while(!o&&a<=t||o&&a>=t){r.push(a);if(n)n.call(this,a);a+=i||1}return r}function G(e,t,n){var i=l[n||"round"];var r=l.pow(10,l.abs(t||0));if(t<0)r=1/r;return i(e*r)/r}function W(e,t){return G(e,t,"ceil")}function K(e,t){return G(e,t,"floor")}function z(e,t,n,i){var r=l.abs(e).toString(i||10);r=Q(t-r.replace(/\.\d+/,"").length,"0")+r;if(n||e<0){r=(e<0?"-":"+")+r}return r}function Y(e){if(e>=11&&e<=13){return"th"}else{switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}}function q(){return"	\n\f\r   ᠎             \u2028\u2029　﻿"}function Q(e,t){return i(l.max(0,P(e)?e:1)+1).join(t||"")}function J(e,t){var n=e.toString().match(/[^/]*$/)[0];if(t){n=(n+t).split("").sort().join("").replace(/([gimy])\1+/g,"$1")}return n}function $(e){if(!w(e))e=o(e);return e.replace(/([\\/'*+?|()\[\]{}.^$])/g,"\\$1")}function X(e,t){var i=typeof e,r,a,s,l,u,d,h,f;if(i==="string")return e;s=c.call(e);r=O(e);a=s==="[object Array]";if(e!=null&&r||a){if(!t)t=[];if(t.length>1){h=t.length;while(h--){if(t[h]===e){return"CYC"}}}t.push(e);l=o(e.constructor);u=a?e:n.keys(e).sort();for(h=0,f=u.length;h<f;h++){d=a?h:u[h];l+=d+X(e[d],t)}t.pop()}else if(1/e===-Infinity){l="-0"}else{l=o(e&&e.valueOf?e.valueOf():e)}return i+s+l}function Z(e,t){if(et(e)&&et(t)){return X(e)===X(t)}else{return e===t}}function et(e){var t=S(e);return/^\[object Date|Array|String|Number|RegExp|Boolean|Arguments\]$/.test(t)||O(e)}function tt(e,t,n){var i=[],r=e.length,a=t[t.length-1]!==false,o;D(t,function(t){if(_(t))return false;if(a){t=t%r;if(t<0)t=r+t}o=n?e.charAt(t)||"":e[t];i.push(o)});return i.length<2?i[0]:i}function nt(e,t){M(t,true,false,e,function(e,t){e[t+(t==="equal"?"s":"")]=function(){return n[t].apply(null,[this].concat(D(arguments)))}})}T();function it(e,t,n,i){var a=true;if(e===t){return true}else if(b(t)&&w(e)){return r(t).test(e)}else if(v(t)){return t.apply(n,i)}else if(O(t)&&F(e)){N(t,function(i,r){if(!it(e[i],t[i],n,[e[i],e])){a=false}});return a}else{return Z(e,t)}}function rt(e,t,n,i){if(A(t)){return e}else if(v(t)){return t.apply(n,i||[])}else if(v(e[t])){return e[t].call(e)}else{return e[t]}}function at(e,t,n,i){var r,a,o;if(n<0)n=e.length+n;o=isNaN(n)?0:n;r=i===true?e.length+o:e.length;while(o<r){a=o%e.length;if(!(a in e)){return ot(e,t,o,i)}else if(t.call(e,e[a],a,e)===false){break}o++}}function ot(e,t,n,i){var r=[],a;for(a in e){if(st(e,a)&&a>=n){r.push(parseInt(a))}}r.sort().each(function(n){return t.call(e,e[n],n,e)});return e}function st(e,t){return t in e&&lt(t)==t&&t!=4294967295}function lt(e){return e>>>0}function ut(e,t,n,i,r){var a,o;at(e,function(e,n,i){if(it(e,t,i,[e,n,i])){a=e;o=n;return false}},n,i);return r?o:a}function ct(e,t){var n=[],i={},r;at(e,function(a,o){r=t?rt(a,t,e,[a,o,e]):a;if(!mt(i,r)){n.push(a)}});return n}function dt(e,t,n){var i=[],r={};t.each(function(e){mt(r,e)});e.each(function(e){var t=X(e),a=!et(e);if(pt(r,t,e,a)!=n){_t(r,t,e,a);i.push(e)}});return i}function ht(e,t,n){t=t||Infinity;n=n||0;var i=[];at(e,function(e){if(m(e)&&n<t){i=i.concat(ht(e,t,n+1))}else{i.push(e)}});return i}function ft(e){var t=[];D(e,function(e){t=t.concat(e)});return t}function pt(e,t,n,i){var r=t in e;if(i){if(!e[t]){e[t]=[]}r=e[t].indexOf(n)!==-1}return r}function mt(e,t){var n=X(t),i=!et(t),r=pt(e,n,t,i);if(i){e[n].push(t)}else{e[n]=t}return r}function _t(e,t,n,i){var r,a=0;if(i){r=e[t];while(a<r.length){if(r[a]===n){r.splice(a,1)}else{a+=1}}}else{delete e[t]}}function gt(e,t,n,i){var r,a=[],o=n==="max",s=n==="min",l=Array.isArray(e);N(e,function(n){var i=e[n],u=rt(i,t,e,l?[i,parseInt(n),e]:[]);if(A(u)){throw new TypeError("Cannot compare with undefined")}if(u===r){a.push(i)}else if(A(r)||o&&u>r||s&&u<r){a=[i];r=u}});if(!l)a=ht(a,1);return i?a:a[0]}function vt(e,t){var n,i,r,a,o,s,l=0,u=0;e=yt(e);t=yt(t);do{r=wt(e,l);a=wt(t,l);n=bt(r);i=bt(a);if(n===-1||i===-1){n=e.charCodeAt(l)||null;i=t.charCodeAt(l)||null}o=r!==e.charAt(l);s=a!==t.charAt(l);if(o!==s&&u===0){u=o-s}l+=1}while(n!=null&&i!=null&&n===i);if(n===i)return u;return n<i?-1:1}function yt(e){if(i[Tt]){e=e.toLowerCase()}return e.replace(i[St],"")}function wt(e,t){var n=e.charAt(t),r=i[xt]||{};return r[n]||n}function bt(e){var t=i[Ct];if(!e){return null}else{return t.indexOf(e)}}var Ct="AlphanumericSortOrder";var St="AlphanumericSortIgnore";var Tt="AlphanumericSortIgnoreCase";var xt="AlphanumericSortEquivalents";function kt(){var e=function(){var e=arguments;return e.length>0&&!v(e[0])};M(i,true,e,"map,every,all,some,any,none,filter",function(e,t){e[t]=function(e){return this[t](function(n,i){if(t==="map"){return rt(n,e,this,[n,i,this])}else{return it(n,e,this,[n,i,this])}})}})}function Mt(){var e="AÁÀÂÃĄBCĆČÇDĎÐEÉÈĚÊËĘFGĞHıIÍÌİÎÏJKLŁMNŃŇÑOÓÒÔPQRŘSŚŠŞTŤUÚÙŮÛÜVWXYÝZŹŻŽÞÆŒØÕÅÄÖ";var t="AÁÀÂÃÄ,CÇ,EÉÈÊË,IÍÌİÎÏ,OÓÒÔÕÖ,Sß,UÚÙÛÜ";i[Ct]=e.split("").map(function(e){return e+e.toLowerCase()}).join("");var n={};at(t.split(","),function(e){var t=e.charAt(0);at(e.slice(1).split(""),function(e){n[e]=t;n[e.toLowerCase()]=t.toLowerCase()})});i[Tt]=true;i[xt]=n}k(i,false,false,{create:function(){var e=[],t;D(arguments,function(n){if(F(n)){try{t=i.prototype.slice.call(n,0);if(t.length>0){n=t}}catch(r){}}e=e.concat(n)});return e}});k(i,true,false,{find:function(e,t,n){return ut(this,e,t,n)},findAll:function(e,t,n){var i=[];at(this,function(t,n,r){if(it(t,e,r,[t,n,r])){i.push(t)}},t,n);return i},findIndex:function(e,t,n){var i=ut(this,e,t,n,true);return A(i)?-1:i},count:function(e){if(A(e))return this.length;return this.findAll(e).length},removeAt:function(e,t){var n,i;if(A(e))return this;if(A(t))t=e;for(n=0,i=t-e;n<=i;n++){this.splice(e,1)}return this},include:function(e,t){return this.clone().add(e,t)},exclude:function(){return i.prototype.remove.apply(this.clone(),arguments)},clone:function(){return H([],this)},unique:function(e){return ct(this,e)},flatten:function(e){return ht(this,e)},union:function(){return ct(this.concat(ft(arguments)))},intersect:function(){return dt(this,ft(arguments),false)},subtract:function(e){return dt(this,ft(arguments),true)},at:function(){return tt(this,arguments)},first:function(e){if(A(e))return this[0];if(e<0)e=0;return this.slice(0,e)},last:function(e){if(A(e))return this[this.length-1];var t=this.length-e<0?0:this.length-e;return this.slice(t)},from:function(e){return this.slice(e)},to:function(e){if(A(e))e=this.length;return this.slice(0,e)},min:function(e,t){return gt(this,e,"min",t)},max:function(e,t){return gt(this,e,"max",t)},least:function(e,t){return gt(this.groupBy.apply(this,[e]),"length","min",t)},most:function(e,t){return gt(this.groupBy.apply(this,[e]),"length","max",t)},sum:function(e){var t=e?this.map(e):this;return t.length>0?t.reduce(function(e,t){return e+t}):0},average:function(e){var t=e?this.map(e):this;return t.length>0?t.sum()/t.length:0},inGroups:function(e,t){var n=arguments.length>1;var i=this;var r=[];var a=W(this.length/e);U(0,e-1,function(e){var o=e*a;var s=i.slice(o,o+a);if(n&&s.length<a){U(1,a-s.length,function(){s=s.add(t)})}r.push(s)});return r},inGroupsOf:function(e,t){var n=[],i=this.length,r=this,a;if(i===0||e===0)return r;if(A(e))e=1;if(A(t))t=null;U(0,W(i/e)-1,function(i){a=r.slice(e*i,e*i+e);while(a.length<e){a.push(t)}n.push(a)});return n},isEmpty:function(){return this.compact().length==0},sortBy:function(e,t){var n=this.clone();n.sort(function(i,r){var a,o,s;a=rt(i,e,n,[i]);o=rt(r,e,n,[r]);if(w(a)&&w(o)){s=vt(a,o)}else if(a<o){s=-1}else if(a>o){s=1}else{s=0}return s*(t?-1:1)});return n},randomize:function(){var e=this.concat(),t=e.length,n,i;while(t){n=l.random()*t|0;i=e[--t];e[t]=e[n];e[n]=i}return e},zip:function(){var e=D(arguments);return this.map(function(t,n){return[t].concat(e.map(function(e){return n in e?e[n]:null}))})},sample:function(e){var t=this.randomize();return arguments.length>0?t.slice(0,e):t[0]},each:function(e,t,n){at(this,e,t,n);return this},add:function(e,t){if(!y(s(t))||isNaN(t))t=this.length;i.prototype.splice.apply(this,[t,0].concat(e));return this},remove:function(){var e,t=this;D(arguments,function(n){e=0;while(e<t.length){if(it(t[e],n,t,[t[e],e,t])){t.splice(e,1)}else{e++}}});return t},compact:function(e){var t=[];at(this,function(n,i){if(m(n)){t.push(n.compact())}else if(e&&n){t.push(n)}else if(!e&&n!=null&&n.valueOf()===n.valueOf()){t.push(n)}});return t},groupBy:function(e,t){var n=this,i={},r;at(n,function(t,a){r=rt(t,e,n,[t,a,n]);if(!i[r])i[r]=[];i[r].push(t)});if(t){N(i,t)}return i},none:function(){return!this.any.apply(this,arguments)}});k(i,true,false,{all:i.prototype.every,any:i.prototype.some,insert:i.prototype.add});function Lt(e){if(e&&e.valueOf){e=e.valueOf()}return n.keys(e)}function Bt(e,t){M(n,false,false,e,function(e,n){e[n]=function(e,r,a){var o,s=Lt(e);o=i.prototype[n].call(s,function(n){if(t){return rt(e[n],r,e,[n,e[n],e])}else{return it(e[n],r,e,[n,e[n],e])}},a);if(m(o)){o=o.reduce(function(t,n,i){t[n]=e[n];return t},{})}return o}});nt(e,j)}k(n,false,false,{map:function(e,t){return Lt(e).reduce(function(n,i){n[i]=rt(e[i],t,e,[i,e[i],e]);return n},{})},reduce:function(e){var t=Lt(e).map(function(t){return e[t]});return t.reduce.apply(t,D(arguments).slice(1))},each:function(e,t){I(t);N(e,t);return e},size:function(e){return Lt(e).length}});var Et="any,all,none,count,find,findAll,isEmpty".split(",");var Dt="sum,average,min,max,least,most".split(",");var Vt="map,reduce,size".split(",");var It=Et.concat(Dt).concat(Vt);kt();Mt();Bt(Et);Bt(Dt,true);nt(Vt,j);var Pt;var At;var Ft=["ampm","hour","minute","second","ampm","utc","offset_sign","offset_hours","offset_minutes","ampm"];var Ot="(?:[,.]\\d+)?";var Rt="\\d{1,2}"+Ot;var Nt="[0-5]\\d"+Ot;var Ht="({t})?\\s*("+Rt+")(?:{h}("+Nt+")?{m}(?::?("+Nt+"){s})?\\s*(?:({t})|(Z)|(?:([+-])(\\d{2,2})(?::?(\\d{2,2}))?)?)?|\\s*({t}))";var jt="〇一二三四五六七八九十百千万";var Ut="０１２３４５６７８９";var Gt={};var Wt;var Kt;var zt;var Yt=[];var qt=[{token:"f{1,4}|ms|milliseconds",format:function(e){return yn(e,"Milliseconds")}},{token:"ss?|seconds",format:function(e,t){return yn(e,"Seconds")}},{token:"mm?|minutes",format:function(e,t){return yn(e,"Minutes")}},{token:"hh?|hours|12hr",format:function(e){return dn(e)}},{token:"HH?|24hr",format:function(e){return yn(e,"Hours")}},{token:"dd?|date|day",format:function(e){return yn(e,"Date")}},{token:"dow|weekday",word:true,format:function(e,t,n,i){var r=yn(e,"Day");return t["weekdays"][r+(n-1)*7]}},{token:"MM?",format:function(e){return yn(e,"Month")+1}},{token:"mon|month",word:true,format:function(e,t,n,i){var r=yn(e,"Month");return t["months"][r+(n-1)*12]}},{token:"y{2,4}|year",format:function(e){return yn(e,"FullYear")}},{token:"[Tt]{1,2}",format:function(e,t,n,i){if(t["ampm"].length==0)return"";var r=yn(e,"Hours");var a=t["ampm"][K(r/12)];if(i.length===1)a=a.slice(0,1);if(i.slice(0,1)==="T")a=a.toUpperCase();return a}},{token:"z{1,4}|tz|timezone",text:true,format:function(e,t,n,i){var r=e.getUTCOffset();if(i=="z"||i=="zz"){r=r.replace(/(\d{2})(\d{2})/,function(e,t,n){return z(t,i.length)})}return r}},{token:"iso(tz|timezone)",format:function(e){return e.getUTCOffset(true)}},{token:"ord",format:function(e){var t=yn(e,"Date");return t+Y(t)}}];var Qt=[{unit:"year",method:"FullYear",ambiguous:true,multiplier:function(e){var t=e?e.isLeapYear()?1:0:.25;return(365+t)*24*60*60*1e3}},{unit:"month",method:"Month",ambiguous:true,multiplier:function(e,t){var n=30.4375,i;if(e){i=e.daysInMonth();if(t<=i.days()){n=i}}return n*24*60*60*1e3},error:.919},{unit:"week",method:"ISOWeek",multiplier:function(){return 7*24*60*60*1e3}},{unit:"day",method:"Date",ambiguous:true,multiplier:function(){return 24*60*60*1e3}},{unit:"hour",method:"Hours",multiplier:function(){return 60*60*1e3}},{unit:"minute",method:"Minutes",multiplier:function(){return 60*1e3}},{unit:"second",method:"Seconds",multiplier:function(){return 1e3}},{unit:"millisecond",method:"Milliseconds",multiplier:function(){return 1}}];var Jt={};function $t(e){H(this,e);this.compiledFormats=Yt.concat()}$t.prototype={getMonth:function(e){if(y(e)){return e-1}else{return this["months"].indexOf(e)%12}},getWeekday:function(e){return this["weekdays"].indexOf(e)%7},getNumber:function(e){var t;if(y(e)){return e}else if(e&&(t=this["numbers"].indexOf(e))!==-1){var n=(t+1)%10;if(n===0&&t!==0){return 10}return(t+1)%10}else{return 1}},getNumericDate:function(e){var t=this;return e.replace(r(this["num"],"g"),function(e){var n=t.getNumber(e);return n||""})},getEnglishUnit:function(e){return Pt["units"][this["units"].indexOf(e)%8]},getRelativeFormat:function(e){return this.convertAdjustedToFormat(e,e[2]>0?"future":"past")},getDuration:function(e){return this.convertAdjustedToFormat(fn(e),"duration")},hasVariant:function(e){e=e||this.code;return e==="en"||e==="en-US"?true:this["variant"]},matchAM:function(e){return e===this["ampm"][0]},matchPM:function(e){return e&&e===this["ampm"][1]},convertAdjustedToFormat:function(e,t){var n,i,r,a=e[0],o=e[1],s=e[2],l=this[t]||this["relative"];if(v(l)){return l.call(this,a,o,s,t)}r=this["plural"]&&a>1?1:0;i=this["units"][r*8+o]||this["units"][o];if(this["capitalizeUnit"])i=tn(i);n=this["modifiers"].filter(function(e){return e.name=="sign"&&e.value==(s>0?1:-1)})[0];return l.replace(/\{(.*?)\}/g,function(e,t){switch(t){case"num":return a;case"unit":return i;case"sign":return n.src}})},getFormats:function(){return this.cachedFormat?[this.cachedFormat].concat(this.compiledFormats):this.compiledFormats},addFormat:function(e,t,n,i,r){var a=n||[],o=this,s,l,u;e=e.replace(/\s+/g,"[-,. ]*");e=e.replace(/\{([^,]+?)\}/g,function(e,t){var i,r,s,l=t.match(/\?$/),u=t.match(/^(\d+)\??$/),c=t.match(/(\d)(?:-(\d))?/),d=t.replace(/[^a-z]+$/,"");if(u){i=o["tokens"][u[1]]}else if(o[d]){i=o[d]}else if(o[d+"s"]){i=o[d+"s"];if(c){r=[];i.forEach(function(e,t){var n=t%(o["units"]?8:i.length);if(n>=c[1]&&n<=(c[2]||c[1])){r.push(e)}});i=r}i=nn(i)}if(u){s="(?:"+i+")"}else{if(!n){a.push(d)}s="("+i+")"}if(l){s+="?"}return s});if(t){s=bn(Ht,o,r);l=["t","[\\s\\u3000]"].concat(o["timeMarker"]);u=e.match(/\\d\{\d,\d\}\)+\??$/);en(o,"(?:"+s+")[,\\s\\u3000]+?"+e,Ft.concat(a),i);en(o,e+"(?:[,\\s]*(?:"+l.join("|")+(u?"+":"*")+")"+s+")?",a.concat(Ft),i)}else{en(o,e,a,i)}}};function Xt(e,t){var n;if(!w(e))e="";n=Jt[e]||Jt[e.slice(0,2)];if(t===false&&!n){throw new Error("Invalid locale.")}return n||At}function Zt(e,t){var n,i;function r(e){var t=n[e];if(w(t)){n[e]=t.split(",")}else if(!t){n[e]=[]}}function a(e,t){e=e.split("+").map(function(e){return e.replace(/(.+):(.+)$/,function(e,t,n){return n.split("|").map(function(e){return t+e}).join("|")})}).join("|");return e.split("|").forEach(t)}function o(e,t,i){var r=[];n[e].forEach(function(e,n){if(t){e+="+"+e.slice(0,3)}a(e,function(e,t){r[t*i+n]=e.toLowerCase()})});n[e]=r}function s(e,t,i){var r="\\d{"+e+","+t+"}";if(i)r+="|(?:"+nn(n["numbers"])+")+";return r}function l(){var e=["\\d+"].concat(n["articles"]);if(n["numbers"])e=e.concat(n["numbers"]);return nn(e)}function u(e,t){n[e]=n[e]||t}function c(){var e=[];n.modifiersByName={};n["modifiers"].push({name:"day",src:"yesterday",value:-1});n["modifiers"].push({name:"day",src:"today",value:0});n["modifiers"].push({name:"day",src:"tonight",value:0});n["modifiers"].push({name:"day",src:"tomorrow",value:1});n["modifiers"].forEach(function(t){var i=t.name;a(t.src,function(r){var a=n[i];n.modifiersByName[r]=t;e.push({name:i,src:r,value:t.value});n[i]=a?a+"|"+r:r})});n["day"]+="|"+nn(n["weekdays"]);n["modifiers"]=e}n=new $t(t);r("modifiers");"months,weekdays,units,numbers,articles,tokens,timeMarker,ampm,timeSuffixes,dateParse,timeParse".split(",").forEach(r);i=!n["monthSuffix"];o("months",i,12);o("weekdays",i,7);o("units",false,8);o("numbers",false,10);u("code",e);u("date",s(1,2,n["digitDate"]));u("year","'\\d{2}|"+s(4,4));u("num",l());c();if(n["monthSuffix"]){n["month"]=s(1,2);n["months"]=U(1,12).map(function(e){return e+n["monthSuffix"]})}n["full_month"]=s(1,2)+"|"+nn(n["months"]);if(n["timeSuffixes"].length>0){n.addFormat(bn(Ht,n),false,Ft)}n.addFormat("{day}",true);n.addFormat("{month}"+(n["monthSuffix"]||""));n.addFormat("{year}"+(n["yearSuffix"]||""));n["timeParse"].forEach(function(e){n.addFormat(e,true)});n["dateParse"].forEach(function(e){n.addFormat(e)});return Jt[e]=n}function en(e,t,n,i){e.compiledFormats.unshift({variant:i,locale:e,reg:r("^"+t+"$","i"),to:n})}function tn(e){return e.slice(0,1).toUpperCase()+e.slice(1)}function nn(e){return e.filter(function(e){return!!e}).join("|")}function rn(e,t){var n,i;if(O(e[0])){return e}else if(y(e[0])&&!y(e[1])){return[e[0]]}else if(w(e[0])&&t){return[an(e[0]),e[1]]}n={};Kt.forEach(function(t,i){n[t.unit]=e[i]});return[n]}function an(e,t){var n={};match=e.match(/^(\d+)?\s?(\w+?)s?$/i);if(match){if(A(t)){t=parseInt(match[1])||1}n[match[2].toLowerCase()]=t}return n}function on(e,t){var n={},i,r;t.forEach(function(t,a){i=e[a+1];if(A(i)||i==="")return;if(t==="year"){n.yearAsString=i.replace(/'/,"")}r=parseFloat(i.replace(/'/,"").replace(/,/,"."));n[t]=!isNaN(r)?r:i.toLowerCase()});return n}function sn(e){e=e.trim().replace(/^just (?=now)|\.+$/i,"");return ln(e)}function ln(e){return e.replace(Wt,function(e,t,n){var i=0,r=1,a,o;if(t)return e;n.split("").reverse().forEach(function(e){var t=Gt[e],n=t>9;if(n){if(a)i+=r;r*=t/(o||1);o=t}else{if(a===false){r*=10}i+=r*t}a=n});if(a)i+=r;return i})}function un(e,t,n,i){var r=new a,o=false,s=false,l,u,c,d,h,f,p,m,_;r.utc(i);if(g(e)){r.utc(e.isUTC()).setTime(e.getTime())}else if(y(e)){r.setTime(e)}else if(O(e)){r.set(e,true);d=e}else if(w(e)){l=Xt(t);e=sn(e);if(l){N(l.getFormats(),function(n,i){var a=e.match(i.reg);if(a){c=i;u=c.locale;d=on(a,c.to,u);if(d["utc"]){r.utc()}u.cachedFormat=c;if(d.timestamp){d=d.timestamp;return false}if(c.variant&&!w(d["month"])&&(w(d["date"])||l.hasVariant(t))){m=d["month"];d["month"]=d["date"];d["date"]=m}if(d["year"]&&d.yearAsString.length===2){d["year"]=cn(d["year"])}if(d["month"]){d["month"]=u.getMonth(d["month"]);if(d["shift"]&&!d["unit"])d["unit"]=u["units"][7]}if(d["weekday"]&&d["date"]){delete d["weekday"]}else if(d["weekday"]){d["weekday"]=u.getWeekday(d["weekday"]);if(d["shift"]&&!d["unit"])d["unit"]=u["units"][5]}if(d["day"]&&(m=u.modifiersByName[d["day"]])){d["day"]=m.value;r.reset();o=true}else if(d["day"]&&(f=u.getWeekday(d["day"]))>-1){delete d["day"];if(d["num"]&&d["month"]){_=function(){var e=r.getWeekday();r.setWeekday(7*(d["num"]-1)+(e>f?f+7:f))};d["day"]=1}else{d["weekday"]=f}}if(d["date"]&&!y(d["date"])){d["date"]=u.getNumericDate(d["date"])}if(u.matchPM(d["ampm"])&&d["hour"]<12){d["hour"]+=12}else if(u.matchAM(d["ampm"])&&d["hour"]===12){d["hour"]=0}if("offset_hours"in d||"offset_minutes"in d){r.utc();d["offset_minutes"]=d["offset_minutes"]||0;d["offset_minutes"]+=d["offset_hours"]*60;if(d["offset_sign"]==="-"){d["offset_minutes"]*=-1}d["minute"]-=d["offset_minutes"]}if(d["unit"]){o=true;p=u.getNumber(d["num"]);h=u.getEnglishUnit(d["unit"]);if(d["shift"]||d["edge"]){p*=(m=u.modifiersByName[d["shift"]])?m.value:0;if(h==="month"&&P(d["date"])){r.set({day:d["date"]},true);delete d["date"]}if(h==="year"&&P(d["month"])){r.set({month:d["month"],day:d["date"]},true);delete d["month"];delete d["date"]}}if(d["sign"]&&(m=u.modifiersByName[d["sign"]])){p*=m.value}if(P(d["weekday"])){r.set({weekday:d["weekday"]},true);delete d["weekday"]}d[h]=(d[h]||0)+p;if((h==="day"||h==="week"||h==="month"||h==="year")&&P(d["hour"])){s=true}}else if(d["edge"]&&d["hour"]){s=true}if(d["year_sign"]==="-"){d["year"]*=-1}zt.slice(1,4).forEach(function(e,t){var n=d[e.unit],i=n%1;if(i){d[zt[t].unit]=G(i*(e.unit==="second"?1e3:60));d[e.unit]=K(n)}});return false}})}if(!c){if(e!=="now"){r=new a(e)}if(i){r.addMinutes(-r.getTimezoneOffset())}}else if(o){if(s){r.reset()}r.advance(d)}else{if(r._utc){r.reset()}vn(r,d,true,false,n)}if(d&&d["edge"]){m=u.modifiersByName[d["edge"]];N(zt.slice(4),function(e,t){if(P(d[t.unit])){h=t.unit;return false}});if(h==="year")d.specificity="month";else if(h==="month"||h==="week")d.specificity="day";r[(m.value<0?"endOf":"beginningOf")+tn(h)]();if(m.value===-2)r.reset()}if(s){r.reset();if(P(d["hour"])){r.setHours(d["hour"])}if(P(d["minute"])){r.setMinutes(d["minute"])}if(P(d["second"])){r.setSeconds(d["second"])}}if(r&&r.getTime()&&P(d)){var v=(new a).getWeekday();var f=r.getWeekday();if(P(d["week"])||P(d["weekday"])){if(P(d["shift"])){if((d["shift"]==="this"||d["shift"]==="last")&&d["unit"]==="week"){if(v>f){r.addWeeks(1)}}}else{if(v>f){r.addWeeks(1)}}}}if(_){_()}r.utc(false)}return{date:r,set:d}}function cn(e){return G(yn(new a,"FullYear")/100)*100-G(e/100)*100+e}function dn(e){var t=yn(e,"Hours");return t===0?12:t-K(t/13)*12}function hn(e){e=e.clone();var t=yn(e,"Day")||7;e.addDays(4-t).reset();return 1+K(e.daysSince(e.clone().beginningOfYear())/7)}function fn(e){var t,n=l.abs(e),i=n,r=0;zt.slice(1).forEach(function(e,a){t=K(G(n/e.multiplier()*10)/10);if(t>=1){i=t;r=a+1}});return[i,r,e]}function pn(e){var t=fn(e.millisecondsFromNow());if(t[1]===6){t[0]=l.abs(e.monthsFromNow())}return t}function mn(e,n,i,a){var o,s=Xt(a),l=r(/^[A-Z]/),u,c;if(!e.isValid()){return"Invalid Date"}else if(t[n]){n=t[n]}else if(v(n)){o=pn(e);n=n.apply(e,o.concat(s))}if(!n&&i){o=o||pn(e);if(o[1]===0){o[1]=1;o[0]=1}return s.getRelativeFormat(o)}n=n||"long";n=s[n]||n;qt.forEach(function(t){n=n.replace(r("\\{("+t.token+")(\\d)?\\}",t.word?"i":""),function(n,i,r){var a=t.format(e,s,r||1,i),o=i.length,u=i.match(/^(.)\1+$/);if(t.word){if(o===3)a=a.slice(0,3);if(u||i.match(l))a=tn(a)}else if(u&&!t.text){a=(y(a)?z(a,o):a.toString()).slice(-o)}return a})});return n}function _n(e,t,n,i){var r,a,o,s,l,u,c,d,h=0,f=0,p=0;r=un(t,null,null,i);if(n>0){f=p=n;c=true}if(!r.date.isValid())return false;if(r.set&&r.set.specificity){Qt.forEach(function(t,n){if(t.unit===r.set.specificity){h=t.multiplier(r.date,e-r.date)-1}});d=tn(r.set.specificity);if(r.set["edge"]||r.set["shift"]){r.date["beginningOf"+d]()}if(r.set.specificity==="month"){s=r.date.clone()["endOf"+d]().getTime()}if(!c&&r.set["sign"]&&r.set.specificity!="millisecond"){f=50;p=-50}}a=e.getTime();o=r.date.getTime();s=s||o+h;s=gn(e,o,s);return a>=o-f&&a<=s+p}function gn(e,n,i){var r,a,o,s;r=new t(n);a=new t(i).utc(e.isUTC());if(yn(a,"Hours")!==23){o=r.getTimezoneOffset();s=a.getTimezoneOffset();if(o!==s){i+=(s-o).minutes()}}return i}function vn(e,t,n,i,r){var o,s;function l(e){return P(t[e])?t[e]:t[e+"s"]}function u(e){return P(l(e))}function c(e,t){return u(e)||t&&u("weekday")}function d(){var t=new a;return r===-1&&e>t||r===1&&e<t}if(y(t)&&i){t={milliseconds:t}}else if(y(t)){e.setTime(t);return e}if(P(t["date"])){t["day"]=t["date"]}N(zt,function(i,r){var a=r.unit==="day";if(c(r.unit,a)){t.specificity=r.unit;s=+i;return false}else if(n&&r.unit!=="week"&&(!a||!u("week"))){wn(e,r.method,a?1:0)}});Qt.forEach(function(t,n){var r=t.unit,a=t.method,o=Qt[n-1],s;s=l(r);if(A(s))return;if(i){if(r==="week"){s=s*7;a="Date"}s=s*i+yn(e,a)}else if(r==="month"&&u("day")){wn(e,"Date",15)}wn(e,a,s);if(i&&r==="month"){Cn(e,s)}});if(!i&&!u("day")&&u("weekday")){var o=l("weekday"),h,f;e.setWeekday(o)}if(d()){N(zt.slice(s+1),function(t,n){var i=n.ambiguous||n.unit==="week"&&u("weekday");if(i&&!c(n.unit,n.unit==="day")){e[n.addMethod](r);return false}})}return e}function yn(e,t){return e["get"+(e._utc?"UTC":"")+t]()}function wn(e,t,n){return e["set"+(e._utc&&t!="ISOWeek"?"UTC":"")+t](n)}function bn(e,t,n){var i={h:0,m:1,s:2},r;t=t||Pt;return e.replace(/{([a-z])}/g,function(e,a){var o=[],s=a==="h",l=s&&!n;if(a==="t"){return t["ampm"].join("|")}else{if(s){o.push(":")}if(r=t["timeSuffixes"][i[a]]){o.push(r+"\\s*")}return o.length===0?"":"(?:"+o.join("|")+")"+(l?"":"?")}})}function Cn(e,t){if(t<0){t=t%12+12}if(t%12!=yn(e,"Month")){wn(e,"Date",0)}}function Sn(e,t,n){var i,r;if(y(e[1])){i=rn(e)[0]}else{i=e[0];r=e[1]}return un(i,r,t,n).date}function Tn(){zt=Qt.concat().reverse();Kt=Qt.concat();Kt.splice(2,1)}function xn(){M(a,true,false,Qt,function(e,t,n){var i=t.unit,r=tn(i),o=t.multiplier(),s,u;t.addMethod="add"+r+"s";function c(e){var n=e/o,i=n%1,r=t.error||.999;if(i&&l.abs(i%1)>r){n=G(n)}return parseInt(n)}s=function(e,t){return c(this.getTime()-a.create(e,t).getTime())};u=function(e,t){return c(a.create(e,t).getTime()-this.getTime())};e[i+"sAgo"]=u;e[i+"sUntil"]=u;e[i+"sSince"]=s;e[i+"sFromNow"]=s;e[t.addMethod]=function(e,t){var n={};n[i]=e;return this.advance(n,t)};Vn(t,o);if(n<3){["Last","This","Next"].forEach(function(t){e["is"+t+r]=function(){return this.is(t+" "+i)}})}if(n<4){e["beginningOf"+r]=function(){var e={};switch(i){case"year":e["year"]=yn(this,"FullYear");break;case"month":e["month"]=yn(this,"Month");break;case"day":e["day"]=yn(this,"Date");break;case"week":e["weekday"]=0;break}return this.set(e,true)};e["endOf"+r]=function(){var e={hours:23,minutes:59,seconds:59,milliseconds:999};switch(i){case"year":e["month"]=11;e["day"]=31;break;case"month":e["day"]=this.daysInMonth();break;case"week":e["weekday"]=6;break}return this.set(e,true)}}})}function kn(){Pt.addFormat("([+-])?(\\d{4,4})[-.]?{full_month}[-.]?(\\d{1,2})?",true,["year_sign","year","month","date"],false,true);Pt.addFormat("(\\d{1,2})[-.\\/]{full_month}(?:[-.\\/](\\d{2,4}))?",true,["date","month","year"],true);Pt.addFormat("{full_month}[-.](\\d{4,4})",false,["month","year"]);Pt.addFormat("\\/Date\\((\\d+(?:\\+\\d{4,4})?)\\)\\/",false,["timestamp"]);Pt.addFormat(bn(Ht,Pt),false,Ft);Yt=Pt.compiledFormats.slice(0,7).reverse();Pt.compiledFormats=Pt.compiledFormats.slice(7).concat(Yt)}function Mn(){M(a,true,false,"short,long,full",function(e,t){e[t]=function(e){return mn(this,t,false,e)}})}function Ln(){jt.split("").forEach(function(e,t){var n;if(t>9){t=l.pow(10,t-9)}Gt[e]=t});Ut.split("").forEach(function(e,t){Gt[e]=t});Wt=r("([期週周])?(["+jt+Ut+"]+)(?!昨)","g")}function Bn(){var e="today,yesterday,tomorrow,weekday,weekend,future,past".split(",");var t=Pt["weekdays"].slice(0,7);var n=Pt["months"].slice(0,12);M(a,true,false,e.concat(t).concat(n),function(e,t){e["is"+tn(t)]=function(e){return this.is(t,0,e)}})}function En(){a.extend({utc:{create:function(){return Sn(arguments,0,true)},past:function(){return Sn(arguments,-1,true)
},future:function(){return Sn(arguments,1,true)}}},false,false)}function Dn(){a.extend({RFC1123:"{Dow}, {dd} {Mon} {yyyy} {HH}:{mm}:{ss} {tz}",RFC1036:"{Weekday}, {dd}-{Mon}-{yy} {HH}:{mm}:{ss} {tz}",ISO8601_DATE:"{yyyy}-{MM}-{dd}",ISO8601_DATETIME:"{yyyy}-{MM}-{dd}T{HH}:{mm}:{ss}.{fff}{isotz}"},false,false)}a.extend({create:function(){return Sn(arguments)},past:function(){return Sn(arguments,-1)},future:function(){return Sn(arguments,1)},addLocale:function(e,t){return Zt(e,t)},setLocale:function(e,t){var n=Xt(e,false);At=n;if(e&&e!=n["code"]){n["code"]=e}return n},getLocale:function(e){return!e?At:Xt(e,false)},addFormat:function(e,t,n){en(Xt(n),e,t)},addOutputFormat:function(e){qt.push(e)}},false,false);a.extend({set:function(){var e=rn(arguments);return vn(this,e[0],e[1])},setWeekday:function(e){if(A(e))return;return wn(this,"Date",yn(this,"Date")+e-yn(this,"Day"))},setISOWeek:function(e){var t=yn(this,"Day")||7;if(A(e))return;this.set({month:0,date:4});this.set({weekday:1});if(e>1){this.addWeeks(e-1)}if(t!==1){this.advance({days:t-1})}return this.getTime()},getISOWeek:function(){return hn(this)},getUTCOffset:function(e){var t=this._utc?0:this.getTimezoneOffset();var n=e===true?":":"";if(!t&&e)return"Z";return z(K(-t/60),2,true)+n+z(l.abs(t%60),2)},utc:function(e){E(this,"_utc",e===true||arguments.length===0);return this},isUTC:function(){return!!this._utc||this.getTimezoneOffset()===0},advance:function(){var e=rn(arguments,true);return vn(this,e[0],e[1],1)},rewind:function(){var e=rn(arguments,true);return vn(this,e[0],e[1],-1)},isValid:function(){return!isNaN(this.getTime())},isAfter:function(e,t,n){return this.getTime()>a.create(e).getTime()-(t||0)},isBefore:function(e,t){return this.getTime()<a.create(e).getTime()+(t||0)},isBetween:function(e,t,n){var i=this.getTime();var r=a.create(e).getTime();var o=a.create(t).getTime();var s=l.min(r,o);var u=l.max(r,o);n=n||0;return s-n<i&&u+n>i},isLeapYear:function(){var e=yn(this,"FullYear");return e%4===0&&e%100!==0||e%400===0},daysInMonth:function(){return 32-yn(new a(yn(this,"FullYear"),yn(this,"Month"),32),"Date")},format:function(e,t){return mn(this,e,false,t)},relative:function(e,t){if(w(e)){t=e;e=null}return mn(this,e,true,t)},is:function(e,t,n){var i,r;if(!this.isValid())return;if(w(e)){e=e.trim().toLowerCase();r=this.clone().utc(n);switch(true){case e==="future":return this.getTime()>(new a).getTime();case e==="past":return this.getTime()<(new a).getTime();case e==="weekday":return yn(r,"Day")>0&&yn(r,"Day")<6;case e==="weekend":return yn(r,"Day")===0||yn(r,"Day")===6;case(i=Pt["weekdays"].indexOf(e)%7)>-1:return yn(r,"Day")===i;case(i=Pt["months"].indexOf(e)%12)>-1:return yn(r,"Month")===i}}return _n(this,e,t,n)},reset:function(e){var t={},n;e=e||"hours";if(e==="date")e="days";n=Qt.some(function(t){return e===t.unit||e===t.unit+"s"});t[e]=e.match(/^days?/)?1:0;return n?this.set(t,true):this},clone:function(){var e=new a(this.getTime());e.utc(!!this._utc);return e}});a.extend({iso:function(){return this.toISOString()},getWeekday:a.prototype.getDay,getUTCWeekday:a.prototype.getUTCDay});function Vn(e,t){var n=e.unit,i={};function r(){return G(this*t)}function a(){return Sn(arguments)[e.addMethod](this)}function o(){return Sn(arguments)[e.addMethod](-this)}i[n]=r;i[n+"s"]=r;i[n+"Before"]=o;i[n+"sBefore"]=o;i[n+"Ago"]=o;i[n+"sAgo"]=o;i[n+"After"]=a;i[n+"sAfter"]=a;i[n+"FromNow"]=a;i[n+"sFromNow"]=a;s.extend(i)}s.extend({duration:function(e){return Xt(e).getDuration(this)}});Pt=At=a.addLocale("en",{plural:true,timeMarker:"at",ampm:"am,pm",months:"January,February,March,April,May,June,July,August,September,October,November,December",weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",units:"millisecond:|s,second:|s,minute:|s,hour:|s,day:|s,week:|s,month:|s,year:|s",numbers:"one,two,three,four,five,six,seven,eight,nine,ten",articles:"a,an,the",tokens:"the,st|nd|rd|th,of","short":"{Month} {d}, {yyyy}","long":"{Month} {d}, {yyyy} {h}:{mm}{tt}",full:"{Weekday} {Month} {d}, {yyyy} {h}:{mm}:{ss}{tt}",past:"{num} {unit} {sign}",future:"{num} {unit} {sign}",duration:"{num} {unit}",modifiers:[{name:"sign",src:"ago|before",value:-1},{name:"sign",src:"from now|after|from|in|later",value:1},{name:"edge",src:"last day",value:-2},{name:"edge",src:"end",value:-1},{name:"edge",src:"first day|beginning",value:1},{name:"shift",src:"last",value:-1},{name:"shift",src:"the|this",value:0},{name:"shift",src:"next",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{month} {year}","{shift} {unit=5-7}","{0?} {date}{1}","{0?} {edge} of {shift?} {unit=4-7?}{month?}{year?}"],timeParse:["{0} {num}{1} {day} of {month} {year?}","{weekday?} {month} {date}{1?} {year?}","{date} {month} {year}","{date} {month}","{shift} {weekday}","{shift} week {weekday}","{weekday} {2?} {shift} week","{num} {unit=1-7} {sign} {day?}","in {num} {unit=1-7} {sign} {day?}","{0?} {edge} of {shift?} {unit?}{month?}{year?}","{num} {unit=1-7}","{0?} {date}{1} of {month}","{0?}{month?} {date?}{1?} of {shift} {unit=6-7}"]});Tn();xn();kn();Mn();Ln();Bn();En();Dn();t.addLocale("da",{plural:true,months:"januar,februar,marts,april,maj,juni,juli,august,september,oktober,november,december",weekdays:"søndag|sondag,mandag,tirsdag,onsdag,torsdag,fredag,lørdag|lordag",units:"millisekund:|er,sekund:|er,minut:|ter,tim:e|er,dag:|e,ug:e|er|en,måned:|er|en+maaned:|er|en,år:||et+aar:||et",numbers:"en|et,to,tre,fire,fem,seks,syv,otte,ni,ti",tokens:"den,for",articles:"den","short":"d. {d}. {month} {yyyy}","long":"den {d}. {month} {yyyy} {H}:{mm}",full:"{Weekday} den {d}. {month} {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{sign} {num} {unit}",duration:"{num} {unit}",ampm:"am,pm",modifiers:[{name:"day",src:"forgårs|i forgårs|forgaars|i forgaars",value:-2},{name:"day",src:"i går|igår|i gaar|igaar",value:-1},{name:"day",src:"i dag|idag",value:0},{name:"day",src:"i morgen|imorgen",value:1},{name:"day",src:"over morgon|overmorgen|i over morgen|i overmorgen|iovermorgen",value:2},{name:"sign",src:"siden",value:-1},{name:"sign",src:"om",value:1},{name:"shift",src:"i sidste|sidste",value:-1},{name:"shift",src:"denne",value:0},{name:"shift",src:"næste|naeste",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{1?} {num} {unit} {sign}","{shift} {unit=5-7}"],timeParse:["{0?} {weekday?} {date?} {month} {year}","{date} {month}","{shift} {weekday}"]});t.addLocale("de",{plural:true,capitalizeUnit:true,months:"Januar,Februar,März|Marz,April,Mai,Juni,Juli,August,September,Oktober,November,Dezember",weekdays:"Sonntag,Montag,Dienstag,Mittwoch,Donnerstag,Freitag,Samstag",units:"Millisekunde:|n,Sekunde:|n,Minute:|n,Stunde:|n,Tag:|en,Woche:|n,Monat:|en,Jahr:|en",numbers:"ein:|e|er|en|em,zwei,drei,vier,fuenf,sechs,sieben,acht,neun,zehn",tokens:"der","short":"{d}. {Month} {yyyy}","long":"{d}. {Month} {yyyy} {H}:{mm}",full:"{Weekday} {d}. {Month} {yyyy} {H}:{mm}:{ss}",past:"{sign} {num} {unit}",future:"{sign} {num} {unit}",duration:"{num} {unit}",timeMarker:"um",ampm:"am,pm",modifiers:[{name:"day",src:"vorgestern",value:-2},{name:"day",src:"gestern",value:-1},{name:"day",src:"heute",value:0},{name:"day",src:"morgen",value:1},{name:"day",src:"übermorgen|ubermorgen|uebermorgen",value:2},{name:"sign",src:"vor:|her",value:-1},{name:"sign",src:"in",value:1},{name:"shift",src:"letzte:|r|n|s",value:-1},{name:"shift",src:"nächste:|r|n|s+nachste:|r|n|s+naechste:|r|n|s+kommende:n|r",value:1}],dateParse:["{sign} {num} {unit}","{num} {unit} {sign}","{shift} {unit=5-7}"],timeParse:["{weekday?} {date?} {month} {year?}","{shift} {weekday}"]});t.addLocale("es",{plural:true,months:"enero,febrero,marzo,abril,mayo,junio,julio,agosto,septiembre,octubre,noviembre,diciembre",weekdays:"domingo,lunes,martes,miércoles|miercoles,jueves,viernes,sábado|sabado",units:"milisegundo:|s,segundo:|s,minuto:|s,hora:|s,día|días|dia|dias,semana:|s,mes:|es,año|años|ano|anos",numbers:"uno,dos,tres,cuatro,cinco,seis,siete,ocho,nueve,diez",tokens:"el,de","short":"{d} {month} {yyyy}","long":"{d} {month} {yyyy} {H}:{mm}",full:"{Weekday} {d} {month} {yyyy} {H}:{mm}:{ss}",past:"{sign} {num} {unit}",future:"{num} {unit} {sign}",duration:"{num} {unit}",timeMarker:"a las",ampm:"am,pm",modifiers:[{name:"day",src:"anteayer",value:-2},{name:"day",src:"ayer",value:-1},{name:"day",src:"hoy",value:0},{name:"day",src:"mañana|manana",value:1},{name:"sign",src:"hace",value:-1},{name:"sign",src:"de ahora",value:1},{name:"shift",src:"pasad:o|a",value:-1},{name:"shift",src:"próximo|próxima|proximo|proxima",value:1}],dateParse:["{sign} {num} {unit}","{num} {unit} {sign}","{0?} {unit=5-7} {shift}","{0?} {shift} {unit=5-7}"],timeParse:["{shift} {weekday}","{weekday} {shift}","{date?} {1?} {month} {1?} {year?}"]});t.addLocale("fi",{plural:true,timeMarker:"kello",ampm:",",months:"tammikuu,helmikuu,maaliskuu,huhtikuu,toukokuu,kesäkuu,heinäkuu,elokuu,syyskuu,lokakuu,marraskuu,joulukuu",weekdays:"sunnuntai,maanantai,tiistai,keskiviikko,torstai,perjantai,lauantai",units:"millisekun:ti|tia|teja|tina|nin,sekun:ti|tia|teja|tina|nin,minuut:ti|tia|teja|tina|in,tun:ti|tia|teja|tina|nin,päiv:ä|ää|iä|änä|än,viik:ko|koa|koja|on|kona,kuukau:si|sia|tta|den|tena,vuo:si|sia|tta|den|tena",numbers:"yksi|ensimmäinen,kaksi|toinen,kolm:e|as,neljä:s,vii:si|des,kuu:si|des,seitsemä:n|s,kahdeksa:n|s,yhdeksä:n|s,kymmene:n|s",articles:"",optionals:"","short":"{d}. {month}ta {yyyy}","long":"{d}. {month}ta {yyyy} kello {H}.{mm}",full:"{Weekday}na {d}. {month}ta {yyyy} kello {H}.{mm}",relative:function(e,t,n,i){var r=this["units"];function a(n){return(e===1?"":e+" ")+r[8*n+t]}switch(i){case"duration":return a(0);case"past":return a(e>1?1:0)+" sitten";case"future":return a(4)+" päästä"}},modifiers:[{name:"day",src:"toissa päivänä|toissa päiväistä",value:-2},{name:"day",src:"eilen|eilistä",value:-1},{name:"day",src:"tänään",value:0},{name:"day",src:"huomenna|huomista",value:1},{name:"day",src:"ylihuomenna|ylihuomista",value:2},{name:"sign",src:"sitten|aiemmin",value:-1},{name:"sign",src:"päästä|kuluttua|myöhemmin",value:1},{name:"edge",src:"viimeinen|viimeisenä",value:-2},{name:"edge",src:"lopussa",value:-1},{name:"edge",src:"ensimmäinen|ensimmäisenä",value:1},{name:"shift",src:"edellinen|edellisenä|edeltävä|edeltävänä|viime|toissa",value:-1},{name:"shift",src:"tänä|tämän",value:0},{name:"shift",src:"seuraava|seuraavana|tuleva|tulevana|ensi",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{num} {unit=4-5} {sign} {day}","{month} {year}","{shift} {unit=5-7}"],timeParse:["{0} {num}{1} {day} of {month} {year?}","{weekday?} {month} {date}{1} {year?}","{date} {month} {year}","{shift} {weekday}","{shift} week {weekday}","{weekday} {2} {shift} week","{0} {date}{1} of {month}","{0}{month?} {date?}{1} of {shift} {unit=6-7}"]});t.addLocale("fr",{plural:true,months:"janvier,février|fevrier,mars,avril,mai,juin,juillet,août,septembre,octobre,novembre,décembre|decembre",weekdays:"dimanche,lundi,mardi,mercredi,jeudi,vendredi,samedi",units:"milliseconde:|s,seconde:|s,minute:|s,heure:|s,jour:|s,semaine:|s,mois,an:|s|née|nee",numbers:"un:|e,deux,trois,quatre,cinq,six,sept,huit,neuf,dix",tokens:["l'|la|le"],"short":"{d} {month} {yyyy}","long":"{d} {month} {yyyy} {H}:{mm}",full:"{Weekday} {d} {month} {yyyy} {H}:{mm}:{ss}",past:"{sign} {num} {unit}",future:"{sign} {num} {unit}",duration:"{num} {unit}",timeMarker:"à",ampm:"am,pm",modifiers:[{name:"day",src:"hier",value:-1},{name:"day",src:"aujourd'hui",value:0},{name:"day",src:"demain",value:1},{name:"sign",src:"il y a",value:-1},{name:"sign",src:"dans|d'ici",value:1},{name:"shift",src:"derni:èr|er|ère|ere",value:-1},{name:"shift",src:"prochain:|e",value:1}],dateParse:["{sign} {num} {unit}","{sign} {num} {unit}","{0?} {unit=5-7} {shift}"],timeParse:["{weekday?} {0?} {date?} {month} {year?}","{0?} {weekday} {shift}"]});t.addLocale("it",{plural:true,months:"Gennaio,Febbraio,Marzo,Aprile,Maggio,Giugno,Luglio,Agosto,Settembre,Ottobre,Novembre,Dicembre",weekdays:"Domenica,Luned:ì|i,Marted:ì|i,Mercoled:ì|i,Gioved:ì|i,Venerd:ì|i,Sabato",units:"millisecond:o|i,second:o|i,minut:o|i,or:a|e,giorn:o|i,settiman:a|e,mes:e|i,ann:o|i",numbers:"un:|a|o|',due,tre,quattro,cinque,sei,sette,otto,nove,dieci",tokens:"l'|la|il","short":"{d} {Month} {yyyy}","long":"{d} {Month} {yyyy} {H}:{mm}",full:"{Weekday} {d} {Month} {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{num} {unit} {sign}",duration:"{num} {unit}",timeMarker:"alle",ampm:"am,pm",modifiers:[{name:"day",src:"ieri",value:-1},{name:"day",src:"oggi",value:0},{name:"day",src:"domani",value:1},{name:"day",src:"dopodomani",value:2},{name:"sign",src:"fa",value:-1},{name:"sign",src:"da adesso",value:1},{name:"shift",src:"scors:o|a",value:-1},{name:"shift",src:"prossim:o|a",value:1}],dateParse:["{num} {unit} {sign}","{0?} {unit=5-7} {shift}","{0?} {shift} {unit=5-7}"],timeParse:["{weekday?} {date?} {month} {year?}","{shift} {weekday}"]});t.addLocale("ja",{monthSuffix:"月",weekdays:"日曜日,月曜日,火曜日,水曜日,木曜日,金曜日,土曜日",units:"ミリ秒,秒,分,時間,日,週間|週,ヶ月|ヵ月|月,年","short":"{yyyy}年{M}月{d}日","long":"{yyyy}年{M}月{d}日 {H}時{mm}分",full:"{yyyy}年{M}月{d}日 {Weekday} {H}時{mm}分{ss}秒",past:"{num}{unit}{sign}",future:"{num}{unit}{sign}",duration:"{num}{unit}",timeSuffixes:"時,分,秒",ampm:"午前,午後",modifiers:[{name:"day",src:"一昨日",value:-2},{name:"day",src:"昨日",value:-1},{name:"day",src:"今日",value:0},{name:"day",src:"明日",value:1},{name:"day",src:"明後日",value:2},{name:"sign",src:"前",value:-1},{name:"sign",src:"後",value:1},{name:"shift",src:"去|先",value:-1},{name:"shift",src:"来",value:1}],dateParse:["{num}{unit}{sign}"],timeParse:["{shift}{unit=5-7}{weekday?}","{year}年{month?}月?{date?}日?","{month}月{date?}日?","{date}日"]});t.addLocale("ko",{digitDate:true,monthSuffix:"월",weekdays:"일요일,월요일,화요일,수요일,목요일,금요일,토요일",units:"밀리초,초,분,시간,일,주,개월|달,년",numbers:"일|한,이,삼,사,오,육,칠,팔,구,십","short":"{yyyy}년{M}월{d}일","long":"{yyyy}년{M}월{d}일 {H}시{mm}분",full:"{yyyy}년{M}월{d}일 {Weekday} {H}시{mm}분{ss}초",past:"{num}{unit} {sign}",future:"{num}{unit} {sign}",duration:"{num}{unit}",timeSuffixes:"시,분,초",ampm:"오전,오후",modifiers:[{name:"day",src:"그저께",value:-2},{name:"day",src:"어제",value:-1},{name:"day",src:"오늘",value:0},{name:"day",src:"내일",value:1},{name:"day",src:"모레",value:2},{name:"sign",src:"전",value:-1},{name:"sign",src:"후",value:1},{name:"shift",src:"지난|작",value:-1},{name:"shift",src:"이번",value:0},{name:"shift",src:"다음|내",value:1}],dateParse:["{num}{unit} {sign}","{shift?} {unit=5-7}"],timeParse:["{shift} {unit=5?} {weekday}","{year}년{month?}월?{date?}일?","{month}월{date?}일?","{date}일"]});t.addLocale("nl",{plural:true,months:"januari,februari,maart,april,mei,juni,juli,augustus,september,oktober,november,december",weekdays:"zondag|zo,maandag|ma,dinsdag|di,woensdag|woe|wo,donderdag|do,vrijdag|vrij|vr,zaterdag|za",units:"milliseconde:|n,seconde:|n,minu:ut|ten,uur,dag:|en,we:ek|ken,maand:|en,jaar",numbers:"een,twee,drie,vier,vijf,zes,zeven,acht,negen",tokens:"","short":"{d} {Month} {yyyy}","long":"{d} {Month} {yyyy} {H}:{mm}",full:"{Weekday} {d} {Month} {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{num} {unit} {sign}",duration:"{num} {unit}",timeMarker:"'s|om",modifiers:[{name:"day",src:"gisteren",value:-1},{name:"day",src:"vandaag",value:0},{name:"day",src:"morgen",value:1},{name:"day",src:"overmorgen",value:2},{name:"sign",src:"geleden",value:-1},{name:"sign",src:"vanaf nu",value:1},{name:"shift",src:"laatste|vorige|afgelopen",value:-1},{name:"shift",src:"volgend:|e",value:1}],dateParse:["{num} {unit} {sign}","{0?} {unit=5-7} {shift}","{0?} {shift} {unit=5-7}"],timeParse:["{weekday?} {date?} {month} {year?}","{shift} {weekday}"]});t.addLocale("pl",{plural:true,months:"Styczeń|Stycznia,Luty|Lutego,Marzec|Marca,Kwiecień|Kwietnia,Maj|Maja,Czerwiec|Czerwca,Lipiec|Lipca,Sierpień|Sierpnia,Wrzesień|Września,Październik|Października,Listopad|Listopada,Grudzień|Grudnia",weekdays:"Niedziela|Niedzielę,Poniedziałek,Wtorek,Środ:a|ę,Czwartek,Piątek,Sobota|Sobotę",units:"milisekund:a|y|,sekund:a|y|,minut:a|y|,godzin:a|y|,dzień|dni,tydzień|tygodnie|tygodni,miesiące|miesiące|miesięcy,rok|lata|lat",numbers:"jeden|jedną,dwa|dwie,trzy,cztery,pięć,sześć,siedem,osiem,dziewięć,dziesięć",optionals:"w|we,roku","short":"{d} {Month} {yyyy}","long":"{d} {Month} {yyyy} {H}:{mm}",full:"{Weekday}, {d} {Month} {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{sign} {num} {unit}",duration:"{num} {unit}",timeMarker:"o",ampm:"am,pm",modifiers:[{name:"day",src:"przedwczoraj",value:-2},{name:"day",src:"wczoraj",value:-1},{name:"day",src:"dzisiaj|dziś",value:0},{name:"day",src:"jutro",value:1},{name:"day",src:"pojutrze",value:2},{name:"sign",src:"temu|przed",value:-1},{name:"sign",src:"za",value:1},{name:"shift",src:"zeszły|zeszła|ostatni|ostatnia",value:-1},{name:"shift",src:"następny|następna|następnego|przyszły|przyszła|przyszłego",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{month} {year}","{shift} {unit=5-7}","{0} {shift?} {weekday}"],timeParse:["{date} {month} {year?} {1}","{0} {shift?} {weekday}"]});t.addLocale("pt",{plural:true,months:"janeiro,fevereiro,março,abril,maio,junho,julho,agosto,setembro,outubro,novembro,dezembro",weekdays:"domingo,segunda-feira,terça-feira,quarta-feira,quinta-feira,sexta-feira,sábado|sabado",units:"milisegundo:|s,segundo:|s,minuto:|s,hora:|s,dia:|s,semana:|s,mês|mêses|mes|meses,ano:|s",numbers:"um,dois,três|tres,quatro,cinco,seis,sete,oito,nove,dez,uma,duas",tokens:"a,de","short":"{d} de {month} de {yyyy}","long":"{d} de {month} de {yyyy} {H}:{mm}",full:"{Weekday}, {d} de {month} de {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{sign} {num} {unit}",duration:"{num} {unit}",timeMarker:"às",ampm:"am,pm",modifiers:[{name:"day",src:"anteontem",value:-2},{name:"day",src:"ontem",value:-1},{name:"day",src:"hoje",value:0},{name:"day",src:"amanh:ã|a",value:1},{name:"sign",src:"atrás|atras|há|ha",value:-1},{name:"sign",src:"daqui a",value:1},{name:"shift",src:"passad:o|a",value:-1},{name:"shift",src:"próximo|próxima|proximo|proxima",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{0?} {unit=5-7} {shift}","{0?} {shift} {unit=5-7}"],timeParse:["{date?} {1?} {month} {1?} {year?}","{0?} {shift} {weekday}"]});t.addLocale("ru",{months:"Январ:я|ь,Феврал:я|ь,Март:а|,Апрел:я|ь,Ма:я|й,Июн:я|ь,Июл:я|ь,Август:а|,Сентябр:я|ь,Октябр:я|ь,Ноябр:я|ь,Декабр:я|ь",weekdays:"Воскресенье,Понедельник,Вторник,Среда,Четверг,Пятница,Суббота",units:"миллисекунд:а|у|ы|,секунд:а|у|ы|,минут:а|у|ы|,час:||а|ов,день|день|дня|дней,недел:я|ю|и|ь|е,месяц:||а|ев|е,год|год|года|лет|году",numbers:"од:ин|ну,дв:а|е,три,четыре,пять,шесть,семь,восемь,девять,десять",tokens:"в|на,года","short":"{d} {month} {yyyy} года","long":"{d} {month} {yyyy} года {H}:{mm}",full:"{Weekday} {d} {month} {yyyy} года {H}:{mm}:{ss}",relative:function(e,t,n,i){var r,a=e.toString().slice(-1);switch(true){case e>=11&&e<=15:mult=3;break;case a==1:mult=1;break;case a>=2&&a<=4:mult=2;break;default:mult=3}r=e+" "+this["units"][mult*8+t];switch(i){case"duration":return r;case"past":return r+" назад";case"future":return"через "+r}},timeMarker:"в",ampm:" утра, вечера",modifiers:[{name:"day",src:"позавчера",value:-2},{name:"day",src:"вчера",value:-1},{name:"day",src:"сегодня",value:0},{name:"day",src:"завтра",value:1},{name:"day",src:"послезавтра",value:2},{name:"sign",src:"назад",value:-1},{name:"sign",src:"через",value:1},{name:"shift",src:"прошл:ый|ой|ом",value:-1},{name:"shift",src:"следующ:ий|ей|ем",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{month} {year}","{0?} {shift} {unit=5-7}"],timeParse:["{date} {month} {year?} {1?}","{0?} {shift} {weekday}"]});t.addLocale("sv",{plural:true,months:"januari,februari,mars,april,maj,juni,juli,augusti,september,oktober,november,december",weekdays:"söndag|sondag,måndag:|en+mandag:|en,tisdag,onsdag,torsdag,fredag,lördag|lordag",units:"millisekund:|er,sekund:|er,minut:|er,timm:e|ar,dag:|ar,veck:a|or|an,månad:|er|en+manad:|er|en,år:||et+ar:||et",numbers:"en|ett,två|tva,tre,fyra,fem,sex,sju,åtta|atta,nio,tio",tokens:"den,för|for",articles:"den","short":"den {d} {month} {yyyy}","long":"den {d} {month} {yyyy} {H}:{mm}",full:"{Weekday} den {d} {month} {yyyy} {H}:{mm}:{ss}",past:"{num} {unit} {sign}",future:"{sign} {num} {unit}",duration:"{num} {unit}",ampm:"am,pm",modifiers:[{name:"day",src:"förrgår|i förrgår|iförrgår|forrgar|i forrgar|iforrgar",value:-2},{name:"day",src:"går|i går|igår|gar|i gar|igar",value:-1},{name:"day",src:"dag|i dag|idag",value:0},{name:"day",src:"morgon|i morgon|imorgon",value:1},{name:"day",src:"över morgon|övermorgon|i över morgon|i övermorgon|iövermorgon|over morgon|overmorgon|i over morgon|i overmorgon|iovermorgon",value:2},{name:"sign",src:"sedan|sen",value:-1},{name:"sign",src:"om",value:1},{name:"shift",src:"i förra|förra|i forra|forra",value:-1},{name:"shift",src:"denna",value:0},{name:"shift",src:"nästa|nasta",value:1}],dateParse:["{num} {unit} {sign}","{sign} {num} {unit}","{1?} {num} {unit} {sign}","{shift} {unit=5-7}"],timeParse:["{0?} {weekday?} {date?} {month} {year}","{date} {month}","{shift} {weekday}"]});t.addLocale("zh-CN",{variant:true,monthSuffix:"月",weekdays:"星期日|周日,星期一|周一,星期二|周二,星期三|周三,星期四|周四,星期五|周五,星期六|周六",units:"毫秒,秒钟,分钟,小时,天,个星期|周,个月,年",tokens:"日|号","short":"{yyyy}年{M}月{d}日","long":"{yyyy}年{M}月{d}日 {tt}{h}:{mm}",full:"{yyyy}年{M}月{d}日 {weekday} {tt}{h}:{mm}:{ss}",past:"{num}{unit}{sign}",future:"{num}{unit}{sign}",duration:"{num}{unit}",timeSuffixes:"点|时,分钟?,秒",ampm:"上午,下午",modifiers:[{name:"day",src:"前天",value:-2},{name:"day",src:"昨天",value:-1},{name:"day",src:"今天",value:0},{name:"day",src:"明天",value:1},{name:"day",src:"后天",value:2},{name:"sign",src:"前",value:-1},{name:"sign",src:"后",value:1},{name:"shift",src:"上|去",value:-1},{name:"shift",src:"这",value:0},{name:"shift",src:"下|明",value:1}],dateParse:["{num}{unit}{sign}","{shift}{unit=5-7}"],timeParse:["{shift}{weekday}","{year}年{month?}月?{date?}{0?}","{month}月{date?}{0?}","{date}[日号]"]});t.addLocale("zh-TW",{monthSuffix:"月",weekdays:"星期日|週日,星期一|週一,星期二|週二,星期三|週三,星期四|週四,星期五|週五,星期六|週六",units:"毫秒,秒鐘,分鐘,小時,天,個星期|週,個月,年",tokens:"日|號","short":"{yyyy}年{M}月{d}日","long":"{yyyy}年{M}月{d}日 {tt}{h}:{mm}",full:"{yyyy}年{M}月{d}日 {Weekday} {tt}{h}:{mm}:{ss}",past:"{num}{unit}{sign}",future:"{num}{unit}{sign}",duration:"{num}{unit}",timeSuffixes:"點|時,分鐘?,秒",ampm:"上午,下午",modifiers:[{name:"day",src:"前天",value:-2},{name:"day",src:"昨天",value:-1},{name:"day",src:"今天",value:0},{name:"day",src:"明天",value:1},{name:"day",src:"後天",value:2},{name:"sign",src:"前",value:-1},{name:"sign",src:"後",value:1},{name:"shift",src:"上|去",value:-1},{name:"shift",src:"這",value:0},{name:"shift",src:"下|明",value:1}],dateParse:["{num}{unit}{sign}","{shift}{unit=5-7}"],timeParse:["{shift}{weekday}","{year}年{month?}月?{date?}{0?}","{month}月{date?}{0?}","{date}[日號]"]});var In=function(e,t){this.start=a.create(e);this.end=a.create(t)};In.prototype.toString=function(){return this.isValid()?this.start.full()+".."+this.end.full():"Invalid DateRange"};k(In,true,false,{isValid:function(){return this.start<this.end},duration:function(){return this.isValid()?this.end.getTime()-this.start.getTime():NaN},contains:function(e){var t=this,n=e.start&&e.end?[e.start,e.end]:[e];return n.every(function(e){return e>=t.start&&e<=t.end})},every:function(e,t){var n=this.start.clone(),i=[],r=0,a,o;if(w(e)){n.advance(an(e,0),true);a=an(e);o=e.toLowerCase()==="day"}else{a={milliseconds:e}}while(n<=this.end){i.push(n);if(t)t(n,r);if(o&&yn(n,"Hours")===23){n=n.clone();wn(n,"Hours",48)}else{n=n.clone().advance(a,true)}r++}return i},union:function(e){return new In(this.start<e.start?this.start:e.start,this.end>e.end?this.end:e.end)},intersect:function(e){return new In(this.start>e.start?this.start:e.start,this.end<e.end?this.end:e.end)},clone:function(e){return new In(this.start,this.end)}});M(In,true,false,"Millisecond,Second,Minute,Hour,Day,Week,Month,Year",function(e,t){e["each"+t]=function(e){return this.every(t,e)}});k(a,false,false,{range:function(e,t){return new In(e,t)}});function Pn(e,t,n,i,r,a){var o=e.toFixed(20),s=o.search(/\./),u=o.search(/[1-9]/),c=s-u,d,h,f;if(c>0){c-=1}h=l.max(l.min((c/3).floor(),r===false?n.length:r),-i);d=n.charAt(h+i-1);if(c<-9){h=-3;t=c.abs()-9;d=n.slice(0,1)}f=a?2..pow(10*h):10..pow(h*3);return(e/f).round(t||0).format()+d.trim()}k(s,false,false,{random:function(e,t){var n,i;if(arguments.length==1)t=e,e=0;n=l.min(e||0,A(t)?1:t);i=l.max(e||0,A(t)?1:t)+1;return K(l.random()*(i-n)+n)}});k(s,true,false,{log:function(e){return l.log(this)/(e?l.log(e):1)},abbr:function(e){return Pn(this,e,"kmbt",0,4)},metric:function(e,t){return Pn(this,e,"nμm kMGTPE",4,A(t)?1:t)},bytes:function(e,t){return Pn(this,e,"kMGTPE",0,A(t)?4:t,true)+"B"},isInteger:function(){return this%1==0},isOdd:function(){return!isNaN(this)&&!this.isMultipleOf(2)},isEven:function(){return this.isMultipleOf(2)},isMultipleOf:function(e){return this%e===0},format:function(e,t,n){var i,r,a,o,s,u="";if(A(t)){t=","}if(A(n)){n="."}r=(y(e)?G(this,e||0).toFixed(l.max(e,0)):this.toString()).replace(/^-/,"");a=r.split(".");o=a[0];s=a[1];for(i=o.length;i>0;i-=3){if(i<o.length){u=t+u}u=o.slice(l.max(0,i-3),i)+u}if(s){u+=n+Q((e||0)-s.length,"0")+s}return(this<0?"-":"")+u},hex:function(e){return this.pad(e||1,false,16)},upto:function(e,t,n){return U(this,e,t,n||1)},downto:function(e,t,n){return U(this,e,t,-(n||1))},times:function(e){if(e){for(var t=0;t<this;t++){e.call(this,t)}}return this.toNumber()},chr:function(){return o.fromCharCode(this)},pad:function(e,t,n){return z(this,e,t,n)},ordinalize:function(){var e,t=this.abs(),n=parseInt(t.toString().slice(-2));return this+Y(n)},toNumber:function(){return parseFloat(this,10)}});function An(){M(s,true,false,"round,floor,ceil",function(e,t){e[t]=function(e){return G(this,e,t)}});M(s,true,false,"abs,pow,sin,asin,cos,acos,tan,atan,exp,pow,sqrt",function(e,t){e[t]=function(e,n){return l[t](this,e,n)}})}An();var Fn="isObject,isNaN".split(",");var On="keys,values,select,reject,each,merge,clone,equal,watch,tap,has,toQueryString".split(",");function Rn(e,t,n,i){var r=/^(.+?)(\[.*\])$/,a,o,s,l;if(i!==false&&(o=t.match(r))){l=o[1];s=o[2].replace(/^\[|\]$/g,"").split("][");s.forEach(function(t){a=!t||t.match(/^\d+$/);if(!l&&m(e))l=e.length;if(!R(e,l)){e[l]=a?[]:{}}e=e[l];l=t});if(!l&&a)l=e.length.toString();Rn(e,l,n)}else if(n.match(/^[+-]?\d+(\.\d+)?$/)){e[t]=parseFloat(n)}else if(n==="true"){e[t]=true}else if(n==="false"){e[t]=false}else{e[t]=n}}function Nn(e,t){var n;if(m(t)||O(t)&&t.toString===c){n=[];N(t,function(t,i){if(e){t=e+"["+t+"]"}n.push(Nn(t,i))});return n.join("&")}else{if(!e)return"";return Hn(e)+"="+(g(t)?t.getTime():Hn(t))}}function Hn(e){return!e&&e!==false&&e!==0?"":encodeURIComponent(e).replace(/%20/g,"+")}function jn(e,t){if(b(t)){return t.test(e)}else if(F(t)){return R(t,e)}else{return e===o(t)}}function Un(e,t,n){var i={},r;N(e,function(e,a){r=false;V(t,function(t){if(jn(e,t)){r=true}},1);if(r===n){i[e]=a}});return i}function Gn(){M(n,false,false,p,function(e,t){var n="is"+t;Fn.push(n);e[n]=h[t]})}function Wn(){k(n,false,function(){return arguments.length===0},{extend:function(){var e=Fn.concat(On);if(typeof It!=="undefined"){e=e.concat(It)}nt(e,n)}})}k(n,false,true,{watch:function(e,t,i){if(!f)return;var r=e[t];n.defineProperty(e,t,{enumerable:true,configurable:true,get:function(){return r},set:function(n){r=i.call(e,t,r,n)}})}});k(n,false,function(e,t){return v(t)},{keys:function(e,t){var i=n.keys(e);i.forEach(function(n){t.call(e,n,e[n])});return i}});k(n,false,false,{isObject:function(e){return O(e)},isNaN:function(e){return y(e)&&e.valueOf()!==e.valueOf()},equal:function(e,t){return Z(e,t)},extended:function(e){return new j(e)},merge:function(e,t,o,s){var l,u;if(e&&typeof t!="string"){for(l in t){if(!R(t,l)||!e)continue;u=t[l];if(P(e[l])){if(s===false){continue}if(v(s)){u=s.call(t,l,e[l],t[l])}}if(o===true&&u&&F(u)){if(g(u)){u=new a(u.getTime())}else if(b(u)){u=new r(u.source,J(u))}else{if(!e[l])e[l]=i.isArray(u)?[]:{};n.merge(e[l],t[l],o,s);continue}}e[l]=u}}return e},values:function(e,t){var n=[];N(e,function(i,r){n.push(r);if(t)t.call(e,r)});return n},clone:function(e,t){var i;if(g(e)&&e.clone){return e.clone()}else if(!F(e)){return e}else if(e instanceof j){i=new j}else{i=new e.constructor}return n.merge(i,e,t)},fromQueryString:function(e,t){var i=n.extended(),r;e=e&&e.toString?e.toString():"";e.replace(/^.*?\?/,"").split("&").forEach(function(e){var n=e.split("=");if(n.length!==2)return;Rn(i,n[0],decodeURIComponent(n[1]),t)});return i},toQueryString:function(e,t){return Nn(t,e)},tap:function(e,t){var n=t;if(!v(t)){n=function(){if(t)e[t]()}}n.call(e,e);return e},has:function(e,t){return R(e,t)},select:function(e){return Un(e,arguments,true)},reject:function(e){return Un(e,arguments,false)}});Gn();Wn();nt(On,j);k(r,false,false,{escape:function(e){return $(e)}});k(r,true,false,{getFlags:function(){return J(this)},setFlags:function(e){return r(this.source,e)},addFlag:function(e){return this.setFlags(J(this,e))},removeFlag:function(e){return this.setFlags(J(this).replace(e,""))}});function Kn(e){var t=o.Inflector;var e=t&&t.acronyms[e];if(w(e)){return e}}function zn(e,t,n,i){var r=o(t);if(r!=t){r=""}if(!y(n))n=1;if(!y(i))i=1;return r.repeat(n)+e+r.repeat(i)}function Yn(e){return o.fromCharCode(e)}var qn,Qn;function Jn(e){if(this.btoa){qn=this.btoa;Qn=this.atob;return}var t=/[^A-Za-z0-9\+\/\=]/g;qn=function(t){var n="";var i,r,a;var o,s,l,u;var c=0;do{i=t.charCodeAt(c++);r=t.charCodeAt(c++);a=t.charCodeAt(c++);o=i>>2;s=(i&3)<<4|r>>4;l=(r&15)<<2|a>>6;u=a&63;if(isNaN(r)){l=u=64}else if(isNaN(a)){u=64}n=n+e.charAt(o)+e.charAt(s)+e.charAt(l)+e.charAt(u);i=r=a="";o=s=l=u=""}while(c<t.length);return n};Qn=function(n){var i="";var r,a,o;var s,l,u,c;var d=0;if(n.match(t)){throw new Error("String contains invalid base64 characters")}n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{s=e.indexOf(n.charAt(d++));l=e.indexOf(n.charAt(d++));u=e.indexOf(n.charAt(d++));c=e.indexOf(n.charAt(d++));r=s<<2|l>>4;a=(l&15)<<4|u>>2;o=(u&3)<<6|c;i=i+Yn(r);if(u!=64){i=i+Yn(a)}if(c!=64){i=i+Yn(o)}r=a=o="";s=l=u=c=""}while(d<n.length);return i}}k(o,true,function(e){return b(e)||arguments.length>2},{startsWith:function(e,t,n){var i=this,a;if(t)i=i.slice(t);if(A(n))n=true;a=b(e)?e.source.replace("^",""):$(e);return r("^"+a,n?"":"i").test(i)},endsWith:function(e,t,n){var i=this,a;if(P(t))i=i.slice(0,t);if(A(n))n=true;a=b(e)?e.source.replace("$",""):$(e);return r(a+"$",n?"":"i").test(i)}});k(o,true,false,{escapeRegExp:function(){return $(this)},escapeURL:function(e){return e?encodeURIComponent(this):encodeURI(this)},unescapeURL:function(e){return e?decodeURI(this):decodeURIComponent(this)},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2f;")},unescapeHTML:function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#x2f;/g,"/").replace(/&amp;/g,"&")},encodeBase64:function(){return qn(this)},decodeBase64:function(){return Qn(this)},each:function(e,t){var n,i,a;if(v(e)){t=e;e=/[\s\S]/g}else if(!e){e=/[\s\S]/g}else if(w(e)){e=r($(e),"gi")}else if(b(e)){e=r(e.source,J(e,"g"))}n=this.match(e)||[];if(t){for(i=0,a=n.length;i<a;i++){n[i]=t.call(this,n[i],i,n)||n[i]}}return n},shift:function(e){var t="";e=e||0;this.codes(function(n){t+=Yn(n+e)});return t},codes:function(e){var t=[],n,i;for(n=0,i=this.length;n<i;n++){var r=this.charCodeAt(n);t.push(r);if(e)e.call(this,r,n)}return t},chars:function(e){return this.each(e)},words:function(e){return this.trim().each(/\S+/g,e)},lines:function(e){return this.trim().each(/^.*$/gm,e)},paragraphs:function(e){var t=this.trim().split(/[\r\n]{2,}/);t=t.map(function(t){if(e)var n=e.call(t);return n?n:t});return t},isBlank:function(){return this.trim().length===0},has:function(e){return this.search(b(e)?e:$(e))!==-1},add:function(e,t){t=A(t)?this.length:t;return this.slice(0,t)+e+this.slice(t)},remove:function(e){return this.replace(e,"")},reverse:function(){return this.split("").reverse().join("")},compact:function(){return this.trim().replace(/([\r\n\s　])+/g,function(e,t){return t==="　"?t:" "
})},at:function(){return tt(this,arguments,true)},from:function(e){return this.slice(e)},to:function(e){if(A(e))e=this.length;return this.slice(0,e)},dasherize:function(){return this.underscore().replace(/_/g,"-")},underscore:function(){return this.replace(/[-\s]+/g,"_").replace(o.Inflector&&o.Inflector.acronymRegExp,function(e,t){return(t>0?"_":"")+e.toLowerCase()}).replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()},camelize:function(e){return this.underscore().replace(/(^|_)([^_]+)/g,function(t,n,i,r){var a=Kn(i),o=e!==false||r>0;if(a)return o?a:a.toLowerCase();return o?i.capitalize():i})},spacify:function(){return this.underscore().replace(/_/g," ")},stripTags:function(){var e=this,t=arguments.length>0?arguments:[""];V(t,function(t){e=e.replace(r("</?"+$(t)+"[^<>]*>","gi"),"")});return e},removeTags:function(){var e=this,t=arguments.length>0?arguments:["\\S+"];V(t,function(t){var n=r("<("+t+")[^<>]*(?:\\/>|>.*?<\\/\\1>)","gi");e=e.replace(n,"")});return e},truncate:function(e,t,n,i){var a,s="",l="",u=this.toString(),c="["+q()+"]+",d="[^"+q()+"]*",h=r(c+d+"$");i=A(i)?"...":o(i);if(u.length<=e){return u}switch(n){case"left":a=u.length-e;s=i;u=u.slice(a);h=r("^"+d+c);break;case"middle":a=K(e/2);l=i+u.slice(u.length-a).trimLeft();u=u.slice(0,a);break;default:a=e;l=i;u=u.slice(0,a)}if(t===false&&this.slice(a,a+1).match(/\S/)){u=u.remove(h)}return s+u+l},pad:function(e,t){return Q(t,e)+this+Q(t,e)},padLeft:function(e,t){return Q(t,e)+this},padRight:function(e,t){return this+Q(t,e)},first:function(e){if(A(e))e=1;return this.substr(0,e)},last:function(e){if(A(e))e=1;var t=this.length-e<0?0:this.length-e;return this.substr(t)},repeat:function(e){var t="",n=this;if(!y(e)||e<1)return"";while(e){if(e&1){t+=n}if(e>>=1){n+=n}}return t},toNumber:function(e){var t=this.replace(/,/g,"");return t.match(/\./)?parseFloat(t):parseInt(t,e||10)},capitalize:function(e){var t;return this.toLowerCase().replace(e?/[\s\S]/g:/^\S/,function(e){var n=e.toUpperCase(),i;i=t?e:n;t=n!==e;return i})},assign:function(){var e={};D(arguments,function(t,n){if(O(t)){H(e,t)}else{e[n+1]=t}});return this.replace(/\{([^{]+?)\}/g,function(t,n){return R(e,n)?e[n]:t})}});k(o,true,false,{insert:o.prototype.add});Jn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");var $n=[],Xn=[],Zn=[],ei=[],ti={},ni,ii;function ri(e,t){var n=e.indexOf(t);if(n>-1){e.splice(n,1)}}function ai(e,t,n){if(w(t)){ri(Zn,t)}ri(Zn,n);e.unshift({rule:t,replacement:n})}function oi(e,t){return e==t||e=="all"||!e}function si(e){return Zn.some(function(t){return new r("\\b"+t+"$","i").test(e)})}function li(e,t){e=w(e)?e.toString():"";if(e.isBlank()||si(e)){return e}else{return ui(e,t?$n:Xn)}}function ui(e,t){N(t,function(t,n){if(e.match(n.rule)){e=e.replace(n.rule,n.replacement);return false}});return e}function ci(e){return e.replace(/^\W*[a-z]/,function(e){return e.toUpperCase()})}ii={acronym:function(e){ti[e.toLowerCase()]=e;var t=n.keys(ti).map(function(e){return ti[e]});ii.acronymRegExp=r(t.join("|"),"g")},plural:function(e,t){ai($n,e,t)},singular:function(e,t){ai(Xn,e,t)},irregular:function(e,t){var n=e.first(),i=e.from(1),a=t.first(),o=t.from(1),s=a.toUpperCase(),l=a.toLowerCase(),u=n.toUpperCase(),c=n.toLowerCase();ri(Zn,e);ri(Zn,t);if(u==s){ii.plural(new r("({1}){2}$".assign(n,i),"i"),"$1"+o);ii.plural(new r("({1}){2}$".assign(a,o),"i"),"$1"+o);ii.singular(new r("({1}){2}$".assign(a,o),"i"),"$1"+i)}else{ii.plural(new r("{1}{2}$".assign(u,i)),s+o);ii.plural(new r("{1}{2}$".assign(c,i)),l+o);ii.plural(new r("{1}{2}$".assign(s,o)),s+o);ii.plural(new r("{1}{2}$".assign(l,o)),l+o);ii.singular(new r("{1}{2}$".assign(s,o)),u+i);ii.singular(new r("{1}{2}$".assign(l,o)),c+i)}},uncountable:function(e){var t=i.isArray(e)?e:D(arguments);Zn=Zn.concat(t)},human:function(e,t){ei.unshift({rule:e,replacement:t})},clear:function(e){if(oi(e,"singulars"))Xn=[];if(oi(e,"plurals"))$n=[];if(oi(e,"uncountables"))Zn=[];if(oi(e,"humans"))ei=[];if(oi(e,"acronyms"))ti={}}};ni=["and","or","nor","a","an","the","so","but","to","of","at","by","from","into","on","onto","off","out","in","over","with","for"];ii.plural(/$/,"s");ii.plural(/s$/gi,"s");ii.plural(/(ax|test)is$/gi,"$1es");ii.plural(/(octop|vir|fung|foc|radi|alumn)(i|us)$/gi,"$1i");ii.plural(/(census|alias|status)$/gi,"$1es");ii.plural(/(bu)s$/gi,"$1ses");ii.plural(/(buffal|tomat)o$/gi,"$1oes");ii.plural(/([ti])um$/gi,"$1a");ii.plural(/([ti])a$/gi,"$1a");ii.plural(/sis$/gi,"ses");ii.plural(/f+e?$/gi,"ves");ii.plural(/(cuff|roof)$/gi,"$1s");ii.plural(/([ht]ive)$/gi,"$1s");ii.plural(/([^aeiouy]o)$/gi,"$1es");ii.plural(/([^aeiouy]|qu)y$/gi,"$1ies");ii.plural(/(x|ch|ss|sh)$/gi,"$1es");ii.plural(/(matr|vert|ind)(?:ix|ex)$/gi,"$1ices");ii.plural(/([ml])ouse$/gi,"$1ice");ii.plural(/([ml])ice$/gi,"$1ice");ii.plural(/^(ox)$/gi,"$1en");ii.plural(/^(oxen)$/gi,"$1");ii.plural(/(quiz)$/gi,"$1zes");ii.plural(/(phot|cant|hom|zer|pian|portic|pr|quart|kimon)o$/gi,"$1os");ii.plural(/(craft)$/gi,"$1");ii.plural(/([ft])[eo]{2}(th?)$/gi,"$1ee$2");ii.singular(/s$/gi,"");ii.singular(/([pst][aiu]s)$/gi,"$1");ii.singular(/([aeiouy])ss$/gi,"$1ss");ii.singular(/(n)ews$/gi,"$1ews");ii.singular(/([ti])a$/gi,"$1um");ii.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/gi,"$1$2sis");ii.singular(/(^analy)ses$/gi,"$1sis");ii.singular(/(i)(f|ves)$/i,"$1fe");ii.singular(/([aeolr]f?)(f|ves)$/i,"$1f");ii.singular(/([ht]ive)s$/gi,"$1");ii.singular(/([^aeiouy]|qu)ies$/gi,"$1y");ii.singular(/(s)eries$/gi,"$1eries");ii.singular(/(m)ovies$/gi,"$1ovie");ii.singular(/(x|ch|ss|sh)es$/gi,"$1");ii.singular(/([ml])(ous|ic)e$/gi,"$1ouse");ii.singular(/(bus)(es)?$/gi,"$1");ii.singular(/(o)es$/gi,"$1");ii.singular(/(shoe)s?$/gi,"$1");ii.singular(/(cris|ax|test)[ie]s$/gi,"$1is");ii.singular(/(octop|vir|fung|foc|radi|alumn)(i|us)$/gi,"$1us");ii.singular(/(census|alias|status)(es)?$/gi,"$1");ii.singular(/^(ox)(en)?/gi,"$1");ii.singular(/(vert|ind)(ex|ices)$/gi,"$1ex");ii.singular(/(matr)(ix|ices)$/gi,"$1ix");ii.singular(/(quiz)(zes)?$/gi,"$1");ii.singular(/(database)s?$/gi,"$1");ii.singular(/ee(th?)$/gi,"oo$1");ii.irregular("person","people");ii.irregular("man","men");ii.irregular("child","children");ii.irregular("sex","sexes");ii.irregular("move","moves");ii.irregular("save","saves");ii.irregular("save","saves");ii.irregular("cow","kine");ii.irregular("goose","geese");ii.irregular("zombie","zombies");ii.uncountable("equipment,information,rice,money,species,series,fish,sheep,jeans".split(","));k(o,true,false,{pluralize:function(){return li(this,true)},singularize:function(){return li(this,false)},humanize:function(){var e=ui(this,ei),t;e=e.replace(/_id$/g,"");e=e.replace(/(_)?([a-z\d]*)/gi,function(e,n,i){t=R(ti,i)?ti[i]:null;return(n?" ":"")+(t||i.toLowerCase())});return ci(e)},titleize:function(){var e=/[.:;!]$/,t,n,i;return this.spacify().humanize().words(function(r,a,o){t=e.test(r);i=a==0||a==o.length-1||t||n;n=t;if(i||ni.indexOf(r)===-1){return ci(r)}else{return r}}).join(" ")},parameterize:function(e){var t=this;if(e===undefined)e="-";if(t.normalize){t=t.normalize()}t=t.replace(/[^a-z0-9\-_]+/gi,e);if(e){t=t.replace(new r("^{sep}+|{sep}+$|({sep}){sep}+".assign({sep:$(e)}),"g"),"$1")}return encodeURI(t.toLowerCase())}});o.Inflector=ii;o.Inflector.acronyms=ti})(Streak);(function(e){var t=["$","jQuery","_","moment","jwerty","Stripe","Bacon","RSVP","html","html4","html_sanitize","sanitizeCssProperty","sanitizeCssSelectorList","sanitizeStylesheet","sanitizeStylesheetWithExternals","sanitizeMediaQuery","parseCssStylesheet","parseCssDeclarations","cssSchema","decodeCss","lexCss","URI"];e._old_globals={};t.forEach(function(t){e._old_globals[t]=window[t]})})(Streak);//! moment.js
//! version : 2.8.4
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(e){var t,n="2.8.4",i=typeof global!=="undefined"?global:this,r,a=Math.round,o=Object.prototype.hasOwnProperty,s,l=0,u=1,c=2,d=3,h=4,f=5,p=6,m={},_=[],g=typeof module!=="undefined"&&module&&module.exports,v=/^\/?Date\((\-?\d+)/i,y=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,w=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,b=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,C=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,S=/\d\d?/,T=/\d{1,3}/,x=/\d{1,4}/,k=/[+\-]?\d{1,6}/,M=/\d+/,L=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,B=/Z|[\+\-]\d\d:?\d\d/gi,E=/T/i,D=/[\+\-]?\d+/,V=/[\+\-]?\d+(\.\d{1,3})?/,I=/\d/,P=/\d\d/,A=/\d{3}/,F=/\d{4}/,O=/[+-]?\d{6}/,R=/[+-]?\d+/,N=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,H="YYYY-MM-DDTHH:mm:ssZ",j=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],U=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],G=/([\+\-]|\d\d)/gi,W="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),K={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},z={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Y={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},q={},Q={s:45,m:45,h:22,d:26,M:11},J="DDD w W M D d".split(" "),$="M D H h m s w W".split(" "),X={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return mt(this.year()%100,2)},YYYY:function(){return mt(this.year(),4)},YYYYY:function(){return mt(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+mt(Math.abs(e),6)},gg:function(){return mt(this.weekYear()%100,2)},gggg:function(){return mt(this.weekYear(),4)},ggggg:function(){return mt(this.weekYear(),5)},GG:function(){return mt(this.isoWeekYear()%100,2)},GGGG:function(){return mt(this.isoWeekYear(),4)},GGGGG:function(){return mt(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return kt(this.milliseconds()/100)},SS:function(){return mt(kt(this.milliseconds()/10),2)},SSS:function(){return mt(this.milliseconds(),3)},SSSS:function(){return mt(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";if(e<0){e=-e;t="-"}return t+mt(kt(e/60),2)+":"+mt(kt(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";if(e<0){e=-e;t="-"}return t+mt(kt(e/60),2)+mt(kt(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Z={},et=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];function tt(e,t,n){switch(arguments.length){case 2:return e!=null?e:t;case 3:return e!=null?e:t!=null?t:n;default:throw new Error("Implement me")}}function nt(e,t){return o.call(e,t)}function it(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false}}function rt(e){if(t.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+e)}}function at(e,t){var n=true;return ht(function(){if(n){rt(e);n=false}return t.apply(this,arguments)},t)}function ot(e,t){if(!Z[e]){rt(t);Z[e]=true}}function st(e,t){return function(n){return mt(e.call(this,n),t)}}function lt(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}while(J.length){s=J.pop();X[s+"o"]=lt(X[s],s)}while($.length){s=$.pop();X[s+s]=st(X[s],2)}X.DDDD=st(X.DDD,3);function ut(){}function ct(e,t){if(t!==false){Dt(e)}ft(this,e);this._d=new Date(+e._d)}function dt(e){var n=Tt(e),i=n.year||0,r=n.quarter||0,a=n.month||0,o=n.week||0,s=n.day||0,l=n.hour||0,u=n.minute||0,c=n.second||0,d=n.millisecond||0;this._milliseconds=+d+c*1e3+u*6e4+l*36e5;this._days=+s+o*7;this._months=+a+r*3+i*12;this._data={};this._locale=t.localeData();this._bubble()}function ht(e,t){for(var n in t){if(nt(t,n)){e[n]=t[n]}}if(nt(t,"toString")){e.toString=t.toString}if(nt(t,"valueOf")){e.valueOf=t.valueOf}return e}function ft(e,t){var n,i,r;if(typeof t._isAMomentObject!=="undefined"){e._isAMomentObject=t._isAMomentObject}if(typeof t._i!=="undefined"){e._i=t._i}if(typeof t._f!=="undefined"){e._f=t._f}if(typeof t._l!=="undefined"){e._l=t._l}if(typeof t._strict!=="undefined"){e._strict=t._strict}if(typeof t._tzm!=="undefined"){e._tzm=t._tzm}if(typeof t._isUTC!=="undefined"){e._isUTC=t._isUTC}if(typeof t._offset!=="undefined"){e._offset=t._offset}if(typeof t._pf!=="undefined"){e._pf=t._pf}if(typeof t._locale!=="undefined"){e._locale=t._locale}if(_.length>0){for(n in _){i=_[n];r=t[i];if(typeof r!=="undefined"){e[i]=r}}}return e}function pt(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}}function mt(e,t,n){var i=""+Math.abs(e),r=e>=0;while(i.length<t){i="0"+i}return(r?n?"+":"":"-")+i}function _t(e,t){var n={milliseconds:0,months:0};n.months=t.month()-e.month()+(t.year()-e.year())*12;if(e.clone().add(n.months,"M").isAfter(t)){--n.months}n.milliseconds=+t-+e.clone().add(n.months,"M");return n}function gt(e,t){var n;t=Ft(t,e);if(e.isBefore(t)){n=_t(e,t)}else{n=_t(t,e);n.milliseconds=-n.milliseconds;n.months=-n.months}return n}function vt(e,n){return function(i,r){var a,o;if(r!==null&&!isNaN(+r)){ot(n,"moment()."+n+"(period, number) is deprecated. Please use moment()."+n+"(number, period).");o=i;i=r;r=o}i=typeof i==="string"?+i:i;a=t.duration(i,r);yt(this,a,e);return this}}function yt(e,n,i,r){var a=n._milliseconds,o=n._days,s=n._months;r=r==null?true:r;if(a){e._d.setTime(+e._d+a*i)}if(o){pn(e,"Date",fn(e,"Date")+o*i)}if(s){hn(e,fn(e,"Month")+s*i)}if(r){t.updateOffset(e,o||s)}}function wt(e){return Object.prototype.toString.call(e)==="[object Array]"}function bt(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function Ct(e,t,n){var i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0,o;for(o=0;o<i;o++){if(n&&e[o]!==t[o]||!n&&kt(e[o])!==kt(t[o])){a++}}return a+r}function St(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=z[e]||Y[t]||t}return e}function Tt(e){var t={},n,i;for(i in e){if(nt(e,i)){n=St(i);if(n){t[n]=e[i]}}}return t}function xt(n){var i,r;if(n.indexOf("week")===0){i=7;r="day"}else if(n.indexOf("month")===0){i=12;r="month"}else{return}t[n]=function(a,o){var s,l,u=t._locale[n],c=[];if(typeof a==="number"){o=a;a=e}l=function(e){var n=t().utc().set(r,e);return u.call(t._locale,n,a||"")};if(o!=null){return l(o)}else{for(s=0;s<i;s++){c.push(l(s))}return c}}}function kt(e){var t=+e,n=0;if(t!==0&&isFinite(t)){if(t>=0){n=Math.floor(t)}else{n=Math.ceil(t)}}return n}function Mt(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function Lt(e,n,i){return ln(t([e,11,31+n-i]),n,i).week}function Bt(e){return Et(e)?366:365}function Et(e){return e%4===0&&e%100!==0||e%400===0}function Dt(e){var t;if(e._a&&e._pf.overflow===-2){t=e._a[u]<0||e._a[u]>11?u:e._a[c]<1||e._a[c]>Mt(e._a[l],e._a[u])?c:e._a[d]<0||e._a[d]>24||e._a[d]===24&&(e._a[h]!==0||e._a[f]!==0||e._a[p]!==0)?d:e._a[h]<0||e._a[h]>59?h:e._a[f]<0||e._a[f]>59?f:e._a[p]<0||e._a[p]>999?p:-1;if(e._pf._overflowDayOfYear&&(t<l||t>c)){t=c}e._pf.overflow=t}}function Vt(t){if(t._isValid==null){t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated;if(t._strict){t._isValid=t._isValid&&t._pf.charsLeftOver===0&&t._pf.unusedTokens.length===0&&t._pf.bigHour===e}}return t._isValid}function It(e){return e?e.toLowerCase().replace("_","-"):e}function Pt(e){var t=0,n,i,r,a;while(t<e.length){a=It(e[t]).split("-");n=a.length;i=It(e[t+1]);i=i?i.split("-"):null;while(n>0){r=At(a.slice(0,n).join("-"));if(r){return r}if(i&&i.length>=n&&Ct(a,i,true)>=n-1){break}n--}t++}return null}function At(e){var n=null;if(!m[e]&&g){try{n=t.locale();require("./locale/"+e);t.locale(n)}catch(i){}}return m[e]}function Ft(e,n){var i,r;if(n._isUTC){i=n.clone();r=(t.isMoment(e)||bt(e)?+e:+t(e))-+i;i._d.setTime(+i._d+r);t.updateOffset(i,false);return i}else{return t(e).local()}}ht(ut.prototype,{set:function(e){var t,n;for(n in e){t=e[n];if(typeof t==="function"){this[n]=t}else{this["_"+n]=t}}this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,n,i){var r,a,o;if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(r=0;r<12;r++){a=t.utc([2e3,r]);if(i&&!this._longMonthsParse[r]){this._longMonthsParse[r]=new RegExp("^"+this.months(a,"").replace(".","")+"$","i");this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(a,"").replace(".","")+"$","i")}if(!i&&!this._monthsParse[r]){o="^"+this.months(a,"")+"|^"+this.monthsShort(a,"");this._monthsParse[r]=new RegExp(o.replace(".",""),"i")}if(i&&n==="MMMM"&&this._longMonthsParse[r].test(e)){return r}else if(i&&n==="MMM"&&this._shortMonthsParse[r].test(e)){return r}else if(!i&&this._monthsParse[r].test(e)){return r}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var n,i,r;if(!this._weekdaysParse){this._weekdaysParse=[]}for(n=0;n<7;n++){if(!this._weekdaysParse[n]){i=t([2e3,1]).day(n);r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,"");this._weekdaysParse[n]=new RegExp(r.replace(".",""),"i")}if(this._weekdaysParse[n].test(e)){return n}}},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];if(!t&&this._longDateFormat[e.toUpperCase()]){t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)});this._longDateFormat[e]=t}return t},isPM:function(e){return(e+"").toLowerCase().charAt(0)==="p"},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){if(e>11){return n?"pm":"PM"}else{return n?"am":"AM"}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var i=this._calendar[e];return typeof i==="function"?i.apply(t,[n]):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var r=this._relativeTime[n];return typeof r==="function"?r(e,t,n,i):r.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n==="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return ln(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}});function Ot(e){if(e.match(/\[[\s\S]/)){return e.replace(/^\[|\]$/g,"")}return e.replace(/\\/g,"")}function Rt(e){var t=e.match(b),n,i;for(n=0,i=t.length;n<i;n++){if(X[t[n]]){t[n]=X[t[n]]}else{t[n]=Ot(t[n])}}return function(r){var a="";for(n=0;n<i;n++){a+=t[n]instanceof Function?t[n].call(r,e):t[n]}return a}}function Nt(e,t){if(!e.isValid()){return e.localeData().invalidDate()}t=Ht(t,e.localeData());if(!q[t]){q[t]=Rt(t)}return q[t](e)}function Ht(e,t){var n=5;function i(e){return t.longDateFormat(e)||e}C.lastIndex=0;while(n>=0&&C.test(e)){e=e.replace(C,i);C.lastIndex=0;n-=1}return e}function jt(e,t){var n,i=t._strict;switch(e){case"Q":return I;case"DDDD":return A;case"YYYY":case"GGGG":case"gggg":return i?F:x;case"Y":case"G":case"g":return R;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?O:k;case"S":if(i){return I}case"SS":if(i){return P}case"SSS":if(i){return A}case"DDD":return T;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return L;case"a":case"A":return t._locale._meridiemParse;case"x":return D;case"X":return V;case"Z":case"ZZ":return B;case"T":return E;case"SSSS":return M;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?P:S;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return S;case"Do":return i?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:n=new RegExp(Jt(Qt(e.replace("\\","")),"i"));return n}}function Ut(e){e=e||"";var t=e.match(B)||[],n=t[t.length-1]||[],i=(n+"").match(G)||["-",0,0],r=+(i[1]*60)+kt(i[2]);return i[0]==="+"?-r:r}function Gt(e,n,i){var r,a=i._a;switch(e){case"Q":if(n!=null){a[u]=(kt(n)-1)*3}break;case"M":case"MM":if(n!=null){a[u]=kt(n)-1}break;case"MMM":case"MMMM":r=i._locale.monthsParse(n,e,i._strict);if(r!=null){a[u]=r}else{i._pf.invalidMonth=n}break;case"D":case"DD":if(n!=null){a[c]=kt(n)}break;case"Do":if(n!=null){a[c]=kt(parseInt(n.match(/\d{1,2}/)[0],10))}break;case"DDD":case"DDDD":if(n!=null){i._dayOfYear=kt(n)}break;case"YY":a[l]=t.parseTwoDigitYear(n);break;case"YYYY":case"YYYYY":case"YYYYYY":a[l]=kt(n);break;case"a":case"A":i._isPm=i._locale.isPM(n);break;case"h":case"hh":i._pf.bigHour=true;case"H":case"HH":a[d]=kt(n);break;case"m":case"mm":a[h]=kt(n);break;case"s":case"ss":a[f]=kt(n);break;case"S":case"SS":case"SSS":case"SSSS":a[p]=kt(("0."+n)*1e3);break;case"x":i._d=new Date(kt(n));break;case"X":i._d=new Date(parseFloat(n)*1e3);break;case"Z":case"ZZ":i._useUTC=true;i._tzm=Ut(n);break;case"dd":case"ddd":case"dddd":r=i._locale.weekdaysParse(n);if(r!=null){i._w=i._w||{};i._w["d"]=r}else{i._pf.invalidWeekday=n}break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2);if(n){i._w=i._w||{};i._w[e]=kt(n)}break;case"gg":case"GG":i._w=i._w||{};i._w[e]=t.parseTwoDigitYear(n)}}function Wt(e){var n,i,r,a,o,s,u;n=e._w;if(n.GG!=null||n.W!=null||n.E!=null){o=1;s=4;i=tt(n.GG,e._a[l],ln(t(),1,4).year);r=tt(n.W,1);a=tt(n.E,1)}else{o=e._locale._week.dow;s=e._locale._week.doy;i=tt(n.gg,e._a[l],ln(t(),o,s).year);r=tt(n.w,1);if(n.d!=null){a=n.d;if(a<o){++r}}else if(n.e!=null){a=n.e+o}else{a=o}}u=un(i,r,a,s,o);e._a[l]=u.year;e._dayOfYear=u.dayOfYear}function Kt(e){var t,n,i=[],r,a;if(e._d){return}r=Yt(e);if(e._w&&e._a[c]==null&&e._a[u]==null){Wt(e)}if(e._dayOfYear){a=tt(e._a[l],r[l]);if(e._dayOfYear>Bt(a)){e._pf._overflowDayOfYear=true}n=rn(a,0,e._dayOfYear);e._a[u]=n.getUTCMonth();e._a[c]=n.getUTCDate()}for(t=0;t<3&&e._a[t]==null;++t){e._a[t]=i[t]=r[t]}for(;t<7;t++){e._a[t]=i[t]=e._a[t]==null?t===2?1:0:e._a[t]}if(e._a[d]===24&&e._a[h]===0&&e._a[f]===0&&e._a[p]===0){e._nextDay=true;e._a[d]=0}e._d=(e._useUTC?rn:nn).apply(null,i);if(e._tzm!=null){e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm)}if(e._nextDay){e._a[d]=24}}function zt(e){var t;if(e._d){return}t=Tt(e._i);e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond];Kt(e)}function Yt(e){var t=new Date;if(e._useUTC){return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]}else{return[t.getFullYear(),t.getMonth(),t.getDate()]}}function qt(n){if(n._f===t.ISO_8601){Xt(n);return}n._a=[];n._pf.empty=true;var i=""+n._i,r,a,o,s,l,u=i.length,c=0;o=Ht(n._f,n._locale).match(b)||[];for(r=0;r<o.length;r++){s=o[r];a=(i.match(jt(s,n))||[])[0];if(a){l=i.substr(0,i.indexOf(a));if(l.length>0){n._pf.unusedInput.push(l)}i=i.slice(i.indexOf(a)+a.length);c+=a.length}if(X[s]){if(a){n._pf.empty=false}else{n._pf.unusedTokens.push(s)}Gt(s,a,n)}else if(n._strict&&!a){n._pf.unusedTokens.push(s)}}n._pf.charsLeftOver=u-c;if(i.length>0){n._pf.unusedInput.push(i)}if(n._pf.bigHour===true&&n._a[d]<=12){n._pf.bigHour=e}if(n._isPm&&n._a[d]<12){n._a[d]+=12}if(n._isPm===false&&n._a[d]===12){n._a[d]=0}Kt(n);Dt(n)}function Qt(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,r){return t||n||i||r})}function Jt(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function $t(e){var t,n,i,r,a;if(e._f.length===0){e._pf.invalidFormat=true;e._d=new Date(NaN);return}for(r=0;r<e._f.length;r++){a=0;t=ft({},e);if(e._useUTC!=null){t._useUTC=e._useUTC}t._pf=it();t._f=e._f[r];qt(t);if(!Vt(t)){continue}a+=t._pf.charsLeftOver;a+=t._pf.unusedTokens.length*10;t._pf.score=a;if(i==null||a<i){i=a;n=t}}ht(e,n||t)}function Xt(e){var t,n,i=e._i,r=N.exec(i);if(r){e._pf.iso=true;for(t=0,n=j.length;t<n;t++){if(j[t][1].exec(i)){e._f=j[t][0]+(r[6]||" ");break}}for(t=0,n=U.length;t<n;t++){if(U[t][1].exec(i)){e._f+=U[t][0];break}}if(i.match(B)){e._f+="Z"}qt(e)}else{e._isValid=false}}function Zt(e){Xt(e);if(e._isValid===false){delete e._isValid;t.createFromInputFallback(e)}}function en(e,t){var n=[],i;for(i=0;i<e.length;++i){n.push(t(e[i],i))}return n}function tn(n){var i=n._i,r;if(i===e){n._d=new Date}else if(bt(i)){n._d=new Date(+i)}else if((r=v.exec(i))!==null){n._d=new Date(+r[1])}else if(typeof i==="string"){Zt(n)}else if(wt(i)){n._a=en(i.slice(0),function(e){return parseInt(e,10)});Kt(n)}else if(typeof i==="object"){zt(n)}else if(typeof i==="number"){n._d=new Date(i)}else{t.createFromInputFallback(n)}}function nn(e,t,n,i,r,a,o){var s=new Date(e,t,n,i,r,a,o);if(e<1970){s.setFullYear(e)}return s}function rn(e){var t=new Date(Date.UTC.apply(null,arguments));if(e<1970){t.setUTCFullYear(e)}return t}function an(e,t){if(typeof e==="string"){if(!isNaN(e)){e=parseInt(e,10)}else{e=t.weekdaysParse(e);if(typeof e!=="number"){return null}}}return e}function on(e,t,n,i,r){return r.relativeTime(t||1,!!n,e,i)}function sn(e,n,i){var r=t.duration(e).abs(),o=a(r.as("s")),s=a(r.as("m")),l=a(r.as("h")),u=a(r.as("d")),c=a(r.as("M")),d=a(r.as("y")),h=o<Q.s&&["s",o]||s===1&&["m"]||s<Q.m&&["mm",s]||l===1&&["h"]||l<Q.h&&["hh",l]||u===1&&["d"]||u<Q.d&&["dd",u]||c===1&&["M"]||c<Q.M&&["MM",c]||d===1&&["y"]||["yy",d];h[2]=n;h[3]=+e>0;h[4]=i;return on.apply({},h)}function ln(e,n,i){var r=i-n,a=i-e.day(),o;if(a>r){a-=7}if(a<r-7){a+=7}o=t(e).add(a,"d");return{week:Math.ceil(o.dayOfYear()/7),year:o.year()}}function un(e,t,n,i,r){var a=rn(e,0,1).getUTCDay(),o,s;a=a===0?7:a;n=n!=null?n:r;o=r-a+(a>i?7:0)-(a<r?7:0);s=7*(t-1)+(n-r)+o+1;return{year:s>0?e:e-1,dayOfYear:s>0?s:Bt(e-1)+s}}function cn(n){var i=n._i,r=n._f,a;n._locale=n._locale||t.localeData(n._l);if(i===null||r===e&&i===""){return t.invalid({nullInput:true})}if(typeof i==="string"){n._i=i=n._locale.preparse(i)}if(t.isMoment(i)){return new ct(i,true)}else if(r){if(wt(r)){$t(n)}else{qt(n)}}else{tn(n)}a=new ct(n);if(a._nextDay){a.add(1,"d");a._nextDay=e}return a}t=function(t,n,i,r){var a;if(typeof i==="boolean"){r=i;i=e}a={};a._isAMomentObject=true;a._i=t;a._f=n;a._l=i;a._strict=r;a._isUTC=false;a._pf=it();return cn(a)};t.suppressDeprecationWarnings=false;t.createFromInputFallback=at("moment construction falls back to js Date. This is "+"discouraged and will be removed in upcoming major "+"release. Please refer to "+"https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))});function dn(e,n){var i,r;if(n.length===1&&wt(n[0])){n=n[0]}if(!n.length){return t()}i=n[0];for(r=1;r<n.length;++r){if(n[r][e](i)){i=n[r]}}return i}t.min=function(){var e=[].slice.call(arguments,0);return dn("isBefore",e)};t.max=function(){var e=[].slice.call(arguments,0);return dn("isAfter",e)};t.utc=function(t,n,i,r){var a;if(typeof i==="boolean"){r=i;i=e}a={};a._isAMomentObject=true;a._useUTC=true;a._isUTC=true;a._l=i;a._i=t;a._f=n;a._strict=r;a._pf=it();return cn(a).utc()};t.unix=function(e){return t(e*1e3)};t.duration=function(e,n){var i=e,r=null,a,o,s,l;if(t.isDuration(e)){i={ms:e._milliseconds,d:e._days,M:e._months}}else if(typeof e==="number"){i={};if(n){i[n]=e}else{i.milliseconds=e}}else if(!!(r=y.exec(e))){a=r[1]==="-"?-1:1;i={y:0,d:kt(r[c])*a,h:kt(r[d])*a,m:kt(r[h])*a,s:kt(r[f])*a,ms:kt(r[p])*a}}else if(!!(r=w.exec(e))){a=r[1]==="-"?-1:1;s=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*a};i={y:s(r[2]),M:s(r[3]),d:s(r[4]),h:s(r[5]),m:s(r[6]),s:s(r[7]),w:s(r[8])}}else if(typeof i==="object"&&("from"in i||"to"in i)){l=gt(t(i.from),t(i.to));i={};i.ms=l.milliseconds;i.M=l.months}o=new dt(i);if(t.isDuration(e)&&nt(e,"_locale")){o._locale=e._locale}return o};t.version=n;t.defaultFormat=H;t.ISO_8601=function(){};t.momentProperties=_;t.updateOffset=function(){};t.relativeTimeThreshold=function(t,n){if(Q[t]===e){return false}if(n===e){return Q[t]}Q[t]=n;return true};t.lang=at("moment.lang is deprecated. Use moment.locale instead.",function(e,n){return t.locale(e,n)});t.locale=function(e,n){var i;if(e){if(typeof n!=="undefined"){i=t.defineLocale(e,n)}else{i=t.localeData(e)}if(i){t.duration._locale=t._locale=i}}return t._locale._abbr};t.defineLocale=function(e,n){if(n!==null){n.abbr=e;if(!m[e]){m[e]=new ut}m[e].set(n);t.locale(e);return m[e]}else{delete m[e];return null}};t.langData=at("moment.langData is deprecated. Use moment.localeData instead.",function(e){return t.localeData(e)});t.localeData=function(e){var n;if(e&&e._locale&&e._locale._abbr){e=e._locale._abbr}if(!e){return t._locale}if(!wt(e)){n=At(e);if(n){return n}e=[e]}return Pt(e)};t.isMoment=function(e){return e instanceof ct||e!=null&&nt(e,"_isAMomentObject")};t.isDuration=function(e){return e instanceof dt};for(s=et.length-1;s>=0;--s){xt(et[s])}t.normalizeUnits=function(e){return St(e)};t.invalid=function(e){var n=t.utc(NaN);if(e!=null){ht(n._pf,e)}else{n._pf.userInvalidated=true}return n};t.parseZone=function(){return t.apply(null,arguments).parseZone()};t.parseTwoDigitYear=function(e){return kt(e)+(kt(e)>68?1900:2e3)};ht(t.fn=ct.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d+(this._offset||0)*6e4},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=t(this).utc();if(0<e.year()&&e.year()<=9999){if("function"===typeof Date.prototype.toISOString){return this.toDate().toISOString()}else{return Nt(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}else{return Nt(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return Vt(this)},isDSTShifted:function(){if(this._a){return this.isValid()&&Ct(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0}return false},parsingFlags:function(){return ht({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){if(this._isUTC){this.zone(0,e);this._isUTC=false;if(e){this.add(this._dateTzOffset(),"m")}}return this},format:function(e){var n=Nt(this,e||t.defaultFormat);return this.localeData().postformat(n)},add:vt(1,"add"),subtract:vt(-1,"subtract"),diff:function(e,n,i){var r=Ft(e,this),a=(this.zone()-r.zone())*6e4,o,s,l;n=St(n);if(n==="year"||n==="month"){o=(this.daysInMonth()+r.daysInMonth())*432e5;s=(this.year()-r.year())*12+(this.month()-r.month());l=this-t(this).startOf("month")-(r-t(r).startOf("month"));l-=(this.zone()-t(this).startOf("month").zone()-(r.zone()-t(r).startOf("month").zone()))*6e4;s+=l/o;if(n==="year"){s=s/12}}else{o=this-r;s=n==="second"?o/1e3:n==="minute"?o/6e4:n==="hour"?o/36e5:n==="day"?(o-a)/864e5:n==="week"?(o-a)/6048e5:o}return i?s:pt(s)},from:function(e,n){return t.duration({to:this,from:e}).locale(this.locale()).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(e){var n=e||t(),i=Ft(n,this).startOf("day"),r=this.diff(i,"days",true),a=r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(a,this,t(n)))},isLeapYear:function(){return Et(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){e=an(e,this.localeData());return this.add(e-t,"d")}else{return t}},month:mn("Month",true),startOf:function(e){e=St(e);switch(e){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(e==="week"){this.weekday(0)}else if(e==="isoWeek"){this.isoWeekday(1)}if(e==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this},endOf:function(t){t=St(t);if(t===e||t==="millisecond"){return this}return this.startOf(t).add(1,t==="isoWeek"?"week":t).subtract(1,"ms")},isAfter:function(e,n){var i;n=St(typeof n!=="undefined"?n:"millisecond");if(n==="millisecond"){e=t.isMoment(e)?e:t(e);return+this>+e}else{i=t.isMoment(e)?+e:+t(e);return i<+this.clone().startOf(n)}},isBefore:function(e,n){var i;n=St(typeof n!=="undefined"?n:"millisecond");if(n==="millisecond"){e=t.isMoment(e)?e:t(e);return+this<+e}else{i=t.isMoment(e)?+e:+t(e);return+this.clone().endOf(n)<i}},isSame:function(e,n){var i;n=St(n||"millisecond");if(n==="millisecond"){e=t.isMoment(e)?e:t(e);return+this===+e}else{i=+t(e);return+this.clone().startOf(n)<=i&&i<=+this.clone().endOf(n)}},min:at("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){e=t.apply(null,arguments);return e<this?this:e}),max:at("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){e=t.apply(null,arguments);return e>this?this:e}),zone:function(e,n){var i=this._offset||0,r;if(e!=null){if(typeof e==="string"){e=Ut(e)}if(Math.abs(e)<16){e=e*60}if(!this._isUTC&&n){r=this._dateTzOffset()}this._offset=e;this._isUTC=true;if(r!=null){this.subtract(r,"m")}if(i!==e){if(!n||this._changeInProgress){yt(this,t.duration(i-e,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;t.updateOffset(this,true);this._changeInProgress=null}}}else{return this._isUTC?i:this._dateTzOffset()}return this},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){if(this._tzm){this.zone(this._tzm)}else if(typeof this._i==="string"){this.zone(this._i)}return this},hasAlignedHourOffset:function(e){if(!e){e=0}else{e=t(e).zone()}return(this.zone()-e)%60===0},daysInMonth:function(){return Mt(this.year(),this.month())},dayOfYear:function(e){var n=a((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return e==null?n:this.add(e-n,"d")},quarter:function(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)},weekYear:function(e){var t=ln(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return e==null?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=ln(this,1,4).year;return e==null?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")},isoWeek:function(e){var t=ln(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")},isoWeekday:function(e){return e==null?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return Lt(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return Lt(this.year(),e.dow,e.doy)},get:function(e){e=St(e);return this[e]()},set:function(e,t){e=St(e);if(typeof this[e]==="function"){this[e](t)}return this},locale:function(n){var i;if(n===e){return this._locale._abbr}else{i=t.localeData(n);if(i!=null){this._locale=i}return this}},lang:at("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){if(t===e){return this.localeData()}else{return this.locale(t)}}),localeData:function(){return this._locale},_dateTzOffset:function(){return Math.round(this._d.getTimezoneOffset()/15)*15}});function hn(e,t){var n;if(typeof t==="string"){t=e.localeData().monthsParse(t);if(typeof t!=="number"){return e}}n=Math.min(e.date(),Mt(e.year(),t));e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n);return e}function fn(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function pn(e,t,n){if(t==="Month"){return hn(e,n)}else{return e._d["set"+(e._isUTC?"UTC":"")+t](n)}}function mn(e,n){return function(i){if(i!=null){pn(this,e,i);t.updateOffset(this,n);return this}else{return fn(this,e)}}}t.fn.millisecond=t.fn.milliseconds=mn("Milliseconds",false);t.fn.second=t.fn.seconds=mn("Seconds",false);t.fn.minute=t.fn.minutes=mn("Minutes",false);t.fn.hour=t.fn.hours=mn("Hours",true);t.fn.date=mn("Date",true);t.fn.dates=at("dates accessor is deprecated. Use date instead.",mn("Date",true));t.fn.year=mn("FullYear",true);t.fn.years=at("years accessor is deprecated. Use year instead.",mn("FullYear",true));t.fn.days=t.fn.day;t.fn.months=t.fn.month;t.fn.weeks=t.fn.week;t.fn.isoWeeks=t.fn.isoWeek;t.fn.quarters=t.fn.quarter;t.fn.toJSON=t.fn.toISOString;function _n(e){return e*400/146097}function gn(e){return e*146097/400}ht(t.duration.fn=dt.prototype,{_bubble:function(){var e=this._milliseconds,t=this._days,n=this._months,i=this._data,r,a,o,s=0;i.milliseconds=e%1e3;r=pt(e/1e3);i.seconds=r%60;a=pt(r/60);i.minutes=a%60;o=pt(a/60);i.hours=o%24;t+=pt(o/24);s=pt(_n(t));t-=pt(gn(s));n+=pt(t/30);t%=30;s+=pt(n/12);n%=12;i.days=t;i.months=n;i.years=s},abs:function(){this._milliseconds=Math.abs(this._milliseconds);this._days=Math.abs(this._days);this._months=Math.abs(this._months);this._data.milliseconds=Math.abs(this._data.milliseconds);this._data.seconds=Math.abs(this._data.seconds);this._data.minutes=Math.abs(this._data.minutes);this._data.hours=Math.abs(this._data.hours);this._data.months=Math.abs(this._data.months);this._data.years=Math.abs(this._data.years);return this},weeks:function(){return pt(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+kt(this._months/12)*31536e6},humanize:function(e){var t=sn(this,!e,this.localeData());if(e){t=this.localeData().pastFuture(+this,t)}return this.localeData().postformat(t)},add:function(e,n){var i=t.duration(e,n);
this._milliseconds+=i._milliseconds;this._days+=i._days;this._months+=i._months;this._bubble();return this},subtract:function(e,n){var i=t.duration(e,n);this._milliseconds-=i._milliseconds;this._days-=i._days;this._months-=i._months;this._bubble();return this},get:function(e){e=St(e);return this[e.toLowerCase()+"s"]()},as:function(e){var t,n;e=St(e);if(e==="month"||e==="year"){t=this._days+this._milliseconds/864e5;n=this._months+_n(t)*12;return e==="month"?n:n/12}else{t=this._days+Math.round(gn(this._months/12));switch(e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return t*24+this._milliseconds/36e5;case"minute":return t*24*60+this._milliseconds/6e4;case"second":return t*24*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(t*24*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}}},lang:t.fn.lang,locale:t.fn.locale,toIsoString:at("toIsoString() is deprecated. Please use toISOString() instead "+"(notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),r=Math.abs(this.minutes()),a=Math.abs(this.seconds()+this.milliseconds()/1e3);if(!this.asSeconds()){return"P0D"}return(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(i||r||a?"T":"")+(i?i+"H":"")+(r?r+"M":"")+(a?a+"S":"")},localeData:function(){return this._locale}});t.duration.fn.toString=t.duration.fn.toISOString;function vn(e){t.duration.fn[e]=function(){return this._data[e]}}for(s in K){if(nt(K,s)){vn(s.toLowerCase())}}t.duration.fn.asMilliseconds=function(){return this.as("ms")};t.duration.fn.asSeconds=function(){return this.as("s")};t.duration.fn.asMinutes=function(){return this.as("m")};t.duration.fn.asHours=function(){return this.as("h")};t.duration.fn.asDays=function(){return this.as("d")};t.duration.fn.asWeeks=function(){return this.as("weeks")};t.duration.fn.asMonths=function(){return this.as("M")};t.duration.fn.asYears=function(){return this.as("y")};t.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=kt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}});(function(e){e(t)})(function(e){return e.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiem:function(e,t,n){if(e<12){return n?"vm":"VM"}else{return n?"nm":"NM"}},longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Môre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(e===1||e===8||e>=20?"ste":"de")},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("ar-ma",{months:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),monthsShort:"يناير_فبراير_مارس_أبريل_ماي_يونيو_يوليوز_غشت_شتنبر_أكتوبر_نونبر_دجنبر".split("_"),weekdays:"الأحد_الإتنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"احد_اتنين_ثلاثاء_اربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){var t={1:"١",2:"٢",3:"٣",4:"٤",5:"٥",6:"٦",7:"٧",8:"٨",9:"٩",0:"٠"},n={"١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","٠":"0"};return e.defineLocale("ar-sa",{months:"يناير_فبراير_مارس_أبريل_مايو_يونيو_يوليو_أغسطس_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),monthsShort:"يناير_فبراير_مارس_أبريل_مايو_يونيو_يوليو_أغسطس_سبتمبر_أكتوبر_نوفمبر_ديسمبر".split("_"),weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiem:function(e,t,n){if(e<12){return"ص"}else{return"م"}},calendar:{sameDay:"[اليوم على الساعة] LT",nextDay:"[غدا على الساعة] LT",nextWeek:"dddd [على الساعة] LT",lastDay:"[أمس على الساعة] LT",lastWeek:"dddd [على الساعة] LT",sameElse:"L"},relativeTime:{future:"في %s",past:"منذ %s",s:"ثوان",m:"دقيقة",mm:"%d دقائق",h:"ساعة",hh:"%d ساعات",d:"يوم",dd:"%d أيام",M:"شهر",MM:"%d أشهر",y:"سنة",yy:"%d سنوات"},preparse:function(e){return e.replace(/[١٢٣٤٥٦٧٨٩٠]/g,function(e){return n[e]}).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"،")},week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){var t={1:"١",2:"٢",3:"٣",4:"٤",5:"٥",6:"٦",7:"٧",8:"٨",9:"٩",0:"٠"},n={"١":"1","٢":"2","٣":"3","٤":"4","٥":"5","٦":"6","٧":"7","٨":"8","٩":"9","٠":"0"},i=function(e){return e===0?0:e===1?1:e===2?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},r={s:["أقل من ثانية","ثانية واحدة",["ثانيتان","ثانيتين"],"%d ثوان","%d ثانية","%d ثانية"],m:["أقل من دقيقة","دقيقة واحدة",["دقيقتان","دقيقتين"],"%d دقائق","%d دقيقة","%d دقيقة"],h:["أقل من ساعة","ساعة واحدة",["ساعتان","ساعتين"],"%d ساعات","%d ساعة","%d ساعة"],d:["أقل من يوم","يوم واحد",["يومان","يومين"],"%d أيام","%d يومًا","%d يوم"],M:["أقل من شهر","شهر واحد",["شهران","شهرين"],"%d أشهر","%d شهرا","%d شهر"],y:["أقل من عام","عام واحد",["عامان","عامين"],"%d أعوام","%d عامًا","%d عام"]},a=function(e){return function(t,n,a,o){var s=i(t),l=r[e][i(t)];if(s===2){l=l[n?0:1]}return l.replace(/%d/i,t)}},o=["كانون الثاني يناير","شباط فبراير","آذار مارس","نيسان أبريل","أيار مايو","حزيران يونيو","تموز يوليو","آب أغسطس","أيلول سبتمبر","تشرين الأول أكتوبر","تشرين الثاني نوفمبر","كانون الأول ديسمبر"];return e.defineLocale("ar",{months:o,monthsShort:o,weekdays:"الأحد_الإثنين_الثلاثاء_الأربعاء_الخميس_الجمعة_السبت".split("_"),weekdaysShort:"أحد_إثنين_ثلاثاء_أربعاء_خميس_جمعة_سبت".split("_"),weekdaysMin:"ح_ن_ث_ر_خ_ج_س".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},meridiem:function(e,t,n){if(e<12){return"ص"}else{return"م"}},calendar:{sameDay:"[اليوم عند الساعة] LT",nextDay:"[غدًا عند الساعة] LT",nextWeek:"dddd [عند الساعة] LT",lastDay:"[أمس عند الساعة] LT",lastWeek:"dddd [عند الساعة] LT",sameElse:"L"},relativeTime:{future:"بعد %s",past:"منذ %s",s:a("s"),m:a("m"),mm:a("m"),h:a("h"),hh:a("h"),d:a("d"),dd:a("d"),M:a("M"),MM:a("M"),y:a("y"),yy:a("y")},preparse:function(e){return e.replace(/[١٢٣٤٥٦٧٨٩٠]/g,function(e){return n[e]}).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"،")},week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){var t={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-üncü",4:"-üncü",100:"-üncü",6:"-ncı",9:"-uncu",10:"-uncu",30:"-uncu",60:"-ıncı",90:"-ıncı"};return e.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertəsi_Çərşənbə axşamı_Çərşənbə_Cümə axşamı_Cümə_Şənbə".split("_"),weekdaysShort:"Baz_BzE_ÇAx_Çər_CAx_Cüm_Şən".split("_"),weekdaysMin:"Bz_BE_ÇA_Çə_CA_Cü_Şə".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugün saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gələn həftə] dddd [saat] LT",lastDay:"[dünən] LT",lastWeek:"[keçən həftə] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s əvvəl",s:"birneçə saniyyə",m:"bir dəqiqə",mm:"%d dəqiqə",h:"bir saat",hh:"%d saat",d:"bir gün",dd:"%d gün",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiem:function(e,t,n){if(e<4){return"gecə"}else if(e<12){return"səhər"}else if(e<17){return"gündüz"}else{return"axşam"}},ordinalParse:/\d{1,2}-(ıncı|inci|nci|üncü|ncı|uncu)/,ordinal:function(e){if(e===0){return e+"-ıncı"}var n=e%10,i=e%100-n,r=e>=100?100:null;return e+(t[n]||t[i]||t[r])},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?n[1]:n[2]}function n(e,n,i){var r={mm:n?"хвіліна_хвіліны_хвілін":"хвіліну_хвіліны_хвілін",hh:n?"гадзіна_гадзіны_гадзін":"гадзіну_гадзіны_гадзін",dd:"дзень_дні_дзён",MM:"месяц_месяцы_месяцаў",yy:"год_гады_гадоў"};if(i==="m"){return n?"хвіліна":"хвіліну"}else if(i==="h"){return n?"гадзіна":"гадзіну"}else{return e+" "+t(r[i],+e)}}function i(e,t){var n={nominative:"студзень_люты_сакавік_красавік_травень_чэрвень_ліпень_жнівень_верасень_кастрычнік_лістапад_снежань".split("_"),accusative:"студзеня_лютага_сакавіка_красавіка_траўня_чэрвеня_ліпеня_жніўня_верасня_кастрычніка_лістапада_снежня".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function r(e,t){var n={nominative:"нядзеля_панядзелак_аўторак_серада_чацвер_пятніца_субота".split("_"),accusative:"нядзелю_панядзелак_аўторак_сераду_чацвер_пятніцу_суботу".split("_")},i=/\[ ?[Вв] ?(?:мінулую|наступную)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("be",{months:i,monthsShort:"студ_лют_сак_крас_трав_чэрв_ліп_жнів_вер_каст_ліст_снеж".split("_"),weekdays:r,weekdaysShort:"нд_пн_ат_ср_чц_пт_сб".split("_"),weekdaysMin:"нд_пн_ат_ср_чц_пт_сб".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сёння ў] LT",nextDay:"[Заўтра ў] LT",lastDay:"[Учора ў] LT",nextWeek:function(){return"[У] dddd [ў] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[У мінулую] dddd [ў] LT";case 1:case 2:case 4:return"[У мінулы] dddd [ў] LT"}},sameElse:"L"},relativeTime:{future:"праз %s",past:"%s таму",s:"некалькі секунд",m:n,mm:n,h:n,hh:n,d:"дзень",dd:n,M:"месяц",MM:n,y:"год",yy:n},meridiem:function(e,t,n){if(e<4){return"ночы"}else if(e<12){return"раніцы"}else if(e<17){return"дня"}else{return"вечара"}},ordinalParse:/\d{1,2}-(і|ы|га)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return(e%10===2||e%10===3)&&(e%100!==12&&e%100!==13)?e+"-і":e+"-ы";case"D":return e+"-га";default:return e}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("bg",{months:"януари_февруари_март_април_май_юни_юли_август_септември_октомври_ноември_декември".split("_"),monthsShort:"янр_фев_мар_апр_май_юни_юли_авг_сеп_окт_ное_дек".split("_"),weekdays:"неделя_понеделник_вторник_сряда_четвъртък_петък_събота".split("_"),weekdaysShort:"нед_пон_вто_сря_чет_пет_съб".split("_"),weekdaysMin:"нд_пн_вт_ср_чт_пт_сб".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Днес в] LT",nextDay:"[Утре в] LT",nextWeek:"dddd [в] LT",lastDay:"[Вчера в] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[В изминалата] dddd [в] LT";case 1:case 2:case 4:case 5:return"[В изминалия] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"след %s",past:"преди %s",s:"няколко секунди",m:"минута",mm:"%d минути",h:"час",hh:"%d часа",d:"ден",dd:"%d дни",M:"месец",MM:"%d месеца",y:"година",yy:"%d години"},ordinalParse:/\d{1,2}-(ев|ен|ти|ви|ри|ми)/,ordinal:function(e){var t=e%10,n=e%100;if(e===0){return e+"-ев"}else if(n===0){return e+"-ен"}else if(n>10&&n<20){return e+"-ти"}else if(t===1){return e+"-ви"}else if(t===2){return e+"-ри"}else if(t===7||t===8){return e+"-ми"}else{return e+"-ти"}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t={1:"১",2:"২",3:"৩",4:"৪",5:"৫",6:"৬",7:"৭",8:"৮",9:"৯",0:"০"},n={"১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9","০":"0"};return e.defineLocale("bn",{months:"জানুয়ারী_ফেবুয়ারী_মার্চ_এপ্রিল_মে_জুন_জুলাই_অগাস্ট_সেপ্টেম্বর_অক্টোবর_নভেম্বর_ডিসেম্বর".split("_"),monthsShort:"জানু_ফেব_মার্চ_এপর_মে_জুন_জুল_অগ_সেপ্ট_অক্টো_নভ_ডিসেম্".split("_"),weekdays:"রবিবার_সোমবার_মঙ্গলবার_বুধবার_বৃহস্পত্তিবার_শুক্রুবার_শনিবার".split("_"),weekdaysShort:"রবি_সোম_মঙ্গল_বুধ_বৃহস্পত্তি_শুক্রু_শনি".split("_"),weekdaysMin:"রব_সম_মঙ্গ_বু_ব্রিহ_শু_শনি".split("_"),longDateFormat:{LT:"A h:mm সময়",LTS:"A h:mm:ss সময়",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[আজ] LT",nextDay:"[আগামীকাল] LT",nextWeek:"dddd, LT",lastDay:"[গতকাল] LT",lastWeek:"[গত] dddd, LT",sameElse:"L"},relativeTime:{future:"%s পরে",past:"%s আগে",s:"কএক সেকেন্ড",m:"এক মিনিট",mm:"%d মিনিট",h:"এক ঘন্টা",hh:"%d ঘন্টা",d:"এক দিন",dd:"%d দিন",M:"এক মাস",MM:"%d মাস",y:"এক বছর",yy:"%d বছর"},preparse:function(e){return e.replace(/[১২৩৪৫৬৭৮৯০]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e,t,n){if(e<4){return"রাত"}else if(e<10){return"শকাল"}else if(e<17){return"দুপুর"}else if(e<20){return"বিকেল"}else{return"রাত"}},week:{dow:0,doy:6}})});(function(e){e(t)})(function(e){var t={1:"༡",2:"༢",3:"༣",4:"༤",5:"༥",6:"༦",7:"༧",8:"༨",9:"༩",0:"༠"},n={"༡":"1","༢":"2","༣":"3","༤":"4","༥":"5","༦":"6","༧":"7","༨":"8","༩":"9","༠":"0"};return e.defineLocale("bo",{months:"ཟླ་བ་དང་པོ_ཟླ་བ་གཉིས་པ_ཟླ་བ་གསུམ་པ_ཟླ་བ་བཞི་པ_ཟླ་བ་ལྔ་པ_ཟླ་བ་དྲུག་པ_ཟླ་བ་བདུན་པ_ཟླ་བ་བརྒྱད་པ_ཟླ་བ་དགུ་པ_ཟླ་བ་བཅུ་པ_ཟླ་བ་བཅུ་གཅིག་པ_ཟླ་བ་བཅུ་གཉིས་པ".split("_"),monthsShort:"ཟླ་བ་དང་པོ_ཟླ་བ་གཉིས་པ_ཟླ་བ་གསུམ་པ_ཟླ་བ་བཞི་པ_ཟླ་བ་ལྔ་པ_ཟླ་བ་དྲུག་པ_ཟླ་བ་བདུན་པ_ཟླ་བ་བརྒྱད་པ_ཟླ་བ་དགུ་པ_ཟླ་བ་བཅུ་པ_ཟླ་བ་བཅུ་གཅིག་པ_ཟླ་བ་བཅུ་གཉིས་པ".split("_"),weekdays:"གཟའ་ཉི་མ་_གཟའ་ཟླ་བ་_གཟའ་མིག་དམར་_གཟའ་ལྷག་པ་_གཟའ་ཕུར་བུ_གཟའ་པ་སངས་_གཟའ་སྤེན་པ་".split("_"),weekdaysShort:"ཉི་མ་_ཟླ་བ་_མིག་དམར་_ལྷག་པ་_ཕུར་བུ_པ་སངས་_སྤེན་པ་".split("_"),weekdaysMin:"ཉི་མ་_ཟླ་བ་_མིག་དམར་_ལྷག་པ་_ཕུར་བུ_པ་སངས་_སྤེན་པ་".split("_"),longDateFormat:{LT:"A h:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[དི་རིང] LT",nextDay:"[སང་ཉིན] LT",nextWeek:"[བདུན་ཕྲག་རྗེས་མ], LT",lastDay:"[ཁ་སང] LT",lastWeek:"[བདུན་ཕྲག་མཐའ་མ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ལ་",past:"%s སྔན་ལ",s:"ལམ་སང",m:"སྐར་མ་གཅིག",mm:"%d སྐར་མ",h:"ཆུ་ཚོད་གཅིག",hh:"%d ཆུ་ཚོད",d:"ཉིན་གཅིག",dd:"%d ཉིན་",M:"ཟླ་བ་གཅིག",MM:"%d ཟླ་བ",y:"ལོ་གཅིག",yy:"%d ལོ"},preparse:function(e){return e.replace(/[༡༢༣༤༥༦༧༨༩༠]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e,t,n){if(e<4){return"མཚན་མོ"}else if(e<10){return"ཞོགས་ཀས"}else if(e<17){return"ཉིན་གུང"}else if(e<20){return"དགོང་དག"}else{return"མཚན་མོ"}},week:{dow:0,doy:6}})});(function(e){e(t)})(function(t){function n(e,t,n){var i={mm:"munutenn",MM:"miz",dd:"devezh"};return e+" "+a(i[n],e)}function i(e){switch(r(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}function r(e){if(e>9){return r(e%10)}return e}function a(e,t){if(t===2){return o(e)}return e}function o(t){var n={m:"v",b:"v",d:"z"};if(n[t.charAt(0)]===e){return t}return n[t.charAt(0)]+t.substring(1)}return t.defineLocale("br",{months:"Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),longDateFormat:{LT:"h[e]mm A",LTS:"h[e]mm:ss A",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY LT",LLLL:"dddd, D [a viz] MMMM YYYY LT"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warc'hoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dec'h da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s 'zo",s:"un nebeud segondennoù",m:"ur vunutenn",mm:n,h:"un eur",hh:"%d eur",d:"un devezh",dd:n,M:"ur miz",MM:n,y:"ur bloaz",yy:i},ordinalParse:/\d{1,2}(añ|vet)/,ordinal:function(e){var t=e===1?"añ":"vet";return e+t},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";case"mm":if(e===1){i+="minuta"}else if(e===2||e===3||e===4){i+="minute"}else{i+="minuta"}return i;case"h":return t?"jedan sat":"jednog sata";case"hh":if(e===1){i+="sat"}else if(e===2||e===3||e===4){i+="sata"}else{i+="sati"}return i;case"dd":if(e===1){i+="dan"}else{i+="dana"}return i;case"MM":if(e===1){i+="mjesec"}else if(e===2||e===3||e===4){i+="mjeseca"}else{i+="mjeseci"}return i;case"yy":if(e===1){i+="godina"}else if(e===2||e===3||e===4){i+="godine"}else{i+="godina"}return i}}return e.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jučer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prošlu] dddd [u] LT";case 6:return"[prošle] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[prošli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("ca",{months:"gener_febrer_març_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),monthsShort:"gen._febr._mar._abr._mai._jun._jul._ag._set._oct._nov._des.".split("_"),weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"Dg_Dl_Dt_Dc_Dj_Dv_Ds".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[avui a "+(this.hours()!==1?"les":"la")+"] LT"},nextDay:function(){return"[demà a "+(this.hours()!==1?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(this.hours()!==1?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(this.hours()!==1?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(this.hours()!==1?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"fa %s",s:"uns segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},ordinalParse:/\d{1,2}(r|n|t|è|a)/,ordinal:function(e,t){var n=e===1?"r":e===2?"n":e===3?"r":e===4?"t":"è";if(t==="w"||t==="W"){n="a"}return e+n},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t="leden_únor_březen_duben_květen_červen_červenec_srpen_září_říjen_listopad_prosinec".split("_"),n="led_úno_bře_dub_kvě_čvn_čvc_srp_zář_říj_lis_pro".split("_");function i(e){return e>1&&e<5&&~~(e/10)!==1}function r(e,t,n,r){var a=e+" ";switch(n){case"s":return t||r?"pár sekund":"pár sekundami";case"m":return t?"minuta":r?"minutu":"minutou";case"mm":if(t||r){return a+(i(e)?"minuty":"minut")}else{return a+"minutami"}break;case"h":return t?"hodina":r?"hodinu":"hodinou";case"hh":if(t||r){return a+(i(e)?"hodiny":"hodin")}else{return a+"hodinami"}break;case"d":return t||r?"den":"dnem";case"dd":if(t||r){return a+(i(e)?"dny":"dní")}else{return a+"dny"}break;case"M":return t||r?"měsíc":"měsícem";case"MM":if(t||r){return a+(i(e)?"měsíce":"měsíců")}else{return a+"měsíci"}break;case"y":return t||r?"rok":"rokem";case"yy":if(t||r){return a+(i(e)?"roky":"let")}else{return a+"lety"}break}}return e.defineLocale("cs",{months:t,monthsShort:n,monthsParse:function(e,t){var n,i=[];for(n=0;n<12;n++){i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i")}return i}(t,n),weekdays:"neděle_pondělí_úterý_středa_čtvrtek_pátek_sobota".split("_"),weekdaysShort:"ne_po_út_st_čt_pá_so".split("_"),weekdaysMin:"ne_po_út_st_čt_pá_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes v] LT",nextDay:"[zítra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v neděli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve středu v] LT";case 4:return"[ve čtvrtek v] LT";case 5:return"[v pátek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[včera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou neděli v] LT";case 1:case 2:return"[minulé] dddd [v] LT";case 3:return"[minulou středu v] LT";case 4:case 5:return"[minulý] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"před %s",s:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("cv",{months:"кăрлач_нарăс_пуш_ака_май_çĕртме_утă_çурла_авăн_юпа_чӳк_раштав".split("_"),monthsShort:"кăр_нар_пуш_ака_май_çĕр_утă_çур_ав_юпа_чӳк_раш".split("_"),weekdays:"вырсарникун_тунтикун_ытларикун_юнкун_кĕçнерникун_эрнекун_шăматкун".split("_"),weekdaysShort:"выр_тун_ытл_юн_кĕç_эрн_шăм".split("_"),weekdaysMin:"вр_тн_ыт_юн_кç_эр_шм".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD-MM-YYYY",LL:"YYYY [çулхи] MMMM [уйăхĕн] D[-мĕшĕ]",LLL:"YYYY [çулхи] MMMM [уйăхĕн] D[-мĕшĕ], LT",LLLL:"dddd, YYYY [çулхи] MMMM [уйăхĕн] D[-мĕшĕ], LT"},calendar:{sameDay:"[Паян] LT [сехетре]",nextDay:"[Ыран] LT [сехетре]",lastDay:"[Ĕнер] LT [сехетре]",nextWeek:"[Çитес] dddd LT [сехетре]",lastWeek:"[Иртнĕ] dddd LT [сехетре]",sameElse:"L"},relativeTime:{future:function(e){var t=/сехет$/i.exec(e)?"рен":/çул$/i.exec(e)?"тан":"ран";return e+t},past:"%s каялла",s:"пĕр-ик çеккунт",m:"пĕр минут",mm:"%d минут",h:"пĕр сехет",hh:"%d сехет",d:"пĕр кун",dd:"%d кун",M:"пĕр уйăх",MM:"%d уйăх",y:"пĕр çул",yy:"%d çул"},ordinalParse:/\d{1,2}-мĕш/,ordinal:"%d-мĕш",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn ôl",s:"ychydig eiliadau",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},ordinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(e){var t=e,n="",i=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"];if(t>20){if(t===40||t===50||t===60||t===80||t===100){n="fed"}else{n="ain"}}else if(t>0){n=i[t]}return e+n},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"søndag_mandag_tirsdag_onsdag_torsdag_fredag_lørdag".split("_"),weekdaysShort:"søn_man_tir_ons_tor_fre_lør".split("_"),weekdaysMin:"sø_ma_ti_on_to_fr_lø".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd [d.] D. MMMM YYYY LT"},calendar:{sameDay:"[I dag kl.] LT",nextDay:"[I morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[I går kl.] LT",lastWeek:"[sidste] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"få sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en måned",MM:"%d måneder",y:"et år",yy:"%d år"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n,i){var r={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?r[n][0]:r[n][1]}return e.defineLocale("de-at",{months:"Jänner_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jän._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT [Uhr]",sameElse:"L",nextDay:"[Morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[Gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n,i){var r={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?r[n][0]:r[n][1]}return e.defineLocale("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT [Uhr]",sameElse:"L",nextDay:"[Morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[Gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("el",{monthsNominativeEl:"Ιανουάριος_Φεβρουάριος_Μάρτιος_Απρίλιος_Μάιος_Ιούνιος_Ιούλιος_Αύγουστος_Σεπτέμβριος_Οκτώβριος_Νοέμβριος_Δεκέμβριος".split("_"),monthsGenitiveEl:"Ιανουαρίου_Φεβρουαρίου_Μαρτίου_Απριλίου_Μαΐου_Ιουνίου_Ιουλίου_Αυγούστου_Σεπτεμβρίου_Οκτωβρίου_Νοεμβρίου_Δεκεμβρίου".split("_"),months:function(e,t){if(/D/.test(t.substring(0,t.indexOf("MMMM")))){return this._monthsGenitiveEl[e.month()]}else{return this._monthsNominativeEl[e.month()]}},monthsShort:"Ιαν_Φεβ_Μαρ_Απρ_Μαϊ_Ιουν_Ιουλ_Αυγ_Σεπ_Οκτ_Νοε_Δεκ".split("_"),weekdays:"Κυριακή_Δευτέρα_Τρίτη_Τετάρτη_Πέμπτη_Παρασκευή_Σάββατο".split("_"),weekdaysShort:"Κυρ_Δευ_Τρι_Τετ_Πεμ_Παρ_Σαβ".split("_"),weekdaysMin:"Κυ_Δε_Τρ_Τε_Πε_Πα_Σα".split("_"),meridiem:function(e,t,n){if(e>11){return n?"μμ":"ΜΜ"}else{return n?"πμ":"ΠΜ"}},isPM:function(e){return(e+"").toLowerCase()[0]==="μ"},meridiemParse:/[ΠΜ]\.?Μ?\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendarEl:{sameDay:"[Σήμερα {}] LT",nextDay:"[Αύριο {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[Χθες {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[το προηγούμενο] dddd [{}] LT";default:return"[την προηγούμενη] dddd [{}] LT"}},sameElse:"L"},calendar:function(e,t){var n=this._calendarEl[e],i=t&&t.hours();if(typeof n==="function"){n=n.apply(t)}return n.replace("{}",i%12===1?"στη":"στις")},relativeTime:{future:"σε %s",past:"%s πριν",s:"λίγα δευτερόλεπτα",m:"ένα λεπτό",mm:"%d λεπτά",h:"μία ώρα",hh:"%d ώρες",d:"μία μέρα",dd:"%d μέρες",M:"ένας μήνας",MM:"%d μήνες",y:"ένας χρόνος",yy:"%d χρόνια"},ordinalParse:/\d{1,2}η/,ordinal:"%dη",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"D MMMM, YYYY",LLL:"D MMMM, YYYY LT",LLLL:"dddd, D MMMM, YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}})});(function(e){e(t)})(function(e){return e.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";
return e+n},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_aŭgusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aŭg_sep_okt_nov_dec".split("_"),weekdays:"Dimanĉo_Lundo_Mardo_Merkredo_Ĵaŭdo_Vendredo_Sabato".split("_"),weekdaysShort:"Dim_Lun_Mard_Merk_Ĵaŭ_Ven_Sab".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Ĵa_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D[-an de] MMMM, YYYY",LLL:"D[-an de] MMMM, YYYY LT",LLLL:"dddd, [la] D[-an de] MMMM, YYYY LT"},meridiem:function(e,t,n){if(e>11){return n?"p.t.m.":"P.T.M."}else{return n?"a.t.m.":"A.T.M."}},calendar:{sameDay:"[Hodiaŭ je] LT",nextDay:"[Morgaŭ je] LT",nextWeek:"dddd [je] LT",lastDay:"[Hieraŭ je] LT",lastWeek:"[pasinta] dddd [je] LT",sameElse:"L"},relativeTime:{future:"je %s",past:"antaŭ %s",s:"sekundoj",m:"minuto",mm:"%d minutoj",h:"horo",hh:"%d horoj",d:"tago",dd:"%d tagoj",M:"monato",MM:"%d monatoj",y:"jaro",yy:"%d jaroj"},ordinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");return e.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,i){if(/-MMM-/.test(i)){return n[e.month()]}else{return t[e.month()]}},weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_Sá".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+(this.hours()!==1?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(this.hours()!==1?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(this.hours()!==1?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(this.hours()!==1?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(this.hours()!==1?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n,i){var r={s:["mõne sekundi","mõni sekund","paar sekundit"],m:["ühe minuti","üks minut"],mm:[e+" minuti",e+" minutit"],h:["ühe tunni","tund aega","üks tund"],hh:[e+" tunni",e+" tundi"],d:["ühe päeva","üks päev"],M:["kuu aja","kuu aega","üks kuu"],MM:[e+" kuu",e+" kuud"],y:["ühe aasta","aasta","üks aasta"],yy:[e+" aasta",e+" aastat"]};if(t){return r[n][2]?r[n][2]:r[n][1]}return i?r[n][0]:r[n][1]}return e.defineLocale("et",{months:"jaanuar_veebruar_märts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_märts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"pühapäev_esmaspäev_teisipäev_kolmapäev_neljapäev_reede_laupäev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Täna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Järgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s pärast",past:"%s tagasi",s:t,m:t,mm:t,h:t,hh:t,d:t,dd:"%d päeva",M:t,MM:t,y:t,yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] LT",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] LT",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] LT",llll:"ddd, YYYY[ko] MMM D[a] LT"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t={1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹",0:"۰"},n={"۱":"1","۲":"2","۳":"3","۴":"4","۵":"5","۶":"6","۷":"7","۸":"8","۹":"9","۰":"0"};return e.defineLocale("fa",{months:"ژانویه_فوریه_مارس_آوریل_مه_ژوئن_ژوئیه_اوت_سپتامبر_اکتبر_نوامبر_دسامبر".split("_"),monthsShort:"ژانویه_فوریه_مارس_آوریل_مه_ژوئن_ژوئیه_اوت_سپتامبر_اکتبر_نوامبر_دسامبر".split("_"),weekdays:"یک‌شنبه_دوشنبه_سه‌شنبه_چهارشنبه_پنج‌شنبه_جمعه_شنبه".split("_"),weekdaysShort:"یک‌شنبه_دوشنبه_سه‌شنبه_چهارشنبه_پنج‌شنبه_جمعه_شنبه".split("_"),weekdaysMin:"ی_د_س_چ_پ_ج_ش".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},meridiem:function(e,t,n){if(e<12){return"قبل از ظهر"}else{return"بعد از ظهر"}},calendar:{sameDay:"[امروز ساعت] LT",nextDay:"[فردا ساعت] LT",nextWeek:"dddd [ساعت] LT",lastDay:"[دیروز ساعت] LT",lastWeek:"dddd [پیش] [ساعت] LT",sameElse:"L"},relativeTime:{future:"در %s",past:"%s پیش",s:"چندین ثانیه",m:"یک دقیقه",mm:"%d دقیقه",h:"یک ساعت",hh:"%d ساعت",d:"یک روز",dd:"%d روز",M:"یک ماه",MM:"%d ماه",y:"یک سال",yy:"%d سال"},preparse:function(e){return e.replace(/[۰-۹]/g,function(e){return n[e]}).replace(/،/g,",")},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]}).replace(/,/g,"،")},ordinalParse:/\d{1,2}م/,ordinal:"%dم",week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){var t="nolla yksi kaksi kolme neljä viisi kuusi seitsemän kahdeksan yhdeksän".split(" "),n=["nolla","yhden","kahden","kolmen","neljän","viiden","kuuden",t[7],t[8],t[9]];function i(e,t,n,i){var a="";switch(n){case"s":return i?"muutaman sekunnin":"muutama sekunti";case"m":return i?"minuutin":"minuutti";case"mm":a=i?"minuutin":"minuuttia";break;case"h":return i?"tunnin":"tunti";case"hh":a=i?"tunnin":"tuntia";break;case"d":return i?"päivän":"päivä";case"dd":a=i?"päivän":"päivää";break;case"M":return i?"kuukauden":"kuukausi";case"MM":a=i?"kuukauden":"kuukautta";break;case"y":return i?"vuoden":"vuosi";case"yy":a=i?"vuoden":"vuotta";break}a=r(e,i)+" "+a;return a}function r(e,i){return e<10?i?n[e]:t[e]:e}return e.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_kesäkuu_heinäkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kesä_heinä_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] LT",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] LT",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] LT",llll:"ddd, Do MMM YYYY, [klo] LT"},calendar:{sameDay:"[tänään] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s päästä",past:"%s sitten",s:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("fo",{months:"januar_februar_mars_apríl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mánadagur_týsdagur_mikudagur_hósdagur_fríggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mán_týs_mik_hós_frí_ley".split("_"),weekdaysMin:"su_má_tý_mi_hó_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D. MMMM, YYYY LT"},calendar:{sameDay:"[Í dag kl.] LT",nextDay:"[Í morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[Í gjár kl.] LT",lastWeek:"[síðstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s síðani",s:"fá sekund",m:"ein minutt",mm:"%d minuttir",h:"ein tími",hh:"%d tímar",d:"ein dagur",dd:"%d dagar",M:"ein mánaði",MM:"%d mánaðir",y:"eitt ár",yy:"%d ár"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("fr-ca",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(e){return e+(e===1?"er":"")}})});(function(e){e(t)})(function(e){return e.defineLocale("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(e){return e+(e===1?"er":"")},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("gl",{months:"Xaneiro_Febreiro_Marzo_Abril_Maio_Xuño_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),monthsShort:"Xan._Feb._Mar._Abr._Mai._Xuñ._Xul._Ago._Set._Out._Nov._Dec.".split("_"),weekdays:"Domingo_Luns_Martes_Mércores_Xoves_Venres_Sábado".split("_"),weekdaysShort:"Dom._Lun._Mar._Mér._Xov._Ven._Sáb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mé_Xo_Ve_Sá".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:function(){return"[hoxe "+(this.hours()!==1?"ás":"á")+"] LT"},nextDay:function(){return"[mañá "+(this.hours()!==1?"ás":"á")+"] LT"},nextWeek:function(){return"dddd ["+(this.hours()!==1?"ás":"a")+"] LT"},lastDay:function(){return"[onte "+(this.hours()!==1?"á":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(this.hours()!==1?"ás":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){if(e==="uns segundos"){return"nuns segundos"}return"en "+e},past:"hai %s",s:"uns segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},ordinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("he",{months:"ינואר_פברואר_מרץ_אפריל_מאי_יוני_יולי_אוגוסט_ספטמבר_אוקטובר_נובמבר_דצמבר".split("_"),monthsShort:"ינו׳_פבר׳_מרץ_אפר׳_מאי_יוני_יולי_אוג׳_ספט׳_אוק׳_נוב׳_דצמ׳".split("_"),weekdays:"ראשון_שני_שלישי_רביעי_חמישי_שישי_שבת".split("_"),weekdaysShort:"א׳_ב׳_ג׳_ד׳_ה׳_ו׳_ש׳".split("_"),weekdaysMin:"א_ב_ג_ד_ה_ו_ש".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [ב]MMMM YYYY",LLL:"D [ב]MMMM YYYY LT",LLLL:"dddd, D [ב]MMMM YYYY LT",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[היום ב־]LT",nextDay:"[מחר ב־]LT",nextWeek:"dddd [בשעה] LT",lastDay:"[אתמול ב־]LT",lastWeek:"[ביום] dddd [האחרון בשעה] LT",sameElse:"L"},relativeTime:{future:"בעוד %s",past:"לפני %s",s:"מספר שניות",m:"דקה",mm:"%d דקות",h:"שעה",hh:function(e){if(e===2){return"שעתיים"}return e+" שעות"},d:"יום",dd:function(e){if(e===2){return"יומיים"}return e+" ימים"},M:"חודש",MM:function(e){if(e===2){return"חודשיים"}return e+" חודשים"},y:"שנה",yy:function(e){if(e===2){return"שנתיים"}return e+" שנים"}}})});(function(e){e(t)})(function(e){var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},n={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"};return e.defineLocale("hi",{months:"जनवरी_फ़रवरी_मार्च_अप्रैल_मई_जून_जुलाई_अगस्त_सितम्बर_अक्टूबर_नवम्बर_दिसम्बर".split("_"),monthsShort:"जन._फ़र._मार्च_अप्रै._मई_जून_जुल._अग._सित._अक्टू._नव._दिस.".split("_"),weekdays:"रविवार_सोमवार_मंगलवार_बुधवार_गुरूवार_शुक्रवार_शनिवार".split("_"),weekdaysShort:"रवि_सोम_मंगल_बुध_गुरू_शुक्र_शनि".split("_"),weekdaysMin:"र_सो_मं_बु_गु_शु_श".split("_"),longDateFormat:{LT:"A h:mm बजे",LTS:"A h:mm:ss बजे",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[आज] LT",nextDay:"[कल] LT",nextWeek:"dddd, LT",lastDay:"[कल] LT",lastWeek:"[पिछले] dddd, LT",sameElse:"L"},relativeTime:{future:"%s में",past:"%s पहले",s:"कुछ ही क्षण",m:"एक मिनट",mm:"%d मिनट",h:"एक घंटा",hh:"%d घंटे",d:"एक दिन",dd:"%d दिन",M:"एक महीने",MM:"%d महीने",y:"एक वर्ष",yy:"%d वर्ष"},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e,t,n){if(e<4){return"रात"}else if(e<10){return"सुबह"}else if(e<17){return"दोपहर"}else if(e<20){return"शाम"}else{return"रात"}},week:{dow:0,doy:6}})});(function(e){e(t)})(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"jedna minuta":"jedne minute";case"mm":if(e===1){i+="minuta"}else if(e===2||e===3||e===4){i+="minute"}else{i+="minuta"}return i;case"h":return t?"jedan sat":"jednog sata";case"hh":if(e===1){i+="sat"}else if(e===2||e===3||e===4){i+="sata"}else{i+="sati"}return i;case"dd":if(e===1){i+="dan"}else{i+="dana"}return i;case"MM":if(e===1){i+="mjesec"}else if(e===2||e===3||e===4){i+="mjeseca"}else{i+="mjeseci"}return i;case"yy":if(e===1){i+="godina"}else if(e===2||e===3||e===4){i+="godine"}else{i+="godina"}return i}}return e.defineLocale("hr",{months:"sječanj_veljača_ožujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),monthsShort:"sje._vel._ožu._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),weekdays:"nedjelja_ponedjeljak_utorak_srijeda_četvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._čet._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_če_pe_su".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jučer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prošlu] dddd [u] LT";case 6:return"[prošle] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[prošli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t="vasárnap hétfőn kedden szerdán csütörtökön pénteken szombaton".split(" ");function n(e,t,n,i){var r=e,a;switch(n){case"s":return i||t?"néhány másodperc":"néhány másodperce";case"m":return"egy"+(i||t?" perc":" perce");case"mm":return r+(i||t?" perc":" perce");case"h":return"egy"+(i||t?" óra":" órája");case"hh":return r+(i||t?" óra":" órája");case"d":return"egy"+(i||t?" nap":" napja");case"dd":return r+(i||t?" nap":" napja");case"M":return"egy"+(i||t?" hónap":" hónapja");case"MM":return r+(i||t?" hónap":" hónapja");case"y":return"egy"+(i||t?" év":" éve");case"yy":return r+(i||t?" év":" éve")}return""}function i(e){return(e?"":"[múlt] ")+"["+t[this.day()]+"] LT[-kor]"}return e.defineLocale("hu",{months:"január_február_március_április_május_június_július_augusztus_szeptember_október_november_december".split("_"),monthsShort:"jan_feb_márc_ápr_máj_jún_júl_aug_szept_okt_nov_dec".split("_"),weekdays:"vasárnap_hétfő_kedd_szerda_csütörtök_péntek_szombat".split("_"),weekdaysShort:"vas_hét_kedd_sze_csüt_pén_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D., LT",LLLL:"YYYY. MMMM D., dddd LT"},meridiem:function(e,t,n){if(e<12){return n===true?"de":"DE"}else{return n===true?"du":"DU"}},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return i.call(this,true)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return i.call(this,false)},sameElse:"L"},relativeTime:{future:"%s múlva",past:"%s",s:n,m:n,mm:n,h:n,hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){function t(e,t){var n={nominative:"հունվար_փետրվար_մարտ_ապրիլ_մայիս_հունիս_հուլիս_օգոստոս_սեպտեմբեր_հոկտեմբեր_նոյեմբեր_դեկտեմբեր".split("_"),accusative:"հունվարի_փետրվարի_մարտի_ապրիլի_մայիսի_հունիսի_հուլիսի_օգոստոսի_սեպտեմբերի_հոկտեմբերի_նոյեմբերի_դեկտեմբերի".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function n(e,t){var n="հնվ_փտր_մրտ_ապր_մյս_հնս_հլս_օգս_սպտ_հկտ_նմբ_դկտ".split("_");return n[e.month()]}function i(e,t){var n="կիրակի_երկուշաբթի_երեքշաբթի_չորեքշաբթի_հինգշաբթի_ուրբաթ_շաբաթ".split("_");return n[e.day()]}return e.defineLocale("hy-am",{months:t,monthsShort:n,weekdays:i,weekdaysShort:"կրկ_երկ_երք_չրք_հնգ_ուրբ_շբթ".split("_"),weekdaysMin:"կրկ_երկ_երք_չրք_հնգ_ուրբ_շբթ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY թ.",LLL:"D MMMM YYYY թ., LT",LLLL:"dddd, D MMMM YYYY թ., LT"},calendar:{sameDay:"[այսօր] LT",nextDay:"[վաղը] LT",lastDay:"[երեկ] LT",nextWeek:function(){return"dddd [օրը ժամը] LT"},lastWeek:function(){return"[անցած] dddd [օրը ժամը] LT"},sameElse:"L"},relativeTime:{future:"%s հետո",past:"%s առաջ",s:"մի քանի վայրկյան",m:"րոպե",mm:"%d րոպե",h:"ժամ",hh:"%d ժամ",d:"օր",dd:"%d օր",M:"ամիս",MM:"%d ամիս",y:"տարի",yy:"%d տարի"},meridiem:function(e){if(e<4){return"գիշերվա"}else if(e<12){return"առավոտվա"}else if(e<17){return"ցերեկվա"}else{return"երեկոյան"}},ordinalParse:/\d{1,2}|\d{1,2}-(ին|րդ)/,ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":if(e===1){return e+"-ին"}return e+"-րդ";default:return e}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"LT.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(e,t,n){if(e<11){return"pagi"}else if(e<15){return"siang"}else if(e<19){return"sore"}else{return"malam"}},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){function t(e){if(e%100===11){return true}else if(e%10===1){return false}return true}function n(e,n,i,r){var a=e+" ";switch(i){case"s":return n||r?"nokkrar sekúndur":"nokkrum sekúndum";case"m":return n?"mínúta":"mínútu";case"mm":if(t(e)){return a+(n||r?"mínútur":"mínútum")}else if(n){return a+"mínúta"}return a+"mínútu";case"hh":if(t(e)){return a+(n||r?"klukkustundir":"klukkustundum")}return a+"klukkustund";case"d":if(n){return"dagur"}return r?"dag":"degi";case"dd":if(t(e)){if(n){return a+"dagar"}return a+(r?"daga":"dögum")}else if(n){return a+"dagur"}return a+(r?"dag":"degi");case"M":if(n){return"mánuður"}return r?"mánuð":"mánuði";case"MM":if(t(e)){if(n){return a+"mánuðir"}return a+(r?"mánuði":"mánuðum")}else if(n){return a+"mánuður"}return a+(r?"mánuð":"mánuði");case"y":return n||r?"ár":"ári";case"yy":if(t(e)){return a+(n||r?"ár":"árum")}return a+(n||r?"ár":"ári")}}return e.defineLocale("is",{months:"janúar_febrúar_mars_apríl_maí_júní_júlí_ágúst_september_október_nóvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_maí_jún_júl_ágú_sep_okt_nóv_des".split("_"),weekdays:"sunnudagur_mánudagur_þriðjudagur_miðvikudagur_fimmtudagur_föstudagur_laugardagur".split("_"),weekdaysShort:"sun_mán_þri_mið_fim_fös_lau".split("_"),weekdaysMin:"Su_Má_Þr_Mi_Fi_Fö_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd, D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[í dag kl.] LT",nextDay:"[á morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[í gær kl.] LT",lastWeek:"[síðasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s síðan",s:n,m:n,mm:n,h:"klukkustund",hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"Domenica_Lunedì_Martedì_Mercoledì_Giovedì_Venerdì_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"D_L_Ma_Me_G_V_S".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("ja",{months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),longDateFormat:{LT:"Ah時m分",LTS:"LTs秒",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日LT",LLLL:"YYYY年M月D日LT dddd"},meridiem:function(e,t,n){if(e<12){return"午前"}else{return"午後"}},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:"[来週]dddd LT",lastDay:"[昨日] LT",lastWeek:"[前週]dddd LT",sameElse:"L"},relativeTime:{future:"%s後",past:"%s前",s:"数秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}})});(function(e){e(t)})(function(e){function t(e,t){var n={nominative:"იანვარი_თებერვალი_მარტი_აპრილი_მაისი_ივნისი_ივლისი_აგვისტო_სექტემბერი_ოქტომბერი_ნოემბერი_დეკემბერი".split("_"),accusative:"იანვარს_თებერვალს_მარტს_აპრილის_მაისს_ივნისს_ივლისს_აგვისტს_სექტემბერს_ოქტომბერს_ნოემბერს_დეკემბერს".split("_")},i=/D[oD] *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function n(e,t){var n={nominative:"კვირა_ორშაბათი_სამშაბათი_ოთხშაბათი_ხუთშაბათი_პარასკევი_შაბათი".split("_"),accusative:"კვირას_ორშაბათს_სამშაბათს_ოთხშაბათს_ხუთშაბათს_პარასკევს_შაბათს".split("_")},i=/(წინა|შემდეგ)/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("ka",{months:t,monthsShort:"იან_თებ_მარ_აპრ_მაი_ივნ_ივლ_აგვ_სექ_ოქტ_ნოე_დეკ".split("_"),weekdays:n,weekdaysShort:"კვი_ორშ_სამ_ოთხ_ხუთ_პარ_შაბ".split("_"),weekdaysMin:"კვ_ორ_სა_ოთ_ხუ_პა_შა".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[დღეს] LT[-ზე]",nextDay:"[ხვალ] LT[-ზე]",lastDay:"[გუშინ] LT[-ზე]",nextWeek:"[შემდეგ] dddd LT[-ზე]",lastWeek:"[წინა] dddd LT-ზე",sameElse:"L"},relativeTime:{future:function(e){return/(წამი|წუთი|საათი|წელი)/.test(e)?e.replace(/ი$/,"ში"):e+"ში"},past:function(e){if(/(წამი|წუთი|საათი|დღე|თვე)/.test(e)){return e.replace(/(ი|ე)$/,"ის წინ")}if(/წელი/.test(e)){return e.replace(/წელი$/,"წლის წინ")}},s:"რამდენიმე წამი",m:"წუთი",mm:"%d წუთი",h:"საათი",hh:"%d საათი",d:"დღე",dd:"%d დღე",M:"თვე",MM:"%d თვე",y:"წელი",yy:"%d წელი"},ordinalParse:/0|1-ლი|მე-\d{1,2}|\d{1,2}-ე/,ordinal:function(e){if(e===0){return e}if(e===1){return e+"-ლი"}if(e<20||e<=100&&e%20===0||e%100===0){return"მე-"+e}return e+"-ე"},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("km",{months:"មករា_កុម្ភៈ_មិនា_មេសា_ឧសភា_មិថុនា_កក្កដា_សីហា_កញ្ញា_តុលា_វិច្ឆិកា_ធ្នូ".split("_"),monthsShort:"មករា_កុម្ភៈ_មិនា_មេសា_ឧសភា_មិថុនា_កក្កដា_សីហា_កញ្ញា_តុលា_វិច្ឆិកា_ធ្នូ".split("_"),weekdays:"អាទិត្យ_ច័ន្ទ_អង្គារ_ពុធ_ព្រហស្បតិ៍_សុក្រ_សៅរ៍".split("_"),weekdaysShort:"អាទិត្យ_ច័ន្ទ_អង្គារ_ពុធ_ព្រហស្បតិ៍_សុក្រ_សៅរ៍".split("_"),weekdaysMin:"អាទិត្យ_ច័ន្ទ_អង្គារ_ពុធ_ព្រហស្បតិ៍_សុក្រ_សៅរ៍".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[ថ្ងៃនៈ ម៉ោង] LT",nextDay:"[ស្អែក ម៉ោង] LT",nextWeek:"dddd [ម៉ោង] LT",lastDay:"[ម្សិលមិញ ម៉ោង] LT",lastWeek:"dddd [សប្តាហ៍មុន] [ម៉ោង] LT",sameElse:"L"},relativeTime:{future:"%sទៀត",past:"%sមុន",s:"ប៉ុន្មានវិនាទី",m:"មួយនាទី",mm:"%d នាទី",h:"មួយម៉ោង",hh:"%d ម៉ោង",d:"មួយថ្ងៃ",dd:"%d ថ្ងៃ",M:"មួយខែ",MM:"%d ខែ",y:"មួយឆ្នាំ",yy:"%d ឆ្នាំ"},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("ko",{months:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),monthsShort:"1월_2월_3월_4월_5월_6월_7월_8월_9월_10월_11월_12월".split("_"),weekdays:"일요일_월요일_화요일_수요일_목요일_금요일_토요일".split("_"),weekdaysShort:"일_월_화_수_목_금_토".split("_"),weekdaysMin:"일_월_화_수_목_금_토".split("_"),longDateFormat:{LT:"A h시 m분",LTS:"A h시 m분 s초",L:"YYYY.MM.DD",LL:"YYYY년 MMMM D일",LLL:"YYYY년 MMMM D일 LT",LLLL:"YYYY년 MMMM D일 dddd LT"},meridiem:function(e,t,n){return e<12?"오전":"오후"},calendar:{sameDay:"오늘 LT",nextDay:"내일 LT",nextWeek:"dddd LT",lastDay:"어제 LT",lastWeek:"지난주 dddd LT",sameElse:"L"},relativeTime:{future:"%s 후",past:"%s 전",s:"몇초",ss:"%d초",m:"일분",mm:"%d분",h:"한시간",hh:"%d시간",d:"하루",dd:"%d일",M:"한달",MM:"%d달",y:"일년",yy:"%d년"},ordinalParse:/\d{1,2}일/,ordinal:"%d일",meridiemParse:/(오전|오후)/,isPM:function(e){return e==="오후"}})});(function(e){e(t)})(function(e){function t(e,t,n,i){var r={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?r[n][0]:r[n][1]}function n(e){var t=e.substr(0,e.indexOf(" "));if(r(t)){return"a "+e}return"an "+e}function i(e){var t=e.substr(0,e.indexOf(" "));if(r(t)){return"viru "+e}return"virun "+e}function r(e){e=parseInt(e,10);if(isNaN(e)){return false}if(e<0){return true}else if(e<10){if(4<=e&&e<=7){return true}return false}else if(e<100){var t=e%10,n=e/10;if(t===0){return r(n)}return r(t)}else if(e<1e4){while(e>=10){e=e/10}return r(e)}else{e=e/1e3;return r(e)}}return e.defineLocale("lb",{months:"Januar_Februar_Mäerz_Abrëll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonndeg_Méindeg_Dënschdeg_Mëttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._Mé._Dë._Më._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mé_Dë_Më_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gëschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:n,past:i,s:"e puer Sekonnen",m:t,mm:"%d Minutten",h:t,hh:"%d Stonnen",d:t,dd:"%d Deeg",M:t,MM:"%d Méint",y:t,yy:"%d Joer"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t={m:"minutė_minutės_minutę",mm:"minutės_minučių_minutes",h:"valanda_valandos_valandą",hh:"valandos_valandų_valandas",d:"diena_dienos_dieną",dd:"dienos_dienų_dienas",M:"mėnuo_mėnesio_mėnesį",MM:"mėnesiai_mėnesių_mėnesius",y:"metai_metų_metus",yy:"metai_metų_metus"},n="sekmadienis_pirmadienis_antradienis_trečiadienis_ketvirtadienis_penktadienis_šeštadienis".split("_");function i(e,t,n,i){if(t){return"kelios sekundės"}else{return i?"kelių sekundžių":"kelias sekundes"}}function r(e,t,n,i){return t?o(n)[0]:i?o(n)[1]:o(n)[2]}function a(e){return e%10===0||e>10&&e<20}function o(e){return t[e].split("_")}function s(e,t,n,i){var s=e+" ";if(e===1){return s+r(e,t,n[0],i)}else if(t){return s+(a(e)?o(n)[1]:o(n)[0])}else{if(i){return s+o(n)[1]}else{return s+(a(e)?o(n)[1]:o(n)[2])}}}function l(e,t){var i=t.indexOf("dddd HH:mm")===-1,r=n[e.day()];return i?r:r.substring(0,r.length-2)+"į"}return e.defineLocale("lt",{months:"sausio_vasario_kovo_balandžio_gegužės_birželio_liepos_rugpjūčio_rugsėjo_spalio_lapkričio_gruodžio".split("_"),monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:l,weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_Šeš".split("_"),weekdaysMin:"S_P_A_T_K_Pn_Š".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], LT [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, LT [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], LT [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, LT [val.]"},calendar:{sameDay:"[Šiandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Praėjusį] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prieš %s",s:i,m:r,mm:s,h:r,hh:s,d:r,dd:s,M:r,MM:s,y:r,yy:s},ordinalParse:/\d{1,2}-oji/,ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t={mm:"minūti_minūtes_minūte_minūtes",hh:"stundu_stundas_stunda_stundas",dd:"dienu_dienas_diena_dienas",MM:"mēnesi_mēnešus_mēnesis_mēneši",yy:"gadu_gadus_gads_gadi"};function n(e,t,n){var i=e.split("_");if(n){return t%10===1&&t!==11?i[2]:i[3]}else{return t%10===1&&t!==11?i[0]:i[1]}}function i(e,i,r){return e+" "+n(t[r],e,i)}return e.defineLocale("lv",{months:"janvāris_februāris_marts_aprīlis_maijs_jūnijs_jūlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jūn_jūl_aug_sep_okt_nov_dec".split("_"),weekdays:"svētdiena_pirmdiena_otrdiena_trešdiena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, LT",LLLL:"YYYY. [gada] D. MMMM, dddd, LT"},calendar:{sameDay:"[Šodien pulksten] LT",nextDay:"[Rīt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagājušā] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"%s vēlāk",past:"%s agrāk",s:"dažas sekundes",m:"minūti",mm:i,h:"stundu",hh:i,d:"dienu",dd:i,M:"mēnesi",MM:i,y:"gadu",yy:i},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})
});(function(e){e(t)})(function(e){return e.defineLocale("mk",{months:"јануари_февруари_март_април_мај_јуни_јули_август_септември_октомври_ноември_декември".split("_"),monthsShort:"јан_фев_мар_апр_мај_јун_јул_авг_сеп_окт_ное_дек".split("_"),weekdays:"недела_понеделник_вторник_среда_четврток_петок_сабота".split("_"),weekdaysShort:"нед_пон_вто_сре_чет_пет_саб".split("_"),weekdaysMin:"нe_пo_вт_ср_че_пе_сa".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Денес во] LT",nextDay:"[Утре во] LT",nextWeek:"dddd [во] LT",lastDay:"[Вчера во] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[Во изминатата] dddd [во] LT";case 1:case 2:case 4:case 5:return"[Во изминатиот] dddd [во] LT"}},sameElse:"L"},relativeTime:{future:"после %s",past:"пред %s",s:"неколку секунди",m:"минута",mm:"%d минути",h:"час",hh:"%d часа",d:"ден",dd:"%d дена",M:"месец",MM:"%d месеци",y:"година",yy:"%d години"},ordinalParse:/\d{1,2}-(ев|ен|ти|ви|ри|ми)/,ordinal:function(e){var t=e%10,n=e%100;if(e===0){return e+"-ев"}else if(n===0){return e+"-ен"}else if(n>10&&n<20){return e+"-ти"}else if(t===1){return e+"-ви"}else if(t===2){return e+"-ри"}else if(t===7||t===8){return e+"-ми"}else{return e+"-ти"}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("ml",{months:"ജനുവരി_ഫെബ്രുവരി_മാർച്ച്_ഏപ്രിൽ_മേയ്_ജൂൺ_ജൂലൈ_ഓഗസ്റ്റ്_സെപ്റ്റംബർ_ഒക്ടോബർ_നവംബർ_ഡിസംബർ".split("_"),monthsShort:"ജനു._ഫെബ്രു._മാർ._ഏപ്രി._മേയ്_ജൂൺ_ജൂലൈ._ഓഗ._സെപ്റ്റ._ഒക്ടോ._നവം._ഡിസം.".split("_"),weekdays:"ഞായറാഴ്ച_തിങ്കളാഴ്ച_ചൊവ്വാഴ്ച_ബുധനാഴ്ച_വ്യാഴാഴ്ച_വെള്ളിയാഴ്ച_ശനിയാഴ്ച".split("_"),weekdaysShort:"ഞായർ_തിങ്കൾ_ചൊവ്വ_ബുധൻ_വ്യാഴം_വെള്ളി_ശനി".split("_"),weekdaysMin:"ഞാ_തി_ചൊ_ബു_വ്യാ_വെ_ശ".split("_"),longDateFormat:{LT:"A h:mm -നു",LTS:"A h:mm:ss -നു",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[ഇന്ന്] LT",nextDay:"[നാളെ] LT",nextWeek:"dddd, LT",lastDay:"[ഇന്നലെ] LT",lastWeek:"[കഴിഞ്ഞ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s കഴിഞ്ഞ്",past:"%s മുൻപ്",s:"അൽപ നിമിഷങ്ങൾ",m:"ഒരു മിനിറ്റ്",mm:"%d മിനിറ്റ്",h:"ഒരു മണിക്കൂർ",hh:"%d മണിക്കൂർ",d:"ഒരു ദിവസം",dd:"%d ദിവസം",M:"ഒരു മാസം",MM:"%d മാസം",y:"ഒരു വർഷം",yy:"%d വർഷം"},meridiem:function(e,t,n){if(e<4){return"രാത്രി"}else if(e<12){return"രാവിലെ"}else if(e<17){return"ഉച്ച കഴിഞ്ഞ്"}else if(e<20){return"വൈകുന്നേരം"}else{return"രാത്രി"}}})});(function(e){e(t)})(function(e){var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},n={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"};return e.defineLocale("mr",{months:"जानेवारी_फेब्रुवारी_मार्च_एप्रिल_मे_जून_जुलै_ऑगस्ट_सप्टेंबर_ऑक्टोबर_नोव्हेंबर_डिसेंबर".split("_"),monthsShort:"जाने._फेब्रु._मार्च._एप्रि._मे._जून._जुलै._ऑग._सप्टें._ऑक्टो._नोव्हें._डिसें.".split("_"),weekdays:"रविवार_सोमवार_मंगळवार_बुधवार_गुरूवार_शुक्रवार_शनिवार".split("_"),weekdaysShort:"रवि_सोम_मंगळ_बुध_गुरू_शुक्र_शनि".split("_"),weekdaysMin:"र_सो_मं_बु_गु_शु_श".split("_"),longDateFormat:{LT:"A h:mm वाजता",LTS:"A h:mm:ss वाजता",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[आज] LT",nextDay:"[उद्या] LT",nextWeek:"dddd, LT",lastDay:"[काल] LT",lastWeek:"[मागील] dddd, LT",sameElse:"L"},relativeTime:{future:"%s नंतर",past:"%s पूर्वी",s:"सेकंद",m:"एक मिनिट",mm:"%d मिनिटे",h:"एक तास",hh:"%d तास",d:"एक दिवस",dd:"%d दिवस",M:"एक महिना",MM:"%d महिने",y:"एक वर्ष",yy:"%d वर्षे"},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e,t,n){if(e<4){return"रात्री"}else if(e<10){return"सकाळी"}else if(e<17){return"दुपारी"}else if(e<20){return"सायंकाळी"}else{return"रात्री"}},week:{dow:0,doy:6}})});(function(e){e(t)})(function(e){return e.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"LT.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] LT",LLLL:"dddd, D MMMM YYYY [pukul] LT"},meridiem:function(e,t,n){if(e<11){return"pagi"}else if(e<15){return"tengahari"}else if(e<19){return"petang"}else{return"malam"}},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t={1:"၁",2:"၂",3:"၃",4:"၄",5:"၅",6:"၆",7:"၇",8:"၈",9:"၉",0:"၀"},n={"၁":"1","၂":"2","၃":"3","၄":"4","၅":"5","၆":"6","၇":"7","၈":"8","၉":"9","၀":"0"};return e.defineLocale("my",{months:"ဇန်နဝါရီ_ဖေဖော်ဝါရီ_မတ်_ဧပြီ_မေ_ဇွန်_ဇူလိုင်_သြဂုတ်_စက်တင်ဘာ_အောက်တိုဘာ_နိုဝင်ဘာ_ဒီဇင်ဘာ".split("_"),monthsShort:"ဇန်_ဖေ_မတ်_ပြီ_မေ_ဇွန်_လိုင်_သြ_စက်_အောက်_နို_ဒီ".split("_"),weekdays:"တနင်္ဂနွေ_တနင်္လာ_အင်္ဂါ_ဗုဒ္ဓဟူး_ကြာသပတေး_သောကြာ_စနေ".split("_"),weekdaysShort:"နွေ_လာ_င်္ဂါ_ဟူး_ကြာ_သော_နေ".split("_"),weekdaysMin:"နွေ_လာ_င်္ဂါ_ဟူး_ကြာ_သော_နေ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ယနေ.] LT [မှာ]",nextDay:"[မနက်ဖြန်] LT [မှာ]",nextWeek:"dddd LT [မှာ]",lastDay:"[မနေ.က] LT [မှာ]",lastWeek:"[ပြီးခဲ့သော] dddd LT [မှာ]",sameElse:"L"},relativeTime:{future:"လာမည့် %s မှာ",past:"လွန်ခဲ့သော %s က",s:"စက္ကန်.အနည်းငယ်",m:"တစ်မိနစ်",mm:"%d မိနစ်",h:"တစ်နာရီ",hh:"%d နာရီ",d:"တစ်ရက်",dd:"%d ရက်",M:"တစ်လ",MM:"%d လ",y:"တစ်နှစ်",yy:"%d နှစ်"},preparse:function(e){return e.replace(/[၁၂၃၄၅၆၇၈၉၀]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"søndag_mandag_tirsdag_onsdag_torsdag_fredag_lørdag".split("_"),weekdaysShort:"søn_man_tirs_ons_tors_fre_lør".split("_"),weekdaysMin:"sø_ma_ti_on_to_fr_lø".split("_"),longDateFormat:{LT:"H.mm",LTS:"LT.ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] LT",LLLL:"dddd D. MMMM YYYY [kl.] LT"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i går kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en måned",MM:"%d måneder",y:"ett år",yy:"%d år"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t={1:"१",2:"२",3:"३",4:"४",5:"५",6:"६",7:"७",8:"८",9:"९",0:"०"},n={"१":"1","२":"2","३":"3","४":"4","५":"5","६":"6","७":"7","८":"8","९":"9","०":"0"};return e.defineLocale("ne",{months:"जनवरी_फेब्रुवरी_मार्च_अप्रिल_मई_जुन_जुलाई_अगष्ट_सेप्टेम्बर_अक्टोबर_नोभेम्बर_डिसेम्बर".split("_"),monthsShort:"जन._फेब्रु._मार्च_अप्रि._मई_जुन_जुलाई._अग._सेप्ट._अक्टो._नोभे._डिसे.".split("_"),weekdays:"आइतबार_सोमबार_मङ्गलबार_बुधबार_बिहिबार_शुक्रबार_शनिबार".split("_"),weekdaysShort:"आइत._सोम._मङ्गल._बुध._बिहि._शुक्र._शनि.".split("_"),weekdaysMin:"आइ._सो._मङ्_बु._बि._शु._श.".split("_"),longDateFormat:{LT:"Aको h:mm बजे",LTS:"Aको h:mm:ss बजे",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},preparse:function(e){return e.replace(/[१२३४५६७८९०]/g,function(e){return n[e]})},postformat:function(e){return e.replace(/\d/g,function(e){return t[e]})},meridiem:function(e,t,n){if(e<3){return"राती"}else if(e<10){return"बिहान"}else if(e<15){return"दिउँसो"}else if(e<18){return"बेलुका"}else if(e<20){return"साँझ"}else{return"राती"}},calendar:{sameDay:"[आज] LT",nextDay:"[भोली] LT",nextWeek:"[आउँदो] dddd[,] LT",lastDay:"[हिजो] LT",lastWeek:"[गएको] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%sमा",past:"%s अगाडी",s:"केही समय",m:"एक मिनेट",mm:"%d मिनेट",h:"एक घण्टा",hh:"%d घण्टा",d:"एक दिन",dd:"%d दिन",M:"एक महिना",MM:"%d महिना",y:"एक बर्ष",yy:"%d बर्ष"},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_");return e.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,i){if(/-MMM-/.test(i)){return n[e.month()]}else{return t[e.month()]}},weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"één minuut",mm:"%d minuten",h:"één uur",hh:"%d uur",d:"één dag",dd:"%d dagen",M:"één maand",MM:"%d maanden",y:"één jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(e===1||e===8||e>=20?"ste":"de")},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sundag_måndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"sun_mån_tys_ons_tor_fre_lau".split("_"),weekdaysMin:"su_må_ty_on_to_fr_lø".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I går klokka] LT",lastWeek:"[Føregåande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"for %s sidan",s:"nokre sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",M:"ein månad",MM:"%d månader",y:"eit år",yy:"%d år"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t="styczeń_luty_marzec_kwiecień_maj_czerwiec_lipiec_sierpień_wrzesień_październik_listopad_grudzień".split("_"),n="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_września_października_listopada_grudnia".split("_");function i(e){return e%10<5&&e%10>1&&~~(e/10)%10!==1}function r(e,t,n){var r=e+" ";switch(n){case"m":return t?"minuta":"minutę";case"mm":return r+(i(e)?"minuty":"minut");case"h":return t?"godzina":"godzinę";case"hh":return r+(i(e)?"godziny":"godzin");case"MM":return r+(i(e)?"miesiące":"miesięcy");case"yy":return r+(i(e)?"lata":"lat")}}return e.defineLocale("pl",{months:function(e,i){if(/D MMMM/.test(i)){return n[e.month()]}else{return t[e.month()]}},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_paź_lis_gru".split("_"),weekdays:"niedziela_poniedziałek_wtorek_środa_czwartek_piątek_sobota".split("_"),weekdaysShort:"nie_pon_wt_śr_czw_pt_sb".split("_"),weekdaysMin:"N_Pn_Wt_Śr_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Dziś o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zeszłą niedzielę o] LT";case 3:return"[W zeszłą środę o] LT";case 6:return"[W zeszłą sobotę o] LT";default:return"[W zeszły] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:r,mm:r,h:r,hh:r,d:"1 dzień",dd:"%d dni",M:"miesiąc",MM:r,y:"rok",yy:r},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("pt-br",{months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"dom_2ª_3ª_4ª_5ª_6ª_sáb".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [às] LT",LLLL:"dddd, D [de] MMMM [de] YYYY [às] LT"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return this.day()===0||this.day()===6?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atrás",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}º/,ordinal:"%dº"})});(function(e){e(t)})(function(e){return e.defineLocale("pt",{months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"dom_2ª_3ª_4ª_5ª_6ª_sáb".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:"[Hoje às] LT",nextDay:"[Amanhã às] LT",nextWeek:"dddd [às] LT",lastDay:"[Ontem às] LT",lastWeek:function(){return this.day()===0||this.day()===6?"[Último] dddd [às] LT":"[Última] dddd [às] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"há %s",s:"segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n){var i={mm:"minute",hh:"ore",dd:"zile",MM:"luni",yy:"ani"},r=" ";if(e%100>=20||e>=100&&e%100===0){r=" de "}return e+r+i[n]}return e.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._febr._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),weekdays:"duminică_luni_marți_miercuri_joi_vineri_sâmbătă".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sâm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_Sâ".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mâine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s în urmă",s:"câteva secunde",m:"un minut",mm:t,h:"o oră",hh:t,d:"o zi",dd:t,M:"o lună",MM:t,y:"un an",yy:t},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?n[1]:n[2]}function n(e,n,i){var r={mm:n?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"};if(i==="m"){return n?"минута":"минуту"}else{return e+" "+t(r[i],+e)}}function i(e,t){var n={nominative:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),accusative:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function r(e,t){var n={nominative:"янв_фев_март_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),accusative:"янв_фев_мар_апр_мая_июня_июля_авг_сен_окт_ноя_дек".split("_")},i=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function a(e,t){var n={nominative:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),accusative:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_")},i=/\[ ?[Вв] ?(?:прошлую|следующую|эту)? ?\] ?dddd/.test(t)?"accusative":"nominative";return n[i][e.day()]}return e.defineLocale("ru",{months:i,monthsShort:r,weekdays:a,weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[й|я]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i],longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastDay:"[Вчера в] LT",nextWeek:function(){return this.day()===2?"[Во] dddd [в] LT":"[В] dddd [в] LT"},lastWeek:function(e){if(e.week()!==this.week()){switch(this.day()){case 0:return"[В прошлое] dddd [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd [в] LT"}}else{if(this.day()===2){return"[Во] dddd [в] LT"}else{return"[В] dddd [в] LT"}}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:n,mm:n,h:"час",hh:n,d:"день",dd:n,M:"месяц",MM:n,y:"год",yy:n},meridiemParse:/ночи|утра|дня|вечера/i,isPM:function(e){return/^(дня|вечера)$/.test(e)},meridiem:function(e,t,n){if(e<4){return"ночи"}else if(e<12){return"утра"}else if(e<17){return"дня"}else{return"вечера"}},ordinalParse:/\d{1,2}-(й|го|я)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t="január_február_marec_apríl_máj_jún_júl_august_september_október_november_december".split("_"),n="jan_feb_mar_apr_máj_jún_júl_aug_sep_okt_nov_dec".split("_");function i(e){return e>1&&e<5}function r(e,t,n,r){var a=e+" ";switch(n){case"s":return t||r?"pár sekúnd":"pár sekundami";case"m":return t?"minúta":r?"minútu":"minútou";case"mm":if(t||r){return a+(i(e)?"minúty":"minút")}else{return a+"minútami"}break;case"h":return t?"hodina":r?"hodinu":"hodinou";case"hh":if(t||r){return a+(i(e)?"hodiny":"hodín")}else{return a+"hodinami"}break;case"d":return t||r?"deň":"dňom";case"dd":if(t||r){return a+(i(e)?"dni":"dní")}else{return a+"dňami"}break;case"M":return t||r?"mesiac":"mesiacom";case"MM":if(t||r){return a+(i(e)?"mesiace":"mesiacov")}else{return a+"mesiacmi"}break;case"y":return t||r?"rok":"rokom";case"yy":if(t||r){return a+(i(e)?"roky":"rokov")}else{return a+"rokmi"}break}}return e.defineLocale("sk",{months:t,monthsShort:n,monthsParse:function(e,t){var n,i=[];for(n=0;n<12;n++){i[n]=new RegExp("^"+e[n]+"$|^"+t[n]+"$","i")}return i}(t,n),weekdays:"nedeľa_pondelok_utorok_streda_štvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_št_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_št_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd D. MMMM YYYY LT"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeľu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo štvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[včera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulú nedeľu o] LT";case 1:case 2:return"[minulý] dddd [o] LT";case 3:return"[minulú stredu o] LT";case 4:case 5:return"[minulý] dddd [o] LT";case 6:return"[minulú sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){function t(e,t,n){var i=e+" ";switch(n){case"m":return t?"ena minuta":"eno minuto";case"mm":if(e===1){i+="minuta"}else if(e===2){i+="minuti"}else if(e===3||e===4){i+="minute"}else{i+="minut"}return i;case"h":return t?"ena ura":"eno uro";case"hh":if(e===1){i+="ura"}else if(e===2){i+="uri"}else if(e===3||e===4){i+="ure"}else{i+="ur"}return i;case"dd":if(e===1){i+="dan"}else{i+="dni"}return i;case"MM":if(e===1){i+="mesec"}else if(e===2){i+="meseca"}else if(e===3||e===4){i+="mesece"}else{i+="mesecev"}return i;case"yy":if(e===1){i+="leto"}else if(e===2){i+="leti"}else if(e===3||e===4){i+="leta"}else{i+="let"}return i}}return e.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),weekdays:"nedelja_ponedeljek_torek_sreda_četrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._čet._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_če_pe_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[včeraj ob] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[prejšnja] dddd [ob] LT";case 1:case 2:case 4:case 5:return"[prejšnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"čez %s",past:"%s nazaj",s:"nekaj sekund",m:t,mm:t,h:t,hh:t,d:"en dan",dd:t,M:"en mesec",MM:t,y:"eno leto",yy:t},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nëntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nën_Dhj".split("_"),weekdays:"E Diel_E Hënë_E Martë_E Mërkurë_E Enjte_E Premte_E Shtunë".split("_"),weekdaysShort:"Die_Hën_Mar_Mër_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_Më_E_P_Sh".split("_"),meridiem:function(e,t,n){return e<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Sot në] LT",nextDay:"[Nesër në] LT",nextWeek:"dddd [në] LT",lastDay:"[Dje në] LT",lastWeek:"dddd [e kaluar në] LT",sameElse:"L"},relativeTime:{future:"në %s",past:"%s më parë",s:"disa sekonda",m:"një minutë",mm:"%d minuta",h:"një orë",hh:"%d orë",d:"një ditë",dd:"%d ditë",M:"një muaj",MM:"%d muaj",y:"një vit",yy:"%d vite"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t={words:{m:["један минут","једне минуте"],mm:["минут","минуте","минута"],h:["један сат","једног сата"],hh:["сат","сата","сати"],dd:["дан","дана","дана"],MM:["месец","месеца","месеци"],yy:["година","године","година"]},correctGrammaticalCase:function(e,t){return e===1?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,n,i){var r=t.words[i];if(i.length===1){return n?r[0]:r[1]}else{return e+" "+t.correctGrammaticalCase(e,r)}}};return e.defineLocale("sr-cyrl",{months:["јануар","фебруар","март","април","мај","јун","јул","август","септембар","октобар","новембар","децембар"],monthsShort:["јан.","феб.","мар.","апр.","мај","јун","јул","авг.","сеп.","окт.","нов.","дец."],weekdays:["недеља","понедељак","уторак","среда","четвртак","петак","субота"],weekdaysShort:["нед.","пон.","уто.","сре.","чет.","пет.","суб."],weekdaysMin:["не","по","ут","ср","че","пе","су"],longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[данас у] LT",nextDay:"[сутра у] LT",nextWeek:function(){switch(this.day()){case 0:return"[у] [недељу] [у] LT";case 3:return"[у] [среду] [у] LT";case 6:return"[у] [суботу] [у] LT";case 1:case 2:case 4:case 5:return"[у] dddd [у] LT"}},lastDay:"[јуче у] LT",lastWeek:function(){var e=["[прошле] [недеље] [у] LT","[прошлог] [понедељка] [у] LT","[прошлог] [уторка] [у] LT","[прошле] [среде] [у] LT","[прошлог] [четвртка] [у] LT","[прошлог] [петка] [у] LT","[прошле] [суботе] [у] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:"за %s",past:"пре %s",s:"неколико секунди",m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"дан",dd:t.translate,M:"месец",MM:t.translate,y:"годину",yy:t.translate},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){var t={words:{m:["jedan minut","jedne minute"],mm:["minut","minute","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mesec","meseca","meseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return e===1?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,n,i){var r=t.words[i];if(i.length===1){return n?r[0]:r[1]}else{return e+" "+t.correctGrammaticalCase(e,r)}}};return e.defineLocale("sr",{months:["januar","februar","mart","april","maj","jun","jul","avgust","septembar","oktobar","novembar","decembar"],monthsShort:["jan.","feb.","mar.","apr.","maj","jun","jul","avg.","sep.","okt.","nov.","dec."],weekdays:["nedelja","ponedeljak","utorak","sreda","četvrtak","petak","subota"],weekdaysShort:["ned.","pon.","uto.","sre.","čet.","pet.","sub."],weekdaysMin:["ne","po","ut","sr","če","pe","su"],longDateFormat:{LT:"H:mm",LTS:"LT:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juče u] LT",lastWeek:function(){var e=["[prošle] [nedelje] [u] LT","[prošlog] [ponedeljka] [u] LT","[prošlog] [utorka] [u] LT","[prošle] [srede] [u] LT","[prošlog] [četvrtka] [u] LT","[prošlog] [petka] [u] LT","[prošle] [subote] [u] LT"];return e[this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mesec",MM:t.translate,y:"godinu",yy:t.translate},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"söndag_måndag_tisdag_onsdag_torsdag_fredag_lördag".split("_"),weekdaysShort:"sön_mån_tis_ons_tor_fre_lör".split("_"),weekdaysMin:"sö_må_ti_on_to_fr_lö".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igår] LT",nextWeek:"dddd LT",lastWeek:"[Förra] dddd[en] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"för %s sedan",s:"några sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en månad",MM:"%d månader",y:"ett år",yy:"%d år"},ordinalParse:/\d{1,2}(e|a)/,ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"e":t===1?"a":t===2?"a":t===3?"e":"e";return e+n},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("ta",{months:"ஜனவரி_பிப்ரவரி_மார்ச்_ஏப்ரல்_மே_ஜூன்_ஜூலை_ஆகஸ்ட்_செப்டெம்பர்_அக்டோபர்_நவம்பர்_டிசம்பர்".split("_"),monthsShort:"ஜனவரி_பிப்ரவரி_மார்ச்_ஏப்ரல்_மே_ஜூன்_ஜூலை_ஆகஸ்ட்_செப்டெம்பர்_அக்டோபர்_நவம்பர்_டிசம்பர்".split("_"),weekdays:"ஞாயிற்றுக்கிழமை_திங்கட்கிழமை_செவ்வாய்கிழமை_புதன்கிழமை_வியாழக்கிழமை_வெள்ளிக்கிழமை_சனிக்கிழமை".split("_"),weekdaysShort:"ஞாயிறு_திங்கள்_செவ்வாய்_புதன்_வியாழன்_வெள்ளி_சனி".split("_"),weekdaysMin:"ஞா_தி_செ_பு_வி_வெ_ச".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, LT",LLLL:"dddd, D MMMM YYYY, LT"},calendar:{sameDay:"[இன்று] LT",nextDay:"[நாளை] LT",nextWeek:"dddd, LT",lastDay:"[நேற்று] LT",lastWeek:"[கடந்த வாரம்] dddd, LT",sameElse:"L"},relativeTime:{future:"%s இல்",past:"%s முன்",s:"ஒரு சில விநாடிகள்",m:"ஒரு நிமிடம்",mm:"%d நிமிடங்கள்",h:"ஒரு மணி நேரம்",hh:"%d மணி நேரம்",d:"ஒரு நாள்",dd:"%d நாட்கள்",M:"ஒரு மாதம்",MM:"%d மாதங்கள்",y:"ஒரு வருடம்",yy:"%d ஆண்டுகள்"},ordinalParse:/\d{1,2}வது/,ordinal:function(e){return e+"வது"},meridiem:function(e,t,n){if(e>=6&&e<=10){return" காலை"}else if(e>=10&&e<=14){return" நண்பகல்"}else if(e>=14&&e<=18){return" எற்பாடு"}else if(e>=18&&e<=20){return" மாலை"}else if(e>=20&&e<=24){return" இரவு"}else if(e>=0&&e<=6){return" வைகறை"}},week:{dow:0,doy:6}})});(function(e){e(t)})(function(e){return e.defineLocale("th",{months:"มกราคม_กุมภาพันธ์_มีนาคม_เมษายน_พฤษภาคม_มิถุนายน_กรกฎาคม_สิงหาคม_กันยายน_ตุลาคม_พฤศจิกายน_ธันวาคม".split("_"),monthsShort:"มกรา_กุมภา_มีนา_เมษา_พฤษภา_มิถุนา_กรกฎา_สิงหา_กันยา_ตุลา_พฤศจิกา_ธันวา".split("_"),weekdays:"อาทิตย์_จันทร์_อังคาร_พุธ_พฤหัสบดี_ศุกร์_เสาร์".split("_"),weekdaysShort:"อาทิตย์_จันทร์_อังคาร_พุธ_พฤหัส_ศุกร์_เสาร์".split("_"),weekdaysMin:"อา._จ._อ._พ._พฤ._ศ._ส.".split("_"),longDateFormat:{LT:"H นาฬิกา m นาที",LTS:"LT s วินาที",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY เวลา LT",LLLL:"วันddddที่ D MMMM YYYY เวลา LT"},meridiem:function(e,t,n){if(e<12){return"ก่อนเที่ยง"}else{return"หลังเที่ยง"}},calendar:{sameDay:"[วันนี้ เวลา] LT",nextDay:"[พรุ่งนี้ เวลา] LT",nextWeek:"dddd[หน้า เวลา] LT",lastDay:"[เมื่อวานนี้ เวลา] LT",lastWeek:"[วัน]dddd[ที่แล้ว เวลา] LT",sameElse:"L"},relativeTime:{future:"อีก %s",past:"%sที่แล้ว",s:"ไม่กี่วินาที",m:"1 นาที",mm:"%d นาที",h:"1 ชั่วโมง",hh:"%d ชั่วโมง",d:"1 วัน",dd:"%d วัน",M:"1 เดือน",MM:"%d เดือน",y:"1 ปี",yy:"%d ปี"}})});(function(e){e(t)})(function(e){return e.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM DD, YYYY LT"},calendar:{sameDay:"[Ngayon sa] LT",nextDay:"[Bukas sa] LT",nextWeek:"dddd [sa] LT",lastDay:"[Kahapon sa] LT",lastWeek:"dddd [huling linggo] LT",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},ordinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){var t={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'üncü",4:"'üncü",100:"'üncü",6:"'ncı",9:"'uncu",10:"'uncu",30:"'uncu",60:"'ıncı",90:"'ıncı"};return e.defineLocale("tr",{months:"Ocak_Şubat_Mart_Nisan_Mayıs_Haziran_Temmuz_Ağustos_Eylül_Ekim_Kasım_Aralık".split("_"),monthsShort:"Oca_Şub_Mar_Nis_May_Haz_Tem_Ağu_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Salı_Çarşamba_Perşembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pts_Sal_Çar_Per_Cum_Cts".split("_"),weekdaysMin:"Pz_Pt_Sa_Ça_Pe_Cu_Ct".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[bugün saat] LT",nextDay:"[yarın saat] LT",nextWeek:"[haftaya] dddd [saat] LT",lastDay:"[dün] LT",lastWeek:"[geçen hafta] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s önce",s:"birkaç saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gün",dd:"%d gün",M:"bir ay",MM:"%d ay",y:"bir yıl",yy:"%d yıl"},ordinalParse:/\d{1,2}'(inci|nci|üncü|ncı|uncu|ıncı)/,ordinal:function(e){if(e===0){return e+"'ıncı"
}var n=e%10,i=e%100-n,r=e>=100?100:null;return e+(t[n]||t[i]||t[r])},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("tzm-latn",{months:"innayr_brˤayrˤ_marˤsˤ_ibrir_mayyw_ywnyw_ywlywz_ɣwšt_šwtanbir_ktˤwbrˤ_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brˤayrˤ_marˤsˤ_ibrir_mayyw_ywnyw_ywlywz_ɣwšt_šwtanbir_ktˤwbrˤ_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiḍyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",m:"minuḍ",mm:"%d minuḍ",h:"saɛa",hh:"%d tassaɛin",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){return e.defineLocale("tzm",{months:"ⵉⵏⵏⴰⵢⵔ_ⴱⵕⴰⵢⵕ_ⵎⴰⵕⵚ_ⵉⴱⵔⵉⵔ_ⵎⴰⵢⵢⵓ_ⵢⵓⵏⵢⵓ_ⵢⵓⵍⵢⵓⵣ_ⵖⵓⵛⵜ_ⵛⵓⵜⴰⵏⴱⵉⵔ_ⴽⵟⵓⴱⵕ_ⵏⵓⵡⴰⵏⴱⵉⵔ_ⴷⵓⵊⵏⴱⵉⵔ".split("_"),monthsShort:"ⵉⵏⵏⴰⵢⵔ_ⴱⵕⴰⵢⵕ_ⵎⴰⵕⵚ_ⵉⴱⵔⵉⵔ_ⵎⴰⵢⵢⵓ_ⵢⵓⵏⵢⵓ_ⵢⵓⵍⵢⵓⵣ_ⵖⵓⵛⵜ_ⵛⵓⵜⴰⵏⴱⵉⵔ_ⴽⵟⵓⴱⵕ_ⵏⵓⵡⴰⵏⴱⵉⵔ_ⴷⵓⵊⵏⴱⵉⵔ".split("_"),weekdays:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),weekdaysShort:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),weekdaysMin:"ⴰⵙⴰⵎⴰⵙ_ⴰⵢⵏⴰⵙ_ⴰⵙⵉⵏⴰⵙ_ⴰⴽⵔⴰⵙ_ⴰⴽⵡⴰⵙ_ⴰⵙⵉⵎⵡⴰⵙ_ⴰⵙⵉⴹⵢⴰⵙ".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[ⴰⵙⴷⵅ ⴴ] LT",nextDay:"[ⴰⵙⴽⴰ ⴴ] LT",nextWeek:"dddd [ⴴ] LT",lastDay:"[ⴰⵚⴰⵏⵜ ⴴ] LT",lastWeek:"dddd [ⴴ] LT",sameElse:"L"},relativeTime:{future:"ⴷⴰⴷⵅ ⵙ ⵢⴰⵏ %s",past:"ⵢⴰⵏ %s",s:"ⵉⵎⵉⴽ",m:"ⵎⵉⵏⵓⴺ",mm:"%d ⵎⵉⵏⵓⴺ",h:"ⵙⴰⵄⴰ",hh:"%d ⵜⴰⵙⵙⴰⵄⵉⵏ",d:"ⴰⵙⵙ",dd:"%d oⵙⵙⴰⵏ",M:"ⴰⵢoⵓⵔ",MM:"%d ⵉⵢⵢⵉⵔⵏ",y:"ⴰⵙⴳⴰⵙ",yy:"%d ⵉⵙⴳⴰⵙⵏ"},week:{dow:6,doy:12}})});(function(e){e(t)})(function(e){function t(e,t){var n=e.split("_");return t%10===1&&t%100!==11?n[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?n[1]:n[2]}function n(e,n,i){var r={mm:"хвилина_хвилини_хвилин",hh:"година_години_годин",dd:"день_дні_днів",MM:"місяць_місяці_місяців",yy:"рік_роки_років"};if(i==="m"){return n?"хвилина":"хвилину"}else if(i==="h"){return n?"година":"годину"}else{return e+" "+t(r[i],+e)}}function i(e,t){var n={nominative:"січень_лютий_березень_квітень_травень_червень_липень_серпень_вересень_жовтень_листопад_грудень".split("_"),accusative:"січня_лютого_березня_квітня_травня_червня_липня_серпня_вересня_жовтня_листопада_грудня".split("_")},i=/D[oD]? *MMMM?/.test(t)?"accusative":"nominative";return n[i][e.month()]}function r(e,t){var n={nominative:"неділя_понеділок_вівторок_середа_четвер_п’ятниця_субота".split("_"),accusative:"неділю_понеділок_вівторок_середу_четвер_п’ятницю_суботу".split("_"),genitive:"неділі_понеділка_вівторка_середи_четверга_п’ятниці_суботи".split("_")},i=/(\[[ВвУу]\]) ?dddd/.test(t)?"accusative":/\[?(?:минулої|наступної)? ?\] ?dddd/.test(t)?"genitive":"nominative";return n[i][e.day()]}function a(e){return function(){return e+"о"+(this.hours()===11?"б":"")+"] LT"}}return e.defineLocale("uk",{months:i,monthsShort:"січ_лют_бер_квіт_трав_черв_лип_серп_вер_жовт_лист_груд".split("_"),weekdays:r,weekdaysShort:"нд_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"нд_пн_вт_ср_чт_пт_сб".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY р.",LLL:"D MMMM YYYY р., LT",LLLL:"dddd, D MMMM YYYY р., LT"},calendar:{sameDay:a("[Сьогодні "),nextDay:a("[Завтра "),lastDay:a("[Вчора "),nextWeek:a("[У] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return a("[Минулої] dddd [").call(this);case 1:case 2:case 4:return a("[Минулого] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:"за %s",past:"%s тому",s:"декілька секунд",m:n,mm:n,h:"годину",hh:n,d:"день",dd:n,M:"місяць",MM:n,y:"рік",yy:n},meridiem:function(e,t,n){if(e<4){return"ночі"}else if(e<12){return"ранку"}else if(e<17){return"дня"}else{return"вечора"}},ordinalParse:/\d{1,2}-(й|го)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-й";case"D":return e+"-го";default:return e}},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("uz",{months:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),monthsShort:"янв_фев_мар_апр_май_июн_июл_авг_сен_окт_ноя_дек".split("_"),weekdays:"Якшанба_Душанба_Сешанба_Чоршанба_Пайшанба_Жума_Шанба".split("_"),weekdaysShort:"Якш_Душ_Сеш_Чор_Пай_Жум_Шан".split("_"),weekdaysMin:"Як_Ду_Се_Чо_Па_Жу_Ша".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"D MMMM YYYY, dddd LT"},calendar:{sameDay:"[Бугун соат] LT [да]",nextDay:"[Эртага] LT [да]",nextWeek:"dddd [куни соат] LT [да]",lastDay:"[Кеча соат] LT [да]",lastWeek:"[Утган] dddd [куни соат] LT [да]",sameElse:"L"},relativeTime:{future:"Якин %s ичида",past:"Бир неча %s олдин",s:"фурсат",m:"бир дакика",mm:"%d дакика",h:"бир соат",hh:"%d соат",d:"бир кун",dd:"%d кун",M:"бир ой",MM:"%d ой",y:"бир йил",yy:"%d йил"},week:{dow:1,doy:7}})});(function(e){e(t)})(function(e){return e.defineLocale("vi",{months:"tháng 1_tháng 2_tháng 3_tháng 4_tháng 5_tháng 6_tháng 7_tháng 8_tháng 9_tháng 10_tháng 11_tháng 12".split("_"),monthsShort:"Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),weekdays:"chủ nhật_thứ hai_thứ ba_thứ tư_thứ năm_thứ sáu_thứ bảy".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),longDateFormat:{LT:"HH:mm",LTS:"LT:ss",L:"DD/MM/YYYY",LL:"D MMMM [năm] YYYY",LLL:"D MMMM [năm] YYYY LT",LLLL:"dddd, D MMMM [năm] YYYY LT",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY LT",llll:"ddd, D MMM YYYY LT"},calendar:{sameDay:"[Hôm nay lúc] LT",nextDay:"[Ngày mai lúc] LT",nextWeek:"dddd [tuần tới lúc] LT",lastDay:"[Hôm qua lúc] LT",lastWeek:"dddd [tuần rồi lúc] LT",sameElse:"L"},relativeTime:{future:"%s tới",past:"%s trước",s:"vài giây",m:"một phút",mm:"%d phút",h:"một giờ",hh:"%d giờ",d:"một ngày",dd:"%d ngày",M:"một tháng",MM:"%d tháng",y:"một năm",yy:"%d năm"},ordinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t,n){var i=e*100+t;if(i<600){return"凌晨"}else if(i<900){return"早上"}else if(i<1130){return"上午"}else if(i<1230){return"中午"}else if(i<1800){return"下午"}else{return"晚上"}},calendar:{sameDay:function(){return this.minutes()===0?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return this.minutes()===0?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return this.minutes()===0?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var t,n;t=e().startOf("week");n=this.unix()-t.unix()>=7*24*3600?"[下]":"[本]";return this.minutes()===0?n+"dddAh点整":n+"dddAh点mm"},lastWeek:function(){var t,n;t=e().startOf("week");n=this.unix()<t.unix()?"[上]":"[本]";return this.minutes()===0?n+"dddAh点整":n+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"周";default:return e}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"},week:{dow:1,doy:4}})});(function(e){e(t)})(function(e){return e.defineLocale("zh-tw",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah點mm",LTS:"Ah點m分s秒",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiem:function(e,t,n){var i=e*100+t;if(i<900){return"早上"}else if(i<1130){return"上午"}else if(i<1230){return"中午"}else if(i<1800){return"下午"}else{return"晚上"}},calendar:{sameDay:"[今天]LT",nextDay:"[明天]LT",nextWeek:"[下]ddddLT",lastDay:"[昨天]LT",lastWeek:"[上]ddddLT",sameElse:"L"},ordinalParse:/\d{1,2}(日|月|週)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"日";case"M":return e+"月";case"w":case"W":return e+"週";default:return e}},relativeTime:{future:"%s內",past:"%s前",s:"幾秒",m:"一分鐘",mm:"%d分鐘",h:"一小時",hh:"%d小時",d:"一天",dd:"%d天",M:"一個月",MM:"%d個月",y:"一年",yy:"%d年"}})});t.locale("en");function yn(e){if(typeof ender!=="undefined"){return}r=i.moment;if(e){i.moment=at("Accessing Moment through the global scope is "+"deprecated, and will be removed in an upcoming "+"release.",t)}else{i.moment=t}}if(g){module.exports=t}else if(typeof define==="function"&&define.amd){define("moment",function(e,n,a){if(a.config&&a.config()&&a.config().noGlobal===true){i.moment=r}return t});yn(true)}else{yn()}}).call(this);/*!
 * jQuery JavaScript Library v2.1.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-05-01T17:11Z
 */
(function(e,t){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=e.document?t(e,true):function(e){if(!e.document){throw new Error("jQuery requires a window with a document")}return t(e)}}else{t(e)}})(typeof window!=="undefined"?window:this,function(e,t){var n=[];var i=n.slice;var r=n.concat;var a=n.push;var o=n.indexOf;var s={};var l=s.toString;var u=s.hasOwnProperty;var c={};var d=e.document,h="2.1.1",f=function(e,t){return new f.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,m=/^-ms-/,_=/-([\da-z])/gi,g=function(e,t){return t.toUpperCase()};f.fn=f.prototype={jquery:h,constructor:f,selector:"",length:0,toArray:function(){return i.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:i.call(this)},pushStack:function(e){var t=f.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return f.each(this,e,t)},map:function(e){return this.pushStack(f.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(i.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:a,sort:n.sort,splice:n.splice};f.extend=f.fn.extend=function(){var e,t,n,i,r,a,o=arguments[0]||{},s=1,l=arguments.length,u=false;if(typeof o==="boolean"){u=o;o=arguments[s]||{};s++}if(typeof o!=="object"&&!f.isFunction(o)){o={}}if(s===l){o=this;s--}for(;s<l;s++){if((e=arguments[s])!=null){for(t in e){n=o[t];i=e[t];if(o===i){continue}if(u&&i&&(f.isPlainObject(i)||(r=f.isArray(i)))){if(r){r=false;a=n&&f.isArray(n)?n:[]}else{a=n&&f.isPlainObject(n)?n:{}}o[t]=f.extend(u,a,i)}else if(i!==undefined){o[t]=i}}}}return o};f.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:true,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return f.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!f.isArray(e)&&e-parseFloat(e)>=0},isPlainObject:function(e){if(f.type(e)!=="object"||e.nodeType||f.isWindow(e)){return false}if(e.constructor&&!u.call(e.constructor.prototype,"isPrototypeOf")){return false}return true},isEmptyObject:function(e){var t;for(t in e){return false}return true},type:function(e){if(e==null){return e+""}return typeof e==="object"||typeof e==="function"?s[l.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;e=f.trim(e);if(e){if(e.indexOf("use strict")===1){t=d.createElement("script");t.text=e;d.head.appendChild(t).parentNode.removeChild(t)}else{n(e)}}},camelCase:function(e){return e.replace(m,"ms-").replace(_,g)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var i,r=0,a=e.length,o=v(e);if(n){if(o){for(;r<a;r++){i=t.apply(e[r],n);if(i===false){break}}}else{for(r in e){i=t.apply(e[r],n);if(i===false){break}}}}else{if(o){for(;r<a;r++){i=t.call(e[r],r,e[r]);if(i===false){break}}}else{for(r in e){i=t.call(e[r],r,e[r]);if(i===false){break}}}}return e},trim:function(e){return e==null?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];if(e!=null){if(v(Object(e))){f.merge(n,typeof e==="string"?[e]:e)}else{a.call(n,e)}}return n},inArray:function(e,t,n){return t==null?-1:o.call(t,e,n)},merge:function(e,t){var n=+t.length,i=0,r=e.length;for(;i<n;i++){e[r++]=t[i]}e.length=r;return e},grep:function(e,t,n){var i,r=[],a=0,o=e.length,s=!n;for(;a<o;a++){i=!t(e[a],a);if(i!==s){r.push(e[a])}}return r},map:function(e,t,n){var i,a=0,o=e.length,s=v(e),l=[];if(s){for(;a<o;a++){i=t(e[a],a,n);if(i!=null){l.push(i)}}}else{for(a in e){i=t(e[a],a,n);if(i!=null){l.push(i)}}}return r.apply([],l)},guid:1,proxy:function(e,t){var n,r,a;if(typeof t==="string"){n=e[t];t=e;e=n}if(!f.isFunction(e)){return undefined}r=i.call(arguments,2);a=function(){return e.apply(t||this,r.concat(i.call(arguments)))};a.guid=e.guid=e.guid||f.guid++;return a},now:Date.now,support:c});f.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){s["[object "+t+"]"]=t.toLowerCase()});function v(e){var t=e.length,n=f.type(e);if(n==="function"||f.isWindow(e)){return false}if(e.nodeType===1&&t){return true}return n==="array"||t===0||typeof t==="number"&&t>0&&t-1 in e}var y=/*!
 * Sizzle CSS Selector Engine v1.10.19
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-04-18
 */
function(e){var t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,_,g,v,y,w="sizzle"+-new Date,b=e.document,C=0,S=0,T=ot(),x=ot(),k=ot(),M=function(e,t){if(e===t){d=true}return 0},L=typeof undefined,B=1<<31,E={}.hasOwnProperty,D=[],V=D.pop,I=D.push,P=D.push,A=D.slice,F=D.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++){if(this[t]===e){return t}}return-1},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",H=N.replace("w","w#"),j="\\["+R+"*("+N+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+H+"))|)"+R+"*\\]",U=":("+N+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+j+")*)|"+".*"+")\\)|)",G=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g"),W=new RegExp("^"+R+"*,"+R+"*"),K=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),z=new RegExp("="+R+"*([^\\]'\"]*?)"+R+"*\\]","g"),Y=new RegExp(U),q=new RegExp("^"+H+"$"),Q={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+j),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,X=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+R+"?|("+R+")|.)","ig"),it=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,i&1023|56320)};try{P.apply(D=A.call(b.childNodes),b.childNodes);D[b.childNodes.length].nodeType}catch(rt){P={apply:D.length?function(e,t){I.apply(e,A.call(t))}:function(e,t){var n=e.length,i=0;while(e[n++]=t[i++]){}e.length=n-1}}}function at(e,t,i,r){var a,s,u,c,d,p,g,v,C,S;if((t?t.ownerDocument||t:b)!==f){h(t)}t=t||f;i=i||[];if(!e||typeof e!=="string"){return i}if((c=t.nodeType)!==1&&c!==9){return[]}if(m&&!r){if(a=Z.exec(e)){if(u=a[1]){if(c===9){s=t.getElementById(u);if(s&&s.parentNode){if(s.id===u){i.push(s);return i}}else{return i}}else{if(t.ownerDocument&&(s=t.ownerDocument.getElementById(u))&&y(t,s)&&s.id===u){i.push(s);return i}}}else if(a[2]){P.apply(i,t.getElementsByTagName(e));return i}else if((u=a[3])&&n.getElementsByClassName&&t.getElementsByClassName){P.apply(i,t.getElementsByClassName(u));return i}}if(n.qsa&&(!_||!_.test(e))){v=g=w;C=t;S=c===9&&e;if(c===1&&t.nodeName.toLowerCase()!=="object"){p=o(e);if(g=t.getAttribute("id")){v=g.replace(tt,"\\$&")}else{t.setAttribute("id",v)}v="[id='"+v+"'] ";d=p.length;while(d--){p[d]=v+_t(p[d])}C=et.test(e)&&pt(t.parentNode)||t;S=p.join(",")}if(S){try{P.apply(i,C.querySelectorAll(S));return i}catch(T){}finally{if(!g){t.removeAttribute("id")}}}}}return l(e.replace(G,"$1"),t,i,r)}function ot(){var e=[];function t(n,r){if(e.push(n+" ")>i.cacheLength){delete t[e.shift()]}return t[n+" "]=r}return t}function st(e){e[w]=true;return e}function lt(e){var t=f.createElement("div");try{return!!e(t)}catch(n){return false}finally{if(t.parentNode){t.parentNode.removeChild(t)}t=null}}function ut(e,t){var n=e.split("|"),r=e.length;while(r--){i.attrHandle[n[r]]=t}}function ct(e,t){var n=t&&e,i=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||B)-(~e.sourceIndex||B);if(i){return i}if(n){while(n=n.nextSibling){if(n===t){return-1}}}return e?1:-1}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ft(e){return st(function(t){t=+t;return st(function(n,i){var r,a=e([],n.length,t),o=a.length;while(o--){if(n[r=a[o]]){n[r]=!(i[r]=n[r])}}})})}function pt(e){return e&&typeof e.getElementsByTagName!==L&&e}n=at.support={};a=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":false};h=at.setDocument=function(e){var t,r=e?e.ownerDocument||e:b,o=r.defaultView;if(r===f||r.nodeType!==9||!r.documentElement){return f}f=r;p=r.documentElement;m=!a(r);if(o&&o!==o.top){if(o.addEventListener){o.addEventListener("unload",function(){h()},false)}else if(o.attachEvent){o.attachEvent("onunload",function(){h()})}}n.attributes=lt(function(e){e.className="i";return!e.getAttribute("className")});n.getElementsByTagName=lt(function(e){e.appendChild(r.createComment(""));return!e.getElementsByTagName("*").length});n.getElementsByClassName=X.test(r.getElementsByClassName)&&lt(function(e){e.innerHTML="<div class='a'></div><div class='a i'></div>";e.firstChild.className="i";return e.getElementsByClassName("i").length===2});n.getById=lt(function(e){p.appendChild(e).id=w;return!r.getElementsByName||!r.getElementsByName(w).length});if(n.getById){i.find["ID"]=function(e,t){if(typeof t.getElementById!==L&&m){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}};i.filter["ID"]=function(e){var t=e.replace(nt,it);return function(e){return e.getAttribute("id")===t}}}else{delete i.find["ID"];i.filter["ID"]=function(e){var t=e.replace(nt,it);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}}i.find["TAG"]=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L){return t.getElementsByTagName(e)}}:function(e,t){var n,i=[],r=0,a=t.getElementsByTagName(e);if(e==="*"){while(n=a[r++]){if(n.nodeType===1){i.push(n)}}return i}return a};i.find["CLASS"]=n.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&m){return t.getElementsByClassName(e)}};g=[];_=[];if(n.qsa=X.test(r.querySelectorAll)){lt(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>";if(e.querySelectorAll("[msallowclip^='']").length){_.push("[*^$]="+R+"*(?:''|\"\")")}if(!e.querySelectorAll("[selected]").length){_.push("\\["+R+"*(?:value|"+O+")")}if(!e.querySelectorAll(":checked").length){_.push(":checked")}});lt(function(e){var t=r.createElement("input");t.setAttribute("type","hidden");e.appendChild(t).setAttribute("name","D");if(e.querySelectorAll("[name=d]").length){_.push("name"+R+"*[*^$|!~]?=")}if(!e.querySelectorAll(":enabled").length){_.push(":enabled",":disabled")}e.querySelectorAll("*,:x");_.push(",.*:")})}if(n.matchesSelector=X.test(v=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector)){lt(function(e){n.disconnectedMatch=v.call(e,"div");v.call(e,"[s!='']:x");g.push("!=",U)})}_=_.length&&new RegExp(_.join("|"));g=g.length&&new RegExp(g.join("|"));t=X.test(p.compareDocumentPosition);y=t||X.test(p.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,i=t&&t.parentNode;return e===i||!!(i&&i.nodeType===1&&(n.contains?n.contains(i):e.compareDocumentPosition&&e.compareDocumentPosition(i)&16))}:function(e,t){if(t){while(t=t.parentNode){if(t===e){return true}}}return false};M=t?function(e,t){if(e===t){d=true;return 0}var i=!e.compareDocumentPosition-!t.compareDocumentPosition;if(i){return i}i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1;if(i&1||!n.sortDetached&&t.compareDocumentPosition(e)===i){if(e===r||e.ownerDocument===b&&y(b,e)){return-1}if(t===r||t.ownerDocument===b&&y(b,t)){return 1}return c?F.call(c,e)-F.call(c,t):0}return i&4?-1:1}:function(e,t){if(e===t){d=true;return 0}var n,i=0,a=e.parentNode,o=t.parentNode,s=[e],l=[t];if(!a||!o){return e===r?-1:t===r?1:a?-1:o?1:c?F.call(c,e)-F.call(c,t):0}else if(a===o){return ct(e,t)}n=e;while(n=n.parentNode){s.unshift(n)}n=t;while(n=n.parentNode){l.unshift(n)}while(s[i]===l[i]){i++}return i?ct(s[i],l[i]):s[i]===b?-1:l[i]===b?1:0};return r};at.matches=function(e,t){return at(e,null,null,t)};at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f){h(e)}t=t.replace(z,"='$1']");if(n.matchesSelector&&m&&(!g||!g.test(t))&&(!_||!_.test(t))){try{var i=v.call(e,t);if(i||n.disconnectedMatch||e.document&&e.document.nodeType!==11){return i}}catch(r){}}return at(t,f,null,[e]).length>0};at.contains=function(e,t){if((e.ownerDocument||e)!==f){h(e)}return y(e,t)};at.attr=function(e,t){if((e.ownerDocument||e)!==f){h(e)}var r=i.attrHandle[t.toLowerCase()],a=r&&E.call(i.attrHandle,t.toLowerCase())?r(e,t,!m):undefined;return a!==undefined?a:n.attributes||!m?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null};at.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};at.uniqueSort=function(e){var t,i=[],r=0,a=0;d=!n.detectDuplicates;c=!n.sortStable&&e.slice(0);e.sort(M);if(d){while(t=e[a++]){if(t===e[a]){r=i.push(a)}}while(r--){e.splice(i[r],1)}}c=null;return e};r=at.getText=function(e){var t,n="",i=0,a=e.nodeType;if(!a){while(t=e[i++]){n+=r(t)}}else if(a===1||a===9||a===11){if(typeof e.textContent==="string"){return e.textContent}else{for(e=e.firstChild;e;e=e.nextSibling){n+=r(e)}}}else if(a===3||a===4){return e.nodeValue}return n};i=at.selectors={cacheLength:50,createPseudo:st,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(nt,it);e[3]=(e[3]||e[4]||e[5]||"").replace(nt,it);if(e[2]==="~="){e[3]=" "+e[3]+" "}return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if(e[1].slice(0,3)==="nth"){if(!e[3]){at.error(e[0])}e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd"));e[5]=+(e[7]+e[8]||e[3]==="odd")}else if(e[3]){at.error(e[0])}return e},PSEUDO:function(e){var t,n=!e[6]&&e[2];if(Q["CHILD"].test(e[0])){return null}if(e[3]){e[2]=e[4]||e[5]||""}else if(n&&Y.test(n)&&(t=o(n,true))&&(t=n.indexOf(")",n.length-t)-n.length)){e[0]=e[0].slice(0,t);e[2]=n.slice(0,t)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(nt,it).toLowerCase();return e==="*"?function(){return true}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+R+")"+e+"("+R+"|$)"))&&T(e,function(e){return t.test(typeof e.className==="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var r=at.attr(i,e);if(r==null){return t==="!="}if(!t){return true}r+="";return t==="="?r===n:t==="!="?r!==n:t==="^="?n&&r.indexOf(n)===0:t==="*="?n&&r.indexOf(n)>-1:t==="$="?n&&r.slice(-n.length)===n:t==="~="?(" "+r+" ").indexOf(n)>-1:t==="|="?r===n||r.slice(0,n.length+1)===n+"-":false}},CHILD:function(e,t,n,i,r){var a=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",s=t==="of-type";return i===1&&r===0?function(e){return!!e.parentNode}:function(t,n,l){var u,c,d,h,f,p,m=a!==o?"nextSibling":"previousSibling",_=t.parentNode,g=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(_){if(a){while(m){d=t;while(d=d[m]){if(s?d.nodeName.toLowerCase()===g:d.nodeType===1){return false}}p=m=e==="only"&&!p&&"nextSibling"}return true}p=[o?_.firstChild:_.lastChild];if(o&&v){c=_[w]||(_[w]={});u=c[e]||[];f=u[0]===C&&u[1];h=u[0]===C&&u[2];d=f&&_.childNodes[f];while(d=++f&&d&&d[m]||(h=f=0)||p.pop()){if(d.nodeType===1&&++h&&d===t){c[e]=[C,f,h];break}}}else if(v&&(u=(t[w]||(t[w]={}))[e])&&u[0]===C){h=u[1]}else{while(d=++f&&d&&d[m]||(h=f=0)||p.pop()){if((s?d.nodeName.toLowerCase()===g:d.nodeType===1)&&++h){if(v){(d[w]||(d[w]={}))[e]=[C,h]}if(d===t){break}}}}h-=r;return h===i||h%i===0&&h/i>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);if(r[w]){return r(t)}if(r.length>1){n=[e,e,"",t];return i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,a=r(e,t),o=a.length;while(o--){i=F.call(e,a[o]);e[i]=!(n[i]=a[o])}}):function(e){return r(e,0,n)}}return r}},pseudos:{not:st(function(e){var t=[],n=[],i=s(e.replace(G,"$1"));return i[w]?st(function(e,t,n,r){var a,o=i(e,null,r,[]),s=e.length;while(s--){if(a=o[s]){e[s]=!(t[s]=a)}}}):function(e,r,a){t[0]=e;i(t,null,a,n);return!n.pop()}}),has:st(function(e){return function(t){return at(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||r(t)).indexOf(e)>-1}}),lang:st(function(e){if(!q.test(e||"")){at.error("unsupported lang: "+e)}e=e.replace(nt,it).toLowerCase();return function(t){var n;do{if(n=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang")){n=n.toLowerCase();return n===e||n.indexOf(e+"-")===0}}while((t=t.parentNode)&&t.nodeType===1);return false}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===false},disabled:function(e){return e.disabled===true},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeType<6){return false}}return true},parent:function(e){return!i.pseudos["empty"](e)},header:function(e){return $.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:ft(function(){return[0]}),last:ft(function(e,t){return[t-1]}),eq:ft(function(e,t,n){return[n<0?n+t:n]}),even:ft(function(e,t){var n=0;for(;n<t;n+=2){e.push(n)}return e}),odd:ft(function(e,t){var n=1;for(;n<t;n+=2){e.push(n)}return e}),lt:ft(function(e,t,n){var i=n<0?n+t:n;for(;--i>=0;){e.push(i)}return e}),gt:ft(function(e,t,n){var i=n<0?n+t:n;for(;++i<t;){e.push(i)}return e})}};i.pseudos["nth"]=i.pseudos["eq"];for(t in{radio:true,checkbox:true,file:true,password:true,image:true}){i.pseudos[t]=dt(t)}for(t in{submit:true,reset:true}){i.pseudos[t]=ht(t)}function mt(){}mt.prototype=i.filters=i.pseudos;i.setFilters=new mt;o=at.tokenize=function(e,t){var n,r,a,o,s,l,u,c=x[e+" "];if(c){return t?0:c.slice(0)}s=e;l=[];u=i.preFilter;while(s){if(!n||(r=W.exec(s))){if(r){s=s.slice(r[0].length)||s}l.push(a=[])}n=false;if(r=K.exec(s)){n=r.shift();a.push({value:n,type:r[0].replace(G," ")});s=s.slice(n.length)}for(o in i.filter){if((r=Q[o].exec(s))&&(!u[o]||(r=u[o](r)))){n=r.shift();a.push({value:n,type:o,matches:r});s=s.slice(n.length)}}if(!n){break}}return t?s.length:s?at.error(e):x(e,l).slice(0)};function _t(e){var t=0,n=e.length,i="";for(;t<n;t++){i+=e[t].value}return i}function gt(e,t,n){var i=t.dir,r=n&&i==="parentNode",a=S++;return t.first?function(t,n,a){while(t=t[i]){if(t.nodeType===1||r){return e(t,n,a)}}}:function(t,n,o){var s,l,u=[C,a];if(o){while(t=t[i]){if(t.nodeType===1||r){if(e(t,n,o)){return true}}}}else{while(t=t[i]){if(t.nodeType===1||r){l=t[w]||(t[w]={});if((s=l[i])&&s[0]===C&&s[1]===a){return u[2]=s[2]}else{l[i]=u;if(u[2]=e(t,n,o)){return true}}}}}}}function vt(e){return e.length>1?function(t,n,i){var r=e.length;while(r--){if(!e[r](t,n,i)){return false}}return true}:e[0]}function yt(e,t,n){var i=0,r=t.length;for(;i<r;i++){at(e,t[i],n)}return n}function wt(e,t,n,i,r){var a,o=[],s=0,l=e.length,u=t!=null;for(;s<l;s++){if(a=e[s]){if(!n||n(a,i,r)){o.push(a);if(u){t.push(s)}}}}return o}function bt(e,t,n,i,r,a){if(i&&!i[w]){i=bt(i)}if(r&&!r[w]){r=bt(r,a)}return st(function(a,o,s,l){var u,c,d,h=[],f=[],p=o.length,m=a||yt(t||"*",s.nodeType?[s]:s,[]),_=e&&(a||!t)?wt(m,h,e,s,l):m,g=n?r||(a?e:p||i)?[]:o:_;if(n){n(_,g,s,l)}if(i){u=wt(g,f);i(u,[],s,l);c=u.length;while(c--){if(d=u[c]){g[f[c]]=!(_[f[c]]=d)}}}if(a){if(r||e){if(r){u=[];c=g.length;while(c--){if(d=g[c]){u.push(_[c]=d)}}r(null,g=[],u,l)}c=g.length;while(c--){if((d=g[c])&&(u=r?F.call(a,d):h[c])>-1){a[u]=!(o[u]=d)}}}}else{g=wt(g===o?g.splice(p,g.length):g);if(r){r(null,o,g,l)}else{P.apply(o,g)}}})}function Ct(e){var t,n,r,a=e.length,o=i.relative[e[0].type],s=o||i.relative[" "],l=o?1:0,c=gt(function(e){return e===t},s,true),d=gt(function(e){return F.call(t,e)>-1},s,true),h=[function(e,n,i){return!o&&(i||n!==u)||((t=n).nodeType?c(e,n,i):d(e,n,i))}];for(;l<a;l++){if(n=i.relative[e[l].type]){h=[gt(vt(h),n)]}else{n=i.filter[e[l].type].apply(null,e[l].matches);if(n[w]){r=++l;for(;r<a;r++){if(i.relative[e[r].type]){break}}return bt(l>1&&vt(h),l>1&&_t(e.slice(0,l-1).concat({value:e[l-2].type===" "?"*":""})).replace(G,"$1"),n,l<r&&Ct(e.slice(l,r)),r<a&&Ct(e=e.slice(r)),r<a&&_t(e))}h.push(n)}}return vt(h)}function St(e,t){var n=t.length>0,r=e.length>0,a=function(a,o,s,l,c){var d,h,p,m=0,_="0",g=a&&[],v=[],y=u,w=a||r&&i.find["TAG"]("*",c),b=C+=y==null?1:Math.random()||.1,S=w.length;if(c){u=o!==f&&o}for(;_!==S&&(d=w[_])!=null;_++){if(r&&d){h=0;while(p=e[h++]){if(p(d,o,s)){l.push(d);break}}if(c){C=b}}if(n){if(d=!p&&d){m--}if(a){g.push(d)}}}m+=_;if(n&&_!==m){h=0;while(p=t[h++]){p(g,v,o,s)}if(a){if(m>0){while(_--){if(!(g[_]||v[_])){v[_]=V.call(l)}}}v=wt(v)}P.apply(l,v);if(c&&!a&&v.length>0&&m+t.length>1){at.uniqueSort(l)}}if(c){C=b;u=y}return g};return n?st(a):a}s=at.compile=function(e,t){var n,i=[],r=[],a=k[e+" "];if(!a){if(!t){t=o(e)}n=t.length;while(n--){a=Ct(t[n]);if(a[w]){i.push(a)}else{r.push(a)}}a=k(e,St(r,i));a.selector=e}return a};l=at.select=function(e,t,r,a){var l,u,c,d,h,f=typeof e==="function"&&e,p=!a&&o(e=f.selector||e);r=r||[];if(p.length===1){u=p[0]=p[0].slice(0);if(u.length>2&&(c=u[0]).type==="ID"&&n.getById&&t.nodeType===9&&m&&i.relative[u[1].type]){t=(i.find["ID"](c.matches[0].replace(nt,it),t)||[])[0];if(!t){return r}else if(f){t=t.parentNode}e=e.slice(u.shift().value.length)}l=Q["needsContext"].test(e)?0:u.length;while(l--){c=u[l];if(i.relative[d=c.type]){break}if(h=i.find[d]){if(a=h(c.matches[0].replace(nt,it),et.test(u[0].type)&&pt(t.parentNode)||t)){u.splice(l,1);e=a.length&&_t(u);if(!e){P.apply(r,a);return r}break}}}}(f||s(e,p))(a,t,!m,r,et.test(e)&&pt(t.parentNode)||t);return r};n.sortStable=w.split("").sort(M).join("")===w;n.detectDuplicates=!!d;h();n.sortDetached=lt(function(e){return e.compareDocumentPosition(f.createElement("div"))&1});if(!lt(function(e){e.innerHTML="<a href='#'></a>";return e.firstChild.getAttribute("href")==="#"})){ut("type|href|height|width",function(e,t,n){if(!n){return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}})}if(!n.attributes||!lt(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return e.firstChild.getAttribute("value")===""})){ut("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input"){return e.defaultValue}})}if(!lt(function(e){return e.getAttribute("disabled")==null})){ut(O,function(e,t,n){var i;if(!n){return e[t]===true?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}})}return at}(e);f.find=y;f.expr=y.selectors;f.expr[":"]=f.expr.pseudos;f.unique=y.uniqueSort;f.text=y.getText;f.isXMLDoc=y.isXML;f.contains=y.contains;var w=f.expr.match.needsContext;var b=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var C=/^.[^:#\[\.,]*$/;function S(e,t,n){if(f.isFunction(t)){return f.grep(e,function(e,i){return!!t.call(e,i,e)!==n})}if(t.nodeType){return f.grep(e,function(e){return e===t!==n})}if(typeof t==="string"){if(C.test(t)){return f.filter(t,e,n)}t=f.filter(t,e)}return f.grep(e,function(e){return o.call(t,e)>=0!==n})}f.filter=function(e,t,n){var i=t[0];if(n){e=":not("+e+")"}return t.length===1&&i.nodeType===1?f.find.matchesSelector(i,e)?[i]:[]:f.find.matches(e,f.grep(t,function(e){return e.nodeType===1}))};f.fn.extend({find:function(e){var t,n=this.length,i=[],r=this;if(typeof e!=="string"){return this.pushStack(f(e).filter(function(){for(t=0;t<n;t++){if(f.contains(r[t],this)){return true}}}))}for(t=0;t<n;t++){f.find(e,r[t],i)}i=this.pushStack(n>1?f.unique(i):i);i.selector=this.selector?this.selector+" "+e:e;return i},filter:function(e){return this.pushStack(S(this,e||[],false))},not:function(e){return this.pushStack(S(this,e||[],true))},is:function(e){return!!S(this,typeof e==="string"&&w.test(e)?f(e):e||[],false).length}});var T,x=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=f.fn.init=function(e,t){var n,i;if(!e){return this}if(typeof e==="string"){if(e[0]==="<"&&e[e.length-1]===">"&&e.length>=3){n=[null,e,null]}else{n=x.exec(e)}if(n&&(n[1]||!t)){if(n[1]){t=t instanceof f?t[0]:t;f.merge(this,f.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:d,true));if(b.test(n[1])&&f.isPlainObject(t)){for(n in t){if(f.isFunction(this[n])){this[n](t[n])}else{this.attr(n,t[n])}}}return this}else{i=d.getElementById(n[2]);if(i&&i.parentNode){this.length=1;this[0]=i}this.context=d;this.selector=e;return this}}else if(!t||t.jquery){return(t||T).find(e)}else{return this.constructor(t).find(e)}}else if(e.nodeType){this.context=this[0]=e;this.length=1;return this}else if(f.isFunction(e)){return typeof T.ready!=="undefined"?T.ready(e):e(f)}if(e.selector!==undefined){this.selector=e.selector;this.context=e.context}return f.makeArray(e,this)};k.prototype=f.fn;T=f(d);var M=/^(?:parents|prev(?:Until|All))/,L={children:true,contents:true,next:true,prev:true};f.extend({dir:function(e,t,n){var i=[],r=n!==undefined;while((e=e[t])&&e.nodeType!==9){if(e.nodeType===1){if(r&&f(e).is(n)){break}i.push(e)}}return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){n.push(e)}}return n}});f.fn.extend({has:function(e){var t=f(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++){if(f.contains(this,t[e])){return true}}})},closest:function(e,t){var n,i=0,r=this.length,a=[],o=w.test(e)||typeof e!=="string"?f(e,t||this.context):0;for(;i<r;i++){for(n=this[i];n&&n!==t;n=n.parentNode){if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&f.find.matchesSelector(n,e))){a.push(n);break}}}return this.pushStack(a.length>1?f.unique(a):a)},index:function(e){if(!e){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof e==="string"){return o.call(f(e),this[0])}return o.call(this,e.jquery?e[0]:e)},add:function(e,t){return this.pushStack(f.unique(f.merge(this.get(),f(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}});function B(e,t){while((e=e[t])&&e.nodeType!==1){}return e}f.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return f.dir(e,"parentNode")},parentsUntil:function(e,t,n){return f.dir(e,"parentNode",n)},next:function(e){return B(e,"nextSibling")},prev:function(e){return B(e,"previousSibling")},nextAll:function(e){return f.dir(e,"nextSibling")},prevAll:function(e){return f.dir(e,"previousSibling")},nextUntil:function(e,t,n){return f.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return f.dir(e,"previousSibling",n)},siblings:function(e){return f.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return f.sibling(e.firstChild)},contents:function(e){return e.contentDocument||f.merge([],e.childNodes)}},function(e,t){f.fn[e]=function(n,i){var r=f.map(this,t,n);if(e.slice(-5)!=="Until"){i=n}if(i&&typeof i==="string"){r=f.filter(i,r)}if(this.length>1){if(!L[e]){f.unique(r)}if(M.test(e)){r.reverse()}}return this.pushStack(r)}});var E=/\S+/g;var D={};function V(e){var t=D[e]={};f.each(e.match(E)||[],function(e,n){t[n]=true});return t}f.Callbacks=function(e){e=typeof e==="string"?D[e]||V(e):f.extend({},e);var t,n,i,r,a,o,s=[],l=!e.once&&[],u=function(d){t=e.memory&&d;n=true;o=r||0;r=0;a=s.length;i=true;for(;s&&o<a;o++){if(s[o].apply(d[0],d[1])===false&&e.stopOnFalse){t=false;break}}i=false;if(s){if(l){if(l.length){u(l.shift())}}else if(t){s=[]}else{c.disable()}}},c={add:function(){if(s){var n=s.length;(function o(t){f.each(t,function(t,n){var i=f.type(n);if(i==="function"){if(!e.unique||!c.has(n)){s.push(n)}}else if(n&&n.length&&i!=="string"){o(n)}})})(arguments);if(i){a=s.length}else if(t){r=n;u(t)}}return this},remove:function(){if(s){f.each(arguments,function(e,t){var n;while((n=f.inArray(t,s,n))>-1){s.splice(n,1);if(i){if(n<=a){a--}if(n<=o){o--}}}})}return this},has:function(e){return e?f.inArray(e,s)>-1:!!(s&&s.length)},empty:function(){s=[];a=0;return this},disable:function(){s=l=t=undefined;return this},disabled:function(){return!s},lock:function(){l=undefined;if(!t){c.disable()}return this},locked:function(){return!l},fireWith:function(e,t){if(s&&(!n||l)){t=t||[];t=[e,t.slice?t.slice():t];if(i){l.push(t)}else{u(t)}}return this},fire:function(){c.fireWith(this,arguments);return this},fired:function(){return!!n}};return c};f.extend({Deferred:function(e){var t=[["resolve","done",f.Callbacks("once memory"),"resolved"],["reject","fail",f.Callbacks("once memory"),"rejected"],["notify","progress",f.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){r.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return f.Deferred(function(n){f.each(t,function(t,a){var o=f.isFunction(e[t])&&e[t];r[a[1]](function(){var e=o&&o.apply(this,arguments);if(e&&f.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{n[a[0]+"With"](this===i?n.promise():this,o?[e]:arguments)}})});e=null}).promise()},promise:function(e){return e!=null?f.extend(e,i):i}},r={};i.pipe=i.then;f.each(t,function(e,a){var o=a[2],s=a[3];i[a[1]]=o.add;if(s){o.add(function(){n=s},t[e^1][2].disable,t[2][2].lock)}r[a[0]]=function(){r[a[0]+"With"](this===r?i:this,arguments);return this};r[a[0]+"With"]=o.fireWith});i.promise(r);if(e){e.call(r,r)}return r},when:function(e){var t=0,n=i.call(arguments),r=n.length,a=r!==1||e&&f.isFunction(e.promise)?r:0,o=a===1?e:f.Deferred(),s=function(e,t,n){return function(r){t[e]=this;n[e]=arguments.length>1?i.call(arguments):r;if(n===l){o.notifyWith(t,n)}else if(!--a){o.resolveWith(t,n)}}},l,u,c;if(r>1){l=new Array(r);u=new Array(r);c=new Array(r);for(;t<r;t++){if(n[t]&&f.isFunction(n[t].promise)){n[t].promise().done(s(t,c,n)).fail(o.reject).progress(s(t,u,l))}else{--a}}}if(!a){o.resolveWith(c,n)}return o.promise()}});var I;f.fn.ready=function(e){f.ready.promise().done(e);return this};f.extend({isReady:false,readyWait:1,holdReady:function(e){if(e){f.readyWait++}else{f.ready(true)}},ready:function(e){if(e===true?--f.readyWait:f.isReady){return}f.isReady=true;if(e!==true&&--f.readyWait>0){return}I.resolveWith(d,[f]);if(f.fn.triggerHandler){f(d).triggerHandler("ready");f(d).off("ready")}}});function P(){d.removeEventListener("DOMContentLoaded",P,false);e.removeEventListener("load",P,false);f.ready()}f.ready.promise=function(t){if(!I){I=f.Deferred();if(d.readyState==="complete"){setTimeout(f.ready)}else{d.addEventListener("DOMContentLoaded",P,false);e.addEventListener("load",P,false)}}return I.promise(t)};f.ready.promise();var A=f.access=function(e,t,n,i,r,a,o){var s=0,l=e.length,u=n==null;if(f.type(n)==="object"){r=true;for(s in n){f.access(e,t,s,n[s],true,a,o)}}else if(i!==undefined){r=true;if(!f.isFunction(i)){o=true}if(u){if(o){t.call(e,i);t=null}else{u=t;t=function(e,t,n){return u.call(f(e),n)}}}if(t){for(;s<l;s++){t(e[s],n,o?i:i.call(e[s],s,t(e[s],n)))}}}return r?e:u?t.call(e):l?t(e[0],n):a};f.acceptData=function(e){return e.nodeType===1||e.nodeType===9||!+e.nodeType};function F(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=f.expando+Math.random()}F.uid=1;F.accepts=f.acceptData;F.prototype={key:function(e){if(!F.accepts(e)){return 0}var t={},n=e[this.expando];if(!n){n=F.uid++;try{t[this.expando]={value:n};Object.defineProperties(e,t)}catch(i){t[this.expando]=n;f.extend(e,t)}}if(!this.cache[n]){this.cache[n]={}}return n},set:function(e,t,n){var i,r=this.key(e),a=this.cache[r];if(typeof t==="string"){a[t]=n}else{if(f.isEmptyObject(a)){f.extend(this.cache[r],t)}else{for(i in t){a[i]=t[i]}}}return a},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var i;if(t===undefined||t&&typeof t==="string"&&n===undefined){i=this.get(e,t);return i!==undefined?i:this.get(e,f.camelCase(t))}this.set(e,t,n);return n!==undefined?n:t},remove:function(e,t){var n,i,r,a=this.key(e),o=this.cache[a];if(t===undefined){this.cache[a]={}}else{if(f.isArray(t)){i=t.concat(t.map(f.camelCase))}else{r=f.camelCase(t);if(t in o){i=[t,r]}else{i=r;i=i in o?[i]:i.match(E)||[]}}n=i.length;while(n--){delete o[i[n]]}}},hasData:function(e){return!f.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){if(e[this.expando]){delete this.cache[e[this.expando]]}}};var O=new F;var R=new F;var N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,H=/([A-Z])/g;function j(e,t,n){var i;if(n===undefined&&e.nodeType===1){i="data-"+t.replace(H,"-$1").toLowerCase();n=e.getAttribute(i);if(typeof n==="string"){try{n=n==="true"?true:n==="false"?false:n==="null"?null:+n+""===n?+n:N.test(n)?f.parseJSON(n):n}catch(r){}R.set(e,t,n)}else{n=undefined}}return n}f.extend({hasData:function(e){return R.hasData(e)||O.hasData(e)},data:function(e,t,n){return R.access(e,t,n)},removeData:function(e,t){R.remove(e,t)},_data:function(e,t,n){return O.access(e,t,n)},_removeData:function(e,t){O.remove(e,t)}});f.fn.extend({data:function(e,t){var n,i,r,a=this[0],o=a&&a.attributes;if(e===undefined){if(this.length){r=R.get(a);if(a.nodeType===1&&!O.get(a,"hasDataAttrs")){n=o.length;while(n--){if(o[n]){i=o[n].name;if(i.indexOf("data-")===0){i=f.camelCase(i.slice(5));j(a,i,r[i])}}}O.set(a,"hasDataAttrs",true)}}return r}if(typeof e==="object"){return this.each(function(){R.set(this,e)})}return A(this,function(t){var n,i=f.camelCase(e);if(a&&t===undefined){n=R.get(a,e);if(n!==undefined){return n}n=R.get(a,i);if(n!==undefined){return n}n=j(a,i,undefined);if(n!==undefined){return n}return}this.each(function(){var n=R.get(this,i);R.set(this,i,t);if(e.indexOf("-")!==-1&&n!==undefined){R.set(this,e,t)}})},null,t,arguments.length>1,null,true)},removeData:function(e){return this.each(function(){R.remove(this,e)})}});f.extend({queue:function(e,t,n){var i;if(e){t=(t||"fx")+"queue";i=O.get(e,t);if(n){if(!i||f.isArray(n)){i=O.access(e,t,f.makeArray(n))}else{i.push(n)}}return i||[]}},dequeue:function(e,t){t=t||"fx";var n=f.queue(e,t),i=n.length,r=n.shift(),a=f._queueHooks(e,t),o=function(){f.dequeue(e,t)};if(r==="inprogress"){r=n.shift();i--}if(r){if(t==="fx"){n.unshift("inprogress")}delete a.stop;r.call(e,o,a)}if(!i&&a){a.empty.fire()}},_queueHooks:function(e,t){var n=t+"queueHooks";return O.get(e,n)||O.access(e,n,{empty:f.Callbacks("once memory").add(function(){O.remove(e,[t+"queue",n])})})}});f.fn.extend({queue:function(e,t){var n=2;if(typeof e!=="string"){t=e;e="fx";n--}if(arguments.length<n){return f.queue(this[0],e)}return t===undefined?this:this.each(function(){var n=f.queue(this,e,t);f._queueHooks(this,e);if(e==="fx"&&n[0]!=="inprogress"){f.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){f.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,r=f.Deferred(),a=this,o=this.length,s=function(){if(!--i){r.resolveWith(a,[a])}};if(typeof e!=="string"){t=e;e=undefined}e=e||"fx";while(o--){n=O.get(a[o],e+"queueHooks");if(n&&n.empty){i++;n.empty.add(s)}}s();return r.promise(t)}});var U=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var G=["Top","Right","Bottom","Left"];var W=function(e,t){e=t||e;return f.css(e,"display")==="none"||!f.contains(e.ownerDocument,e)};var K=/^(?:checkbox|radio)$/i;(function(){var e=d.createDocumentFragment(),t=e.appendChild(d.createElement("div")),n=d.createElement("input");n.setAttribute("type","radio");n.setAttribute("checked","checked");n.setAttribute("name","t");t.appendChild(n);c.checkClone=t.cloneNode(true).cloneNode(true).lastChild.checked;t.innerHTML="<textarea>x</textarea>";c.noCloneChecked=!!t.cloneNode(true).lastChild.defaultValue})();var z=typeof undefined;c.focusinBubbles="onfocusin"in e;var Y=/^key/,q=/^(?:mouse|pointer|contextmenu)|click/,Q=/^(?:focusinfocus|focusoutblur)$/,J=/^([^.]*)(?:\.(.+)|)$/;function $(){return true}function X(){return false
}function Z(){try{return d.activeElement}catch(e){}}f.event={global:{},add:function(e,t,n,i,r){var a,o,s,l,u,c,d,h,p,m,_,g=O.get(e);if(!g){return}if(n.handler){a=n;n=a.handler;r=a.selector}if(!n.guid){n.guid=f.guid++}if(!(l=g.events)){l=g.events={}}if(!(o=g.handle)){o=g.handle=function(t){return typeof f!==z&&f.event.triggered!==t.type?f.event.dispatch.apply(e,arguments):undefined}}t=(t||"").match(E)||[""];u=t.length;while(u--){s=J.exec(t[u])||[];p=_=s[1];m=(s[2]||"").split(".").sort();if(!p){continue}d=f.event.special[p]||{};p=(r?d.delegateType:d.bindType)||p;d=f.event.special[p]||{};c=f.extend({type:p,origType:_,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&f.expr.match.needsContext.test(r),namespace:m.join(".")},a);if(!(h=l[p])){h=l[p]=[];h.delegateCount=0;if(!d.setup||d.setup.call(e,i,m,o)===false){if(e.addEventListener){e.addEventListener(p,o,false)}}}if(d.add){d.add.call(e,c);if(!c.handler.guid){c.handler.guid=n.guid}}if(r){h.splice(h.delegateCount++,0,c)}else{h.push(c)}f.event.global[p]=true}},remove:function(e,t,n,i,r){var a,o,s,l,u,c,d,h,p,m,_,g=O.hasData(e)&&O.get(e);if(!g||!(l=g.events)){return}t=(t||"").match(E)||[""];u=t.length;while(u--){s=J.exec(t[u])||[];p=_=s[1];m=(s[2]||"").split(".").sort();if(!p){for(p in l){f.event.remove(e,p+t[u],n,i,true)}continue}d=f.event.special[p]||{};p=(i?d.delegateType:d.bindType)||p;h=l[p]||[];s=s[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)");o=a=h.length;while(a--){c=h[a];if((r||_===c.origType)&&(!n||n.guid===c.guid)&&(!s||s.test(c.namespace))&&(!i||i===c.selector||i==="**"&&c.selector)){h.splice(a,1);if(c.selector){h.delegateCount--}if(d.remove){d.remove.call(e,c)}}}if(o&&!h.length){if(!d.teardown||d.teardown.call(e,m,g.handle)===false){f.removeEvent(e,p,g.handle)}delete l[p]}}if(f.isEmptyObject(l)){delete g.handle;O.remove(e,"events")}},trigger:function(t,n,i,r){var a,o,s,l,c,h,p,m=[i||d],_=u.call(t,"type")?t.type:t,g=u.call(t,"namespace")?t.namespace.split("."):[];o=s=i=i||d;if(i.nodeType===3||i.nodeType===8){return}if(Q.test(_+f.event.triggered)){return}if(_.indexOf(".")>=0){g=_.split(".");_=g.shift();g.sort()}c=_.indexOf(":")<0&&"on"+_;t=t[f.expando]?t:new f.Event(_,typeof t==="object"&&t);t.isTrigger=r?2:3;t.namespace=g.join(".");t.namespace_re=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;t.result=undefined;if(!t.target){t.target=i}n=n==null?[t]:f.makeArray(n,[t]);p=f.event.special[_]||{};if(!r&&p.trigger&&p.trigger.apply(i,n)===false){return}if(!r&&!p.noBubble&&!f.isWindow(i)){l=p.delegateType||_;if(!Q.test(l+_)){o=o.parentNode}for(;o;o=o.parentNode){m.push(o);s=o}if(s===(i.ownerDocument||d)){m.push(s.defaultView||s.parentWindow||e)}}a=0;while((o=m[a++])&&!t.isPropagationStopped()){t.type=a>1?l:p.bindType||_;h=(O.get(o,"events")||{})[t.type]&&O.get(o,"handle");if(h){h.apply(o,n)}h=c&&o[c];if(h&&h.apply&&f.acceptData(o)){t.result=h.apply(o,n);if(t.result===false){t.preventDefault()}}}t.type=_;if(!r&&!t.isDefaultPrevented()){if((!p._default||p._default.apply(m.pop(),n)===false)&&f.acceptData(i)){if(c&&f.isFunction(i[_])&&!f.isWindow(i)){s=i[c];if(s){i[c]=null}f.event.triggered=_;i[_]();f.event.triggered=undefined;if(s){i[c]=s}}}}return t.result},dispatch:function(e){e=f.event.fix(e);var t,n,r,a,o,s=[],l=i.call(arguments),u=(O.get(this,"events")||{})[e.type]||[],c=f.event.special[e.type]||{};l[0]=e;e.delegateTarget=this;if(c.preDispatch&&c.preDispatch.call(this,e)===false){return}s=f.event.handlers.call(this,e,u);t=0;while((a=s[t++])&&!e.isPropagationStopped()){e.currentTarget=a.elem;n=0;while((o=a.handlers[n++])&&!e.isImmediatePropagationStopped()){if(!e.namespace_re||e.namespace_re.test(o.namespace)){e.handleObj=o;e.data=o.data;r=((f.event.special[o.origType]||{}).handle||o.handler).apply(a.elem,l);if(r!==undefined){if((e.result=r)===false){e.preventDefault();e.stopPropagation()}}}}}if(c.postDispatch){c.postDispatch.call(this,e)}return e.result},handlers:function(e,t){var n,i,r,a,o=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||e.type!=="click")){for(;l!==this;l=l.parentNode||this){if(l.disabled!==true||e.type!=="click"){i=[];for(n=0;n<s;n++){a=t[n];r=a.selector+" ";if(i[r]===undefined){i[r]=a.needsContext?f(r,this).index(l)>=0:f.find(r,this,null,[l]).length}if(i[r]){i.push(a)}}if(i.length){o.push({elem:l,handlers:i})}}}}if(s<t.length){o.push({elem:this,handlers:t.slice(s)})}return o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){if(e.which==null){e.which=t.charCode!=null?t.charCode:t.keyCode}return e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,r,a=t.button;if(e.pageX==null&&t.clientX!=null){n=e.target.ownerDocument||d;i=n.documentElement;r=n.body;e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0);e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)}if(!e.which&&a!==undefined){e.which=a&1?1:a&2?3:a&4?2:0}return e}},fix:function(e){if(e[f.expando]){return e}var t,n,i,r=e.type,a=e,o=this.fixHooks[r];if(!o){this.fixHooks[r]=o=q.test(r)?this.mouseHooks:Y.test(r)?this.keyHooks:{}}i=o.props?this.props.concat(o.props):this.props;e=new f.Event(a);t=i.length;while(t--){n=i[t];e[n]=a[n]}if(!e.target){e.target=d}if(e.target.nodeType===3){e.target=e.target.parentNode}return o.filter?o.filter(e,a):e},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==Z()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===Z()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&f.nodeName(this,"input")){this.click();return false}},_default:function(e){return f.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){if(e.result!==undefined&&e.originalEvent){e.originalEvent.returnValue=e.result}}}},simulate:function(e,t,n,i){var r=f.extend(new f.Event,n,{type:e,isSimulated:true,originalEvent:{}});if(i){f.event.trigger(r,null,t)}else{f.event.dispatch.call(t,r)}if(r.isDefaultPrevented()){n.preventDefault()}}};f.removeEvent=function(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}};f.Event=function(e,t){if(!(this instanceof f.Event)){return new f.Event(e,t)}if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&e.returnValue===false?$:X}else{this.type=e}if(t){f.extend(this,t)}this.timeStamp=e&&e.timeStamp||f.now();this[f.expando]=true};f.Event.prototype={isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=$;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=$;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=$;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){f.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,a=e.handleObj;if(!r||r!==i&&!f.contains(i,r)){e.type=a.origType;n=a.handler.apply(this,arguments);e.type=t}return n}}});if(!c.focusinBubbles){f.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){f.event.simulate(t,e.target,f.event.fix(e),true)};f.event.special[t]={setup:function(){var i=this.ownerDocument||this,r=O.access(i,t);if(!r){i.addEventListener(e,n,true)}O.access(i,t,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this,r=O.access(i,t)-1;if(!r){i.removeEventListener(e,n,true);O.remove(i,t)}else{O.access(i,t,r)}}}})}f.fn.extend({on:function(e,t,n,i,r){var a,o;if(typeof e==="object"){if(typeof t!=="string"){n=n||t;t=undefined}for(o in e){this.on(o,t,n,e[o],r)}return this}if(n==null&&i==null){i=t;n=t=undefined}else if(i==null){if(typeof t==="string"){i=n;n=undefined}else{i=n;n=t;t=undefined}}if(i===false){i=X}else if(!i){return this}if(r===1){a=i;i=function(e){f().off(e);return a.apply(this,arguments)};i.guid=a.guid||(a.guid=f.guid++)}return this.each(function(){f.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,r;if(e&&e.preventDefault&&e.handleObj){i=e.handleObj;f(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);return this}if(typeof e==="object"){for(r in e){this.off(r,t,e[r])}return this}if(t===false||typeof t==="function"){n=t;t=undefined}if(n===false){n=X}return this.each(function(){f.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){f.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n){return f.event.trigger(e,t,n,true)}}});var et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,tt=/<([\w:]+)/,nt=/<|&#?\w+;/,it=/<(?:script|style|link)/i,rt=/checked\s*(?:[^=]|=\s*.checked.)/i,at=/^$|\/(?:java|ecma)script/i,ot=/^true\/(.*)/,st=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,lt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};lt.optgroup=lt.option;lt.tbody=lt.tfoot=lt.colgroup=lt.caption=lt.thead;lt.th=lt.td;function ut(e,t){return f.nodeName(e,"table")&&f.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ct(e){e.type=(e.getAttribute("type")!==null)+"/"+e.type;return e}function dt(e){var t=ot.exec(e.type);if(t){e.type=t[1]}else{e.removeAttribute("type")}return e}function ht(e,t){var n=0,i=e.length;for(;n<i;n++){O.set(e[n],"globalEval",!t||O.get(t[n],"globalEval"))}}function ft(e,t){var n,i,r,a,o,s,l,u;if(t.nodeType!==1){return}if(O.hasData(e)){a=O.access(e);o=O.set(t,a);u=a.events;if(u){delete o.handle;o.events={};for(r in u){for(n=0,i=u[r].length;n<i;n++){f.event.add(t,r,u[r][n])}}}}if(R.hasData(e)){s=R.access(e);l=f.extend({},s);R.set(t,l)}}function pt(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&f.nodeName(e,t)?f.merge([e],n):n}function mt(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&K.test(e.type)){t.checked=e.checked}else if(n==="input"||n==="textarea"){t.defaultValue=e.defaultValue}}f.extend({clone:function(e,t,n){var i,r,a,o,s=e.cloneNode(true),l=f.contains(e.ownerDocument,e);if(!c.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!f.isXMLDoc(e)){o=pt(s);a=pt(e);for(i=0,r=a.length;i<r;i++){mt(a[i],o[i])}}if(t){if(n){a=a||pt(e);o=o||pt(s);for(i=0,r=a.length;i<r;i++){ft(a[i],o[i])}}else{ft(e,s)}}o=pt(s,"script");if(o.length>0){ht(o,!l&&pt(e,"script"))}return s},buildFragment:function(e,t,n,i){var r,a,o,s,l,u,c=t.createDocumentFragment(),d=[],h=0,p=e.length;for(;h<p;h++){r=e[h];if(r||r===0){if(f.type(r)==="object"){f.merge(d,r.nodeType?[r]:r)}else if(!nt.test(r)){d.push(t.createTextNode(r))}else{a=a||c.appendChild(t.createElement("div"));o=(tt.exec(r)||["",""])[1].toLowerCase();s=lt[o]||lt._default;a.innerHTML=s[1]+r.replace(et,"<$1></$2>")+s[2];u=s[0];while(u--){a=a.lastChild}f.merge(d,a.childNodes);a=c.firstChild;a.textContent=""}}}c.textContent="";h=0;while(r=d[h++]){if(i&&f.inArray(r,i)!==-1){continue}l=f.contains(r.ownerDocument,r);a=pt(c.appendChild(r),"script");if(l){ht(a)}if(n){u=0;while(r=a[u++]){if(at.test(r.type||"")){n.push(r)}}}}return c},cleanData:function(e){var t,n,i,r,a=f.event.special,o=0;for(;(n=e[o])!==undefined;o++){if(f.acceptData(n)){r=n[O.expando];if(r&&(t=O.cache[r])){if(t.events){for(i in t.events){if(a[i]){f.event.remove(n,i)}else{f.removeEvent(n,i,t.handle)}}}if(O.cache[r]){delete O.cache[r]}}}delete R.cache[n[R.expando]]}}});f.fn.extend({text:function(e){return A(this,function(e){return e===undefined?f.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=e}})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=ut(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=ut(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){if(this.parentNode){this.parentNode.insertBefore(e,this)}})},after:function(){return this.domManip(arguments,function(e){if(this.parentNode){this.parentNode.insertBefore(e,this.nextSibling)}})},remove:function(e,t){var n,i=e?f.filter(e,this):this,r=0;for(;(n=i[r])!=null;r++){if(!t&&n.nodeType===1){f.cleanData(pt(n))}if(n.parentNode){if(t&&f.contains(n.ownerDocument,n)){ht(pt(n,"script"))}n.parentNode.removeChild(n)}}return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){if(e.nodeType===1){f.cleanData(pt(e,false));e.textContent=""}}return this},clone:function(e,t){e=e==null?false:e;t=t==null?e:t;return this.map(function(){return f.clone(this,e,t)})},html:function(e){return A(this,function(e){var t=this[0]||{},n=0,i=this.length;if(e===undefined&&t.nodeType===1){return t.innerHTML}if(typeof e==="string"&&!it.test(e)&&!lt[(tt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(et,"<$1></$2>");try{for(;n<i;n++){t=this[n]||{};if(t.nodeType===1){f.cleanData(pt(t,false));t.innerHTML=e}}t=0}catch(r){}}if(t){this.empty().append(e)}},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];this.domManip(arguments,function(t){e=this.parentNode;f.cleanData(pt(this));if(e){e.replaceChild(t,this)}});return e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,true)},domManip:function(e,t){e=r.apply([],e);var n,i,a,o,s,l,u=0,d=this.length,h=this,p=d-1,m=e[0],_=f.isFunction(m);if(_||d>1&&typeof m==="string"&&!c.checkClone&&rt.test(m)){return this.each(function(n){var i=h.eq(n);if(_){e[0]=m.call(this,n,i.html())}i.domManip(e,t)})}if(d){n=f.buildFragment(e,this[0].ownerDocument,false,this);i=n.firstChild;if(n.childNodes.length===1){n=i}if(i){a=f.map(pt(n,"script"),ct);o=a.length;for(;u<d;u++){s=n;if(u!==p){s=f.clone(s,true,true);if(o){f.merge(a,pt(s,"script"))}}t.call(this[u],s,u)}if(o){l=a[a.length-1].ownerDocument;f.map(a,dt);for(u=0;u<o;u++){s=a[u];if(at.test(s.type||"")&&!O.access(s,"globalEval")&&f.contains(l,s)){if(s.src){if(f._evalUrl){f._evalUrl(s.src)}}else{f.globalEval(s.textContent.replace(st,""))}}}}}}return this}});f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){f.fn[e]=function(e){var n,i=[],r=f(e),o=r.length-1,s=0;for(;s<=o;s++){n=s===o?this:this.clone(true);f(r[s])[t](n);a.apply(i,n.get())}return this.pushStack(i)}});var _t,gt={};function vt(t,n){var i,r=f(n.createElement(t)).appendTo(n.body),a=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(r[0]))?i.display:f.css(r[0],"display");r.detach();return a}function yt(e){var t=d,n=gt[e];if(!n){n=vt(e,t);if(n==="none"||!n){_t=(_t||f("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement);t=_t[0].contentDocument;t.write();t.close();n=vt(e,t);_t.detach()}gt[e]=n}return n}var wt=/^margin/;var bt=new RegExp("^("+U+")(?!px)[a-z%]+$","i");var Ct=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};function St(e,t,n){var i,r,a,o,s=e.style;n=n||Ct(e);if(n){o=n.getPropertyValue(t)||n[t]}if(n){if(o===""&&!f.contains(e.ownerDocument,e)){o=f.style(e,t)}if(bt.test(o)&&wt.test(t)){i=s.width;r=s.minWidth;a=s.maxWidth;s.minWidth=s.maxWidth=s.width=o;o=n.width;s.width=i;s.minWidth=r;s.maxWidth=a}}return o!==undefined?o+"":o}function Tt(e,t){return{get:function(){if(e()){delete this.get;return}return(this.get=t).apply(this,arguments)}}}(function(){var t,n,i=d.documentElement,r=d.createElement("div"),a=d.createElement("div");if(!a.style){return}a.style.backgroundClip="content-box";a.cloneNode(true).style.backgroundClip="";c.clearCloneStyle=a.style.backgroundClip==="content-box";r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;"+"position:absolute";r.appendChild(a);function o(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";a.innerHTML="";i.appendChild(r);var o=e.getComputedStyle(a,null);t=o.top!=="1%";n=o.width==="4px";i.removeChild(r)}if(e.getComputedStyle){f.extend(c,{pixelPosition:function(){o();return t},boxSizingReliable:function(){if(n==null){o()}return n},reliableMarginRight:function(){var t,n=a.appendChild(d.createElement("div"));n.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";n.style.marginRight=n.style.width="0";a.style.width="1px";i.appendChild(r);t=!parseFloat(e.getComputedStyle(n,null).marginRight);i.removeChild(r);return t}})}})();f.swap=function(e,t,n,i){var r,a,o={};for(a in t){o[a]=e.style[a];e.style[a]=t[a]}r=n.apply(e,i||[]);for(a in t){e.style[a]=o[a]}return r};var xt=/^(none|table(?!-c[ea]).+)/,kt=new RegExp("^("+U+")(.*)$","i"),Mt=new RegExp("^([+-])=("+U+")","i"),Lt={position:"absolute",visibility:"hidden",display:"block"},Bt={letterSpacing:"0",fontWeight:"400"},Et=["Webkit","O","Moz","ms"];function Dt(e,t){if(t in e){return t}var n=t[0].toUpperCase()+t.slice(1),i=t,r=Et.length;while(r--){t=Et[r]+n;if(t in e){return t}}return i}function Vt(e,t,n){var i=kt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function It(e,t,n,i,r){var a=n===(i?"border":"content")?4:t==="width"?1:0,o=0;for(;a<4;a+=2){if(n==="margin"){o+=f.css(e,n+G[a],true,r)}if(i){if(n==="content"){o-=f.css(e,"padding"+G[a],true,r)}if(n!=="margin"){o-=f.css(e,"border"+G[a]+"Width",true,r)}}else{o+=f.css(e,"padding"+G[a],true,r);if(n!=="padding"){o+=f.css(e,"border"+G[a]+"Width",true,r)}}}return o}function Pt(e,t,n){var i=true,r=t==="width"?e.offsetWidth:e.offsetHeight,a=Ct(e),o=f.css(e,"boxSizing",false,a)==="border-box";if(r<=0||r==null){r=St(e,t,a);if(r<0||r==null){r=e.style[t]}if(bt.test(r)){return r}i=o&&(c.boxSizingReliable()||r===e.style[t]);r=parseFloat(r)||0}return r+It(e,t,n||(o?"border":"content"),i,a)+"px"}function At(e,t){var n,i,r,a=[],o=0,s=e.length;for(;o<s;o++){i=e[o];if(!i.style){continue}a[o]=O.get(i,"olddisplay");n=i.style.display;if(t){if(!a[o]&&n==="none"){i.style.display=""}if(i.style.display===""&&W(i)){a[o]=O.access(i,"olddisplay",yt(i.nodeName))}}else{r=W(i);if(n!=="none"||!r){O.set(i,"olddisplay",r?n:f.css(i,"display"))}}}for(o=0;o<s;o++){i=e[o];if(!i.style){continue}if(!t||i.style.display==="none"||i.style.display===""){i.style.display=t?a[o]||"":"none"}}return e}f.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=St(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(e,t,n,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var r,a,o,s=f.camelCase(t),l=e.style;t=f.cssProps[s]||(f.cssProps[s]=Dt(l,s));o=f.cssHooks[t]||f.cssHooks[s];if(n!==undefined){a=typeof n;if(a==="string"&&(r=Mt.exec(n))){n=(r[1]+1)*r[2]+parseFloat(f.css(e,t));a="number"}if(n==null||n!==n){return}if(a==="number"&&!f.cssNumber[s]){n+="px"}if(!c.clearCloneStyle&&n===""&&t.indexOf("background")===0){l[t]="inherit"}if(!o||!("set"in o)||(n=o.set(e,n,i))!==undefined){l[t]=n}}else{if(o&&"get"in o&&(r=o.get(e,false,i))!==undefined){return r}return l[t]}},css:function(e,t,n,i){var r,a,o,s=f.camelCase(t);t=f.cssProps[s]||(f.cssProps[s]=Dt(e.style,s));o=f.cssHooks[t]||f.cssHooks[s];if(o&&"get"in o){r=o.get(e,true,n)}if(r===undefined){r=St(e,t,i)}if(r==="normal"&&t in Bt){r=Bt[t]}if(n===""||n){a=parseFloat(r);return n===true||f.isNumeric(a)?a||0:r}return r}});f.each(["height","width"],function(e,t){f.cssHooks[t]={get:function(e,n,i){if(n){return xt.test(f.css(e,"display"))&&e.offsetWidth===0?f.swap(e,Lt,function(){return Pt(e,t,i)}):Pt(e,t,i)}},set:function(e,n,i){var r=i&&Ct(e);return Vt(e,n,i?It(e,t,i,f.css(e,"boxSizing",false,r)==="border-box",r):0)}}});f.cssHooks.marginRight=Tt(c.reliableMarginRight,function(e,t){if(t){return f.swap(e,{display:"inline-block"},St,[e,"marginRight"])}});f.each({margin:"",padding:"",border:"Width"},function(e,t){f.cssHooks[e+t]={expand:function(n){var i=0,r={},a=typeof n==="string"?n.split(" "):[n];for(;i<4;i++){r[e+G[i]+t]=a[i]||a[i-2]||a[0]}return r}};if(!wt.test(e)){f.cssHooks[e+t].set=Vt}});f.fn.extend({css:function(e,t){return A(this,function(e,t,n){var i,r,a={},o=0;if(f.isArray(t)){i=Ct(e);r=t.length;for(;o<r;o++){a[t[o]]=f.css(e,t[o],false,i)}return a}return n!==undefined?f.style(e,t,n):f.css(e,t)},e,t,arguments.length>1)},show:function(){return At(this,true)},hide:function(){return At(this)},toggle:function(e){if(typeof e==="boolean"){return e?this.show():this.hide()}return this.each(function(){if(W(this)){f(this).show()}else{f(this).hide()}})}});function Ft(e,t,n,i,r){return new Ft.prototype.init(e,t,n,i,r)}f.Tween=Ft;Ft.prototype={constructor:Ft,init:function(e,t,n,i,r,a){this.elem=e;this.prop=n;this.easing=r||"swing";this.options=t;this.start=this.now=this.cur();this.end=i;this.unit=a||(f.cssNumber[n]?"":"px")},cur:function(){var e=Ft.propHooks[this.prop];return e&&e.get?e.get(this):Ft.propHooks._default.get(this)},run:function(e){var t,n=Ft.propHooks[this.prop];if(this.options.duration){this.pos=t=f.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration)}else{this.pos=t=e}this.now=(this.end-this.start)*t+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(n&&n.set){n.set(this)}else{Ft.propHooks._default.set(this)}return this}};Ft.prototype.init.prototype=Ft.prototype;Ft.propHooks={_default:{get:function(e){var t;if(e.elem[e.prop]!=null&&(!e.elem.style||e.elem.style[e.prop]==null)){return e.elem[e.prop]}t=f.css(e.elem,e.prop,"");return!t||t==="auto"?0:t},set:function(e){if(f.fx.step[e.prop]){f.fx.step[e.prop](e)}else if(e.elem.style&&(e.elem.style[f.cssProps[e.prop]]!=null||f.cssHooks[e.prop])){f.style(e.elem,e.prop,e.now+e.unit)}else{e.elem[e.prop]=e.now}}}};Ft.propHooks.scrollTop=Ft.propHooks.scrollLeft={set:function(e){if(e.elem.nodeType&&e.elem.parentNode){e.elem[e.prop]=e.now}}};f.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};f.fx=Ft.prototype.init;f.fx.step={};var Ot,Rt,Nt=/^(?:toggle|show|hide)$/,Ht=new RegExp("^(?:([+-])=|)("+U+")([a-z%]*)$","i"),jt=/queueHooks$/,Ut=[Yt],Gt={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),r=Ht.exec(t),a=r&&r[3]||(f.cssNumber[e]?"":"px"),o=(f.cssNumber[e]||a!=="px"&&+i)&&Ht.exec(f.css(n.elem,e)),s=1,l=20;if(o&&o[3]!==a){a=a||o[3];r=r||[];o=+i||1;do{s=s||".5";o=o/s;f.style(n.elem,e,o+a)}while(s!==(s=n.cur()/i)&&s!==1&&--l)}if(r){o=n.start=+o||+i||0;n.unit=a;n.end=r[1]?o+(r[1]+1)*r[2]:+r[2]}return n}]};function Wt(){setTimeout(function(){Ot=undefined});return Ot=f.now()}function Kt(e,t){var n,i=0,r={height:e};t=t?1:0;for(;i<4;i+=2-t){n=G[i];r["margin"+n]=r["padding"+n]=e}if(t){r.opacity=r.width=e}return r}function zt(e,t,n){var i,r=(Gt[t]||[]).concat(Gt["*"]),a=0,o=r.length;for(;a<o;a++){if(i=r[a].call(n,t,e)){return i}}}function Yt(e,t,n){var i,r,a,o,s,l,u,c,d=this,h={},p=e.style,m=e.nodeType&&W(e),_=O.get(e,"fxshow");if(!n.queue){s=f._queueHooks(e,"fx");if(s.unqueued==null){s.unqueued=0;l=s.empty.fire;s.empty.fire=function(){if(!s.unqueued){l()}}}s.unqueued++;d.always(function(){d.always(function(){s.unqueued--;if(!f.queue(e,"fx").length){s.empty.fire()}})})}if(e.nodeType===1&&("height"in t||"width"in t)){n.overflow=[p.overflow,p.overflowX,p.overflowY];u=f.css(e,"display");c=u==="none"?O.get(e,"olddisplay")||yt(e.nodeName):u;if(c==="inline"&&f.css(e,"float")==="none"){p.display="inline-block"}}if(n.overflow){p.overflow="hidden";d.always(function(){p.overflow=n.overflow[0];p.overflowX=n.overflow[1];p.overflowY=n.overflow[2]})}for(i in t){r=t[i];if(Nt.exec(r)){delete t[i];a=a||r==="toggle";if(r===(m?"hide":"show")){if(r==="show"&&_&&_[i]!==undefined){m=true}else{continue}}h[i]=_&&_[i]||f.style(e,i)}else{u=undefined}}if(!f.isEmptyObject(h)){if(_){if("hidden"in _){m=_.hidden}}else{_=O.access(e,"fxshow",{})}if(a){_.hidden=!m}if(m){f(e).show()}else{d.done(function(){f(e).hide()})}d.done(function(){var t;O.remove(e,"fxshow");for(t in h){f.style(e,t,h[t])}});for(i in h){o=zt(m?_[i]:0,i,d);if(!(i in _)){_[i]=o.start;if(m){o.end=o.start;o.start=i==="width"||i==="height"?1:0}}}}else if((u==="none"?yt(e.nodeName):u)==="inline"){p.display=u}}function qt(e,t){var n,i,r,a,o;for(n in e){i=f.camelCase(n);r=t[i];a=e[n];if(f.isArray(a)){r=a[1];a=e[n]=a[0]}if(n!==i){e[i]=a;delete e[n]}o=f.cssHooks[i];if(o&&"expand"in o){a=o.expand(a);delete e[i];for(n in a){if(!(n in e)){e[n]=a[n];t[n]=r}}}else{t[i]=r}}}function Qt(e,t,n){var i,r,a=0,o=Ut.length,s=f.Deferred().always(function(){delete l.elem}),l=function(){if(r){return false}var t=Ot||Wt(),n=Math.max(0,u.startTime+u.duration-t),i=n/u.duration||0,a=1-i,o=0,l=u.tweens.length;for(;o<l;o++){u.tweens[o].run(a)}s.notifyWith(e,[u,a,n]);if(a<1&&l){return n}else{s.resolveWith(e,[u]);return false}},u=s.promise({elem:e,props:f.extend({},t),opts:f.extend(true,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Ot||Wt(),duration:n.duration,tweens:[],createTween:function(t,n){var i=f.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);u.tweens.push(i);return i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(r){return this}r=true;for(;n<i;n++){u.tweens[n].run(1)}if(t){s.resolveWith(e,[u,t])}else{s.rejectWith(e,[u,t])}return this}}),c=u.props;qt(c,u.opts.specialEasing);for(;a<o;a++){i=Ut[a].call(u,e,c,u.opts);if(i){return i}}f.map(c,zt,u);if(f.isFunction(u.opts.start)){u.opts.start.call(e,u)}f.fx.timer(f.extend(l,{elem:e,anim:u,queue:u.opts.queue}));return u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}f.Animation=f.extend(Qt,{tweener:function(e,t){if(f.isFunction(e)){t=e;e=["*"]}else{e=e.split(" ")}var n,i=0,r=e.length;for(;i<r;i++){n=e[i];Gt[n]=Gt[n]||[];Gt[n].unshift(t)}},prefilter:function(e,t){if(t){Ut.unshift(e)}else{Ut.push(e)}}});f.speed=function(e,t,n){var i=e&&typeof e==="object"?f.extend({},e):{complete:n||!n&&t||f.isFunction(e)&&e,duration:e,easing:n&&t||t&&!f.isFunction(t)&&t};i.duration=f.fx.off?0:typeof i.duration==="number"?i.duration:i.duration in f.fx.speeds?f.fx.speeds[i.duration]:f.fx.speeds._default;if(i.queue==null||i.queue===true){i.queue="fx"}i.old=i.complete;i.complete=function(){if(f.isFunction(i.old)){i.old.call(this)}if(i.queue){f.dequeue(this,i.queue)}};return i};f.fn.extend({fadeTo:function(e,t,n,i){return this.filter(W).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=f.isEmptyObject(e),a=f.speed(t,n,i),o=function(){var t=Qt(this,f.extend({},e),a);if(r||O.get(this,"finish")){t.stop(true)}};o.finish=o;return r||a.queue===false?this.each(o):this.queue(a.queue,o)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop;t(n)};if(typeof e!=="string"){n=t;t=e;e=undefined}if(t&&e!==false){this.queue(e||"fx",[])}return this.each(function(){var t=true,r=e!=null&&e+"queueHooks",a=f.timers,o=O.get(this);if(r){if(o[r]&&o[r].stop){i(o[r])}}else{for(r in o){if(o[r]&&o[r].stop&&jt.test(r)){i(o[r])}}}for(r=a.length;r--;){if(a[r].elem===this&&(e==null||a[r].queue===e)){a[r].anim.stop(n);t=false;a.splice(r,1)}}if(t||!n){f.dequeue(this,e)}})},finish:function(e){if(e!==false){e=e||"fx"}return this.each(function(){var t,n=O.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],a=f.timers,o=i?i.length:0;n.finish=true;f.queue(this,e,[]);if(r&&r.stop){r.stop.call(this,true)}for(t=a.length;t--;){if(a[t].elem===this&&a[t].queue===e){a[t].anim.stop(true);a.splice(t,1)}}for(t=0;t<o;t++){if(i[t]&&i[t].finish){i[t].finish.call(this)}}delete n.finish})}});f.each(["toggle","show","hide"],function(e,t){var n=f.fn[t];f.fn[t]=function(e,i,r){return e==null||typeof e==="boolean"?n.apply(this,arguments):this.animate(Kt(t,true),e,i,r)}});f.each({slideDown:Kt("show"),slideUp:Kt("hide"),slideToggle:Kt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){f.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}});f.timers=[];f.fx.tick=function(){var e,t=0,n=f.timers;Ot=f.now();for(;t<n.length;t++){e=n[t];if(!e()&&n[t]===e){n.splice(t--,1)}}if(!n.length){f.fx.stop()}Ot=undefined};f.fx.timer=function(e){f.timers.push(e);if(e()){f.fx.start()}else{f.timers.pop()}};f.fx.interval=13;f.fx.start=function(){if(!Rt){Rt=setInterval(f.fx.tick,f.fx.interval)}};f.fx.stop=function(){clearInterval(Rt);Rt=null};f.fx.speeds={slow:600,fast:200,_default:400};f.fn.delay=function(e,t){e=f.fx?f.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})};(function(){var e=d.createElement("input"),t=d.createElement("select"),n=t.appendChild(d.createElement("option"));e.type="checkbox";c.checkOn=e.value!=="";c.optSelected=n.selected;t.disabled=true;c.optDisabled=!n.disabled;e=d.createElement("input");e.value="t";e.type="radio";c.radioValue=e.value==="t"})();var Jt,$t,Xt=f.expr.attrHandle;f.fn.extend({attr:function(e,t){return A(this,f.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){f.removeAttr(this,e)})}});f.extend({attr:function(e,t,n){var i,r,a=e.nodeType;if(!e||a===3||a===8||a===2){return}if(typeof e.getAttribute===z){return f.prop(e,t,n)}if(a!==1||!f.isXMLDoc(e)){t=t.toLowerCase();i=f.attrHooks[t]||(f.expr.match.bool.test(t)?$t:Jt)}if(n!==undefined){if(n===null){f.removeAttr(e,t)}else if(i&&"set"in i&&(r=i.set(e,n,t))!==undefined){return r}else{e.setAttribute(t,n+"");return n}}else if(i&&"get"in i&&(r=i.get(e,t))!==null){return r}else{r=f.find.attr(e,t);return r==null?undefined:r}},removeAttr:function(e,t){var n,i,r=0,a=t&&t.match(E);if(a&&e.nodeType===1){while(n=a[r++]){i=f.propFix[n]||n;if(f.expr.match.bool.test(n)){e[i]=false}e.removeAttribute(n)}}},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&t==="radio"&&f.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);if(n){e.value=n}return t}}}}});$t={set:function(e,t,n){if(t===false){f.removeAttr(e,n)}else{e.setAttribute(n,n)}return n}};f.each(f.expr.match.bool.source.match(/\w+/g),function(e,t){var n=Xt[t]||f.find.attr;Xt[t]=function(e,t,i){var r,a;if(!i){a=Xt[t];Xt[t]=r;r=n(e,t,i)!=null?t.toLowerCase():null;Xt[t]=a}return r}});var Zt=/^(?:input|select|textarea|button)$/i;f.fn.extend({prop:function(e,t){return A(this,f.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[f.propFix[e]||e]})}});f.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,r,a,o=e.nodeType;if(!e||o===3||o===8||o===2){return}a=o!==1||!f.isXMLDoc(e);if(a){t=f.propFix[t]||t;r=f.propHooks[t]}if(n!==undefined){return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:e[t]=n}else{return r&&"get"in r&&(i=r.get(e,t))!==null?i:e[t]}},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||Zt.test(e.nodeName)||e.href?e.tabIndex:-1}}}});if(!c.optSelected){f.propHooks.selected={get:function(e){var t=e.parentNode;if(t&&t.parentNode){t.parentNode.selectedIndex}return null}}}f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this
});var en=/[\t\r\n\f]/g;f.fn.extend({addClass:function(e){var t,n,i,r,a,o,s=typeof e==="string"&&e,l=0,u=this.length;if(f.isFunction(e)){return this.each(function(t){f(this).addClass(e.call(this,t,this.className))})}if(s){t=(e||"").match(E)||[];for(;l<u;l++){n=this[l];i=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(en," "):" ");if(i){a=0;while(r=t[a++]){if(i.indexOf(" "+r+" ")<0){i+=r+" "}}o=f.trim(i);if(n.className!==o){n.className=o}}}}return this},removeClass:function(e){var t,n,i,r,a,o,s=arguments.length===0||typeof e==="string"&&e,l=0,u=this.length;if(f.isFunction(e)){return this.each(function(t){f(this).removeClass(e.call(this,t,this.className))})}if(s){t=(e||"").match(E)||[];for(;l<u;l++){n=this[l];i=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(en," "):"");if(i){a=0;while(r=t[a++]){while(i.indexOf(" "+r+" ")>=0){i=i.replace(" "+r+" "," ")}}o=e?f.trim(i):"";if(n.className!==o){n.className=o}}}}return this},toggleClass:function(e,t){var n=typeof e;if(typeof t==="boolean"&&n==="string"){return t?this.addClass(e):this.removeClass(e)}if(f.isFunction(e)){return this.each(function(n){f(this).toggleClass(e.call(this,n,this.className,t),t)})}return this.each(function(){if(n==="string"){var t,i=0,r=f(this),a=e.match(E)||[];while(t=a[i++]){if(r.hasClass(t)){r.removeClass(t)}else{r.addClass(t)}}}else if(n===z||n==="boolean"){if(this.className){O.set(this,"__className__",this.className)}this.className=this.className||e===false?"":O.get(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",n=0,i=this.length;for(;n<i;n++){if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(en," ").indexOf(t)>=0){return true}}return false}});var tn=/\r/g;f.fn.extend({val:function(e){var t,n,i,r=this[0];if(!arguments.length){if(r){t=f.valHooks[r.type]||f.valHooks[r.nodeName.toLowerCase()];if(t&&"get"in t&&(n=t.get(r,"value"))!==undefined){return n}n=r.value;return typeof n==="string"?n.replace(tn,""):n==null?"":n}return}i=f.isFunction(e);return this.each(function(n){var r;if(this.nodeType!==1){return}if(i){r=e.call(this,n,f(this).val())}else{r=e}if(r==null){r=""}else if(typeof r==="number"){r+=""}else if(f.isArray(r)){r=f.map(r,function(e){return e==null?"":e+""})}t=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,r,"value")===undefined){this.value=r}})}});f.extend({valHooks:{option:{get:function(e){var t=f.find.attr(e,"value");return t!=null?t:f.trim(f.text(e))}},select:{get:function(e){var t,n,i=e.options,r=e.selectedIndex,a=e.type==="select-one"||r<0,o=a?null:[],s=a?r+1:i.length,l=r<0?s:a?r:0;for(;l<s;l++){n=i[l];if((n.selected||l===r)&&(c.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!f.nodeName(n.parentNode,"optgroup"))){t=f(n).val();if(a){return t}o.push(t)}}return o},set:function(e,t){var n,i,r=e.options,a=f.makeArray(t),o=r.length;while(o--){i=r[o];if(i.selected=f.inArray(i.value,a)>=0){n=true}}if(!n){e.selectedIndex=-1}return a}}}});f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(e,t){if(f.isArray(t)){return e.checked=f.inArray(f(e).val(),t)>=0}}};if(!c.checkOn){f.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value}}});f.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(e,t){f.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});f.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var nn=f.now();var rn=/\?/;f.parseJSON=function(e){return JSON.parse(e+"")};f.parseXML=function(e){var t,n;if(!e||typeof e!=="string"){return null}try{n=new DOMParser;t=n.parseFromString(e,"text/xml")}catch(i){t=undefined}if(!t||t.getElementsByTagName("parsererror").length){f.error("Invalid XML: "+e)}return t};var an,on,sn=/#.*$/,ln=/([?&])_=[^&]*/,un=/^(.*?):[ \t]*([^\r\n]*)$/gm,cn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,dn=/^(?:GET|HEAD)$/,hn=/^\/\//,fn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,pn={},mn={},_n="*/".concat("*");try{on=location.href}catch(gn){on=d.createElement("a");on.href="";on=on.href}an=fn.exec(on.toLowerCase())||[];function vn(e){return function(t,n){if(typeof t!=="string"){n=t;t="*"}var i,r=0,a=t.toLowerCase().match(E)||[];if(f.isFunction(n)){while(i=a[r++]){if(i[0]==="+"){i=i.slice(1)||"*";(e[i]=e[i]||[]).unshift(n)}else{(e[i]=e[i]||[]).push(n)}}}}}function yn(e,t,n,i){var r={},a=e===mn;function o(s){var l;r[s]=true;f.each(e[s]||[],function(e,s){var u=s(t,n,i);if(typeof u==="string"&&!a&&!r[u]){t.dataTypes.unshift(u);o(u);return false}else if(a){return!(l=u)}});return l}return o(t.dataTypes[0])||!r["*"]&&o("*")}function wn(e,t){var n,i,r=f.ajaxSettings.flatOptions||{};for(n in t){if(t[n]!==undefined){(r[n]?e:i||(i={}))[n]=t[n]}}if(i){f.extend(true,e,i)}return e}function bn(e,t,n){var i,r,a,o,s=e.contents,l=e.dataTypes;while(l[0]==="*"){l.shift();if(i===undefined){i=e.mimeType||t.getResponseHeader("Content-Type")}}if(i){for(r in s){if(s[r]&&s[r].test(i)){l.unshift(r);break}}}if(l[0]in n){a=l[0]}else{for(r in n){if(!l[0]||e.converters[r+" "+l[0]]){a=r;break}if(!o){o=r}}a=a||o}if(a){if(a!==l[0]){l.unshift(a)}return n[a]}}function Cn(e,t,n,i){var r,a,o,s,l,u={},c=e.dataTypes.slice();if(c[1]){for(o in e.converters){u[o.toLowerCase()]=e.converters[o]}}a=c.shift();while(a){if(e.responseFields[a]){n[e.responseFields[a]]=t}if(!l&&i&&e.dataFilter){t=e.dataFilter(t,e.dataType)}l=a;a=c.shift();if(a){if(a==="*"){a=l}else if(l!=="*"&&l!==a){o=u[l+" "+a]||u["* "+a];if(!o){for(r in u){s=r.split(" ");if(s[1]===a){o=u[l+" "+s[0]]||u["* "+s[0]];if(o){if(o===true){o=u[r]}else if(u[r]!==true){a=s[0];c.unshift(s[1])}break}}}}if(o!==true){if(o&&e["throws"]){t=o(t)}else{try{t=o(t)}catch(d){return{state:"parsererror",error:o?d:"No conversion from "+l+" to "+a}}}}}}}return{state:"success",data:t}}f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:on,type:"GET",isLocal:cn.test(an[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_n,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(e,t){return t?wn(wn(e,f.ajaxSettings),t):wn(f.ajaxSettings,e)},ajaxPrefilter:vn(pn),ajaxTransport:vn(mn),ajax:function(e,t){if(typeof e==="object"){t=e;e=undefined}t=t||{};var n,i,r,a,o,s,l,u,c=f.ajaxSetup({},t),d=c.context||c,h=c.context&&(d.nodeType||d.jquery)?f(d):f.event,p=f.Deferred(),m=f.Callbacks("once memory"),_=c.statusCode||{},g={},v={},y=0,w="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!a){a={};while(t=un.exec(r)){a[t[1].toLowerCase()]=t[2]}}t=a[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?r:null},setRequestHeader:function(e,t){var n=e.toLowerCase();if(!y){e=v[n]=v[n]||e;g[e]=t}return this},overrideMimeType:function(e){if(!y){c.mimeType=e}return this},statusCode:function(e){var t;if(e){if(y<2){for(t in e){_[t]=[_[t],e[t]]}}else{b.always(e[b.status])}}return this},abort:function(e){var t=e||w;if(n){n.abort(t)}S(0,t);return this}};p.promise(b).complete=m.add;b.success=b.done;b.error=b.fail;c.url=((e||c.url||on)+"").replace(sn,"").replace(hn,an[1]+"//");c.type=t.method||t.type||c.method||c.type;c.dataTypes=f.trim(c.dataType||"*").toLowerCase().match(E)||[""];if(c.crossDomain==null){s=fn.exec(c.url.toLowerCase());c.crossDomain=!!(s&&(s[1]!==an[1]||s[2]!==an[2]||(s[3]||(s[1]==="http:"?"80":"443"))!==(an[3]||(an[1]==="http:"?"80":"443"))))}if(c.data&&c.processData&&typeof c.data!=="string"){c.data=f.param(c.data,c.traditional)}yn(pn,c,t,b);if(y===2){return b}l=c.global;if(l&&f.active++===0){f.event.trigger("ajaxStart")}c.type=c.type.toUpperCase();c.hasContent=!dn.test(c.type);i=c.url;if(!c.hasContent){if(c.data){i=c.url+=(rn.test(i)?"&":"?")+c.data;delete c.data}if(c.cache===false){c.url=ln.test(i)?i.replace(ln,"$1_="+nn++):i+(rn.test(i)?"&":"?")+"_="+nn++}}if(c.ifModified){if(f.lastModified[i]){b.setRequestHeader("If-Modified-Since",f.lastModified[i])}if(f.etag[i]){b.setRequestHeader("If-None-Match",f.etag[i])}}if(c.data&&c.hasContent&&c.contentType!==false||t.contentType){b.setRequestHeader("Content-Type",c.contentType)}b.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+_n+"; q=0.01":""):c.accepts["*"]);for(u in c.headers){b.setRequestHeader(u,c.headers[u])}if(c.beforeSend&&(c.beforeSend.call(d,b,c)===false||y===2)){return b.abort()}w="abort";for(u in{success:1,error:1,complete:1}){b[u](c[u])}n=yn(mn,c,t,b);if(!n){S(-1,"No Transport")}else{b.readyState=1;if(l){h.trigger("ajaxSend",[b,c])}if(c.async&&c.timeout>0){o=setTimeout(function(){b.abort("timeout")},c.timeout)}try{y=1;n.send(g,S)}catch(C){if(y<2){S(-1,C)}else{throw C}}}function S(e,t,a,s){var u,g,v,w,C,S=t;if(y===2){return}y=2;if(o){clearTimeout(o)}n=undefined;r=s||"";b.readyState=e>0?4:0;u=e>=200&&e<300||e===304;if(a){w=bn(c,b,a)}w=Cn(c,w,b,u);if(u){if(c.ifModified){C=b.getResponseHeader("Last-Modified");if(C){f.lastModified[i]=C}C=b.getResponseHeader("etag");if(C){f.etag[i]=C}}if(e===204||c.type==="HEAD"){S="nocontent"}else if(e===304){S="notmodified"}else{S=w.state;g=w.data;v=w.error;u=!v}}else{v=S;if(e||!S){S="error";if(e<0){e=0}}}b.status=e;b.statusText=(t||S)+"";if(u){p.resolveWith(d,[g,S,b])}else{p.rejectWith(d,[b,S,v])}b.statusCode(_);_=undefined;if(l){h.trigger(u?"ajaxSuccess":"ajaxError",[b,c,u?g:v])}m.fireWith(d,[b,S]);if(l){h.trigger("ajaxComplete",[b,c]);if(!--f.active){f.event.trigger("ajaxStop")}}}return b},getJSON:function(e,t,n){return f.get(e,t,n,"json")},getScript:function(e,t){return f.get(e,undefined,t,"script")}});f.each(["get","post"],function(e,t){f[t]=function(e,n,i,r){if(f.isFunction(n)){r=r||i;i=n;n=undefined}return f.ajax({url:e,type:t,dataType:r,data:n,success:i})}});f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){f.fn[t]=function(e){return this.on(t,e)}});f._evalUrl=function(e){return f.ajax({url:e,type:"GET",dataType:"script",async:false,global:false,"throws":true})};f.fn.extend({wrapAll:function(e){var t;if(f.isFunction(e)){return this.each(function(t){f(this).wrapAll(e.call(this,t))})}if(this[0]){t=f(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstElementChild){e=e.firstElementChild}return e}).append(this)}return this},wrapInner:function(e){if(f.isFunction(e)){return this.each(function(t){f(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=f(this),n=t.contents();if(n.length){n.wrapAll(e)}else{t.append(e)}})},wrap:function(e){var t=f.isFunction(e);return this.each(function(n){f(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){if(!f.nodeName(this,"body")){f(this).replaceWith(this.childNodes)}}).end()}});f.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0};f.expr.filters.visible=function(e){return!f.expr.filters.hidden(e)};var Sn=/%20/g,Tn=/\[\]$/,xn=/\r?\n/g,kn=/^(?:submit|button|image|reset|file)$/i,Mn=/^(?:input|select|textarea|keygen)/i;function Ln(e,t,n,i){var r;if(f.isArray(t)){f.each(t,function(t,r){if(n||Tn.test(e)){i(e,r)}else{Ln(e+"["+(typeof r==="object"?t:"")+"]",r,n,i)}})}else if(!n&&f.type(t)==="object"){for(r in t){Ln(e+"["+r+"]",t[r],n,i)}}else{i(e,t)}}f.param=function(e,t){var n,i=[],r=function(e,t){t=f.isFunction(t)?t():t==null?"":t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(t===undefined){t=f.ajaxSettings&&f.ajaxSettings.traditional}if(f.isArray(e)||e.jquery&&!f.isPlainObject(e)){f.each(e,function(){r(this.name,this.value)})}else{for(n in e){Ln(n,e[n],t,r)}}return i.join("&").replace(Sn,"+")};f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=f.prop(this,"elements");return e?f.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!f(this).is(":disabled")&&Mn.test(this.nodeName)&&!kn.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=f(this).val();return n==null?null:f.isArray(n)?f.map(n,function(e){return{name:t.name,value:e.replace(xn,"\r\n")}}):{name:t.name,value:n.replace(xn,"\r\n")}}).get()}});f.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Bn=0,En={},Dn={0:200,1223:204},Vn=f.ajaxSettings.xhr();if(e.ActiveXObject){f(e).on("unload",function(){for(var e in En){En[e]()}})}c.cors=!!Vn&&"withCredentials"in Vn;c.ajax=Vn=!!Vn;f.ajaxTransport(function(e){var t;if(c.cors||Vn&&!e.crossDomain){return{send:function(n,i){var r,a=e.xhr(),o=++Bn;a.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields){for(r in e.xhrFields){a[r]=e.xhrFields[r]}}if(e.mimeType&&a.overrideMimeType){a.overrideMimeType(e.mimeType)}if(!e.crossDomain&&!n["X-Requested-With"]){n["X-Requested-With"]="XMLHttpRequest"}for(r in n){a.setRequestHeader(r,n[r])}t=function(e){return function(){if(t){delete En[o];t=a.onload=a.onerror=null;if(e==="abort"){a.abort()}else if(e==="error"){i(a.status,a.statusText)}else{i(Dn[a.status]||a.status,a.statusText,typeof a.responseText==="string"?{text:a.responseText}:undefined,a.getAllResponseHeaders())}}}};a.onload=t();a.onerror=t("error");t=En[o]=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(s){if(t){throw s}}},abort:function(){if(t){t()}}}}});f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){f.globalEval(e);return e}}});f.ajaxPrefilter("script",function(e){if(e.cache===undefined){e.cache=false}if(e.crossDomain){e.type="GET"}});f.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,r){t=f("<script>").prop({async:true,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove();n=null;if(e){r(e.type==="error"?404:200,e.type)}});d.head.appendChild(t[0])},abort:function(){if(n){n()}}}}});var In=[],Pn=/(=)\?(?=&|$)|\?\?/;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=In.pop()||f.expando+"_"+nn++;this[e]=true;return e}});f.ajaxPrefilter("json jsonp",function(t,n,i){var r,a,o,s=t.jsonp!==false&&(Pn.test(t.url)?"url":typeof t.data==="string"&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Pn.test(t.data)&&"data");if(s||t.dataTypes[0]==="jsonp"){r=t.jsonpCallback=f.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback;if(s){t[s]=t[s].replace(Pn,"$1"+r)}else if(t.jsonp!==false){t.url+=(rn.test(t.url)?"&":"?")+t.jsonp+"="+r}t.converters["script json"]=function(){if(!o){f.error(r+" was not called")}return o[0]};t.dataTypes[0]="json";a=e[r];e[r]=function(){o=arguments};i.always(function(){e[r]=a;if(t[r]){t.jsonpCallback=n.jsonpCallback;In.push(r)}if(o&&f.isFunction(a)){a(o[0])}o=a=undefined});return"script"}});f.parseHTML=function(e,t,n){if(!e||typeof e!=="string"){return null}if(typeof t==="boolean"){n=t;t=false}t=t||d;var i=b.exec(e),r=!n&&[];if(i){return[t.createElement(i[1])]}i=f.buildFragment([e],t,r);if(r&&r.length){f(r).remove()}return f.merge([],i.childNodes)};var An=f.fn.load;f.fn.load=function(e,t,n){if(typeof e!=="string"&&An){return An.apply(this,arguments)}var i,r,a,o=this,s=e.indexOf(" ");if(s>=0){i=f.trim(e.slice(s));e=e.slice(0,s)}if(f.isFunction(t)){n=t;t=undefined}else if(t&&typeof t==="object"){r="POST"}if(o.length>0){f.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){a=arguments;o.html(i?f("<div>").append(f.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){o.each(n,a||[e.responseText,t,e])})}return this};f.expr.filters.animated=function(e){return f.grep(f.timers,function(t){return e===t.elem}).length};var Fn=e.document.documentElement;function On(e){return f.isWindow(e)?e:e.nodeType===9&&e.defaultView}f.offset={setOffset:function(e,t,n){var i,r,a,o,s,l,u,c=f.css(e,"position"),d=f(e),h={};if(c==="static"){e.style.position="relative"}s=d.offset();a=f.css(e,"top");l=f.css(e,"left");u=(c==="absolute"||c==="fixed")&&(a+l).indexOf("auto")>-1;if(u){i=d.position();o=i.top;r=i.left}else{o=parseFloat(a)||0;r=parseFloat(l)||0}if(f.isFunction(t)){t=t.call(e,n,s)}if(t.top!=null){h.top=t.top-s.top+o}if(t.left!=null){h.left=t.left-s.left+r}if("using"in t){t.using.call(e,h)}else{d.css(h)}}};f.fn.extend({offset:function(e){if(arguments.length){return e===undefined?this:this.each(function(t){f.offset.setOffset(this,e,t)})}var t,n,i=this[0],r={top:0,left:0},a=i&&i.ownerDocument;if(!a){return}t=a.documentElement;if(!f.contains(t,i)){return r}if(typeof i.getBoundingClientRect!==z){r=i.getBoundingClientRect()}n=On(a);return{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}},position:function(){if(!this[0]){return}var e,t,n=this[0],i={top:0,left:0};if(f.css(n,"position")==="fixed"){t=n.getBoundingClientRect()}else{e=this.offsetParent();t=this.offset();if(!f.nodeName(e[0],"html")){i=e.offset()}i.top+=f.css(e[0],"borderTopWidth",true);i.left+=f.css(e[0],"borderLeftWidth",true)}return{top:t.top-i.top-f.css(n,"marginTop",true),left:t.left-i.left-f.css(n,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||Fn;while(e&&(!f.nodeName(e,"html")&&f.css(e,"position")==="static")){e=e.offsetParent}return e||Fn})}});f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var i="pageYOffset"===n;f.fn[t]=function(r){return A(this,function(t,r,a){var o=On(t);if(a===undefined){return o?o[n]:t[r]}if(o){o.scrollTo(!i?a:e.pageXOffset,i?a:e.pageYOffset)}else{t[r]=a}},t,r,arguments.length,null)}});f.each(["top","left"],function(e,t){f.cssHooks[t]=Tt(c.pixelPosition,function(e,n){if(n){n=St(e,t);return bt.test(n)?f(e).position()[t]+"px":n}})});f.each({Height:"height",Width:"width"},function(e,t){f.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){f.fn[i]=function(i,r){var a=arguments.length&&(n||typeof i!=="boolean"),o=n||(i===true||r===true?"margin":"border");return A(this,function(t,n,i){var r;if(f.isWindow(t)){return t.document.documentElement["client"+e]}if(t.nodeType===9){r=t.documentElement;return Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])}return i===undefined?f.css(t,n,o):f.style(t,n,i,o)},t,a?i:undefined,a,null)}})});f.fn.size=function(){return this.length};f.fn.andSelf=f.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return f})}var Rn=e.jQuery,Nn=e.$;f.noConflict=function(t){if(e.$===f){e.$=Nn}if(t&&e.jQuery===f){e.jQuery=Rn}return f};if(typeof t===z){e.jQuery=e.$=f}return f});(function(){var e;var t=[],n=[];var i=0;var r=+new Date+"";var a=75;var o=40;var s=" 	\f ﻿"+"\n\r\u2028\u2029"+" ᠎             　";var l=/\b__p \+= '';/g,u=/\b(__p \+=) '' \+/g,c=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var d=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var h=/\w*$/;var f=/^\s*function[ \n\r\t]+\w/;var p=/<%=([\s\S]+?)%>/g;var m=RegExp("^["+s+"]*0+(?=.$)");var _=/($^)/;var g=/\bthis\b/;var v=/['\n\r\t\u2028\u2029\\]/g;var y=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"];var w=0;var b="[object Arguments]",C="[object Array]",S="[object Boolean]",T="[object Date]",x="[object Function]",k="[object Number]",M="[object Object]",L="[object RegExp]",B="[object String]";var E={};E[x]=false;E[b]=E[C]=E[S]=E[T]=E[k]=E[M]=E[L]=E[B]=true;var D={leading:false,maxWait:0,trailing:false};var V={configurable:false,enumerable:false,value:null,writable:false};var I={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false};var P={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};var A=I[typeof window]&&window||this;var F=I[typeof exports]&&exports&&!exports.nodeType&&exports;var O=I[typeof module]&&module&&!module.nodeType&&module;var R=O&&O.exports===F&&F;var N=I[typeof global]&&global;if(N&&(N.global===N||N.window===N)){A=N}function H(e,t,n){var i=(n||0)-1,r=e?e.length:0;while(++i<r){if(e[i]===t){return i}}return-1}function j(e,t){var n=typeof t;e=e.cache;if(n=="boolean"||t==null){return e[t]?0:-1}if(n!="number"&&n!="string"){n="object"}var i=n=="number"?t:r+t;e=(e=e[n])&&e[i];return n=="object"?e&&H(e,t)>-1?0:-1:e?0:-1}function U(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null){t[e]=true}else{if(n!="number"&&n!="string"){n="object"}var i=n=="number"?e:r+e,a=t[n]||(t[n]={});if(n=="object"){(a[i]||(a[i]=[])).push(e)}else{a[i]=true}}}function G(e){return e.charCodeAt(0)}function W(e,t){var n=e.criteria,i=t.criteria,r=-1,a=n.length;while(++r<a){var o=n[r],s=i[r];if(o!==s){if(o>s||typeof o=="undefined"){return 1}if(o<s||typeof s=="undefined"){return-1}}}return e.index-t.index}function K(e){var t=-1,n=e.length,i=e[0],r=e[n/2|0],a=e[n-1];if(i&&typeof i=="object"&&r&&typeof r=="object"&&a&&typeof a=="object"){return false}var o=q();o["false"]=o["null"]=o["true"]=o["undefined"]=false;var s=q();s.array=e;s.cache=o;s.push=U;while(++t<n){s.push(e[t])}return s}function z(e){return"\\"+P[e]}function Y(){return t.pop()||[]}function q(){return n.pop()||{array:null,cache:null,criteria:null,"false":false,index:0,"null":false,number:null,object:null,push:null,string:null,"true":false,undefined:false,value:null}}function Q(e){e.length=0;if(t.length<o){t.push(e)}}function J(e){var t=e.cache;if(t){J(t)}e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null;if(n.length<o){n.push(e)}}function $(e,t,n){t||(t=0);if(typeof n=="undefined"){n=e?e.length:0}var i=-1,r=n-t||0,a=Array(r<0?0:r);while(++i<r){a[i]=e[t+i]}return a}function X(t){t=t?Z.defaults(A.Object(),t,Z.pick(A,y)):A;var n=t.Array,o=t.Boolean,P=t.Date,F=t.Function,O=t.Math,R=t.Number,N=t.Object,U=t.RegExp,et=t.String,tt=t.TypeError;var nt=[];var it=N.prototype;var rt=t._;var at=it.toString;var ot=U("^"+et(at).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var st=O.ceil,lt=t.clearTimeout,ut=O.floor,ct=F.prototype.toString,dt=zt(dt=N.getPrototypeOf)&&dt,ht=it.hasOwnProperty,ft=nt.push,pt=t.setTimeout,mt=nt.splice,_t=nt.unshift;var gt=function(){try{var e={},t=zt(t=N.defineProperty)&&t,n=t(e,e,e)&&t}catch(i){}return n}();var vt=zt(vt=N.create)&&vt,yt=zt(yt=n.isArray)&&yt,wt=t.isFinite,bt=t.isNaN,Ct=zt(Ct=N.keys)&&Ct,St=O.max,Tt=O.min,xt=t.parseInt,kt=O.random;var Mt={};Mt[C]=n;Mt[S]=o;Mt[T]=P;Mt[x]=F;Mt[M]=N;Mt[k]=R;Mt[L]=U;Mt[B]=et;function Lt(e){return e&&typeof e=="object"&&!$t(e)&&ht.call(e,"__wrapped__")?e:new Bt(e)}function Bt(e,t){this.__chain__=!!t;this.__wrapped__=e}Bt.prototype=Lt.prototype;var Et=Lt.support={};Et.funcDecomp=!zt(t.WinRTError)&&g.test(X);Et.funcNames=typeof F.name=="string";Lt.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:p,variable:"",imports:{_:Lt}};function Dt(e){var t=e[0],n=e[2],i=e[4];function r(){if(n){var e=$(n);ft.apply(e,arguments)}if(this instanceof r){var a=It(t.prototype),o=t.apply(a,e||arguments);return kn(o)?o:a}return t.apply(i,e||arguments)}Yt(r,e);return r}function Vt(e,t,n,i,r){if(n){var a=n(e);if(typeof a!="undefined"){return a}}var o=kn(e);if(o){var s=at.call(e);if(!E[s]){return e}var l=Mt[s];switch(s){case S:case T:return new l(+e);case k:case B:return new l(e);case L:a=l(e.source,h.exec(e));a.lastIndex=e.lastIndex;return a}}else{return e}var u=$t(e);if(t){var c=!i;i||(i=Y());r||(r=Y());var d=i.length;while(d--){if(i[d]==e){return r[d]}}a=u?l(e.length):{}}else{a=u?$(e):an({},e)}if(u){if(ht.call(e,"index")){a.index=e.index}if(ht.call(e,"input")){a.input=e.input}}if(!t){return a}i.push(e);r.push(a);(u?qn:pn)(e,function(e,o){a[o]=Vt(e,t,n,i,r)});if(c){Q(i);Q(r)}return a}function It(e,t){return kn(e)?vt(e):{}}if(!vt){It=function(){function e(){}return function(n){if(kn(n)){e.prototype=n;var i=new e;e.prototype=null}return i||t.Object()}}()}function Pt(e,t,n){if(typeof e!="function"){return Zi}if(typeof t=="undefined"||!("prototype"in e)){return e}var i=e.__bindData__;if(typeof i=="undefined"){if(Et.funcNames){i=!e.name}i=i||!Et.funcDecomp;if(!i){var r=ct.call(e);if(!Et.funcNames){i=!f.test(r)}if(!i){i=g.test(r);Yt(e,i)}}}if(i===false||i!==true&&i[1]&1){return e}switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,a){return e.call(t,n,i,r,a)}}return Fi(e,t)}function At(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5];var s=n&1,l=n&2,u=n&4,c=n&8,d=t;function h(){var e=s?a:this;if(i){var f=$(i);ft.apply(f,arguments)}if(r||u){f||(f=$(arguments));if(r){ft.apply(f,r)}if(u&&f.length<o){n|=16&~32;return At([t,c?n:n&~3,f,null,a,o])}}f||(f=arguments);if(l){t=e[d]}if(this instanceof h){e=It(t.prototype);var p=t.apply(e,f);return kn(p)?p:e}return t.apply(e,f)}Yt(h,e);return h}function Ft(e,t){var n=-1,i=Kt(),r=e?e.length:0,o=r>=a&&i===H,s=[];if(o){var l=K(t);if(l){i=j;t=l}else{o=false}}while(++n<r){var u=e[n];if(i(t,u)<0){s.push(u)}}if(o){J(t)}return s}function Ot(e,t,n,i){var r=(i||0)-1,a=e?e.length:0,o=[];while(++r<a){var s=e[r];if(s&&typeof s=="object"&&typeof s.length=="number"&&($t(s)||Jt(s))){if(!t){s=Ot(s,t,n)}var l=-1,u=s.length,c=o.length;o.length+=u;while(++l<u){o[c++]=s[l]}}else if(!n){o.push(s)}}return o}function Rt(e,t,n,i,r,a){if(n){var o=n(e,t);if(typeof o!="undefined"){return!!o}}if(e===t){return e!==0||1/e==1/t}var s=typeof e,l=typeof t;if(e===e&&!(e&&I[s])&&!(t&&I[l])){return false}if(e==null||t==null){return e===t}var u=at.call(e),c=at.call(t);if(u==b){u=M}if(c==b){c=M}if(u!=c){return false}switch(u){case S:case T:return+e==+t;case k:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case L:case B:return e==et(t)}var d=u==C;if(!d){var h=ht.call(e,"__wrapped__"),f=ht.call(t,"__wrapped__");if(h||f){return Rt(h?e.__wrapped__:e,f?t.__wrapped__:t,n,i,r,a)}if(u!=M){return false}var p=e.constructor,m=t.constructor;if(p!=m&&!(xn(p)&&p instanceof p&&xn(m)&&m instanceof m)&&("constructor"in e&&"constructor"in t)){return false}}var _=!r;r||(r=Y());a||(a=Y());var g=r.length;while(g--){if(r[g]==e){return a[g]==t}}var v=0;o=true;r.push(e);a.push(t);if(d){g=e.length;v=t.length;o=v==g;if(o||i){while(v--){var y=g,w=t[v];if(i){while(y--){if(o=Rt(e[y],w,n,i,r,a)){break}}}else if(!(o=Rt(e[v],w,n,i,r,a))){break}}}}else{hn(t,function(t,s,l){if(ht.call(l,s)){v++;return o=ht.call(e,s)&&Rt(e[s],t,n,i,r,a)}});if(o&&!i){hn(e,function(e,t,n){if(ht.call(n,t)){return o=--v>-1}})}}r.pop();a.pop();if(_){Q(r);Q(a)}return o}function Nt(e,t,n,i,r){($t(t)?qn:pn)(t,function(t,a){var o,s,l=t,u=e[a];if(t&&((s=$t(t))||En(t))){var c=i.length;while(c--){if(o=i[c]==t){u=r[c];break}}if(!o){var d;if(n){l=n(u,t);if(d=typeof l!="undefined"){u=l}}if(!d){u=s?$t(u)?u:[]:En(u)?u:{}}i.push(t);r.push(u);if(!d){Nt(u,t,n,i,r)}}}else{if(n){l=n(u,t);if(typeof l=="undefined"){l=t}}if(typeof l!="undefined"){u=l}}e[a]=u})}function Ht(e,t){return e+ut(kt()*(t-e+1))}function jt(e,t,n){var i=-1,r=Kt(),o=e?e.length:0,s=[];var l=!t&&o>=a&&r===H,u=n||l?Y():s;if(l){var c=K(u);r=j;u=c}while(++i<o){var d=e[i],h=n?n(d,i,e):d;if(t?!i||u[u.length-1]!==h:r(u,h)<0){if(n||l){u.push(h)}s.push(d)}}if(l){Q(u.array);J(u)}else if(n){Q(u)}return s}function Ut(e){return function(t,n,i){var r={};n=Lt.createCallback(n,i,3);var a=-1,o=t?t.length:0;if(typeof o=="number"){while(++a<o){var s=t[a];e(r,s,n(s,a,t),t)}}else{pn(t,function(t,i,a){e(r,t,n(t,i,a),a)})}return r}}function Gt(e,t,n,i,r,a){var o=t&1,s=t&2,l=t&4,u=t&8,c=t&16,d=t&32;if(!s&&!xn(e)){throw new tt}if(c&&!n.length){t&=~16;c=n=false}if(d&&!i.length){t&=~32;d=i=false}var h=e&&e.__bindData__;if(h&&h!==true){h=$(h);if(h[2]){h[2]=$(h[2])}if(h[3]){h[3]=$(h[3])}if(o&&!(h[1]&1)){h[4]=r}if(!o&&h[1]&1){t|=8}if(l&&!(h[1]&4)){h[5]=a}if(c){ft.apply(h[2]||(h[2]=[]),n)}if(d){_t.apply(h[3]||(h[3]=[]),i)}h[1]|=t;return Gt.apply(null,h)}var f=t==1||t===17?Dt:At;return f([e,t,n,i,r,a])}function Wt(e){return en[e]}function Kt(){var e=(e=Lt.indexOf)===yi?H:e;return e}function zt(e){return typeof e=="function"&&ot.test(e)}var Yt=!gt?nr:function(e,t){V.value=t;gt(e,"__bindData__",V)};function qt(e){var t,n;if(!(e&&at.call(e)==M)||(t=e.constructor,xn(t)&&!(t instanceof t))){return false}hn(e,function(e,t){n=t});return typeof n=="undefined"||ht.call(e,n)}function Qt(e){return tn[e]}function Jt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&at.call(e)==b||false}var $t=yt||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&at.call(e)==C||false};var Xt=function(e){var t,n=e,i=[];if(!n)return i;if(!I[typeof e])return i;for(t in n){if(ht.call(n,t)){i.push(t)}}return i};var Zt=!Ct?Xt:function(e){if(!kn(e)){return[]}return Ct(e)};var en={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var tn=vn(en);var nn=U("("+Zt(tn).join("|")+")","g"),rn=U("["+Zt(en).join("")+"]","g");var an=function(e,t,n){var i,r=e,a=r;if(!r)return a;var o=arguments,s=0,l=typeof n=="number"?2:o.length;if(l>3&&typeof o[l-2]=="function"){var u=Pt(o[--l-1],o[l--],2)}else if(l>2&&typeof o[l-1]=="function"){u=o[--l]}while(++s<l){r=o[s];if(r&&I[typeof r]){var c=-1,d=I[typeof r]&&Zt(r),h=d?d.length:0;while(++c<h){i=d[c];a[i]=u?u(a[i],r[i]):r[i]}}}return a};function on(e,t,n,i){if(typeof t!="boolean"&&t!=null){i=n;n=t;t=false}return Vt(e,t,typeof n=="function"&&Pt(n,i,1))}function sn(e,t,n){return Vt(e,true,typeof t=="function"&&Pt(t,n,1))}function ln(e,t){var n=It(e);return t?an(n,t):n}var un=function(e,t,n){var i,r=e,a=r;if(!r)return a;var o=arguments,s=0,l=typeof n=="number"?2:o.length;while(++s<l){r=o[s];if(r&&I[typeof r]){var u=-1,c=I[typeof r]&&Zt(r),d=c?c.length:0;while(++u<d){i=c[u];if(typeof a[i]=="undefined")a[i]=r[i]}}}return a};function cn(e,t,n){var i;t=Lt.createCallback(t,n,3);pn(e,function(e,n,r){if(t(e,n,r)){i=n;return false}});return i}function dn(e,t,n){var i;t=Lt.createCallback(t,n,3);mn(e,function(e,n,r){if(t(e,n,r)){i=n;return false}});return i}var hn=function(e,t,n){var i,r=e,a=r;if(!r)return a;if(!I[typeof r])return a;t=t&&typeof n=="undefined"?t:Pt(t,n,3);for(i in r){if(t(r[i],i,e)===false)return a}return a};function fn(e,t,n){var i=[];hn(e,function(e,t){i.push(t,e)});var r=i.length;t=Pt(t,n,3);while(r--){if(t(i[r--],i[r],e)===false){break}}return e}var pn=function(e,t,n){var i,r=e,a=r;if(!r)return a;if(!I[typeof r])return a;t=t&&typeof n=="undefined"?t:Pt(t,n,3);var o=-1,s=I[typeof r]&&Zt(r),l=s?s.length:0;while(++o<l){i=s[o];if(t(r[i],i,e)===false)return a}return a};function mn(e,t,n){var i=Zt(e),r=i.length;t=Pt(t,n,3);while(r--){var a=i[r];if(t(e[a],a,e)===false){break}}return e}function _n(e){var t=[];hn(e,function(e,n){if(xn(e)){t.push(n)}});return t.sort()}function gn(e,t){return e?ht.call(e,t):false}function vn(e){var t=-1,n=Zt(e),i=n.length,r={};while(++t<i){var a=n[t];r[e[a]]=a}return r}function yn(e){return e===true||e===false||e&&typeof e=="object"&&at.call(e)==S||false}function wn(e){return e&&typeof e=="object"&&at.call(e)==T||false}function bn(e){return e&&e.nodeType===1||false}function Cn(e){var t=true;if(!e){return t}var n=at.call(e),i=e.length;if(n==C||n==B||n==b||n==M&&typeof i=="number"&&xn(e.splice)){return!i}pn(e,function(){return t=false});return t}function Sn(e,t,n,i){return Rt(e,t,typeof n=="function"&&Pt(n,i,2))}function Tn(e){return wt(e)&&!bt(parseFloat(e))}function xn(e){return typeof e=="function"}function kn(e){return!!(e&&I[typeof e])
}function Mn(e){return Bn(e)&&e!=+e}function Ln(e){return e===null}function Bn(e){return typeof e=="number"||e&&typeof e=="object"&&at.call(e)==k||false}var En=!dt?qt:function(e){if(!(e&&at.call(e)==M)){return false}var t=e.valueOf,n=zt(t)&&(n=dt(t))&&dt(n);return n?e==n||dt(e)==n:qt(e)};function Dn(e){return e&&typeof e=="object"&&at.call(e)==L||false}function Vn(e){return typeof e=="string"||e&&typeof e=="object"&&at.call(e)==B||false}function In(e){return typeof e=="undefined"}function Pn(e,t,n){var i={};t=Lt.createCallback(t,n,3);pn(e,function(e,n,r){i[n]=t(e,n,r)});return i}function An(e){var t=arguments,n=2;if(!kn(e)){return e}if(typeof t[2]!="number"){n=t.length}if(n>3&&typeof t[n-2]=="function"){var i=Pt(t[--n-1],t[n--],2)}else if(n>2&&typeof t[n-1]=="function"){i=t[--n]}var r=$(arguments,1,n),a=-1,o=Y(),s=Y();while(++a<n){Nt(e,r[a],i,o,s)}Q(o);Q(s);return e}function Fn(e,t,n){var i={};if(typeof t!="function"){var r=[];hn(e,function(e,t){r.push(t)});r=Ft(r,Ot(arguments,true,false,1));var a=-1,o=r.length;while(++a<o){var s=r[a];i[s]=e[s]}}else{t=Lt.createCallback(t,n,3);hn(e,function(e,n,r){if(!t(e,n,r)){i[n]=e}})}return i}function On(e){var t=-1,i=Zt(e),r=i.length,a=n(r);while(++t<r){var o=i[t];a[t]=[o,e[o]]}return a}function Rn(e,t,n){var i={};if(typeof t!="function"){var r=-1,a=Ot(arguments,true,false,1),o=kn(e)?a.length:0;while(++r<o){var s=a[r];if(s in e){i[s]=e[s]}}}else{t=Lt.createCallback(t,n,3);hn(e,function(e,n,r){if(t(e,n,r)){i[n]=e}})}return i}function Nn(e,t,n,i){var r=$t(e);if(n==null){if(r){n=[]}else{var a=e&&e.constructor,o=a&&a.prototype;n=It(o)}}if(t){t=Lt.createCallback(t,i,4);(r?qn:pn)(e,function(e,i,r){return t(n,e,i,r)})}return n}function Hn(e){var t=-1,i=Zt(e),r=i.length,a=n(r);while(++t<r){a[t]=e[i[t]]}return a}function jn(e){var t=arguments,i=-1,r=Ot(t,true,false,1),a=t[2]&&t[2][t[1]]===e?1:r.length,o=n(a);while(++i<a){o[i]=e[r[i]]}return o}function Un(e,t,n){var i=-1,r=Kt(),a=e?e.length:0,o=false;n=(n<0?St(0,a+n):n)||0;if($t(e)){o=r(e,t,n)>-1}else if(typeof a=="number"){o=(Vn(e)?e.indexOf(t,n):r(e,t,n))>-1}else{pn(e,function(e){if(++i>=n){return!(o=e===t)}})}return o}var Gn=Ut(function(e,t,n){ht.call(e,n)?e[n]++:e[n]=1});function Wn(e,t,n){var i=true;t=Lt.createCallback(t,n,3);var r=-1,a=e?e.length:0;if(typeof a=="number"){while(++r<a){if(!(i=!!t(e[r],r,e))){break}}}else{pn(e,function(e,n,r){return i=!!t(e,n,r)})}return i}function Kn(e,t,n){var i=[];t=Lt.createCallback(t,n,3);var r=-1,a=e?e.length:0;if(typeof a=="number"){while(++r<a){var o=e[r];if(t(o,r,e)){i.push(o)}}}else{pn(e,function(e,n,r){if(t(e,n,r)){i.push(e)}})}return i}function zn(e,t,n){t=Lt.createCallback(t,n,3);var i=-1,r=e?e.length:0;if(typeof r=="number"){while(++i<r){var a=e[i];if(t(a,i,e)){return a}}}else{var o;pn(e,function(e,n,i){if(t(e,n,i)){o=e;return false}});return o}}function Yn(e,t,n){var i;t=Lt.createCallback(t,n,3);Qn(e,function(e,n,r){if(t(e,n,r)){i=e;return false}});return i}function qn(e,t,n){var i=-1,r=e?e.length:0;t=t&&typeof n=="undefined"?t:Pt(t,n,3);if(typeof r=="number"){while(++i<r){if(t(e[i],i,e)===false){break}}}else{pn(e,t)}return e}function Qn(e,t,n){var i=e?e.length:0;t=t&&typeof n=="undefined"?t:Pt(t,n,3);if(typeof i=="number"){while(i--){if(t(e[i],i,e)===false){break}}}else{var r=Zt(e);i=r.length;pn(e,function(e,n,a){n=r?r[--i]:--i;return t(a[n],n,a)})}return e}var Jn=Ut(function(e,t,n){(ht.call(e,n)?e[n]:e[n]=[]).push(t)});var $n=Ut(function(e,t,n){e[n]=t});function Xn(e,t){var i=$(arguments,2),r=-1,a=typeof t=="function",o=e?e.length:0,s=n(typeof o=="number"?o:0);qn(e,function(e){s[++r]=(a?t:e[t]).apply(e,i)});return s}function Zn(e,t,i){var r=-1,a=e?e.length:0;t=Lt.createCallback(t,i,3);if(typeof a=="number"){var o=n(a);while(++r<a){o[r]=t(e[r],r,e)}}else{o=[];pn(e,function(e,n,i){o[++r]=t(e,n,i)})}return o}function ei(e,t,n){var i=-Infinity,r=i;if(typeof t!="function"&&n&&n[t]===e){t=null}if(t==null&&$t(e)){var a=-1,o=e.length;while(++a<o){var s=e[a];if(s>r){r=s}}}else{t=t==null&&Vn(e)?G:Lt.createCallback(t,n,3);qn(e,function(e,n,a){var o=t(e,n,a);if(o>i){i=o;r=e}})}return r}function ti(e,t,n){var i=Infinity,r=i;if(typeof t!="function"&&n&&n[t]===e){t=null}if(t==null&&$t(e)){var a=-1,o=e.length;while(++a<o){var s=e[a];if(s<r){r=s}}}else{t=t==null&&Vn(e)?G:Lt.createCallback(t,n,3);qn(e,function(e,n,a){var o=t(e,n,a);if(o<i){i=o;r=e}})}return r}var ni=Zn;function ii(e,t,n,i){if(!e)return n;var r=arguments.length<3;t=Lt.createCallback(t,i,4);var a=-1,o=e.length;if(typeof o=="number"){if(r){n=e[++a]}while(++a<o){n=t(n,e[a],a,e)}}else{pn(e,function(e,i,a){n=r?(r=false,e):t(n,e,i,a)})}return n}function ri(e,t,n,i){var r=arguments.length<3;t=Lt.createCallback(t,i,4);Qn(e,function(e,i,a){n=r?(r=false,e):t(n,e,i,a)});return n}function ai(e,t,n){t=Lt.createCallback(t,n,3);return Kn(e,function(e,n,i){return!t(e,n,i)})}function oi(t,n,i){if(t&&typeof t.length!="number"){t=Hn(t)}if(n==null||i){return t?t[Ht(0,t.length-1)]:e}var r=si(t);r.length=Tt(St(0,n),r.length);return r}function si(e){var t=-1,i=e?e.length:0,r=n(typeof i=="number"?i:0);qn(e,function(e){var n=Ht(0,++t);r[t]=r[n];r[n]=e});return r}function li(e){var t=e?e.length:0;return typeof t=="number"?t:Zt(e).length}function ui(e,t,n){var i;t=Lt.createCallback(t,n,3);var r=-1,a=e?e.length:0;if(typeof a=="number"){while(++r<a){if(i=t(e[r],r,e)){break}}}else{pn(e,function(e,n,r){return!(i=t(e,n,r))})}return!!i}function ci(e,t,i){var r=-1,a=$t(t),o=e?e.length:0,s=n(typeof o=="number"?o:0);if(!a){t=Lt.createCallback(t,i,3)}qn(e,function(e,n,i){var o=s[++r]=q();if(a){o.criteria=Zn(t,function(t){return e[t]})}else{(o.criteria=Y())[0]=t(e,n,i)}o.index=r;o.value=e});o=s.length;s.sort(W);while(o--){var l=s[o];s[o]=l.value;if(!a){Q(l.criteria)}J(l)}return s}function di(e){if(e&&typeof e.length=="number"){return $(e)}return Hn(e)}var hi=Kn;function fi(e){var t=-1,n=e?e.length:0,i=[];while(++t<n){var r=e[t];if(r){i.push(r)}}return i}function pi(e){return Ft(e,Ot(arguments,true,true,1))}function mi(e,t,n){var i=-1,r=e?e.length:0;t=Lt.createCallback(t,n,3);while(++i<r){if(t(e[i],i,e)){return i}}return-1}function _i(e,t,n){var i=e?e.length:0;t=Lt.createCallback(t,n,3);while(i--){if(t(e[i],i,e)){return i}}return-1}function gi(t,n,i){var r=0,a=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Lt.createCallback(n,i,3);while(++o<a&&n(t[o],o,t)){r++}}else{r=n;if(r==null||i){return t?t[0]:e}}return $(t,0,Tt(St(0,r),a))}function vi(e,t,n,i){if(typeof t!="boolean"&&t!=null){i=n;n=typeof t!="function"&&i&&i[t]===e?null:t;t=false}if(n!=null){e=Zn(e,n,i)}return Ot(e,t)}function yi(e,t,n){if(typeof n=="number"){var i=e?e.length:0;n=n<0?St(0,i+n):n||0}else if(n){var r=Li(e,t);return e[r]===t?r:-1}return H(e,t,n)}function wi(e,t,n){var i=0,r=e?e.length:0;if(typeof t!="number"&&t!=null){var a=r;t=Lt.createCallback(t,n,3);while(a--&&t(e[a],a,e)){i++}}else{i=t==null||n?1:t||i}return $(e,0,Tt(St(0,r-i),r))}function bi(){var e=[],t=-1,n=arguments.length,i=Y(),r=Kt(),o=r===H,s=Y();while(++t<n){var l=arguments[t];if($t(l)||Jt(l)){e.push(l);i.push(o&&l.length>=a&&K(t?e[t]:s))}}var u=e[0],c=-1,d=u?u.length:0,h=[];e:while(++c<d){var f=i[0];l=u[c];if((f?j(f,l):r(s,l))<0){t=n;(f||s).push(l);while(--t){f=i[t];if((f?j(f,l):r(e[t],l))<0){continue e}}h.push(l)}}while(n--){f=i[n];if(f){J(f)}}Q(i);Q(s);return h}function Ci(t,n,i){var r=0,a=t?t.length:0;if(typeof n!="number"&&n!=null){var o=a;n=Lt.createCallback(n,i,3);while(o--&&n(t[o],o,t)){r++}}else{r=n;if(r==null||i){return t?t[a-1]:e}}return $(t,St(0,a-r))}function Si(e,t,n){var i=e?e.length:0;if(typeof n=="number"){i=(n<0?St(0,i+n):Tt(n,i-1))+1}while(i--){if(e[i]===t){return i}}return-1}function Ti(e){var t=arguments,n=0,i=t.length,r=e?e.length:0;while(++n<i){var a=-1,o=t[n];while(++a<r){if(e[a]===o){mt.call(e,a--,1);r--}}}return e}function xi(e,t,i){e=+e||0;i=typeof i=="number"?i:+i||1;if(t==null){t=e;e=0}var r=-1,a=St(0,st((t-e)/(i||1))),o=n(a);while(++r<a){o[r]=e;e+=i}return o}function ki(e,t,n){var i=-1,r=e?e.length:0,a=[];t=Lt.createCallback(t,n,3);while(++i<r){var o=e[i];if(t(o,i,e)){a.push(o);mt.call(e,i--,1);r--}}return a}function Mi(e,t,n){if(typeof t!="number"&&t!=null){var i=0,r=-1,a=e?e.length:0;t=Lt.createCallback(t,n,3);while(++r<a&&t(e[r],r,e)){i++}}else{i=t==null||n?1:St(0,t)}return $(e,i)}function Li(e,t,n,i){var r=0,a=e?e.length:r;n=n?Lt.createCallback(n,i,1):Zi;t=n(t);while(r<a){var o=r+a>>>1;n(e[o])<t?r=o+1:a=o}return r}function Bi(){return jt(Ot(arguments,true,true))}function Ei(e,t,n,i){if(typeof t!="boolean"&&t!=null){i=n;n=typeof t!="function"&&i&&i[t]===e?null:t;t=false}if(n!=null){n=Lt.createCallback(n,i,3)}return jt(e,t,n)}function Di(e){return Ft(e,$(arguments,1))}function Vi(){var e=-1,t=arguments.length;while(++e<t){var n=arguments[e];if($t(n)||Jt(n)){var i=i?jt(Ft(i,n).concat(Ft(n,i))):n}}return i||[]}function Ii(){var e=arguments.length>1?arguments:arguments[0],t=-1,i=e?ei(ni(e,"length")):0,r=n(i<0?0:i);while(++t<i){r[t]=ni(e,t)}return r}function Pi(e,t){var n=-1,i=e?e.length:0,r={};if(!t&&i&&!$t(e[0])){t=[]}while(++n<i){var a=e[n];if(t){r[a]=t[n]}else if(a){r[a[0]]=a[1]}}return r}function Ai(e,t){if(!xn(t)){throw new tt}return function(){if(--e<1){return t.apply(this,arguments)}}}function Fi(e,t){return arguments.length>2?Gt(e,17,$(arguments,2),null,t):Gt(e,1,null,null,t)}function Oi(e){var t=arguments.length>1?Ot(arguments,true,false,1):_n(e),n=-1,i=t.length;while(++n<i){var r=t[n];e[r]=Gt(e[r],1,null,null,e)}return e}function Ri(e,t){return arguments.length>2?Gt(t,19,$(arguments,2),null,e):Gt(t,3,null,null,e)}function Ni(){var e=arguments,t=e.length;while(t--){if(!xn(e[t])){throw new tt}}return function(){var t=arguments,n=e.length;while(n--){t=[e[n].apply(this,t)]}return t[0]}}function Hi(e,t){t=typeof t=="number"?t:+t||e.length;return Gt(e,4,null,null,null,t)}function ji(t,n,i){var r,a,o,s,l,u,c,d=0,h=false,f=true;if(!xn(t)){throw new tt}n=St(0,n)||0;if(i===true){var p=true;f=false}else if(kn(i)){p=i.leading;h="maxWait"in i&&(St(n,i.maxWait)||0);f="trailing"in i?i.trailing:f}var m=function(){var i=n-(ir()-s);if(i<=0){if(a){lt(a)}var h=c;a=u=c=e;if(h){d=ir();o=t.apply(l,r);if(!u&&!a){r=l=null}}}else{u=pt(m,i)}};var _=function(){if(u){lt(u)}a=u=c=e;if(f||h!==n){d=ir();o=t.apply(l,r);if(!u&&!a){r=l=null}}};return function(){r=arguments;s=ir();l=this;c=f&&(u||!p);if(h===false){var e=p&&!u}else{if(!a&&!p){d=s}var i=h-(s-d),g=i<=0;if(g){if(a){a=lt(a)}d=s;o=t.apply(l,r)}else if(!a){a=pt(_,i)}}if(g&&u){u=lt(u)}else if(!u&&n!==h){u=pt(m,n)}if(e){g=true;o=t.apply(l,r)}if(g&&!u&&!a){r=l=null}return o}}function Ui(t){if(!xn(t)){throw new tt}var n=$(arguments,1);return pt(function(){t.apply(e,n)},1)}function Gi(t,n){if(!xn(t)){throw new tt}var i=$(arguments,2);return pt(function(){t.apply(e,i)},n)}function Wi(e,t){if(!xn(e)){throw new tt}var n=function(){var i=n.cache,a=t?t.apply(this,arguments):r+arguments[0];return ht.call(i,a)?i[a]:i[a]=e.apply(this,arguments)};n.cache={};return n}function Ki(e){var t,n;if(!xn(e)){throw new tt}return function(){if(t){return n}t=true;n=e.apply(this,arguments);e=null;return n}}function zi(e){return Gt(e,16,$(arguments,1))}function Yi(e){return Gt(e,32,null,$(arguments,1))}function qi(e,t,n){var i=true,r=true;if(!xn(e)){throw new tt}if(n===false){i=false}else if(kn(n)){i="leading"in n?n.leading:i;r="trailing"in n?n.trailing:r}D.leading=i;D.maxWait=t;D.trailing=r;return ji(e,t,D)}function Qi(e,t){return Gt(t,16,[e])}function Ji(e){return function(){return e}}function $i(e,t,n){var i=typeof e;if(e==null||i=="function"){return Pt(e,t,n)}if(i!="object"){return ar(e)}var r=Zt(e),a=r[0],o=e[a];if(r.length==1&&o===o&&!kn(o)){return function(e){var t=e[a];return o===t&&(o!==0||1/o==1/t)}}return function(t){var n=r.length,i=false;while(n--){if(!(i=Rt(t[r[n]],e[r[n]],null,true))){break}}return i}}function Xi(e){return e==null?"":et(e).replace(rn,Wt)}function Zi(e){return e}function er(e,t,n){var i=true,r=t&&_n(t);if(!t||!n&&!r.length){if(n==null){n=t}a=Bt;t=e;e=Lt;r=_n(t)}if(n===false){i=false}else if(kn(n)&&"chain"in n){i=n.chain}var a=e,o=xn(a);qn(r,function(n){var r=e[n]=t[n];if(o){a.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,o=[n];ft.apply(o,arguments);var s=r.apply(e,o);if(i||t){if(n===s&&kn(s)){return this}s=new a(s);s.__chain__=t}return s}}})}function tr(){t._=rt;return this}function nr(){}var ir=zt(ir=P.now)&&ir||function(){return(new P).getTime()};var rr=xt(s+"08")==8?xt:function(e,t){return xt(Vn(e)?e.replace(m,""):e,t||0)};function ar(e){return function(t){return t[e]}}function or(e,t,n){var i=e==null,r=t==null;if(n==null){if(typeof e=="boolean"&&r){n=e;e=1}else if(!r&&typeof t=="boolean"){n=t;r=true}}if(i&&r){t=1}e=+e||0;if(r){t=e;e=0}else{t=+t||0}if(n||e%1||t%1){var a=kt();return Tt(e+a*(t-e+parseFloat("1e-"+((a+"").length-1))),t)}return Ht(e,t)}function sr(e,t){if(e){var n=e[t];return xn(n)?e[t]():n}}function lr(t,n,i){var r=Lt.templateSettings;t=et(t||"");i=un({},i,r);var a=un({},i.imports,r.imports),o=Zt(a),s=Hn(a);var h,f=0,m=i.interpolate||_,g="__p += '";var y=U((i.escape||_).source+"|"+m.source+"|"+(m===p?d:_).source+"|"+(i.evaluate||_).source+"|$","g");t.replace(y,function(e,n,i,r,a,o){i||(i=r);g+=t.slice(f,o).replace(v,z);if(n){g+="' +\n__e("+n+") +\n'"}if(a){h=true;g+="';\n"+a+";\n__p += '"}if(i){g+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"}f=o+e.length;return e});g+="';\n";var b=i.variable,C=b;if(!C){b="obj";g="with ("+b+") {\n"+g+"\n}\n"}g=(h?g.replace(l,""):g).replace(u,"$1").replace(c,"$1;");g="function("+b+") {\n"+(C?"":b+" || ("+b+" = {});\n")+"var __t, __p = '', __e = _.escape"+(h?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var S="\n/*\n//# sourceURL="+(i.sourceURL||"/lodash/template/source["+w++ +"]")+"\n*/";try{var T=F(o,"return "+g+S).apply(e,s)}catch(x){x.source=g;throw x}if(n){return T(n)}T.source=g;return T}function ur(e,t,i){e=(e=+e)>-1?e:0;var r=-1,a=n(e);t=Pt(t,i,1);while(++r<e){a[r]=t(r)}return a}function cr(e){return e==null?"":et(e).replace(nn,Qt)}function dr(e){var t=++i;return et(e==null?"":e)+t}function hr(e){e=new Bt(e);e.__chain__=true;return e}function fr(e,t){t(e);return e}function pr(){this.__chain__=true;return this}function mr(){return et(this.__wrapped__)}function _r(){return this.__wrapped__}Lt.after=Ai;Lt.assign=an;Lt.at=jn;Lt.bind=Fi;Lt.bindAll=Oi;Lt.bindKey=Ri;Lt.chain=hr;Lt.compact=fi;Lt.compose=Ni;Lt.constant=Ji;Lt.countBy=Gn;Lt.create=ln;Lt.createCallback=$i;Lt.curry=Hi;Lt.debounce=ji;Lt.defaults=un;Lt.defer=Ui;Lt.delay=Gi;Lt.difference=pi;Lt.filter=Kn;Lt.flatten=vi;Lt.forEach=qn;Lt.forEachRight=Qn;Lt.forIn=hn;Lt.forInRight=fn;Lt.forOwn=pn;Lt.forOwnRight=mn;Lt.functions=_n;Lt.groupBy=Jn;Lt.indexBy=$n;Lt.initial=wi;Lt.intersection=bi;Lt.invert=vn;Lt.invoke=Xn;Lt.keys=Zt;Lt.map=Zn;Lt.mapValues=Pn;Lt.max=ei;Lt.memoize=Wi;Lt.merge=An;Lt.min=ti;Lt.omit=Fn;Lt.once=Ki;Lt.pairs=On;Lt.partial=zi;Lt.partialRight=Yi;Lt.pick=Rn;Lt.pluck=ni;Lt.property=ar;Lt.pull=Ti;Lt.range=xi;Lt.reject=ai;Lt.remove=ki;Lt.rest=Mi;Lt.shuffle=si;Lt.sortBy=ci;Lt.tap=fr;Lt.throttle=qi;Lt.times=ur;Lt.toArray=di;Lt.transform=Nn;Lt.union=Bi;Lt.uniq=Ei;Lt.values=Hn;Lt.where=hi;Lt.without=Di;Lt.wrap=Qi;Lt.xor=Vi;Lt.zip=Ii;Lt.zipObject=Pi;Lt.collect=Zn;Lt.drop=Mi;Lt.each=qn;Lt.eachRight=Qn;Lt.extend=an;Lt.methods=_n;Lt.object=Pi;Lt.select=Kn;Lt.tail=Mi;Lt.unique=Ei;Lt.unzip=Ii;er(Lt);Lt.clone=on;Lt.cloneDeep=sn;Lt.contains=Un;Lt.escape=Xi;Lt.every=Wn;Lt.find=zn;Lt.findIndex=mi;Lt.findKey=cn;Lt.findLast=Yn;Lt.findLastIndex=_i;Lt.findLastKey=dn;Lt.has=gn;Lt.identity=Zi;Lt.indexOf=yi;Lt.isArguments=Jt;Lt.isArray=$t;Lt.isBoolean=yn;Lt.isDate=wn;Lt.isElement=bn;Lt.isEmpty=Cn;Lt.isEqual=Sn;Lt.isFinite=Tn;Lt.isFunction=xn;Lt.isNaN=Mn;Lt.isNull=Ln;Lt.isNumber=Bn;Lt.isObject=kn;Lt.isPlainObject=En;Lt.isRegExp=Dn;Lt.isString=Vn;Lt.isUndefined=In;Lt.lastIndexOf=Si;Lt.mixin=er;Lt.noConflict=tr;Lt.noop=nr;Lt.now=ir;Lt.parseInt=rr;Lt.random=or;Lt.reduce=ii;Lt.reduceRight=ri;Lt.result=sr;Lt.runInContext=X;Lt.size=li;Lt.some=ui;Lt.sortedIndex=Li;Lt.template=lr;Lt.unescape=cr;Lt.uniqueId=dr;Lt.all=Wn;Lt.any=ui;Lt.detect=zn;Lt.findWhere=zn;Lt.foldl=ii;Lt.foldr=ri;Lt.include=Un;Lt.inject=ii;er(function(){var e={};pn(Lt,function(t,n){if(!Lt.prototype[n]){e[n]=t}});return e}(),false);Lt.first=gi;Lt.last=Ci;Lt.sample=oi;Lt.take=gi;Lt.head=gi;pn(Lt,function(e,t){var n=t!=="sample";if(!Lt.prototype[t]){Lt.prototype[t]=function(t,i){var r=this.__chain__,a=e(this.__wrapped__,t,i);return!r&&(t==null||i&&!(n&&typeof t=="function"))?a:new Bt(a,r)}}});Lt.VERSION="2.4.1";Lt.prototype.chain=pr;Lt.prototype.toString=mr;Lt.prototype.value=_r;Lt.prototype.valueOf=_r;qn(["join","pop","shift"],function(e){var t=nt[e];Lt.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new Bt(n,e):n}});qn(["push","reverse","sort","unshift"],function(e){var t=nt[e];Lt.prototype[e]=function(){t.apply(this.__wrapped__,arguments);return this}});qn(["concat","slice","splice"],function(e){var t=nt[e];Lt.prototype[e]=function(){return new Bt(t.apply(this.__wrapped__,arguments),this.__chain__)}});return Lt}var Z=X();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){A._=Z;define(function(){return Z})}else if(F&&O){if(R){(O.exports=Z)._=Z}else{F._=Z}}else{A._=Z}}).call(this);(function(){var e,t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,_,g,v,y,w,b,C,S,T,x,k,M,L,B,E,D,V,I,P,A,F,O,R,N,H,j,U,G,W,K,z,Y,q,Q,J,$,X,Z,et,tt,nt,it,rt,at,ot,st,lt,ut,ct,dt,ht,ft=[].slice,pt={}.hasOwnProperty,mt=function(e,t){for(var n in t){if(pt.call(t,n))e[n]=t[n]}function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},_t=function(e,t){return function(){return e.apply(t,arguments)}};e={toString:function(){return"Bacon"}};e.version="0.7.38";d=(typeof global!=="undefined"&&global!==null?global:this).Error;e.fromBinder=function(t,n){if(n==null){n=dt.id}return new c(V(e,"fromBinder",t,n),function(i){var r,a,o;o=false;r=function(){if(typeof a!=="undefined"&&a!==null){if(!o){a()}return o=true}};a=t(function(){var t,o,s,l,c,d;t=1<=arguments.length?ft.call(arguments,0):[];l=n.apply(this,t);if(!(H(l)&&dt.last(l)instanceof u)){l=[l]}s=e.more;for(c=0,d=l.length;c<d;c++){o=l[c];s=i(o=rt(o));if(s===e.noMore||o.isEnd()){if(a!=null){r()}else{e.scheduler.setTimeout(r,0)}return s}}return s});return r})};e.$={};e.$.asEventStream=function(t,n,i){var r;if(U(n)){r=[n,void 0],i=r[0],n=r[1]}return ut(this.selector||this,"asEventStream",t,e.fromBinder(function(e){return function(i){e.on(t,n,i);return function(){return e.off(t,n,i)}}}(this),i))};if((ht=typeof jQuery!=="undefined"&&jQuery!==null?jQuery:typeof Zepto!=="undefined"&&Zepto!==null?Zepto:void 0)!=null){ht.fn.asEventStream=e.$.asEventStream}e.fromEventTarget=function(t,n,i){var r,a,o,s,l,u,c,d;r=(o=(s=(l=t.addEventListener)!=null?l:t.addListener)!=null?s:t.bind)!=null?o:t.on;a=(u=(c=(d=t.removeEventListener)!=null?d:t.removeListener)!=null?c:t.unbind)!=null?u:t.off;return ut(e,"fromEventTarget",t,n,e.fromBinder(function(e){r.call(t,n,e);return function(){return a.call(t,n,e)}},i))};e.fromPromise=function(t,n){return ut(e,"fromPromise",t,e.fromBinder(function(e){t.then(e,function(t){return e(new l(t))});return function(){if(n){return typeof t.abort==="function"?t.abort():void 0}}},function(e){return[e,I()]}))};e.noMore=["<no-more>"];e.more=["<more>"];e.later=function(t,n){return ut(e,"later",t,n,e.fromPoll(t,function(){return[n,I()]}))};e.sequentially=function(t,n){var i;i=0;return ut(e,"sequentially",t,n,e.fromPoll(t,function(){var e;e=n[i++];if(i<n.length){return e}else if(i===n.length){return[e,I()]}else{return I()}}))};e.repeatedly=function(t,n){var i;i=0;return ut(e,"repeatedly",t,n,e.fromPoll(t,function(){return n[i++%n.length]}))};e.spy=function(e){return nt.push(e)};nt=[];tt=function(e){var t,n,i;if(nt.length){if(!tt.running){try{tt.running=true;for(n=0,i=nt.length;n<i;n++){t=nt[n];t(e)}}finally{delete tt.running}}}return void 0};ct=function(e){return function(){var t,n,i,r;i=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];if(typeof i==="object"&&t.length){n=i;r=t[0];i=function(){return n[r].apply(n,arguments)};t=t.slice(1)}return e.apply(null,[i].concat(ft.call(t)))}};K=function(t,n){return ct(function(){var i,r,a;r=arguments[0],i=2<=arguments.length?ft.call(arguments,1):[];a=Z(n,[function(e,t){return r.apply(null,ft.call(e).concat([t]))}]);return ut.apply(null,[e,t,r].concat(ft.call(i),[e.combineAsArray(i).flatMap(a)]))})};e.fromCallback=K("fromCallback",function(){var t,n;n=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];return e.fromBinder(function(e){z(n,t)(e);return X},function(e){return[e,I()]})});e.fromNodeCallback=K("fromNodeCallback",function(){var t,n;n=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];return e.fromBinder(function(e){z(n,t)(e);return X},function(e,t){if(e){return[new l(e),I()]}return[t,I()]})});e.fromPoll=function(t,n){return ut(e,"fromPoll",t,n,e.fromBinder(function(n){var i;i=e.scheduler.setInterval(n,t);return function(){return e.scheduler.clearInterval(i)}},n))};e.interval=function(t,n){if(n==null){n={}}return ut(e,"interval",t,n,e.fromPoll(t,function(){return $(n)}))};e.constant=function(t){return new _(V(e,"constant",t),function(e){e(N(t));e(I());return X})};e.never=function(){return new c(V(e,"never"),function(e){e(I());return X})};e.once=function(t){return new c(V(e,"once",t),function(e){e(rt(t));e(I());return X})};e.fromArray=function(t){var n;S(t);n=0;return new c(V(e,"fromArray",t),function(i){var r,a,o;a=false;r=e.more;while(r!==e.noMore&&!a){if(n>=t.length){i(I());r=e.noMore}else{o=t[n++];r=i(rt(o))}}return function(){return a=true}})};e.mergeAll=function(){var t;t=1<=arguments.length?ft.call(arguments,0):[];if(H(t[0])){t=t[0]}if(t.length){return new c(V.apply(null,[e,"mergeAll"].concat(ft.call(t))),function(n){var i,r,a;i=0;a=function(r){return function(a){return r.dispatcher.subscribe(function(r){var o;if(r.isEnd()){i++;if(i===t.length){return n(I())}else{return e.more}}else{o=n(r);if(o===e.noMore){a()}return o}})}};r=dt.map(a,t);return B.apply(null,r)})}else{return e.never()}};e.zipAsArray=function(){var t;t=1<=arguments.length?ft.call(arguments,0):[];if(H(t[0])){t=t[0]}return ut.apply(null,[e,"zipAsArray"].concat(ft.call(t),[e.zipWith(t,function(){var e;e=1<=arguments.length?ft.call(arguments,0):[];return e})]))};e.zipWith=function(){var t,n,i;t=arguments[0],n=2<=arguments.length?ft.call(arguments,1):[];if(!U(t)){i=[t,n[0]],n=i[0],t=i[1]}n=dt.map(function(e){return e.toEventStream()},n);return ut.apply(null,[e,"zipWith",t].concat(ft.call(n),[e.when(n,t)]))};e.groupSimultaneous=function(){var n,i,r;r=1<=arguments.length?ft.call(arguments,0):[];if(r.length===1&&H(r[0])){r=r[0]}i=function(){var e,i,a;a=[];for(e=0,i=r.length;e<i;e++){n=r[e];a.push(new t(n))}return a}();return ut.apply(null,[e,"groupSimultaneous"].concat(ft.call(r),[e.when(i,function(){var e;e=1<=arguments.length?ft.call(arguments,0):[];return e})]))};e.combineAsArray=function(){var t,n,i,r,a,o,s;a=1<=arguments.length?ft.call(arguments,0):[];if(a.length===1&&H(a[0])){a=a[0]}for(t=o=0,s=a.length;o<s;t=++o){r=a[t];if(!G(r)){a[t]=e.constant(r)}}if(a.length){i=function(){var e,t,i;i=[];for(e=0,t=a.length;e<t;e++){n=a[e];i.push(new y(n,true))}return i}();return ut.apply(null,[e,"combineAsArray"].concat(ft.call(a),[e.when(i,function(){var e;e=1<=arguments.length?ft.call(arguments,0):[];return e}).toProperty()]))}else{return e.constant([])}};e.onValues=function(){var t,n,i;n=2<=arguments.length?ft.call(arguments,0,i=arguments.length-1):(i=0,[]),t=arguments[i++];return e.combineAsArray(n).onValues(t)};e.combineWith=function(){var t,n;t=arguments[0],n=2<=arguments.length?ft.call(arguments,1):[];return ut.apply(null,[e,"combineWith",t].concat(ft.call(n),[e.combineAsArray(n).map(function(e){return t.apply(null,e)})]))};e.combineTemplate=function(t){var n,i,r,a,o,s,l,u,c,d;l=[];d=[];s=function(e){return e[e.length-1]};c=function(e,t,n){return s(e)[t]=n};n=function(e,t){return function(n,i){return c(n,e,i[t])}};o=function(e,t){return function(n){return c(n,e,t)}};u=function(e){if(H(e)){return[]}else{return{}}};r=function(e,t){var i,r;if(G(t)){d.push(t);return l.push(n(e,d.length-1))}else if(t===Object(t)&&typeof t!=="function"&&!(t instanceof RegExp)&&!(t instanceof Date)){r=function(e){return function(n){var i;i=u(t);c(n,e,i);return n.push(i)}};i=function(e){return e.pop()};l.push(r(e));a(t);return l.push(i)}else{return l.push(o(e,t))}};a=function(e){return dt.each(e,r)};a(t);i=function(e){var n,i,r,a,o;r=u(t);n=[r];for(a=0,o=l.length;a<o;a++){i=l[a];i(n,e)}return r};return ut(e,"combineTemplate",t,e.combineAsArray(d).map(i))};e.retry=function(t){var n,i,r,a,o,s;if(!U(t.source)){throw new d("'source' option has to be a function")}s=t.source;a=t.retries||0;r=t.maxRetries||a;n=t.delay||function(){return 0};i=t.isRetryable||function(){return true};o=function(t){var o,l;l={source:s,retries:a-1,maxRetries:r,delay:n,isRetryable:i};o=function(){return e.retry(l)};return e.later(n(t)).filter(false).concat(e.once().flatMap(o))};return ut(e,"retry",t,s().flatMapError(function(t){if(i(t)&&a>0){return o({error:t,retriesDone:r-a})}else{return e.once(new l(t))}}))};P=0;u=function(){function e(){this.id=++P}e.prototype.isEvent=function(){return true};e.prototype.isEnd=function(){return false};e.prototype.isInitial=function(){return false};e.prototype.isNext=function(){return false};e.prototype.isError=function(){return false};e.prototype.hasValue=function(){return false};e.prototype.filter=function(){return true};e.prototype.inspect=function(){return this.toString()};e.prototype.log=function(){return this.toString()};return e}();f=function(e){mt(t,e);function t(e,n){t.__super__.constructor.call(this);if(!n&&U(e)||e instanceof t){this.valueF=e;this.valueInternal=void 0}else{this.valueF=void 0;this.valueInternal=e}}t.prototype.isNext=function(){return true};t.prototype.hasValue=function(){return true};t.prototype.value=function(){if(this.valueF instanceof t){this.valueInternal=this.valueF.value();this.valueF=void 0}else if(this.valueF){this.valueInternal=this.valueF();this.valueF=void 0}return this.valueInternal};t.prototype.fmap=function(e){var t,n;if(this.valueInternal){n=this.valueInternal;return this.apply(function(){return e(n)})}else{t=this;return this.apply(function(){return e(t.value())})}};t.prototype.apply=function(e){return new t(e)};t.prototype.filter=function(e){return e(this.value())};t.prototype.toString=function(){return dt.toString(this.value())};t.prototype.log=function(){return this.value()};return t}(u);h=function(e){mt(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.isInitial=function(){return true};t.prototype.isNext=function(){return false};t.prototype.apply=function(e){return new t(e)};t.prototype.toNext=function(){return new f(this)};return t}(f);s=function(e){mt(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.isEnd=function(){return true};t.prototype.fmap=function(){return this};t.prototype.apply=function(){return this};t.prototype.toString=function(){return"<end>"};return t}(u);l=function(e){mt(t,e);function t(e){this.error=e}t.prototype.isError=function(){return true};t.prototype.fmap=function(){return this};t.prototype.apply=function(){return this};t.prototype.toString=function(){return"<error> "+dt.toString(this.error)};return t}(u);R=0;m=function(){function t(e){this.id=++R;ut(e,this);this.initialDesc=this.desc}t.prototype.subscribe=function(e){return w.wrappedSubscribe(this,e)};t.prototype.subscribeInternal=function(e){return this.dispatcher.subscribe(e)};t.prototype.onValue=function(){var e;e=Y(arguments);return this.subscribe(function(t){if(t.hasValue()){return e(t.value())}})};t.prototype.onValues=function(e){return this.onValue(function(t){return e.apply(null,t)})};t.prototype.onError=function(){var e;e=Y(arguments);return this.subscribe(function(t){if(t.isError()){return e(t.error)}})};t.prototype.onEnd=function(){var e;e=Y(arguments);return this.subscribe(function(t){if(t.isEnd()){return e()}})};t.prototype.errors=function(){return ut(this,"errors",this.filter(function(){return false}))};t.prototype.filter=function(){var t,n;n=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];return D(this,n,t,function(t){return ut(this,"filter",t,this.withHandler(function(n){if(n.filter(t)){return this.push(n)}else{return e.more}}))})};t.prototype.takeWhile=function(){var t,n;n=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];return D(this,n,t,function(t){return ut(this,"takeWhile",t,this.withHandler(function(n){if(n.filter(t)){return this.push(n)}else{this.push(I());return e.noMore}}))})};t.prototype.endOnError=function(){var e,t;t=arguments[0],e=2<=arguments.length?ft.call(arguments,1):[];if(t==null){t=true}return D(this,t,e,function(e){return ut(this,"endOnError",this.withHandler(function(t){if(t.isError()&&e(t.error)){this.push(t);return this.push(I())}else{return this.push(t)}}))})};t.prototype.take=function(t){if(t<=0){return e.never()}return ut(this,"take",t,this.withHandler(function(n){if(!n.hasValue()){return this.push(n)}else{t--;if(t>0){return this.push(n)}else{if(t===0){this.push(n)}this.push(I());return e.noMore}}}))};t.prototype.map=function(){var e,t;t=arguments[0],e=2<=arguments.length?ft.call(arguments,1):[];if(t instanceof _){return t.sampledBy(this,O)}else{return D(this,t,e,function(e){return ut(this,"map",e,this.withHandler(function(t){return this.push(t.fmap(e))}))})}};t.prototype.mapError=function(){var e;e=Y(arguments);return ut(this,"mapError",e,this.withHandler(function(t){if(t.isError()){return this.push($(e(t.error)))}else{return this.push(t)}}))};t.prototype.mapEnd=function(){var t;t=Y(arguments);return ut(this,"mapEnd",t,this.withHandler(function(n){if(n.isEnd()){this.push($(t(n)));this.push(I());return e.noMore}else{return this.push(n)}}))};t.prototype.doAction=function(){var e;e=Y(arguments);return ut(this,"doAction",e,this.withHandler(function(t){if(t.hasValue()){e(t.value())}return this.push(t)}))};t.prototype.skip=function(t){return ut(this,"skip",t,this.withHandler(function(n){if(!n.hasValue()){return this.push(n)}else if(t>0){t--;return e.more}else{return this.push(n)}}))};t.prototype.skipDuplicates=function(e){if(e==null){e=function(e,t){return e===t}}return ut(this,"skipDuplicates",this.withStateMachine(p,function(t,n){if(!n.hasValue()){return[t,[n]]}else if(n.isInitial()||t===p||!e(t.get(),n.value())){return[new v(n.value()),[n]]}else{return[t,[]]}}))};t.prototype.skipErrors=function(){return ut(this,"skipErrors",this.withHandler(function(t){if(t.isError()){return e.more}else{return this.push(t)}}))};t.prototype.withStateMachine=function(t,n){var i;i=t;return ut(this,"withStateMachine",t,n,this.withHandler(function(t){var r,a,o,s,l,u,c;r=n(i,t);a=r[0],s=r[1];i=a;l=e.more;for(u=0,c=s.length;u<c;u++){o=s[u];l=this.push(o);if(l===e.noMore){return l}}return l}))};t.prototype.scan=function(t,n){var i,r,a;n=it(n);i=st(t);a=function(t){return function(a){var o,s,l,u;o=false;u=X;s=e.more;l=function(){if(!o){return i.forEach(function(t){o=true;s=a(new h(function(){return t}));if(s===e.noMore){u();return u=X}})}};u=t.dispatcher.subscribe(function(t){var r,u;if(t.hasValue()){if(o&&t.isInitial()){return e.more}else{if(!t.isInitial()){l()}o=true;u=i.getOrElse(void 0);r=n(u,t.value());i=new v(r);return a(t.apply(function(){return r}))}}else{if(t.isEnd()){s=l()}if(s!==e.noMore){return a(t)}}});w.whenDoneWith(r,l);return u}}(this);return r=new _(V(this,"scan",t,n),a)};t.prototype.fold=function(e,t){return ut(this,"fold",e,t,this.scan(e,t).sampledBy(this.filter(false).mapEnd().toProperty()))};t.prototype.zip=function(t,n){if(n==null){n=Array}return ut(this,"zip",t,e.zipWith([this,t],n))};t.prototype.diff=function(e,t){t=it(t);return ut(this,"diff",e,t,this.scan([e],function(e,n){return[n,t(e[0],n)]}).filter(function(e){return e.length===2}).map(function(e){return e[1]}))};t.prototype.flatMap=function(){return F(this,J(arguments))};t.prototype.flatMapFirst=function(){return F(this,J(arguments),true)
};t.prototype.flatMapWithConcurrencyLimit=function(){var e,t;t=arguments[0],e=2<=arguments.length?ft.call(arguments,1):[];return ut.apply(null,[this,"flatMapWithConcurrencyLimit",t].concat(ft.call(e),[F(this,J(e),false,t)]))};t.prototype.flatMapLatest=function(){var e,t;e=J(arguments);t=this.toEventStream();return ut(this,"flatMapLatest",e,t.flatMap(function(n){return Q(e(n)).takeUntil(t)}))};t.prototype.flatMapError=function(t){return ut(this,"flatMapError",t,this.mapError(function(e){return new l(e)}).flatMap(function(n){if(n instanceof l){return t(n.error)}else{return e.once(n)}}))};t.prototype.flatMapConcat=function(){return ut.apply(null,[this,"flatMapConcat"].concat(ft.call(arguments),[this.flatMapWithConcurrencyLimit.apply(this,[1].concat(ft.call(arguments)))]))};t.prototype.bufferingThrottle=function(t){return ut(this,"bufferingThrottle",t,this.flatMapConcat(function(n){return e.once(n).concat(e.later(t).filter(false))}))};t.prototype.not=function(){return ut(this,"not",this.map(function(e){return!e}))};t.prototype.log=function(){var e;e=1<=arguments.length?ft.call(arguments,0):[];this.subscribe(function(t){return typeof console!=="undefined"&&console!==null?typeof console.log==="function"?console.log.apply(console,ft.call(e).concat([t.log()])):void 0:void 0});return this};t.prototype.slidingWindow=function(e,t){if(t==null){t=0}return ut(this,"slidingWindow",e,t,this.scan([],function(t,n){return t.concat([n]).slice(-e)}).filter(function(e){return e.length>=t}))};t.prototype.combine=function(t,n){var i;i=it(n);return ut(this,"combine",t,n,e.combineAsArray(this,t).map(function(e){return i(e[0],e[1])}))};t.prototype.decode=function(t){return ut(this,"decode",t,this.combine(e.combineTemplate(t),function(e,t){return t[e]}))};t.prototype.awaiting=function(t){return ut(this,"awaiting",t,e.groupSimultaneous(this,t).map(function(e){var t,n;t=e[0],n=e[1];return n.length===0}).toProperty(false).skipDuplicates())};t.prototype.name=function(e){this._name=e;return this};t.prototype.withDescription=function(){return V.apply(null,arguments).apply(this)};t.prototype.toString=function(){if(this._name){return this._name}else{return this.desc.toString()}};t.prototype.internalDeps=function(){return this.initialDesc.deps()};return t}();m.prototype.reduce=m.prototype.fold;m.prototype.assign=m.prototype.onValue;m.prototype.inspect=m.prototype.toString;F=function(t,n,r,a){var o,s,l;l=[t];o=[];s=new c(V(t,"flatMap"+(r?"First":""),n),function(s){var l,u,c,d,f;c=new i;d=[];f=function(t){var i;i=Q(n(t.value()));o.push(i);return c.add(function(t,n){return i.dispatcher.subscribe(function(r){var a;if(r.isEnd()){dt.remove(i,o);u();l(n);return e.noMore}else{if(r instanceof h){r=r.toNext()}a=s(r);if(a===e.noMore){t()}return a}})})};u=function(){var e;e=d.shift();if(e){return f(e)}};l=function(e){e();if(c.empty()){return s(I())}};c.add(function(n,i){return t.dispatcher.subscribe(function(t){if(t.isEnd()){return l(i)}else if(t.isError()){return s(t)}else if(r&&c.count()>1){return e.more}else{if(c.unsubscribed){return e.noMore}if(a&&c.count()>a){return d.push(t)}else{return f(t)}}})});return c.unsubscribe});s.internalDeps=function(){if(o.length){return l.concat(o)}else{return l}};return s};c=function(t){mt(n,t);function n(e,t,i){if(U(e)){i=t;t=e;e=[]}n.__super__.constructor.call(this,e);x(t);this.dispatcher=new o(t,i);tt(this)}n.prototype.delay=function(t){return ut(this,"delay",t,this.flatMap(function(n){return e.later(t,n)}))};n.prototype.debounce=function(t){return ut(this,"debounce",t,this.flatMapLatest(function(n){return e.later(t,n)}))};n.prototype.debounceImmediate=function(t){return ut(this,"debounceImmediate",t,this.flatMapFirst(function(n){return e.once(n).concat(e.later(t).filter(false))}))};n.prototype.throttle=function(e){return ut(this,"throttle",e,this.bufferWithTime(e).map(function(e){return e[e.length-1]}))};n.prototype.bufferWithTime=function(e){return ut(this,"bufferWithTime",e,this.bufferWithTimeOrCount(e,Number.MAX_VALUE))};n.prototype.bufferWithCount=function(e){return ut(this,"bufferWithCount",e,this.bufferWithTimeOrCount(void 0,e))};n.prototype.bufferWithTimeOrCount=function(e,t){var n;n=function(n){if(n.values.length===t){return n.flush()}else if(e!==void 0){return n.schedule()}};return ut(this,"bufferWithTimeOrCount",e,t,this.buffer(e,n,n))};n.prototype.buffer=function(t,n,i){var r,a,o;if(n==null){n=X}if(i==null){i=X}r={scheduled:false,end:void 0,values:[],flush:function(){var t;this.scheduled=false;if(this.values.length>0){t=this.push($(this.values));this.values=[];if(this.end!=null){return this.push(this.end)}else if(t!==e.noMore){return i(this)}}else{if(this.end!=null){return this.push(this.end)}}},schedule:function(){if(!this.scheduled){this.scheduled=true;return t(function(e){return function(){return e.flush()}}(this))}}};o=e.more;if(!U(t)){a=t;t=function(t){return e.scheduler.setTimeout(t,a)}}return ut(this,"buffer",this.withHandler(function(e){r.push=function(e){return function(t){return e.push(t)}}(this);if(e.isError()){o=this.push(e)}else if(e.isEnd()){r.end=e;if(!r.scheduled){r.flush()}}else{r.values.push(e.value());n(r)}return o}))};n.prototype.merge=function(t){var n;T(t);n=this;return ut(n,"merge",t,e.mergeAll(this,t))};n.prototype.toProperty=function(t){var n,i;i=arguments.length===0?p:st(function(){return t});n=this.dispatcher;return new _(V(this,"toProperty",t),function(t){var r,a,o,s;r=false;s=X;a=e.more;o=function(){if(!r){return i.forEach(function(n){r=true;a=t(new h(n));if(a===e.noMore){s();return s=X}})}};s=n.subscribe(function(n){if(n.hasValue()){if(r&&n.isInitial()){return e.more}else{if(!n.isInitial()){o()}r=true;i=new v(n);return t(n)}}else{if(n.isEnd()){a=o()}if(a!==e.noMore){return t(n)}}});o();return s})};n.prototype.toEventStream=function(){return this};n.prototype.sampledBy=function(e,t){return ut(this,"sampledBy",e,t,this.toProperty().sampledBy(e,t))};n.prototype.concat=function(e){var t;t=this;return new n(V(t,"concat",e),function(n){var i,r;r=X;i=t.dispatcher.subscribe(function(t){if(t.isEnd()){return r=e.dispatcher.subscribe(n)}else{return n(t)}});return function(){i();return r()}})};n.prototype.takeUntil=function(t){var n;n={};return ut(this,"takeUntil",t,e.groupSimultaneous(this.mapEnd(n),t.skipErrors()).withHandler(function(i){var r,a,o,s,l,u;if(!i.hasValue()){return this.push(i)}else{u=i.value(),r=u[0],t=u[1];if(t.length){return this.push(I())}else{a=e.more;for(s=0,l=r.length;s<l;s++){o=r[s];if(o===n){a=this.push(I())}else{a=this.push($(o))}}return a}}}))};n.prototype.skipUntil=function(e){var t;t=e.take(1).map(true).toProperty(false);return ut(this,"skipUntil",e,this.filter(t))};n.prototype.skipWhile=function(){var t,n,i;n=arguments[0],t=2<=arguments.length?ft.call(arguments,1):[];i=false;return D(this,n,t,function(t){return ut(this,"skipWhile",t,this.withHandler(function(n){if(i||!n.hasValue()||!t(n.value())){if(n.hasValue()){i=true}return this.push(n)}else{return e.more}}))})};n.prototype.holdWhen=function(t){var n,i,r;r=t.startWith(false);i=r.filter(function(e){return!e});n=r.filter(dt.id);return ut(this,"holdWhen",t,this.filter(false).merge(r.flatMapConcat(function(t){return function(r){if(!r){return t.takeUntil(n)}else{return t.scan([],function(e,t){return e.concat(t)}).sampledBy(i).take(1).flatMap(e.fromArray)}}}(this))))};n.prototype.startWith=function(t){return ut(this,"startWith",t,e.once(t).concat(this))};n.prototype.withHandler=function(e){return new n(V(this,"withHandler",e),this.dispatcher.subscribe,e)};return n}(m);_=function(t){mt(n,t);function n(e,t,i){if(U(e)){i=t;t=e;e=[]}n.__super__.constructor.call(this,e);x(t);this.dispatcher=new g(this,t,i);tt(this)}n.prototype.sampledBy=function(t,i){var r,a,o,s,l;if(i!=null){i=it(i)}else{r=true;i=function(e){return e.value()}}l=new y(this,false,r);o=new y(t,true,r);s=e.when([l,o],i);a=t instanceof n?s.toProperty():s;return ut(this,"sampledBy",t,i,a)};n.prototype.sample=function(t){return ut(this,"sample",t,this.sampledBy(e.interval(t,{})))};n.prototype.changes=function(){return new c(V(this,"changes"),function(e){return function(t){return e.dispatcher.subscribe(function(e){if(!e.isInitial()){return t(e)}})}}(this))};n.prototype.withHandler=function(e){return new n(V(this,"withHandler",e),this.dispatcher.subscribe,e)};n.prototype.toProperty=function(){k(arguments);return this};n.prototype.toEventStream=function(){return new c(V(this,"toEventStream"),function(e){return function(t){return e.dispatcher.subscribe(function(e){if(e.isInitial()){e=e.toNext()}return t(e)})}}(this))};n.prototype.and=function(e){return ut(this,"and",e,this.combine(e,function(e,t){return e&&t}))};n.prototype.or=function(e){return ut(this,"or",e,this.combine(e,function(e,t){return e||t}))};n.prototype.delay=function(e){return this.delayChanges("delay",e,function(t){return t.delay(e)})};n.prototype.debounce=function(e){return this.delayChanges("debounce",e,function(t){return t.debounce(e)})};n.prototype.throttle=function(e){return this.delayChanges("throttle",e,function(t){return t.throttle(e)})};n.prototype.delayChanges=function(){var e,t,n;e=2<=arguments.length?ft.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++];return ut.apply(null,[this].concat(ft.call(e),[b(this,t(this.changes()))]))};n.prototype.takeUntil=function(e){var t;t=this.changes().takeUntil(e);return ut(this,"takeUntil",e,b(this,t))};n.prototype.startWith=function(e){return ut(this,"startWith",e,this.scan(e,function(e,t){return t}))};n.prototype.bufferingThrottle=function(){var e;return(e=n.__super__.bufferingThrottle.apply(this,arguments)).bufferingThrottle.apply(e,arguments).toProperty()};return n}(m);D=function(e,t,n,i){var r;if(t instanceof _){r=t.sampledBy(e,function(e,t){return[e,t]});return i.call(r,function(e){var t,n;t=e[0],n=e[1];return t}).map(function(e){var t,n;t=e[0],n=e[1];return n})}else{t=z(t,n);return i.call(e,t)}};b=function(t,n){var i;i=new c(V(t,"justInitValue"),function(n){var r,a;a=void 0;r=t.dispatcher.subscribe(function(t){if(!t.isEnd()){a=t}return e.noMore});w.whenDoneWith(i,function(){if(a!=null){n(a)}return n(I())});return r});return i.concat(n).toProperty()};o=function(){function t(e,t){this._subscribe=e;this._handleEvent=t;this.subscribe=_t(this.subscribe,this);this.handleEvent=_t(this.handleEvent,this);this.subscriptions=[];this.queue=[];this.pushing=false;this.ended=false;this.prevError=void 0;this.unsubSrc=void 0}t.prototype.hasSubscribers=function(){return this.subscriptions.length>0};t.prototype.removeSub=function(e){return this.subscriptions=dt.without(e,this.subscriptions)};t.prototype.push=function(e){if(e.isEnd()){this.ended=true}return w.inTransaction(e,this,this.pushIt,[e])};t.prototype.pushToSubscriptions=function(t){var n,i,r,a,o,s;try{a=this.subscriptions;for(o=0,s=a.length;o<s;o++){r=a[o];i=r.sink(t);if(i===e.noMore||t.isEnd()){this.removeSub(r)}}return true}catch(l){n=l;this.pushing=false;this.queue=[];throw n}};t.prototype.pushIt=function(t){if(!this.pushing){if(t===this.prevError){return}if(t.isError()){this.prevError=t}this.pushing=true;this.pushToSubscriptions(t);this.pushing=false;while(this.queue.length){t=this.queue.shift();this.push(t)}if(this.hasSubscribers()){return e.more}else{this.unsubscribeFromSource();return e.noMore}}else{this.queue.push(t);return e.more}};t.prototype.handleEvent=function(e){if(this._handleEvent){return this._handleEvent(e)}else{return this.push(e)}};t.prototype.unsubscribeFromSource=function(){if(this.unsubSrc){this.unsubSrc()}return this.unsubSrc=void 0};t.prototype.subscribe=function(e){var t;if(this.ended){e(I());return X}else{x(e);t={sink:e};this.subscriptions.push(t);if(this.subscriptions.length===1){this.unsubSrc=this._subscribe(this.handleEvent);x(this.unsubSrc)}return function(e){return function(){e.removeSub(t);if(!e.hasSubscribers()){return e.unsubscribeFromSource()}}}(this)}};return t}();g=function(t){mt(n,t);function n(e,t,i){this.property=e;this.subscribe=_t(this.subscribe,this);n.__super__.constructor.call(this,t,i);this.current=p;this.currentValueRootId=void 0;this.propertyEnded=false}n.prototype.push=function(e){if(e.isEnd()){this.propertyEnded=true}if(e.hasValue()){this.current=new v(e);this.currentValueRootId=w.currentEventId()}return n.__super__.push.call(this,e)};n.prototype.maybeSubSource=function(t,n){if(n===e.noMore){return X}else if(this.propertyEnded){t(I());return X}else{return o.prototype.subscribe.call(this,t)}};n.prototype.subscribe=function(t){var n,i,r,a;i=false;r=e.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){n=w.currentEventId();a=this.currentValueRootId;if(!this.propertyEnded&&a&&n&&n!==a){w.whenDoneWith(this.property,function(e){return function(){if(e.currentValueRootId===a){return t(N(e.current.get().value()))}}}(this));return this.maybeSubSource(t,r)}else{w.inTransaction(void 0,this,function(){return r=t(N(this.current.get().value()))},[]);return this.maybeSubSource(t,r)}}else{return this.maybeSubSource(t,r)}};return n}(o);n=function(t){mt(n,t);function n(){this.guardedSink=_t(this.guardedSink,this);this.subscribeAll=_t(this.subscribeAll,this);this.unsubAll=_t(this.unsubAll,this);this.sink=void 0;this.subscriptions=[];this.ended=false;n.__super__.constructor.call(this,V(e,"Bus"),this.subscribeAll)}n.prototype.unsubAll=function(){var e,t,n,i;i=this.subscriptions;for(t=0,n=i.length;t<n;t++){e=i[t];if(typeof e.unsub==="function"){e.unsub()}}return void 0};n.prototype.subscribeAll=function(e){var t,n,i,r;this.sink=e;r=L(this.subscriptions);for(n=0,i=r.length;n<i;n++){t=r[n];this.subscribeInput(t)}return this.unsubAll};n.prototype.guardedSink=function(t){return function(n){return function(i){if(i.isEnd()){n.unsubscribeInput(t);return e.noMore}else{return n.sink(i)}}}(this)};n.prototype.subscribeInput=function(e){return e.unsub=e.input.dispatcher.subscribe(this.guardedSink(e.input))};n.prototype.unsubscribeInput=function(e){var t,n,i,r,a;a=this.subscriptions;for(t=i=0,r=a.length;i<r;t=++i){n=a[t];if(n.input===e){if(typeof n.unsub==="function"){n.unsub()}this.subscriptions.splice(t,1);return}}};n.prototype.plug=function(e){var t;if(this.ended){return}t={input:e};this.subscriptions.push(t);if(this.sink!=null){this.subscribeInput(t)}return function(t){return function(){return t.unsubscribeInput(e)}}(this)};n.prototype.end=function(){this.ended=true;this.unsubAll();return typeof this.sink==="function"?this.sink(I()):void 0};n.prototype.push=function(e){return typeof this.sink==="function"?this.sink($(e)):void 0};n.prototype.error=function(e){return typeof this.sink==="function"?this.sink(new l(e)):void 0};return n}(c);y=function(){function e(e,t,n){this.obs=e;this.sync=t;this.lazy=n!=null?n:false;this.queue=[]}e.prototype.subscribe=function(e){return this.obs.dispatcher.subscribe(e)};e.prototype.toString=function(){return this.obs.toString()};e.prototype.markEnded=function(){return this.ended=true};e.prototype.consume=function(){if(this.lazy){return{value:dt.always(this.queue[0])}}else{return this.queue[0]}};e.prototype.push=function(e){return this.queue=[e]};e.prototype.mayHave=function(){return true};e.prototype.hasAtLeast=function(){return this.queue.length};e.prototype.flatten=true;return e}();r=function(e){mt(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}t.prototype.consume=function(){return this.queue.shift()};t.prototype.push=function(e){return this.queue.push(e)};t.prototype.mayHave=function(e){return!this.ended||this.queue.length>=e};t.prototype.hasAtLeast=function(e){return this.queue.length>=e};t.prototype.flatten=false;return t}(y);t=function(e){mt(t,e);function t(e){t.__super__.constructor.call(this,e,true)}t.prototype.consume=function(){var e;e=this.queue;this.queue=[];return{value:function(){return e}}};t.prototype.push=function(e){return this.queue.push(e.value())};t.prototype.hasAtLeast=function(){return true};return t}(y);y.isTrigger=function(e){if(e instanceof y){return e.sync}else{return e instanceof c}};y.fromObservable=function(e){if(e instanceof y){return e}else if(e instanceof _){return new y(e,false)}else{return new r(e,true)}};V=function(){var e,t,n;t=arguments[0],n=arguments[1],e=3<=arguments.length?ft.call(arguments,2):[];if((t||n)instanceof a){return t||n}else{return new a(t,n,e)}};A=function(e){if(H(e)){return dt.flatMap(A,e)}else if(G(e)){return[e]}else if(e instanceof y){return[e.obs]}else{return[]}};a=function(){function e(e,t,n){this.context=e;this.method=t;this.args=n;this.cached=void 0}e.prototype.deps=function(){return this.cached||(this.cached=A([this.context].concat(this.args)))};e.prototype.apply=function(e){e.desc=this;return e};e.prototype.toString=function(){return dt.toString(this.context)+"."+dt.toString(this.method)+"("+dt.map(dt.toString,this.args)+")"};return e}();ut=function(){var e,t,n;e=2<=arguments.length?ft.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++];return V.apply(null,e).apply(t)};e.when=function(){var t,n,i,r,a,o,s,l,u,d,h,f,p,m,_,g,v,b,S,T;if(arguments.length===0){return e.never()}a=arguments.length;_="when: expecting arguments in the form (Observable+,function)+";C(_,a%2===0);p=[];u=[];n=0;d=[];while(n<a){d[n]=arguments[n];d[n+1]=arguments[n+1];l=dt.toArray(arguments[n]);t=arguments[n+1];s={f:U(t)?t:function(){return t},ixs:[]};m=false;for(g=0,b=l.length;g<b;g++){f=l[g];i=dt.indexOf(p,f);if(!m){m=y.isTrigger(f)}if(i<0){p.push(f);i=p.length-1}T=s.ixs;for(v=0,S=T.length;v<S;v++){r=T[v];if(r.index===i){r.count++}}s.ixs.push({index:i,count:1})}C("At least one EventStream required",m||!l.length);if(l.length>0){u.push(s)}n=n+2}if(!p.length){return e.never()}p=dt.map(y.fromObservable,p);o=dt.any(p,function(e){return e.flatten})&&E(dt.map(function(e){return e.obs},p));return h=new c(V.apply(null,[e,"when"].concat(ft.call(d))),function(t){var i,r,a,s,l,c,d;d=[];a=false;s=function(e){var t,i,r;r=e.ixs;for(t=0,i=r.length;t<i;t++){n=r[t];if(!p[n.index].hasAtLeast(n.count)){return false}}return true};r=function(e){return!e.sync||e.ended};i=function(e){var t,i,r;r=e.ixs;for(t=0,i=r.length;t<i;t++){n=r[t];if(!p[n.index].mayHave(n.count)){return true}}};l=function(e){return!e.source.flatten};c=function(c){return function(f){var m,_,g;_=function(){return w.whenDoneWith(h,m)};g=function(){var i,r,a,o,c,h;if(d.length>0){a=e.more;o=d.pop();for(c=0,h=u.length;c<h;c++){r=u[c];if(s(r)){i=function(){var e,t,i,a;i=r.ixs;a=[];for(e=0,t=i.length;e<t;e++){n=i[e];a.push(p[n.index].consume())}return a}();a=t(o.e.apply(function(){var e,t;t=function(){var t,n,r;r=[];for(t=0,n=i.length;t<n;t++){e=i[t];r.push(e.value())}return r}();return r.f.apply(r,t)}));if(d.length){d=dt.filter(l,d)}if(a===e.noMore){return a}else{return g()}}}}else{return e.more}};m=function(){var n;n=g();if(a){a=false;if(dt.all(p,r)||dt.all(u,i)){n=e.noMore;t(I())}}if(n===e.noMore){f()}return n};return c.subscribe(function(n){var i;if(n.isEnd()){a=true;c.markEnded();_()}else if(n.isError()){i=t(n)}else{c.push(n);if(c.sync){d.push({source:c,e:n});if(o||w.hasWaiters()){_()}else{m()}}}if(i===e.noMore){f()}return i||e.more})}};return B.apply(null,function(){var e,t,n;n=[];for(e=0,t=p.length;e<t;e++){f=p[e];n.push(c(f))}return n}())})};E=function(e,t){var n;if(t==null){t=[]}n=function(e){var i;if(dt.contains(t,e)){return true}else{i=e.internalDeps();if(i.length){t.push(e);return dt.any(i,n)}else{t.push(e);return false}}};return dt.any(e,n)};e.update=function(){var t,n,i,r;n=arguments[0],r=2<=arguments.length?ft.call(arguments,1):[];i=function(e){return function(){var t;t=1<=arguments.length?ft.call(arguments,0):[];return function(n){return e.apply(null,[n].concat(t))}}};t=r.length-1;while(t>0){if(!(r[t]instanceof Function)){r[t]=function(e){return function(){return e}}(r[t])}r[t]=i(r[t]);t=t-2}return ut.apply(null,[e,"update",n].concat(ft.call(r),[e.when.apply(e,r).scan(n,function(e,t){return t(e)})]))};B=function(){var e;e=1<=arguments.length?ft.call(arguments,0):[];return new i(e).unsubscribe};i=function(){function e(e){var t,n,i;if(e==null){e=[]}this.unsubscribe=_t(this.unsubscribe,this);this.unsubscribed=false;this.subscriptions=[];this.starting=[];for(n=0,i=e.length;n<i;n++){t=e[n];this.add(t)}}e.prototype.add=function(e){var t,n,i;if(this.unsubscribed){return}t=false;n=X;this.starting.push(e);i=function(i){return function(){if(i.unsubscribed){return}t=true;i.remove(n);return dt.remove(e,i.starting)}}(this);n=e(this.unsubscribe,i);if(!(this.unsubscribed||t)){this.subscriptions.push(n)}dt.remove(e,this.starting);return n};e.prototype.remove=function(e){if(this.unsubscribed){return}if(dt.remove(e,this.subscriptions)!==void 0){return e()}};e.prototype.unsubscribe=function(){var e,t,n,i;if(this.unsubscribed){return}this.unsubscribed=true;i=this.subscriptions;for(t=0,n=i.length;t<n;t++){e=i[t];e()}this.subscriptions=[];return this.starting=[]};e.prototype.count=function(){if(this.unsubscribed){return 0}return this.subscriptions.length+this.starting.length};e.prototype.empty=function(){return this.count()===0};return e}();e.CompositeUnsubscribe=i;v=function(){function e(e){this.value=e}e.prototype.getOrElse=function(){return this.value};e.prototype.get=function(){return this.value};e.prototype.filter=function(t){if(t(this.value)){return new e(this.value)}else{return p}};e.prototype.map=function(t){return new e(t(this.value))};e.prototype.forEach=function(e){return e(this.value)};e.prototype.isDefined=true;e.prototype.toArray=function(){return[this.value]};e.prototype.inspect=function(){return"Some("+this.value+")"};e.prototype.toString=function(){return this.inspect()};return e}();p={getOrElse:function(e){return e},filter:function(){return p},map:function(){return p},forEach:function(){},isDefined:false,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};w=function(){var t,n,i,r,a,o,s,l,u,c,d,h,f,p;c=void 0;d=[];h={};n=[];i=0;t=function(e){if(c){return n.push(e)}else{return e()}};f=function(e,t){var n;if(c){n=h[e.id];if(n==null){n=h[e.id]=[t];return d.push(e)}else{return n.push(t)}}else{return t()}};a=function(){while(d.length>0){s(0)}return void 0};s=function(e){var t,n,i,r,a,s;n=d[e];i=n.id;r=h[i];d.splice(e,1);delete h[i];o(n);for(a=0,s=r.length;a<s;a++){t=r[a];t()}return void 0};o=function(e){var t,n,i,r,a;n=e.internalDeps();for(r=0,a=n.length;r<a;r++){t=n[r];o(t);if(h[t.id]){i=dt.indexOf(d,t);s(i)}}return void 0};u=function(e,t,r,o){var s,l;if(c){return r.apply(t,o)}else{c=e;try{l=r.apply(t,o);a()}finally{c=void 0;while(i<n.length){s=n[i];i++;s()}i=0;n=[]}return l}};r=function(){if(c){return c.id}else{return void 0}};p=function(n,i){var r,a,o;o=false;r=function(){};a=function(){o=true;return r()};r=n.dispatcher.subscribe(function(n){return t(function(){var t;if(!o){t=i(n);if(t===e.noMore){return a()}}})});return a};l=function(){return d.length>0};return{whenDoneWith:f,hasWaiters:l,inTransaction:u,currentEventId:r,wrappedSubscribe:p}}();e.EventStream=c;e.Property=_;e.Observable=m;e.Bus=n;e.Initial=h;e.Next=f;e.End=s;e.Error=l;X=function(){};W=function(e,t){return t};O=function(e,t){return e};N=function(e){return new h(e,true)};$=function(e){return new f(e,true)};I=function(){return new s};rt=function(e){if(e instanceof u){return e}else{return $(e)}};L=function(e){return e.slice(0)};C=function(e,t){if(!t){throw new d(e)}};T=function(e){if(!(e instanceof c)){throw new d("not an EventStream : "+e)}};x=function(e){return C("not a function : "+e,U(e))};U=function(e){return typeof e==="function"};H=function(e){return e instanceof Array};G=function(e){return e instanceof m};S=function(e){if(!H(e)){throw new d("not an array : "+e)}};k=function(e){return C("no arguments supported",e.length===0)};M=function(e){if(typeof e!=="string"){throw new d("not a string : "+e)}};Z=function(e,t){return function(){var n;n=1<=arguments.length?ft.call(arguments,0):[];return e.apply(null,t.concat(n))}};J=function(e){if(e.length===1&&G(e[0])){return dt.always(e[0])}else{return Y(e)}};Y=function(e){e=Array.prototype.slice.call(e);return q.apply(null,e)};q=ct(function(){var e,t;t=arguments[0],e=2<=arguments.length?ft.call(arguments,1):[];if(U(t)){if(e.length){return Z(t,e)}else{return t}}else if(j(t)){return at(t,e)}else{return dt.always(t)}});z=function(e,t){return q.apply(null,[e].concat(ft.call(t)))};Q=function(t){if(G(t)){return t}else{return e.once(t)}};j=function(e){return typeof e==="string"&&e.length>1&&e.charAt(0)==="."};e.isFieldKey=j;at=function(e,t){var n,i;i=e.slice(1).split(".");n=dt.map(lt(t),i);return function(t){var i,r;for(i=0,r=n.length;i<r;i++){e=n[i];t=e(t)}return t}};lt=function(e){return function(t){return function(n){var i;if(n==null){return void 0}else{i=n[t];if(U(i)){return i.apply(n,e)}else{return i}}}}};ot=function(e){return e.slice(1)};it=function(e){var t;if(U(e)){return e}else if(j(e)){t=ot(e);return function(e,n){return e[t](n)}}else{return C("not a function or a field key: "+e,false)}};st=function(e){if(e instanceof v||e===p){return e}else{return new v(e)}};dt={indexOf:Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){var n,i,r,a;for(n=r=0,a=e.length;r<a;n=++r){i=e[n];if(t===i){return n}}return-1},indexWhere:function(e,t){var n,i,r,a;for(n=r=0,a=e.length;r<a;n=++r){i=e[n];if(t(i)){return n}}return-1},head:function(e){return e[0]},always:function(e){return function(){return e}},negate:function(e){return function(t){return!e(t)}},empty:function(e){return e.length===0},tail:function(e){return e.slice(1,e.length)},filter:function(e,t){var n,i,r,a;n=[];for(r=0,a=t.length;r<a;r++){i=t[r];if(e(i)){n.push(i)}}return n},map:function(e,t){var n,i,r,a;a=[];for(i=0,r=t.length;i<r;i++){n=t[i];a.push(e(n))}return a},each:function(e,t){var n,i;for(n in e){i=e[n];t(n,i)}return void 0},toArray:function(e){if(H(e)){return e}else{return[e]}},contains:function(e,t){return dt.indexOf(e,t)!==-1},id:function(e){return e},last:function(e){return e[e.length-1]},all:function(e,t){var n,i,r;if(t==null){t=dt.id}for(i=0,r=e.length;i<r;i++){n=e[i];if(!t(n)){return false}}return true},any:function(e,t){var n,i,r;if(t==null){t=dt.id}for(i=0,r=e.length;i<r;i++){n=e[i];if(t(n)){return true}}return false},without:function(e,t){return dt.filter(function(t){return t!==e},t)},remove:function(e,t){var n;n=dt.indexOf(t,e);if(n>=0){return t.splice(n,1)}},fold:function(e,t,n){var i,r,a;for(r=0,a=e.length;r<a;r++){i=e[r];t=n(t,i)}return t},flatMap:function(e,t){return dt.fold(t,[],function(t,n){return t.concat(e(n))})},cached:function(e){var t;t=p;return function(){if(t===p){t=e();e=void 0}return t}},toString:function(e){var t,n,i,r;try{et++;if(e==null){return"undefined"}else if(U(e)){return"function"}else if(H(e)){if(et>5){return"[..]"}return"["+dt.map(dt.toString,e).toString()+"]"}else if((e!=null?e.toString:void 0)!=null&&e.toString!==Object.prototype.toString){return e.toString()}else if(typeof e==="object"){if(et>5){return"{..}"}n=function(){var n;n=[];for(i in e){if(!pt.call(e,i))continue;r=function(){try{return e[i]}catch(n){t=n;return t}}();n.push(dt.toString(i)+":"+dt.toString(r))}return n}();return"{"+n+"}"}else{return e}}finally{et--}}};et=0;e._=dt;e.scheduler={setTimeout:function(e,t){return setTimeout(e,t)},setInterval:function(e,t){return setInterval(e,t)},clearInterval:function(e){return clearInterval(e)},now:function(){return(new Date).getTime()}};if(typeof define!=="undefined"&&define!==null&&define.amd!=null){define([],function(){return e});this.Bacon=e}else if(typeof module!=="undefined"&&module!==null&&module.exports!=null){module.exports=e;e.Bacon=e}else{this.Bacon=e}}).call(this);/*
 * jwerty - Awesome handling of keyboard events
 *
 * jwerty is a JS lib which allows you to bind, fire and assert key combination
 * strings against elements and events. It normalises the poor std api into
 * something easy to use and clear.
 *
 * This code is licensed under the MIT
 * For the full license see: http://keithamus.mit-license.org/
 * For more information see: http://keithamus.github.com/jwerty
 *
 * @author Keith Cirkel ('keithamus') <jwerty@keithcirkel.co.uk>
 * @license http://keithamus.mit-license.org/
 * @copyright Copyright © 2011, Keith Cirkel
 *
 */
(function(e,t){var n=e.document,i=e.jQuery||e.Zepto||e.ender||n,r,a,o,s="keydown";function l(e,t){return e===null?t==="null":e===undefined?t==="undefined":e.is&&e instanceof i?t==="element":Object.prototype.toString.call(e).toLowerCase().indexOf(t)>7}if(i===n){r=function(e,t){return e?i.querySelector(e,t||i):i};a=function(e,t){e.addEventListener(s,t,false)};o=function(e,t){var r=n.createEvent("Event"),a;r.initEvent(s,true,true);for(a in t)r[a]=t[a];return(e||i).dispatchEvent(r)}}else{r=function(e,t){return i(e||n,t)};a=function(e,t){i(e).bind(s+".jwerty",t)};o=function(e,t){i(e||n).trigger(i.Event(s,t))}}var u={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"};var c={mods:{"⇧":16,shift:16,"⌃":17,ctrl:17,"⌥":18,alt:18,option:18,"⌘":91,meta:91,cmd:91,"super":91,win:91},keys:{"⌫":8,backspace:8,"⇥":9,"⇆":9,tab:9,"↩":13,"return":13,enter:13,"⌅":13,pause:19,"pause-break":19,"⇪":20,caps:20,"caps-lock":20,"⎋":27,escape:27,esc:27,space:32,"↖":33,pgup:33,"page-up":33,"↘":34,pgdown:34,"page-down":34,"⇟":35,end:35,"⇞":36,home:36,ins:45,insert:45,del:46,"delete":46,"←":37,left:37,"arrow-left":37,"↑":38,up:38,"arrow-up":38,"→":39,right:39,"arrow-right":39,"↓":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"num-.":110,"num-period":110,"num-dot":110,"num-full-stop":110,"num-delete":110,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostraphe:222}};var d=47,h=0;while(++d<106){c.keys[h]=d;c.keys["num-"+h]=d+48;++h}d=111,h=1;while(++d<136){c.keys["f"+h]=d;++h}d=64;while(++d<91){c.keys[String.fromCharCode(d).toLowerCase()]=d}function f(e){var t,n,i,r,a,o,s,d,h;if(e instanceof f)return e;if(!l(e,"array")){e=String(e).replace(/\s/g,"").toLowerCase().match(/(?:\+,|[^,])+/g)}for(t=0,n=e.length;t<n;++t){if(!l(e[t],"array")){e[t]=String(e[t]).match(/(?:\+\/|[^\/])+/g)}o=[],i=e[t].length;while(i--){s=e[t][i];a={jwertyCombo:String(s),shiftKey:false,ctrlKey:false,altKey:false,metaKey:false};if(!l(s,"array")){s=String(s).toLowerCase().match(/(?:(?:[^\+])+|\+\+|^\+$)/g)}r=s.length;while(r--){if(s[r]==="++")s[r]="+";if(s[r]in c.mods){a[u[c.mods[s[r]]]]=true}else if(s[r]in c.keys){a.keyCode=c.keys[s[r]]}else{d=s[r].match(/^\[([^-]+\-?[^-]*)-([^-]+\-?[^-]*)\]$/)}}if(l(a.keyCode,"undefined")){if(d&&d[1]in c.keys&&d[2]in c.keys){d[2]=c.keys[d[2]];d[1]=c.keys[d[1]];for(h=d[1];h<d[2];++h){o.push({altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey,ctrlKey:a.ctrlKey,keyCode:h,jwertyCombo:String(s)})}a.keyCode=h}else{a.keyCode=0}}o.push(a)}this[t]=o}this.length=t;return this}var p=t.jwerty={event:function(e,t,n){if(l(t,"boolean")){var i=t;t=function(){return i}}e=new f(e);var r=0,a=e.length-1,o,s;return function(i){if(s=p.is(e,i,r)){if(r<a){++r;return}else{o=t.call(n||this,i,s);if(o===false)i.preventDefault();r=0;return}}r=p.is(e,i)?1:0}},is:function(e,t,n){e=new f(e);n=n||0;e=e[n];t=t.originalEvent||t;var i=e.length,r=false;while(i--){r=e[i].jwertyCombo;for(var a in e[i]){if(a!=="jwertyCombo"&&t[a]!=e[i][a])r=false}if(r!==false)return r}return r},key:function(t,n,i,o,s){var u=l(i,"element")||l(i,"string")?i:o,c=u===i?e:i,d=u===i?o:s;a(l(u,"element")?u:r(u,d),p.event(t,n,c))},fire:function(e,t,n,i){e=new f(e);var a=l(n,"number")?n:i;o(l(t,"element")?t:r(t,n),e[a||0][0])},KEYS:c}})(this,typeof module!=="undefined"&&module.exports?module.exports:this);(function(){var e,t,n,i,r,a={}.hasOwnProperty,o=function(e,t){function n(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},s=this;this.Stripe=function(){function e(){}return e.version=2,e.endpoint="https://api.stripe.com/v1",e.setPublishableKey=function(t){e.key=t},e.complete=function(t){return function(n,i,r){var a;if(n!=="success")return a=Math.round((new Date).getTime()/1e3),(new Image).src="https://q.stripe.com?event=stripejs-error&type="+n+"&key="+e.key+"&timestamp="+a,typeof t=="function"?t(500,{error:{code:n,type:n,message:"An unexpected error has occurred submitting your credit\ncard to our secure credit card processor. This may be\ndue to network connectivity issues, so you should try\nagain (you won't be charged twice). If this problem\npersists, please let us know!"}}):void 0}},e}.call(this),e=this.Stripe,this.Stripe.token=function(){function t(){}return t.validate=function(e,t){if(!e)throw t+" required";if(typeof e!="object")throw t+" invalid"},t.formatData=function(t,n){return e.utils.isElement(t)&&(t=e.utils.paramsFromForm(t,n)),e.utils.underscoreKeys(t),t},t.create=function(t,n){return t.key||(t.key=e.key||e.publishableKey),e.utils.validateKey(t.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens",data:t,method:"POST",success:function(e,t){return typeof n=="function"?n(t,e):void 0},complete:e.complete(n),timeout:4e4})},t.get=function(t,n){if(!t)throw"token required";return e.utils.validateKey(e.key),e.ajaxJSONP({url:""+e.endpoint+"/tokens/"+t,data:{key:e.key},success:function(e,t){return typeof n=="function"?n(t,e):void 0},complete:e.complete(n),timeout:4e4})},t}.call(this),this.Stripe.card=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.tokenName="card",n.whitelistedAttrs=["number","cvc","exp_month","exp_year","name","address_line1","address_line2","address_city","address_state","address_zip","address_country"],n.createToken=function(t,i,r){var a;return i==null&&(i={}),e.token.validate(t,"card"),typeof i=="function"?(r=i,i={}):typeof i!="object"&&(a=parseInt(i,10),i={},a>0&&(i.amount=a)),i[n.tokenName]=e.token.formatData(t,n.whitelistedAttrs),e.token.create(i,r)},n.getToken=function(t,n){return e.token.get(t,n)},n.validateCardNumber=function(e){return e=(e+"").replace(/\s+|-/g,""),e.length>=10&&e.length<=16&&n.luhnCheck(e)},n.validateCVC=function(t){return t=e.utils.trim(t),/^\d+$/.test(t)&&t.length>=3&&t.length<=4},n.validateExpiry=function(t,n){var i,r;return t=e.utils.trim(t),n=e.utils.trim(n),/^\d+$/.test(t)?/^\d+$/.test(n)?parseInt(t,10)<=12?(r=new Date(n,t),i=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>i):!1:!1:!1},n.luhnCheck=function(e){var t,n,i,r,a,o;i=!0,r=0,n=(e+"").split("").reverse();for(a=0,o=n.length;a<o;a++){t=n[a],t=parseInt(t,10);if(i=!i)t*=2;t>9&&(t-=9),r+=t}return r%10===0},n.cardType=function(e){return n.cardTypes[e.slice(0,2)]||"Unknown"},n.cardTypes=function(){var e,t,n,i;t={};for(e=n=40;n<=49;e=++n)t[e]="Visa";for(e=i=50;i<=59;e=++i)t[e]="MasterCard";return t[34]=t[37]="American Express",t[60]=t[62]=t[64]=t[65]="Discover",t[35]="JCB",t[30]=t[36]=t[38]=t[39]="Diners Club",t}(),n}.call(this,this.Stripe.token),this.Stripe.bankAccount=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.tokenName="bank_account",n.whitelistedAttrs=["country","routing_number","account_number"],n.createToken=function(t,i,r){return i==null&&(i={}),e.token.validate(t,"bank account"),typeof i=="function"&&(r=i,i={}),i[n.tokenName]=e.token.formatData(t,n.whitelistedAttrs),e.token.create(i,r)},n.getToken=function(t,n){return e.token.get(t,n)},n.validateRoutingNumber=function(t,i){t=e.utils.trim(t);switch(i){case"US":return/^\d+$/.test(t)&&t.length===9&&n.routingChecksum(t);case"CA":return/\d{5}\-\d{3}/.test(t)&&t.length===9;default:return!0}},n.validateAccountNumber=function(t,n){t=e.utils.trim(t);switch(n){case"US":return/^\d+$/.test(t)&&t.length>=1&&t.length<=17;default:return!0}},n.routingChecksum=function(e){var t,n,i,r,a,o;i=0,t=(e+"").split(""),o=[0,3,6];for(r=0,a=o.length;r<a;r++)n=o[r],i+=parseInt(t[n])*3,i+=parseInt(t[n+1])*7,i+=parseInt(t[n+2]);return i!==0&&i%10===0},n}.call(this,this.Stripe.token),t=["createToken","getToken","cardType","validateExpiry","validateCVC","validateCardNumber"];for(i=0,r=t.length;i<r;i++)n=t[i],this.Stripe[n]=this.Stripe.card[n];typeof module!="undefined"&&module!==null&&(module.exports=this.Stripe),typeof define=="function"&&define("stripe",[],function(){return s.Stripe})}).call(this),function(){var e,t,n,i=[].slice;e=encodeURIComponent,t=(new Date).getTime(),n=function(t,i,r){var a,o;i==null&&(i=[]);for(a in t)o=t[a],r&&(a=""+r+"["+a+"]"),typeof o=="object"?n(o,i,a):i.push(""+a+"="+e(o));return i.join("&").replace(/%20/g,"+")},this.Stripe.ajaxJSONP=function(e){var r,a,o,s,l,u;return e==null&&(e={}),o="sjsonp"+ ++t,l=document.createElement("script"),a=null,r=function(t){var n;return t==null&&(t="abort"),clearTimeout(a),(n=l.parentNode)!=null&&n.removeChild(l),o in window&&(window[o]=function(){}),typeof e.complete=="function"?e.complete(t,u,e):void 0},u={abort:r},l.onerror=function(){return u.abort(),typeof e.error=="function"?e.error(u,e):void 0},window[o]=function(){var t;t=1<=arguments.length?i.call(arguments,0):[],clearTimeout(a),l.parentNode.removeChild(l);try{delete window[o]}catch(n){window[o]=void 0}return typeof e.success=="function"&&e.success.apply(e,t),typeof e.complete=="function"?e.complete("success",u,e):void 0},e.data||(e.data={}),e.data.callback=o,e.method&&(e.data._method=e.method),l.src=e.url+"?"+n(e.data),s=document.getElementsByTagName("head")[0],s.appendChild(l),e.timeout>0&&(a=setTimeout(function(){return u.abort("timeout")},e.timeout)),u}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.utils=function(){function t(){}return t.trim=function(e){return(e+"").replace(/^\s+|\s+$/g,"")},t.underscore=function(e){return(e+"").replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()}).replace(/-/g,"_")},t.underscoreKeys=function(e){var t,n,i;i=[];for(t in e)n=e[t],delete e[t],i.push(e[this.underscore(t)]=n);return i},t.isElement=function(e){return typeof e!="object"?!1:typeof jQuery!="undefined"&&jQuery!==null&&e instanceof jQuery?!0:e.nodeType===1},t.paramsFromForm=function(t,n){var i,r,a,o,s,l,u,c,d,h;n==null&&(n=[]),typeof jQuery!="undefined"&&jQuery!==null&&t instanceof jQuery&&(t=t[0]),a=t.getElementsByTagName("input"),s=t.getElementsByTagName("select"),l={};for(u=0,d=a.length;u<d;u++){r=a[u],i=this.underscore(r.getAttribute("data-stripe"));if(e.call(n,i)<0)continue;l[i]=r.value}for(c=0,h=s.length;c<h;c++){o=s[c],i=this.underscore(o.getAttribute("data-stripe"));if(e.call(n,i)<0)continue;o.selectedIndex!=null&&(l[i]=o.options[o.selectedIndex].value)}return l},t.validateKey=function(e){if(!e||typeof e!="string")throw new Error("You did not set a valid publishable key. Call Stripe.setPublishableKey() with your publishable key. For more info, see https://stripe.com/docs/stripe.js");if(/\s/g.test(e))throw new Error("Your key is invalid, as it contains whitespace. For more info, see https://stripe.com/docs/stripe.js");if(/^sk_/.test(e))throw new Error("You are using a secret key with Stripe.js, instead of the publishable one. For more info, see https://stripe.com/docs/stripe.js")},t}()}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.Stripe.validator={"boolean":function(e,t){if(t!=="true"&&t!=="false")return"Enter a boolean string (true or false)"},integer:function(e,t){if(!/^\d+$/.test(t))return"Enter an integer"},positive:function(e,t){if(!(!this.integer(e,t)&&parseInt(t,10)>0))return"Enter a positive value"},range:function(t,n){var i;if(i=parseInt(n,10),e.call(t,i)<0)return"Needs to be between "+t[0]+" and "+t[t.length-1]},required:function(e,t){if(e&&(t==null||t===""))return"Required"},year:function(e,t){if(!/^\d{4}$/.test(t))return"Enter a 4-digit year"},birthYear:function(e,t){var n;n=this.year(e,t);if(n)return n;if(parseInt(t,10)>2e3)return"You must be over 18";if(parseInt(t,10)<1900)return"Enter your birth year"},month:function(e,t){if(this.integer(e,t))return"Please enter a month";if(this.range([1,2,3,4,5,6,7,8,9,10,11,12],t))return"Needs to be between 1 and 12"},choices:function(t,n){if(e.call(t,n)<0)return"Not an acceptable value for this field"},email:function(e,t){if(!/^[^@<\s>]+@[^@<\s>]+$/.test(t))return"That doesn't look like an email address"},url:function(e,t){if(!/^https?:\/\/.+\..+/.test(t))return"Not a valid url"},usTaxID:function(e,t){if(!/^\d{2}-?\d{1}-?\d{2}-?\d{4}$/.test(t))return"Not a valid tax ID"},ein:function(e,t){if(!/^\d{2}-?\d{7}$/.test(t))return"Not a valid EIN"},ssnLast4:function(e,t){if(!/^\d{4}$/.test(t))return"Not a valid last 4 digits for an SSN"},ownerPersonalID:function(e,t){var n;n=function(){switch(e){case"CA":return/^\d{3}-?\d{3}-?\d{3}$/.test(t);case"US":return!0}}();if(!n)return"Not a valid ID"},bizTaxID:function(e,t){var n,i,r,a,o,s,l,u;s={CA:["Tax ID",[/^\d{9}$/]],US:["EIN",[/^\d{2}-?\d{7}$/]]},o=s[e];if(o!=null){n=o[0],a=o[1],i=!1;for(l=0,u=a.length;l<u;l++){r=a[l];if(r.test(t)){i=!0;break}}if(!i)return"Not a valid "+n}},zip:function(e,t){var n;n=function(){switch(e.toUpperCase()){case"CA":return/^[\d\w]{6}$/.test(t!=null?t.replace(/\s+/g,""):void 0);case"US":return/^\d{5}$/.test(t)||/^\d{9}$/.test(t)}}();if(!n)return"Not a valid zip"},bankAccountNumber:function(e,t){if(!/^\d{1,17}$/.test(t))return"Invalid bank account number"},usRoutingNumber:function(e){var t,n,i,r,a,o,s;if(!/^\d{9}$/.test(e))return"Routing number must have 9 digits";a=0;for(t=o=0,s=e.length-1;o<=s;t=o+=3)n=parseInt(e.charAt(t),10)*3,i=parseInt(e.charAt(t+1),10)*7,r=parseInt(e.charAt(t+2),10),a+=n+i+r;if(a===0||a%10!==0)return"Invalid routing number"},caRoutingNumber:function(e){if(!/^\d{5}\-\d{3}$/.test(e))return"Invalid transit number"},routingNumber:function(e,t){switch(e.toUpperCase()){case"CA":return this.caRoutingNumber(t);case"US":return this.usRoutingNumber(t)}},phoneNumber:function(e,t){var n;n=t.replace(/[^0-9]/g,"");if(n.length!==10)return"Invalid phone number"},bizDBA:function(e,t){if(!/^.{1,23}$/.test(t))return"Statement descriptors can only have up to 23 characters"},nameLength:function(e,t){if(t.length===1)return"Names need to be longer than one character"}}}.call(this);/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.14
 */
(function(){"use strict";function e(e,t){for(var n=0,i=e.length;n<i;n++){if(e[n]===t){return n}}return-1}function t(e){var t=e._promiseCallbacks;if(!t){t=e._promiseCallbacks={}}return t}var n={mixin:function(e){e.on=this.on;e.off=this.off;e.trigger=this.trigger;e._promiseCallbacks=undefined;return e},on:function(n,i){var r=t(this),a;a=r[n];if(!a){a=r[n]=[]}if(e(a,i)===-1){a.push(i)}},off:function(n,i){var r=t(this),a,o;if(!i){r[n]=[];return}a=r[n];o=e(a,i);if(o!==-1){a.splice(o,1)}},trigger:function(e,n){var i=t(this),r,a;if(r=i[e]){for(var o=0;o<r.length;o++){a=r[o];a(n)}}}};var i={instrument:false};n.mixin(i);function r(e,t){if(e==="onerror"){i.on("error",t);return}if(arguments.length===2){i[e]=t}else{return i[e]}}function a(e){return typeof e==="function"||typeof e==="object"&&e!==null}function o(e){return typeof e==="function"}function s(e){return typeof e==="object"&&e!==null}var l;if(!Array.isArray){l=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{l=Array.isArray}var u=l;var c=Date.now||function(){return(new Date).getTime()};function d(){}var h=Object.create||function(e){if(arguments.length>1){throw new Error("Second argument not supported")}if(typeof e!=="object"){throw new TypeError("Argument must be an object")}d.prototype=e;return new d};var f=[];var p=function jt(e,t,n){if(1===f.push({name:e,payload:{guid:t._guidKey+t._id,eventName:e,detail:t._result,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:c(),stack:new Error(t._label).stack}})){setTimeout(function(){var e;for(var t=0;t<f.length;t++){e=f[t];i.trigger(e.name,e.payload)}f.length=0},50)}};function m(){}var _=void 0;var g=1;var v=2;var y=new D;function w(e){try{return e.then}catch(t){y.error=t;return y}}function b(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function C(e,t,n){i.async(function(e){var i=false;var r=b(n,t,function(n){if(i){return}i=true;if(t!==n){x(e,n)}else{M(e,n)}},function(t){if(i){return}i=true;L(e,t)},"Settle: "+(e._label||" unknown promise"));if(!i&&r){i=true;L(e,r)}},e)}function S(e,t){if(t._state===g){M(e,t._result)}else if(e._state===v){L(e,t._result)}else{B(t,undefined,function(n){if(t!==n){x(e,n)}else{M(e,n)}},function(t){L(e,t)})}}function T(e,t){if(t.constructor===e.constructor){S(e,t)}else{var n=w(t);if(n===y){L(e,y.error)}else if(n===undefined){M(e,t)}else if(o(n)){C(e,t,n)}else{M(e,t)}}}function x(e,t){if(e===t){M(e,t)}else if(a(t)){T(e,t)}else{M(e,t)}}function k(e){if(e._onerror){e._onerror(e._result)}E(e)}function M(e,t){if(e._state!==_){return}e._result=t;e._state=g;if(e._subscribers.length===0){if(i.instrument){p("fulfilled",e)}}else{i.async(E,e)}}function L(e,t){if(e._state!==_){return}e._state=v;e._result=t;i.async(k,e)}function B(e,t,n,r){var a=e._subscribers;var o=a.length;e._onerror=null;a[o]=t;a[o+g]=n;a[o+v]=r;if(o===0&&e._state){i.async(E,e)}}function E(e){var t=e._subscribers;var n=e._state;if(i.instrument){p(n===g?"fulfilled":"rejected",e)}if(t.length===0){return}var r,a,o=e._result;for(var s=0;s<t.length;s+=3){r=t[s];a=t[s+n];if(r){P(n,r,a,o)}else{a(o)}}e._subscribers.length=0}function D(){this.error=null}var V=new D;function I(e,t){try{return e(t)}catch(n){V.error=n;return V}}function P(e,t,n,i){var r=o(n),a,s,l,u;if(r){a=I(n,i);if(a===V){u=true;s=a.error;a=null}else{l=true}if(t===a){L(t,new TypeError("A promises callback cannot return that same promise."));return}}else{a=i;l=true}if(t._state!==_){}else if(r&&l){x(t,a)}else if(u){L(t,s)}else if(e===g){M(t,a)}else if(e===v){L(t,a)}}function A(e,t){try{t(function i(t){x(e,t)},function r(t){L(e,t)})}catch(n){L(e,n)}}function F(e,t,n){if(e===g){return{state:"fulfilled",value:n}}else{return{state:"rejected",reason:n}}}function O(e,t,n,i){this._instanceConstructor=e;this.promise=new e(m,i);this._abortOnReject=n;if(this._validateInput(t)){this._input=t;this.length=t.length;this._remaining=t.length;this._init();if(this.length===0){M(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){M(this.promise,this._result)}}}else{L(this.promise,this._validationError())}}O.prototype._validateInput=function(e){return u(e)};O.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};O.prototype._init=function(){this._result=new Array(this.length)};var R=O;O.prototype._enumerate=function(){var e=this.length;var t=this.promise;var n=this._input;for(var i=0;t._state===_&&i<e;i++){this._eachEntry(n[i],i)}};O.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;if(s(e)){if(e.constructor===n&&e._state!==_){e._onerror=null;this._settledAt(e._state,t,e._result)}else{this._willSettleAt(n.resolve(e),t)}}else{this._remaining--;this._result[t]=this._makeResult(g,t,e)}};O.prototype._settledAt=function(e,t,n){var i=this.promise;if(i._state===_){this._remaining--;if(this._abortOnReject&&e===v){L(i,n)}else{this._result[t]=this._makeResult(e,t,n)}}if(this._remaining===0){M(i,this._result)}};O.prototype._makeResult=function(e,t,n){return n};O.prototype._willSettleAt=function(e,t){var n=this;B(e,undefined,function(e){n._settledAt(g,t,e)},function(e){n._settledAt(v,t,e)})};var N=function Ut(e,t){return new R(this,e,true,t).promise};var H=function Gt(e,t){var n=this;var i=new n(m,t);if(!u(e)){L(i,new TypeError("You must pass an array to race."));return i}var r=e.length;function a(e){x(i,e)}function o(e){L(i,e)}for(var s=0;i._state===_&&s<r;s++){B(n.resolve(e[s]),undefined,a,o)}return i};var j=function Wt(e,t){var n=this;if(e&&typeof e==="object"&&e.constructor===n){return e}var i=new n(m,t);x(i,e);return i};var U=function Kt(e,t){var n=this;var i=new n(m,t);L(i,e);return i};var G="rsvp_"+c()+"-";var W=0;function K(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Y=q;function q(e,t){this._id=W++;this._label=t;this._state=undefined;this._result=undefined;this._subscribers=[];if(i.instrument){p("created",this)}if(m!==e){if(!o(e)){K()}if(!(this instanceof q)){z()}A(this,e)}}q.cast=j;q.all=N;q.race=H;q.resolve=j;q.reject=U;q.prototype={constructor:q,_guidKey:G,_onerror:function(e){i.trigger("error",e)},then:function(e,t,n){var r=this;var a=r._state;if(a===g&&!e||a===v&&!t){if(i.instrument){p("chained",this,this)}return this}r._onerror=null;var o=new this.constructor(m,n);var s=r._result;if(i.instrument){p("chained",r,o)}if(a){var l=arguments[a-1];i.async(function(){P(a,o,l,s)})}else{B(r,o,e,t)}return o},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}};function Q(){this.value=undefined}var J=new Q;var $=new Q;function X(e){try{return e.then}catch(t){J.value=t;return J}}function Z(e,t,n){try{e.apply(t,n)}catch(i){J.value=i;return J}}function et(e,t){var n={};var i;var r;var a=e.length;var o=new Array(a);for(var s=0;s<a;s++){o[s]=e[s]}for(r=0;r<t.length;r++){i=t[r];n[i]=o[r+1]}return n}function tt(e){var t=e.length;var n=new Array(t-1);for(var i=1;i<t;i++){n[i-1]=e[i]}return n}function nt(e,t){return{then:function(n,i){return e.call(t,n,i)}}}var it=function zt(e,t){var n=function(){var n=this;var i=arguments.length;var r=new Array(i+1);var a;var o=false;for(var s=0;s<i;++s){a=arguments[s];if(!o){o=ot(a);if(o===$){var l=new Y(m);L(l,$.value);return l}else if(o&&o!==true){a=nt(o,a)}}r[s]=a}var c=new Y(m);r[i]=function(e,n){if(e)L(c,e);else if(t===undefined)x(c,n);else if(t===true)x(c,tt(arguments));else if(u(t))x(c,et(arguments,t));else x(c,n)};if(o){return at(c,r,e,n)}else{return rt(c,r,e,n)}};n.__proto__=e;return n};function rt(e,t,n,i){var r=Z(n,i,t);if(r===J){L(e,r.value)}return e}function at(e,t,n,i){return Y.all(t).then(function(t){var r=Z(n,i,t);if(r===J){L(e,r.value)}return e})}function ot(e){if(e&&typeof e==="object"){if(e.constructor===Y){return true}else{return X(e)}}else{return false}}var st=function Yt(e,t){return Y.all(e,t)};function lt(e,t,n){this._superConstructor(e,t,false,n)}lt.prototype=h(R.prototype);lt.prototype._superConstructor=R;lt.prototype._makeResult=F;lt.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var ut=function qt(e,t){return new lt(Y,e,t).promise};var ct=function Qt(e,t){return Y.race(e,t)};function dt(e,t,n){this._superConstructor(e,t,true,n)}var ht=dt;dt.prototype=h(R.prototype);dt.prototype._superConstructor=R;dt.prototype._init=function(){this._result={}};dt.prototype._validateInput=function(e){return e&&typeof e==="object"};dt.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")};dt.prototype._enumerate=function(){var e=this.promise;var t=this._input;var n=[];for(var i in t){if(e._state===_&&t.hasOwnProperty(i)){n.push({position:i,entry:t[i]})}}var r=n.length;this._remaining=r;var a;for(var o=0;e._state===_&&o<r;o++){a=n[o];this._eachEntry(a.entry,a.position)}};var ft=function Jt(e,t){return new ht(Y,e,t).promise};function pt(e,t,n){this._superConstructor(e,t,false,n)}pt.prototype=h(ht.prototype);pt.prototype._superConstructor=R;pt.prototype._makeResult=F;pt.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var mt=function $t(e,t){return new pt(Y,e,t).promise};var _t=function Xt(e){setTimeout(function(){throw e});throw e};var gt=function Zt(e){var t={};t.promise=new Y(function(e,n){t.resolve=e;t.reject=n},e);return t};var vt=function en(e,t,n){return Y.all(e,n).then(function(e){if(!o(t)){throw new TypeError("You must pass a function as map's second argument.")}var i=e.length;var r=new Array(i);for(var a=0;a<i;a++){r[a]=t(e[a])}return Y.all(r,n)})};var yt=function tn(e,t){return Y.resolve(e,t)};var wt=function nn(e,t){return Y.reject(e,t)};var bt=function rn(e,t,n){return Y.all(e,n).then(function(e){if(!o(t)){throw new TypeError("You must pass a function as filter's second argument.")}var i=e.length;var r=new Array(i);for(var a=0;a<i;a++){r[a]=t(e[a])}return Y.all(r,n).then(function(t){var n=new Array(i);var r=0;for(var a=0;a<i;a++){if(t[a]){n[r]=e[a];r++}}n.length=r;return n})})};var Ct=0;var St=function an(e,t){Dt[Ct]=e;Dt[Ct+1]=t;Ct+=2;if(Ct===2){It()}};var Tt=typeof window!=="undefined"?window:{};var xt=Tt.MutationObserver||Tt.WebKitMutationObserver;var kt=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function Mt(){return function(){process.nextTick(Vt)}}function Lt(){var e=0;var t=new xt(Vt);var n=document.createTextNode("");t.observe(n,{characterData:true});return function(){n.data=e=++e%2}}function Bt(){var e=new MessageChannel;e.port1.onmessage=Vt;return function(){e.port2.postMessage(0)}}function Et(){return function(){setTimeout(Vt,1)}}var Dt=new Array(1e3);function Vt(){for(var e=0;e<Ct;e+=2){var t=Dt[e];var n=Dt[e+1];t(n);Dt[e]=undefined;Dt[e+1]=undefined}Ct=0}var It;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){It=Mt()}else if(xt){It=Lt()}else if(kt){It=Bt()}else{It=Et()}i.async=St;var Pt=yt;function At(e,t){i.async(e,t)}function Ft(){i.on.apply(i,arguments)}function Ot(){i.off.apply(i,arguments)}if(typeof window!=="undefined"&&typeof window["__PROMISE_INSTRUMENTATION__"]==="object"){var Rt=window["__PROMISE_INSTRUMENTATION__"];r("instrument",true);for(var Nt in Rt){if(Rt.hasOwnProperty(Nt)){Ft(Nt,Rt[Nt])}}}var Ht={race:ct,Promise:Y,allSettled:ut,hash:ft,hashSettled:mt,denodeify:it,on:Ft,off:Ot,map:vt,filter:bt,resolve:yt,reject:wt,all:st,rethrow:_t,defer:gt,EventTarget:n,configure:r,async:At};if(typeof define==="function"&&define.amd){define(function(){return Ht})}else if(typeof module!=="undefined"&&module.exports){module.exports=Ht}else if(typeof this!=="undefined"){this["RSVP"]=Ht}}).call(this);(function(){var e=void 0,t=!0,n=null,i=!1,r=["aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,snow,springgreen,steelblue,tan,teal,thistle,tomato,transparent,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen".split(","),"all-scroll,col-resize,crosshair,default,e-resize,hand,help,move,n-resize,ne-resize,no-drop,not-allowed,nw-resize,pointer,progress,row-resize,s-resize,se-resize,sw-resize,text,vertical-text,w-resize,wait".split(","),"armenian,decimal,decimal-leading-zero,disc,georgian,lower-alpha,lower-greek,lower-latin,lower-roman,square,upper-alpha,upper-latin,upper-roman".split(","),"100,200,300,400,500,600,700,800,900,bold,bolder,lighter".split(","),"block-level,inline-level,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group".split(","),"condensed,expanded,extra-condensed,extra-expanded,narrower,semi-condensed,semi-expanded,ultra-condensed,ultra-expanded,wider".split(","),"inherit,inline,inline-block,inline-box,inline-flex,inline-grid,inline-list-item,inline-stack,inline-table,run-in".split(","),"behind,center-left,center-right,far-left,far-right,left-side,leftwards,right-side,rightwards".split(","),"large,larger,small,smaller,x-large,x-small,xx-large,xx-small".split(","),"dashed,dotted,double,groove,outset,ridge,solid".split(","),"ease,ease-in,ease-in-out,ease-out,linear,step-end,step-start".split(","),"at,closest-corner,closest-side,ellipse,farthest-corner,farthest-side".split(","),"baseline,middle,sub,super,text-bottom,text-top".split(","),"caption,icon,menu,message-box,small-caption,status-bar".split(","),"fast,faster,slow,slower,x-fast,x-slow".split(","),["above","below","higher","level","lower"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["block","flex","grid","table"],["high","low","x-high","x-low"],["nowrap","pre","pre-line","pre-wrap"],["absolute","relative","static"],["alternate","alternate-reverse","reverse"],["border-box","content-box","padding-box"],["capitalize","lowercase","uppercase"],["child","female","male"],["=","opacity"],["backwards","forwards"],["bidi-override","embed"],["bottom","top"],["break-all","keep-all"],["clip","ellipsis"],["contain","cover"],["continuous","digits"],["end","start"],["flat","preserve-3d"],["hide","show"],["horizontal","vertical"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["paused","running"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["all"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["circle"],["code"],["collapse"],["contents"],["fixed"],["hidden"],["infinite"],["inset"],["invert"],["justify"],["list-item"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["to"],["visible"]],a={animation:{cssPropBits:517,cssLitGroup:[r[10],r[24],r[29],r[45],r[48],r[54],r[63],r[71],r[72]],cssFns:["cubic-bezier()","steps()"]},"animation-delay":{cssPropBits:5,cssLitGroup:[r[48]],cssFns:[]},"animation-direction":{cssPropBits:0,cssLitGroup:[r[24],r[48],r[72]],cssFns:[]},"animation-duration":"animation-delay","animation-fill-mode":{cssPropBits:0,cssLitGroup:[r[29],r[48],r[54],r[71]],cssFns:[]},"animation-iteration-count":{cssPropBits:5,cssLitGroup:[r[48],r[63]],cssFns:[]},"animation-name":{cssPropBits:512,cssLitGroup:[r[48],r[71]],cssFns:[]},"animation-play-state":{cssPropBits:0,cssLitGroup:[r[45],r[48]],cssFns:[]},"animation-timing-function":{cssPropBits:0,cssLitGroup:[r[10],r[48]],cssFns:["cubic-bezier()","steps()"]},appearance:{cssPropBits:0,cssLitGroup:[r[71]],cssFns:[]},azimuth:{cssPropBits:5,cssLitGroup:[r[7],r[42],r[56]],cssFns:[]},"backface-visibility":{cssPropBits:0,cssLitGroup:[r[59],r[62],r[80]],cssFns:[]},background:{cssPropBits:23,cssLitGroup:[r[0],r[18],r[25],r[31],r[34],r[42],r[48],r[49],r[52],r[56],r[61],r[68],r[71],r[74],r[75]],cssFns:"image(),linear-gradient(),radial-gradient(),repeating-linear-gradient(),repeating-radial-gradient(),rgb(),rgba()".split(",")},"background-attachment":{cssPropBits:0,cssLitGroup:[r[48],r[61],r[68],r[75]],cssFns:[]},"background-color":{cssPropBits:2,cssLitGroup:[r[0]],cssFns:["rgb()","rgba()"]},"background-image":{cssPropBits:16,cssLitGroup:[r[48],r[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"background-position":{cssPropBits:5,cssLitGroup:[r[31],r[42],r[48],r[56]],cssFns:[]},"background-repeat":{cssPropBits:0,cssLitGroup:[r[18],r[48],r[74]],cssFns:[]},"background-size":{cssPropBits:5,cssLitGroup:[r[34],r[48],r[52]],cssFns:[]},border:{cssPropBits:7,cssLitGroup:[r[0],r[9],r[47],r[62],r[64],r[69],r[71]],cssFns:["rgb()","rgba()"]},"border-bottom":"border","border-bottom-color":"background-color","border-bottom-left-radius":{cssPropBits:5,cssFns:[]},"border-bottom-right-radius":"border-bottom-left-radius","border-bottom-style":{cssPropBits:0,cssLitGroup:[r[9],r[62],r[64],r[71]],cssFns:[]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[r[47],r[69]],cssFns:[]},"border-collapse":{cssPropBits:0,cssLitGroup:[r[59],r[76]],cssFns:[]},"border-color":"background-color","border-left":"border","border-left-color":"background-color","border-left-style":"border-bottom-style","border-left-width":"border-bottom-width","border-radius":{cssPropBits:5,cssLitGroup:[r[49]],cssFns:[]},"border-right":"border","border-right-color":"background-color","border-right-style":"border-bottom-style","border-right-width":"border-bottom-width","border-spacing":"border-bottom-left-radius","border-style":"border-bottom-style","border-top":"border","border-top-color":"background-color","border-top-left-radius":"border-bottom-left-radius","border-top-right-radius":"border-bottom-left-radius","border-top-style":"border-bottom-style","border-top-width":"border-bottom-width","border-width":"border-bottom-width",bottom:{cssPropBits:5,cssLitGroup:[r[52]],cssFns:[]},box:{cssPropBits:0,cssLitGroup:[r[60],r[71],r[72]],cssFns:[]},"box-shadow":{cssPropBits:7,cssLitGroup:[r[0],r[48],r[64],r[71]],cssFns:["rgb()","rgba()"]},"box-sizing":{cssPropBits:0,cssLitGroup:[r[25]],cssFns:[]},"caption-side":{cssPropBits:0,cssLitGroup:[r[31]],cssFns:[]},clear:{cssPropBits:0,cssLitGroup:[r[42],r[54],r[71]],cssFns:[]},clip:{cssPropBits:0,cssLitGroup:[r[52]],cssFns:["rect()"]},color:"background-color",content:{cssPropBits:8,cssLitGroup:[r[71],r[72]],cssFns:[]},cue:{cssPropBits:16,cssLitGroup:[r[71]],cssFns:[]},"cue-after":"cue","cue-before":"cue",cursor:{cssPropBits:16,cssLitGroup:[r[1],r[48],r[52]],cssFns:[]},direction:{cssPropBits:0,cssLitGroup:[r[43]],cssFns:[]},display:{cssPropBits:0,cssLitGroup:[r[4],r[6],r[20],r[52],r[67],r[71]],cssFns:[]},"display-extras":{cssPropBits:0,cssLitGroup:[r[67],r[71]],cssFns:[]},"display-inside":{cssPropBits:0,cssLitGroup:[r[20],r[52]],cssFns:[]},"display-outside":{cssPropBits:0,cssLitGroup:[r[4],r[71]],cssFns:[]},elevation:{cssPropBits:5,cssLitGroup:[r[15]],cssFns:[]},"empty-cells":{cssPropBits:0,cssLitGroup:[r[38]],cssFns:[]},filter:{cssPropBits:0,cssFns:["alpha()"]},"float":{cssPropBits:0,cssLitGroup:[r[42],r[71]],cssFns:[]},font:{cssPropBits:73,cssLitGroup:[r[3],r[8],r[13],r[16],r[41],r[48],r[49],r[69],r[72],r[77]],cssFns:[]},"font-family":{cssPropBits:72,cssLitGroup:[r[16],r[48]],cssFns:[]},"font-size":{cssPropBits:1,cssLitGroup:[r[8],r[69]],cssFns:[]},"font-stretch":{cssPropBits:0,cssLitGroup:[r[5],r[72]],cssFns:[]},"font-style":{cssPropBits:0,cssLitGroup:[r[41],r[72]],cssFns:[]},"font-variant":{cssPropBits:0,cssLitGroup:[r[72],r[77]],cssFns:[]},"font-weight":{cssPropBits:0,cssLitGroup:[r[3],r[72]],cssFns:[]},height:"bottom",left:"bottom","letter-spacing":{cssPropBits:5,cssLitGroup:[r[72]],cssFns:[]},"line-height":{cssPropBits:1,cssLitGroup:[r[72]],cssFns:[]},"list-style":{cssPropBits:16,cssLitGroup:[r[2],r[40],r[57],r[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-image":{cssPropBits:16,cssLitGroup:[r[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-position":{cssPropBits:0,cssLitGroup:[r[40]],cssFns:[]},"list-style-type":{cssPropBits:0,cssLitGroup:[r[2],r[57],r[71]],cssFns:[]},margin:"bottom","margin-bottom":"bottom","margin-left":"bottom","margin-right":"bottom","margin-top":"bottom","max-height":{cssPropBits:1,cssLitGroup:[r[52],r[71]],cssFns:[]},"max-width":"max-height","min-height":{cssPropBits:1,cssLitGroup:[r[52]],cssFns:[]},"min-width":"min-height",opacity:{cssPropBits:1,cssFns:[]},outline:{cssPropBits:7,cssLitGroup:[r[0],r[9],r[47],r[62],r[64],r[65],r[69],r[71]],cssFns:["rgb()","rgba()"]},"outline-color":{cssPropBits:2,cssLitGroup:[r[0],r[65]],cssFns:["rgb()","rgba()"]},"outline-style":"border-bottom-style","outline-width":"border-bottom-width",overflow:{cssPropBits:0,cssLitGroup:[r[52],r[62],r[75],r[80]],cssFns:[]},"overflow-wrap":{cssPropBits:0,cssLitGroup:[r[55],r[72]],cssFns:[]},"overflow-x":{cssPropBits:0,cssLitGroup:[r[44],r[52],r[62],r[75],r[80]],cssFns:[]},"overflow-y":"overflow-x",padding:"opacity","padding-bottom":"opacity","padding-left":"opacity","padding-right":"opacity","padding-top":"opacity","page-break-after":{cssPropBits:0,cssLitGroup:[r[42],r[51],r[52],r[53]],cssFns:[]},"page-break-before":"page-break-after","page-break-inside":{cssPropBits:0,cssLitGroup:[r[52],r[53]],cssFns:[]},pause:"border-bottom-left-radius","pause-after":"border-bottom-left-radius","pause-before":"border-bottom-left-radius",perspective:{cssPropBits:5,cssLitGroup:[r[71]],cssFns:[]},"perspective-origin":{cssPropBits:5,cssLitGroup:[r[31],r[42],r[56]],cssFns:[]},pitch:{cssPropBits:5,cssLitGroup:[r[21],r[69]],cssFns:[]},"pitch-range":"border-bottom-left-radius","play-during":{cssPropBits:16,cssLitGroup:[r[52],r[70],r[71],r[74]],cssFns:[]},position:{cssPropBits:0,cssLitGroup:[r[23]],cssFns:[]},quotes:{cssPropBits:8,cssLitGroup:[r[71]],cssFns:[]},resize:{cssPropBits:0,cssLitGroup:[r[39],r[54],r[71]],cssFns:[]},richness:"border-bottom-left-radius",right:"bottom",speak:{cssPropBits:0,cssLitGroup:[r[71],r[72],r[78]],cssFns:[]},"speak-header":{cssPropBits:0,cssLitGroup:[r[51],r[73]],cssFns:[]},"speak-numeral":{cssPropBits:0,cssLitGroup:[r[35]],cssFns:[]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[r[58],r[71]],cssFns:[]},"speech-rate":{cssPropBits:5,cssLitGroup:[r[14],r[69]],cssFns:[]},stress:"border-bottom-left-radius","table-layout":{cssPropBits:0,cssLitGroup:[r[52],r[61]],cssFns:[]},"text-align":{cssPropBits:0,cssLitGroup:[r[42],r[56],r[66]],cssFns:[]},"text-decoration":{cssPropBits:0,cssLitGroup:[r[19],r[71]],cssFns:[]},"text-indent":"border-bottom-left-radius","text-overflow":{cssPropBits:8,cssLitGroup:[r[33]],cssFns:[]},"text-shadow":"box-shadow","text-transform":{cssPropBits:0,cssLitGroup:[r[26],r[71]],cssFns:[]},"text-wrap":{cssPropBits:0,cssLitGroup:[r[46],r[71],r[72]],cssFns:[]},top:"bottom",transform:{cssPropBits:0,cssLitGroup:[r[71]],cssFns:"matrix(),perspective(),rotate(),rotate3d(),rotatex(),rotatey(),rotatez(),scale(),scale3d(),scalex(),scaley(),scalez(),skew(),skewx(),skewy(),translate(),translate3d(),translatex(),translatey(),translatez()".split(",")},"transform-origin":"perspective-origin","transform-style":{cssPropBits:0,cssLitGroup:[r[37]],cssFns:[]},transition:{cssPropBits:1029,cssLitGroup:[r[10],r[48],r[50],r[71]],cssFns:["cubic-bezier()","steps()"]},"transition-delay":"animation-delay","transition-duration":"animation-delay","transition-property":{cssPropBits:1024,cssLitGroup:[r[48],r[50]],cssFns:[]},"transition-timing-function":"animation-timing-function","unicode-bidi":{cssPropBits:0,cssLitGroup:[r[30],r[72]],cssFns:[]},"vertical-align":{cssPropBits:5,cssLitGroup:[r[12],r[31]],cssFns:[]},visibility:"backface-visibility","voice-family":{cssPropBits:8,cssLitGroup:[r[27],r[48]],cssFns:[]},volume:{cssPropBits:1,cssLitGroup:[r[17],r[69]],cssFns:[]},"white-space":{cssPropBits:0,cssLitGroup:[r[22],r[72]],cssFns:[]},width:"min-height","word-break":{cssPropBits:0,cssLitGroup:[r[32],r[72]],cssFns:[]},"word-spacing":"letter-spacing","word-wrap":"overflow-wrap","z-index":"bottom",zoom:"line-height","cubic-bezier()":"animation-delay","steps()":{cssPropBits:5,cssLitGroup:[r[36],r[48]],cssFns:[]},"image()":{cssPropBits:18,cssLitGroup:[r[0],r[48]],cssFns:["rgb()","rgba()"]},"linear-gradient()":{cssPropBits:7,cssLitGroup:[r[0],r[31],r[42],r[48],r[79]],cssFns:["rgb()","rgba()"]},"radial-gradient()":{cssPropBits:7,cssLitGroup:[r[0],r[11],r[31],r[42],r[48],r[56],r[57]],cssFns:["rgb()","rgba()"]},"repeating-linear-gradient()":"linear-gradient()","repeating-radial-gradient()":"radial-gradient()","rgb()":{cssPropBits:1,cssLitGroup:[r[48]],cssFns:[]},"rgba()":"rgb()","rect()":{cssPropBits:5,cssLitGroup:[r[48],r[52]],cssFns:[]},"alpha()":{cssPropBits:1,cssLitGroup:[r[28]],cssFns:[]},"matrix()":"animation-delay","perspective()":"border-bottom-left-radius","rotate()":"border-bottom-left-radius","rotate3d()":"animation-delay","rotatex()":"border-bottom-left-radius","rotatey()":"border-bottom-left-radius","rotatez()":"border-bottom-left-radius","scale()":"animation-delay","scale3d()":"animation-delay","scalex()":"border-bottom-left-radius","scaley()":"border-bottom-left-radius","scalez()":"border-bottom-left-radius","skew()":"animation-delay","skewx()":"border-bottom-left-radius","skewy()":"border-bottom-left-radius","translate()":"animation-delay","translate3d()":"animation-delay","translatex()":"border-bottom-left-radius","translatey()":"border-bottom-left-radius","translatez()":"border-bottom-left-radius"},o;for(o in a)"string"===typeof a[o]&&Object.hasOwnProperty.call(a,o)&&(a[o]=a[a[o]]);"undefined"!==typeof window&&(window.cssSchema=a);var s,l;(function(){function e(e){var t=parseInt(e.substring(1),16);return 65535<t?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(t&1023))):t==t?String.fromCharCode(t):" ">e[1]?"":e[1]}function t(e,t){return'"'+e.replace(/[\u0000-\u001f\\\"<>]/g,t)+'"'}function n(e){return r[e]||(r[e]="\\"+e.charCodeAt(0).toString(16)+" ")}function i(e){return a[e]||(a[e]=("">e?"%0":"%")+e.charCodeAt(0).toString(16))}var r={"\\":"\\\\"},a={"\\":"%5c"},o=RegExp("\\uFEFF|U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?|url[(][\\t\\n\\f ]*(?:\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)[\\t\\n\\f ]*[)]|(?!url[(])-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*[(]|(?:@?-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))|#)(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*|\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)(?:%|-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)?|<!--|-->|[\\t\\n\\f ]+|/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)|[~|^$*]=|[^\"'\\\\/]|/(?![/*])","gi"),u=RegExp("\\\\(?:(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff])|[\\n\\f])","g"),c=RegExp("^url\\([\\t\\n\\f ]*[\"']?|[\"']?[\\t\\n\\f ]*\\)$","gi");l=function(t){return t.replace(u,e)};s=function(e){for(var e=(""+e).replace(/\r\n?/g,"\n").match(o)||[],r=0,a=" ",s=0,u=e.length;s<u;++s){var d=l(e[s]),h=d.length,f=d.charCodeAt(0),d=34==f||39==f?t(d.substring(1,h-1),n):47==f&&1<h||"\\"==d||"-->"==d||"<!--"==d||"﻿"==d||32>=f?" ":/url\(/i.test(d)?"url("+t(d.replace(c,""),i)+")":d;if(a!=d||" "!=d)e[r++]=a=d}e.length=r;return e}})();"undefined"!==typeof window&&(window.lexCss=s,window.decodeCss=l);var u=function(){function e(e){e=(""+e).match(c);return!e?n:new o(s(e[1]),s(e[2]),s(e[3]),s(e[4]),s(e[5]),s(e[6]),s(e[7]))}function t(e,t){return"string"==typeof e?encodeURI(e).replace(t,i):n}function i(e){e=e.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(e>>4&15)+"0123456789ABCDEF".charAt(e&15)}function r(e){if(e===n)return n;for(var e=e.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/"),t=l,i;(i=e.replace(t,"$1"))!=e;e=i);return e}function a(e,t){var n=e.T(),i=t.K();i?n.ga(t.j):i=t.X();i?n.da(t.n):i=t.Y();i?n.ea(t.k):i=t.$();var a=t.g,o=r(a);if(i)n.ca(t.V()),o=o&&o.replace(u,"");else if(i=!!a){if(47!==o.charCodeAt(0))var o=r(n.g||"").replace(u,""),s=o.lastIndexOf("/")+1,o=r((s?o.substring(0,s):"")+r(a)).replace(u,"")}else o=o&&o.replace(u,""),o!==a&&n.G(o);i?n.G(o):i=t.aa();i?n.O(t.l):i=t.Z();i&&n.fa(t.o);return n}function o(e,t,n,i,r,a,o){this.j=e;this.n=t;this.k=n;this.h=i;this.g=r;this.l=a;this.o=o}function s(e){return"string"==typeof e&&0<e.length?e:n}var l=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),u=/^(?:\.\.\/)*(?:\.\.$)?/;o.prototype.toString=function(){var e=[];n!==this.j&&e.push(this.j,":");n!==this.k&&(e.push("//"),n!==this.n&&e.push(this.n,"@"),e.push(this.k),n!==this.h&&e.push(":",this.h.toString()));n!==this.g&&e.push(this.g);n!==this.l&&e.push("?",this.l);n!==this.o&&e.push("#",this.o);return e.join("")};o.prototype.T=function(){return new o(this.j,this.n,this.k,this.h,this.g,this.l,this.o)};o.prototype.W=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};o.prototype.ga=function(e){this.j=e?e:n};o.prototype.K=function(){return n!==this.j};o.prototype.da=function(e){this.n=e?e:n};o.prototype.X=function(){return n!==this.n};o.prototype.ea=function(e){this.k=e?e:n;this.G(this.g)};o.prototype.Y=function(){return n!==this.k};o.prototype.V=function(){return this.h&&decodeURIComponent(this.h)
};o.prototype.ca=function(e){if(e){e=Number(e);if(e!==(e&65535))throw Error("Bad port number "+e);this.h=""+e}else this.h=n};o.prototype.$=function(){return n!==this.h};o.prototype.U=function(){return this.g&&decodeURIComponent(this.g)};o.prototype.G=function(e){e?(e=""+e,this.g=!this.k||/^\//.test(e)?e:"/"+e):this.g=n};o.prototype.O=function(e){this.l=e?e:n};o.prototype.aa=function(){return n!==this.l};o.prototype.ba=function(e){if("object"===typeof e&&!(e instanceof Array)&&(e instanceof Object||"[object Array]"!==Object.prototype.toString.call(e))){var t=[],n=-1,i;for(i in e){var r=e[i];"string"===typeof r&&(t[++n]=i,t[++n]=r)}e=t}for(var t=[],n="",a=0;a<e.length;)i=e[a++],r=e[a++],t.push(n,encodeURIComponent(i.toString())),n="&",r&&t.push("=",encodeURIComponent(r.toString()));this.l=t.join("")};o.prototype.fa=function(e){this.o=e?e:n};o.prototype.Z=function(){return n!==this.o};var c=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,d=/[#\/\?@]/g,h=/[\#\?]/g;o.parse=e;o.create=function(e,r,a,s,l,u,c){e=new o(t(e,d),t(r,d),"string"==typeof a?encodeURIComponent(a):n,0<s?s.toString():n,t(l,h),n,"string"==typeof c?encodeURIComponent(c):n);u&&("string"===typeof u?e.O(u.replace(/[^?&=0-9A-Za-z_\-~.%]/g,i)):e.ba(u));return e};o.N=a;o.ma=r;o.ha={ua:function(t){return/\.html$/.test(e(t).U())?"text/html":"application/javascript"},N:function(t,n){return t?a(e(t),e(n)).toString():""+n}};return o}();"undefined"!==typeof window&&(window.URI=u);var c=e,d=e,h=e,f=e;(function(){function r(e){return"string"===typeof e?'url("'+e.replace(v,o)+'")':'url("about:blank")'}function o(e){return y[e]}function s(e,t){return e?u.ha.N(e,t):t}function m(e,t,i){if(!i)return n;var r=(""+e).match(w);return r&&(!r[1]||b.test(r[1]))?i(e,t):n}function g(e){return e.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/,"")}var v=/[\n\f\r\"\'()*<>]/g,y={"\n":"%0a","\f":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},w=/^(?:([^:/?# ]+):)?/,b=/^(?:https?|mailto)$/i;c=function(){var e={};return function t(n,i,o,u,c){var n=g(n),d=a[n];if(!d||"object"!==typeof d)i.length=0;else{for(var h=d.cssPropBits,f=h&80,p=h&1536,_=NaN,v=0,y=0;v<i.length;++v){var w=i[v].toLowerCase(),b=w.charCodeAt(0),C,S,T,x,k,M;if(32===b)w="";else if(34===b)w=16===f?o?r(m(s(u,l(i[v].substring(1,w.length-1))),n,o)):"":h&8&&!(f&f-1)?w:"";else if("inherit"!==w){if(k=d.cssLitGroup){var L;if(!(L=d.cssLitMap)){L={};for(var B=k.length;0<=--B;)for(var E=k[B],D=E.length;0<=--D;)L[E[D]]=e;L=d.cssLitMap=L}k=L}else k=e;if(!(M=k,M[g(w)]===e))if(35===b&&/^#(?:[0-9a-f]{3}){1,2}$/.test(w))w=h&2?w:"";else if(48<=b&&57>=b)w=h&1?w:"";else if(C=w.charCodeAt(1),S=w.charCodeAt(2),T=48<=C&&57>=C,x=48<=S&&57>=S,43===b&&(T||46===C&&x))w=h&1?(T?"":"0")+w.substring(1):"";else if(45===b&&(T||46===C&&x))w=h&4?(T?"-":"-0")+w.substring(1):h&1?"0":"";else if(46===b&&T)w=h&1?"0"+w:"";else if('url("'===w.substring(0,5))w=o&&h&16?r(m(s(u,i[v].substring(5,w.length-2)),n,o)):"";else if("("===w.charAt(w.length-1))e:{k=i;L=v;w=1;B=L+1;for(b=k.length;B<b&&w;)E=k[B++],w+=")"===E?-1:/^[^"']*\($/.test(E);if(!w){w=k[L].toLowerCase();b=g(w);k=k.splice(L,B-L,"");L=d.cssFns;B=0;for(E=L.length;B<E;++B)if(L[B].substring(0,b.length)==b){k[0]=k[k.length-1]="";t(L[B],k,o,u);w=w+k.join(" ")+")";break e}}w=""}else w=p&&/^-?[a-z_][\w\-]*$/.test(w)&&!/__$/.test(w)?c&&512===p?i[v]+c:1024===p&&a[w]&&"number"===typeof a[w].oa?w:"":/^\w+$/.test(w)&&64===f&&h&8?_+1===y?(i[_]=i[_].substring(0,i[_].length-1)+" "+w+'"',""):(_=y,'"'+w+'"'):""}w&&(i[y++]=w)}1===y&&'url("about:blank")'===i[0]&&(y=0);i.length=y}}}();var C=RegExp("^(active|after|before|blank|checked|default|disabled|drop|empty|enabled|first|first-child|first-letter|first-line|first-of-type|fullscreen|focus|hover|in-range|indeterminate|invalid|last-child|last-of-type|left|link|only-child|only-of-type|optional|out-of-range|placeholder-shown|read-only|read-write|required|right|root|scope|user-error|valid|visited)$"),S={};S[">"]=S["+"]=S["~"]=S;d=function(e,r,a){function o(o,d){function h(n,a,o){var s,c,d,h,p,m=t;s="";if(n<a)if(p=e[n],"*"===p)++n,s=p;else if(/^[a-zA-Z]/.test(p)&&(c=u(p.toLowerCase(),[])))"tagName"in c&&(p=c.tagName),++n,s=p;for(h=d=c="";m&&n<a;++n)if(p=e[n],"#"===p.charAt(0))/^#_|__$|[^\w#:\-]/.test(p)?m=i:c+=p+l;else if("."===p)++n<a&&/^[0-9A-Za-z:_\-]+$/.test(p=e[n])&&!/^_|__$/.test(p)?c+="."+p:m=i;else if(n+1<a&&"["===e[n]){++n;var g=e[n++].toLowerCase();p=_.m[s+"::"+g];p!==+p&&(p=_.m["*::"+g]);var v;r.ia?(v=r.ia(s,g),"string"!==typeof v&&(m=i,v=g),m&&p!==+p&&(p=_.d.NONE)):(v=g,p!==+p&&(m=i));var y=g="",w=i;/^[~^$*|]?=$/.test(e[n])&&(g=e[n++],y=e[n++],/^[0-9A-Za-z:_\-]+$/.test(y)?y='"'+y+'"':"]"===y&&(y='""',--n),/^"([^\"\\]|\\.)*"$/.test(y)||(m=i),(w="i"===e[n])&&++n);"]"!==e[n]&&(++n,m=i);switch(p){case _.d.CLASSES:case _.d.LOCAL_NAME:case _.d.NONE:break;case _.d.GLOBAL_NAME:case _.d.ID:case _.d.IDREF:("="===g||"~="===g||"$="===g)&&'""'!=y&&!w?y='"'+y.substring(1,y.length-1)+l+'"':"|="===g||""===g||(m=i);break;case _.d.URI:case _.d.URI_FRAGMENT:""!==g&&(m=i);break;default:m=i}m&&(d+="["+v.replace(/[^\w-]/g,"\\$&")+g+y+(w?" i]":"]"))}else if(n<a&&":"===e[n])if(p=e[++n],C.test(p))h+=":"+p;else break;else break;n!==a&&(m=i);m&&(n=(s+c).replace(/[^ .*#\w-]/g,"\\$&")+d+h+o)&&f.push(n);return m}" "===e[o]&&++o;d-1!==o&&" "===e[d]&&--d;for(var f=[],p=o,m=t,g=o;m&&g<d;++g){var v=e[g];if(S[v]===S||" "===v)h(p,g,v)?p=g+1:m=i}h(p,d,"")||(m=i);return m?(f.length&&(p=f.join(""),s!==n&&(p="."+s+" "+p),c.push(p)),t):!a||a(e.slice(o,d))}var s=r.na,l=r.L,u=r.Aa,c=[],d=0,h,f=0,p;for(h=0;h<e.length;++h)if(p=e[h],"("==p||"["==p?(++f,t):")"==p||"]"==p?(f&&--f,t):!(" "==e[h]&&(f||S[e[h-1]]===S||S[e[h+1]]===S)))e[d++]=e[h];e.length=d;d=e.length;for(h=f=0;h<d;++h)if(","===e[h]){if(!o(f,h))return n;f=h+1}return!o(f,d)?n:c};(function(){var e=/^\w/,t=RegExp("^(?:(?:(?:(?:only|not) )?(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)|\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))(?: and ?\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))*)(?: , (?:(?:(?:(?:only|not) )?(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)|\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))(?: and ?\\( (?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script) (?:: -?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)?)) )?\\))*))*$","i");f=function(n){for(var n=n.slice(),i=n.length,r=0,a=0;a<i;++a){var o=n[a];" "!=o&&(n[r++]=o)}n.length=r;n=n.join(" ");return n=!n.length?"":!t.test(n)?"not all":e.test(n)?n:"not all , "+n}})();(function(){function r(e){var t=/^\s*[']([^']*)[']\s*$/,i=/^\s*url\s*[(]["]([^"]*)["][)]\s*$/,r=/^\s*url\s*[(][']([^']*)['][)]\s*$/,a=/^\s*url\s*[(]([^)]*)[)]\s*$/,o;return(o=/^\s*["]([^"]*)["]\s*$/.exec(e))||(o=t.exec(e))||(o=i.exec(e))||(o=r.exec(e))||(o=a.exec(e))?o[1]:n}function a(o,l,u,h,_,g,v){function y(){S=C.length&&C[C.length-1]===n}var w=e,b=v||[0],C=[],S=i;p(l,{startStylesheet:function(){w=[]},endStylesheet:function(){},startAtrule:function(e,t){if(S)e=n;else if("@media"===e)w.push("@media"," ",f(t));else if("@keyframes"===e||"@-webkit-keyframes"===e){var i=t[0];1===t.length&&!/__$|[^\w\-]/.test(i)?(w.push(e," ",i+u.L),e="@keyframes"):e=n}else if("@import"===e&&0<t.length)if(e=n,"function"===typeof g){var l=f(t.slice(1));if("not all"!==l){++b[0];var c=[];w.push(c);var d=m(s(o,r(t[0])),function(e){var t=a(d,e.qa,u,h,_,g,b);--b[0];e=l?{toString:function(){return"@media "+l+" {"+t.result+"}"}}:t.result;c[0]=e;g(e,!!b[0])},_)}}else window.console&&window.console.log("@import "+t.join(" ")+" elided");S=!e;C.push(e)},endAtrule:function(){C.pop();S||w.push(";");y()},startBlock:function(){S||w.push("{")},endBlock:function(){S||(w.push("}"),S=t)},startRuleset:function(i){if(!S){var r=e;"@keyframes"===C[C.length-1]?(r=i.join(" ").match(/^ *(?:from|to|\d+(?:\.\d+)?%) *(?:, *(?:from|to|\d+(?:\.\d+)?%) *)*$/i),S=!r,r&&(r=r[0].replace(/ +/g,""))):(i=d(i,u),!i||!i.length?S=t:r=i.join(", "));S||w.push(r,"{")}C.push(n)},endRuleset:function(){C.pop();S||w.push("}");y()},declaration:function(e,n){if(!S){var r=i,a=n.length;2<=a&&"!"===n[a-2]&&"important"===n[a-1].toLowerCase()&&(r=t,n.length-=2);c(e,n,h,o,u.L);n.length&&w.push(e,":",n.join(" "),r?" !important;":";")}}});return{result:{toString:function(){return w.join("")}},va:!!b[0]}}h=function(t,n,i,r){return a(t,n,i,r,e,e).result.toString()}})()})();"undefined"!==typeof window&&(window.sanitizeCssProperty=c,window.sanitizeCssSelectorList=d,window.sanitizeStylesheet=h,window.sanitizeMediaQuery=f);var p,m;(function(){function e(e,t,i,r,a){for(var o=t++;t<i&&"{"!==e[t]&&";"!==e[t];)++t;if(t<i&&(a||";"===e[t])){var a=o+1,s=t;a<i&&" "===e[a]&&++a;s>a&&" "===e[s-1]&&--s;r.startAtrule&&r.startAtrule(e[o].toLowerCase(),e.slice(a,s));t="{"===e[t]?n(e,t,i,r):t+1;r.endAtrule&&r.endAtrule()}return t}function n(t,a,o,s){++a;for(s.startBlock&&s.startBlock();a<o;){var l=t[a].charAt(0);if("}"==l){++a;break}a=" "===l||";"===l?a+1:"@"===l?e(t,a,o,s,i):"{"===l?n(t,a,o,s):r(t,a,o,s)}s.endBlock&&s.endBlock();return a}function r(e,n,i,r){var o=n,s=a(e,n,i,t);if(0>s)return s=~s,s===o?s+1:s;var u=e[s];if("{"!==u)return s===o?s+1:s;n=s+1;s>o&&" "===e[s-1]&&--s;for(r.startRuleset&&r.startRuleset(e.slice(o,s));n<i;){u=e[n];if("}"===u){++n;break}n=" "===u?n+1:l(e,n,i,r)}r.endRuleset&&r.endRuleset();return n}function a(e,t,n,i){for(var r,a=[],o=-1;t<n;++t)if(r=e[t].charAt(0),"["===r||"("===r)a[++o]=r;else if("]"===r&&"["===a[o]||")"===r&&"("===a[o])--o;else if("{"===r||"}"===r||";"===r||"@"===r||":"===r&&!i)break;0<=o&&(t=~(t+1));return t}function o(e,t,n){for(;t<n&&";"!==e[t]&&"}"!==e[t];)++t;return t<n&&";"===e[t]?t+1:t}function l(e,t,n,r){var s=e[t++];if(!u.test(s))return o(e,t,n);t<n&&" "===e[t]&&++t;if(t==n||":"!==e[t])return o(e,t,n);++t;t<n&&" "===e[t]&&++t;var l=a(e,t,n,i);if(0>l)l=~l;else{for(var c=[],d=0,h=t;h<l;++h)t=e[h]," "!==t&&(c[d++]=t);if(l<n){do{t=e[l];if(";"===t||"}"===t)break;d=0}while(++l<n);";"===t&&++l}d&&r.declaration&&r.declaration(s.toLowerCase(),c)}return l}p=function(n,i){var a=s(n);i.startStylesheet&&i.startStylesheet();for(var o=0,l=a.length;o<l;)o=" "===a[o]?o+1:o<l?"@"===a[o].charAt(0)?e(a,o,l,i,t):r(a,o,l,i):o;i.endStylesheet&&i.endStylesheet()};var u=/^-?[a-z]/i;m=function(e,t){for(var n=s(e),i=0,r=n.length;i<r;)i=" "!==n[i]?l(n,i,r,t):i+1}})();"undefined"!==typeof window&&(window.parseCssStylesheet=p,window.parseCssDeclarations=m);var _={d:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13}};_.atype=_.d;_.m={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};_.ATTRIBS=_.m;_.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};_.eflags=_.c;_.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};_.ELEMENTS=_.f;_.Q={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};_.ELEMENT_DOM_INTERFACES=_.Q;_.P={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};_.ueffects=_.P;_.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1};_.URIEFFECTS=_.J;_.M={UNSANDBOXED:2,SANDBOXED:1,DATA:0};_.ltypes=_.M;_.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};_.LOADERTYPES=_.I;"undefined"!==typeof window&&(window.html4=_);var g=function(r){function a(e){if(x.hasOwnProperty(e))return x[e];var t=e.match(k);return t?String.fromCharCode(parseInt(t[1],10)):(t=e.match(M))?String.fromCharCode(parseInt(t[1],16)):B&&L.test(e)?(B.innerHTML="&"+e+";",t=B.textContent,x[e]=t):"&"+e+";"}function o(e,t){return a(t)}function s(e){return e.replace(D,o)}function l(e){return(""+e).replace(I,"&amp;").replace(A,"&lt;").replace(F,"&gt;").replace(O,"&#34;")}function c(e){return e.replace(P,"&amp;$1").replace(A,"&lt;").replace(F,"&gt;")}function d(e){var t={z:e.z||e.cdata,A:e.A||e.comment,B:e.B||e.endDoc,t:e.t||e.endTag,e:e.e||e.pcdata,F:e.F||e.rcdata,H:e.H||e.startDoc,w:e.w||e.startTag};return function(e,r){var a;var o=/(<\/|<\!--|<[!?]|[&<>])/g;a=e+"";if(N)a=a.split(o);else{for(var s=[],l=0,u;(u=o.exec(a))!==n;)s.push(a.substring(l,u.index)),s.push(u[0]),l=u.index+u[0].length;s.push(a.substring(l));a=s}f(t,a,0,{r:i,C:i},r)}}function h(e,t,n,i,r){return function(){f(e,t,n,i,r)}}function f(e,n,i,a,o){try{e.H&&0==i&&e.H(o);for(var s,l,u,c=n.length;i<c;){var d=n[i++],f=n[i];switch(d){case"&":V.test(f)?(e.e&&e.e("&"+f,o,j,h(e,n,i,a,o)),i++):e.e&&e.e("&amp;",o,j,h(e,n,i,a,o));break;case"</":if(s=/^([-\w:]+)[^\'\"]*/.exec(f))if(s[0].length===f.length&&">"===n[i+1])i+=2,u=s[1].toLowerCase(),e.t&&e.t(u,o,j,h(e,n,i,a,o));else{var _=n,g=i,v=e,y=o,w=j,b=a,C=m(_,g);C?(v.t&&v.t(C.name,y,w,h(v,_,g,b,y)),i=C.next):i=_.length}else e.e&&e.e("&lt;/",o,j,h(e,n,i,a,o));break;case"<":if(s=/^([-\w:]+)\s*\/?/.exec(f))if(s[0].length===f.length&&">"===n[i+1]){i+=2;u=s[1].toLowerCase();e.w&&e.w(u,[],o,j,h(e,n,i,a,o));var S=r.f[u];S&H&&(i=p(n,{name:u,next:i,c:S},e,o,j,a))}else{var _=n,g=e,v=o,y=j,w=a,T=m(_,i);T?(g.w&&g.w(T.name,T.R,v,y,h(g,_,T.next,w,v)),i=T.c&H?p(_,T,g,v,y,w):T.next):i=_.length}else e.e&&e.e("&lt;",o,j,h(e,n,i,a,o));break;case"<!--":if(!a.C){for(l=i+1;l<c&&!(">"===n[l]&&/--$/.test(n[l-1]));l++);if(l<c){if(e.A){var x=n.slice(i,l).join("");e.A(x.substr(0,x.length-2),o,j,h(e,n,l+1,a,o))}i=l+1}else a.C=t}a.C&&e.e&&e.e("&lt;!--",o,j,h(e,n,i,a,o));break;case"<!":if(/^\w/.test(f)){if(!a.r){for(l=i+1;l<c&&">"!==n[l];l++);l<c?i=l+1:a.r=t}a.r&&e.e&&e.e("&lt;!",o,j,h(e,n,i,a,o))}else e.e&&e.e("&lt;!",o,j,h(e,n,i,a,o));break;case"<?":if(!a.r){for(l=i+1;l<c&&">"!==n[l];l++);l<c?i=l+1:a.r=t}a.r&&e.e&&e.e("&lt;?",o,j,h(e,n,i,a,o));break;case">":e.e&&e.e("&gt;",o,j,h(e,n,i,a,o));break;case"":break;default:e.e&&e.e(d,o,j,h(e,n,i,a,o))}}e.B&&e.B(o)}catch(k){if(k!==j)throw k}}function p(e,t,n,i,a,o){var s=e.length;U.hasOwnProperty(t.name)||(U[t.name]=RegExp("^"+t.name+"(?:[\\s\\/]|$)","i"));for(var l=U[t.name],u=t.next,d=t.next+1;d<s&&!("</"===e[d-1]&&l.test(e[d]));d++);d<s&&(d-=1);s=e.slice(u,d).join("");if(t.c&r.c.CDATA)n.z&&n.z(s,i,a,h(n,e,d,o,i));else if(t.c&r.c.RCDATA)n.F&&n.F(c(s),i,a,h(n,e,d,o,i));else throw Error("bug");return d}function m(e,n){var a=/^([-\w:]+)/.exec(e[n]),o={};o.name=a[1].toLowerCase();o.c=r.f[o.name];for(var l=e[n].substr(a[0].length),u=n+1,c=e.length;u<c&&">"!==e[u];u++)l+=e[u];if(!(c<=u)){for(var d=[];""!==l;)if(a=R.exec(l))if(a[4]&&!a[5]||a[6]&&!a[7]){for(var a=a[4]||a[6],h=i,l=[l,e[u++]];u<c;u++){if(h){if(">"===e[u])break}else 0<=e[u].indexOf(a)&&(h=t);l.push(e[u])}if(c<=u)break;l=l.join("")}else{var h=a[1].toLowerCase(),f;if(a[2]){f=a[3];var p=f.charCodeAt(0);if(34===p||39===p)f=f.substr(1,f.length-2);f=s(f.replace(E,""))}else f="";d.push(h,f);l=l.substr(a[0].length)}else l=l.replace(/^[\s\S][^a-z\s]*/,"");o.R=d;o.next=u+1;return o}}function _(t){function a(e,t){s||t.push(e)}var o,s;return d({startDoc:function(){o=[];s=i},startTag:function(i,a,u){if(!s&&r.f.hasOwnProperty(i)){var c=r.f[i];if(!(c&r.c.FOLDABLE)){var d=t(i,a);if(d){if("object"!==typeof d)throw Error("tagPolicy did not return object (old API?)");if("attribs"in d)a=d.attribs;else throw Error("tagPolicy gave no attribs");var h;"tagName"in d?(h=d.tagName,d=r.f[h]):(h=i,d=c);if(c&r.c.OPTIONAL_ENDTAG){var f=o[o.length-1];f&&f.D===i&&(f.v!==h||i!==h)&&u.push("</",f.v,">")}c&r.c.EMPTY||o.push({D:i,v:h});u.push("<",h);i=0;for(f=a.length;i<f;i+=2){var p=a[i],m=a[i+1];m!==n&&m!==e&&u.push(" ",p,'="',l(m),'"')}u.push(">");c&r.c.EMPTY&&!(d&r.c.EMPTY)&&u.push("</",h,">")}else s=!(c&r.c.EMPTY)}}},endTag:function(e,t){if(s)s=i;else if(r.f.hasOwnProperty(e)){var n=r.f[e];if(!(n&(r.c.EMPTY|r.c.FOLDABLE))){if(n&r.c.OPTIONAL_ENDTAG)for(n=o.length;0<=--n;){var a=o[n].D;if(a===e)break;if(!(r.f[a]&r.c.OPTIONAL_ENDTAG))return}else for(n=o.length;0<=--n&&o[n].D!==e;);if(!(0>n)){for(a=o.length;--a>n;){var l=o[a].v;r.f[l]&r.c.OPTIONAL_ENDTAG||t.push("</",l,">")}n<o.length&&(e=o[n].v);o.length=n;t.push("</",e,">")}}}},pcdata:a,rcdata:a,cdata:a,endDoc:function(e){for(;o.length;o.length--)e.push("</",o[o.length-1].v,">")}})}function g(e,t,i,r,a){if(!a)return n;try{var o=u.parse(""+e);if(o&&(!o.K()||G.test(o.W()))){var s=a(o,t,i,r);return s?s.toString():n}}catch(l){}return n}function v(e,t,n,i,r){n||e(t+" removed",{S:"removed",tagName:t});if(i!==r){var a="changed";i&&!r?a="removed":!i&&r&&(a="added");e(t+"."+n+" "+a,{S:a,tagName:t,la:n,oldValue:i,newValue:r})}}function y(e,t,n){t=t+"::"+n;if(e.hasOwnProperty(t))return e[t];t="*::"+n;if(e.hasOwnProperty(t))return e[t]}function w(t,i,a,o,s){for(var l=0;l<i.length;l+=2){var u=i[l],c=i[l+1],d=c,h=n,f;if((f=t+"::"+u,r.m.hasOwnProperty(f))||(f="*::"+u,r.m.hasOwnProperty(f)))h=r.m[f];if(h!==n)switch(h){case r.d.NONE:break;case r.d.SCRIPT:c=n;s&&v(s,t,u,d,c);break;case r.d.STYLE:if("undefined"===typeof S){c=n;s&&v(s,t,u,d,c);break}var p=[];S(c,{declaration:function(e,t){var i=e.toLowerCase();T(i,t,a?function(e){return g(e,r.P.ja,r.M.ka,{TYPE:"CSS",CSS_PROP:i},a)}:n);t.length&&p.push(i+": "+t.join(" "))}});c=0<p.length?p.join(" ; "):n;s&&v(s,t,u,d,c);break;case r.d.ID:case r.d.IDREF:case r.d.IDREFS:case r.d.GLOBAL_NAME:case r.d.LOCAL_NAME:case r.d.CLASSES:c=o?o(c):c;s&&v(s,t,u,d,c);break;case r.d.URI:c=g(c,y(r.J,t,u),y(r.I,t,u),{TYPE:"MARKUP",XML_ATTR:u,XML_TAG:t},a);s&&v(s,t,u,d,c);break;case r.d.URI_FRAGMENT:c&&"#"===c.charAt(0)?(c=c.substring(1),c=o?o(c):c,c!==n&&c!==e&&(c="#"+c)):c=n;s&&v(s,t,u,d,c);break;default:c=n,s&&v(s,t,u,d,c)}else c=n,s&&v(s,t,u,d,c);i[l+1]=c}return i}function b(t,n,i){return function(a,o){if(r.f[a]&r.c.UNSAFE)i&&v(i,a,e,e,e);else return{attribs:w(a,o,t,n,i)}}}function C(e,t){var n=[];_(t)(e,n);return n.join("")}var S,T;"undefined"!==typeof window&&(S=window.parseCssDeclarations,T=window.sanitizeCssProperty);var x={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "},k=/^#(\d+)$/,M=/^#x([0-9A-Fa-f]+)$/,L=/^[A-Za-z][A-za-z0-9]+$/,B="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):n,E=/\0/g,D=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,V=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,I=/&/g,P=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,A=/[<]/g,F=/>/g,O=/\"/g,R=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,N=3==="a,b".split(/(,)/).length,H=r.c.CDATA|r.c.RCDATA,j={},U={},G=/^(?:https?|mailto)$/i,W={};W.pa=W.escapeAttrib=l;W.ra=W.makeHtmlSanitizer=_;W.sa=W.makeSaxParser=d;W.ta=W.makeTagPolicy=b;W.wa=W.normalizeRCData=c;W.xa=W.sanitize=function(e,t,n,i){return C(e,b(t,n,i))};W.ya=W.sanitizeAttribs=w;W.za=W.sanitizeWithPolicy=C;W.Ba=W.unescapeEntities=s;return W}(_),v=g.sanitize;"undefined"!==typeof window&&(window.html=g,window.html_sanitize=v)})();(function(e){e.$=e.jQuery=window.jQuery;e._=window._;e.moment=window.moment;e.jwerty=window.jwerty;e.Stripe=window.Stripe;e.Bacon=window.Bacon;e.RSVP=window.RSVP;e.caja={html:window.html,html_sanitize:window.html_sanitize};for(var t in e._old_globals){if(!e._old_globals.hasOwnProperty(t)){continue}if(e._old_globals[t]!==undefined){window[t]=e._old_globals[t]}else{delete window[t]}}delete e._old_globals})(Streak);(function(e){var t=e.Date,n=e.RSVP,r=e.$,a=e._;e.Utils={};t.prototype.getTimezoneOffsetInMilli=function(){return(new t).getTimezoneOffset()*-60*1e3};t.prototype.toLocalTime=function(){this.setTime(this.getTime()+this.getTimezoneOffsetInMilli())};t.prototype.toGMT=function(){this.setTime(this.getTime()-this.getTimezoneOffsetInMilli())};t.prototype.getGmailFormatted=function(e){var n=this;var i=new t;var r=(i.getTime()-n.getTime())/(1e3*60*60);var a;if(r<12){a=(n.getHours()==12?"12":n.getHours()%12)+":"+(n.getMinutes()>9?n.getMinutes():"0"+n.getMinutes())+(e?"":" ")+(n.getHours()>11?e?"p":"pm":e?"a":"am")}else{var o=n.toDateString().split(" ");a=o[1]+" "+o[2]+(r/24/30>6?" "+n.getFullYear():"")}return a};t.addOutputFormat({token:"tzshort",format:function(e,t,n,i){var r=e.toString();if(r.indexOf("(")>-1){var a=e.toString().split("(")[1].split(" ");if(a.length>1){return a.map(function(e){return e.at(0).capitalize()}).join("")}else{return a[0].split(")")[0]}}return""}});t.addOutputFormat({token:"mmshort",format:function(e,t,n,i){if(e.getMinutes()===0){return""}else{var r=e.getMinutes();if(r<10){r="0"+r}return":"+r}}});var o="en";var s={en:{"export":"{MM}/{dd}/{year} {hh}:{mm}:{ss} {TT} {tzshort}",shortWithWeekday:"{Dow} {MM}/{day}/{yy} {h}:{mm}{tt}",shortDate:"{MM}/{dd}/{yy}",shortFormat:"{MM}/{dd}/{yy} {h}{mmshort}{tt}",longDateTime:"{Weekday} {Month} {ord}, {year} {h}:{mm}{tt}",longWithTimezone:"{Weekday} {Month} {ord}, {year} {h}:{mm}{tt} {tzshort}",inputDateTime:"{Month} {ord}, {year} {h}:{mm}{tt}",inputDate:"{Month} {ord}, {year}",pixelTrack:"{h}:{mm}{tt} on {Month} {ord}, {year}",shortTime:"{12hr}:{mm} {TT}"},other:{"export":"{MM}/{dd}/{year} {hh}:{mm}:{ss} {TT} {tzshort}",shortDate:"{dd}/{MM}/{yy}",shortWithWeekday:"{Dow} {day}/{MM}/{yy} {h}:{mm}{tt}",shortFormat:"{dd}/{MM}/{yy} {h}{mmshort}{tt}",longDateTime:"{Weekday} {Month} {ord}, {year} {h}:{mm}{tt}",longWithTimezone:"{Weekday} {Month} {ord}, {year} {h}:{mm}{tt} {tzshort}",pixelTrack:"{h}:{mm}{tt} on {Month} {ord}, {year}",inputDateTime:"{Month} {ord}, {year} {h}:{mm}{tt}",inputDate:"{Month} {ord}, {year}",shortTime:"{12hr}:{mm} {TT}"}};t.extend({setFormatLocale:function(e){o=e},customFormat:function(e){return this.format(s[o][e])},isBetweenBeginningInclusive:function(e,n,i){var r=this.getTime();var a=t.create(e).getTime();var o=t.create(n).getTime();var s=Math.min(a,o);var l=Math.max(a,o);i=i||0;return s-i<=r&&l+i>r},resetTime:function(){this.reset()}});var l=t.create;t.extend({ccreate:function(e){if(e&&e.replace){e=e.replace(/(^|\s)noon($|\s)/,"$112pm$2").replace(/(^|\s)midnight($|\s)/,"$112am$2")}if(e&&e.match&&e.match(/^-?\d+$/)){return l(parseInt(e,10))}else{return l(e)}}},false,false);t.create=function(e){if(e&&e.replace){e=e.replace(/(^|\s)noon($|\s)/,"$112pm$2").replace(/(^|\s)midnight($|\s)/,"$112am$2")}if(e&&e.match&&e.match(/^\d+\/\d+$/)){e=e+"/"+(new t).getFullYear()}if(e&&e.match&&e.match(/^\w+\s+\d+\s*$/)){return l(e)}var n=new t(e);if(!n.getTime()){try{if(e&&e.match&&e.match(/^-?\d+$/)){n=new t(parseInt(e,10))
}}catch(i){}if(!n||!n.getTime()){n=l(e)}}return n};e.Utils.RegExpQuote=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};Array.prototype.remove=function(t,n){if(e._.isNotReal(t)&&e._.isNotReal(n)){return}var i=this.slice((n||t)+1||this.length);this.length=t<0?this.length+t:t;return this.push.apply(this,i)};Array.prototype.removeVal=function(e){var t=this.indexOf(e);if(t>-1)this.remove(t)};Array.prototype.unique=function(e){var t={};var n=[];for(var i=0,r=this.length;i<r;i++){var a=this[i].toString();if(e){a=e(this[i])}if(!t[a]){n.push(this[i]);t[a]=1}}return n};if(typeof String.prototype.capitalize!=="function"){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}String.prototype.isValidEmail=function(){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return this.match(e)};if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(e){return this.slice(0,e.length)==e}}if(typeof String.prototype.endsWith!="function"){String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1}}if(typeof String.prototype.stripNonPrintableCharacters!="function"){var u=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g;String.prototype.stripNonPrintableCharacters=function(){return this.replace(u,"")}}e.Utils.removePrefix=function(e,t){if(e.startsWith(t)){return e.slice(t.length)}else{throw new Error("removePrefix can only be called when string.startsWith(prefix)")}};e.Utils.removeSuffix=function(e,t){if(e.endsWith(t)){return e.slice(0,-t.length)}else{throw new Error("removeSuffix can only be called when string.endsWith(suffix)")}};String.prototype.sample=function(e){var t="";for(var n=0,i=this.length;n<i;n++){if(n%e===0)t+=this[n]}return t};if(!String.prototype.has){String.prototype.has=function(e){return this.indexOf(e)>-1}}if(!String.prototype.replaceAmpCodes){String.prototype.replaceAmpCodes=function(){return this.replace(/\&\#(\d+)\;/,function(e,t){return String.fromCharCode(t)})}}function c(e,t){var n=new Array(e);for(var i=0;i<e;i++){n[i]=new Array(t);for(var r=0;r<t;r++){n[i][r]=0}}return n}String.prototype.intersectionLength=function(e,t){if(!this||!e){return 0}var n=this.toLowerCase();var i=e.toLowerCase();if(t){n=n.replace(/\s/gim,"");i=i.replace(/\s/gim,"")}var r=c(this.length,i.length);var a=0;for(var o=0;o<n.length;o++){for(var s=0;s<i.length;s++){if(r[o]&&r[o].length>0){if(n[o]===i[s]){if(o===0||s===0){r[o][s]=1}else{r[o][s]=r[o-1][s-1]+1}if(a<r[o][s]){a=r[o][s]}}else{r[o][s]=0}}}}return a};String.prototype.intersectionRatio=function(e){if(!e){e=""}if(this.length+e.length===0){return 0}var t=this.intersectionLength(e);return t/(this.length+e.length)};if(!String.prototype.removeWhitespace){String.prototype.removeWhitespace=function(){return this.replace(/\s/gi,"").replace(/\xAO/gi,"")}}e.Utils.Operators={"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"^":function(e,t){return e^t},"&":function(e,t){return e&t},"|":function(e,t){return e|t},"<<":function(e,t){return e<<t},">>":function(e,t){return e>>t},">>>":function(e,t){return e>>>t},"~":function(e){return~e},"!":function(e){return!e},"&&":function(e,t){return e&&t},"||":function(e,t){return e||t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},"===":function(e,t){return e===t},"!==":function(e,t){return e!==t},"in":function(e,t){return e in t},contains:function(e,t){return a.contains(e,t)},"?":function(e,t,n){return e?t:n}};e.Utils.randomString=function(e){var t="";for(var n=0;n<e;n++){t+=String.fromCharCode(Math.round((90-65)*Math.random())+65)}return t};e.searchObject=function(t,n,i,r,a){var o=e._;var s=[];var l={el:t,path:"",depth:0};var u=[l];if(r){n=n.toLowerCase()}while(u.length>0){var c=u.pop();if(c.depth<=i){try{if(c.el!==null&&typeof c.el==="object"){var d=Object.keys(c.el);if(d.length>0){for(var h=0;h<d.length;h++){var f=d[h];var p={el:c.el[f],path:c.path+"/"+f,depth:c.depth+1};u.push(p)}}}else if(c.el!==null){var m=c.el+"";if(r){m=m.toLowerCase()}if(a){if(m===n){s.push(c)}}else{if(m.indexOf(n)>-1){s.push(c)}}}}catch(_){}}}return s};e.calculateLevinshtein=function(e,t,n){var r,a,o;if(!e){e=[]}if(!t){t=[]}var s=c(e.length+1,t.length+1);for(r=0;r<s.length;r++){o=[];if(r>0){o=s[r-1][0].ops.concat({opCode:"delete",i:r,j:0})}s[r][0]={num:r,ops:o}}for(a=0;a<s[0].length;a++){o=[];if(a>0){o=s[0][a-1].ops.concat({opCode:"insert",i:0,j:a})}s[0][a]={num:a,ops:o}}for(i=1;i<e.length+1;i++){for(var l=1;l<t.length+1;l++){var u=n?e[i-1][n]():e[i-1];var d=n?t[l-1][n]():t[l-1];if(u===d){s[i][l]=s[i-1][l-1]}else{var h=s[i-1][l].num+1;var f=s[i][l-1].num+1;var p=s[i-1][l-1].num+1;if(h<f&&h<p){s[i][l]={num:h,ops:s[i-1][l].ops.concat({opCode:"delete",i:i,j:l})}}else if(f<p){s[i][l]={num:f,ops:s[i][l-1].ops.concat({opCode:"insert",i:i,j:l})}}else{s[i][l]={num:p,ops:s[i-1][l-1].ops.concat({opCode:"sub",i:i,j:l})}}}}}return s};e.calculateFastLevinshteinWithEqualsFunc=function(e,t,n){var i=[],r;var a=0;var o=0;var s=function(){if(n(e[a+1],t[o])){return 1}else{return-1}};var l=function(){if(n(e[a],t[o+1])){return 1}else{return-1}};for(a=0;a<e.length;){if(o>=t.length){break}if(n(e[a],t[o])){o++;a++}else{var u=s();if(u>0){for(r=0;r<u;r++){i.push({opCode:"delete",i:a,j:o});a++}}else{var c=l();if(c>0){for(r=0;r<c;r++){i.push({opCode:"insert",i:a,j:o});o++}}else{i.push({opCode:"sub",i:a,j:o});o++;a++}}}}for(;o<t.length;o++){i.push({opCode:"insert",i:a,j:o})}for(;a<e.length;a++){i.push({opCode:"delete",i:a,j:Math.min(o,t.length-1)})}return i};e.calculateSift3=function(e,t){if(e===null||e.length===0){if(t===null||t.length===0){return 0}else{return t.length}}if(t===null||t.length===0){return e.length}var n=0;var i=0;var r=0;var a=0;var o=5;while(n+i<e.length&&n+r<t.length){if(e[n+i]==t[n+r]){a++}else{i=r=0;for(var s=0;s<o;s++){if(n+s<e.length&&e[n+s]==t[n]){i=s;break}if(n+s<t.length&&e[n]==t[n+s]){r=s;break}}}n++}return(e.length+t.length)/2-a};e.calculateFastLevinshteinFinal=function(t,n){return e.calculateFastLevinshtein(t,n).length};e.calculateFastLevinshtein=function(t,n){return e.calculateFastLevinshteinWithEqualsFunc(t,n,function(e,t){return e===t})};e.genericEquals=function(e,t){var n;if(e===undefined||t===undefined&&e!=t){return e==t}var i={};for(n in e){if(!t.hasOwnProperty(n)||e[n]!==t[n]){return false}}for(n in t){if(!e.hasOwnProperty(n)){return false}}return true};e.cleanupEmailSubject=function(e){var t=e||"";t=t.trim();if(t.substring(0,3).match(/re:/i)){t=t.substring(3)}else if(t.substring(0,4).match(/fwd:/i)){t=t.substring(4)}t=t.replace(/[ ]{2,}/g," ");t=t.trim();if(t.length>90){t=t.substring(0,87)+"..."}return t.toLowerCase()};e.Utils.stripHTMLFromString=function(e){return e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>?/gi,"").replace(/(\s)\s+/gim,"$1")};if(!JSON.compare){JSON.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(n){return false}}}if(!JSON.isEqual){JSON.isEqual=function(e,t){return JSON.compare(e,t)}}if(!JSON.parseCompare){JSON.parseCompare=function(e,t){try{return JSON.compare(JSON.parse(e),JSON.parse(t))}catch(n){return false}}}if(!JSON.deepClone){JSON.deepClone=function(e){if(e){return JSON.parse(JSON.stringify(e))}return e}}e.createEl=function(e,t){var n=document.createElement(e);if(t){n.innerHTML=t}return n};window.isNumber=function(e){return e-0==e&&e.length>0};e.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};e.Utils.signedNumber=function(e){return e>0?"+"+e:e};e.Utils.fileSizeFormat=function(e){var t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];var n=0,i=e;while(i>=1024){i/=1024;++n}return(+i).toFixed(1)+" "+t[n]};e.Utils.reverseComparisonFn=function(e){return a.compose(function(e){return-e},e)};e.Utils.makeComparisonByFn=function(e){var t;if(a.isFunction(e)){t=e}else{t=function(t){return t[e]}}return function(e,n){var i=t(e)||0,r=t(n)||0;if(i==r){return 0}else{return i<r?-1:1}}};e.Utils.combineComparisonFns=function(e){return a.reduceRight(e,function(e,t){return function(n,i){var r=t(n,i);if(r){return r}else{return e(n,i)}}},function(e,t){return 0})};if(e.$){e.Utils.decodeHTMLEntities=function(e){e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");return r("<div/>").html(e).text()}}else{e.Utils.decodeHTMLEntities=require("entities").decodeHTML}e.Utils.parseTagAttributes=function(t){var n={};var i;while(i=t.match(/^\s*([^<>\s=]+)\s*/)){t=t.slice(i[0].length);var r=i[1];if(t[0]!="="){n[r]=""}else{var a=t.match(/^=\s*"([^"]*)"/)||t.match(/^=\s*'([^']*)'/)||t.match(/^=\s*(\S+)/);if(!a){throw new Error("Could not parse value")}t=t.slice(a[0].length);var o=e.Utils.decodeHTMLEntities(a[1]);n[r]=o}}if(t.trim().length){throw new Error("Could not parse entire attributes string")}return n};e.Utils.writeTagAttributes=function(e){var t=" ";a.each(e,function(e,n){if(n.match(/[\s<>='"]/)){throw new Error("Invalid symbol in attribute name: "+n)}t+=a.escape(n)+'="'+a.escape(e)+'" '});return t};e.Utils.wait=function(t){return new e.RSVP.Promise(function(e,n){setTimeout(e,t)})};e.Utils.waitFor=function(t,n,i){return new e.RSVP.Promise(function(e,r){if(!n){n=60*1e3}if(!i){i=250}var a=0;var o=new Error("waitFor timeout");function s(){try{if(t()){e()}else{if(a>=n){r(o)}else{a+=i;setTimeout(s,i)}}}catch(l){r(l)}}setTimeout(s,1)})};e.Utils.timeout=function(e,t){return new n.Promise(function(n,i){var r=setTimeout(i,t,new Error("Timed out"));e.then(function(e){clearTimeout(r);n(e)},function(e){clearTimeout(r);i(e)})})};e.Utils.getStackTrace=function(){var e=new Error("Stack saver");if(typeof e.stack!=="string")return e.stack;return e.stack.replace(/^([^\n]*\n){2}/,"")};e.Utils.escapeAngleBrackets=function(e){if(e&&e.replace){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return e};e.Utils.decodeGmailURLSearchString=function(e){e=(e||"").replace(/\+/gim," ");e=decodeURIComponent(e);return e};e.Utils.loadScript=function(t,n){var i=document.createElement("script");i.type="text/javascript";if(n){for(var r in n){i.setAttribute(r,n[r])}}var o=new e.RSVP.Promise(function(e,t){i.addEventListener("error",function(e){t(e.error||new Error(e.message||"Load failure",e.filename,e.lineno,e.column))},false);i.addEventListener("load",a.defer.bind(a,e),false)});i.src=t;document.head.appendChild(i);return o};e.Utils.isDeepEquals=function(t,n){if(e._.isArray(t)&&e._.isArray(n)){for(var i=0;i<t.length;i++){if(!e.Utils.isDeepEquals(t[i],n[i])){return false}}return true}else if(e._.isObject(t)&&e._.isObject(n)){for(var r in t){if(!e.Utils.isDeepEquals(t[r],n[r])){return false}}return true}else{return t==n}return true}})(Streak);(function(e){var t=e.Bacon;function n(e){var t=document.createElement("script");t.type="text/javascript";t.text='document.head.setAttribute("data-gmail-streak-com", JSON.stringify('+e+"));\n";document.head.appendChild(t).remove();var n=document.head.getAttribute("data-gmail-streak-com");document.head.removeAttribute("data-gmail-streak-com");return JSON.parse(n)}function i(){return n("window.GLOBALS || null")}function r(){var e={isConversationViewDisabled:function(){return n("gmonkey.v2.isConversationViewDisabled()")},getCurrentThread:function(){var e=n("(function(){\n"+"  var t = gmonkey.v2.getCurrentThread();\n"+"  return t ? t.getThreadId() : null;\n"+"})()");return e===null?null:{getThreadId:function(){return e}}}};var i={load:function(n,i){t.fromEventTarget(document,"streakGmonkeyLoaded").take(1).onValue(function(){i(e)});var r=document.createElement("script");r.type="text/javascript";r.text="(function() {\n"+'  "use strict";\n'+"  var checker = function() {\n"+"    if (window.gmonkey) {\n"+'      gmonkey.load("2.0", function(result) {\n'+'        var event = document.createEvent("CustomEvent");\n'+'        event.initCustomEvent("streakGmonkeyLoaded", true, false);\n'+"        document.dispatchEvent(event);\n"+"      });\n"+"    } else {\n"+"      setTimeout(checker, 900);\n"+"    }\n"+"  };\n"+"  checker();\n"+"})();\n";document.head.appendChild(r).remove()}};return i}if(!window.GLOBALS){e.isNotContentScript=false;window.GLOBALS=i();window.gmonkey=r()}else{e.isNotContentScript=true}})(Streak);Streak.Stripe.setPublishableKey(Streak.stripePublishableKey);(function(e,t){var n=e._;var i=function(){this._eventCBs={};this._isReady=false;this._unReady=false;this._readyFuncs=[];this._readyFuncMap={};this._isLoaded=false;this._loadedFuncs=[];this._loadedFuncMap={};this._triggerActive=true};n.extend(i.prototype,{isReady:function(){return this._isReady},unReady:function(){this._isReady=false;this._unReady=true},resetReady:function(){this._isReady=false;this._unReady=false},ready:function(e,t){if(this._unReady){return}if(this._isReady){e()}else{if(t){var n=this._readyFuncMap[t];if(n)this._readyFuncs[this._readyFuncs.indexOf(n)]=e;else this._readyFuncs.push(e);this._readyFuncMap[t]=e}else{this._readyFuncs.push(e)}}},_runReady:function(){this._isReady=true;this._unReady=false;for(var e=0;this._readyFuncs[e];e++){this._readyFuncs[e]()}this._readyFuncs=[]},isLoaded:function(){return this._isLoaded},onLoad:function(e,t){if(this._isLoaded){e()}else{if(t){var n=this._loadedFuncMap[t];if(n)this._loadedFuncs[this._loadedFuncs.indexOf(n)]=e;else this._loadedFuncs.push(e);this._loadedFuncMap[t]=e}else{this._loadedFuncs.push(e)}}},_runLoad:function(){this._isLoaded=true;for(var e=0;this._loadedFuncs[e];e++){this._loadedFuncs[e]()}this._loadedFuncs=[]},bind:function(e,t){if(!this._eventCBs[e]){this._eventCBs[e]=[]}this._eventCBs[e].push(t);var n=this;return function(){n.unbind(e,t)}},unbind:function(e,t){if(!this._eventCBs){return}if(this._eventCBs[e]&&this._eventCBs[e].length>0){this._eventCBs[e].removeVal(t)}},trigger:function(t){if(t==="ready"){this._runReady()}if(t==="load"){this._runLoad()}if(this._triggerActive){if(this._eventCBs[t]){var i=n.toArray(arguments).slice(1);var r=n.clone(this._eventCBs[t]);this._eventCBs[t].length=0;for(var a=0;a<r.length;a++){var o=r[a];var s=true;if(o){try{s=!o.apply(this,i)}catch(l){try{var u="Error in event";u+="\n event: "+t;e.BentoBox.logError(u,l)}catch(c){console.log(l)}}}else{s=false}if(s){this._eventCBs[t].push(o)}}}}},toggleTriggerState:function(e){if(e){this._triggerActive=e}else{this._triggerActive=!this._triggerActive}},destroy:function(){this._eventCBs=null;this._readyFuncs=null;this._readyFuncs=null;this._readyFuncMap=null;this._loadedFuncs=null;this._loadedFuncMap=null}});i.create=function(e){if(!e){e={}}var t=new i;n.extend(t,e);return t};e.Eventer=i})(Streak,window);(function(e){var t,n;function i(e,t){return[e,"{","animation-duration: 0.001s;","-o-animation-duration: 0.001s;","-ms-animation-duration: 0.001s;","-moz-animation-duration: 0.001s;","-webkit-animation-duration: 0.001s;","animation-name:",t,";","-o-animation-name:",t,";","-ms-animation-name:",t,";","-moz-animation-name:",t,";","-webkit-animation-name:",t,";","}"].join("")}t=n={initialized:false,watchedSelectors:{},animationCallbacks:{},initialize:function(){e.document.addEventListener("animationStart",n.animationStarted,false);e.document.addEventListener("MSAnimationStart",n.animationStarted,false);e.document.addEventListener("webkitAnimationStart",n.animationStarted,false)},watchForNewSelector:function(e,n){if(!t.initialized){t.initialize();t.initialized=true}if(!t.watchedSelectors[e]){t.generateNewSelectorWatch(e)}t.watchedSelectors[e].callbacks.push(n)},generateNewSelectorWatch:function(n){var r=("bb"+Date.now()+"."+Math.random()).replace(/\./gi,"");var a=["@-webkit-keyframes ",r," {","from { clip: rect(1px, auto, auto, auto); }"," to { clip: rect(0px, auto, auto, auto); }","}"].join("");e.CSSStyleManipulator.addRule(a,0);var o=i(n,r);e.CSSStyleManipulator.addRule(o,0);var s=[];t.watchedSelectors[n]={animationName:r,callbacks:s};t.animationCallbacks[r]=s},notifyWhenSelectorChanged:function(n,r,a){var o=("bb"+Date.now()+"."+Math.random()).replace(/\./gi,"");var s=o+"_initial";var l=o+"_change";e.CSSStyleManipulator.addRule(["@-webkit-keyframes ",s," {","from { clip: rect(auto, 0px, auto, auto); }"," to { clip: rect(auto, 1px, auto, auto); }","}"].join(""),0);e.CSSStyleManipulator.addRule(i(n,s),0);e.CSSStyleManipulator.addRule(["@-webkit-keyframes ",l," {","from { clip: rect(auto, 1px, auto, auto); }"," to { clip: rect(auto, 0px, auto, auto); }","}"].join(""),0);e.CSSStyleManipulator.addRule(i(r,l),0);t.animationCallbacks[s]=[a];t.animationCallbacks[l]=[a]},notifyAttributeChanged:function(e,t,n){if(!window.MutationObserver){return}var i=new MutationObserver(function(e){for(var i=0;i<e.length;i++){if(e[i].attributeName===t){n();return}}});i.observe(e,{attributes:true});return function(){i.disconnect()}},animationStarted:function(e){var n=t.animationCallbacks[e.animationName];if(n){var i=n.length;for(var r=0;r<i;r++){n[r](e.target)}}}};e.DomWatcher=n})(Streak);(function(e){var t={};var n=/^(.*[aeiouy].*)y$/;var i=/sses$/;var r=/^(.+?)([^s])s$/;var a=/^(.+?)eed$/;var o=/^(.+?)(ed|ing)$/;var s=/^(.+?)eed$/;var l=/^(.+?)(ed|ing)$/;var u=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;var c=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;var d=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;var h=/^(.+?)(s|t)(ion)$/;var f=/^(.+?)e$/;var p=/ll$/;var m=/([^aeiouylsz])\1$/;var _=/^([^aeiou][^aeiouy]*)?[aeiouy]/;var g=/^[^aeiou][^aeiouy]*[aeiouy][^aeiouwxy]$/;var v=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;var y=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*/;var w=/^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$/;var b=/.*generate?s?d?(ing)?$/;var C=/.*general(ly)?$/;var S=/.*generic(ally)?$/;var T=/.*generous(ly)?$/;var x=/.*communit(ies)?y?/;var k=function(){function e(){}function s(){console.log(Array.prototype.slice.call(arguments).join(" "))}var l={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},k={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};return function(M,L){var B=M;if(t[M]){return t[M]}var E,D,V,I,P,A,F=M;A=L?s:e;if(3>M.length)return M;V=M.substr(0,1);"y"==V&&(M=V.toUpperCase()+M.substr(1));I=i;D=r;I.test(M)?(M=M.replace(I,"$1$2"),A("1a",I,M)):D.test(M)&&(M=M.replace(D,"$1$2"),A("1a",D,M));I=a;D=o;I.test(M)?(D=I.exec(M),I=v,I.test(D[1])&&(I=/.$/,M=M.replace(I,""),A("1b",I,M))):D.test(M)&&(D=D.exec(M),E=D[1],D=_,D.test(E)&&(M=E,A("1b",D,M),D=/(at|bl|iz)$/,P=m,E=g,D.test(M)?(M+="e",A("1b",D,M)):P.test(M)?(I=/.$/,M=M.replace(I,""),A("1b",P,M)):E.test(M)&&(M+="e",A("1b",E,M))));I=n;I.test(M)&&(D=I.exec(M),E=D[1],M=E+"i",A("1c",I,M));I=u;I.test(M)&&(D=I.exec(M),E=D[1],D=D[2],I=v,I.test(E)&&(M=E+l[D],A("2",I,M)));I=c;I.test(M)&&(D=I.exec(M),E=D[1],D=D[2],I=v,I.test(E)&&(M=E+k[D],A("3",I,M)));I=d;D=h;I.test(M)?(D=I.exec(M),E=D[1],I=y,I.test(E)&&(M=E,A("4",I,M))):D.test(M)&&(D=D.exec(M),E=D[1]+D[2],D=y,D.test(E)&&(M=E,A("4",D,M)));I=f;if(I.test(M)&&(D=I.exec(M),E=D[1],I=y,D=w,P=g,I.test(E)||D.test(E)&&!P.test(E)))M=E,A("5",I,D,P,M);I=p;D=y;I.test(M)&&D.test(M)&&(I=/.$/,M=M.replace(I,""),A("5",I,D,M));"y"==V&&(M=V.toLowerCase()+M.substr(1));V={skis:"ski",skies:"sky",dying:"die",lying:"lie",tying:"tie",idly:"idl",gently:"gentl",ugly:"ugli",early:"earli",only:"onli",singly:"singl"};V[F]!=={}[F]&&(M=V[F],A("Special Word",M));-1!=="sky news howe atlas cosmos bias          andes inning outing canning herring          earring proceed exceed succeed".indexOf(F)&&(M=F,A("Special Word",M));I=b;I.test(F)&&(M+="at",A("Overstemmed",M));I=C;I.test(F)&&(M+="al",A("Overstemmed",M));I=S;I.test(F)&&(M+="ic",A("Overstemmed",M));I=T;I.test(F)&&(M+="ous",A("Overstemmed",M));I=x;I.test(F)&&(M+="iti",A("Overstemmed",M));t[B]=M;return M}}();k.clearWordCache=function(){t={}};e.Stemmer=k})(Streak);(function(e){var t=function(){this._mapOfFinishedFunctionKeys={};this._mapOfFunctionKeysToFunctionQueues={}};e._.extend(t.prototype,{addFunction:function(e){if(this._doesAddingThisFunctionCauseACycle(e)){throw new Error("cycle this",e)}if(this._shouldRunFunction(e)){this._runFunction(e)}else{this._queueFunctionParameters(e)}},notifyFunctionFinished:function(e){this._mapOfFinishedFunctionKeys[e]=true;this._checkDependentFunctions(e)},_doesAddingThisFunctionCauseACycle:function(e,t){t=t||[];var n=e.functionKey;if(!n){return true}var i=e.dependentFunctionKeys;if(!i){return false}var r=this._mapOfFunctionKeysToFunctionQueues[n];if(!r||r.length===0){return false}if(t.indexOf(n)>-1){return true}t.push(n);for(var a=0;a<r.length;a++){var o=r[a];if(this._doesAddingThisFunctionCauseACycle(o,t.slice(0))){return true}}return false},_shouldRunFunction:function(e){return!this._mapOfFinishedFunctionKeys[e.functionKey]&&this._haveAllDependentFunctionsFinished(e)},_haveAllDependentFunctionsFinished:function(e){var t=e.dependentFunctionKeys;if(!t){return true}var n=false;for(var i=0;i<t.length;i++){n=n||!this._mapOfFinishedFunctionKeys[t[i]]}if(n){return false}else{return true}},_runFunction:function(t){if(t.functionReference){this._runFunctionInNewWay(t);return}var n=t.functionToCall;var i=t.functionKey;var r=t.functionContext;var a=this;if(!n||!i){return}try{var o=setTimeout(function(){e.BentoBox.logError("function timed out",i)},60*1e3);n.call(r,function(){clearTimeout(o);a._mapOfFinishedFunctionKeys[i]=true;a._checkDependentFunctions(i)})}catch(s){if(o){clearTimeout(o)}console.error("Dependency Manager. Error in:",i,t,s.stack);e.BentoBox.logError("Dependency Manager, error in run function "+i,s)}},_runFunctionInNewWay:function(t){var n=this;var i=t.functionReference;var r=t.functionKey;var a=t.functionContext;if(!i||!r){return}try{var o=i.call(a);if(!o){this._mapOfFinishedFunctionKeys[r]=true;this._checkDependentFunctions(r);return}var s=setTimeout(function(){e.BentoBox.logError("function timed out",r)},60*1e3);o.then(function(){clearTimeout(s);n._mapOfFinishedFunctionKeys[r]=true;n._checkDependentFunctions(r)},function(t){clearTimeout(s);e.BentoBox.logError("Dependency Manager, async error in function "+r,t)})}catch(l){if(s){clearTimeout(s)}console.error("Dependency Manager. Error in:",r,t,l.stack);e.BentoBox.logError("Dependency Manager, error in run function "+r,l)}},_checkDependentFunctions:function(e){var t=this._mapOfFunctionKeysToFunctionQueues[e];if(!t){return false}for(var n=0;n<t.length;n++){var i=t[n];if(this._shouldRunFunction(i)){this._runFunction(i)}}},_queueFunctionParameters:function(e){var t=e.dependentFunctionKeys;if(!t){return}for(var n=0;n<t.length;n++){var i=t[n];this._addFunctionParametersToRespectiveFunctionQueue(i,e)}},_addFunctionParametersToRespectiveFunctionQueue:function(e,t){var n=this._mapOfFunctionKeysToFunctionQueues[e];if(!n){n=[];this._mapOfFunctionKeysToFunctionQueues[e]=n}n.push(t)}});e.DependencyManager=new t})(Streak);(function(e){var t=e._;ObjectPath={create:function(e){return new ObjectPath.impl(e)},impl:function(e){var n={},i=null,r=e;if(r){try{i=JSON.parse(r)}catch(a){}}if(!i){i={}}n.get=function(e){var t=e.split("/");var n=i[t[0]];for(var r=1;r<t.length;r++){if(!n){return null}n=n[t[r]]}return n};n.set=function(e,n){var r=e.split("/");if(r.length===1){i[r[0]]=n}else if(r.length>1){var a=i[r[0]];if(!a){a={}}var o=a;for(var s=1;s<r.length-1;s++){var l=o[r[s]];if(!l){l={};o[r[s]]=l}o=l}o[t.last(r)]=n;i[r[0]]=a}};n.remove=function(e){var t=e.split("/");var n=null;for(var r=0;r<t.length-1;r++){n=i[n[r]];if(!n){return}}delete n[t.length-1]};n.toString=function(){return JSON.stringify(i)};n.object=i;return n}};e.ObjectPath=ObjectPath})(Streak);/*!
 * string_score.js: String Scoring Algorithm 0.1.20
 *
 * http://joshaven.com/string_score
 * https://github.com/joshaven/string_score
 *
 * Copyright (C) 2009-2011 Joshaven Potter <yourtech@gmail.com>
 * Special thanks to all of the contributors listed here https://github.com/joshaven/string_score
 * MIT license: http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Tue Mar 1 2011
 * Updated: Tue Jun 11 2013
*/
Streak.Utils.stringScore=function(e,t,n){if(e==t)return 1;if(t=="")return 0;var i=0,r,a,o=e.toLowerCase(),s=e.length,l=t.toLowerCase(),u=t.length,c,d=0,h=1,f;if(n)f=1-n;if(n){for(var p=0;p<u;++p){c=o.indexOf(l[p],d);if(-1===c){h+=f;continue}else if(d===c){r=.7}else{r=.1;if(e[c-1]===" ")r+=.8}if(e[c]===t[p])r+=.1;i+=r;d=c+1}}else{for(var p=0;p<u;++p){c=o.indexOf(l[p],d);if(-1===c){return 0}else if(d===c){r=.7}else{r=.1;if(e[c-1]===" ")r+=.8}if(e[c]===t[p])r+=.1;i+=r;d=c+1}}a=.5*(i/s+i/u)/h;if(l[0]===o[0]&&a<.85){a+=.15}return a};(function(e){var t={VERSION:"2.0.0",create:function(e,n){var i;var r=typeof e.initial=="string"?{state:e.initial}:e.initial;var a=n||e.target||{};var o=e.events||[];var s=e.callbacks||{};var l={};var u=function(e){var t=e.from instanceof Array?e.from:[e.from];l[e.name]=l[e.name]||{};for(var n=0;n<t.length;n++)l[e.name][t[n]]=e.to};if(r){r.event=r.event||"startup";u({name:r.event,from:"none",to:r.state})}for(var c=0;c<o.length;c++)u(o[c]);for(i in l){if(l.hasOwnProperty(i))a[i]=t.buildEvent(i,l[i])}for(i in s){if(s.hasOwnProperty(i))a[i]=s[i]}a.current="none";a.is=function(e){return this.current==e};a.can=function(e){return!!l[e][this.current]&&!this.transition};a.cannot=function(e){return!this.can(e)};if(r&&!r.defer)a[r.event]();return a},beforeEvent:function(e,t,n,i){var r=this["onbefore"+e];if(r)return r.apply(this,[e,t,n].concat(i))},afterEvent:function(e,t,n,i){var r=this["onafter"+e]||this["on"+e];if(r)return r.apply(this,[e,t,n].concat(i))},leaveState:function(e,t,n,i){var r=this["onleave"+t];if(r)return r.apply(this,[e,t,n].concat(i))},enterState:function(e,t,n,i){var r=this["onenter"+n]||this["on"+n];if(r)return r.apply(this,[e,t,n].concat(i))},changeState:function(e,t,n,i){var r=this["onchangestate"];if(r)return r.apply(this,[e,t,n].concat(i))},buildEvent:function(e,n){return function(){if(this.transition){console.log("event "+e+" innapropriate because previous transition did not complete");return}if(this.cannot(e)){console.log("event "+e+" innapropriate in current state "+this.current);return}var i=this.current;var r=n[i];var a=Array.prototype.slice.call(arguments);if(false===t.beforeEvent.call(this,e,i,r,a))return;var o=this;this.transition=function(){o.transition=null;o.current=r;t.enterState.call(o,e,i,r,a);t.changeState.call(o,e,i,r,a);t.afterEvent.call(o,e,i,r,a)};if(false!==t.leaveState.call(this,e,i,r,a)){if(this.transition)this.transition()}}}};e.Streak.StateMachine=t})(window);(function(e){var t={alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",urlSafeAlphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",lookup:null,ie:/MSIE /.test(window.navigator.userAgent),ieo:/MSIE [67]/.test(window.navigator.userAgent),encode:function(e){var n=t.toUtf8(e),i=-1,r=n.length,a,o,s,l=[,,,];if(t.ie){var u=[];while(++i<r){a=n[i];o=n[++i];l[0]=a>>2;l[1]=(a&3)<<4|o>>4;if(isNaN(o))l[2]=l[3]=64;else{s=n[++i];l[2]=(o&15)<<2|s>>6;l[3]=isNaN(s)?64:s&63}u.push(t.alphabet.charAt(l[0]),t.alphabet.charAt(l[1]),t.alphabet.charAt(l[2]),t.alphabet.charAt(l[3]))}return u.join("")}else{var u="";while(++i<r){a=n[i];o=n[++i];l[0]=a>>2;l[1]=(a&3)<<4|o>>4;if(isNaN(o))l[2]=l[3]=64;else{s=n[++i];l[2]=(o&15)<<2|s>>6;l[3]=isNaN(s)?64:s&63}u+=t.alphabet[l[0]]+t.alphabet[l[1]]+t.alphabet[l[2]]+t.alphabet[l[3]]}return u}},decode:function(e){if(e.length%4)throw new Error("InvalidCharacterError: 'B64.decode' failed: The string to be decoded is not correctly encoded.");var n=t.fromUtf8(e),i=0,r=n.length;if(t.ieo){var a=[];while(i<r){if(n[i]<128)a.push(String.fromCharCode(n[i++]));else if(n[i]>191&&n[i]<224)a.push(String.fromCharCode((n[i++]&31)<<6|n[i++]&63));else a.push(String.fromCharCode((n[i++]&15)<<12|(n[i++]&63)<<6|n[i++]&63))}return a.join("")}else{var a="";while(i<r){if(n[i]<128)a+=String.fromCharCode(n[i++]);else if(n[i]>191&&n[i]<224)a+=String.fromCharCode((n[i++]&31)<<6|n[i++]&63);else a+=String.fromCharCode((n[i++]&15)<<12|(n[i++]&63)<<6|n[i++]&63)}return a}},toUtf8:function(e){var t=-1,n=e.length,i,r=[];if(/^[\x00-\x7f]*$/.test(e))while(++t<n)r.push(e.charCodeAt(t));else while(++t<n){i=e.charCodeAt(t);if(i<128)r.push(i);else if(i<2048)r.push(i>>6|192,i&63|128);else r.push(i>>12|224,i>>6&63|128,i&63|128)}return r},fromUtf8:function(e){var n=-1,i,r=[],a=[,,,];var o=t.alphabet;var s="lookup";if(e.indexOf("-")>-1||e.indexOf("_")>-1){o=t.urlSafeAlphabet;s="urlSafeLookup"}if(!t[s]){i=t.alphabet.length;t[s]={};while(++n<i)t[s][o.charAt(n)]=n;n=-1}i=e.length;while(++n<i){a[0]=t[s][e.charAt(n)];a[1]=t[s][e.charAt(++n)];r.push(a[0]<<2|a[1]>>4);a[2]=t[s][e.charAt(++n)];if(a[2]==64)break;r.push((a[1]&15)<<4|a[2]>>2);a[3]=t[s][e.charAt(++n)];if(a[3]==64)break;r.push((a[2]&3)<<6|a[3])}return r}};e.B64=t})(Streak);(function(e){var t=e._;var n={FULFILLED:"FULFILLED",REJECTED:"REJECTED",PENDING:"PENDING",CANCELLED:"CANCELLED"};var i=function(t){this._successCallbacks=[];this._failureCallbacks=[];this._doneCallbacks=[];this._state=n.PENDING;this._result=undefined;this._creationStack=e.Utils.getStackTrace();t(this._resolve.bind(this),this._reject.bind(this))};e._.extend(i.prototype,{_resolve:function(e){if(this._state===n.PENDING){this._state=n.FULFILLED;this._result=e;var t=this;setTimeout(function(){t._notify(t._successCallbacks,true);t._notify(t._doneCallbacks);t._clearCallbacks()},0)}},_reject:function(e){if(this._state===n.PENDING){this._state=n.REJECTED;this._result=e;var t=this;setTimeout(function(){t._notify(t._failureCallbacks,true);t._notify(t._doneCallbacks);t._clearCallbacks()},0)}},_notify:function(e,t){if(!e){return}for(var n=0;n<e.length;n++){var i=e[n];if(t)i(this._result);else i()}},_clearCallbacks:function(){delete this._successCallbacks;delete this._failureCallbacks;delete this._doneCallbacks},_callCallback:function(e,t){if(this._state===n.CANCELLED){return}e(t)},then:function(e,t){if(this._state===n.PENDING){if(e){this._successCallbacks.push(e)}if(t){this._failureCallbacks.push(t)}}else if(this._state===n.FULFILLED){if(e){setTimeout(this._callCallback.bind(this),0,e,this._result)}}else if(this._state===n.REJECTED){if(t){setTimeout(this._callCallback.bind(this),0,t,this._result)}}},done:function(e){if(!e){return}if(this._state===n.PENDING){this._doneCallbacks.push(e)}else if(this._state!==n.CANCELLED){setTimeout(e,0)}},cancel:function(){this._state=n.CANCELLED;this._clearCallbacks()}});i.thenResolve=function(e){return new i(function(t,n){t(e)})};i.thenReject=function(e){return new i(function(t,n){n(e)})};i.defer=function(){var e={};e.promise=new i(function(t,n){e.resolve=t;e.reject=n});return e};e.Promise=i})(Streak);(function(e){var t=e.Date;var n={};e.DateString={format:function(e,i){if(!e){return""}if(!n[e+"_"+i]){n[e+"_"+i]=t.create(e).customFormat(i)}return n[e+"_"+i]},prettyDate:function(e){if(!e){return""}if(!n[e+"_"+"prettyDate"]){var i=t.create(e);if(i){n[e+"_"+"prettyDate"]=i.prettyDate(true)}}return n[e+"_"+"prettyDate"]},prettyDateTime:function(e){if(!e){return""}if(!n[e+"_"+"prettyDateTime"]){var i=t.create(e);if(i){n[e+"_"+"prettyDateTime"]=i.prettyDate()}}return n[e+"_"+"prettyDateTime"]}}})(Streak);(function(e){"use strict";var t=e._;function n(e){return e.replace(/=([A-Fa-f0-9]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))})}function i(e){var t=e.indexOf("\n\n");return{headers:e.slice(0,t),body:e.slice(t+2)}}function r(e){if(a(e.headers)=="base64"){return atob(e.body)}else{return n(e.body)}}function a(e){var t=e.match(/^Content-Transfer-Encoding:\s+(\S+)/im);return t&&t[1]}function o(e){var t=e.match(/^x-attachment-id:\s+(\S+)/im);return t&&t[1]}function s(e){var t=e.match(/^content-type:\s+(\S+?)(?:;\s.*\bname="([^"]+)")/im);return{type:t&&t[1],name:t&&t[2]}}var l={getAttachment:function(e,n){n=n.replace(/\r\n/g,"\n");var a=n.match(/^content-type:.*/im);if(!a){throw new Error("Could not get email Content-Type")}var l=a[0].match(/boundary=(\S+)/);if(!a){throw new Error("Email Content-Type lacks boundary")}var u=l[1];var c=t.map(n.split("--"+u),i);var d=t.find(c,function(t){return o(t.headers)===e});if(!d){return null}var h=s(d.headers).type;var f=r(d);var p=new Uint8Array(f.length);for(var m=0;m<f.length;m++){p[m]=f.charCodeAt(m)}return new Blob([p],{type:h})}};e.EmailParser=l})(Streak);(function(e){var t=e._;var n=function(){};t.extend(n.prototype,{mixin:function(e){var n=t.rest(arguments);for(var i=0;i<n.length;i++){var r=n[i];var a=r(e);a.superclass=e;e=this.subclass(a)}return e},subclass:function(e){var n=e.superclass;if(e._memberVariables){e.memberVariables=e._memberVariables;delete e._memberVariables}var i=e.memberVariables||[];this._validateMemberVariables(i);var r=function(){n.apply(this,arguments)};r.name=e.className;r.prototype=Object.create(n.prototype);t.extend(r.prototype,this._extractSubclassProperties(e));if(i.length){r.prototype._streak__memberVariables=i}return r},_validateMemberVariables:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.name===undefined){throw new Error("name is a required parameter to memberVariables")}if(n.destroy===undefined){throw new Error("destroy is a required parameter to memberVariables")}for(var i in n){if(["name","destroy","get","set","defaultValue"].indexOf(i)==-1){throw new Error(i+" is not a valid parameter to memberVariables")}}}},_extractSubclassProperties:function(e){var n=t.omit(e,"superclass","memberVariables");this._createGettersAndSetters(n,e);return n},_createGettersAndSetters:function(e,t){var n=this;var i=t.memberVariables;if(i){for(var r=0;r<i.length;r++){var a=i[r];var o=a.name;if(a.get){this._makeGetterFunction(e,o)}if(a.set){this._makeSetterFunction(e,o)}}}},_makeGetterFunction:function(e,t){var n=this._getterName(t);if(e[n]){return}e[n]=function(){return this[t]}},_getterName:function(e){return"get"+e.charAt(1).toUpperCase()+e.slice(2)},_makeSetterFunction:function(e,t){var n=this._setterName(t);if(e[n]){return}e[n]=function(e){this[t]=e}},_setterName:function(e){return"set"+e.charAt(1).toUpperCase()+e.slice(2)}});e.Class=new n})(Streak);(function(e){var t=e._;var n=function(){this._nullifyMemberVariables();this._initializeDefaultValues();this._initialize.apply(this,t.toArray(arguments))};t.extend(n.prototype,{memberVariables:[],_nullifyMemberVariables:function(e){var t=this;var n;while(n=Object.getPrototypeOf(t)){t=n;if(t._streak__memberVariables){for(var i=0;i<t._streak__memberVariables.length;i++){var r=t._streak__memberVariables[i];this._nullifyMemberVariable(r.name,e&&r.destroy)}}}},_nullifyMemberVariable:function(e,n){if(!n){this[e]=null;return}var i=this[e];if(!i){return}if(t.isArray(i)){for(var r=0;r<i.length;r++){if(!i[r]){continue}if(i[r].destroy){i[r].destroy()}if(i[r].remove){i[r].remove()}}i.length=0}else if(i.destroy){i.destroy()}else if(i.remove){i.remove()}else if(i.end){i.end()}else if(t.isObject(i)){for(var a in i){if(i[a]){if(i[a].destroy){i[a].destroy()}else if(i[a].remove){try{i[a].remove()}catch(o){}}}}}else if(t.isFunction(i)){i()}},_initializeDefaultValues:function(){var e=this;var n;while(n=Object.getPrototypeOf(e)){e=n;if(e._streak__memberVariables){for(var i=0;i<e._streak__memberVariables.length;i++){var r=e._streak__memberVariables[i];if(r.defaultValue!==undefined){this[r.name]=t.clone(r.defaultValue)}}}}},_initialize:function(){},destroy:function(){this._nullifyMemberVariables(true);if(e.NotificationCenter){e.NotificationCenter.unsubscribe({observer:this})}}});e.Object=n})(Streak);(function(e){var t=e.Class.subclass({superclass:e.Object,set:function(t,n){var i=t.split(".");var r=null;var a=e;for(var o=0;o<i.length-1;o++){r=a;a=a[i[o]];if(!a){a={};r[i[o]]=a}}a[i[i.length-1]]=n},get:function(t){var n=t.split(".");var i=e;for(var r=0;r<n.length;r++){i=i[n[r]];if(!i){return null}}return i},getInstance:function(e){var t=this.get(e);var n=Array.prototype.slice.call(arguments,1);var i=t.bind.apply(t,[null].concat(n));return new i}});e.Library=new t})(Streak);(function(e){var t=e._,n=e.Bacon;var i=e.Class.subclass({className:"Request",superclass:e.Object,_memberVariables:[{name:"_xhr",destroy:false,get:true},{name:"_method",destroy:false},{name:"_server",destroy:false},{name:"_path",destroy:false},{name:"_url",destroy:false},{name:"_options",destroy:false},{name:"_responseType",destroy:false},{name:"_attempts",destroy:false,defaultValue:1},{name:"_currentBackoff",destroy:false},{name:"_retryTimeout",destroy:false},{name:"_eventStream",destroy:false},{name:"_simplePromise",destroy:false},{name:"_deferred",destroy:false}],_initialize:function(n,r,a,o){e.Object.prototype._initialize.call(this);var s=this;this._currentBackoff=i._retryTime;this._method=n;this._server=r;this._path=a;this._options=o||{};this._responseType=this._options.responseType||"json";this._retry=this._options.retry!==false;this._deferred=e.RSVP.defer();if(t.has(i._serverVersionErrors,e.server)||t.has(i._serverVersionErrors,r)){this._deferred.promise.catch(function(){});this._deferred.reject(new Error("Request has been torn down after minimum version error"));return}if(this._options.neverLogError){this._deferred.promise.catch(function(){})}this._constructURL();this._startRequest()},_setQueryParameter:function(e,t){if(!this._options.queryParameters){this._options.queryParameters={}}this._options.queryParameters[e]=t},_constructURL:function(){this._url=this._server+this._path;if(this._options.queryParameters){var e=this._urlEncode(this._options.queryParameters);if(this._url.indexOf("?")===-1){this._url+="?"+e}else{this._url+="&"+e}}},_startRequest:function(){var n=this;this._xhr=new XMLHttpRequest;if(!this._options.isAnonymous){this._xhr.withCredentials=true}if(this._responseType!="json"){this._xhr.responseType=this._responseType}this._xhr.onreadystatechange=this._handleXhrStateChange.bind(this);this._xhr.open(this._method,this._url,true);if(this._options.contentType){this._xhr.setRequestHeader("Content-type",this._options.contentType)}else{this._xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")}if(this._options.useStreakHeaders){this._xhr.setRequestHeader("X-Streak-Web-Client","true");this._xhr.setRequestHeader("X-Streak-Web-Client-Version",e.clientVersion);this._xhr.setRequestHeader("X-Streak-Web-Extension-Version",e.extVersion);this._xhr.setRequestHeader("X-Streak-Web-Retry-Count",this._attempts-1)}t.each(this._options.headers,function(e,t){n._xhr.setRequestHeader(t,e)});var i;if(this._options.bodyData){i=this._urlEncode(this._options.bodyData)}this._xhr.send(i)},_handleXhrStateChange:function(){if(this._xhr.readyState!==4){return}if(this._isRequestASuccess()){this._handleSuccessfulRequest()}else{this._handleFailedRequest()}},_isRequestASuccess:function(){return this._xhr.status>=200&&this._xhr.status<=299},_handleSuccessfulRequest:function(){var e;if(this._responseType=="json"){var t=this._xhr.getResponseHeader("content-type");if(!t||!t.match("application/json")){console.warn("Resource interpreted as JSON but transferred with MIME type "+t+":",this._url)}try{e=JSON.parse(this._xhr.responseText)}catch(n){n.details={url:this._url};this._deferred.reject(n);return}}else{e=this._xhr.response}this._deferred.resolve({xhr:this._xhr,response:e})},_handleFailedRequest:function(){if(!this._hasExhaustedAttempts()&&t.contains([0,500],this._xhr.status)){this._retryRequest()}else{this._failRequest()}},_hasExhaustedAttempts:function(){return!this._retry||this._attempts>=i._retryAttempts},_retryRequest:function(){this._attempts++;this._currentBackoff=Math.min(this._currentBackoff*i._retryGrowthFactor,i._retryTimeMax);this._retryTimeout=setTimeout(this._startRequest.bind(this),this._currentBackoff)},_failRequest:function(){var n=null;var r=this._xhr.getResponseHeader("content-type");var a=!!(r&&r.match("application/json"));try{n=JSON.parse(this._xhr.responseText);if(!a){console.warn("Resource interpreted as JSON but transferred with MIME type "+r+":",this._url)}}catch(o){try{n=JSON.parse(this._xhr.response);if(!a){console.warn("Resource interpreted as JSON but transferred with MIME type "+r+":",this._url)}}catch(s){n=this._xhr.response;if(a){console.warn("Resource interpreted as text but transferred with MIME type "+r+":",this._url)}}}if(this._isOldClientVersion(n)){e.BentoBox.trigger("newClientVersion");i._serverVersionErrors[this._server]=true;this._deferred.promise.catch(function(){})}if(this._isOldExtensionVersion(n)){e.BentoBox.trigger("newExtVersion");i._serverVersionErrors[this._server]=true;this._deferred.promise.catch(function(){})}if(t.contains([0,400,500,503],this._xhr.status)&&!this._options.neverLogError){this._logError()}var l=new Error("Bad response from server");l.response=n;l.xhr=this._xhr;l.details={status:this._xhr.status,url:this._url,response:n};this._deferred.reject(l)},_logError:function(){if(!this._xhr){return}var t,n=this._xhr.response;var i;if(this._xhr.status===500){i="500 error from server"}else if(this._xhr.status===0){i="Crap, status "+this._xhr.status}else{i="Error from server";if(n){try{t=JSON.parse(n)}catch(r){t=n;i+="\n failed to json parse response"}}if(t&&t.error){i=t.error}i+="\n status: "+this._xhr.status}i+="\n url: "+this._url;i+="\n options: "+JSON.stringify(this._options);i+="\n response: "+n;e.BentoBox.logError(i)},_isOldClientVersion:function(e){if(!e){return false}return e.error==="clientVersionNotSupported"},_isOldExtensionVersion:function(e){if(!e){return false}return e.error==="extVersionNotSupported"},_urlEncode:function(e){if(t.isString(e)){return e}var n="";if(e){for(var i in e){var r=e[i];if(t.isArray(r)){r=JSON.stringify(r)}n+="&"+encodeURIComponent(i)+"="+encodeURIComponent(r)}}return n.substring(1)},getEventStream:function(){if(!this._eventStream){var e=this.getPromise();var t={then:e.then.bind(e),abort:this.abort.bind(this)};this._eventStream=n.fromPromise(t,true)}return this._eventStream},getPromise:function(){if(!this._simplePromise){this._simplePromise=this._deferred.promise.then(function(e){return e.response})}return this._simplePromise},getExtendedPromise:function(){return this._deferred.promise},abort:function(){return this.cancel()},cancel:function(){this.destroy()},destroy:function(){if(!this._xhr){return}clearTimeout(this._retryTimeout);this._xhr.onreadystatechange=null;this._xhr.abort();this._deferred.reject(new Error("Canceled"));e.Object.prototype.destroy.call(this)}});i._retryTime=2*1e3;i._retryGrowthFactor=1.5;i._retryTimeMax=32*1e3;i._retryAttempts=5;i._serverVersionErrors={};i._resetVersionError=function(e){delete i._serverVersionErrors[e]};e.Request=i})(Streak);(function(e){var t=e._;var n={API_PREFIX:"/api/v1/"};var i={request:function(i,r,a,o,s){var l;if(s&&s.serverOverride){l=s.serverOverride;delete s.serverOverride}else{l=e.server}if(!o){o={}}if(!s||!s.isAnonymous){if(e.ai){o.ai=true;o.email=e.ai}else{o.email=e.userEmail;if(e.originalEmail){o.originalEmail=e.originalEmail}}}var u=s&&s.prefix?s.prefix:n.API_PREFIX;return new e.Request(i,l,u+r,t.extend({useStreakHeaders:!s||!s.isAnonymous,bodyData:a,queryParameters:o},s||{}))},get:function(e,t,n){return this.request("GET",e,null,t,n)},post:function(e,t,n,i){return this.request("POST",e,t,n,i)},put:function(e,t,n,i){return this.request("PUT",e,t,n,i)},"delete":function(e,t,n){return this.request("DELETE",e,null,t,n)},error:t.throttle(function(e){return this.put("webclient/errors",null,{error:e},{neverLogError:true,responseType:"text"})},1500),_resetVersionError:function(){e.Request._resetVersionError(e.server)}};e.APIRequester=i})(Streak);(function(e){"use strict";var t=e._,n=e.Bacon,i=e.RSVP,r=e.BentoBox;var a=new i.Promise(function(t,n){e.DependencyManager.addFunction({functionKey:"relayRequestReady",functionReference:t.bind(null,null),dependentFunctionKeys:["gmailLoaded"]})});var o=function(){var e=Math.random()*1e9|0;var t=Math.random()*1e9|0;return function(){return"id"+e+t++}}();function s(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,false,t);document.dispatchEvent(n)}function l(e){var t=this;this._opts=e;this._id=o();this._promise=a.then(function(){return new i.Promise(function(i,r){n.fromEventTarget(document,"streakRelayResponse").filter(function(e){return e.detail&&e.detail.id===t._id}).take(1).onValue(function(e){var t=e.detail.status;var n=e.detail.responseText;if(t==200){i(n)}else{var a=new Error("Connection failed with status "+t);a.xhr={status:t,responseText:n};r(a)}});s("streakRelayStart",{id:t._id,method:e.method,url:e.url,body:e.body,headers:e.headers,xhrFields:e.xhrFields})})})}l.prototype.getPromise=function(){return this._promise};e.RelayRequest=l})(Streak);(function(){"use strict";var e=Streak._,t=Streak.Bacon,n=Streak.$,i=Streak.APIRequester;var r=Element.prototype.appendChild;var a=Element.prototype.removeChild;var o=Streak.CSPBypass={appendChild:function(t,n){if(Streak.isNotContentScript){var i={tagName:t.tagName,innerHTML:t.innerHTML,attributes:{}};e.each(t.attributes,function(e){i.attributes[e.nodeName]=e.nodeValue});var a="a"+Math.random();i.attributes.id=a;var o=document.createEvent("CustomEvent");o.initCustomEvent("extensionAppendRequest",true,false,i);try{n.dispatchEvent(o)}catch(s){setTimeout(function(){throw s},1)}var l=document.getElementById(a);if(l){if(!t.id){l.removeAttribute("id")}else{var u=t.id;t.removeAttribute("id");l.id=u}return l}}return r.apply(n,arguments)}};Element.prototype.appendChild=function(a){if(a&&a.nodeName=="SCRIPT"){if(Streak.isNotContentScript){var s=o.appendChild(a,this);if(s!==a){a._streak_real=s;a.type="text/dummy";r.apply(this,arguments);var l=["load","error"];var u=function(e){setTimeout(a.dispatchEvent.bind(a,e),1)};l.forEach(function(e){s.addEventListener(e,u,true)})}return s}else{if(a.src){var c=["https://www.google.com/","https://apis.google.com/","https://www.linkedin.com/","https://platform.linkedin.com/"];var d=!!e.find(c,function(e){return a.src.startsWith(e)});if(d){a.type="text/dummy";i.get("getscript",{url:a.src},{responseType:"text"}).getPromise().then(function(e){try{var t=eval;t(e+"\n//# sourceURL="+a.src+"\n")}finally{var n=document.createEvent("Event");n.initEvent("load",true,false);a.dispatchEvent(n)}},function(e){var t=document.createEvent("ErrorEvent");t.initEvent("error",true,false);a.dispatchEvent(t);throw e})}else{var h=n.deparam(a.src).callback;if(h){var f="streakJSONP-"+Math.random();t.fromEventTarget(document,f).take(1).onValue(function(e){window[h].apply(window,e.detail)});var p=document.createElement("script");p.type="text/javascript";p.text="window["+JSON.stringify(h)+"] = function() {\n"+'  var event = document.createEvent("CustomEvent");\n'+"  event.initCustomEvent("+JSON.stringify(f)+", true, false,\n"+"    Array.prototype.slice.call(arguments, 0));\n"+"  document.dispatchEvent(event);\n"+"  delete window["+JSON.stringify(h)+"];\n"+"};\n";document.head.appendChild(p).remove()}}}}}return r.apply(this,arguments)};Element.prototype.removeChild=function(e){if(e&&e._streak_real){try{a.apply(this,[e._streak_real])}catch(t){}}return a.apply(this,arguments)}})();(function(){"use strict";var e=Streak._;var t=false;try{t=new Function("return true;")()}catch(n){}Streak.newFunction=function(n){var i;if(arguments.length>1){i=e.initial(arguments);n=arguments[arguments.length-1]}else{i=[]}if(t){return new(Function.bind.apply(Function,[null].concat(i).concat([n])))}else{var r="_eval_temp_"+Math.random();Streak[r]={};var a=i.join(",");var o=""+"try {\n"+" Streak["+JSON.stringify(r)+"].result=(function("+a+"){"+n+"});\n"+"} catch(e) {\n"+" Streak["+JSON.stringify(r)+"].error = e;\n"+"}\n";var s=document.createElement("script");s.type="text/javascript";s.text=o;document.head.appendChild(s).parentNode.removeChild(s);var l=Streak[r];delete Streak[r];if(e.has(l,"error")){throw l.error}if(!e.has(l,"result")){throw new Error("appended script did not run")}return l.result}};Streak.evalExpression=function(e){return Streak.newFunction("return ("+e+");")()};Streak.runWithFunctionWrapper=function(e){if(t){return e()}else{var n=Function;Function=Streak.newFunction;try{return e()}finally{Function=n}}};var i=e.template;e.template=function(e,t,n){if(t){console.warn("Using _.template without precompilation!")}var r=this,a=arguments;return Streak.runWithFunctionWrapper(function(){return i.apply(r,a)})}})();(function(e){var t=e._;var n=function(){this._subscriptions=[];this._activeTransactionIds=[];this._transactionEventMap={};this._notificationBus=new e.Bacon.Bus};e._.extend(n.prototype,{subscribe:function(e){if(!e.observer){throw new Error("subscription needs observer")}if(e.eventName){e.filterParameters=e.filterParameters||{};e.filterParameters.eventName=e.eventName}this._subscriptions.push(e)},unsubscribe:function(e){this._subscriptions=t.filter(this._subscriptions,function(n){return!t.isObjectASuperset(e,n)})},postNotification:function(e,t){if(!e.eventName){throw new Error("notification needs eventName")}if(t){e.transactionId=t}if(this._isInTransaction(t)){this._addToTransactionEvents(e,t);return}this._notifyRelevantSubscriptions(e);this._notificationBus.push(e)},areThereSubscribers:function(e){for(var n=0;n<this._subscriptions.length;n++){var i=this._subscriptions[n];if(t.isObjectASuperset(i.filterParameters,e)){return true}}return false},startTransaction:function(e){this._activeTransactionIds.push(e)},endTransaction:function(e,t){this._activeTransactionIds.removeVal(e);if(t){this._discardTransactionEvents(e)}this._callTransactionBlockedNotifications(e)},getNotificationStream:function(){return this._notificationBus},_notifyRelevantSubscriptions:function(n){if(!n){return}var i=t.clone(this._subscriptions);var r=[];for(var a=0;a<i.length;a++){var o=i[a];if(t.isObjectASuperset(o.filterParameters,n)){try{this._notifySubscription(o,n)}catch(s){e.BentoBox.logError("Error with notification",s)}if(o.unsubscribeImmediately){r.push(o)}}}for(var a=0;a<r.length;a++){this._subscriptions.removeVal(r[a])}},_isInTransaction:function(e){if(!e){return false}return this._activeTransactionIds.indexOf(e)>-1},_addToTransactionEvents:function(e,t){if(!this._transactionEventMap[t]){this._transactionEventMap[t]=[]}this._transactionEventMap[t].push(e)},_discardTransactionEvents:function(e){delete this._transactionEventMap[e]},_callTransactionBlockedNotifications:function(e){var t=this._transactionEventMap[e];if(!t){delete this._transactionEventMap[e];return}for(var n=0;n<t.length;n++){this.postNotification(t[n])}delete this._transactionEventMap[e]},_notifySubscription:function(e,t){if(e.functionToCall){e.functionToCall.call(e.observer,t);return}e.observer.notify(t)}});e.NotificationCenter=new n})(Streak);(function(e){var t=e._;var n=function(){this._delegates=[]};t.extend(n.prototype,{addDelegate:function(e){this._delegates.push(e)},removeAllDelegates:function(){this._delegates=[]},_callDelegateFunction:function(e){var n=t.rest(t.toArray(arguments));for(var i=0;i<this._delegates.length;i++){if(this._delegates[i][e]){this._delegates[i][e].apply(this._delegates[i],n)}}},destroy:function(){this._delegates.length=0}});e.ViewControllerBase=n})(Streak);(function(e){var t=100;e.fn.autoComplete=function(n){return this.each(function(){var n=this;var i=e(this);var r=e(document.createElement("div"));r[0].setAttribute("class","shadowInput");var a=e(document.createElement("div"));a[0].setAttribute("class","shadowInputInner");var o=[];var s=[];var l=e(document.createElement("ul"));l[0].setAttribute("class","SK AX bbAutocompleteList");var u=null;var c="J-N-JT";var d;var h;i.after(r);this.setAutoCompleteList=function(e){o=e||[];l.empty();a[0].innerHTML="";l.detach()};this.onscroll=function(){if(l.is(":FastVisible")){y()}};i.bind({keydown:function(e){if(e.which===16){return}if(!h){h=""}if(Streak.jwerty.is("right",e)){if(_()&&l.is(":FastVisible")&&l.find("li."+c).length===0){var t=M();var n=x().value;if(t!==n){L(x().value);i.caret().goToEnd();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();d=M()}return}}else if(Streak.jwerty.is("up",e)){if(l.is(":FastVisible")){T("prev",e)}}else if(Streak.jwerty.is("down",e)){if(l.is(":FastVisible")){T("next",e)}else{d=M();f()}}else if(Streak.jwerty.is("tab",e)||Streak.jwerty.is("shift+tab",e)){}else if(Streak.jwerty.is("escape",e)){if(l.is(":FastVisible")){L(d);b();e.preventDefault();e.stopPropagation()}else{i.trigger("escapePressed")}}else if(Streak.jwerty.is("backspace/delete",e)){}},input:function(e){h=M();d=h;if(h.length===0){b()}else{p(h.length)}},keyup:function(e){if(Streak.jwerty.is("escape/shift/enter/ctrl/cmd/alt/meta",e)){v();return}if(Streak.jwerty.is("up/down",e)){if(l.is(":FastVisible")){e.preventDefault();e.stopPropagation();return}else if(Streak.jwerty.is("down",e)){f()}}},click:function(e){if(!l.is(":FastVisible")){f()}},focus:function(e){i.after(r)},detach:function(e){b()}});i[0].addEventListener("keydown",function(e){if(e.which===13&&!e.ctrlKey&&!e.metaKey){e.stopImmediatePropagation();e.stopPropagation();e.preventDefault();i.focus();i.caret().goToEnd();b();i.trigger("enterPressed")}},true);function f(){h=M();var e=m(M());if(e.length>0){g(e);v();y()}}function p(e){clearTimeout(u);u=setTimeout(function(){s=m(h);if(s.length===0){b();return}g(s);w();v()},100);v()}function m(e){var t=e.toLowerCase().removeWhitespace();return o.filter(function(e){return e.normalized.indexOf(t)===0&&e.normalized.length>0})}function _(){return i.caret().start>=M().length}function g(e){l.empty();l[0].style.display="";for(var n=0;n<Math.min(e.length,t);n++){var i=C(e[n]);if(n===0){i.addClass("firstItem")}else if(n===e.length-1){i.addClass("lastItem")}l.append(i)}r.after(l)}function v(){var e=i.parent().height()+1;var t=parseFloat(r.css("top"));var n=parseFloat(r.css("left"));e-=t;l[0].style.top=e+"px";l[0].style.width=i.parent().width()-6-n+"px";r[0].style.height=e-1+"px"}function y(){var e=i[0].scrollTop;a[0].style.top=-1*e+"px"}function w(){a.text(x().value);r.show()}function b(){l.empty();l.detach();a.empty()}function C(t){var n=e(document.createElement("li"));n.addClass("J-N");n[0].innerHTML=t.display.escapeHTML();e(n).data("data",t);n[0].setAttribute("title",t.display);n.captureClick(function(e){k();i.trigger("delayedSave")}).hover(function(t){e(this).addClass(c)},function(t){e(this).removeClass(c)});return n}function S(e,t){for(var n=0;n<e.length;n++){if(e[n]===t[0]){return n}}return-1}function T(t,n){n.preventDefault();n.stopPropagation();n.stopImmediatePropagation();var o;if(l.find("li."+c).length>0){var s=l.find("li."+c);var u=l.find("li");var h=S(u,s);var f=-1;var f=t=="next"?h+1:h-1;s.removeClass(c);if(f===-1||f>l.find("li").length-1){L(d);r.show();i.caret().goToEnd()}else{o=e(u[f]);o.addClass(c)}}else{if(t==="next"){l.find("li.firstItem").addClass(c)}else{l.find("li.lastItem").addClass(c)}o=l.find("li."+c)}if(o){a[0].innerHTML="";L(o.data("data").value);i.caret().goToEnd();o.scrollintoview({duration:50})}v()}function x(){var e=l.find("li.firstItem");return e.data("data")}function k(){l.hide();r.hide();var e=l.find("li."+c);var t=e.data("data");L(t.value);i.caret().goToEnd();i.trigger("autoCompleteSet")}function M(){return i.plainText()}function L(e){if(!e){e=""}i.text(e)}})}})(Streak.jQuery);(function(e){e.fn.autoGrowInput=function(t){return this.each(function(){var t=e(this),n=function(e){e=Streak._.isNumber(e)?e:0;t.attr("size",Math.max(t.val().length+e,1))};n(-2);e(this).bind("keyup keydown blur update change input",n)})}})(Streak.jQuery);(function(e){var t=[];var n=[];var i=[];var r={};var a="Jd-Je";var o={maxListItems:25};e.fn.AutoSuggest=function(s){var l={data:null,wrapperCss:{},minChars:1,dataFunc:e.noop,convertFunc:e.noop,stringDataFunc:e.noop,selectFunc:e.noop,compareFunc:function(e,t){},noResultsFoundText:null,loadingResultsText:null,getExcludedIDsFunc:e.noop,idProperty:"email",onlyValidEmailAddress:false,isRightAligned:true};var u=[];var c={};e.extend(c,l,s);return this.each(function(){var s=this;var l=e(this);var u=l.parent();var d=e('<div class="ah aiv aJS ausu-suggestionsBox"></div>');var h=e('<div class="overflowContainer"></div>');var f=e('<div class="ausu-loadingIndicator" style="">Loading More...</div>');var p=e('<ul class="existingList"></ul>');var m=e("<ul></ul>");var _;var g=l.plainText();
var v=[];k(t);h.appendTo(d);f.appendTo(d);p.appendTo(h);m.appendTo(h);l.after(d);b();l.autoGrowInput();l.on("keydown",function(e){if(e.which===40||e.which===38){if(Streak.jwerty.is("down",e)){if(g.length===0&&!p.is(":FastVisible")){m.empty();B();return false}else if(g.length>0&&!d.is(":FastVisible")){B(g);M(g);I();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}}if(d.is(":FastVisible(noCompute)")){if(e.which===40){R("next");e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}else{R("prev");e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}}}switch(e.which){case 9:if(e.shiftKey){l.trigger("shiftTabPressed")}else{if(d.find("li."+a).filter(":FastVisible").length>0||l.plainText().length>0){N();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false}l.trigger("tabPressed")}e.preventDefault();break;case 13:if(d.find("li."+a).filter(":FastVisible").length>0||l.plainText().length>0){N()}else{l.trigger("enterPressed");e.preventDefault();e.stopPropagation()}return false;break;case 27:e.preventDefault();e.stopPropagation();if(d.is(":FastVisible")){d.hide()}else{l.trigger("escapePressed")}break}});l[0].addEventListener("keyup",function(e){if(event.keyCode==13){return false}else if(e.which===8&&l.plainText().length===0){g="";d.hide();b()}else{C(l.plainText())}});l.on("bbSelect",function(e){if(l.plainText()){if(l.plainText().isValidEmail()){N()}}});l.on("bbUnselect",function(e){d.find("li."+a).removeClass(a)});l.on("bbFocus",function(e){d.hide();m.empty()});l.on("click",function(e){if(g.length===0&&!p.is(":FastVisible")){m.empty();B()}else if(g.length>0&&!d.is(":FastVisible")){B(g);M(g);I()}});var y=null;function w(){P();d.addClass("ausu-loading")}function b(){d.removeClass("ausu-loading")}function C(e){e=(e||"").toLowerCase();mostRecentQuery=e;if(g!==e){g=e;clearTimeout(_);w();B(g);var t=M(e);_=setTimeout(function(){S(e)},t?2e3:200)}}function S(e){if(e!==g||e<=c.minChars){b();return}if(Streak._.isNotReal(r[e])){r[e]=0}r[e]++;c.dataFunc(e,function(t){if(e!==g){return}if(t){T(e,t);V(e,i[n.indexOf(e)])}else{if(d.find("li").length===0){d.hide()}}b()})}function T(e,t){if(Streak._.isNotReal(t)||t.length===0){return}var r=n.indexOf(e);if(r>-1){i[r]=Streak._.uniqMerge(t.concat(i[r]),function(e){return e.email})}else{r=n.length;n.push(e);i[r]=t}x(t)}function x(e){t=t.concat(e);t=Streak._.uniqMerge(t,function(e){return e[c.idProperty]});k(e)}function k(e){var t=l.data("existingList");if(t&&t.length>0){for(var n=0;n<t.length;n++){for(var i=0;i<e.length;i++){if(t[n].value[c.idProperty]===e[i][c.idProperty]){Streak._.extend(t[n].value,e[i])}}}}}function M(e){var t;if(e!==mostRecentQuery){return}var r=false;var a=n[e];if(a>-1){r=true;t=i[a]}else{var o=e;for(var s=1;s<e.length;s++){var l=L(o);if(l.length>0){var u=n.indexOf(l[0]);t=i[u];break}else{o=o.substring(0,o.length-1)}}}var d;if(t){d=Streak._.filter(t,function(t){return c.compareFunc(e,t)})}if(d&&d.length>0){P();V(e,d)}else{m.empty()}return r}function L(e){return Streak._(n).chain().filter(function(t){return t.toLowerCase().indexOf(e.toLowerCase())===0}).sortBy(function(e){return-1*r[e]}).sortBy(function(e){return e.length}).value()}function B(e){var t=l.data("existingList");if(t&&t.length>0){v.length=0;p.empty();var n=c.getExcludedIDsFunc();var i=t.filter(function(t){return c.compareFunc(e||"",t.value)&&n.indexOf(H(t.value))===-1});if(i.length>0){for(var r=0;r<i.length;r++){var a=F(e,i[r].value);p.append(a);v.push(H(i[r].value))}p.show()}else{p.hide()}P()}I()}var E;var D=[];function V(e,t){D.length=0;if(E){E.stop()}d.show();m.empty();if(t&&t.length>0){m.find(".ausu-no-results").remove();var n=c.getExcludedIDsFunc()||[];var i=Math.min(t.length,o.maxListItems);for(var r=0;r<i;r++){if(n.indexOf(H(t[r]))>-1||v.indexOf(H(t[r]))>-1){continue}var a=t[r].imageUrl;t[r].imageUrl=null;var s=F(e,t[r]);m.append(s);D.push({li:s,imageUrl:a})}E=Streak._.repeatEvery(function(){if(D.length>0){var e=D.pop();e.li.find(".ak")[0].style.backgroundImage="url("+e.imageUrl+")"}else{E.stop()}},300)}if(v.length===0&&m.find("li").length===0){m.html('<li class="ausu-no-results">'+c.noResultsFoundText+"</li>")}A();I()}function I(){d.find(".firstItem").removeClass("firstItem");d.find(".lastItem").removeClass("lastItem");if(p.find("li").length>0){p.find("li:first").addClass("firstItem");if(m.find("li.personPickerSuggestion").length===0){p.find("list:last").addClass("lastItem")}else{m.find("li.personPickerSuggestion:last").addClass("lastItem")}}else if(m.find("li.personPickerSuggestion").length>0){m.find("li:first").addClass("firstItem");m.find("li:last").addClass("lastItem")}d.find("."+a).removeClass(a);d.find(".firstItem").addClass(a)}function P(){d.show();A()}function A(){d[0].style.top="";d[0].style.left="";d.containByScreen(l,{isRightAligned:c.isRightAligned})}function F(t,n){var i=c.convertFunc(t,n);e(i).data("data",n);i[0].addEventListener("mousedown",function(e){N(e);e.preventDefault()},true);i.hover(function(t){d.find("li."+a).removeClass(a);e(this).addClass(a)},function(t){e(this).removeClass(a)});return i}function O(e,t){for(var n=0;n<e.length;n++){if(e[n]===t[0]){return n}}return-1}function R(t){if(d.find("li").length<2){return}if(d.find("li."+a).length>0){var n=d.find("li."+a);var i=d.find("li.personPickerSuggestion");var r=O(i,n);var o=-1;var o=t=="next"?r+1:r-1;if(o===-1){next=e(i[i.length-1])}else if(o>d.find("li").length-1){next=e(i[0])}else{next=e(i[o])}next.addClass(a);n.removeClass(a);next.scrollintoview({duration:50})}else{if(t==="next"){d.find("li.firstItem").addClass(a)}else{d.find("li.lastItem").addClass(a)}}}function N(){var e=d.is(":FastVisible")&&d.find("li."+a).length>0;g="";var t=d.find("li."+a);var n=t.data("data");if(!e){n=c.stringDataFunc(l.plainText())}l.plainText("");l.focus();if(n.email||!c.onlyValidEmailAddress){c.selectFunc(n)}mostRecentQuery=null;m.empty();d.hide()}function H(e){if(c.onlyValidEmailAddress){return e[c.idProperty]}else{return e[c.idProperty]||e.displayName}}})}})(Streak.jQuery);/*!
 * jQuery BBQ: Back Button & Query Library - v1.3pre - 8/26/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(e,t){"$:nomunge";var n,i=Array.prototype.slice,r=decodeURIComponent,a=e.param,o,s,l,u,c=e.bbq=e.bbq||{},d,h,f,p=e.event.special,m="hashchange",_="querystring",g="fragment",v="elemUrlAttr",y="href",w="src",b=/^.*\?|#.*$/g,C,S,T,x,k,M={};function L(e){return typeof e==="string"}function B(e){var t=i.call(arguments,1);return function(){return e.apply(this,t.concat(i.call(arguments)))}}function E(e){return e.replace(S,"$2")}function D(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function V(t,i,a,s,u){var c,d,h,f,p;if(s!==n){h=a.match(t?S:/^([^#?]*)\??([^#]*)(#?.*)/);p=h[3]||"";if(u===2&&L(s)){d=s.replace(t?C:b,"")}else{f=l(h[2]);s=L(s)?l[t?g:_](s):s;d=u===2?s:u===1?e.extend({},s,f):e.extend({},f,s);d=o(d);if(t){d=d.replace(T,r)}}c=h[1]+(t?k:d||!h[1]?"?":"")+d+p}else{c=i(a!==n?a:location.href)}return c}a[_]=B(V,0,D);a[g]=s=B(V,1,E);a.sorted=o=function(t,n){var i=[],r={};e.each(a(t,n).split("&"),function(e,t){var n=t.replace(/(?:%5B|=).*$/,""),a=r[n];if(!a){a=r[n]=[];i.push(n)}a.push(t)});return e.map(i.sort(),function(e){return r[e]}).join("&")};s.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);T=new RegExp(n.join("|"),"g")};s.noEscape(",/");s.ajaxCrawlable=function(e){if(e!==n){if(e){C=/^.*(?:#!|#)/;S=/^([^#]*)(?:#!|#)?(.*)$/;k="#!"}else{C=/^.*#/;S=/^([^#]*)#?(.*)$/;k="#"}x=!!e}return x};s.ajaxCrawlable(0);e.deparam=l=function(t,i){var a={},o={"true":!0,"false":!1,"null":null};e.each(t.replace(/\+/g," ").split("&"),function(t,s){var l=s.split("="),u=r(l[0]),c,d=a,h=0,f=u.split("]["),p=f.length-1;if(/\[/.test(f[0])&&/\]$/.test(f[p])){f[p]=f[p].replace(/\]$/,"");f=f.shift().split("[").concat(f);p=f.length-1}else{p=0}if(l.length===2){c=r(l[1]);if(i){c=c&&!isNaN(c)?+c:c==="undefined"?n:o[c]!==n?o[c]:c}if(p){for(;h<=p;h++){u=f[h]===""?d.length:f[h];d=d[u]=h<p?d[u]||(f[h+1]&&isNaN(f[h+1])?{}:[]):c}}else{if(e.isArray(a[u])){a[u].push(c)}else if(a[u]!==n){a[u]=[a[u],c]}else{a[u]=c}}}else if(u){a[u]=i?n:""}});return a};function I(e,t,i){if(t===n||typeof t==="boolean"){i=t;t=a[e?g:_]()}else{t=L(t)?t.replace(e?C:b,""):t}return l(t,i)}l[_]=B(I,0);l[g]=u=B(I,1);e[v]||(e[v]=function(t){return e.extend(M,t)})({a:y,base:y,iframe:w,img:w,input:w,form:"action",link:y,script:w});f=e[v];function P(t,i,r,o){if(!L(r)&&typeof r!=="object"){o=r;r=i;i=n}return this.each(function(){var n=e(this),s=i||f()[(this.nodeName||"").toLowerCase()]||"",l=s&&n.attr(s)||"";n.attr(s,a[t](l,r,o))})}e.fn[_]=B(P,_);e.fn[g]=B(P,g);c.pushState=d=function(e,t){if(L(e)&&/^#/.test(e)&&t===n){t=2}var i=e!==n,r=s(location.href,i?e:{},i?t:2);location.href=r};c.getState=h=function(e,t){return e===n||typeof e==="boolean"?u(e):u(t)[e]};c.removeState=function(t){var i={};if(t!==n){i=h();e.each(e.isArray(t)?t:arguments,function(e,t){delete i[t]})}d(i,2)};p[m]=e.extend(p[m],{add:function(t){var i;function r(e){var t=e[g]=s();e.getState=function(e,i){return e===n||typeof e==="boolean"?l(t,e):l(t,i)[e]};i.apply(this,arguments)}if(e.isFunction(t)){i=t;return r}else{i=t.handler;t.handler=r}}})})(Streak.jQuery,this);(function(e){e.fn.extend({bodyCloseAndStop:function(n){var i={closeFunction:null,stop:null,body:null,useCapture:true,stopOnSelf:true};var r={};e.extend(r,i,n);var a=this.filter(function(){if(e(this).data("bodyCloseAndStop")){return false}return true});if(a.length===0){return}var o=function(n){if(t){return}var i;if(r.stopOnSelf){i=e(a).add(r.stop)}else{i=e(r.stop)}if(r.closeFunction&&(r.stop===null||e(n.target).parents().add(n.target).filter(i).length===0)){r.closeFunction(n)}};e(a).data("bodyCloseAndStop",{useCapture:r.useCapture,callbackFunction:o,body:r.body});if(!r.useCapture){e(r.body).on("click",o)}else{e(r.body).each(function(){this.addEventListener("click",o,true)})}e(r.body).on("bodyCloseAndStop",o)},unbindBodyCloseAndStop:function(){return this.each(function(){var t=e(this).data("bodyCloseAndStop");if(!t){return}if(!t.useCapture){e(t.body).off("click",t.callbackFunction)}else{e(t.body).each(function(){this.removeEventListener("click",t.callbackFunction,true)})}e(t.body).off("bodyCloseAndStop",t.callbackFunction);e(this).removeData("bodyCloseAndStop")})}});e(document.body).on("ignoreMouseClick",function(){t=true});e(document.body).on("click",function(){t=false});var t=false})(Streak.jQuery);(function(e){e.fn.extend({captureClick:function(t){var n=t;return this.each(function(){var t=e(this);this.addEventListener("click",function(e){if(n){n(e)}e.stopPropagation();return false},true)})}})})(Streak.jQuery);(function(e){var t=e.jQuery;var n=document.createElement("div");t.domCleanString=function(e){n.innerHTML=e;return n.innerText};t.cleanString=function(e){return t.cleanText(e)};t.fn.cleanText=function(){return t.cleanText(this.html())};t.cleanText=function(e,t,n){if(!e){return""}if(!n){n="\n"}var i=e.replace(/<br\s*\/?>|<div>/gim,n).replace("&nbsp;"," ");if(t){i=i.replace(/\n/gim," ")}i=i.replaceAmpCodes();return i.trim()};t.fn.plainText=function(e){if(e||e===""){this.setPlainText(e)}else{var t="";if(this.is("textarea")||this.is("input")){t=this.val()}else{t=this[0].innerText}return t.trim("\n")}};var i={"	":"&nbsp;&nbsp;&nbsp;&nbsp;","  ":"&nbsp; ","&":"&amp;",'"':"&quot;","'":"&#x27;","<":"&lt;",">":"&gt;","\n":"<br />","\r":"<br />"};var r=/[\t ]/;var a="&#8203;";t.fn.setPlainText=function(e){if(this.is("textarea")||this.is("input")){this.val(e)}else{this[0].innerHTML=t.getTextHTML(e)}};t.getTextHTML=function(e){e=(e||"")+"";e=e.replace(/\r\n/g,"\n");var t="";var n="";for(var o=0;o<e.length;o++){var s=e[o];var l=e.charCodeAt(o);if(r.test(s)&&!r.test(n)&&r.test(e[o+1]||"")){t+=a}t+=s in i?i[s]:l>127?"&#"+l+";":s;n=s}return t}})(Streak);(function(e){var t=Streak.StateMachine;var n=false,i=null,r=0,a=0,o=4;var s=null;var l=false;function u(){if(l){return}s=new t.create({initial:"start",events:[{name:"mousedown",from:["start"],to:"possibleDrag"},{name:"mouseup",from:["possibleDrag","start"],to:"start"},{name:"dragStart",from:["possibleDrag"],to:"drag"},{name:"mouseup",from:["drag"],to:"drop"},{name:"reset",from:["possibleDrag","drag","drop","start"],to:"start"}],callbacks:{onstart:function(e,t,n){Streak.Gmail.elements.body.css({"-webkit-user-select":""})},ondragStart:function(){currentEl.trigger("bbDragStart")},ondrag:function(e,t,n){Streak.Gmail.elements.body.css({"-webkit-user-select":"none"});currentEl.trigger("bbDrag")},ondrop:function(e,t,n){currentEl.trigger("bbDrop");s.reset()}}});Streak.Gmail.elements.body.mousemove(function(e){var t=e.clientX-a;if(s.is("possibleDrag")){if(document.activeElement.type!=="text"&&Math.abs(t)>o){s.dragStart()}}else if(s.is("drag")){var n=Math.min(Math.max(r+t,45),2e3);currentEl.css({minWidth:n,width:n,maxWidth:n});currentEl.trigger("bbDrag")}});Streak.Gmail.elements.body.mouseup(function(e){s.mouseup()});Streak.BentoBox.Keyboard.bindChord("escape",function(e){s.reset()});l=true}e.fn.colResizable=function(t){var n={onResize:e.noop,doneResize:e.noop};var i=e.extend(n,t);return this.each(function(){var t=e(this),n=e(document.createElement("div"));n.addClass("colResize");t.append(n);n.on("mousedown.colResizable",function(e){u();s.reset();s.mousedown();a=e.clientX;currentEl=t;r=t.width();e.preventDefault();e.stopPropagation();n.trigger("ignoreMouseClick")});t.on({"bbDragStart.colResizable":function(e){n.trigger("hold")},"bbDrag.colResizable":function(e){i.onResize(t.width())},"bbDrop.colResizable":function(e){n.trigger("unhold");i.doneResize()}});n[0].addEventListener("click",function o(e){e.preventDefault();e.stopImmediatePropagation()},true);n.easyHoverClass("bbActive")})}})(Streak.jQuery);(function(e){var t=Streak.StateMachine;var n=null,i=null,r=false,a=null,o=null,s=[],l=null;var u=null;var c=null;var d={DRAG_THRESHOLD:4};e.fn.columnReorder=function(t){var o=this;var s={body:null,doneReorder:e.noop};var d=e.extend(s,t);m();this.each(function(t){var s=e(this);s.on({mouseenter:function(e){if(!h||h.is("start")){u.fastShow();c.fastShow();s.prepend(u);s.prepend(c);n=s}},mouseleave:function(e){if(!h||h.is("start")){u.detach();c.detach()}},"streakReorderDragStart.columnReorder":function(e){_.css({width:n.width(),left:s.offset().left,top:0});a=o;l=d.body;n=s;l.prepend(_)},"streakReorderDrag.columnReorder":function(e){},"streakReorderDrop.columnReorder":function(e){_.detach();g.detach();d.doneReorder(t,i,r)}})})};var h=null;var f=false;function p(){if(f){return}h=new t.create({initial:"start",events:[{name:"mousedown",from:["start"],to:"possibleDrag"},{name:"mouseup",from:["possibleDrag","start"],to:"start"},{name:"dragStart",from:["possibleDrag"],to:"drag"},{name:"mouseup",from:["drag"],to:"drop"},{name:"reset",from:["possibleDrag","drag","drop","start"],to:"start"}],callbacks:{onstart:function(e,t,n){Streak.Gmail.elements.body.css({"-webkit-user-select":""})},ondragStart:function(){n.trigger("streakReorderDragStart");v()},ondrag:function(e,t,i){Streak.Gmail.elements.body.css({"-webkit-user-select":"none"});n.trigger("streakReorderDrag")},ondrop:function(e,t,i){n.trigger("streakReorderDrop");h.reset()}}});Streak.Gmail.elements.body.mousemove(function(e){var t=e.clientX-o;if(h.is("possibleDrag")){if(document.activeElement.type!=="text"&&Math.abs(t)>d.DRAG_THRESHOLD){h.dragStart()}}else if(h.is("drag")){y(t)}});Streak.Gmail.elements.body.mouseup(function(e){h.mouseup()});f=true}function m(){u=e('<div class="streak__reorderGrip"><div></div><div></div></div>');c=e('<div class="streak__reorderGripOver"></div>');c.on("mousedown.columnReorder",function(e){p();h.reset();h.mousedown();o=e.clientX;e.preventDefault();e.stopPropagation()})}var _=e(document.createElement("div"));_.addClass("streak__reorderProxy");var g=e(document.createElement("div"));g.addClass("streak__reorderInsert");function v(){s.length=0;a.each(function(t){var n=e(this).offset();var i=e(this).width();s.push({left:n.left,right:n.left+i,width:i,el:e(this)})})}function y(e){r=false;var t=Math.min(Math.max(o+e,s[0].left),s[s.length-1].left);_.offset({left:t});g.detach();for(var n=0;n<s.length;n++){if(s[n].left<=t&&s[n].right>=t){i=n;if(t>(s[n].left+s[n].right)/2){r=true;g.css({left:s[n].el.position().left+s[n].width})}else{g.css({left:s[n].el.position().left-5})}l.prepend(g);break}}}})(Streak.jQuery);(function(e){var t=Streak._;var n={BUFFER:10};e.fn.getBoundingBox=function(t){var n=e(this[0]);var i=n.offset();var r=[{x:i.left,y:i.top},{x:i.left+(t?n.outerWidth():n.width()),y:i.top+n.outerHeight()}];r.width=t?n.outerWidth():n.width();r.height=n.outerHeight();return r};var i=function(t){var n=t;return{can:function(t){var i=false;if(e.isArray(t)){i=false;for(var r=0;r<t.length;r++){if(n.indexOf(t[r])>-1){i=true;break}}}else{i=n.indexOf(t)>-1}return i}}};var r=function(e,t,n){var i=e;var r=t;var a=n;return{containDimension:function(e,t,n,o){o=o===1?1:0;var s=(o+1)%2;var l=1;if(o===1){l=-1}var u=[];if(r[o][e]*l<i[o][e]*l){u.push(e+"|"+o+"="+i[o][e]);if(r[s][e]*l>i[s][e]*l){u.push(e+"|"+s+"="+i[s][e])}else{if(a.indexOf(n)>-1){u.push(e+"|"+s+"="+r[s][e])}else{if((i[o][e]+r[t]*l)*l>i[s][e]*l){u.push(e+"|"+s+"="+i[s][e])}}}}return u}}};e.fn.containElement=function(t,n){var i=e(this[0]);var a=e(t);var o=n||"";var s=i.getBoundingBox();var l=a.getBoundingBox();var u=a.offset();var c={};var d=[];var h=new r(s,l,o);d=d.concat(h.containDimension("x","width","right",0));d=d.concat(h.containDimension("x","width","left",1));d=d.concat(h.containDimension("y","height","bottom",0));d=d.concat(h.containDimension("y","height","top",1));if(d.length===0){}else{var f=false;var p=false;d.sort();for(var m=0;m<d.length;m++){var _=d[m];if(!_){continue}var g=_.split("=");var v=parseInt(g[1]);var y=g[0].split("|")[0];var w=g[0].split("|")[1];if(y==="x"){if(w==="0"){u.left=v;f=true}else{if(f){c.width=v-u.left+"px"}else{u.left=u.left-(l[0].x-v)}}}else{if(w==="0"){p=true;u.top=v}else{if(p){c.height=v-u.top+"px"}else{u.top=u.top-(l[1].y-v)}}}}}a.offset(u);a.css(c)};e.fn.containByScreen=function(e,n){if(this.first().css("position")!=="fixed"){return}n=n||{};var i=this.offset();var r={width:this.outerWidth(),height:this.outerHeight(),innerWidth:this.width()};if(n.widthBuffer){r.width+=n.widthBuffer}if(n.heightBuffer){r.height+=n.heightBuffer}var s=e.offset();var l={width:e.outerWidth(),height:e.outerHeight()};var u=[{x:0,y:0},{x:window.innerWidth,y:window.innerHeight}];var c=i.left;var d=i.top;if(n.leftBuffer){c-=n.leftBuffer}if(n.topBuffer){d+=n.topBuffer}var h=[{x:c,y:d},{x:c+r.width,y:d+r.top}];var f,p,m,_;if(n.isBottomAligned){m=document.body.clientHeight-s.top;i.top=m-r.height}else{f=s.top;if(!n.isTopAligned){f+=l.height}i.top=f}if(n.isAligned){}else if(n.isRightAligned){_=document.body.clientWidth-s.left-l.width;i.left=_-r.width}else{p=s.left;i.left=p}var g;if(i.top+r.height>u[1].y){g=t.clone(h);if(n.isAligned){g[0].y=s.top+l.height-r.height}else{g[0].y=s.top-r.height}g[1].y=g[0].y+r.height;if(a(u,g)){f=g[0].y}}else if(i.top<0){g=t.clone(h);if(n.isAligned){g[0].y=s.top}else{g[0].y=s.top+l.height}g[1].y=g[0].y+r.height;if(a(u,g)){f=trialBoundingbox[0].y}}if(t.isNotReal(f)&&n.forceFit){if(i.top<0){f=0}else if(i.top+r.height>u[1].y){f=u[1].y-r.height}}if(i.left+r.width>u[1].x){g=t.clone(h);if(n.isAligned){g[0].x=s.left-r.width}else{g[0].x=s.left-r.width+l.width}g[1].x=g[0].x+r.width;if(o(u,g)){p=g[0].x}}else if(i.left<0){g=t.clone(h);if(n.isAligned){g[0].x=s.left+l.width+r.width}else{g[0].x=s.left}g[1].x=g[0].x+r.width;if(o(u,g)){p=g[0].x}}if(t.isReal(m)){this[0].style.bottom=m+"px";this[0].style.top=""}else if(t.isReal(f)){this[0].style.top=f+"px";this[0].style.bottom=""}if(t.isReal(_)){this[0].style.right=_+"px";this[0].style.left=""}else if(p){this[0].style.left=p+"px";this[0].style.right=""}this[0].style.maxWidth=r.innerWidth+"px"};e.fn.containRelativeElement=function(e,t,n){t=t||0;n=n||0;var i=e.offset();var r=e.getBoundingBox();var a=this.getBoundingBox();if(r[1].y>a[1].y){i.top=i.top-r.height-n*2}if(r[1].x>a[1].x){i.left-=r[1].x-a[1].x}var o=this.offset();i.left+=t;i.top+=n;i.left=Math.max(i.left,0);i.top=Math.max(i.top,0);e.css(i)};function a(e,t){if(e[0].y-n.BUFFER>t[0].y){return false}if(e[1].y+n.BUFFER<t[1].y){return false}return true}function o(e,t){if(e[0].x-n.BUFFER>t[0].x){return false}if(e[1].x+n.BUFFER<t[1].x){return false}return true}})(Streak.jQuery);(function(e){var t=document.defaultView&&document.defaultView.getComputedStyle,n=/([A-Z])/g,i=/-([a-z])/gi,r=function(e,t){return t.toUpperCase()},a=function(e){if(t){return t(e,null)}else if(e.currentStyle){return e.currentStyle}},o=/float/i,s=/^-?\d+(?:px)?$/i,l=/^-?\d/;e.curStyles=function(e,u){if(!e){return null}var c=a(e),d,h,f=e.style,p={},m=0,_,g,v,y;for(;m<u.length;m++){y=u[m];d=y.replace(i,r);if(o.test(y)){y=jQuery.support.cssFloat?"float":"styleFloat";d="cssFloat"}if(t){y=y.replace(n,"-$1").toLowerCase();h=c.getPropertyValue(y);if(y==="opacity"&&h===""){h="1"}p[d]=h}else{v=y.replace(i,r);p[d]=c[y]||c[v];if(!s.test(p[d])&&l.test(p[d])){_=f.left;g=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;f.left=v==="fontSize"?"1em":p[d]||0;p[d]=f.pixelLeft+"px";f.left=_;e.runtimeStyle.left=g}}}return p};e.fn.curStyles=function(){return e.curStyles(this[0],e.makeArray(arguments))}})(Streak.jQuery);(function(e){e.expr[":"].Contains=function(e,t,n){return(e.textContent||e.innerText||"").toLowerCase().indexOf(n[3].toLowerCase())>=0};e.expr[":"].FastVisible=function(t,n,i){if(t.style.display==="none"){return false}var r=e(t).parents();if(r.length===0){return false}var a=false;for(var o=0;o<r.length;o++){if(r[o].style.display==="none"){return false}if(r[o].tagName.toLowerCase()==="body"){a=true}}if(!a){return false}if(i==="compute"){return t.offsetHeight>0||t.offsetWidth>0}return true};e.expr[":"].DisplayVisible=function(t,n,i){var r=e(t);if(t.style.display==="none"){return false}if(r.parents("body").length===0){return false}if(r.parents(":DisplayNone").length>0){return false}return true};e.expr[":"].NotDisplayNone=function(e,t,n){return e.style.display!=="none"};e.expr[":"].DisplayNone=function(e,t,n){return e.style.display==="none"};e.expr[":"].scroll=function(t,n,i){var r=e(t);var a=r.curStyles("overflow","overflowX","overflowY");return/(auto|scroll)/.test(a.overflow+a.overflowX+a.overflowY)};e.expr[":"].inBody=function(e,t,n){var i=e;while(true){if(!i){return false}else if(i.tagName&&i.tagName.toLowerCase()==="body"){return true}else{i=i.parentNode}}};e.fn._find=e.fn.find;e.fn.find=function(t){return e(this.findReturnRaw(t))};e.fn.findReturnRaw=function(t){if(this.length===0){return e("")}else{var n=[];for(var i=0;i<this.length;i++){var r=[];if(t.indexOf(":")>-1||!this[i].querySelectorAll){return this._find(t)}else{try{r=this[i].querySelectorAll(t)}catch(a){return this._find(t)}}if(r.length>0){for(var o=0;o<r.length;o++){n.push(r[o])}}}return n}};e.fn.outerHTML=function(){return this[0].outerHTML};e.fn.fastShow=function(e){e=e!=null?e:"block";for(var t=0;t<this.length;t++){this[t].style.display=e}return this};e.fn.fastHide=function(){for(var e=0;e<this.length;e++){this[e].style.display="none"}return this};e.fn.fastOnClick=function(e,t){for(var n=0;n<this.length;n++){this[n].addEventListener("click",e,t)}};e.fn.customBind=function(e,t){for(var n=0;n<this.length;n++){this[n].addEventListener(e,t)}};e.fn.customTrigger=function(e){var t=document.createEvent("Event");t.initEvent(e,true,true);for(var n=0;n<this.length;n++){this[0].dispatchEvent(t)}};e.removeClassFromRaw=function(e,t){if(!t||!e){return this}var n=t;if(!Array.isArray(t)){n=t.split(" ")}var i=e.getAttribute("class")||"";var r=i.split(" ");var a=[];for(var o=0;o<r.length;o++){if(n.indexOf(r[o])===-1){a.push(r[o])}}e.setAttribute("class",a.join(" "))};e.fastAddClassToRaw=function(e,t){var n=e.getAttribute("class");e.setAttribute("class",n+" "+t)};e.fn.smallHide=function(){this.css({height:1,width:1,visibility:"hidden",overflow:"hidden"});return this};e.fn.smallShow=function(){this.css({height:"",width:"",visibility:"",overflow:""});return this};e.fn.filterOutInvisible=function(){var t=[];for(var n=0;n<this.length;n++){var i=this[n];if(i.style.display==="none"){continue}var r=e(i).fastParents();if(r.length===0){continue}var a=false;for(var o=0;o<r.length;o++){if(!r[o].style){break}if(r[o].style.display==="none"){break}if(r[o].tagName.toLowerCase()==="body"){a=true}}if(!a){continue}t.push(i)}return e(t)};e.fn.isVisible=function(){return this.filterOutInvisible().length>0};e.fn.fastParents=function(){var t=[];if(this.length===0){return e(t)}var n=this[0];for(var i=0;i<1e4;i++){var n=n.parentNode;if(!n){break}if(n.nodeName==="#document"){break}t.push(n)}return e(t)};e.fn.isInBody=function(){var e=this.fastParents();for(var t=0;t<e.length;t++){if(e[t].nodeName.toLowerCase()==="body"){return true}}return false};e.fn.isAncestor=function(e){var t=e;if(t.length){t=t[0]}for(var n=0;n<this.length;n++){var i=t;for(var r=0;r<1e4;r++){if(i===this[n]){return true}var i=i.parentNode;if(!i){break}if(i.nodeName==="#document"){break}}}return false};e.fn.__oldVal=e.fn.val;e.fn.val=function(t){var n="";var i=arguments;this.each(function(r){if(this.nodeName==="DIV"&&this.getAttribute("contenteditable")==="true"){if(i.length===1){this.innerHTML=t}else if(r===0){n=this.innerHTML}}else{if(i.length>0){e(this).__oldVal(t)}else if(r===0){n=e(this).__oldVal()}}});return n}})(Streak.jQuery);(function(e){e.fn.extend({delayedSave:function(t){var n={saveFunction:null,delay:1e3,enter:false,enterCutoff:false,dontPropagate:false,saveOnBlur:true,keyEvent:"keydown"};var i={};e.extend(i,n,t);return this.each(function(){var t=i,n,r=e(this),a=false,o=false,s=r.val()||r.html(),l=function(e,i){clearTimeout(n);if(s!=(r.val()||r.html())||e){s=r.val()||r.html();if(t.saveFunction){t.saveFunction.call(r,e,i)}}};r.focus(function(e){s=r.val()||r.html()});if(i.saveOnBlur){r.bind("blur",function(e){var t=a;var n=o;a=false;o=false;if((r.val()||r.html())!=s||t){l(t,n)}})}r.on("keydown",function(e){if(t.enter&&e.which===13){a=true;r.blur()}if(t.dontPropagate){e.stopPropagation()}});if(t.delay){r.on("input",function(e){clearTimeout(n);n=setTimeout(function(){o=true;l(e.which===13);o=false},t.delay);if(t.dontPropagate){e.stopPropagation()}})}else{r.on("input",function(e){l();if(t.dontPropagate){e.stopPropagation()}})}r.bind("delayedSave",function(){l(false)})})}})})(Streak.jQuery);(function(e){e.fn.extend({easyHoverClass:function(t,n,i,r){var a=t;return this.each(function(){var t=e(this),o=false,s=false,l=false;var u=r||t;var c=n?".namespace":"";t.on("mouseenter"+c,function(e){if(l){return}u.addClass(a);s=true});t.on("mouseleave"+c,function(e){s=false;if(!o){u.removeClass(a)}});t.focus(function(e){o=true;u.addClass(a)});if(!i){t.blur(function(e){o=false;u.removeClass(a)})}t.bind({hold:function(){u.addClass(a);o=true},unhold:function(){if(!s)u.removeClass(a);o=false},disabled:function(){l=true},enabled:function(){l=false}})})},superEasyHoverClass:function(t){for(var n=0;n<this.length;n++){var i=this[n];i.addEventListener("mouseover",function(n){e(this).addClass(t)});i.addEventListener("mouseout",function(n){e(this).removeClass(t)})}}})})(Streak.jQuery);(function(e){e.fn.extend({easyTab:function(t){var n={prev:-1,next:-1,delay:null,namespace:null};var i={};e.extend(i,n,t);i.namespace=i.namespace||"easyTab";return this.each(function(){var t=e(this);var n=function(e){if((e?i.prev:i.next)===-1){return true}t.blur();if(i.delay){setTimeout(function(){r(e)},50)}else{r(e)}};var r=function(e){if(e){if(i.prev){if(i.prev.is(":visible")){i.prev.focus()}else{setTimeout(function(){i.prev.trigger("shiftTabPressed")},10)}}}else{if(i.next){if(i.next.is(":visible")){i.next.focus()}else{setTimeout(function(){i.next.trigger("tabPressed")},10)}}}};t.bind("keydown."+i.namespace,function(e){if(e.which==9){if(e.shiftKey){if(n(true)){return}}else{if(n()){return}}e.stopPropagation();e.preventDefault()}});t.bind("tabPressed."+i.namespace,function(e){n()});t.bind("shiftTabPressed."+i.namespace,function(e){n(true)})})}});e.tabChain=function(e,t,n){if(e&&e.length>0){for(var i=0;i<e.length;i++){var r=(i-1)%e.length;var a=(i+1)%e.length;if(r<0){r=e.length+r}if(e[i]&&e[i]!==-1){e[i].easyTab({prev:e[r],next:e[a],delay:t,namespace:n})}}}}})(Streak.jQuery);(function(e,t,n,i){var r=e.jQuery;r.fn.caret=function(n,i){var a=e.document;var o,s,l=this[0];if(typeof n==="object"&&typeof n.start==="number"&&typeof n.end==="number"){o=n.start;s=n.end}else if(typeof n==="number"&&typeof i==="number"){o=n;s=i}else if(typeof n==="string"){if((o=l.value.indexOf(n))>-1)s=o+n[t];else o=null}else if(Object.prototype.toString.call(n)==="[object RegExp]"){var u=n.exec(l.value);if(u!==null){o=u.index;s=o+u[0][t]}}if(typeof o!="undefined"){this[0].selectionStart=o;this[0].selectionEnd=s;this[0].focus();return this}else{var c=l.selectionStart,d=l.selectionEnd;if(l.tagName==="INPUT"){var h=l.value.substring(c,d);return{start:c,end:d,text:h,replace:function(e){return l.value.substring(0,c)+e+l.value.substring(d,l.value[t])},goToEnd:function(){if(l.setSelectionRange){var e=r(l).val().length*2;l.setSelectionRange(e,e)}else{r(l).val(r(l).val())}}}}var f=0;try{f=a.getSelection().getRangeAt().startOffset}catch(p){}var m;try{m=a.getSelection().getRangeAt().endOffset}catch(p){}return{start:f,end:m,goToEnd:function(){var e,t;if(a.createRange){t=a.createRange();t.selectNodeContents(l);t.collapse(false);e=a.getSelection();e.removeAllRanges();e.addRange(t)}}}}};r.fn.insertHTMLAtCaret=function(e){this.focus();if(this.is("textarea")){var t=this[0];var n=t.selectionStart;if(t.selectionStart<t.selectionEnd){t.value=t.value.substring(0,t.selectionStart)+t.value.substring(t.selectionEnd)}t.value=t.value.substring(0,n)+e+t.value.substring(n);t.selectionStart=n+e.length;t.selectionEnd=n+e.length}else{var i,r,a;var o=null;if(this[0].getSelection){o=this[0]}else if(this[0].ownerDocument&&this[0].ownerDocument.getSelection){o=this[0].ownerDocument}if(o){i=o.getSelection();if(i.getRangeAt&&i.rangeCount){r=i.getRangeAt(0);r.deleteContents();var s=document.createElement("div");s.innerHTML=e;var l=document.createDocumentFragment(),u=s.firstChild,c,d;while(c=s.firstChild){d=l.appendChild(c)}r.insertNode(l);if(d){r=r.cloneRange();r.setStartAfter(d);r.collapse(true);i.removeAllRanges();i.addRange(r)}return u}}}};r.fn.insertTextAtCaret=function(e){this.focus();if(this.is("textarea")){var t=this[0];var n=t.selectionStart;if(t.selectionStart<t.selectionEnd){t.value=t.value.substring(0,t.selectionStart)+t.value.substring(t.selectionEnd)}t.value=t.value.substring(0,n)+e+t.value.substring(n);t.selectionStart=n+e.length;t.selectionEnd=n+e.length}else{var i,r,a;var o=null;if(this[0].getSelection){o=this[0]}else if(this[0].ownerDocument&&this[0].ownerDocument.getSelection){o=this[0].ownerDocument}if(o){i=o.getSelection();if(i.getRangeAt&&i.rangeCount){r=i.getRangeAt(0);r.deleteContents();var s=document.createTextNode(e);r.insertNode(s);r=r.cloneRange();r.setStartAfter(s);r.collapse(true);i.removeAllRanges();i.addRange(r)}}}};r.fn.deleteText=function(e){this.focus();if(this.is("textarea")){var t=this[0];var n=t.selectionStart;var i=t.value.substring(0,t.selectionStart-e+1);var r=t.value.substring(t.selectionStart);t.value=i+r;t.selectionStart=n-e+1;t.selectionEnd=t.selectionStart}else{var a,o;var s=null;if(this[0].getSelection){s=this[0]}else if(this[0].ownerDocument){s=this[0].ownerDocument}if(s.getSelection){a=s.getSelection();if(a.getRangeAt&&a.rangeCount){o=a.getRangeAt(0);o.setStart(o.startContainer,o.startOffset-e);o.deleteContents()}}}};r.fn.insertTextAtNodeAndPosition=function(e,t,n){if(this.is("textarea")){var i=this[0];var r=i.selectionStart;if(i.selectionStart<i.selectionEnd){i.value=i.value.substring(0,i.selectionStart)+i.value.substring(i.selectionEnd)}i.value=i.value.substring(0,r)+e+i.value.substring(r);i.selectionStart=r+e.length;i.selectionEnd=r+e.length}else{var a,o,s;var l=null;if(this[0].getSelection){l=this[0]}else if(this[0].ownerDocument&&this[0].ownerDocument.getSelection){l=this[0].ownerDocument}if(l){a=l.getSelection();if(t&&_.isReal(n)){o=a.getRangeAt().cloneRange();a.removeAllRanges();o.selectNode(t);o.collapse(n===0);a.addRange(o);a.setPosition(n)}if(!o){o=a.getRangeAt(0);o.deleteContents()}var u=document.createElement("div");u.innerHTML=e;var c=document.createDocumentFragment(),d=u.firstChild,t,h;while(t=u.firstChild){h=c.appendChild(t)}o.insertNode(c);if(h){setTimeout(function(){o=document.createRange();o.selectNodeContents(h);o.collapse(true);a.removeAllRanges();a.addRange(o)},10)}return d}}};r.fn.getCursorNodeAndPosition=function(){var e=this[0].ownerDocument.getSelection();var t=e.focusNode?e.focusNode:null;var n=t?e.getRangeAt().startOffset:null;return{node:t,position:n}};r.fn.selectContents=function(){var e=this[0].ownerDocument.getSelection();var t=this[0].ownerDocument.createRange();t.selectNodeContents(this[0]);e.removeAllRanges();e.addRange(t)}})(Streak,"length","createRange","duplicate");(function(e){e.fn.MultipleAutoSuggest=function(t){var n={data:null,wrapperCss:{},minChars:2,dataFunc:function(e,t){},stringDataFunc:e.noop,convertFunc:function(e,t){},compareFunc:function(e,t){},selectFunc:function(e){},removeFunc:function(e){},doneFunc:function(e){},listChangeFunc:function(e){},clickStop:null,clickBody:null,noResultsFoundText:null,immediateDone:false,idProperty:"email",suggestionTemplate:null,existingList:[],onlyValidEmailAddress:false};var i={};e.extend(i,n,t);return this.each(function(){var t=this;var n=e(this);var r=n.parent();r.addClass("parent");r.css(i.wrapperCss);r.after('<div style="clear:both;"></div>');var a=[];var o=[];var s=false;var l=null;var u=i.selectFunc;i.selectFunc=c;i.getExcludedIDsFunc=function(){return o};n.AutoSuggest(i);if(i.data){e.each(i.data,function(e,t){d(t)})}n.bind("setPeopleList",function(t){r.parent().find(".autoChosen").remove();a=[];o=[];var i=n.data("peopleList")||[];e.each(i,function(e,t){d(t)})});n[0].addEventListener("keydown",function(e){switch(e.which){case 27:s=false;break;case 8:if(!n.val()){r.parent().find(".vR:last .vM").trigger("click");n.trigger("bbFocus");n.trigger("bbUnselect")}break}},true);n.focus(function(){s=true;clearTimeout(l)});n.bind("enterPressed shiftTabPressed tabPressed",function(e){f()});n.blur(function(){s=false;clearTimeout(l);l=setTimeout(function(){if(!s){f()}},150)});function c(e){u(e);d(e);n.trigger("bbFocus")}function d(t){var s=e(Streak.Template.underscore("lib/jqueryplugins/multipleautosuggest")({name:t.fullName||t.email,email:t.email}));var l=s.find(".vM");l.click(function(e){n.focus();a.removeVal(t);o.removeVal(h(t));s.remove();if(i.removeFunc){i.removeFunc(t)}if(i.listChangeFunc){i.listChangeFunc(a)}e.preventDefault();return false});r.before(s);a.push(t);o.push(h(t));if(i.listChangeFunc){i.listChangeFunc(a)}return s}function h(e){if(i.onlyValidEmailAddress){return e[i.idProperty]}else{return e[i.idProperty]||e.displayName}}function f(){if(s){s=false}if(i.doneFunc){i.doneFunc(a)}}})}})(Streak.jQuery);(function(e){var t=Streak.Date;e.fn.pickdate=function(e){if(this.length>1){throw new Error("dont call pick date with more than one element")}if(this.length===0){return null}return new n(this,e)};function n(n,i){var r;this.element=e(n);this.options={};e.extend(this.options,{pickerClass:"streak__pickDate",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayShort:2,monthShort:3,startDay:0,timePicker:false,timePickerOnly:false,yearPicker:true,militaryTime:false,yearsPerPage:20,format:"m-d-Y",allowEmpty:false,inputOutputFormat:"U",animationDuration:400,useFadeInOut:true,startView:"month",positionOffset:{x:0,y:0},useFixedPosition:true,minDate:null,maxDate:null,debug:false,appendTo:document.body,body:document.body,isPersistent:false,setInput:true,autoClose:true,onShow:e.noop,onClose:e.noop,onSelect:e.noop,onClear:e.noop},i);this.formatMinMaxDates();if(this.options.timePickerOnly){this.options.timePicker=true;this.options.startView="time"}if(r===this.element.val()){r=this.format(new t(this.unformat(r,this.options.inputOutputFormat)),this.options.format)}else if(!i.allowEmpty){r=this.format(new t,this.options.format)}else{r=""}this.display=this.element.css("display");var a=this;this.element.bind({keydown:e.proxy(function(n){if(n.which==27){if(this.element.data("time")){this.choice=this.dateToObject(t.ccreate(this.element.data("time")));this.select(this.choice)}else{this.element.val("");this.close(null,true)}}else if(n.which==13){if(this.element.val().length>0){var i=t.ccreate(this.element.val());if(i.isValid()){this.choice=this.dateToObject(i);this.select(this.choice,true)}else{this.element.val("");if(e.isFunction(this.options.onClear)){this.options.onClear()}this.close(null,true,true)}}else{if(e.isFunction(this.options.onClear)){this.options.onClear()}this.close(null,true,true)}n.preventDefault();n.stopPropagation()}else if(n.which===9){a.close(null,true)}},this),keyup:e.proxy(function(e){var n=t.ccreate(this.element.val());if(!n.isValid()){n=t.ccreate(this.element.val(),Streak.BentoBox.Locale.getCurrent())}if(n.isValid()){this.choice=this.dateToObject(n);this.render(null,n)}},this)});if(this.options.isPersistent){this.showCalendar()}else{this.element.bind({onfocus:e.proxy(function(e){this.showCalendar()},this),onblur:e.proxy(function(e){this.close(null,true,false)},this)})}}n.prototype={showCalendar:function(){var e=this.element;var n=e;var i=e.data("time");var r=n.offset();if(i){i=t.ccreate(i)}else{i=new t;if(this.options.maxDate&&i.valueOf()>this.options.maxDate.valueOf()){i=new t(this.options.maxDate.valueOf())}if(this.options.minDate&&i.valueOf()<this.options.minDate.valueOf()){i=new t(this.options.minDate.valueOf())}}this.input=e;this.visual=n;if(!this.options.isPersistent){this.show({left:r.left+this.options.positionOffset.x,top:r.top+this.visual.outerHeight()+this.options.positionOffset.y},i)}else{this.show({left:0,top:0},i)}},dateToObject:function(e){return{year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()}},dateFromObject:function(n){var i=new t,r;
i.setDate(1);e.each(["year","month","day","hours","minutes","seconds"],e.proxy(function(e,t){r=n[t];if(!(r||r===0))return;switch(t){case"day":i.setDate(r);break;case"month":i.setMonth(r);break;case"year":i.setFullYear(r);break;case"hours":i.setHours(r);break;case"minutes":i.setMinutes(r);break;case"seconds":i.setSeconds(r);break}},this));return i},show:function(n,i){this.formatMinMaxDates();if(i){this.working_date=t.ccreate(i)}else{this.working_date=t.ccreate()}this.today=t.ccreate();this.choice=this.dateToObject(this.working_date);this.mode=this.options.startView=="time"&&!this.options.timePicker?"month":this.options.startView;this.render();if(e.isFunction(this.options.onShow))this.options.onShow()},render:function(e,n){if(!this.picker){this.constructPicker()}else{var i=this.oldContents;this.oldContents=this.newContents;this.newContents=i;this.newContents.empty()}if(n)this.working_date=n;var r=new t(this.working_date.getTime());this.limit={right:false,left:false};switch(this.mode){case"decades":this.renderDecades();break;case"year":this.renderYear();break;case"time":this.renderTime();this.limit={right:true,left:true};break;default:this.renderMonth()}this.picker.find(".previous").toggleClass("disabled",this.limit.left);this.picker.find(".next").toggleClass("disabled",this.limit.right);this.picker.find(".title").css("cursor",this.allowZoomOut()?"pointer":"default");this.working_date=r;if(this.options.useFadeInOut){this.picker.fadeIn(this.options.animationDuration)}if(e){this.fx(e)}else{this.oldContents.hide();this.newContents.css({left:"0px"}).show()}if(this.options.useFixedPosition){this.picker.containByScreen(this.options.appendTo)}},fx:function(e){if(e=="right"){this.oldContents.css("left",0).show();this.newContents.css("left",this.bodyWidth).show();this.slider.css("left",-this.bodyWidth)}else if(e=="left"){this.oldContents.css("left",this.bodyWidth).show();this.newContents.css("left",0).show();this.slider.css("left",0)}else if(e=="fade"){this.slider.css("left",0);this.oldContents.css("left",0).fadeOut(this.options.animationDuration>>1);this.newContents.css("left",0).hide().fadeIn(this.options.animationDuration)}},constructPicker:function(){var t=this;e(this.options.appendTo).append(this.picker=e('<div class="'+this.options.pickerClass+'" tabindex="-1"/>'));if(this.options.useFadeInOut){this.picker.hide()}if(this.options.isPersistent)this.picker.css({position:"relative"});var n,i,r;this.picker.append(n=e('<div class="header"/>'));n.append(i=e('<div class="title"/>').captureClick(e.proxy(this.zoomOut,this)));n.append(e('<div class="previous">&larr;</div>').captureClick(function(){setTimeout(function(){t.previous()},20)}));n.append(e('<div class="next">&rarr;</div>').captureClick(function(){setTimeout(function(){t.next()},20)}));n.append(e('<div class="closeButton">x</div>').captureClick(e.proxy(this.close,this)));i.append(e('<span class="titleText"/>'));this.picker.append(r=e('<div class="body"/>'));this.bodyHeight=193;this.bodyWidth=208;r.append(this.slider=e('<div style="position:absolute;top:0;left:0;width:'+2*this.bodyWidth+"px;height:"+2*this.bodyHeight+'px" />'));this.slider.append(this.oldContents=e('<div style="position:absolute;top:0;left:'+this.bodyWidth+"px;width:"+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />'));this.slider.append(this.newContents=e('<div style="position:absolute;top:0;left:0;width:'+this.bodyWidth+"px;height:"+this.bodyHeight+'px" />'));if(this.options.autoClose){this.picker.bodyCloseAndStop({body:e(this.options.body),stop:e(this.options.appendTo)[0],closeFunction:function(){t.close(null,true)}})}if(this.options.useFixedPosition){this.picker[0].style.position="fixed"}},renderDecades:function(){while(this.working_date.getFullYear()%this.options.yearsPerPage>0){this.working_date.setFullYear(this.working_date.getFullYear()-1)}this.renderTitle(this.working_date.getFullYear()+"-"+(this.working_date.getFullYear()+this.options.yearsPerPage-1));var t,n,i,r=false,a;this.newContents.append(a=e('<div class="years"/>'));if(this.options.minDate&&this.working_date.getFullYear()<=this.options.minDate.getFullYear()){this.limit.left=true}for(t=0;t<this.options.yearsPerPage;t++){n=this.working_date.getFullYear();a.append(i=e('<div class="year year'+t+(n==this.today.getFullYear()?" today":"")+(n==this.choice.year?" selected":"")+'">'+n+"</>"));if(this.limited("year")){i.addClass("unavailable");if(r){this.limit.right=true}else{this.limit.left=true}}else{r=true;i.click({year:n},e.proxy(function(e){this.working_date.setFullYear(e.data.year);this.mode="year";this.render("fade")},this))}this.working_date.setFullYear(this.working_date.getFullYear()+1)}if(!r||this.options.maxDate&&this.working_date.getFullYear()>=this.options.maxDate.getFullYear()){this.limit.right=true}},renderYear:function(){var t=this.today.getMonth(),n=this.working_date.getFullYear()==this.today.getFullYear(),i=this.working_date.getFullYear()==this.choice.year,r=false,a,o,s;this.renderTitle(this.working_date.getFullYear());this.working_date.setMonth(0);this.newContents.append(a=e('<div class="months"/>'));for(o=0;o<=11;o++){a.append(s=e('<div class="month month'+(o+1)+(o==t&&n?" today":"")+(o==this.choice.month&&i?" selected":"")+'">'+(this.options.monthShort?this.options.months[o].substring(0,this.options.monthShort):this.options.months[o])+"</div>"));if(this.limited("month")){s.addClass("unavailable");if(r){this.limit.right=true}else{this.limit.left=true}}else{r=true;s.click({month:o},e.proxy(function(e){this.working_date.setDate(1);this.working_date.setMonth(e.data.month);this.mode="month";this.render("fade")},this))}this.working_date.setMonth(o)}if(!r)this.limit.right=true},renderTime:function(){var t;this.newContents.append(t=e('<div class="time"/>'));if(this.options.timePickerOnly){this.renderTitle("Select a time")}else{this.renderTitle(this.format(this.working_date,"j M, Y"))}t.append(e('<input type="text" class="hour"'+(this.options.militaryTime?' style="left:30px"':"")+' maxlength="2" value="'+this.leadZero(this.options.militaryTime?this.working_date.getHours():this.working_date.getHours()>12?this.working_date.getHours()-12:this.working_date.getHours())+'"/>'));t.append(e('<input type="text" class="minutes"'+(this.options.militaryTime?' style="left:110px"':"")+' maxlength="2" value="'+this.leadZero(this.working_date.getMinutes())+'"/>'));t.append(e('<div class="separator"'+(this.options.militaryTime?' style="left:91px"':"")+">:</div>"));if(!this.options.militaryTime){t.append(e('<select class="ampn">'+'<option value="PM">PM</option>'+'<option value="AM">AM</option>'+"</select>"))}t.append(e('<input type="submit" value="OK" class="ok"/>').click(e.proxy(function(t){t.stopPropagation();this.select(e.extend(this.dateToObject(this.working_date),{hours:parseInt(this.picker.find(".hour").val(),10)+(!this.options.militaryTime&&this.picker.find(".ampm").val()=="PM"?12:0),minutes:parseInt(this.picker.find(".minutes").val(),10)}))},this)))},renderMonth:function(){if(!this.today){this.today=t.create()}var n=this.working_date.getMonth(),i=e('<div class="days"/>'),r=e('<div class="titles"/>'),a=false,o=this.today.toDateString(),s=this.dateFromObject(this.choice).toDateString(),l,u,c,d,h;this.renderTitle(this.options.months[n]+" "+this.working_date.getFullYear());this.working_date.setDate(1);for(u=0;u<1e3;u++){if(this.working_date.getDay()===this.options.startDay){break}this.working_date.setDate(this.working_date.getDate()-1)}this.newContents.append(i.append(r));for(l=this.options.startDay;l<this.options.startDay+7;l++){r.append(e('<div class="title day day'+l%7+'">'+this.options.days[l%7].substring(0,this.options.dayShort)+"</div>"))}for(u=0;u<42;u++){c=["day","day"+this.working_date.getDay()];if(this.working_date.toDateString()==o)c.push("today");if(this.working_date.toDateString()==s)c.push("selected");if(this.working_date.getMonth()!=n)c.push("otherMonth");if(u%7===0){i.append(h=e('<div class="week week'+Math.floor(u/7)+'"/>'))}h.append(d=e('<div class="'+c.join(" ")+'">'+this.working_date.getDate()+"</div>"));if(this.limited("date")){d.addClass("unavailable");if(a){this.limit.right=true}else if(this.working_date.getMonth()==n){this.limit.left=true}}else{a=true;d.click({day:this.working_date.getDate(),month:this.working_date.getMonth(),year:this.working_date.getFullYear()},e.proxy(function(e){if(this.options.timePicker){this.working_date.setDate(e.data.day);this.working_date.setMonth(e.data.month);this.mode="time";this.render("fade")}else{e.stopPropagation();this.select(e.data)}},this))}this.working_date.setDate(this.working_date.getDate()+1)}if(!a)this.limit.right=true},renderTitle:function(e){if(this.allowZoomOut()){this.picker.find(".title").removeClass("disabled")}else{this.picker.find(".title").addClass("disabled")}this.picker.find(".titleText").text(e)},limited:function(e){var t=!!this.options.minDate,n=!!this.options.maxDate;if(!(t&&n))return false;switch(e){case"year":return t&&this.working_date.getFullYear()<this.options.minDate.getFullYear()||n&&this.working_date.getFullYear()>this.options.maxDate.getFullYear();case"month":var i=parseInt(""+this.working_date.getFullYear()+this.leadZero(this.working_date.getMonth()),10);return t&&i<parseInt(""+this.options.minDate.getFullYear()+this.leadZero(this.options.minDate.getMonth()),10)||n&&i>parseInt(""+this.options.maxDate.getFullYear()+this.leadZero(this.options.maxDate.getMonth()),10);case"date":return t&&this.working_date<this.options.minDate||n&&this.working_date>this.options.maxDate}},allowZoomOut:function(){if(this.mode=="time"&&this.options.timePickerOnly)return false;if(this.mode=="decades")return false;return!(this.mode=="year"&&!this.options.yearPicker)},zoomOut:function(){if(!this.allowZoomOut())return;switch(this.mode){case"year":this.mode="decades";break;case"time":this.mode="month";break;default:this.mode="year"}this.render("fade")},previous:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()-this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()-1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()-1)}if(this.mode!="time"){this.render("left")}},next:function(){switch(this.mode){case"decades":this.working_date.setFullYear(this.working_date.getFullYear()+this.options.yearsPerPage);break;case"year":this.working_date.setFullYear(this.working_date.getFullYear()+1);break;case"month":this.working_date.setMonth(this.working_date.getMonth()+1)}if(this.mode!="time"){this.render("right")}},hideCalendar:function(){this.close(null,true)},close:function(e,t,n){var i=this;if(!this.picker||this.closing||this.options.isPersistent)return;if(t||e&&e.target!==this.picker&&this.picker.has(e.target).size()===0&&e.target!==this.visual){if(this.options.useFadeInOut){this.closing=true;this.picker.fadeOut(this.options.animationDuration>>1,function(){i.destroy(n)})}else{this.destroy(n)}}},destroy:function(t){this.picker.remove();this.picker=null;this.closing=false;if(e.isFunction(this.options.onClose)){this.options.onClose(t)}},select:function(n,i){this.working_date=this.dateFromObject(e.extend(this.choice,n));if(!this.options.timePicker){var r=new t(this.working_date.getFullYear(),this.working_date.getMonth(),this.working_date.getDate(),12,0,0);r.toLocalTime();this.working_date.setTime(r.getTime())}if(this.options.setInput&&this.input){this.input.val(this.format(this.working_date,this.options.inputOutputFormat))}if(this.visual){this.visual.val(this.format(this.working_date,this.options.format))}if(e.isFunction(this.options.onSelect))this.options.onSelect(this.working_date);this.close(null,true,i)},formatMinMaxDates:function(){if(this.options.maxDate&&this.options.maxDate.format){this.options.maxDate=this.unformat(this.options.maxDate.date,this.options.maxDate.format);this.options.maxDate.setHours(23);this.options.maxDate.setMinutes(59);this.options.maxDate.setSeconds(59)}},leadZero:function(e){return e<10?"0"+e:e},format:function(e,t){var n="",i=e.getHours(),r=e.getMonth();for(var a=0;a<t.length;a++){switch(t.charAt(a)){case"\\":a++;n+=t.charAt(a);break;case"y":n+=(100+e.getYear()+"").substring(1);break;case"Y":n+=e.getFullYear();break;case"m":n+=this.leadZero(r+1);break;case"n":n+=r+1;break;case"M":n+=this.options.months[r].substring(0,this.options.monthShort);break;case"F":n+=this.options.months[r];break;case"d":n+=this.leadZero(e.getDate());break;case"j":n+=e.getDate();break;case"D":n+=this.options.days[e.getDay()].substring(0,this.options.dayShort);break;case"l":n+=this.options.days[e.getDay()];break;case"G":n+=i;break;case"H":n+=this.leadZero(i);break;case"g":n+=i%12?i%12:12;break;case"h":n+=this.leadZero(i%12?i%12:12);break;case"a":n+=i>11?"pm":"am";break;case"A":n+=i>11?"PM":"AM";break;case"i":n+=this.leadZero(e.getMinutes());break;case"s":n+=this.leadZero(e.getSeconds());break;case"U":n+=Math.floor(e.valueOf()/1e3);break;default:n+=t.charAt(a)}}return n},unformat:function(e,n){var i=new t,a={},o,s,l;e=e.toString();for(var u=0;u<n.length;u++){o=n.charAt(u);switch(o){case"\\":r=null;u++;break;case"y":r="[0-9]{2}";break;case"Y":r="[0-9]{4}";break;case"m":r="0[1-9]|1[012]";break;case"n":r="[1-9]|1[012]";break;case"M":r="[A-Za-z]{"+this.options.monthShort+"}";break;case"F":r="[A-Za-z]+";break;case"d":r="0[1-9]|[12][0-9]|3[01]";break;case"j":r="[1-9]|[12][0-9]|3[01]";break;case"D":r="[A-Za-z]{"+this.options.dayShort+"}";break;case"l":r="[A-Za-z]+";break;case"G":case"H":case"g":case"h":r="[0-9]{1,2}";break;case"a":r="(am|pm)";break;case"A":r="(AM|PM)";break;case"i":case"s":r="[012345][0-9]";break;case"U":r="-?[0-9]+$";break;default:r=null}if(r){s=e.match("^"+r);if(s){a[o]=s[0];e=e.substring(a[o].length)}else{if(this.options.debug)alert("Fatal Error in will_pickdate\n\nUnexpected format at: '"+e+"' expected format character '"+o+"' (pattern '"+r+"')");return i}}else{e=e.substring(1)}}for(o in a){l=a[o];switch(o){case"y":i.setFullYear(l<30?2e3+parseInt(l,10):1900+parseInt(l,10));break;case"Y":i.setFullYear(l);break;case"m":case"n":i.setMonth(l-1);break;case"M":l=this.options.months.filter(function(e){return this.substring(0,this.options.monthShort)==l})[0];case"F":i.setMonth(options.months.indexOf(l));break;case"d":case"j":i.setDate(l);break;case"G":case"H":i.setHours(l);break;case"g":case"h":if(a["a"]=="pm"||a["A"]=="PM"){i.setHours(l==12?0:parseInt(l,10)+12)}else{i.setHours(l)}break;case"i":i.setMinutes(l);break;case"s":i.setSeconds(l);break;case"U":i=new t(parseInt(l,10)*1e3)}}return i}}})(Streak.jQuery);(function(e){var t=e.jQuery,n=e.Date;function i(e,t){var i=new n(e),r=((new n).getTime()-i.getTime())/1e3,a=Math.floor(r/86400),o=Math.abs((new n).getYear()-i.getYear());if(isNaN(a)||(a<0||a>=31)&&!t)return"";if(t){var s=i.toDateString().split(" ");return o===0&&s[1]+" "+s[2]||s[1]+" "+s[2]+" "+s[3]}else{return a===0&&(r<60&&"just now"||r<120&&"1 minute ago"||r<3600&&Math.floor(r/60)+" minutes ago"||r<7200&&"1 hour ago"||r<86400&&Math.floor(r/3600)+" hours ago")||a==1&&"Yesterday"||a<7&&a+" days ago"||a<31&&Math.ceil(a/7)+" weeks ago"}}t.fn.prettyDate=function(t){return this.each(function(){var n=i(this.title,t);if(n)e.jQuery(this).text(n)})};n.prototype.prettyDate=function(e){return i(this,e)}})(Streak);(function(e){var t=e.jQuery;t.fn.selectAllOnClick=function(){return this.each(function(){t(this).click(function(t){var n=e.document.getSelection();n.removeAllRanges();n.selectAllChildren(this)}.bind(this))})}})(Streak);/*!
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(e){var t={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var n={duration:"fast",direction:"both",toTop:false};var i=/^(?:html)$/i;var r=function(t,n){n=n||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle);var i=document.defaultView&&document.defaultView.getComputedStyle?true:false;var r={top:parseFloat(i?n.borderTopWidth:e.css(t,"borderTopWidth"))||0,left:parseFloat(i?n.borderLeftWidth:e.css(t,"borderLeftWidth"))||0,bottom:parseFloat(i?n.borderBottomWidth:e.css(t,"borderBottomWidth"))||0,right:parseFloat(i?n.borderRightWidth:e.css(t,"borderRightWidth"))||0};return{top:r.top,left:r.left,bottom:r.bottom,right:r.right,vertical:r.top+r.bottom,horizontal:r.left+r.right}};var a=function(t){var n=e(window);var a=i.test(t[0].nodeName);return{border:a?{top:0,left:0,bottom:0,right:0}:r(t[0]),scroll:{top:(a?n:t).scrollTop(),left:(a?n:t).scrollLeft()},scrollbar:{right:a?0:t.innerWidth()-t[0].clientWidth,bottom:a?0:t.innerHeight()-t[0].clientHeight},rect:function(){var e=t[0].getBoundingClientRect();return{top:a?0:e.top,left:a?0:e.left,bottom:a?t[0].clientHeight:e.bottom,right:a?t[0].clientWidth:e.right,height:t[0].clientHeight}}()}};e.fn.extend({scrollintoview:function(r){r=e.extend({},n,r);r.direction=t[typeof r.direction==="string"&&r.direction.toLowerCase()]||t.both;var o="";if(r.direction.x===true)o="horizontal";if(r.direction.y===true)o=o?"both":"vertical";var s=this.eq(0);if(!s.isVisible()){if(e.isFunction(r.complete)){r.complete()}return}var l=r.scroller||s.closest(":scrollable("+o+")");if(l.length>0){l=l.eq(0);var u={};var c={s:a(l)};var d={};if(r.rectangle){r.rectangle.left+=c.s.rect.left;r.rectangle.right+=c.s.rect.left;c.e={rect:r.rectangle};var h=r.rectangle.bottom-c.s.scroll.top;if(r.rectangle.top<c.s.scroll.top||r.toTop){u.scrollTop=r.rectangle.top}else if(h>c.s.rect.height){u.scrollTop=c.s.scroll.top+(h-c.s.rect.height)}}else{c.e=a(s);d.top=c.e.rect.top-(c.s.rect.top+c.s.border.top);d.bottom=c.s.rect.bottom-c.s.border.bottom-c.s.scrollbar.bottom-c.e.rect.bottom;if(r.direction.y===true){if(d.top<0){u.scrollTop=c.s.scroll.top+d.top}else if(d.top>0&&d.bottom<0||r.toTop){u.scrollTop=c.s.scroll.top+Math.min(d.top,-d.bottom)+(r.toTop?c.s.rect.bottom-c.s.rect.top+(c.e.rect.top-c.e.rect.bottom):0)}}}d.left=c.e.rect.left-(c.s.rect.left+c.s.border.left);d.right=c.s.rect.right-c.s.border.right-c.s.scrollbar.right-c.e.rect.right;if(r.direction.x===true){if(d.left<0){u.scrollLeft=c.s.scroll.left+d.left}else if(d.left>0&&d.right<0){u.scrollLeft=c.s.scroll.left+Math.min(d.left,-d.right)}}if(!e.isEmptyObject(u)){if(i.test(l[0].nodeName)){l=e("html,body")}l.animate(u,r.duration).eq(0).queue(function(t){e.isFunction(r.complete)&&r.complete.call(l[0]);t()})}else{e.isFunction(r.complete)&&r.complete.call(l[0])}}return this}});var o={auto:true,scroll:true,visible:false,hidden:false};e.extend(e.expr[":"],{scrollable:function(e,n,r,a){var s=t[typeof r[3]==="string"&&r[3].toLowerCase()]||t.both;var l=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;var u={x:o[l.overflowX.toLowerCase()]||false,y:o[l.overflowY.toLowerCase()]||false,isRoot:i.test(e.nodeName)};if(!u.x&&!u.y&&!u.isRoot){return false}var c={height:{scroll:e.scrollHeight,client:e.clientHeight},width:{scroll:e.scrollWidth,client:e.clientWidth},scrollableX:function(){return(u.x||u.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(u.y||u.isRoot)&&this.height.scroll>this.height.client}};return s.y&&c.scrollableY()||s.x&&c.scrollableX()}})})(Streak.jQuery);(function(e){var t=[];e.modal=function(t,n){return e.modal.impl.init(t,n)};var n=false;e.modal.block=function(){n=true};e.modal.unblock=function(){n=false};e.modal.close=function(){e.modal.impl.close()};e.modal.focus=function(t){e.modal.impl.focus(t)};e.modal.setContainerDimensions=function(){e.modal.impl.setContainerDimensions()};e.modal.setPosition=function(){e.modal.impl.setPosition()};e.modal.update=function(t,n){e.modal.impl.update(t,n)};e.fn.modal=function(t){return e.modal.impl.init(this,t)};e.modal.defaults={appendTo:"body",focus:true,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:false,autoPosition:true,zIndex:1e3,close:true,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:true,overlayClose:false,position:null,persist:false,modal:true,onOpen:null,onShow:null,onClose:null};e.modal.impl={d:{},dStack:[],currentData:null,currentOptions:null,overlayStack:[],init:function(t,i){if(n&&!i.force){return}var r=this;if(r.d.data){r.close(!i.dontStack)}r.currentData=t;r.currentOptions=i;r.o=e.extend({},e.modal.defaults,i);r.zIndex=r.o.zIndex;r.occb=false;if(typeof t==="object"){t=t instanceof e?t:e(t);r.d.placeholder=false;if(t.parent().parent().size()>0){t.before(e("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"}));r.d.placeholder=true;r.display=t.css("display");if(!r.o.persist){r.d.orig=t.clone(true)}}}else if(typeof t==="string"||typeof t==="number"){t=e("<div></div>").html(t)}else{alert("SimpleModal Error: Unsupported data type: "+typeof t);return r}r.create(t);t=null;r.open();if(e.isFunction(r.o.onShow)){r.o.onShow.apply(r,[r.d])}return r},create:function(n){var i=this;t=i.getDimensions();i.d.overlay=e("<div></div>").attr("id",i.o.overlayId).addClass("simplemodal-overlay").css(e.extend(i.o.overlayCss,{display:"none",opacity:i.o.opacity/100,position:"fixed",zIndex:i.o.zIndex+1})).appendTo(i.o.appendTo);i.d.container=e("<div></div>").attr("id",i.o.containerId).addClass("simplemodal-container").css({display:"none",position:"fixed",zIndex:i.o.zIndex+2}).append(i.o.close&&i.o.closeHTML?e(i.o.closeHTML).addClass(i.o.closeClass):"").appendTo(i.o.appendTo);i.d.wrap=e("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").appendTo(i.d.container);i.d.innerWrap=e("<div></div>").addClass("simplemodal-innerWrap").appendTo(i.d.wrap);i.d.data=n.attr("id",n.attr("id")||i.o.dataId).addClass("simplemodal-data").css(e.extend(i.o.dataCss,{display:"none"})).appendTo(i.o.appendTo);n=null;i.d.data.appendTo(i.d.innerWrap)},bindEvents:function(){var t=this;e("."+t.o.closeClass).bind("click.simplemodal",function(e){e.preventDefault();t.close()});if(t.o.modal&&t.o.close&&t.o.overlayClose){t.d.overlay.bind("click.simplemodal",function(e){e.preventDefault();t.close()})}e(document).bind("keydown.simplemodal",function(e){if(t.o.modal&&e.keyCode===9){t.watchTab(e)}else if(t.o.close&&t.o.escClose&&e.keyCode===27){e.preventDefault();t.close()}})},unbindEvents:function(){e("."+this.o.closeClass).unbind("click.simplemodal");e(document).unbind("keydown.simplemodal");e(window).unbind("resize.simplemodal");this.d.overlay.unbind("click.simplemodal")},focus:function(t){var n=this,i=t&&e.inArray(t,["first","last"])!==-1?t:"first";var r=e(":input:enabled:FastVisible(noCompute):"+i,n.d.wrap);setTimeout(function(){r.length>0?r.focus():n.d.wrap.focus()},10)},getDimensions:function(){var t=e(window);var n=t.height();return[n,t.width()]},getVal:function(e,n){return e?typeof e==="number"?e:e==="auto"?0:e.indexOf("%")>0?parseInt(e.replace(/%/,""))/100*(n==="h"?t[0]:t[1]):parseInt(e.replace(/px/,"")):null},update:function(e,t){var n=this;if(!n.d.data){return false}n.d.origHeight=n.getVal(e,"h");n.d.origWidth=n.getVal(t,"w");n.d.data.hide();e&&n.d.container.css("height",e);t&&n.d.container.css("width",t);n.setContainerDimensions();n.d.data.show();n.o.focus&&n.focus();n.unbindEvents();n.bindEvents()},setContainerDimensions:function(){var e=this;var n=e.d.origHeight?e.d.origHeight:e.getVal(e.d.container.css("height"),"h"),i=e.d.origWidth?e.d.origWidth:e.getVal(e.d.container.css("width"),"w"),r=e.d.data.outerHeight(true),a=e.d.data.outerWidth(true);e.d.origHeight=e.d.origHeight||n;e.d.origWidth=e.d.origWidth||i;var o=e.o.maxHeight?e.getVal(e.o.maxHeight,"h"):null,s=e.o.maxWidth?e.getVal(e.o.maxWidth,"w"):null,l=o&&o<t[0]?o:t[0],u=s&&s<t[1]?s:t[1];var c=e.o.minHeight?e.getVal(e.o.minHeight,"h"):"auto";if(!n){if(!r){n=c}else{if(r>l){n=l}else if(e.o.minHeight&&c!=="auto"&&r<c){n=c}else{n=r}}}else{n=e.o.autoResize&&n>l?l:n<c?c:n}var d=e.o.minWidth?e.getVal(e.o.minWidth,"w"):"auto";if(!i){if(!a){i=d}else{if(a>u){i=u}else if(e.o.minWidth&&d!=="auto"&&a<d){i=d}else{i=a}}}else{i=e.o.autoResize&&i>u?u:i<d?d:i}e.d.container.css({height:n,width:i});e.d.wrap.css({overflow:r>n||a>i?"auto":"visible"});e.o.autoPosition&&e.setPosition()},setPosition:function(){var e=this,n,i,r=t[0]/2-e.d.container.outerHeight(true)/2,a=t[1]/2-e.d.container.outerWidth(true)/2;if(e.o.position&&Object.prototype.toString.call(e.o.position)==="[object Array]"){n=e.o.position[0]||r;i=e.o.position[1]||a}else{n=r;i=a}e.d.container.css({left:i,top:n})},watchTab:function(t){var n=this;if(e(t.target).parents(".simplemodal-container").length>0){n.inputs=e(":input:enabled:FastVisible(noCompute):first, :input:enabled:FastVisible(noCompute):last",n.d.data[0]);if(!t.shiftKey&&t.target===n.inputs[n.inputs.length-1]||t.shiftKey&&t.target===n.inputs[0]||n.inputs.length===0){t.preventDefault();var i=t.shiftKey?"last":"first";n.focus(i)}}else{t.preventDefault();n.focus()}},open:function(){var t=this;t.d.iframe&&t.d.iframe.show();if(e.isFunction(t.o.onOpen)){t.o.onOpen.apply(t,[t.d])}else{t.d.overlay.show();t.d.container.show();t.d.data.show()}t.o.focus&&t.focus();t.bindEvents()},close:function(t){var n=this;if(!n.d.data){return false}n.unbindEvents();if(n.d.placeholder){var i=e("#simplemodal-placeholder");if(n.o.persist){i.replaceWith(n.d.data.removeClass("simplemodal-data").css("display",n.display))}else{n.d.data.hide().detach();i.replaceWith(n.d.orig)}}else{n.d.data.hide().detach()}n.d.container.hide().remove();n.d.iframe&&n.d.iframe.hide().remove();var r=n.d.overlay;if(t){n.d={};n.dStack.push({data:n.currentData,options:n.currentOptions})}else{if(e.isFunction(n.o.onClose)){if(n.o.onClose.apply(n,[n.d])){return}}n.d={};if(n.dStack.length>0){var a=n.dStack.pop();n.init(a.data,a.options)}}r.hide().remove()}}})(Streak.jQuery);(function(e){e.fn.bbmodal=function(t){var n={focus:false,overlayCss:{backgroundColor:"white",opacity:"0.75"},overlayClose:true,escClose:true,persist:true};var i=e.extend({},n,t);var r=this;return this.each(function(){r.modal(i)})}})(Streak.jQuery);(function(e){var t=e.jQuery;t.fn.simulateKeyboardPress=function(n){var i=t(this[0]);var r=i.offset();var a=e.document;var o=a.createEvent("KeyboardEvent");o.initKeyboardEvent("keydown",true,true,null,false,false,false,false,n,n);i[0].dispatchEvent(o);o=a.createEvent("KeyboardEvent");o.initKeyboardEvent("keypress",true,true,null,false,false,false,false,n,n);i[0].dispatchEvent(o);o=a.createEvent("KeyboardEvent");o.initKeyboardEvent("keyup",true,true,null,false,false,false,false,n,n);i[0].dispatchEvent(o)}})(Streak);(function(e){var t=e.jQuery;t.fn.simulateRawClick=function(){var n=e.document;return this.each(function(){var e=t(this);var i=e.offset();var r=n.createEvent("MouseEvents");r.initMouseEvent("mousedown",true,true,window,0,i.left,i.top,0,0,false,false,false,false,0,null);e[0].dispatchEvent(r);r=n.createEvent("MouseEvents");r.initMouseEvent("mouseup",true,true,window,0,i.left,i.top,0,0,false,false,false,false,0,null);e[0].dispatchEvent(r);r=n.createEvent("MouseEvents");r.initMouseEvent("click",true,true,window,0,i.left,i.top,0,0,false,false,false,false,0,null);e[0].dispatchEvent(r)})};t.fn.simulateHover=function(){var n=e.document;return this.each(function(){var e=t(this);var i=e.offset();var r=n.createEvent("MouseEvents");r.initMouseEvent("mouseover",true,true,window,0,i.left,i.top,0,0,false,false,false,false,0,null);e[0].dispatchEvent(r)})}})(Streak);(function(e){var t=e.jQuery;t(function(){var e={primaryStyles:["fontFamily","fontSize","fontWeight","fontVariant","fontStyle","paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","marginTop","marginBottom","marginRight","borderLeftColor","borderTopColor","borderBottomColor","borderRightColor","borderLeftStyle","borderTopStyle","borderBottomStyle","borderRightStyle","borderLeftWidth","borderTopWidth","borderBottomWidth","borderRightWidth","line-height","outline"],specificStyle:{"word-wrap":"break-word","overflow-x":"hidden","overflow-y":"auto"},simulator:function(e){if(t(e.body).find("#streak_textarea_simulator").length===0){t('<div id="streak_textarea_simulator"/>').css({position:"absolute",top:0,left:0,visibility:"hidden"}).appendTo(e.body)}return t(e.body).find("#streak_textarea_simulator")},toHtml:function(e){return t.getTextHTML(e)},getCaretPosition:function(){var n=e,i=this,r=i[0],a=i.offset(),o=r.ownerDocument;n.simulator(o).empty();t.each(n.primaryStyles,function(e,t){i.cloneStyle(n.simulator(o),t,o)});n.simulator(o).css(t.extend({width:i.width(),height:i.height()},n.specificStyle));var s=i.val(),l=i.getCursorPosition();var u=s.substring(0,l),c=s.substring(l);var d=t('<span class="before"/ style="display:inline-block;">').html(n.toHtml(u)),h=t('<span class="focus">&nbsp;</span>'),f=t('<span class="after"/>').html(n.toHtml(c));d.append(h);n.simulator(o).append(d).append(f);var p=h.offset(),m=n.simulator(o).offset();a=i.offset();offset={top:p.top-m.top-r.scrollTop+parseInt(i.getComputedStyle("fontSize",o),10)+a.top,left:h[0].offsetLeft-n.simulator(o)[0].offsetLeft-r.scrollLeft+a.left};n.simulator(o).empty();return offset}};t.fn.extend({getComputedStyle:function(e,t){if(this.length===0)return;var n=this[0];var i=this.css(e);i=i||t.defaultView.getComputedStyle(n,null)[e];return i},cloneStyle:function(e,n,i){var r=this.getComputedStyle(n,i);if(!!r){t(e).css(n,r)}},cloneAllStyle:function(e,t,n){var i=this[0];for(var r in i.style){var a=i.style[r];typeof a==="string"||typeof a==="number"?this.cloneStyle(e,r,n):NaN}},getCursorPosition:function(e){var t=this[0],n=0;if("selectionStart"in t){n=t.selectionStart}else if("selection"in e){var i=e.selection.createRange();var r=e.body.createTextRange();r.moveToElementText(t);for(;r.compareEndPoints("StartToStart",i)<0;n++)r.moveStart("character",1);for(var a=0;a<=n;a++){if(t.value.charAt(a)=="\n")n++}var o=t.value.split("\n").length-1;n-=o;return n}return n},getCaretPosition:e.getCaretPosition})})})(Streak);(function(e){var t=e._;var n=function(){};t.extend(n.prototype,{readyObjects:[],waitingForReady:0,inRegisterMode:true,reset:function(){this.readyObjects.length=0;this.waitingForReady=0;this.inRegisterMode=true;this.resetReady()},register:function(e){var t=this;this.readyObjects.push(e);this.waitingForReady+=1;e.ready(function(){t.waitingForReady-=1;if(t.waitingForReady<1&&!t.inRegisterMode){t.waitingForReady=0;t.trigger("ready")}})},doneRegistering:function(){this.inRegisterMode=false;if(this.waitingForReady===0){this.trigger("ready")}}});n.create=function(){return e.Eventer.create(new n)};e.ReadyListener=n})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;t.fn.trackable=function(n,i){return this.each(function(){var r=t(this);r.on("click",function(t){e.BentoBox.Tracker.trackStreakActive(i,{eventName:n})})})}})(Streak);(function(e){var t,n,i,r,a,o,s,l,u,c,d,h,f,p,m,_,g,v,y,w=[].slice,b=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},C=this;t=e.$;t.payment={};t.payment.fn={};t.fn.payment=function(){var e,n;n=arguments[0],e=2<=arguments.length?w.call(arguments,1):[];return t.payment.fn[n].apply(this,e)};a=/(\d{1,4})/g;r=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:a,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:true},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:a,length:[14],cvcLength:[3],luhn:true},{type:"laser",pattern:/^(6706|6771|6709)/,format:a,length:[16,17,18,19],cvcLength:[3],luhn:true},{type:"jcb",pattern:/^35/,format:a,length:[16],cvcLength:[3],luhn:true},{type:"unionpay",pattern:/^62/,format:a,length:[16,17,18,19],cvcLength:[3],luhn:false},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:a,length:[16],cvcLength:[3],luhn:true},{type:"mastercard",pattern:/^5[1-5]/,format:a,length:[16],cvcLength:[3],luhn:true},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:true},{type:"visa",pattern:/^4/,format:a,length:[13,14,15,16],cvcLength:[3],luhn:true}];n=function(e){var t,n,i;e=(e+"").replace(/\D/g,"");for(n=0,i=r.length;n<i;n++){t=r[n];if(t.pattern.test(e)){return t}}};i=function(e){var t,n,i;for(n=0,i=r.length;n<i;n++){t=r[n];if(t.type===e){return t}}};f=function(e){var t,n,i,r,a,o;i=true;r=0;n=(e+"").split("").reverse();for(a=0,o=n.length;a<o;a++){t=n[a];t=parseInt(t,10);if(i=!i){t*=2}if(t>9){t-=9}r+=t}return r%10===0};h=function(e){var t;if(e.prop("selectionStart")!=null&&e.prop("selectionStart")!==e.prop("selectionEnd")){return true}if(typeof document!=="undefined"&&document!==null?(t=document.selection)!=null?typeof t.createRange==="function"?t.createRange().text:void 0:void 0:void 0){return true}return false};p=function(e){var n=this;return setTimeout(function(){var n,i;n=t(e.currentTarget);i=n.val();i=t.payment.formatCardNumber(i);return n.val(i)})};l=function(e){var i,r,a,o,s,l,u;a=String.fromCharCode(e.which);if(!/^\d+$/.test(a)){return}i=t(e.currentTarget);u=i.val();r=n(u+a);o=(u.replace(/\D/g,"")+a).length;l=16;if(r){l=r.length[r.length.length-1]}if(o>=l){return}if(i.prop("selectionStart")!=null&&i.prop("selectionStart")!==u.length){return}if(r&&r.type==="amex"){s=/^(\d{4}|\d{4}\s\d{6})$/}else{s=/(?:^|\s)(\d{4})$/}if(s.test(u)){e.preventDefault();return i.val(u+" "+a)}else if(s.test(u+a)){e.preventDefault();return i.val(u+a+" ")}};o=function(e){var n,i;n=t(e.currentTarget);i=n.val();if(e.meta){return}if(e.which!==8){return}if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==i.length){return}if(/\d\s$/.test(i)){e.preventDefault();return n.val(i.replace(/\d\s$/,""))}else if(/\s\d?$/.test(i)){e.preventDefault();return n.val(i.replace(/\s\d?$/,""))}};u=function(e){var n,i,r;i=String.fromCharCode(e.which);if(!/^\d+$/.test(i)){return}n=t(e.currentTarget);r=n.val()+i;if(/^\d$/.test(r)&&(r!=="0"&&r!=="1")){e.preventDefault();return n.val("0"+r+" / ")}else if(/^\d\d$/.test(r)){e.preventDefault();return n.val(""+r+" / ")}};c=function(e){var n,i,r;i=String.fromCharCode(e.which);if(!/^\d+$/.test(i)){return}n=t(e.currentTarget);r=n.val();if(/^\d\d$/.test(r)){return n.val(""+r+" / ")}};d=function(e){var n,i,r;i=String.fromCharCode(e.which);if(i!=="/"){return}n=t(e.currentTarget);r=n.val();if(/^\d$/.test(r)&&r!=="0"){return n.val("0"+r+" / ")}};s=function(e){var n,i;if(e.meta){return}n=t(e.currentTarget);i=n.val();if(e.which!==8){return}if(n.prop("selectionStart")!=null&&n.prop("selectionStart")!==i.length){return}if(/\d(\s|\/)+$/.test(i)){e.preventDefault();return n.val(i.replace(/\d(\s|\/)*$/,""))}else if(/\s\/\s?\d?$/.test(i)){e.preventDefault();return n.val(i.replace(/\s\/\s?\d?$/,""))}};v=function(e){var t;if(e.metaKey||e.ctrlKey){return true}if(e.which===32){return false}if(e.which===0){return true}if(e.which<33){return true}t=String.fromCharCode(e.which);return!!/[\d\s]/.test(t)};_=function(e){var i,r,a,o;i=t(e.currentTarget);a=String.fromCharCode(e.which);if(!/^\d+$/.test(a)){return}if(h(i)){return}o=(i.val()+a).replace(/\D/g,"");r=n(o);if(r){return o.length<=r.length[r.length.length-1]}else{return o.length<=16}};g=function(e){var n,i,r;n=t(e.currentTarget);i=String.fromCharCode(e.which);if(!/^\d+$/.test(i)){return}if(h(n)){return}r=n.val()+i;r=r.replace(/\D/g,"");if(r.length>6){return false}};m=function(e){var n,i,r;n=t(e.currentTarget);i=String.fromCharCode(e.which);if(!/^\d+$/.test(i)){return}r=n.val()+i;return r.length<=4};y=function(e){var n,i,a,o,s;n=t(e.currentTarget);s=n.val();o=t.payment.cardType(s)||"unknown";if(!n.hasClass(o)){i=function(){var e,t,n;n=[];for(e=0,t=r.length;e<t;e++){a=r[e];n.push(a.type)}return n}();n.removeClass("unknown");n.removeClass(i.join(" "));n.addClass(o);n.toggleClass("identified",o!=="unknown");return n.trigger("payment.cardType",o)}};t.payment.fn.formatCardCVC=function(){this.payment("restrictNumeric");this.on("keypress",m);return this};t.payment.fn.formatCardExpiry=function(){this.payment("restrictNumeric");this.on("keypress",g);this.on("keypress",u);this.on("keypress",d);this.on("keypress",c);this.on("keydown",s);return this};t.payment.fn.formatCardNumber=function(){this.payment("restrictNumeric");this.on("keypress",_);this.on("keypress",l);this.on("keydown",o);this.on("keyup",y);this.on("paste",p);return this};t.payment.fn.restrictNumeric=function(){this.on("keypress",v);return this};t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())};t.payment.cardExpiryVal=function(e){var t,n,i,r;e=e.replace(/\s/g,"");r=e.split("/",2),t=r[0],i=r[1];if((i!=null?i.length:void 0)===2&&/^\d+$/.test(i)){n=(new Date).getFullYear();n=n.toString().slice(0,2);i=n+i}t=parseInt(t,10);i=parseInt(i,10);return{month:t,year:i}};t.payment.validateCardNumber=function(e){var t,i;e=(e+"").replace(/\s+|-/g,"");if(!/^\d+$/.test(e)){return false}t=n(e);if(!t){return false}return(i=e.length,b.call(t.length,i)>=0)&&(t.luhn===false||f(e))};t.payment.validateCardExpiry=function(e,n){var i,r,a,o;if(e&&typeof e==="object"&&"month"in e){o=e,e=o.month,n=o.year}if(!(e&&n)){return false}e=t.trim(e);n=t.trim(n);if(!/^\d+$/.test(e)){return false}if(!/^\d+$/.test(n)){return false}if(!(parseInt(e,10)<=12)){return false}if(n.length===2){a=(new Date).getFullYear();a=a.toString().slice(0,2);n=a+n}r=new Date(n,e);i=new Date;r.setMonth(r.getMonth()-1);r.setMonth(r.getMonth()+1,1);return r>i};t.payment.validateCardCVC=function(e,n){var r,a;e=t.trim(e);if(!/^\d+$/.test(e)){return false}if(n){return r=e.length,b.call((a=i(n))!=null?a.cvcLength:void 0,r)>=0}else{return e.length>=3&&e.length<=4}};t.payment.cardType=function(e){var t;if(!e){return null}return((t=n(e))!=null?t.type:void 0)||null};t.payment.formatCardNumber=function(e){var t,i,r,a;t=n(e);if(!t){return e}r=t.length[t.length.length-1];e=e.replace(/\D/g,"");e=e.slice(0,+r+1||9e9);if(t.format.global){return(a=e.match(t.format))!=null?a.join(" "):void 0}else{i=t.format.exec(e);if(i!=null){i.shift()}return i!=null?i.join(" "):void 0}}})(Streak);(function(e){var t=e._;t.mixin({groupByMultiple:function(e,n){var i=t.toArray(arguments).slice(2);t.each(e,function(e){t.wrap(n,function(t){var n=t(e);for(var r=0,a=i.length;r<a;r++){if(!i[r][n[r]])i[r][n[r]]=[];i[r][n[r]].push(e)}})})},isDefined:function(e){return!t.isUndefined(e)},isNotNull:function(e){return!t.isNull(e)},isReal:function(e){return!t.isNotReal(e)},toBoolean:function(e){return!!e},isReachable:function(e,n){var i=n.split(".");var r=i.length;var a={value:null,failedStep:null};var o=e;for(var s=0;s<r;s++){var l=i[s];if(t.isReal(o[l])){a.value=o[l]}else{return{value:null,failedStep:l}}o=o[l]}return a},isNotReal:function(e){return e==null},isNumeric:function(e){return e!==""&&e!==null&&!isNaN(e)},groupByPlus:function(e,n){var i={};t.each(e,function(e,r){var a=n(e,r);if(t.isArray(a)){t.each(a,function(t){(i[t]||(i[t]=[])).push(e)})}else{(i[a]||(i[a]=[])).push(e)}});return i},includePlus:function(e,n,i){if(!i||e==null)return t.include(e,n);var r=false;t.any(e,function(e){if(r=i(e,n))return true});return r},intersectionPlus:function(e,n,i){return t.filter(e,function(e){return t.any(n,function(t){return i(e,t)})})},differencePlus:function(e,n,i){return t.filter(e,function(e){return t.all(n,function(t){return!i(e,t)})})},unionPlus:function(e,t,n){e=e||[];t=t||[];var i=[];for(var r=0;r<e.length;r++){i.push(r)}var a=[];for(var r=0;r<t.length;r++){var o=t[r];for(var s=0;s<i.length;s++){var l=e[i[s]];if(n(o,l)){i.removeVal(s);break}}a.push(o)}for(var r=0;r<i.length;r++){a.push(e[i[r]])}return a},withoutPlus:function(e,n,i){return t.differencePlus(e,[n],i)},indexTheory:function(e,t,n){e.push(t);e.sort(n);var i=e.indexOf(t);e.removeVal(t);return i},pluckPlus:function(e,n){return t.map(e,function(t){return n.call(e,t)})},isArrayDifferent:function(e,t){if(e.length!=t.length){return true}for(var n=0;n<e.length;n++){if(e[n]!=t[n]){return true}}return false},isArrayDifferentSet:function(e,t){if(!e&&t){return true}if(!t&&e){return true}if(e.length!==t.length){return true}for(var n=0;n<e.length;n++){if(t.indexOf(e[n])===-1){return true}}return false},sortedPluck:function(e,n){var i=t(e).chain().filter(function(e){return t.isReal(e)}).pluckPlus(function(e){return n.pluck(e)}).flatten().map(function(e){if(n.map)return n.map(e);else return e}).filter(function(e){if(n.filter)return n.filter(e);else return e}).groupBy(function(e){return e}).value();return t(i).chain().keys().sortBy(function(e){return this[e].length},i).value()},filter:function(e,n){var i=[];t.each(e,function(e){if(n(e))i.push(e)});return i},onceAfter:function(e,n){var i=t.once(n);return t.after(e,i)},chainedApply:function(e,t,n,i,r){var a=function(o){t.apply(null,[o].concat(n).concat([function(){if(e.length>0){a(e.pop())}else{if(i){i()}}}]).concat([function(){if(r){r(e.length)}}]))};a(e.pop())},chainedCallbacks:function(e,t){var n=function(){if(e.length===0){if(t){t()}}else{var i=e.pop();i(n)}};n()},firstIfPresent:function(e){return t.chain(e).map(t.first).compact().value()},restIfPresent:function(e){return t.flatten(t.map(e,t.rest))},firstFromLast:function(e,t){var n=e.length;return e.slice(0,n-t)},repeatEvery:function(e,t,n){var i;var r=true;var a=function(){i=setTimeout(function(){if(r){e();a()}},t)};if(!n){setTimeout(e,1)}a();return{stop:function(){r=false;clearTimeout(i)},start:function(){if(!r){r=true;if(!n){e()}a()}},isActive:function(){return r},destroy:function(){r=false;clearTimeout(i)},func:e}},checkAndThenRun:function(e,n,i,r){var a=t.repeatEvery(function(){if(e()){a.stop();n()}},i);if(r){setTimeout(function(){if(a.isActive()){a.stop();n()}},r)}return a},delayed:function(e,n){var i=null;return function(){clearTimeout(i);var r=t.toArray(arguments);i=setTimeout(t.bind(function(){e.apply(this,r)},this),n)}},uniqMerge:function(e,n,i){var r={};var a=[];if(t.isNotReal(i)){i=function(e,n){return t.extend({},e,n)}}for(var o=0;o<e.length;o++){var s=n(e[o]);if(t.isNotReal(r[s])){a.push(e[o]);r[s]=e[o].length-1}else{a[r[s]]=i(e[o],a[r[s]])}}return a},indexOfPlus:function(e,n){if(t.isNotReal(e)||!t.isArray(e)||e.length===0){return-1}for(var i=0;i<e.length;i++){if(n(e[i])){return i}}return-1},normalizeString:function(e,t){var n=document.createElement("div");n.innerHTML=e;var i=n.textContent;if(t){i=i.replace(/\s/gi,"").replace(/\xAO/gi,"")}i.toLowerCase();return i},mutate:function(e,n){if(!n){return}var i=t.toArray(arguments);var r=t[e].apply(null,i.splice(1));n.length=0;for(var a=0;a<r.length;a++){n.push(r[a])}},appendToArray:function(e,t){t.forEach(function(t){e.push(t)})},sortNumerical:function(e){return e.sort(function(e,t){return t-e})},doArraysIntersect:function(e,t){if(!e||e.length===0||!t||t.length===0){return false}for(var n=0;n<e.length;n++){var i=e[n];if(t.indexOf(i)>-1){return true}}return false},isObjectASuperset:function(e,t){if(!e){return true}for(var n in e){if(e[n]!==t[n]){return false}}return true}})})(Streak);(function(e){"use strict";var t=this;t.URL=t.URL||t.webkitURL;t.requestFileSystem=t.requestFileSystem||t.webkitRequestFileSystem;t.resolveLocalFileSystemURL=t.resolveLocalFileSystemURL||t.webkitResolveLocalFileSystemURL;navigator.temporaryStorage=navigator.temporaryStorage||navigator.webkitTemporaryStorage;navigator.persistentStorage=navigator.persistentStorage||navigator.webkitPersistentStorage;t.BlobBuilder=t.BlobBuilder||t.MozBlobBuilder||t.WebKitBlobBuilder;var n={toArray:function(e){return Array.prototype.slice.call(e||[],0)},strToDataURL:function(e,n,i){var r=i!=undefined?i:true;if(r){return"data:"+n+";base64,"+t.btoa(e)}else{return"data:"+n+","+e}},strToObjectURL:function(e,n){var i=new Uint8Array(e.length);for(var r=0;r<i.length;++r){i[r]=e.charCodeAt(r)}var a=new Blob([i],n?{type:n}:{});return t.URL.createObjectURL(a)},fileToObjectURL:function(e){return t.URL.createObjectURL(e)},fileToArrayBuffer:function(e,t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)};i.onerror=function(e){if(n){n(e)}};i.readAsArrayBuffer(e)},dataURLToBlob:function(e){var t=";base64,";if(e.indexOf(t)==-1){var n=e.split(",");var i=n[0].split(":")[1];var r=n[1];return new Blob([r],{type:i})}var n=e.split(t);var i=n[0].split(":")[1];var r=window.atob(n[1]);var a=r.length;var o=new Uint8Array(a);for(var s=0;s<a;++s){o[s]=r.charCodeAt(s)}return new Blob([o],{type:i})},arrayBufferToBlob:function(e,t){var n=new Uint8Array(e);return new Blob([n],t?{type:t}:{})},arrayBufferToBinaryString:function(e,t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)};i.onerror=function(e){if(n){n(e)}};var r=new Uint8Array(e);i.readAsBinaryString(new Blob([r]))},arrayToBinaryString:function(e){if(typeof e!=typeof[]){return null}var t=e.length;var n=new Array(t);while(t--){n[t]=String.fromCharCode(e[t])}return n.join("")},getFileExtension:function(e){var t=e.lastIndexOf(".");return t!=-1?e.substring(t):""}};var i=function(e){this.prototype=FileError.prototype;this.code=e.code;this.name=e.name};var r=new function(){var e="Filesystem has not been initialized.";var r="Not implemented.";var a="Path was not a directory.";var o="These method arguments are not supported.";var s="filesystem:";var l=1024*1024;var u=null;var c=null;var d=false;var h=function(e){return e.indexOf(s)==0};var f=function(e){if(!h(e)){if(e[0]=="/"){e=u.root.toURL()+e.substring(1)}else if(e.indexOf("./")==0||e.indexOf("../")==0){if(e=="../"&&c!=u.root){e=c.toURL()+"/"+e}else{e=c.toURL()+e}}else{e=c.toURL()+"/"+e}}return e};var p=function(e,n){var i=arguments[1];var r=arguments[2];var a=function(e){if(e.code==FileError.NOT_FOUND_ERR){if(r){throw new Error('"'+i+'" or "'+r+'" does not exist.')}else{throw new Error('"'+i+'" does not exist.')}}else{throw new Error("Problem getting Entry for one or more paths.")}};var o=f(i);if(arguments.length==3){var s=f(r);t.resolveLocalFileSystemURL(o,function(n){t.resolveLocalFileSystemURL(s,function(t){e(n,t)},a)},a)}else{t.resolveLocalFileSystemURL(o,e,a)}};var m=function(t,n,i,r,a,s){var l=this;if(!u){throw new Error(e)}if(typeof t!=typeof n){throw new Error(o)}var c=i||null;var d=s!=undefined?s:false;if((t.isFile||n.isDirectory)&&n.isDirectory){if(d){t.moveTo(n,c,r,a)}else{t.copyTo(n,c,r,a)}}else{p(function(e,t){if(!t.isDirectory){var n=new Error('Oops! "'+t.name+" is not a directory!");if(a){a(n)}else{throw n}return}if(d){e.moveTo(t,c,r,a)}else{e.copyTo(t,c,r,a)}},t,n)}};function _(e){u=e||null;if(u){c=u.root;d=true}}_.DEFAULT_FS_SIZE=l;_.version="0.4.3";_.prototype={get fs(){return u},get isOpen(){return d},get cwd(){return c}};_.prototype.pathToFilesystemURL=function(e){return f(e)};_.prototype.init=function(e,n,r){if(!t.requestFileSystem){throw new i({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"})}var a=e?e:{};var o=a.size||l;this.type=t.TEMPORARY;if("persistent"in a&&a.persistent){this.type=t.PERSISTENT}var s=function(e){this.size=o;u=e;c=u.root;d=true;n&&n(e)};if(this.type==t.PERSISTENT&&!!navigator.persistentStorage){navigator.persistentStorage.requestQuota(o,function(e){t.requestFileSystem(this.type,e,s.bind(this),r)}.bind(this),r)}else{t.requestFileSystem(this.type,o,s.bind(this),r)}};_.prototype.ls=function(t,i,r){if(!u){throw new Error(e)}var a=function(e){c=e;var t=[];var a=c.createReader();var o=function(){a.readEntries(function(e){if(!e.length){t.sort(function(e,t){return e.name<t.name?-1:t.name<e.name?1:0});i(t)}else{t=t.concat(n.toArray(e));o()}},r)};o()};if(t.isDirectory){a(t)}else if(h(t)){p(a,t)}else{c.getDirectory(t,{},a,r)}};_.prototype.mkdir=function(t,n,i,r){if(!u){throw new Error(e)}var a=n!=null?n:false;var o=t.split("/");var s=function(e,n){if(n[0]=="."||n[0]==""){n=n.slice(1)}e.getDirectory(n[0],{create:true,exclusive:a},function(e){if(e.isDirectory){if(n.length&&o.length!=1){s(e,n.slice(1))
}else{if(i)i(e)}}else{var a=new Error(t+" is not a directory");if(r){r(a)}else{throw a}}},function(e){if(e.code==FileError.INVALID_MODIFICATION_ERR){e.message="'"+t+"' already exists";if(r){r(e)}else{throw e}}})};s(c,o)};_.prototype.open=function(t,n,i){if(!u){throw new Error(e)}if(t.isFile){t.file(n,i)}else{p(function(e){e.file(n,i)},f(t))}};_.prototype.create=function(t,n,i,r){if(!u){throw new Error(e)}var a=n!=null?n:true;c.getFile(t,{create:true,exclusive:a},i,function(e){if(e.code==FileError.INVALID_MODIFICATION_ERR){e.message="'"+t+"' already exists"}if(r){r(e)}else{throw e}})};_.prototype.mv=function(e,t,n,i,r){m.bind(this,e,t,n,i,r,true)()};_.prototype.rm=function(t,n,i){if(!u){throw new Error(e)}var r=function(e){if(e.isFile){e.remove(n,i)}else if(e.isDirectory){e.removeRecursively(n,i)}};if(t.isFile||t.isDirectory){r(t)}else{p(r,t)}};_.prototype.cd=function(t,n,i){if(!u){throw new Error(e)}if(t.isDirectory){c=t;n&&n(c)}else{var t=f(t);p(function(e){if(e.isDirectory){c=e;n&&n(c)}else{var t=new Error(a);if(i){i(t)}else{throw t}}},t)}};_.prototype.cp=function(e,t,n,i,r){m.bind(this,e,t,n,i,r)()};_.prototype.write=function(t,n,i,r){if(!u){throw new Error(e)}var a=function(e){e.createWriter(function(t){t.onerror=r;if(n.append){t.onwriteend=function(t){if(i)i(e,this)};t.seek(t.length)}else{var a=false;t.onwriteend=function(t){if(!a){a=true;this.truncate(this.position);return}if(i)i(e,this)}}if(n.data.__proto__==ArrayBuffer.prototype){n.data=new Uint8Array(n.data)}var o=new Blob([n.data],n.type?{type:n.type}:{});t.write(o)},r)};if(t.isFile){a(t)}else if(h(t)){p(a,t)}else{c.getFile(t,{create:true,exclusive:false},a,r)}};_.prototype.df=function(e,n){var i=function(t,n){e(t,n-t,n)};if(!(navigator.temporaryStorage.queryUsageAndQuota&&navigator.persistentStorage.queryUsageAndQuota)){throw new Error(r)}if(t.TEMPORARY==this.type){navigator.temporaryStorage.queryUsageAndQuota(i,n)}else if(t.PERSISTENT==this.type){navigator.persistentStorage.queryUsageAndQuota(i,n)}};return _};e.Filer=r}).call(this,Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.APIRequester;e.Locale={supported:["en"],initial:"en",map:null,init:function(){var t=this;i.prototype.setFormatLocale(this.getGmail()==="en"?"en":"other");return r.get("resources/locales/"+this.getCurrent(),null,{serverOverride:e.combinedServer||e.server,isAnonymous:true}).getPromise().then(function(e){t.map=e},function(){e.BentoBox.logError("language file wasn't loaded")})},getGmail:function(){return GLOBALS[4].split(".")[1]},getCurrent:function(){if(localStorage["bb_locale"]){return localStorage["bb_locale"]}return this.getGmail()},getClone:function(){return e.$.extend(true,{},this)},override:function(t,i){var r=this;new e.Request("GET",e.server,t,{isAnonymous:true}).getPromise().then(function(e){n.extend(r.map,e);if(i){i()}},i)},setMode:function(t){var n=this;t="__"+t;var i=[];e._.each(n.map,function(e,r){var a=r.indexOf(t);if(a>0){var o=r.substring(0,a);i.push({baseKey:o,value:n.map[r]})}});var r=i.length;for(var a=0;a<r;a++){var o=i[a];n.map[o.baseKey]=o.value}},setCurrent:function(e){if(e===this.getGmail()){localStorage.removeItem("bb_locale")}else{localStorage["bb_locale"]=e}},getStrings:function(e,t){self=this;return n.map(e,function(e){return self.getString(e,t)})},getString:function(t,i,r){if(!this.map){return t}var a=this.map[t]||t;if(i){var o=a.split(/<[^>]+>/);var s=a.match(/<[^>]+>/g);var l=null;if(s&&s.length>0){s=s.map(function(e){return e.substring(1,e.length-1)});var u=[];for(var c=0;c<s.length;c++){u.push(o[c]);u.push(n.isReal(i[s[c]])?i[s[c]]:"<"+s[c]+">")}u.push(o[o.length-1]);l=u.join("")}else{l=a}if(!i.pluralize&&r){i.pluralize=r}if(!n.isArray(i.pluralize)){i.pluralize=[i.pluralize]}var d=0;l=l.replace(/\[(?:(\w+)@)?(.*?)\]/g,function(n,r,o,s,l){var u=o.split("|");var c;if(r)c=i[r];else c=i.pluralize[d++];if(c===undefined)return n;var h="";for(var f=0;f<u.length;f++){var p=u[f];var m=p.split(":");if(m.length==1){h=m[0]}else if(m.length==2){var _=m[0];if(_.match(/^\d+$/)){if(parseInt(_)==c){h=m[1];break}}else{e.BentoBox.logError("Locale entry: Expected number",null,{key:t,value:a,locale:e.Locale.getCurrent()})}}else{e.BentoBox.logError("Locale entry: Too many colons",null,{key:t,value:a,locale:e.Locale.getCurrent()})}}return h});return l}else{return a}},localize:function(e){var t=this;e=e.replace(/<%%\s*(.+?)\s*%>/g,function(e,n){return t.getString(n)});e=e.replace(/<%html\s*(.+?)\s*\(\s*\{\s*\n?\s*((?:[^\s'.{}:]+\s*:\s*'''.+?''',?\s*\n?\s*)+)\}\s*\)\s*%>/gm,function(e,n,i){var r={};i.replace(/([^\s'.{}:]+)\s*:\s*'''(.+?)''',?/gm,function(e,t,n){r[t]=n;return e});return t.getString(n,r)});return e},convertLocaleCodeToName:function(e){return this.map["supportedLocales"][e]}};e.DependencyManager.addFunction({functionKey:"localeLoaded",functionReference:e.Locale.init,functionContext:e.Locale,dependentFunctionKeys:["bentoBoxServerSet"]})})(Streak);Streak.Resources={};Streak.Resources["streakInjected.js"]='(function e(t,n,r){function i(u,a){if(!n[u]){if(!t[u]){var s=typeof require=="function"&&require;if(!a&&s)return s(u,!0);if(o)return o(u,!0);var f=new Error("Cannot find module \'"+u+"\'");throw f.code="MODULE_NOT_FOUND",f}var l=n[u]={exports:{}};t[u][0].call(l.exports,function(e){var n=t[u][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[u].exports}var o=typeof require=="function"&&require;for(var u=0;u<r.length;u++)i(r[u]);return i})({1:[function(e,t,n){function r(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent(e,true,false,t);document.dispatchEvent(n)}var i=function(){var e=0;return function(){if(e>=Number.MAX_SAFE_INTEGER){e=0}return e++}}();function o(){var t=e("./xhr-proxy-factory");var n=e("rsvp");var o=top.document.getElementById("js_frame").contentDocument.defaultView;var u=o.XMLHttpRequest;var a=[];var s=t(u,a);o.XMLHttpRequest=s;a.push({isRelevantTo:function(e){return e.params.search&&e.params.view=="tl"},originalSendBodyLogger:function(e){r("streakAjaxSearchStart",e.params.q)},afterListeners:function(e){if(e.status==200){r("streakAjaxSearchComplete",{search:e.params.search,responseText:e.originalResponseText})}}});a.push({isRelevantTo:function(e){return e.params.act=="sd"},afterListeners:function(e){if(e.status==200){var t=decodeURIComponent(e.originalSendBody).split("&");var n;for(var i=0;i<t.length;i++){var o=t[i].split("=");if(o[0]==="composeid"){n=o[1];break}}r("streakAjaxSaveDraft",{responseText:e.originalResponseText,composeid:n})}}});a.push({isRelevantTo:function(e){return e.params.act=="sm"},originalSendBodyLogger:function(e,t){r("streakAjaxSendMailStart",t)},afterListeners:function(e){if(e.status===200){r("streakAjaxSendMailComplete",{responseText:e.originalResponseText,originalSendBody:e.originalSendBody})}}});a.push({isRelevantTo:function(e){return e.params.act=="dr"},originalSendBodyLogger:function(e,t){r("streakAjaxEmailDiscarded",t)}});a.push({isRelevantTo:function(e){e._id=i();document.head.removeAttribute("data-streak-gmail-com");r("streakAjaxInterceptorRelevanceCheck",{id:e._id,params:e.params});var t=document.head.hasAttribute("data-streak-gmail-com");document.head.removeAttribute("data-streak-gmail-com");return t},responseTextChanger:function(e,t){return new n.Promise(function(n,i){function o(t){if(t.detail.id===e._id){document.removeEventListener("streakAjaxInterceptorApplyResponse",o);n(t.detail.newResponseText)}}document.addEventListener("streakAjaxInterceptorApplyResponse",o);r("streakAjaxInterceptorApply",{id:e._id,params:e.params,responseText:t,connection:e})})}})}function u(){var t=e("lodash");document.addEventListener("streakRelayStart",function(e){var n=e.detail;if(!n.method||!n.url||!n.id){throw new Error("streakRelayStart: Missing option(s)")}var i=new XMLHttpRequest;i.onloadend=function(){r("streakRelayResponse",{id:n.id,responseText:i.responseText,status:i.status})};t.extend(i,n.xhrFields);i.open(n.method,n.url,true);t.each(n.headers,function(e,t){i.setRequestHeader(t,e)});i.send(n.body)})}if(!window._streakInjectedPlaced){window._streakInjectedPlaced=true;o();u()}},{"./xhr-proxy-factory":2,lodash:12,rsvp:13}],2:[function(e,t,n){"use strict";var r=e("lodash");var i=e("assert");var o=e("rsvp");var u=e("events").EventEmitter;var a=e("querystring").parse;t.exports=function(e,t,n){var s=n&&n.logError||function(e,t){setTimeout(function(){throw e},1)};function f(e,t,n){var i={};r.each(n,function(n,r){i[r]=n===e?t:n});return i}function l(e,t,n){return function(r){return n.call(t,f(e,t,r))}}function c(e,t){return r.filter(e,function(e){try{return e.isRelevantTo(t)}catch(n){s(n)}})}function p(){this._wrappers=t;this._listeners={};this._boundListeners={};this._events=new u;this.responseText="";var n=r.rest(arguments,2);if(e.bind&&e.bind.apply){this._realxhr=new(e.bind.apply(e,[null].concat(n)))}else{this._realxhr=new e}var i=this;function a(e,t){if(i["on"+e]){try{l(i._realxhr,i,i["on"+e]).call(i,t)}catch(n){s(n,"XMLHttpRequest event listener error")}}r.each(i._boundListeners[e],function(e){try{e(t)}catch(n){s(n,"XMLHttpRequest event listener error")}})}function f(e){a("readystatechange",e)}this._fakeRscEvent=function(){f(Object.freeze({bubbles:false,cancelBubble:false,cancelable:false,defaultPrevented:false,preventDefault:r.noop,stopPropagation:r.noop,stopImmediatePropagation:r.noop,type:"readystatechange",currentTarget:this,target:this,srcElement:this,NONE:0,CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,eventPhase:0}))};function c(e){i.readyState=4;var t=i.status==200;var n=r.extend({},e,{lengthComputable:false,loaded:0,total:0});var o=!i._realxhr.responseType||i._realxhr.responseType=="text";if(o){r.each(i._activeWrappers,function(e){if(e.finalResponseTextLogger){try{e.finalResponseTextLogger(i._connection,i.responseText)}catch(t){s(t)}}})}f(e);if(t){a("load",n)}else{a("error",n)}a("loadend",n);r.each(i._activeWrappers,function(e){if(e.afterListeners){try{e.afterListeners(i._connection)}catch(t){s(t)}}})}this._realxhr.addEventListener("readystatechange",function(e){if(!i._connection){return}if(i._realxhr.readyState>=2){i._connection.status=i._realxhr.status}var t=!i._realxhr.responseType||i._realxhr.responseType=="text";if(i._realxhr.readyState==4){if(t){Object.defineProperty(i._connection,"originalResponseText",{enumerable:true,writable:false,configurable:false,value:i._realxhr.responseText});r.each(i._activeWrappers,function(e){if(e.originalResponseTextLogger){try{e.originalResponseTextLogger(i._connection,i._connection.originalResponseText)}catch(t){s(t)}}});var n=r.once(c.bind(null,e));if(i._connection.async){var u=i._connection;i._responseTextChangers.reduce(function(e,t){return e.then(function(e){if(u===i._connection){i._connection.modifiedResponseText=e;return t(i._connection,e)}}).then(function(e){if(typeof e!="string"){throw new Error("responseTextChanger returned non-string value "+e)}else{return e}})},o.resolve(i._connection.originalResponseText)).then(function(e){if(u===i._connection){i.responseText=i._connection.modifiedResponseText=e;n()}},function(e){s(e);if(u===i._connection){i.responseText=i._realxhr.responseText;n()}}).catch(s);return}else{i.responseText=i._realxhr.responseText}}else{i.responseText=""}c(e)}else{if(i._realxhr.readyState==1&&i.readyState==1){return}else if(i._realxhr.readyState>=3&&t){if(i._responseTextChangers.length){i.responseText=""}else{i.responseText=i._realxhr.responseText}}else{i.responseText=""}i.readyState=i._realxhr.readyState;f(e)}},false);["dispatchEvent","getAllResponseHeaders","getResponseHeader","overrideMimeType","responseType","responseXML","responseURL","status","statusText","timeout","ontimeout","onloadstart","onprogress","onabort","upload","withCredentials"].forEach(function(e){Object.defineProperty(i,e,{enumerable:true,configurable:false,get:function(){if(typeof i._realxhr[e]=="function"){return i._realxhr[e].bind(i._realxhr)}return i._realxhr[e]},set:function(t){if(typeof t=="function"){t=l(this._realxhr,this,t)}i._realxhr[e]=t}})});Object.defineProperty(i,"response",{enumerable:true,configurable:false,get:function(){if(!this._realxhr.responseType||this._realxhr.responseType=="text"){return this.responseText}else{return this._realxhr.response}}});i.readyState=i._realxhr.readyState}p.prototype.abort=function(){if(this._clientStartedSend&&!this._realStartedSend){if(this.readyState!=0&&this._realxhr.readyState==0){this._realxhr.open(this._connection.method,this._connection.url)}this._realStartedSend=true;this._realxhr.send()}this._realxhr.abort()};p.prototype.setRequestHeader=function(e,t){var n=this;if(this.readyState!=1){throw new Error("Can\'t set headers now at readyState "+this.readyState)}if(this._connection.async&&this._requestChangers.length){this._events.once("realOpen",function(){n._realxhr.setRequestHeader(e,t)})}else{this._realxhr.setRequestHeader(e,t)}};p.prototype.addEventListener=function(e,t){if(!this._listeners[e]){this._listeners[e]=[];this._boundListeners[e]=[]}if(!r.contains(this._listeners[e],t)){var n=l(this._realxhr,this,t);this._listeners[e].push(t);this._boundListeners[e].push(n);if(!r.contains(["readystatechange","load","error","loadend"],e)){this._realxhr.addEventListener(e,n,false)}}};p.prototype.removeEventListener=function(e,t){if(!this._listeners[e]){return}var n=this._listeners[e].indexOf(t);if(n==-1){return}this._listeners[e].splice(n,1);var r=this._boundListeners[e].splice(n,1)[0];if(e!="readystatechange"){this._realxhr.removeEventListener(e,r,false)}};p.prototype.open=function(e,t,n){var r=this;this._connection={method:e,url:t,params:a(t.split("?")[1]||""),async:arguments.length<3||!!n};this._clientStartedSend=false;this._realStartedSend=false;this._activeWrappers=c(this._wrappers,this._connection);this._responseTextChangers=this._activeWrappers.map(function(e){return e.responseTextChanger&&e.responseTextChanger.bind(e)}).filter(Boolean);this.responseText="";function i(e,t){return r._realxhr.open(e,t,r._connection.async)}if(this._connection.async){this._requestChangers=this._activeWrappers.map(function(e){return e.requestChanger&&e.requestChanger.bind(e)}).filter(Boolean);if(this._requestChangers.length){if(this.readyState!=1){this.readyState=1;this._fakeRscEvent()}}else{i(e,t)}}else{i(e,t)}};p.prototype.send=function(e){var t=this;this._clientStartedSend=true;Object.defineProperty(this._connection,"originalSendBody",{enumerable:true,writable:false,configurable:false,value:e});this._connection.responseType=this._realxhr.responseType||"text";r.each(t._activeWrappers,function(n){if(n.originalSendBodyLogger){try{n.originalSendBodyLogger(t._connection,e)}catch(r){s(r)}}});function n(e){t._realStartedSend=true;t._realxhr.send(e)}if(this._connection.async&&this._requestChangers.length){var u=this._connection;var a={method:this._connection.method,url:this._connection.url,body:e};this._requestChangers.reduce(function(e,n){return e.then(function(e){if(u===t._connection&&!t._realStartedSend){i(r.has(e,"method"),"modifiedRequest has method");i(r.has(e,"url"),"modifiedRequest has url");i(r.has(e,"body"),"modifiedRequest has body");return n(t._connection,Object.freeze(e))}})},o.Promise.resolve(a)).then(function(e){if(u===t._connection&&!t._realStartedSend){i(r.has(e,"method"),"modifiedRequest has method");i(r.has(e,"url"),"modifiedRequest has url");i(r.has(e,"body"),"modifiedRequest has body");return e}}).catch(function(e){s(e);return a}).then(function(e){if(u===t._connection&&!t._realStartedSend){t._realxhr.open(e.method,e.url);t._events.emit("realOpen");n(e.body)}})}else{n(e)}};[p,p.prototype].forEach(function(e){r.extend(e,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4})});return p}},{assert:3,events:4,lodash:12,querystring:9,rsvp:13}],3:[function(e,t,n){var r=e("util/");var i=Array.prototype.slice;var o=Object.prototype.hasOwnProperty;var u=t.exports=c;u.AssertionError=function _(e){this.name="AssertionError";this.actual=e.actual;this.expected=e.expected;this.operator=e.operator;if(e.message){this.message=e.message;this.generatedMessage=false}else{this.message=f(this);this.generatedMessage=true}var t=e.stackStartFunction||l;if(Error.captureStackTrace){Error.captureStackTrace(this,t)}else{var n=new Error;if(n.stack){var r=n.stack;var i=t.name;var o=r.indexOf("\\n"+i);if(o>=0){var u=r.indexOf("\\n",o+1);r=r.substring(u+1)}this.stack=r}}};r.inherits(u.AssertionError,Error);function a(e,t){if(r.isUndefined(t)){return""+t}if(r.isNumber(t)&&(isNaN(t)||!isFinite(t))){return t.toString()}if(r.isFunction(t)||r.isRegExp(t)){return t.toString()}return t}function s(e,t){if(r.isString(e)){return e.length<t?e:e.slice(0,t)}else{return e}}function f(e){return s(JSON.stringify(e.actual,a),128)+" "+e.operator+" "+s(JSON.stringify(e.expected,a),128)}function l(e,t,n,r,i){throw new u.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}u.fail=l;function c(e,t){if(!e)l(e,true,t,"==",u.ok)}u.ok=c;u.equal=function m(e,t,n){if(e!=t)l(e,t,n,"==",u.equal)};u.notEqual=function b(e,t,n){if(e==t){l(e,t,n,"!=",u.notEqual)}};u.deepEqual=function w(e,t,n){if(!p(e,t)){l(e,t,n,"deepEqual",u.deepEqual)}};function p(e,t){if(e===t){return true}else if(r.isBuffer(e)&&r.isBuffer(t)){if(e.length!=t.length)return false;for(var n=0;n<e.length;n++){if(e[n]!==t[n])return false}return true}else if(r.isDate(e)&&r.isDate(t)){return e.getTime()===t.getTime()}else if(r.isRegExp(e)&&r.isRegExp(t)){return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase}else if(!r.isObject(e)&&!r.isObject(t)){return e==t}else{return v(e,t)}}function h(e){return Object.prototype.toString.call(e)=="[object Arguments]"}function v(e,t){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(t))return false;if(e.prototype!==t.prototype)return false;if(h(e)){if(!h(t)){return false}e=i.call(e);t=i.call(t);return p(e,t)}try{var n=y(e),o=y(t),u,a}catch(s){return false}if(n.length!=o.length)return false;n.sort();o.sort();for(a=n.length-1;a>=0;a--){if(n[a]!=o[a])return false}for(a=n.length-1;a>=0;a--){u=n[a];if(!p(e[u],t[u]))return false}return true}u.notDeepEqual=function x(e,t,n){if(p(e,t)){l(e,t,n,"notDeepEqual",u.notDeepEqual)}};u.strictEqual=function E(e,t,n){if(e!==t){l(e,t,n,"===",u.strictEqual)}};u.notStrictEqual=function j(e,t,n){if(e===t){l(e,t,n,"!==",u.notStrictEqual)}};function d(e,t){if(!e||!t){return false}if(Object.prototype.toString.call(t)=="[object RegExp]"){return t.test(e)}else if(e instanceof t){return true}else if(t.call({},e)===true){return true}return false}function g(e,t,n,i){var o;if(r.isString(n)){i=n;n=null}try{t()}catch(u){o=u}i=(n&&n.name?" ("+n.name+").":".")+(i?" "+i:".");if(e&&!o){l(o,n,"Missing expected exception"+i)}if(!e&&d(o,n)){l(o,n,"Got unwanted exception"+i)}if(e&&o&&n&&!d(o,n)||!e&&o){throw o}}u.throws=function(e,t,n){g.apply(this,[true].concat(i.call(arguments)))};u.doesNotThrow=function(e,t){g.apply(this,[false].concat(i.call(arguments)))};u.ifError=function(e){if(e){throw e}};var y=Object.keys||function(e){var t=[];for(var n in e){if(o.call(e,n))t.push(n)}return t}},{"util/":11}],4:[function(e,t,n){function r(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=r;r.EventEmitter=r;r.prototype._events=undefined;r.prototype._maxListeners=undefined;r.defaultMaxListeners=10;r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};r.prototype.emit=function(e){var t,n,r,o,s,f;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||u(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}throw TypeError(\'Uncaught, unspecified "error" event.\')}}n=this._events[e];if(a(n))return false;if(i(n)){switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=arguments.length;o=new Array(r-1);for(s=1;s<r;s++)o[s-1]=arguments[s];n.apply(this,o)}}else if(u(n)){r=arguments.length;o=new Array(r-1);for(s=1;s<r;s++)o[s-1]=arguments[s];f=n.slice();r=f.length;for(s=0;s<r;s++)f[s].apply(this,o)}return true};r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,i(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(u(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(u(this._events[e])&&!this._events[e].warned){var n;if(!a(this._maxListeners)){n=this._maxListeners}else{n=r.defaultMaxListeners}if(n&&n>0&&this._events[e].length>n){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};r.prototype.on=r.prototype.addListener;r.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=false;function r(){this.removeListener(e,r);if(!n){n=true;t.apply(this,arguments)}}r.listener=t;this.on(e,r);return this};r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;n=this._events[e];o=n.length;r=-1;if(n===t||i(n.listener)&&n.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(u(n)){for(a=o;a-->0;){if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}}if(r<0)return this;if(n.length===1){n.length=0;delete this._events[e]}else{n.splice(r,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}n=this._events[e];if(i(n)){this.removeListener(e,n)}else{while(n.length)this.removeListener(e,n[n.length-1])}delete this._events[e];return this};r.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(i(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};r.listenerCount=function(e,t){var n;if(!e._events||!e._events[t])n=0;else if(i(e._events[t]))n=1;else n=e._events[t].length;return n};function i(e){return typeof e==="function"}function o(e){return typeof e==="number"}function u(e){return typeof e==="object"&&e!==null}function a(e){return e===void 0}},{}],5:[function(e,t,n){if(typeof Object.create==="function"){t.exports=function r(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function i(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e}}},{}],6:[function(e,t,n){var r=t.exports={};r.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.MutationObserver;var n=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}var r=[];if(t){var i=document.createElement("div");var o=new MutationObserver(function(){var e=r.slice();r.length=0;e.forEach(function(e){e()})});o.observe(i,{attributes:true});return function u(e){if(!r.length){i.setAttribute("yes","no")}r.push(e)}}if(n){window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(r.length>0){var n=r.shift();n()}}},true);return function a(e){r.push(e);window.postMessage("process-tick","*")}}return function s(e){setTimeout(e,0)}}();r.title="browser";r.browser=true;r.env={};r.argv=[];function i(){}r.on=i;r.addListener=i;r.once=i;r.off=i;r.removeListener=i;r.removeAllListeners=i;r.emit=i;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],7:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&";n=n||"=";var u={};if(typeof e!=="string"||e.length===0){return u}var a=/\\+/g;e=e.split(t);var s=1e3;if(o&&typeof o.maxKeys==="number"){s=o.maxKeys}var f=e.length;if(s>0&&f>s){f=s}for(var l=0;l<f;++l){var c=e[l].replace(a,"%20"),p=c.indexOf(n),h,v,d,g;if(p>=0){h=c.substr(0,p);v=c.substr(p+1)}else{h=c;v=""}d=decodeURIComponent(h);g=decodeURIComponent(v);if(!r(u,d)){u[d]=g}else if(i(u[d])){u[d].push(g)}else{u[d]=[u[d],g]}}return u};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},{}],8:[function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){t=t||"&";n=n||"=";if(e===null){e=undefined}if(typeof e==="object"){return o(u(e),function(u){var a=encodeURIComponent(r(u))+n;if(i(e[u])){return o(e[u],function(e){return a+encodeURIComponent(r(e))}).join(t)}else{return a+encodeURIComponent(r(e[u]))}}).join(t)}if(!a)return"";return encodeURIComponent(r(a))+n+encodeURIComponent(r(e))};var i=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function o(e,t){if(e.map)return e.map(t);var n=[];for(var r=0;r<e.length;r++){n.push(t(e[r],r))}return n}var u=Object.keys||function(e){var t=[];for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t.push(n)}return t}},{}],9:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode");n.encode=n.stringify=e("./encode")},{"./decode":7,"./encode":8}],10:[function(e,t,n){t.exports=function r(e){return e&&typeof e==="object"&&typeof e.copy==="function"&&typeof e.fill==="function"&&typeof e.readUInt8==="function"}},{}],11:[function(e,t,n){(function(t,r){var i=/%[sdj%]/g;n.format=function(e){if(!x(e)){var t=[];for(var n=0;n<arguments.length;n++){t.push(a(arguments[n]))}return t.join(" ")}var n=1;var r=arguments;var o=r.length;var u=String(e).replace(i,function(e){if(e==="%%")return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}});for(var s=r[n];n<o;s=r[++n]){if(m(s)||!T(s)){u+=" "+s}else{u+=" "+a(s)}}return u};n.deprecate=function(e,i){if(j(r.process)){return function(){return n.deprecate(e,i).apply(this,arguments)}}if(t.noDeprecation===true){return e}var o=false;function u(){if(!o){if(t.throwDeprecation){throw new Error(i)}else if(t.traceDeprecation){console.trace(i)}else{console.error(i)}o=true}return e.apply(this,arguments)}return u};var o={};var u;n.debuglog=function(e){if(j(u))u=t.env.NODE_DEBUG||"";e=e.toUpperCase();if(!o[e]){if(new RegExp("\\\\b"+e+"\\\\b","i").test(u)){var r=t.pid;o[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else{o[e]=function(){}}}return o[e]};function a(e,t){var r={seen:[],stylize:f};if(arguments.length>=3)r.depth=arguments[2];if(arguments.length>=4)r.colors=arguments[3];if(_(t)){r.showHidden=t}else if(t){n._extend(r,t)}if(j(r.showHidden))r.showHidden=false;if(j(r.depth))r.depth=2;if(j(r.colors))r.colors=false;if(j(r.customInspect))r.customInspect=true;if(r.colors)r.stylize=s;return c(r,e,r.depth)}n.inspect=a;a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function s(e,t){var n=a.styles[t];if(n){return"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m"}else{return e}}function f(e,t){return e}function l(e){var t={};e.forEach(function(e,n){t[e]=true});return t}function c(e,t,r){if(e.customInspect&&t&&R(t.inspect)&&t.inspect!==n.inspect&&!(t.constructor&&t.constructor.prototype===t)){var i=t.inspect(r,e);if(!x(i)){i=c(e,i,r)}return i}var o=p(e,t);if(o){return o}var u=Object.keys(t);var a=l(u);if(e.showHidden){u=Object.getOwnPropertyNames(t)}if(O(t)&&(u.indexOf("message")>=0||u.indexOf("description")>=0)){return h(t)}if(u.length===0){if(R(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(S(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}if(k(t)){return e.stylize(Date.prototype.toString.call(t),"date")}if(O(t)){return h(t)}}var f="",_=false,m=["{","}"];if(y(t)){_=true;m=["[","]"]}if(R(t)){var b=t.name?": "+t.name:"";f=" [Function"+b+"]"}if(S(t)){f=" "+RegExp.prototype.toString.call(t)}if(k(t)){f=" "+Date.prototype.toUTCString.call(t)}if(O(t)){f=" "+h(t)}if(u.length===0&&(!_||t.length==0)){return m[0]+f+m[1]}if(r<0){if(S(t)){return e.stylize(RegExp.prototype.toString.call(t),"regexp")}else{return e.stylize("[Object]","special")}}e.seen.push(t);var w;if(_){w=v(e,t,r,a,u)}else{w=u.map(function(n){return d(e,t,r,a,n,_)})}e.seen.pop();return g(w,f,m)}function p(e,t){if(j(t))return e.stylize("undefined","undefined");if(x(t)){var n="\'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\')+"\'";return e.stylize(n,"string")}if(w(t))return e.stylize(""+t,"number");if(_(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function v(e,t,n,r,i){var o=[];for(var u=0,a=t.length;u<a;++u){if(q(t,String(u))){o.push(d(e,t,n,r,String(u),true))}else{o.push("")}}i.forEach(function(i){if(!i.match(/^\\d+$/)){o.push(d(e,t,n,r,i,true))}});return o}function d(e,t,n,r,i,o){var u,a,s;s=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]};if(s.get){if(s.set){a=e.stylize("[Getter/Setter]","special")}else{a=e.stylize("[Getter]","special")}}else{if(s.set){a=e.stylize("[Setter]","special")}}if(!q(r,i)){u="["+i+"]"}if(!a){if(e.seen.indexOf(s.value)<0){if(m(n)){a=c(e,s.value,null)}else{a=c(e,s.value,n-1)}if(a.indexOf("\\n")>-1){if(o){a=a.split("\\n").map(function(e){return"  "+e}).join("\\n").substr(2)}else{a="\\n"+a.split("\\n").map(function(e){return"   "+e}).join("\\n")}}}else{a=e.stylize("[Circular]","special")}}if(j(u)){if(o&&i.match(/^\\d+$/)){return a}u=JSON.stringify(""+i);if(u.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){u=u.substr(1,u.length-2);u=e.stylize(u,"name")}else{u=u.replace(/\'/g,"\\\\\'").replace(/\\\\"/g,\'"\').replace(/(^"|"$)/g,"\'");u=e.stylize(u,"string")}}return u+": "+a}function g(e,t,n){var r=0;var i=e.reduce(function(e,t){r++;if(t.indexOf("\\n")>=0)r++;return e+t.replace(/\\u001b\\[\\d\\d?m/g,"").length+1},0);if(i>60){return n[0]+(t===""?"":t+"\\n ")+" "+e.join(",\\n  ")+" "+n[1]}return n[0]+t+" "+e.join(", ")+" "+n[1]}function y(e){return Array.isArray(e)}n.isArray=y;function _(e){return typeof e==="boolean"}n.isBoolean=_;function m(e){return e===null}n.isNull=m;function b(e){return e==null}n.isNullOrUndefined=b;function w(e){return typeof e==="number"}n.isNumber=w;function x(e){return typeof e==="string"}n.isString=x;function E(e){return typeof e==="symbol"}n.isSymbol=E;function j(e){return e===void 0}n.isUndefined=j;function S(e){return T(e)&&C(e)==="[object RegExp]"}n.isRegExp=S;function T(e){return typeof e==="object"&&e!==null}n.isObject=T;function k(e){return T(e)&&C(e)==="[object Date]"}n.isDate=k;function O(e){return T(e)&&(C(e)==="[object Error]"||e instanceof Error)}n.isError=O;function R(e){return typeof e==="function"}n.isFunction=R;function A(e){return e===null||typeof e==="boolean"||typeof e==="number"||typeof e==="string"||typeof e==="symbol"||typeof e==="undefined"}n.isPrimitive=A;n.isBuffer=e("./support/isBuffer");function C(e){return Object.prototype.toString.call(e)}function L(e){return e<10?"0"+e.toString(10):e.toString(10)}var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date;var t=[L(e.getHours()),L(e.getMinutes()),L(e.getSeconds())].join(":");return[e.getDate(),N[e.getMonth()],t].join(" ")}n.log=function(){console.log("%s - %s",I(),n.format.apply(n,arguments))};n.inherits=e("inherits");n._extend=function(e,t){if(!t||!T(t))return e;var n=Object.keys(t);var r=n.length;while(r--){e[n[r]]=t[n[r]]}return e};function q(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}).call(this,e("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":10,_process:6,inherits:5}],12:[function(e,t,n){(function(e){(function(){function r(e,t,n){n=(n||0)-1;for(var r=e?e.length:0;++n<r;)if(e[n]===t)return n;return-1}function i(e,t){var n=typeof t;if(e=e.l,"boolean"==n||null==t)return e[t]?0:-1;"number"!=n&&"string"!=n&&(n="object");var i="number"==n?t:b+t;return e=(e=e[n])&&e[i],"object"==n?e&&-1<r(e,t)?0:-1:e?0:-1}function o(e){var t=this.l,n=typeof e;if("boolean"==n||null==e)t[e]=true;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:b+e,t=t[n]||(t[n]={});"object"==n?(t[r]||(t[r]=[])).push(e):t[r]=true}}function u(e){return e.charCodeAt(0)}function a(e,t){for(var n=e.m,r=t.m,i=-1,o=n.length;++i<o;){var u=n[i],a=r[i];if(u!==a){if(u>a||typeof u=="undefined")return 1;if(u<a||typeof a=="undefined")return-1}}return e.n-t.n}function s(e){var t=-1,n=e.length,r=e[0],i=e[n/2|0],u=e[n-1];if(r&&typeof r=="object"&&i&&typeof i=="object"&&u&&typeof u=="object")return false;for(r=c(),r["false"]=r["null"]=r["true"]=r.undefined=false,i=c(),i.k=e,i.l=r,i.push=o;++t<n;)i.push(e[t]);return i}function f(e){return"\\\\"+X[e]}function l(){return y.pop()||[]}function c(){return _.pop()||{k:null,l:null,m:null,"false":false,n:0,"null":false,number:null,object:null,push:null,string:null,"true":false,undefined:false,o:null}}function p(e){e.length=0,y.length<x&&y.push(e)}function h(e){var t=e.l;t&&h(t),e.k=e.l=e.m=e.object=e.number=e.string=e.o=null,_.length<x&&_.push(e)}function v(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1;n=n-t||0;for(var i=Array(0>n?0:n);++r<n;)i[r]=e[t+r];return i}function d(e){function t(e,t,n){if(!e||!J[typeof e])return e;t=t&&typeof n=="undefined"?t:et(t,n,3);for(var r=-1,i=J[typeof e]&&Mn(e),o=i?i.length:0;++r<o&&(n=i[r],false!==t(e[n],n,e)););return e}function n(e,t,n){var r;if(!e||!J[typeof e])return e;t=t&&typeof n=="undefined"?t:et(t,n,3);for(r in e)if(false===t(e[r],r,e))break;return e}function o(e,t,n){var r,i=e,o=i;if(!i)return o;for(var u=arguments,a=0,s=typeof n=="number"?2:u.length;++a<s;)if((i=u[a])&&J[typeof i])for(var f=-1,l=J[typeof i]&&Mn(i),c=l?l.length:0;++f<c;)r=l[f],"undefined"==typeof o[r]&&(o[r]=i[r]);return o}function y(e,t,n){var r,i=e,o=i;if(!i)return o;var u=arguments,a=0,s=typeof n=="number"?2:u.length;if(3<s&&"function"==typeof u[s-2])var f=et(u[--s-1],u[s--],2);else 2<s&&"function"==typeof u[s-1]&&(f=u[--s]);for(;++a<s;)if((i=u[a])&&J[typeof i])for(var l=-1,c=J[typeof i]&&Mn(i),p=c?c.length:0;++l<p;)r=c[l],o[r]=f?f(o[r],i[r]):i[r];return o}function _(e){var t,n=[];if(!e||!J[typeof e])return n;for(t in e)_n.call(e,t)&&n.push(t);return n}function x(e){return e&&typeof e=="object"&&!Dn(e)&&_n.call(e,"__wrapped__")?e:new X(e)}function X(e,t){this.__chain__=!!t,this.__wrapped__=e}function Y(e){function t(){if(r){var e=v(r);mn.apply(e,arguments)}if(this instanceof t){var o=Q(n.prototype),e=n.apply(o,e||arguments);return wt(e)?e:o}return n.apply(i,e||arguments)}var n=e[0],r=e[2],i=e[4];return qn(t,e),t}function Z(e,n,r,i,o){if(r){var u=r(e);if(typeof u!="undefined")return u}if(!wt(e))return e;var a=cn.call(e);if(!W[a])return e;var s=Nn[a];switch(a){case P:case B:return new s(+e);case z:case $:return new s(e);case H:return u=s(e.source,O.exec(e)),u.lastIndex=e.lastIndex,u}if(a=Dn(e),n){var f=!i;i||(i=l()),o||(o=l());for(var c=i.length;c--;)if(i[c]==e)return o[c];u=a?s(e.length):{}}else u=a?v(e):y({},e);return a&&(_n.call(e,"index")&&(u.index=e.index),_n.call(e,"input")&&(u.input=e.input)),n?(i.push(e),o.push(u),(a?Rt:t)(e,function(e,t){u[t]=Z(e,n,r,i,o)}),f&&(p(i),p(o)),u):u}function Q(e){return wt(e)?jn(e):{}}function et(e,t,n){if(typeof e!="function")return Gt;if(typeof t=="undefined"||!("prototype"in e))return e;var r=e.__bindData__;if(typeof r=="undefined"&&(In.funcNames&&(r=!e.name),r=r||!In.funcDecomp,!r)){var i=gn.call(e);In.funcNames||(r=!R.test(i)),r||(r=N.test(i),qn(e,r))}if(false===r||true!==r&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return $t(e,t)}function nt(e){function t(){var e=s?u:this;if(i){var h=v(i);mn.apply(h,arguments)}return(o||l)&&(h||(h=v(arguments)),o&&mn.apply(h,o),l&&h.length<a)?(r|=16,nt([n,c?r:-4&r,h,null,u,a])):(h||(h=arguments),f&&(n=e[p]),this instanceof t?(e=Q(n.prototype),h=n.apply(e,h),wt(h)?h:e):n.apply(e,h))\n}var n=e[0],r=e[1],i=e[2],o=e[3],u=e[4],a=e[5],s=1&r,f=2&r,l=4&r,c=8&r,p=n;return qn(t,e),t}function rt(e,t){var n=-1,o=pt(),u=e?e.length:0,a=u>=w&&o===r,f=[];if(a){var l=s(t);l?(o=i,t=l):a=false}for(;++n<u;)l=e[n],0>o(t,l)&&f.push(l);return a&&h(t),f}function it(e,t,n,r){r=(r||0)-1;for(var i=e?e.length:0,o=[];++r<i;){var u=e[r];if(u&&typeof u=="object"&&typeof u.length=="number"&&(Dn(u)||gt(u))){t||(u=it(u,t,n));var a=-1,s=u.length,f=o.length;for(o.length+=s;++a<s;)o[f++]=u[a]}else n||o.push(u)}return o}function ot(e,t,r,i,o,u){if(r){var a=r(e,t);if(typeof a!="undefined")return!!a}if(e===t)return 0!==e||1/e==1/t;if(e===e&&!(e&&J[typeof e]||t&&J[typeof t]))return false;if(null==e||null==t)return e===t;var s=cn.call(e),f=cn.call(t);if(s==D&&(s=F),f==D&&(f=F),s!=f)return false;switch(s){case P:case B:return+e==+t;case z:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case H:case $:return e==un(t)}if(f=s==M,!f){var c=_n.call(e,"__wrapped__"),h=_n.call(t,"__wrapped__");if(c||h)return ot(c?e.__wrapped__:e,h?t.__wrapped__:t,r,i,o,u);if(s!=F)return false;if(s=e.constructor,c=t.constructor,s!=c&&!(bt(s)&&s instanceof s&&bt(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return false}for(s=!o,o||(o=l()),u||(u=l()),c=o.length;c--;)if(o[c]==e)return u[c]==t;var v=0,a=true;if(o.push(e),u.push(t),f){if(c=e.length,v=t.length,(a=v==c)||i)for(;v--;)if(f=c,h=t[v],i)for(;f--&&!(a=ot(e[f],h,r,i,o,u)););else if(!(a=ot(e[v],h,r,i,o,u)))break}else n(t,function(t,n,s){return _n.call(s,n)?(v++,a=_n.call(e,n)&&ot(e[n],t,r,i,o,u)):void 0}),a&&!i&&n(e,function(e,t,n){return _n.call(n,t)?a=-1<--v:void 0});return o.pop(),u.pop(),s&&(p(o),p(u)),a}function ut(e,n,r,i,o){(Dn(n)?Rt:t)(n,function(t,n){var u,a,s=t,f=e[n];if(t&&((a=Dn(t))||Fn(t))){for(s=i.length;s--;)if(u=i[s]==t){f=o[s];break}if(!u){var l;r&&(s=r(f,t),l=typeof s!="undefined")&&(f=s),l||(f=a?Dn(f)?f:[]:Fn(f)?f:{}),i.push(t),o.push(f),l||ut(f,t,r,i,o)}}else r&&(s=r(f,t),typeof s=="undefined"&&(s=t)),typeof s!="undefined"&&(f=s);e[n]=f})}function at(e,t){return e+dn(Ln()*(t-e+1))}function st(e,t,n){var o=-1,u=pt(),a=e?e.length:0,f=[],c=!t&&a>=w&&u===r,v=n||c?l():f;for(c&&(v=s(v),u=i);++o<a;){var d=e[o],g=n?n(d,o,e):d;(t?!o||v[v.length-1]!==g:0>u(v,g))&&((n||c)&&v.push(g),f.push(d))}return c?(p(v.k),h(v)):n&&p(v),f}function ft(e){return function(n,r,i){var o={};r=x.createCallback(r,i,3),i=-1;var u=n?n.length:0;if(typeof u=="number")for(;++i<u;){var a=n[i];e(o,a,r(a,i,n),n)}else t(n,function(t,n,i){e(o,t,r(t,n,i),i)});return o}}function lt(e,t,n,r,i,o){var u=1&t,a=4&t,s=16&t,f=32&t;if(!(2&t||bt(e)))throw new an;s&&!n.length&&(t&=-17,s=n=false),f&&!r.length&&(t&=-33,f=r=false);var l=e&&e.__bindData__;return l&&true!==l?(l=v(l),l[2]&&(l[2]=v(l[2])),l[3]&&(l[3]=v(l[3])),!u||1&l[1]||(l[4]=i),!u&&1&l[1]&&(t|=8),!a||4&l[1]||(l[5]=o),s&&mn.apply(l[2]||(l[2]=[]),n),f&&xn.apply(l[3]||(l[3]=[]),r),l[1]|=t,lt.apply(null,l)):(1==t||17===t?Y:nt)([e,t,n,r,i,o])}function ct(e){return Pn[e]}function pt(){var e=(e=x.indexOf)===Pt?r:e;return e}function ht(e){return typeof e=="function"&&pn.test(e)}function vt(e){var t,r;return e&&cn.call(e)==F&&(t=e.constructor,!bt(t)||t instanceof t)?(n(e,function(e,t){r=t}),typeof r=="undefined"||_n.call(e,r)):false}function dt(e){return Bn[e]}function gt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==D||false}function yt(e,t,n){var r=Mn(e),i=r.length;for(t=et(t,n,3);i--&&(n=r[i],false!==t(e[n],n,e)););return e}function _t(e){var t=[];return n(e,function(e,n){bt(e)&&t.push(n)}),t.sort()}function mt(e){for(var t=-1,n=Mn(e),r=n.length,i={};++t<r;){var o=n[t];i[e[o]]=o}return i}function bt(e){return typeof e=="function"}function wt(e){return!(!e||!J[typeof e])}function xt(e){return typeof e=="number"||e&&typeof e=="object"&&cn.call(e)==z||false}function Et(e){return typeof e=="string"||e&&typeof e=="object"&&cn.call(e)==$||false}function jt(e){for(var t=-1,n=Mn(e),r=n.length,i=Yt(r);++t<r;)i[t]=e[n[t]];return i}function St(e,n,r){var i=-1,o=pt(),u=e?e.length:0,a=false;return r=(0>r?Rn(0,u+r):r)||0,Dn(e)?a=-1<o(e,n,r):typeof u=="number"?a=-1<(Et(e)?e.indexOf(n,r):o(e,n,r)):t(e,function(e){return++i<r?void 0:!(a=e===n)}),a}function Tt(e,n,r){var i=true;n=x.createCallback(n,r,3),r=-1;var o=e?e.length:0;if(typeof o=="number")for(;++r<o&&(i=!!n(e[r],r,e)););else t(e,function(e,t,r){return i=!!n(e,t,r)});return i}function kt(e,n,r){var i=[];n=x.createCallback(n,r,3),r=-1;var o=e?e.length:0;if(typeof o=="number")for(;++r<o;){var u=e[r];n(u,r,e)&&i.push(u)}else t(e,function(e,t,r){n(e,t,r)&&i.push(e)});return i}function Ot(e,n,r){n=x.createCallback(n,r,3),r=-1;var i=e?e.length:0;if(typeof i!="number"){var o;return t(e,function(e,t,r){return n(e,t,r)?(o=e,false):void 0}),o}for(;++r<i;){var u=e[r];if(n(u,r,e))return u}}function Rt(e,n,r){var i=-1,o=e?e.length:0;if(n=n&&typeof r=="undefined"?n:et(n,r,3),typeof o=="number")for(;++i<o&&false!==n(e[i],i,e););else t(e,n);return e}function At(e,n,r){var i=e?e.length:0;if(n=n&&typeof r=="undefined"?n:et(n,r,3),typeof i=="number")for(;i--&&false!==n(e[i],i,e););else{var o=Mn(e),i=o.length;t(e,function(e,t,r){return t=o?o[--i]:--i,n(r[t],t,r)})}return e}function Ct(e,n,r){var i=-1,o=e?e.length:0;if(n=x.createCallback(n,r,3),typeof o=="number")for(var u=Yt(o);++i<o;)u[i]=n(e[i],i,e);else u=[],t(e,function(e,t,r){u[++i]=n(e,t,r)});return u}function Lt(e,t,n){var r=-1/0,i=r;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Dn(e)){n=-1;for(var o=e.length;++n<o;){var a=e[n];a>i&&(i=a)}}else t=null==t&&Et(e)?u:x.createCallback(t,n,3),Rt(e,function(e,n,o){n=t(e,n,o),n>r&&(r=n,i=e)});return i}function Nt(e,n,r,i){if(!e)return r;var o=3>arguments.length;n=x.createCallback(n,i,4);var u=-1,a=e.length;if(typeof a=="number")for(o&&(r=e[++u]);++u<a;)r=n(r,e[u],u,e);else t(e,function(e,t,i){r=o?(o=false,e):n(r,e,t,i)});return r}function It(e,t,n,r){var i=3>arguments.length;return t=x.createCallback(t,r,4),At(e,function(e,r,o){n=i?(i=false,e):t(n,e,r,o)}),n}function qt(e){var t=-1,n=e?e.length:0,r=Yt(typeof n=="number"?n:0);return Rt(e,function(e){var n=at(0,++t);r[t]=r[n],r[n]=e}),r}function Dt(e,n,r){var i;n=x.createCallback(n,r,3),r=-1;var o=e?e.length:0;if(typeof o=="number")for(;++r<o&&!(i=n(e[r],r,e)););else t(e,function(e,t,r){return!(i=n(e,t,r))});return!!i}function Mt(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=-1;for(t=x.createCallback(t,n,3);++o<i&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[0]:g;return v(e,0,An(Rn(0,r),i))}function Pt(e,t,n){if(typeof n=="number"){var i=e?e.length:0;n=0>n?Rn(0,i+n):n||0}else if(n)return n=Ut(e,t),e[n]===t?n:-1;return r(e,t,n)}function Bt(e,t,n){if(typeof t!="number"&&null!=t){var r=0,i=-1,o=e?e.length:0;for(t=x.createCallback(t,n,3);++i<o&&t(e[i],i,e);)r++}else r=null==t||n?1:Rn(0,t);return v(e,r)}function Ut(e,t,n,r){var i=0,o=e?e.length:i;for(n=n?x.createCallback(n,r,1):Gt,t=n(t);i<o;)r=i+o>>>1,n(e[r])<t?i=r+1:o=r;return i}function zt(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=false),null!=n&&(n=x.createCallback(n,r,3)),st(e,t,n)}function Ft(){for(var e=1<arguments.length?arguments:arguments[0],t=-1,n=e?Lt(Gn(e,"length")):0,r=Yt(0>n?0:n);++t<n;)r[t]=Gn(e,t);return r}function Ht(e,t){var n=-1,r=e?e.length:0,i={};for(t||!r||Dn(e[0])||(t=[]);++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function $t(e,t){return 2<arguments.length?lt(e,17,v(arguments,2),null,t):lt(e,1,null,null,t)}function Wt(e,t,n){function r(){l&&vn(l),u=l=c=g,(v||h!==t)&&(p=Kn(),a=e.apply(f,o),l||u||(o=f=null))}function i(){var n=t-(Kn()-s);0<n?l=bn(i,n):(u&&vn(u),n=c,u=l=c=g,n&&(p=Kn(),a=e.apply(f,o),l||u||(o=f=null)))}var o,u,a,s,f,l,c,p=0,h=false,v=true;if(!bt(e))throw new an;if(t=Rn(0,t)||0,true===n)var d=true,v=false;else wt(n)&&(d=n.leading,h="maxWait"in n&&(Rn(t,n.maxWait)||0),v="trailing"in n?n.trailing:v);return function(){if(o=arguments,s=Kn(),f=this,c=v&&(l||!d),false===h)var n=d&&!l;else{u||d||(p=s);var g=h-(s-p),y=0>=g;y?(u&&(u=vn(u)),p=s,a=e.apply(f,o)):u||(u=bn(r,g))}return y&&l?l=vn(l):l||t===h||(l=bn(i,t)),n&&(y=true,a=e.apply(f,o)),!y||l||u||(o=f=null),a}}function Gt(e){return e}function Kt(e,t,n){var r=true,i=t&&_t(t);t&&(n||i.length)||(null==n&&(n=t),o=X,t=e,e=x,i=_t(t)),false===n?r=false:wt(n)&&"chain"in n&&(r=n.chain);var o=e,u=bt(o);Rt(i,function(n){var i=e[n]=t[n];u&&(o.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,u=[n];if(mn.apply(u,arguments),u=i.apply(e,u),r||t){if(n===u&&wt(u))return this;u=new o(u),u.__chain__=t}return u})})}function Jt(){}function Xt(e){return function(t){return t[e]}}function Vt(){return this.__wrapped__}e=e?tt.defaults(V.Object(),e,tt.pick(V,q)):V;var Yt=e.Array,Zt=e.Boolean,Qt=e.Date,en=e.Function,tn=e.Math,nn=e.Number,rn=e.Object,on=e.RegExp,un=e.String,an=e.TypeError,sn=[],fn=rn.prototype,ln=e._,cn=fn.toString,pn=on("^"+un(cn).replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&").replace(/toString| for [^\\]]+/g,".*?")+"$"),hn=tn.ceil,vn=e.clearTimeout,dn=tn.floor,gn=en.prototype.toString,yn=ht(yn=rn.getPrototypeOf)&&yn,_n=fn.hasOwnProperty,mn=sn.push,bn=e.setTimeout,wn=sn.splice,xn=sn.unshift,En=function(){try{var e={},t=ht(t=rn.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),jn=ht(jn=rn.create)&&jn,Sn=ht(Sn=Yt.isArray)&&Sn,Tn=e.isFinite,kn=e.isNaN,On=ht(On=rn.keys)&&On,Rn=tn.max,An=tn.min,Cn=e.parseInt,Ln=tn.random,Nn={};Nn[M]=Yt,Nn[P]=Zt,Nn[B]=Qt,Nn[U]=en,Nn[F]=rn,Nn[z]=nn,Nn[H]=on,Nn[$]=un,X.prototype=x.prototype;var In=x.support={};In.funcDecomp=!ht(e.a)&&N.test(d),In.funcNames=typeof en.name=="string",x.templateSettings={escape:/<%-([\\s\\S]+?)%>/g,evaluate:/<%([\\s\\S]+?)%>/g,interpolate:A,variable:"",imports:{_:x}},jn||(Q=function(){function t(){}return function(n){if(wt(n)){t.prototype=n;var r=new t;t.prototype=null}return r||e.Object()}}());var qn=En?function(e,t){K.value=t,En(e,"__bindData__",K)}:Jt,Dn=Sn||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&cn.call(e)==M||false},Mn=On?function(e){return wt(e)?On(e):[]}:_,Pn={"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#39;"},Bn=mt(Pn),Un=on("("+Mn(Bn).join("|")+")","g"),zn=on("["+Mn(Pn).join("")+"]","g"),Fn=yn?function(e){if(!e||cn.call(e)!=F)return false;var t=e.valueOf,n=ht(t)&&(n=yn(t))&&yn(n);return n?e==n||yn(e)==n:vt(e)}:vt,Hn=ft(function(e,t,n){_n.call(e,n)?e[n]++:e[n]=1}),$n=ft(function(e,t,n){(_n.call(e,n)?e[n]:e[n]=[]).push(t)}),Wn=ft(function(e,t,n){e[n]=t}),Gn=Ct,Kn=ht(Kn=Qt.now)&&Kn||function(){return(new Qt).getTime()},Jn=8==Cn(E+"08")?Cn:function(e,t){return Cn(Et(e)?e.replace(C,""):e,t||0)};return x.after=function(e,t){if(!bt(t))throw new an;return function(){return 1>--e?t.apply(this,arguments):void 0}},x.assign=y,x.at=function(e){for(var t=arguments,n=-1,r=it(t,true,false,1),t=t[2]&&t[2][t[1]]===e?1:r.length,i=Yt(t);++n<t;)i[n]=e[r[n]];return i},x.bind=$t,x.bindAll=function(e){for(var t=1<arguments.length?it(arguments,true,false,1):_t(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=lt(e[i],1,null,null,e)}return e},x.bindKey=function(e,t){return 2<arguments.length?lt(t,19,v(arguments,2),null,e):lt(t,3,null,null,e)},x.chain=function(e){return e=new X(e),e.__chain__=true,e},x.compact=function(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r},x.compose=function(){for(var e=arguments,t=e.length;t--;)if(!bt(e[t]))throw new an;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},x.constant=function(e){return function(){return e}},x.countBy=Hn,x.create=function(e,t){var n=Q(e);return t?y(n,t):n},x.createCallback=function(e,t,n){var r=typeof e;if(null==e||"function"==r)return et(e,t,n);if("object"!=r)return Xt(e);var i=Mn(e),o=i[0],u=e[o];return 1!=i.length||u!==u||wt(u)?function(t){for(var n=i.length,r=false;n--&&(r=ot(t[i[n]],e[i[n]],null,true)););return r}:function(e){return e=e[o],u===e&&(0!==u||1/u==1/e)}},x.curry=function(e,t){return t=typeof t=="number"?t:+t||e.length,lt(e,4,null,null,null,t)},x.debounce=Wt,x.defaults=o,x.defer=function(e){if(!bt(e))throw new an;var t=v(arguments,1);return bn(function(){e.apply(g,t)},1)},x.delay=function(e,t){if(!bt(e))throw new an;var n=v(arguments,2);return bn(function(){e.apply(g,n)},t)},x.difference=function(e){return rt(e,it(arguments,true,true,1))},x.filter=kt,x.flatten=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=false),null!=n&&(e=Ct(e,n,r)),it(e,t)},x.forEach=Rt,x.forEachRight=At,x.forIn=n,x.forInRight=function(e,t,r){var i=[];n(e,function(e,t){i.push(t,e)});var o=i.length;for(t=et(t,r,3);o--&&false!==t(i[o--],i[o],e););return e},x.forOwn=t,x.forOwnRight=yt,x.functions=_t,x.groupBy=$n,x.indexBy=Wn,x.initial=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=i;for(t=x.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else r=null==t||n?1:t||r;return v(e,0,An(Rn(0,i-r),i))},x.intersection=function(){for(var e=[],t=-1,n=arguments.length,o=l(),u=pt(),a=u===r,f=l();++t<n;){var c=arguments[t];(Dn(c)||gt(c))&&(e.push(c),o.push(a&&c.length>=w&&s(t?e[t]:f)))}var a=e[0],v=-1,d=a?a.length:0,g=[];e:for(;++v<d;){var y=o[0],c=a[v];if(0>(y?i(y,c):u(f,c))){for(t=n,(y||f).push(c);--t;)if(y=o[t],0>(y?i(y,c):u(e[t],c)))continue e;g.push(c)}}for(;n--;)(y=o[n])&&h(y);return p(o),p(f),g},x.invert=mt,x.invoke=function(e,t){var n=v(arguments,2),r=-1,i=typeof t=="function",o=e?e.length:0,u=Yt(typeof o=="number"?o:0);return Rt(e,function(e){u[++r]=(i?t:e[t]).apply(e,n)}),u},x.keys=Mn,x.map=Ct,x.mapValues=function(e,n,r){var i={};return n=x.createCallback(n,r,3),t(e,function(e,t,r){i[t]=n(e,t,r)}),i},x.max=Lt,x.memoize=function(e,t){function n(){var r=n.cache,i=t?t.apply(this,arguments):b+arguments[0];return _n.call(r,i)?r[i]:r[i]=e.apply(this,arguments)}if(!bt(e))throw new an;return n.cache={},n},x.merge=function(e){var t=arguments,n=2;if(!wt(e))return e;if("number"!=typeof t[2]&&(n=t.length),3<n&&"function"==typeof t[n-2])var r=et(t[--n-1],t[n--],2);else 2<n&&"function"==typeof t[n-1]&&(r=t[--n]);for(var t=v(arguments,1,n),i=-1,o=l(),u=l();++i<n;)ut(e,t[i],r,o,u);return p(o),p(u),e},x.min=function(e,t,n){var r=1/0,i=r;if(typeof t!="function"&&n&&n[t]===e&&(t=null),null==t&&Dn(e)){n=-1;for(var o=e.length;++n<o;){var a=e[n];a<i&&(i=a)}}else t=null==t&&Et(e)?u:x.createCallback(t,n,3),Rt(e,function(e,n,o){n=t(e,n,o),n<r&&(r=n,i=e)});return i},x.omit=function(e,t,r){var i={};if(typeof t!="function"){var o=[];n(e,function(e,t){o.push(t)});for(var o=rt(o,it(arguments,true,false,1)),u=-1,a=o.length;++u<a;){var s=o[u];i[s]=e[s]}}else t=x.createCallback(t,r,3),n(e,function(e,n,r){t(e,n,r)||(i[n]=e)});return i},x.once=function(e){var t,n;if(!bt(e))throw new an;return function(){return t?n:(t=true,n=e.apply(this,arguments),e=null,n)}},x.pairs=function(e){for(var t=-1,n=Mn(e),r=n.length,i=Yt(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i},x.partial=function(e){return lt(e,16,v(arguments,1))},x.partialRight=function(e){return lt(e,32,null,v(arguments,1))},x.pick=function(e,t,r){var i={};if(typeof t!="function")for(var o=-1,u=it(arguments,true,false,1),a=wt(e)?u.length:0;++o<a;){var s=u[o];s in e&&(i[s]=e[s])}else t=x.createCallback(t,r,3),n(e,function(e,n,r){t(e,n,r)&&(i[n]=e)});return i},x.pluck=Gn,x.property=Xt,x.pull=function(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var o=-1,u=t[n];++o<i;)e[o]===u&&(wn.call(e,o--,1),i--);return e},x.range=function(e,t,n){e=+e||0,n=typeof n=="number"?n:+n||1,null==t&&(t=e,e=0);var r=-1;t=Rn(0,hn((t-e)/(n||1)));for(var i=Yt(t);++r<t;)i[r]=e,e+=n;return i},x.reject=function(e,t,n){return t=x.createCallback(t,n,3),kt(e,function(e,n,r){return!t(e,n,r)})},x.remove=function(e,t,n){var r=-1,i=e?e.length:0,o=[];for(t=x.createCallback(t,n,3);++r<i;)n=e[r],t(n,r,e)&&(o.push(n),wn.call(e,r--,1),i--);return o},x.rest=Bt,x.shuffle=qt,x.sortBy=function(e,t,n){var r=-1,i=Dn(t),o=e?e.length:0,u=Yt(typeof o=="number"?o:0);for(i||(t=x.createCallback(t,n,3)),Rt(e,function(e,n,o){var a=u[++r]=c();i?a.m=Ct(t,function(t){return e[t]}):(a.m=l())[0]=t(e,n,o),a.n=r,a.o=e}),o=u.length,u.sort(a);o--;)e=u[o],u[o]=e.o,i||p(e.m),h(e);return u},x.tap=function(e,t){return t(e),e},x.throttle=function(e,t,n){var r=true,i=true;if(!bt(e))throw new an;return false===n?r=false:wt(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),G.leading=r,G.maxWait=t,G.trailing=i,Wt(e,t,G)},x.times=function(e,t,n){e=-1<(e=+e)?e:0;var r=-1,i=Yt(e);for(t=et(t,n,1);++r<e;)i[r]=t(r);return i},x.toArray=function(e){return e&&typeof e.length=="number"?v(e):jt(e)},x.transform=function(e,n,r,i){var o=Dn(e);if(null==r)if(o)r=[];else{var u=e&&e.constructor;r=Q(u&&u.prototype)}return n&&(n=x.createCallback(n,i,4),(o?Rt:t)(e,function(e,t,i){return n(r,e,t,i)})),r},x.union=function(){return st(it(arguments,true,true))},x.uniq=zt,x.values=jt,x.where=kt,x.without=function(e){return rt(e,v(arguments,1))},x.wrap=function(e,t){return lt(t,16,[e])},x.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Dn(n)||gt(n))var r=r?st(rt(r,n).concat(rt(n,r))):n}return r||[]},x.zip=Ft,x.zipObject=Ht,x.collect=Ct,x.drop=Bt,x.each=Rt,x.eachRight=At,x.extend=y,x.methods=_t,x.object=Ht,x.select=kt,x.tail=Bt,x.unique=zt,x.unzip=Ft,Kt(x),x.clone=function(e,t,n,r){return typeof t!="boolean"&&null!=t&&(r=n,n=t,t=false),Z(e,t,typeof n=="function"&&et(n,r,1))},x.cloneDeep=function(e,t,n){return Z(e,true,typeof t=="function"&&et(t,n,1))},x.contains=St,x.escape=function(e){return null==e?"":un(e).replace(zn,ct)},x.every=Tt,x.find=Ot,x.findIndex=function(e,t,n){var r=-1,i=e?e.length:0;for(t=x.createCallback(t,n,3);++r<i;)if(t(e[r],r,e))return r;return-1},x.findKey=function(e,n,r){var i;return n=x.createCallback(n,r,3),t(e,function(e,t,r){return n(e,t,r)?(i=t,false):void 0}),i},x.findLast=function(e,t,n){var r;return t=x.createCallback(t,n,3),At(e,function(e,n,i){return t(e,n,i)?(r=e,false):void 0}),r},x.findLastIndex=function(e,t,n){var r=e?e.length:0;for(t=x.createCallback(t,n,3);r--;)if(t(e[r],r,e))return r;return-1},x.findLastKey=function(e,t,n){var r;return t=x.createCallback(t,n,3),yt(e,function(e,n,i){return t(e,n,i)?(r=n,false):void 0}),r},x.has=function(e,t){return e?_n.call(e,t):false},x.identity=Gt,x.indexOf=Pt,x.isArguments=gt,x.isArray=Dn,x.isBoolean=function(e){return true===e||false===e||e&&typeof e=="object"&&cn.call(e)==P||false},x.isDate=function(e){return e&&typeof e=="object"&&cn.call(e)==B||false},x.isElement=function(e){return e&&1===e.nodeType||false},x.isEmpty=function(e){var n=true;if(!e)return n;var r=cn.call(e),i=e.length;return r==M||r==$||r==D||r==F&&typeof i=="number"&&bt(e.splice)?!i:(t(e,function(){return n=false}),n)},x.isEqual=function(e,t,n,r){return ot(e,t,typeof n=="function"&&et(n,r,2))},x.isFinite=function(e){return Tn(e)&&!kn(parseFloat(e))},x.isFunction=bt,x.isNaN=function(e){return xt(e)&&e!=+e},x.isNull=function(e){return null===e},x.isNumber=xt,x.isObject=wt,x.isPlainObject=Fn,x.isRegExp=function(e){return e&&typeof e=="object"&&cn.call(e)==H||false},x.isString=Et,x.isUndefined=function(e){return typeof e=="undefined"},x.lastIndexOf=function(e,t,n){var r=e?e.length:0;for(typeof n=="number"&&(r=(0>n?Rn(0,r+n):An(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},x.mixin=Kt,x.noConflict=function(){return e._=ln,this},x.noop=Jt,x.now=Kn,x.parseInt=Jn,x.random=function(e,t,n){var r=null==e,i=null==t;return null==n&&(typeof e=="boolean"&&i?(n=e,e=1):i||typeof t!="boolean"||(n=t,i=true)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=Ln(),An(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):at(e,t)},x.reduce=Nt,x.reduceRight=It,x.result=function(e,t){if(e){var n=e[t];return bt(n)?e[t]():n}},x.runInContext=d,x.size=function(e){var t=e?e.length:0;return typeof t=="number"?t:Mn(e).length},x.some=Dt,x.sortedIndex=Ut,x.template=function(e,t,n){var r=x.templateSettings;e=un(e||""),n=o({},n,r);var i,u=o({},n.imports,r.imports),r=Mn(u),u=jt(u),a=0,s=n.interpolate||L,l="__p+=\'",s=on((n.escape||L).source+"|"+s.source+"|"+(s===A?k:L).source+"|"+(n.evaluate||L).source+"|$","g");e.replace(s,function(t,n,r,o,u,s){return r||(r=o),l+=e.slice(a,s).replace(I,f),n&&(l+="\'+__e("+n+")+\'"),u&&(i=true,l+="\';"+u+";\\n__p+=\'"),r&&(l+="\'+((__t=("+r+"))==null?\'\':__t)+\'"),a=s+t.length,t}),l+="\';",s=n=n.variable,s||(n="obj",l="with("+n+"){"+l+"}"),l=(i?l.replace(j,""):l).replace(S,"$1").replace(T,"$1;"),l="function("+n+"){"+(s?"":n+"||("+n+"={});")+"var __t,__p=\'\',__e=_.escape"+(i?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,\'\')}":";")+l+"return __p}";try{var c=en(r,"return "+l).apply(g,u)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},x.unescape=function(e){return null==e?"":un(e).replace(Un,dt)},x.uniqueId=function(e){var t=++m;return un(null==e?"":e)+t},x.all=Tt,x.any=Dt,x.detect=Ot,x.findWhere=Ot,x.foldl=Nt,x.foldr=It,x.include=St,x.inject=Nt,Kt(function(){var e={};return t(x,function(t,n){x.prototype[n]||(e[n]=t)}),e}(),false),x.first=Mt,x.last=function(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&null!=t){var o=i;for(t=x.createCallback(t,n,3);o--&&t(e[o],o,e);)r++}else if(r=t,null==r||n)return e?e[i-1]:g;return v(e,Rn(0,i-r))},x.sample=function(e,t,n){return e&&typeof e.length!="number"&&(e=jt(e)),null==t||n?e?e[at(0,e.length-1)]:g:(e=qt(e),e.length=An(Rn(0,t),e.length),e)},x.take=Mt,x.head=Mt,t(x,function(e,t){var n="sample"!==t;x.prototype[t]||(x.prototype[t]=function(t,r){var i=this.__chain__,o=e(this.__wrapped__,t,r);return i||null!=t&&(!r||n&&typeof t=="function")?new X(o,i):o})}),x.VERSION="2.4.1",x.prototype.chain=function(){return this.__chain__=true,this},x.prototype.toString=function(){return un(this.__wrapped__)},x.prototype.value=Vt,x.prototype.valueOf=Vt,Rt(["join","pop","shift"],function(e){var t=sn[e];x.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new X(n,e):n}}),Rt(["push","reverse","sort","unshift"],function(e){var t=sn[e];x.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Rt(["concat","slice","splice"],function(e){var t=sn[e];x.prototype[e]=function(){return new X(t.apply(this.__wrapped__,arguments),this.__chain__)}}),x}var g,y=[],_=[],m=0,b=+new Date+"",w=75,x=40,E=" 	\\f \\n\\r\\u2028\\u2029 ᠎             　",j=/\\b__p\\+=\'\';/g,S=/\\b(__p\\+=)\'\'\\+/g,T=/(__e\\(.*?\\)|\\b__t\\))\\+\'\';/g,k=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,O=/\\w*$/,R=/^\\s*function[ \\n\\r\\t]+\\w/,A=/<%=([\\s\\S]+?)%>/g,C=RegExp("^["+E+"]*0+(?=.$)"),L=/($^)/,N=/\\bthis\\b/,I=/[\'\\n\\r\\t\\u2028\\u2029\\\\]/g,q="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",M="[object Array]",P="[object Boolean]",B="[object Date]",U="[object Function]",z="[object Number]",F="[object Object]",H="[object RegExp]",$="[object String]",W={};W[U]=false,W[D]=W[M]=W[P]=W[B]=W[z]=W[F]=W[H]=W[$]=true;var G={leading:false,maxWait:0,trailing:false},K={configurable:false,enumerable:false,value:null,writable:false},J={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false},X={"\\\\":"\\\\","\'":"\'","\\n":"n","\\r":"r","	":"t","\\u2028":"u2028","\\u2029":"u2029"},V=J[typeof window]&&window||this,Y=J[typeof n]&&n&&!n.nodeType&&n,Z=J[typeof t]&&t&&!t.nodeType&&t,Q=Z&&Z.exports===Y&&Y,et=J[typeof e]&&e;!et||et.global!==et&&et.window!==et||(V=et);var tt=d();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(V._=tt,define(function(){return tt})):Y&&Z?Q?(Z.exports=tt)._=tt:Y._=tt:V._=tt}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(e,t,n){(function(e){/*!\n * @overview RSVP - a tiny implementation of Promises/A+.\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors\n * @license   Licensed under MIT license\n *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE\n * @version   3.0.14\n */\n(function(){"use strict";function n(e,t){for(var n=0,r=e.length;n<r;n++){if(e[n]===t){return n}}return-1}function r(e){var t=e._promiseCallbacks;if(!t){t=e._promiseCallbacks={}}return t}var i={mixin:function(e){e.on=this.on;e.off=this.off;e.trigger=this.trigger;e._promiseCallbacks=undefined;return e},on:function(e,t){var i=r(this),o;o=i[e];if(!o){o=i[e]=[]}if(n(o,t)===-1){o.push(t)}},off:function(e,t){var i=r(this),o,u;if(!t){i[e]=[];return}o=i[e];u=n(o,t);if(u!==-1){o.splice(u,1)}},trigger:function(e,t){var n=r(this),i,o;if(i=n[e]){for(var u=0;u<i.length;u++){o=i[u];o(t)}}}};var o={instrument:false};i.mixin(o);function u(e,t){if(e==="onerror"){o.on("error",t);return}if(arguments.length===2){o[e]=t}else{return o[e]}}function a(e){return typeof e==="function"||typeof e==="object"&&e!==null}function s(e){return typeof e==="function"}function f(e){return typeof e==="object"&&e!==null}var l;if(!Array.isArray){l=function(e){return Object.prototype.toString.call(e)==="[object Array]"}}else{l=Array.isArray}var c=l;var p=Date.now||function(){return(new Date).getTime()};function h(){}var v=Object.create||function(e){if(arguments.length>1){throw new Error("Second argument not supported")}if(typeof e!=="object"){throw new TypeError("Argument must be an object")}h.prototype=e;return new h};var d=[];var g=function Ht(e,t,n){if(1===d.push({name:e,payload:{guid:t._guidKey+t._id,eventName:e,detail:t._result,childGuid:n&&t._guidKey+n._id,label:t._label,timeStamp:p(),stack:new Error(t._label).stack}})){setTimeout(function(){var e;for(var t=0;t<d.length;t++){e=d[t];o.trigger(e.name,e.payload)}d.length=0},50)}};function y(){}var _=void 0;var m=1;var b=2;var w=new N;function x(e){try{return e.then}catch(t){w.error=t;return w}}function E(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function j(e,t,n){o.async(function(e){var r=false;var i=E(n,t,function(n){if(r){return}r=true;if(t!==n){k(e,n)}else{R(e,n)}},function(t){if(r){return}r=true;A(e,t)},"Settle: "+(e._label||" unknown promise"));if(!r&&i){r=true;A(e,i)}},e)}function S(e,t){if(t._state===m){R(e,t._result)}else if(e._state===b){A(e,t._result)}else{C(t,undefined,function(n){if(t!==n){k(e,n)}else{R(e,n)}},function(t){A(e,t)})}}function T(e,t){if(t.constructor===e.constructor){S(e,t)}else{var n=x(t);if(n===w){A(e,w.error)}else if(n===undefined){R(e,t)}else if(s(n)){j(e,t,n)}else{R(e,t)}}}function k(e,t){if(e===t){R(e,t)}else if(a(t)){T(e,t)}else{R(e,t)}}function O(e){if(e._onerror){e._onerror(e._result)}L(e)}function R(e,t){if(e._state!==_){return}e._result=t;e._state=m;if(e._subscribers.length===0){if(o.instrument){g("fulfilled",e)}}else{o.async(L,e)}}function A(e,t){if(e._state!==_){return}e._state=b;e._result=t;o.async(O,e)}function C(e,t,n,r){var i=e._subscribers;var u=i.length;e._onerror=null;i[u]=t;i[u+m]=n;i[u+b]=r;if(u===0&&e._state){o.async(L,e)}}function L(e){var t=e._subscribers;var n=e._state;if(o.instrument){g(n===m?"fulfilled":"rejected",e)}if(t.length===0){return}var r,i,u=e._result;for(var a=0;a<t.length;a+=3){r=t[a];i=t[a+n];if(r){D(n,r,i,u)}else{i(u)}}e._subscribers.length=0}function N(){this.error=null}var I=new N;function q(e,t){try{return e(t)}catch(n){I.error=n;return I}}function D(e,t,n,r){var i=s(n),o,u,a,f;if(i){o=q(n,r);if(o===I){f=true;u=o.error;o=null}else{a=true}if(t===o){A(t,new TypeError("A promises callback cannot return that same promise."));return}}else{o=r;a=true}if(t._state!==_){}else if(i&&a){k(t,o)}else if(f){A(t,u)}else if(e===m){R(t,o)}else if(e===b){A(t,o)}}function M(e,t){try{t(function r(t){k(e,t)},function i(t){A(e,t)})}catch(n){A(e,n)}}function P(e,t,n){if(e===m){return{state:"fulfilled",value:n}}else{return{state:"rejected",reason:n}}}function B(e,t,n,r){this._instanceConstructor=e;this.promise=new e(y,r);this._abortOnReject=n;if(this._validateInput(t)){this._input=t;this.length=t.length;this._remaining=t.length;this._init();if(this.length===0){R(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){R(this.promise,this._result)}}}else{A(this.promise,this._validationError())}}B.prototype._validateInput=function(e){return c(e)};B.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};B.prototype._init=function(){this._result=new Array(this.length)};var U=B;B.prototype._enumerate=function(){var e=this.length;var t=this.promise;var n=this._input;for(var r=0;t._state===_&&r<e;r++){this._eachEntry(n[r],r)}};B.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;if(f(e)){if(e.constructor===n&&e._state!==_){e._onerror=null;this._settledAt(e._state,t,e._result)}else{this._willSettleAt(n.resolve(e),t)}}else{this._remaining--;this._result[t]=this._makeResult(m,t,e)}};B.prototype._settledAt=function(e,t,n){var r=this.promise;if(r._state===_){this._remaining--;if(this._abortOnReject&&e===b){A(r,n)}else{this._result[t]=this._makeResult(e,t,n)}}if(this._remaining===0){R(r,this._result)}};B.prototype._makeResult=function(e,t,n){return n};B.prototype._willSettleAt=function(e,t){var n=this;C(e,undefined,function(e){n._settledAt(m,t,e)},function(e){n._settledAt(b,t,e)})};var z=function $t(e,t){return new U(this,e,true,t).promise};var F=function Wt(e,t){var n=this;var r=new n(y,t);if(!c(e)){A(r,new TypeError("You must pass an array to race."));return r}var i=e.length;function o(e){k(r,e)}function u(e){A(r,e)}for(var a=0;r._state===_&&a<i;a++){C(n.resolve(e[a]),undefined,o,u)}return r};var H=function Gt(e,t){var n=this;if(e&&typeof e==="object"&&e.constructor===n){return e}var r=new n(y,t);k(r,e);return r};var $=function Kt(e,t){var n=this;var r=new n(y,t);A(r,e);return r};var W="rsvp_"+p()+"-";var G=0;function K(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}var X=V;function V(e,t){this._id=G++;this._label=t;this._state=undefined;this._result=undefined;this._subscribers=[];if(o.instrument){g("created",this)}if(y!==e){if(!s(e)){K()}if(!(this instanceof V)){J()}M(this,e)}}V.cast=H;V.all=z;V.race=F;V.resolve=H;V.reject=$;V.prototype={constructor:V,_guidKey:W,_onerror:function(e){o.trigger("error",e)},then:function(e,t,n){var r=this;var i=r._state;if(i===m&&!e||i===b&&!t){if(o.instrument){g("chained",this,this)}return this}r._onerror=null;var u=new this.constructor(y,n);var a=r._result;if(o.instrument){g("chained",r,u)}if(i){var s=arguments[i-1];o.async(function(){D(i,u,s,a)})}else{C(r,u,e,t)}return u},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}};function Y(){this.value=undefined}var Z=new Y;var Q=new Y;function et(e){try{return e.then}catch(t){Z.value=t;return Z}}function tt(e,t,n){try{e.apply(t,n)}catch(r){Z.value=r;return Z}}function nt(e,t){var n={};var r;var i;var o=e.length;var u=new Array(o);for(var a=0;a<o;a++){u[a]=e[a]}for(i=0;i<t.length;i++){r=t[i];n[r]=u[i+1]}return n}function rt(e){var t=e.length;var n=new Array(t-1);for(var r=1;r<t;r++){n[r-1]=e[r]}return n}function it(e,t){return{then:function(n,r){return e.call(t,n,r)}}}var ot=function Jt(e,t){var n=function(){var n=this;var r=arguments.length;var i=new Array(r+1);var o;var u=false;for(var a=0;a<r;++a){o=arguments[a];if(!u){u=st(o);if(u===Q){var s=new X(y);A(s,Q.value);return s}else if(u&&u!==true){o=it(u,o)}}i[a]=o}var f=new X(y);i[r]=function(e,n){if(e)A(f,e);else if(t===undefined)k(f,n);else if(t===true)k(f,rt(arguments));else if(c(t))k(f,nt(arguments,t));else k(f,n)};if(u){return at(f,i,e,n)}else{return ut(f,i,e,n)}};n.__proto__=e;return n};function ut(e,t,n,r){var i=tt(n,r,t);if(i===Z){A(e,i.value)}return e}function at(e,t,n,r){return X.all(t).then(function(t){var i=tt(n,r,t);if(i===Z){A(e,i.value)}return e})}function st(e){if(e&&typeof e==="object"){if(e.constructor===X){return true}else{return et(e)}}else{return false}}var ft=function Xt(e,t){return X.all(e,t)};function lt(e,t,n){this._superConstructor(e,t,false,n)}lt.prototype=v(U.prototype);lt.prototype._superConstructor=U;lt.prototype._makeResult=P;lt.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var ct=function Vt(e,t){return new lt(X,e,t).promise};var pt=function Yt(e,t){return X.race(e,t)};function ht(e,t,n){this._superConstructor(e,t,true,n)}var vt=ht;ht.prototype=v(U.prototype);ht.prototype._superConstructor=U;ht.prototype._init=function(){this._result={}};ht.prototype._validateInput=function(e){return e&&typeof e==="object"};ht.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")};ht.prototype._enumerate=function(){var e=this.promise;var t=this._input;var n=[];for(var r in t){if(e._state===_&&t.hasOwnProperty(r)){n.push({position:r,entry:t[r]})}}var i=n.length;this._remaining=i;var o;for(var u=0;e._state===_&&u<i;u++){o=n[u];this._eachEntry(o.entry,o.position)}};var dt=function Zt(e,t){return new vt(X,e,t).promise};function gt(e,t,n){this._superConstructor(e,t,false,n)}gt.prototype=v(vt.prototype);gt.prototype._superConstructor=U;gt.prototype._makeResult=P;gt.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var yt=function Qt(e,t){return new gt(X,e,t).promise};var _t=function en(e){setTimeout(function(){throw e});throw e};var mt=function tn(e){var t={};t.promise=new X(function(e,n){t.resolve=e;t.reject=n},e);return t};var bt=function nn(e,t,n){return X.all(e,n).then(function(e){if(!s(t)){throw new TypeError("You must pass a function as map\'s second argument.")}var r=e.length;var i=new Array(r);for(var o=0;o<r;o++){i[o]=t(e[o])}return X.all(i,n)})};var wt=function rn(e,t){return X.resolve(e,t)};var xt=function on(e,t){return X.reject(e,t)};var Et=function un(e,t,n){return X.all(e,n).then(function(e){if(!s(t)){throw new TypeError("You must pass a function as filter\'s second argument.")}var r=e.length;var i=new Array(r);for(var o=0;o<r;o++){i[o]=t(e[o])}return X.all(i,n).then(function(t){var n=new Array(r);var i=0;for(var o=0;o<r;o++){if(t[o]){n[i]=e[o];i++}}n.length=i;return n})})};var jt=0;var St=function an(e,t){Nt[jt]=e;Nt[jt+1]=t;jt+=2;if(jt===2){qt()}};var Tt=typeof window!=="undefined"?window:{};var kt=Tt.MutationObserver||Tt.WebKitMutationObserver;var Ot=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function Rt(){return function(){e.nextTick(It)}}function At(){var e=0;var t=new kt(It);var n=document.createTextNode("");t.observe(n,{characterData:true});return function(){n.data=e=++e%2}}function Ct(){var e=new MessageChannel;e.port1.onmessage=It;return function(){e.port2.postMessage(0)}}function Lt(){return function(){setTimeout(It,1)}}var Nt=new Array(1e3);function It(){for(var e=0;e<jt;e+=2){var t=Nt[e];var n=Nt[e+1];t(n);Nt[e]=undefined;Nt[e+1]=undefined}jt=0}var qt;if(typeof e!=="undefined"&&{}.toString.call(e)==="[object process]"){qt=Rt()}else if(kt){qt=At()}else if(Ot){qt=Ct()}else{qt=Lt()}o.async=St;var Dt=wt;function Mt(e,t){o.async(e,t)}function Pt(){o.on.apply(o,arguments)}function Bt(){o.off.apply(o,arguments)}if(typeof window!=="undefined"&&typeof window["__PROMISE_INSTRUMENTATION__"]==="object"){var Ut=window["__PROMISE_INSTRUMENTATION__"];u("instrument",true);for(var zt in Ut){if(Ut.hasOwnProperty(zt)){Pt(zt,Ut[zt])}}}var Ft={race:pt,Promise:X,allSettled:ct,hash:dt,hashSettled:yt,denodeify:ot,on:Pt,off:Bt,map:bt,filter:Et,resolve:wt,reject:xt,all:ft,rethrow:_t,defer:mt,EventTarget:i,configure:u,async:Mt};if(typeof define==="function"&&define.amd){define(function(){return Ft})}else if(typeof t!=="undefined"&&t.exports){t.exports=Ft}else if(typeof this!=="undefined"){this["RSVP"]=Ft}}).call(this)}).call(this,e("_process"))},{_process:6}]},{},[1]);\n//# sourceMappingURL=https://mailfoogae.appspot.com/build/streakInjected.js.map';
(function(e){"use strict";var t=e.jQuery,n=e._;var i={_underscoreTemplates:{},underscore:function(e){if(!n.has(this._underscoreTemplates,e)){throw new Error("Template not found with id "+e)}return this._underscoreTemplates[e]}};e.Template=i})(Streak);(function(){var _=Streak._;var l=Streak.Locale.getString.bind(Streak.Locale);Streak.Template._underscoreTemplates["core/gmail/gmailLeftNav/link"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="streak__leftNavLink">\n  <div class="TO">\n    <div class="TN aY7xie aik">\n      <div class="TH J-J5-Ji"></div>\n      <div class="aio aip">\n        <span class="nU "><a href="#" target="_top" class="J-Ke n0">'+__e(text)+"</a></span>\n      </div>\n    </div>\n  </div>\n</div>\n"}return __p};Streak.Template._underscoreTemplates["core/gmail/labelActionTag"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<table cellpadding="0" class="cf hX">\n  <tbody>\n    <tr class="hR">\n      <td class="hU hM" style="background-color: '+__e(backgroundColor)+"; color: "+__e(textColor)+';">\n        <div class="hN" title="'+__e(labelHelpText)+'" role="button">\n          '+__e(labelText)+'\n        </div>\n      </td>\n      <td class="hV hM bb_labelActionTag" style="background-color: '+__e(backgroundColor)+"; color: "+__e(textColor)+';">\n        <span class="hO" title="'+__e(xHelpText)+'" role="button">x</span>\n      </td>\n    </tr>\n  </tbody>\n</table>\n'}return __p};Streak.Template._underscoreTemplates["core/gmail/labelTag"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="at" style="background-color: '+__e(groupcolor)+"; border-color: "+__e(groupcolor)+';">\n  <div class="au" style="border-color:'+__e(groupcolor)+'">\n    <div class="av" style="color: '+__e(textcolor)+'">\n      '+__e(text)+"\n    </div>\n  </div>\n</div>\n"}return __p};Streak.Template._underscoreTemplates["core/models/pipeline/systemSummary"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="boxSummary">';__p+='<span class="boxSummaryIcon boxSummaryEmail"></span>'+((__t=gmailThreadCount)==null?"":__t)+'<span class="boxSummaryIcon boxSummaryFile"></span>'+((__t=fileCount)==null?"":__t)+'<span class="boxSummaryIcon boxSummaryComment"></span>'+((__t=commentCount)==null?"":__t)+'<span class="boxSummaryIcon boxSummaryReminder"></span>'+((__t=reminderCount)==null?"":__t)+"</div>\n"}return __p};Streak.Template._underscoreTemplates["core/models/pipeline/systemSummaryText"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+="Thread Count: "+((__t=gmailThreadCount)==null?"":__t)+", File Count: "+((__t=fileCount)==null?"":__t)+", Comment Count: "+((__t=commentCount)==null?"":__t)+", Reminder Count: "+((__t=reminderCount)==null?"":__t)+"\n"}return __p};Streak.Template._underscoreTemplates["lib/jqueryplugins/multipleautosuggest"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="vR autoChosen">\n  <span class="vN Y7BVp" email="'+__e(email)+'">\n    <div class="vT">'+__e(name)+'</div><div class="vM"></div>\n  </span>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/button"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="f1 streakSettingsButton"><a href="#settingsStreak" class="f0" role="tab" hidefocus="false">Streak Settings</a></div>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/comboButton"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="J-J5-Ji alH J-JN-M-I streakSettingsComboButton" role="button" style="-webkit-user-select: none;" >\n  <div class="J-J5-Ji J-JN-M-I-Jm streakSettingsComboButtonText">'+__e(text)+'</div>\n  <div class="J-J5-Ji J-JN-M-I-JG streakSettingDownArrow">&nbsp;</div>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/parentButton"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span class="alM">\n  <span class="streakSettingsParentButton">'+__e(name)+'&nbsp;</span>\n  <span class="alA">▼</span>\n</span>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/section"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="streakSettingsSection">\n  <div class="rc">'+__e(sectionTitle)+'</div>\n  <div class="streakSettingsSectionBody"></div>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/setting"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="streakSettingsSetting">\n  <div class="streakSettingParentSetting">\n    <div class="streakSettingsSettingLeft">\n      <div class="streakSettingsSettingTitle">\n        '+__e(settingTitle)+'\n      </div>\n    </div>\n    <div class="streakSettingsSettingRight">\n      <div class="streakSettingsSettingWidget">\n      </div>\n    </div>\n  </div>\n\n  <div class="streakSettingChildSetting">\n    <div class="streakSettingsSettingLeft">\n      <div class="streakSettingsSubsettingList">\n      </div>\n    </div>\n\n    <div class="streakSettingsSettingRight">\n      <div class="streakSettingsSubsettingWidgets">\n      </div>\n    </div>\n  </div>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/subsettingTitle"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="streakSettingsSubsettingTitle">\n  '+__e(subsettingTitle)+"\n</div>\n"}return __p};Streak.Template._underscoreTemplates["modules/streakSettingsView/subtitle"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<br />\n<span class="rb" style="margin-left:0px">'+__e(text)+"</span>\n"}return __p};Streak.Template._underscoreTemplates["modules/threadView/credentialsError"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="streak__threadView_errorAccount">\n  Please have\n  ';_.each(emails,function(e,t){__p+='\n    <a href="mailto:'+__e(e)+'">'+__e(e)+"</a>";if(t!=emails.length-1&&emails.length>2){__p+=", "}if(t==emails.length-2){__p+=" or "}});__p+="\n  log in to Streak and access to the thread will be fixed automatically.\n</div>\n"}return __p};Streak.Template._underscoreTemplates["modules/threadView/email"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="h7 streak__threadView_email">\n	<div class="Bk">\n		<div class="G3 G2">\n			<div class="adn ads">\n				<div class="aju streak__fromImage">\n					<img src="'+__e(imageSrc)+'" class="ajn" jid="'+__e(email)+'" />\n				</div>\n				<div class="gs">\n					<div class="gE gt">\n						<table>\n							<tbody>\n								<tr class="acZ">\n									<td class="gF gK">\n										<span email="'+__e(email)+'" class="gD streak__fromName">'+__e(name)+'</span>\n										<span class="go streak__fromEmail">'+__e(email)+'</span>\n									</td>\n									<td class="gH">\n										<div class="gK">\n											<span class="g3" title="'+__e(datetime)+'" alt="'+__e(datetime)+'">'+__e(gmailDate)+'</span>\n										</div>\n									</td>\n								</tr>\n								<tr class="acZ">\n									<td colspan="2">\n										<div class="iw ajw">\n											<span class="hb streak__toList">\n												to '+((__t=emailListHTML)==null?"":__t)+'\n											</span>\n										</div>\n									</td>\n								</tr>\n							</tbody>\n						</table>\n					</div>\n					<div class="ii gt adP streak__email_body"></div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["modules/threadView/emailName"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span email="'+__e(email)+'">'+__e(name)+"</span>\n"}return __p};Streak.Template._underscoreTemplates["modules/threadView/threadView"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="streak__threadView" style="height: 100%; min-width: 700px;">\n	<div class="streak__main_thread_content">\n		<div class="loadingThreads">\n			<img aria-hidden="true" src="//ssl.gstatic.com/ui/v1/activityindicator/loading_bg_f5.gif">\n		</div>\n		<div class="if threadViewThreads">\n			<h1 class="ha subject"></h1>\n			<div class="hx emails"></div>\n		</div>\n		<div class="streak__threadView_error">\n		</div>\n	</div>\n	<div class="streak__thread_sidebar inboxsdk__sidebar" id="streakSidebar">\n		<div class="boxInfo inboxsdk__contentPanelContainer"></div>\n	</div>\n</div>\n'}return __p};Streak.Template._underscoreTemplates["widgets/feedList/boxObject"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<a href="#" class="streak__newsfeed_box" data-key="'+__e(key)+'">'+__e(name)+"</a>\n"}return __p};Streak.Template._underscoreTemplates["widgets/feedList/feedListRow"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='	<div class="bb_feeditem_meta">\n		<img src="'+__e(userImageUrl)+'" class="bb_feedpic">\n	</div>\n\n	<div class="bb_feeddate" data-tooltip="'+__e(completeDatetime)+'">'+__e(datetime)+'</div>\n\n	<div class="bb_feeditem_content">\n		<div class="bb_feedtext">\n			'+((__t=storyHtml)==null?"":__t)+"\n		</div>\n\n		";if(detail){__p+='\n		<div class="bb_feeddetail">'+__e(detail)+"</div>\n		"}__p+="\n\n		";if(comment){__p+='\n		<div class="comment">\n			<div class="bb_pip"></div>\n			<div class="bb_feedcomment">\n				<div class="bb_feedcomment_text">'+__e(comment)+'</div>\n				<div class="bb_comment_fade"></div>\n			</div>\n		</div>\n		'}__p+="\n	</div>\n\n	";if(objects&&objects.length){__p+='\n	<div class="bb_feedobjects">\n		';_.each(objects,function(e){__p+='\n		<div class="bb_feedobject">'+((__t=e)==null?"":__t)+"</div>\n		"});__p+="\n	</div>\n	"}__p+="\n"}return __p}})();(function(e,t){var n=e.jQuery,i=e._,r=e.Request;var a={_cachedTemplates:{},loaded:null,init:function(){var t=this;return new r("GET",e.combinedServer||e.server,e.getCombined("html",false),{responseType:"text",isAnonymous:true}).getPromise().then(function(e){t.loaded=n(document.createElement("div"));t.loaded[0].innerHTML=e})},get:function(t,r){if(!r&&i.has(this._cachedTemplates,t)){return this._cachedTemplates[t]}var a=this.loaded.find("#"+t);if(a.length===0){throw new Error("can't find "+t)}var o=e.Locale.localize(a[0].innerHTML.unescapeHTML()).trim();if(r){return n(n.parseHTML(o))}else{return this._cachedTemplates[t]=i.template(o)}},getString:function(t){var n=this.loaded.find("#"+t);if(n.length===0){console.log("can't find "+t);return t}else{return e.Locale.localize(n[0].innerHTML.unescapeHTML()).trim()}},getStringWithSelector:function(t){var n=this.loaded.find(t);if(n.length===0){return""}return e.Locale.localize(n[0].innerHTML.unescapeHTML()).trim()},getElementWithSelector:function(e){var t=this.getStringWithSelector(e);return n(n.parseHTML(t))},getElement:function(e){return this.get(e,true)}};e.DependencyManager.addFunction({functionKey:"htmlLoaded",functionReference:a.init,functionContext:a,dependentFunctionKeys:["localeLoaded"]});e.HTML=a})(Streak,window);!function(e,t){"use strict";function n(){var t=arguments;e.BentoBox&&e.BentoBox.logError?e.BentoBox.logError.apply(e.BentoBox,t):setTimeout(function(){e.BentoBox.logError.apply(e.BentoBox,t)},1)}var i=e.jQuery,r=e._,a=e.Bacon,o=e.Date,s=e.Utils,l=e.Template,u=e.Eventer,c=t.MutationObserver||t.WebKitMutationObserver||t.MozMutationObserver,d=function(e){h.debug&&console.log(e)},h=new u;r.extend(h,{Constants:{Compose:"compose",Inbox:"inbox",SectionQuery:"section_query",All:"all",Important:"imp",Conversation:"conversation",Contacts:"contacts",Contact:"contact",Sent:"sent",Starred:"starred",Drafts:"drafts",Label:"label",Search:"search",AdvancedSearch:"advanced-search",Trash:"trash",Spam:"spam",Apps:"apps",Box:"box",Pipeline:"pipeline",NewPipeline:"newpipeline",Pipelines:"pipelines",PipelineReports:"pipelinereports",GmailThread:"thread",Circle:"circle",Settings:"settings",ListViews:[],BentoBoxViews:[],DeepLinkLoading:"loading",Paywall:"upgrade",PaidAccount:"account"},debug:!1,elements:{},hash:{parts:null,query:null},view:null,lastView:"",wasLastViewConversation:!1,currentVisibleModal:"",label:null,conversation:null,timer:null,dontLoad:!1,hashChangeLastID:1,rowThreadIconIndex:0,cachedVerticalList:null,emailBodyModifierCallback:null,elementsInComposeArea:[],ajaxInterceptorSources:[],eventStreamBus:null,gmonkey:null,init:function(t){var n=this;d("Initializing Gmailr API"),this.xhrWatcher.init(this),InboxSDK.load(1,"streak",{TEMPORARY_INTERNAL_skipWeakMapRequirement:!0,globalErrorLogging:!1}).then(function(e){n.inboxSDK=e}),this.eventStreamBus=new e.Bacon.Bus,n.Constants.ListViews=[n.Constants.Inbox,n.Constants.SectionQuery,n.Constants.Important,n.Constants.All,n.Constants.Sent,n.Constants.Starred,n.Constants.Drafts,n.Constants.Label,n.Constants.Search,n.Constants.AdvancedSearch,n.Constants.Spam,n.Constants.Trash,n.Constants.Apps,n.Constants.Circle],n.Constants.ContactViews=[n.Constants.Contacts,n.Constants.Contact],n.Constants.BentoBoxViews=[n.Constants.Pipeline,n.Constants.Box,n.Constants.NewPipeline,n.Constants.Pipelines,n.Constants.GmailThread,n.Constants.PipelineReports,n.Constants.DeepLinkLoading,n.Constants.Paywall,n.Constants.PaidAccount],n.delayed_loader=setInterval(function(){n.bootstrap(),n.isReadyToLoad&&"undefined"!=typeof gmonkey&&n.inboxSDK?(clearInterval(n.delayed_loader),n.parse(),n.loadGmonkey(function(){t&&t(),n.trigger("load"),e.NotificationCenter.postNotification({eventName:"gmailLoaded",sender:this}),n.trigger("ready")})):n.dontLoad&&clearInterval(n.delayed_loader)},1e3),-1===n.Constants.ContactViews.indexOf(location.hash.substring(1).split("/")[0].toLowerCase())&&setTimeout(function(){if(!n.isReadyToLoad&&!n.dontLoad){var t="something wrong with Gmail";e.BentoBox.logError(t)}},24e4)},teardown:function(){this.unReady(),clearInterval(this.timer)},reup:function(){this.trigger("ready"),this.setupGmailTimer()},destroy:function(){this.unbindWatchers(),this.xhrWatcher.destroy()},$:function(e){return this.elements.body.find(e)},insertCss:function(e){var t=i('<link rel="stylesheet" type="text/css">');t.attr("href",e),this.elements.canvas.find("head").first().append(t)},_currentNotice:null,_initNotices:r.once(function(){function e(){n._removeNotice(),n._renderNotice()}function t(){n._renderNotice(),n._currentNotice||n._postNoticesClearedNotification()}this.elements.notice.streakMessage=this.elements.notice.googleMessage.clone().addClass("streak__noticeMessage").insertAfter(this.elements.notice.googleMessage);var n=this;if(c){var i={childList:!0},r=new c(function(n){n.forEach(function(n){"childList"===n.type&&(n.addedNodes.length?e():t())})});r.observe(this.elements.notice.googleMessage[0],i)}else this.elements.notice.googleMessage.on("DOMNodeInserted DOMCharacterDataModified",e),this.elements.notice.googleMessage.on("DOMNodeRemoved",t)}),_postNoticesClearedNotification:function(){var e={eventName:"gmail.noticesCleared",noticeSpawned:!1};return this._postNotification(e),e.noticeSpawned},newNotice:function(t){this._initNotices(),this._removeNotice();var n=this;return this._currentNotice={html:t,isVisible:function(){return this===n._currentNotice},destroy:function(){this.isVisible()&&n._hideNotice()}},this._currentNotice._endJob=e.Promise.defer(),this._currentNotice.endPromise=this._currentNotice._endJob.promise,this._renderNotice(),this._currentNotice},_renderNotice:function(){this._currentNotice?(this.elements.notice.css({visibility:"visible",top:""}),this.elements.notice.googleMessage.css("display","none"),this.elements.notice.streakMessage.html(this._currentNotice.html).css("display","")):(this.elements.notice.css(this.elements.notice.googleMessage.html().trim().length>0?{visibility:"visible"}:{visibility:"hidden"}),this.elements.notice.googleMessage.css("display",""),this.elements.notice.streakMessage.empty().css("display","none"))},_hideNotice:function(){this._removeNotice(),this._postNoticesClearedNotification()||this._renderNotice()},_removeNotice:function(){this._currentNotice&&this._currentNotice._endJob.resolve(),this._currentNotice=null},showNotice:function(t,n,i){console.warn("Gmail.showNotice is deprecated! Use Streak.BentoBox.ButterBarManager instead."),e.BentoBox.ButterBarManager.showMessage({message:t,time:n,priority:i})},hideNotice:function(){this._initNotices(),this._hideNotice()},observe:function(e,t,n,i){n&&(t.uniq=n),t.uniq||(t.uniq=""+(new o).getTime()+Math.random()),i||(i=100),t.priority||(t.priority=i),this.ob_queues[e]||(this.ob_queues[e]=[]);var a=r.indexOfPlus(this.ob_queues[e],function(e){return e.uniq===n});return a>-1?this.ob_queues[e][a]=t:this.ob_queues[e].push(t),this.ob_queues[e]=r.sortBy(this.ob_queues[e],function(e){return e.priority}),t.uniq},unobserve:function(e,t){this.ob_queues[e]=r.filter(this.ob_queues[e],function(e){return e.uniq!=t})},getEventStream:function(){return this.eventStreamBus},bootstrap:function(){var t=document.getElementById("loading"),n=document.getElementById("canvas_frame");if(t&&"none"===t.style.display&&(n=n?n.contentDocument:document),n&&document.getElementsByTagName("body").length>0){this.elements.canvas=i(n),this.elements.body=this.elements.canvas.find("body").first();var r=this.$("div[role=main]");this.elements.main=r.closest(".ar4"),r&&r.length>0&&this.elements.main&&this.elements.main.length>0?(this.isReadyToLoad=!0,e.document=n):location.search.indexOf("view=cm")>-1&&(this.dontLoad=!0)}},loadGmonkey:function(e){var t=this;gmonkey.load("2.0",function(n){t.gmonkey=n,e()})},bindWatchers:function(e){var n=this;i(t).bind("hashchange.gmail",function(e){n.waitingToLoad||(n.hashChangeLastID+=1,n.detectViewChange(e,1,n.hashChangeLastID))}),this.getCurrentMain(!0),this.setupGmailTimer(),this.detectListToggle(),this.setupAnimationWatcher(),this.detectDensitySetting(),this.detectPreviewPaneChange(),this.detectToolbarChanges(),this.detectEmailMenu(),this.detectMoreMenu(),this.detectChatMessages(),this.detectThreadLoaded(),this.detectConversationMessageStateChange(),this.detectNewInboxEmail(),this.setupCacheBusters(),this.setupComposeHolderResizeEvents(),e&&e()},unbindWatchers:function(){i(t).unbind(".gmail"),this.pauseTimer(),e.document.removeEventListener("animationstart",this.animationWatcher.watchFunc),e.document.removeEventListener("MSAnimationStart",this.animationWatcher.watchFunc),e.document.removeEventListener("webkitAnimationStart",this.animationWatcher.watchFunc)},parse:function(){this.elements.topbar=this.$("div#gb");this.elements.topbar.find(".gbvg");this.elements.topbar.leftLinks=this.elements.topbar.find("ol.gbtc:first"),this.elements.topbar.rightLinks=this.elements.topbar.find("ol.gbtc:last"),this.elements.notice=this.$("div.nn:nth-child(2) .b8"),this.elements.notice.googleMessage=this.elements.notice.find(".vh"),this.elements.logo=this.$("div.nn:first"),this.elements.search=this.$("div.nn:nth-child(2) table[role=search]"),this.elements.leftbar=this.$("div.oy8Mbf div[role=navigation]").parents("div.oy8Mbf"),this.elements.leftbar.links=this.elements.leftbar.find("div[role=navigation] [title]:first").parents(".n3"),this.elements.main=this.$("div[role=main]:first").closest(".ar4"),this.elements.mainParent=this.$("div[role=main]:first").parent(),this.elements.toolbarGroup=this.$(".aeH"),this.elements.viewGroup=this.$(".aeF > .nH")},setEmailBodyModifierCallback:function(e){this.emailBodyModifierCallback=e},xhrWatcher:{_stopper:new a.Bus,_initialized:!1,init:function(){if(!this._initialized){this._initialized=!0,a.fromEventTarget(document,"streakAjaxSearchStart").takeUntil(this._stopper).onValue(function(e){h.executeObQueues("search",e.detail)}),a.fromEventTarget(document,"streakAjaxSearchComplete").takeUntil(this._stopper).onValue(function(e){h.executeObQueues("ajaxListRefresh",{search:e.detail.search,viewData:e.detail.responseText}),h._postNotification({eventName:"gmail.newThreadListResponse",searchTerm:e.detail.search,response:e.detail.responseText})}),a.fromEventTarget(document,"streakAjaxSaveDraft").takeUntil(this._stopper).onValue(function(t){try{var n=t.detail.responseText,i=h.ThreadResponseProcessor.deserialize(n),r=e.searchObject(i,"a",100,!0,!0);if(0===r.length)return;var a=r[0];if(!a||!a.path)return;var o=a.path;o=o.split("/").slice(1,-1);for(var s=i,l=0;l<o.length;l++)s=s[o[l]];var u=s[3][0];h.executeObQueues("draftSaved",n,u,t.detail.composeid)}catch(c){e.BentoBox.logError("draft saving error",c)}}),a.fromEventTarget(document,"streakAjaxSendMailStart").takeUntil(this._stopper).onValue(function(e){h.executeObQueues("compose",i.deparam(e.detail))}),a.fromEventTarget(document,"streakAjaxSendMailComplete").takeUntil(this._stopper).onValue(function(t){try{var n=t.detail.responseText;h._postNotification({eventName:"gmail.emailSent",sender:h,requestParameters:i.deparam(t.detail.originalSendBody),response:n}),h.executeObQueues("emailSent",{request:i.deparam(t.detail.originalSendBody),response:n})}catch(r){e.BentoBox.logError("emailSent processing error",r)}}),a.fromEventTarget(document,"streakAjaxEmailDiscarded").takeUntil(this._stopper).onValue(function(e){var t=e.detail;h.executeObQueues("emailDiscarded",i.deparam(t).m)});var t={},n=function(e,t){var n=document.createEvent("CustomEvent");n.initCustomEvent(e,!0,!1,t),document.dispatchEvent(n)};a.fromEventTarget(document,"streakAjaxInterceptorRelevanceCheck").takeUntil(this._stopper).onValue(function(e){var n=e.detail.id,i=e.detail.params;h.GmailThreadListViewRegister&&h.GmailThreadListViewRegister.isRequestRelevant(i)&&(document.head.setAttribute("data-streak-gmail-com","1"),t[n]=h.GmailThreadListViewRegister.getAjaxInterceptor(i))}),a.fromEventTarget(document,"streakAjaxInterceptorApply").takeUntil(this._stopper).onValue(function(e){var i=e.detail.id,r=t[i];delete t[i];var a=(e.detail.params,e.detail.responseText),o=e.detail.connection;r.getNewResponseText(o,a).then(function(e){n("streakAjaxInterceptorApplyResponse",{id:i,newResponseText:e})})});var r=document.createElement("script");r.type="text/javascript",r.text=e.Resources["streakInjected.js"]+"\n//# sourceURL=streakInjected.js\n",document.head.appendChild(r).remove()}},destroy:function(){this._initialized=!1,this._stopper.push("boop")}},setupTimer:function(e){clearTimeout(this.timer),delete this.timer,this.timer=setTimeout(this.timerFunction,e||500)},timerFunction:function(e){var t=h;t.view=t.getLiveView(),t.isGmailView()&&t.getCurrentMain(!0),t.executeObQueues("gmailTimer"),t.setupTimer(e)},setupGmailTimer:function(e){var t=this;this.pauseTimer(),t.timerFunction(e)},pauseTimer:function(){clearTimeout(this.timer),delete this.timer},resumeTimer:function(){this.setupGmailTimer()},addTimerObserver:function(e,t,n){var i=e;t&&(i=r.throttle(function(){e()},t)),this.observe("gmailTimer",function(){i()},n)},setupCacheBusters:function(){var e=this;h.observe("viewChanged",function(){e.cachedVerticalList=null}),h.observe("newInboxEmails",function(){e.cachedVerticalList=null})},detectListToggle:function(){var e=this;h.observe("viewChanged",function(){if(e.isListView())for(var t=e.getCurrentMain().find("h3.Wr"),n=0;n<t.length;n++){var r=i(t[n]);r.data("toggleTracked")||(r.click(function(){var t=i(this).closest(".ae4"),n=!1;t.find(".Cp").children().length>0&&(n=!0),e.executeObQueues("listToggle",n)}),r.data("toggleTracked",!0))}})},detectPreviewPaneChange:function(){var e=this;this.currentPreviewPaneSettings=this.getFreshPreviewPaneSettings();var t=r.throttle(function(){e.isListView()&&e.getFreshPreviewPaneSettings()},500);h.observe("gmailTimer",function(){t()}),h.observe("viewChanged",function(){if(e.isListView()&&e.isHorizontalSplitPreviewPane()&&0===e.getCurrentMain().find(".age").filterOutInvisible().filter(":first").height()){var t=e.getLeftbarLinks().find(".ain").filter(":not(.pipeline)");if(t.length>0){var n=t.siblings();i(n[0]).find(".nU").click(),t.find(".nU").click()}}})},detectDensitySetting:function(){function e(){var e=parseInt(i(".TO .TN").css("padding-top"),10);return e>=6?"comfortable":e>=3?"cozy":"compact"}var t=this,n=null,a=function(){var r=e();n!=r&&(n&&i(document.body).removeClass("streak_gmail_density_"+n),n=r,i(document.body).addClass("streak_gmail_density_"+n),t.executeObQueues("gmailDisplayDensityChange",n))},o=new c(a),s={characterData:!0,childList:!0};r.each(document.styleSheets,function(e){"STYLE"==e.ownerNode.tagName&&o.observe(e.ownerNode,s)}),a()},detectToolbarChanges:function(){var e=this;if(c){var t={childList:!0},n={attributes:!0,attributeFilter:["style"]},i=new c(function(t){t.forEach(function(e){e.addedNodes&&r.each(e.addedNodes,function(e){i.observe(e,n)})}),e.executeObQueues("toolbarUpdate")});this.elements.toolbarGroup.add(this.elements.viewGroup).each(function(){i.observe(this,t)}).children().each(function(){i.observe(this,n)})}},getEmailMenu:function(){return i("#\\3a 2 td > div.nH.if > div.nH.aHU div.b7.J-M[aria-haspopup=true]")},_getEmailForActiveMenu:function(){return i(".T-I[role=button][aria-expanded=true]").parents(".Bk").first()},closeActiveEmailMenu:function(){i(".T-I[role=button][aria-expanded=true]").simulateRawClick()},getMessageIdFromElement:function(e){var t;return i(e).find(".adP").each(function(){return t=r.find(i(this).attr("class").split(/\s+/),function(e){return"m"==e[0]}),t?(t=t.slice(1),!1):void 0}),t},gotoCurrentThreadFolder:function(){document.location.hash=document.location.hash.replace(/\/[^\/]+$/,"")},expandAllEmailsInThread:function(){var e=i(".ade .hk .T-I[role=button] .gx");return e.simulateRawClick(),s.waitFor(function(){return i(".Bk:visible").length==i(".Bk:visible .adP").length},3e4)},collapseAllEmailsInThread:function(){var e=i(".ade .hk .T-I[role=button] .gq");return e.simulateRawClick(),s.wait(1)},detectEmailMenu:function(){function e(){r.disconnect(),t=n.getEmailMenu(),t.each(function(){r.observe(this,i)})}if(c){var t,n=this,i={attributes:!0,attributeFilter:["style","class"]},r=new c(function(){if(t.is(":visible")){var e=n._getEmailForActiveMenu();e.length&&n.executeObQueues("emailMenuOpen",t,e)}});this.observe("viewChanged",e),this.observe("conversationThreadLoadedEvent",e),e()}},detectMoreMenu:function(){function e(){i.disconnect(),t.getCurrentMoreButton().each(function(){i.observe(this,n)})}if(c){var t=this,n={attributes:!0,attributeFilter:["aria-expanded"]},i=new c(function(){var e=t._getCurrentMoreButtonMenu().filter(":visible");e.length&&t.executeObQueues("moreMenuOpen",e)});this.observe("viewChanged",e),e()}},detectChatMessages:function(){var t=this;e.DomWatcher.watchForNewSelector(".dw .km",function(e){t.executeObQueues("newChatMessage",i(e))})},detectThreadLoaded:function(){var t=this;e.DomWatcher.watchForNewSelector(".Bu .nH.if",function(e){if(t.isPreviewPane()||t.isInConversation())t.executeObQueues("conversationThreadLoadedEvent",i(e)),t._notifyConversationLoaded(i(e));else var n=t.observe("viewChanged",function(){t.unobserve("viewChanged",n),t.executeObQueues("conversationThreadLoadedEvent",i(e)),t._notifyConversationLoaded(i(e))},null,200)})},detectConversationMessageStateChange:function(){var t=this,n=r.delayed(function(){t.executeObQueues("conversationMessageStateChanged")},100);e.DomWatcher.watchForNewSelector("[role=main] .h7 > div",n),e.DomWatcher.watchForNewSelector("[role=main] .kv > div",n)},detectNewInboxEmail:function(){var t=this,n=[],a=r.delayed(function(){t.executeObQueues("newInboxEmails");var e=n;"vertical"===t.getPreviewPaneSettings()&&(e=t.getThreadDOMRows()),t._postNotification({eventName:"gmail.newThreadDOMRows",sender:t,threadDOMRows:e}),n=[]},10);e.DomWatcher.watchForNewSelector(".ae4 .Cp tr.zA [role=checkbox]",function(e){if(a(),"vertical"!==t.getPreviewPaneSettings()){var r=t.convertHTMLRowToObject(i(e).parents("tr"));t.executeObQueues("newInboxEmail",r),t._postNotification({eventName:"gmail.newThreadDOMRow",threadDOMRow:r,sender:t}),n.push(r)}})},setupAnimationWatcher:function(){var t=this;this.animationWatcher=e.Eventer.create({watchFunc:function(e){t.animationWatcher.trigger(e.animationName,e)}}),e.document.addEventListener("animationstart",this.animationWatcher.watchFunc,!1),e.document.addEventListener("MSAnimationStart",this.animationWatcher.watchFunc,!1),e.document.addEventListener("webkitAnimationStart",this.animationWatcher.watchFunc,!1)},addAnimationWatcher:function(e,t){if(r.isString(e)&&(e=[e]),e&&e.length>0)for(var n=0;n<e.length;n++)this.animationWatcher.bind(e[n],t)},ob_queues:{archive:[],"delete":[],spam:[],reply:[],compose:[],viewChanged:[],ajaxListRefresh:[],search:[]},pageREGEX:/p\d+/,getLiveView:function(){return this.view=this.getStoredView(this.hash.parts),this.view},getStoredView:function(e){return e&&e.length>0?e[0]:this.Constants.Inbox},checkAndTriggerInitialConversationView:function(){var e=i(".Bu .nH.if");e.length>0&&(this.executeObQueues("conversationThreadLoadedEvent",e),this._notifyConversationLoaded(e))},_notifyConversationLoaded:function(e){this._postNotification({eventName:"gmail.conversationThreadLoaded",sender:this,conversationElement:e})},waitingToLoad:!1,urlChangeChecker:null,setURL:function(t,n){this.waitingToLoad=!0;var i=this.currentMain,a=this;this.urlChangeChecker&&this.urlChangeChecker.destroy(),this.urlChangeChecker=r.repeatEvery(function(){e.BentoBox.UI.isBentoBoxView()&&e.BentoBox.UI.getCanvas().siblings().show();var r=a.getCurrentMain(!0);e.BentoBox.UI.isBentoBoxView()&&e.BentoBox.UI.getCanvas().siblings().hide(),i[0]!==r[0]&&(a.waitingToLoad=!1,a.urlChangeChecker.destroy(),a.urlChangeChecker=null,a.hashChangeLastID+=1,a.detectViewChange({fragment:t},1,a.hashChangeLastID),n&&n())},300,!0),location.hash="#"+t},detectViewChange:function(t,n,i){if(!this.waitingToLoad&&(n||(n=1),i||(i=1),i===this.hashChangeLastID)){var a=this,o=this.getCurrentMain(!0);if(o){this.view=null;{this.hash.partsString}if(this.hash.parts=[],this.hash.query=null,this.hash.partsString="",t.fragment){var s=t.fragment,l=s.indexOf("?");l>-1&&(this.hash.query=s.substring(l+1),s=s.substring(0,l));var u=s.split("/");if(this.hash.parts=u,this.hash.partsString=s,this.conversation=null,this.view=u[0],this.label=(this.view==this.Constants.Label||this.view==this.Constants.Search||this.view==this.Constants.Apps)&&u.length>1?u[1]:null,this.isCompose())this.view===this.Constants.Drafts&&u.length>1&&(this.conversation=r.last(u));else if(this.isInConversation())this.conversation=r.last(u);else if(this.isInContacts());else{var c=r.last(u);if(c&&16===c.length&&30>n)return this.isGmailView()&&e.BentoBox.UI.setGmailView(),void setTimeout(function(){a.detectViewChange(t,n+1,i)},300);this.conversation=null}}a.view||(a.view=a.Constants.Inbox),this.isListView()&&(this.rowThreadIconIndex=this.getCurrentMain().find("[gh=tl]").filter(":first").find("table colgroup col.yg").filter(":first").index()),a.executeObQueues("viewChanged",a.conversation?a.Constants.Conversation:a.view)}}},validateAndCorrectURLHash:function(){if(!this.hash.parts||!this.isURLHashValid()){this.hash.parts=[],this.hash.query=null,this.hash.partsString="";var e=location.hash.substring(1),t=e.indexOf("?");t>-1&&(this.hash.query=e.substring(t+1),e=e.substring(0,t));var n=e.split("/");this.hash.parts=n,this.hash.partsString=e}},isURLHashValid:function(){var e=location.hash;if(e.length>0){var t=e.indexOf("?");t>-1&&(e=e.substring(t))}return this.hash.partsString===e},isInConversation:function(){this.validateAndCorrectURLHash(),this.getCurrentMain(!0);var e=this.hash.parts;return e.length>1&&16===r.last(e).length||1===e.length&&e[0]===this.Constants.Sent?this.getCurrentMain().find(".gA.gt").filterOutInvisible().length>0&&this.getConversationSubjectHeader().length>0:!1},isInboxView:function(){return this.view===this.Constants.Inbox&&this.isListView()},isInSentConversation:function(){return this.isInConversation()&&1===this.hash.parts.length},isMaybeConversation:function(){return this.getCurrentMain().find(".gA.gt").filterOutInvisible().length>0&&this.getConversationSubjectHeader().length>0
},isInContacts:function(){return this.view===this.Constants.Contacts||this.view===this.Constants.Contact},getConversationSubjectHeader:function(){return this.getCurrentMain().find(".ha")},getConversation:function(){return this.getCurrentMain().find(".if")},getConversationMessageBodies:function(){return this.getConversation().find(".adP")},executeObQueues:function(t){if(this.isReady()){var i=this,a=Array.prototype.slice.call(arguments,1);if(i.ob_queues[t]){for(var o=[],s=r.clone(i.ob_queues[t]),l=h.event,u=h.event={},c=0;c<s.length;c++)try{var d=s[c].apply(i,a);d&&(d.then(null,n.bind(null,"async error in gmail observer queue")),o.push(d))}catch(f){e.BentoBox.logError("error in gmail observer queue",f)}h.event=l,e.RSVP.allSettled(o).then(function(){i.trigger("finishedExecuting_"+t,u)})}this.eventStreamBus.push({eventName:t,arguments:a})}},_postNotification:function(t){this.isReady()&&e.NotificationCenter.postNotification(t)},getConversationId:function(){return this.hash.parts&&this.hash.parts.length>0?r.last(this.hash.parts):null},getCurrentMain:function(e){var t=this,n=function(){if(t.elements.main||(t.elements.main=t.$("div[role=main]:first").closest(".ar4")),t.elements.mainParent||(t.elements.mainParent=t.$("div[role=main]:first").parent()),t.elements.mainParent.length>0)for(var e=t.elements.mainParent[0].children,n=0;n<e.length;n++){var r=e[n];if("main"===r.getAttribute("role")&&"none"!==r.style.display)return i(r)}return i(document.createElement("div"))};return(e||!this.currentMain)&&(this.currentMain=n()),this.currentMain},Settings:{getEndingMenuMarker:function(){return h.getCurrentMainContainer().find(".aeH .f2 .fY .dJ").first()},getContentBodyBlockContainer:function(){return h.getCurrentMainContainer().find(".AO .nH.f2.hCyPr")},getContentBodyBlock:function(){return h.getCurrentMainContainer().find(".AO .nH.f2.hCyPr>.nH")},getStreakSettings:function(){return h.getCurrentMainContainer().find(".AO .nH.f2.hCyPr>.streakSettings")},getSettingTabs:function(){return h.getCurrentMainContainer().find(".nH.fY>.fZ")}},getGearButton:function(){return h.getCurrentMainContainer().find(".aos").parent().filter("[role=button]").filterOutInvisible()},getGearButtonMenu:function(){return i("[role=menu]").filter(":FastVisible")},getSettingsMenuItem:function(){var e=this.getGearButtonMenu();return e.find(".aMS")},getCurrentMainContainer:function(){return this.elements.main},getCurrentMoreButton:function(){var e=i(h.$("div[gh=tm]")[0]);return e=e.find("[gh=mtb] div[role=button]"),e=e.filterOutInvisible(),e=e.filter(":not(.Bq)"),e=e.filter(":last")},_getCurrentMoreButtonMenu:function(){return e.$("div.J-M.aX0.aYO.jQjAxd")},isIconButtonModeActive:function(){return 0==i(".G-Ni > .T-I[role=button]:visible").eq(1).text().trim().length},getRightSide:function(){return this.getCurrentMain().find("table.Bs .Bu").filter(":last")},getLeftBar:function(){if(!this.elements.leftbar||!this.elements.leftbar.isVisible()){var e=this.$("div.oy8Mbf div[role=navigation]");e=e.filter(":FastVisible(noCompute)"),this.elements.leftbar=e.parents("div.oy8Mbf")}return this.elements.leftbar},getLeftbarLinks:function(){if(!this.getLeftBar().links||!this.getLeftBar().links.isVisible()){var e=this.getLeftBar().find("div[role=navigation] [title]");this.getLeftBar().links=i(e[0]).parents(".n3")}return this.getLeftBar().links},getInboxLink:function(){var e=this.getLeftbarLinks().find(".aim a[href*=#inbox]");return e.length>0?e.closest(".aim"):void 0},getSentMailLink:function(){var e=this.getLeftBar().find(".aim a[href*=#sent]");return e.length>0?e.closest(".aim"):void 0},getComposeButton:function(){return this.$("[gh=cm]")},isConversationViewDisabled:function(){return this.gmonkey.isConversationViewDisabled()},isListView:function(){return this.isPreviewPane()?this.Constants.ListViews.indexOf(this.view)>-1&&i("[gh=tl]").isVisible():this.Constants.ListViews.indexOf(this.view)>-1&&!this.isConversation()&&!this.isCompose()},isConversation:function(){return this.isInConversation()},isConversationVisible:function(){return this.isPreviewPane()?!!this.getPreviewedRow():this.isConversation()},isGmailView:function(){return r.values(this.Constants.ListViews).indexOf(this.view)>-1},isContacts:function(){return this.view==this.Constants.Contacts},isSearch:function(){return(this.view==this.Constants.Search||this.view==this.Constants.Apps)&&!this.isConversation()},isCompose:function(){return this.view==this.Constants.Compose||this.view==this.Constants.Drafts&&0===this.getCurrentMoreButton().length},isDrafts:function(){return this.view==this.Constants.Drafts},getMainList:function(){for(var e=this.getCurrentMain().find("[gh=tl]"),t=0;t<e.length;t++){var n=i(e[t]).parents("[role=main]").length;if(1===n)return i(e[t])}return null},getListRows:function(e){for(var t=[],n=e.find("tr.zA"),r=0;r<n.length;r++)t.push(this.convertHTMLRowToObject(i(n[r]),r));return t},convertHTMLRowToObject:function(e,t){var n={type:this.getPreviewPaneSettings(),node:e,rowIndex:t,rowNode:e,getList:function(){return list},checked:e.find("input[type=checkbox]:checked, div[role=checkbox][aria-checked=true]").length>0};n.subjectLink=n.rowNode.find("[role=link]"),n.checkbox=n.rowNode.find("input[type=checkbox], div[role=checkbox]").parent(),"horizontal"===n.type&&(n.checked=n.checked||n.rowNode.hasClass("aps"),n.previewed=n.rowNode.hasClass("aps")),e.find("td.apU").length>0&&(n.starHolder=e.find("td.apU")),n.labelContainer=n.rowNode.find(".xT"),n.attachmentsContainer=n.rowNode.find(".yf"),n.date=n.rowNode.find("td:last");try{n.isUnread=n.subjectLink.find(".y6 span").filter(":first")[0].innerHTML.indexOf("<b>")>-1}catch(i){}return n},getVerticalListRows:function(e){var t=[],n=[],r=e.find("tr.zA"),a=0,o=function(){if(n.length>0){var r={type:"vertical",node:n,rowIndex:a++,rowNode:n[0],getList:function(){return e}};r.previewed=r.rowNode.hasClass("aps"),r.checked=r.previewed||r.rowNode.find("input[type=checkbox]:checked, div[role=checkbox][aria-checked=true]").length>0;for(var o=0;o<n.length;o++){var s=n[o],l=i(s);l.find(".apu").length>0&&(r.labelContainer=l.find(".apu")),l.find("[role=link]").length>0&&(r.subjectLink=l.find("[role=link]")),l.find("td.apU").length>0&&(r.starHolder=l.find("td.apU"))}r.isUnread=r.subjectLink.find(".y6 span").filter(":first")[0].innerHTML.indexOf("<b>")>-1,r.date=r.rowNode.find(".apt"),t.push(r),n=[]}};if(this.cachedVerticalList)for(var s=0;s<this.cachedVerticalList.length;s++){var l=this.cachedVerticalList[s].rowNode;this.cachedVerticalList[s].previewed=l.hasClass("aps"),this.cachedVerticalList[s].checked=this.cachedVerticalList[s].previewed||l.find("input[type=checkbox]:checked, div[role=checkbox][aria-checked=true]").length>0,this.cachedVerticalList[s].type="vertical"}else{for(var u=0;u<r.length;u++){var c=i(r[u]);c.find("[role=checkbox]").length>0&&o(),n.push(c)}o(),this.cachedVerticalList=t}return this.cachedVerticalList},getActiveHexGmailThreadIdList:function(e){var t,n;if(this.isListView())if(this.isPreviewPane()){var i=this.getPreviewedRow();if(i){if(n=this.getHexGmailThreadIdFromGmonkeyThread())return[e.getThreadIdForMessageId(n)];t=[i]}else t=this.getSelectedThreadRows()}else if(this.isMaybeConversation()){if(n=this.getHexGmailThreadIdFromGmonkeyThread())return[e.getThreadIdForMessageId(n)]}else t=this.getSelectedThreadRows();else{if(this.isConversationVisible()||this.isInConversation()){var r=this.getConversationId();return"sent"===r?this.getHexGmailThreadIdListFromSentConversation():[r]}if(this.isMaybeConversation()&&(n=this.getHexGmailThreadIdFromGmonkeyThread()))return[e.getThreadIdForMessageId(n)]}return this.isListView()?e.getHexGmailThreadIdList(t):[]},getHexGmailThreadIdListFromSentConversation:function(){var t=this.getHexGmailThreadIdFromGmonkeyThread();return t?[t]:[e.BentoBox.Services.Threads.SentEmailsMetaDataManager.getLastSentThreadMetaData().hexGmailThreadId]},getHexGmailThreadIdFromGmonkeyThread:function(){var e=this.gmonkey.getCurrentThread();return e?e.getThreadId():null},getThreadDOMRows:function(){return this.getVisibleThreadRows()},getVisibleThreadRows:function(e){var t=this.getCurrentMain(e).find("[gh=tl]");if(0===t.length)return[];if(this.isListView()){for(var n=[],r=0;r<t.length;r++){var a=i(t[r]);n=n.concat(t[r].getAttribute("class").has("aia")?a.find(".nn").length>0?this.getVerticalListRows(a):this.getListRows(a,"horizontal"):this.getListRows(a))}return n}return[]},getCheckboxesForCheckedRows:function(){return this.getCurrentMain().find("[gh=tl] .aDM .x7 td.aid")},getSelectedThreadRows:function(){return this.getVisibleThreadRows().filter(function(e){return e.checked})},getPreviewedThreadDOMRow:function(){return this.getPreviewedRow()},getPreviewedRow:function(){var e=this.getVisibleThreadRows().filter(function(e){return e.previewed});return e.length>0?e[0]:void 0},getActiveViewLink:function(){return this.getLeftbarLinks().find(".nZ")},getToolbarButtons:function(){var e=this.getCurrentMainContainer().find("[role=navigation] div[role=button]");return e.filterOutInvisible()},getListToolbarContainer:function(){return this.$("[gh=tm]")},getSendButton:function(){return i(this.getToolbarButtons()[0])},getSaveButton:function(){return i(this.getToolbarButtons()[1])},getDiscardButton:function(){return i(this.getToolbarButtons()[2])},getArchiveButton:function(){return this.$("div[gh=tm]").find("div[gh=mtb] div[role=button]").filter("[act=7]")},getDeleteButton:function(){return this.$("div[gh=tm]").find("div[gh=mtb] div[role=button]").filter("[act=10]")},getMoveAndLabelDropdownButtons:function(){return this.$("div[gh=tm]").find("div[gh=mtb] div:not(.G-as3):not(.streak__gmailIconArrowButtonType)[role=button]").filter(".ns, .mw")},getDiscardDraftsButton:function(){return i(this.$("div[gh=tm]").find("div[gh=mtb] div[role=button]")[1])},getGooglePlusNameContainer:function(){return i("#gbsfw").parent().parent().children("div").first()},getProfilePictureLink:function(){return i("[guidedhelpid=gbacsw]")},getProfilePictureLinkContainer:function(){return this.getProfilePictureLink().parent().parent()},getThemeLoaded:function(){try{var e=JSON.stringify(GLOBALS),t=e.indexOf("sx_skcs");if(t>-1){var n=e.substring(t-2,e.indexOf("]",t)+1);return JSON.parse(n)[1]}}catch(i){}return"unknown"},getEnabledLabs:function(){try{var e=r.filter(GLOBALS[17][6][1],function(e){return e[0].indexOf("lab")>-1&&"1"==e[1]?!0:void 0});return r.pluckPlus(e,function(e){return e[0]})}catch(t){}return""},isOldUI:function(){try{var e=JSON.stringify(GLOBALS),t=e.indexOf("sx_sd");if(t>-1){var n=e.substring(t-2,e.indexOf("]",t)+1);return"classic"==JSON.parse(n)[1]}}catch(i){}return!1},isGooglePlusEnabled:function(){return this.$("#gbi4i").length>0},getPreviewPaneSettings:function(){return this.currentPreviewPaneSettings},getFreshPreviewPaneSettings:function(){var e="classic";return this.getPreviewPaneLoaded()&&(this.isVerticalSplitPreviewPane()?e="vertical":this.isHorizontalSplitPreviewPane()&&(e="horizontal")),this.currentPreviewPaneSettings!=e&&(this.currentPreviewPaneSettings=e,this.executeObQueues("previewPaneChanged",e)),e},getPreviewPaneLoaded:function(){var e=this.getMainList();return e?e[0].getAttribute("class").has("aia"):!1},getSearchContainer:function(){return this.elements.searchContainer||(this.elements.searchContainer=this.$("[gh=sb]")),this.elements.searchContainer},getSearchInput:function(){return this.elements.search.input||(this.elements.search.input=this.$("[gh=sb] input"),this.elements.search.input.length>1&&(this.elements.search.input=this.elements.search.input.filter("#gbqfq"))),this.elements.search.input},getSearchButton:function(){return this.getSearchContainer().closest("form").find("button")},getSearchAutoComplete:function(){return this.elements.search.autoComplete=this.$(".U5"),this.elements.search.autoComplete&&0!==this.elements.search.autoComplete.length||(this.elements.search.autoComplete=this.$(".gstl_0.gssb_c, #gbw .gscs_a")),this.elements.search.autoComplete},getKeyboardHelp:function(){return this.$(".wa")},getReplyButtons:function(e){for(var t=e.find("[role=navigation]"),n=[],r=[],a=[],o=0;o<t.length;o++){var s=i(t[o]).find("div[role=button]");n.push(s.filter(".nS")),r.push(s.filter(".nQ")),a.push(s.filter(".lX"))}return{send:n,save:r,discard:a}},getEditableArea:function(e){var t=e.find("iframe.editable"),n=t.length>0?i(t[0].contentDocument).find("body.editable"):null,r=(t.length>0?t[0].contentWindow:null,h.getCurrentMain());t=r.find("form .At textarea");var a=t.length>0?i(t[0]):null;return a&&a.isVisible()?a:n?n:void 0},getCurrentOpenEmailMessages:function(){for(var e=this.getCurrentMain().find(".Bk"),t=[],n=0;n<e.length;n++){var r=i(e[n]).parent();r.hasClass("h7")&&t.push(r)}return i(t)},isPreviewPane:function(){return"classic"!==this.currentPreviewPaneSettings},isPreviewPaneConversation:function(){return this.isPreviewPane()&&this.isListView()},isVerticalSplitPreviewPane:function(){return this.getPreviewPaneLoaded()?this.getMainList().find(".nn").length>0:!1},isHorizontalSplitPreviewPane:function(){return this.getPreviewPaneLoaded()?0===this.getMainList().find(".nn").length:!1},isTabbedInbox:function(){return i(".aKh").length>0},setupComposeHolderResizeEvents:function(){function n(){for(var e=0;e<r.elementsInComposeArea.length;e++){var t=r.elementsInComposeArea[e];t.show();var n=t.offset();n.left<5&&t.hide()}}var r=this;i(t).resize(function(){for(var e=i(document).height()+"px",t=[],n=0;n<r.elementsInComposeArea.length;n++){var a=r.elementsInComposeArea[n];a.find(".streak__inComposeArea").length>0&&(a[0].style.height=e,t.push(a))}r.elementsInComposeArea=t}),e.NotificationCenter.subscribe({eventName:"newComposeWindow",functionToCall:n,observer:this}),e.NotificationCenter.subscribe({eventName:"composeWindowRemoved",functionToCall:n,observer:this})},addToComposeArea:function(e,t){var n=i(".dw .no > div.nn:first").parent(),r=i(document.createElement("div"));r[0].style.width=t+"px",r[0].style.height=n.parent().height()+"px",r[0].setAttribute("class","nH nn streak__composeItemWrapper");var a=i(document.createElement("div"));return a[0].setAttribute("class","Hd no"),r.append(a),a.append(e),e.addClass("streak__inComposeArea"),n.prepend(r),this.elementsInComposeArea.push(r),r},getComposeWindowContainerElement:function(){return i(".dw .no > div.nn:first").parent()},removeFromComposeArea:function(e){this.elementsInComposeArea.removeVal(e),e.detach()},readdToComposeArea:function(e){i(".dw .no > div.nn:first").before(e),this.elementsInComposeArea.push(e)},hideComposeLayer:function(){i(".dw").hide(),i(".Wk").hide()},unhideComposeLayer:function(){i(".dw").show(),i(".Wk").show()},triggerListRefresh:function(){this.$("[gh=mtb] [act=20]").simulateRawClick()},widgets:{getDeleteIcon:function(){var e=i(document.createElement("div"));return e.addClass("ar9 G8oNDd tk3N6e-I-J3 J-J5-Ji"),e[0].setAttribute("style","vertical-align: middle; padding-top:2px; width: 16px;"),e},getSettingsIcon:function(){var e=i(document.createElement("div"));return e.addClass("aos"),e},getLabelTag:function(e,t,n){var r=i("<div/>");return r.addClass("ar as"),r.html(l.underscore("core/gmail/labelTag")({text:e,groupcolor:t,textcolor:n})),r},getCheckbox:function(e,t,n){var r=i("<div/>").addClass("gmailCheckbox").attr("tabindex",0),a=i("<div/>").addClass("oZ-jc T-Jo J-J5-Ji"),o=i("<div/>").addClass("T-Jo-auh"),s=!1,l=function(){s||(a.toggleClass("T-Jo-Jp"),r.prop("checked",a.hasClass("T-Jo-Jp")),r.trigger("change"))};return r.append(a),a.append(o),e&&e.length>0&&r.append(i("<span/>").text(e)),a.easyHoverClass("T-Jo-JW"),t&&(a.addClass("T-Jo-Jp"),r.prop("checked",!0)),n||(r.mousedown(function(e){e.preventDefault()}),r.click(function(e){e.stopPropagation(),l()}),r.keydown(function(e){(13===e.which||32===e.which)&&(e.stopPropagation(),e.preventDefault(),l())})),r.setChecked=function(e){return e=e?!0:!1,a.toggleClass("T-Jo-Jp",e),r.prop("checked",a.hasClass("T-Jo-Jp"))},r.isChecked=function(){return r.prop("checked")===!0},r.enable=function(){s=!1,r.removeClass("disabled")},r.disable=function(){s=!0,r.addClass("disabled")},r.setEnabled=function(e){e?r.enable():r.disable()},r},getLabelActionTag:function(e){var t={backgroundColor:"rgb(221, 221, 221)",textColor:"rgb(102, 102, 102)",labelText:null,labelHelpText:null,labelCallback:i.noop,xHelpText:null,xCallback:i.noop},n={};i.extend(n,t,e);var r=i("<span/>");return r.addClass("J-J5-Ji"),r.html(l.underscore("core/gmail/labelActionTag")(n)),r.find(".bb_labelActionTag").hover(function(){i(this);i(this).css({backgroundColor:n.textColor,color:n.backgroundColor})},function(){i(this);i(this).css({backgroundColor:n.backgroundColor,color:n.textColor})}),r.reset=function(){r.find(".hM").css({backgroundColor:n.backgroundColor,color:n.textColor})},r.find(".hU").click(n.labelCallback),r.find(".hV").click(n.xCallback),r},getInlineNotice:function(e,t){var n=i('<div class="ya yb"></div>');return n[0].innerHTML=e,r.isArray(t)&&r.each(t,function(e){var t=i('<span class="x8" role="link"></span>');t[0].innerHTML=e.text,t.click(function(t){e.callback&&(e.callback(t),t.stopPropagation())}),n.append(t)}),n}}}),e.DependencyManager.addFunction({functionKey:"gmailLoaded",functionToCall:h.init,functionContext:h}),e.DependencyManager.addFunction({functionKey:"gmail.bindWatchers",functionToCall:h.bindWatchers,functionContext:h,dependentFunctionKeys:["gmailLoaded"]}),e.Gmail=h}(Streak,window);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager;var c=e.Class.subclass({className:"RFCMessageIdExtractor",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getRFCMessageIdForThread:function(t,n){r.GmailRequester.get({view:"om",th:t}).getPromise().then(function(t){var i;try{i=d(t)}catch(r){}if(i){n(i);return}e.BentoBox.logError("extracting messageId\n"+t);n()},function(){e.BentoBox.logError("rfc message id request failed");n()})}});function d(e){if(!e){return}var t=e.split(/\r|\n/);if(t.length===1){return}var i=n.filter(t,function(e){return e.match(/^\s*Message-ID:\s*\</i)});if(i.length!==1){return}var r=i[0].split(":");if(r.length<2){return}return r[1].trim()}r.RFCMessageIdExtractor=new c})(Streak);(function(e){var t=e._,n=e.$,i=e.Gmail;var r=function(){this._composeWindows=[];this._attachmentMap={};this._sentComposeWindows=[];this._detectNewComposeWindows();this._detectDraftSaving();this._detectMinimizedWindows();this._detectSentEmailMetaDataRetrieved()};r.prototype=Object.create(e.ViewControllerBase.prototype);t.extend(r.prototype,{getComposeWindows:function(){return this._composeWindows},_detectNewComposeWindows:function(){var e=this;i.inboxSDK.Compose.registerComposeViewHandler(this._processNewComposeWindow.bind(this))},_processNewComposeWindow:function(t){if(t.isInlineReplyForm()){return}var n=new i.GmailComposeWindowViewController;n.setComposeView(t);this._composeWindows.push(n);e.NotificationCenter.postNotification({eventName:"newComposeWindow",composeWindowController:n,sender:this});var r=this;t.on("sent",function(){r._sentComposeWindows.push(n)});t.on("destroy",function(){r._findAndHandleRemovedComposeWindows(n)})},_findAndHandleRemovedComposeWindows:function(t){this._composeWindows.removeVal(t);e.NotificationCenter.postNotification({eventName:"composeWindowRemoved",sender:this});if(this._sentComposeWindows.indexOf(t)===-1){t.destroy()}},_detectDraftSaving:function(){var t=this;i.observe("draftSaved",function(n,i,r){setTimeout(function(){e.NotificationCenter.postNotification({eventName:"draftSaved",composeid:r,draftId:i,sender:t})},1)})},_detectMinimizedWindows:function(){var e=[];var t=this;i.addTimerObserver(function(){for(var n=0;n<t._composeWindows.length;n++){var i=t._composeWindows[n];if(i.isMinimized()){if(e.indexOf(i.getComposeid())===-1){e.push(i.getComposeid());i.notifyMinimized()}}else{if(e.indexOf(i.getComposeid())>-1){e.removeVal(i.getComposeid());i.notifyRestored()}}}},500)},_detectSentEmailMetaDataRetrieved:function(){e.NotificationCenter.subscribe({eventName:"allMetaDataRetrievedForCompose",observer:this,functionToCall:this._handleAllMetaDataRetrieved})},_handleAllMetaDataRetrieved:function(e){var t=this._getSentComposeWindowController(e.composeid);if(t){t.sentEmailThreadMetaDataFound(e.threadMetaData);t.destroy()}},_getSentComposeWindowController:function(e){var t=null;var n;for(var i=0;i<this._sentComposeWindows.length;i++){n=this._sentComposeWindows[i];if(n.getComposeid()===e){t=n;break}}if(!t){for(var i=0;i<this._composeWindows.length;i++){n=this._composeWindows[i];if(n.getComposeid()===e){t=n;break}}}return t}});e.DependencyManager.addFunction({functionKey:"gmailComposeWindowMasterControllerInitialized",functionReference:function(){i.GmailComposeWindowMasterController=new r},dependentFunctionKeys:["gmailLoaded","localeLoaded"]})})(Streak);(function(e){var t=e._,n=e.jQuery,i=e.jwerty,r=e.Gmail;var a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var o=4;var s=function(){e.ViewControllerBase.call(this);this._jQueryNode=null;this._composeView=null;this._storedDraftId=null;this._composeid=null;this._viewControllers=[];this._unbinders=[];this._toolbarBeforeFormattingViewControllers=[];this._sendButtonAreaViewControllers=[];this._tabUnbinders=[];this._eventListeners=[];this._internalSidebar=null;this._externalSidebar=null;this._externalSidebarCSSRule=null;this._externalSidebarViewController=null;this._additionalAreas={};this._characterSequenceController=null;this._setupTimeout=null;this._lastSubjectPosition=null;this._elementOfLastFocus=null;this._activeModules=[];this._moduleStorage={};this._attachmentMutationObserver=null};s.prototype=Object.create(e.ViewControllerBase.prototype);t.extend(s.prototype,{setComposeView:function(e){this._composeView=e;this._jQueryNode=n(e._composeViewImplementation.getElement());this._setComposeid();this._bindToComposeEvents();this._setupKeyboardEvents();this._bindToEmailContentChanges();this._startWatchingAttachments()},getComposeView:function(){return this._composeView}});t.extend(s.prototype,{isReady:function(){return this.getEditor().length>0&&this.getSendButton().length>0},getMinimizeButton:function(){return n(this._jQueryNode.find(".Hm > img")[0])},getPopOutButton:function(){return n(this._jQueryNode.find(".Hm > img")[1])},getCloseButton:function(){return n(this._jQueryNode.find(".Hm > img")[2])},getEditor:function(){if(!this._jQueryNode){return}return this._jQueryNode.find(".Ap [g_editable=true]")},getComposeBodyHTML:function(){var e=this.getEditor();if(!e||e.length===0){return""}var t=e[0].innerHTML;if(t.indexOf('"gmail_extra')>-1){t=t.replace(/\r|\n/,"").replace(/<div class\=\"gmail_extra\">.*/gim,"<div>")}return t},getSelectedBodyText:function(){this.getEditor().focus();var e="";if(window.getSelection){e=window.getSelection().toString()}else if(document.selection&&document.selection.type!="Control"){e=document.selection.createRange().text}return e},getSubjectInput:function(){return this._jQueryNode.find("input[name=subjectbox]")},getThreadMetaData:function(){var e={};e.threadGmailId=this.getDraftId();e.subject=this.getSubject();e.timeString="";e.emailString="";e.names=[];e.emailAddresses=[];var t=this.getToContacts();for(var n=0;n<t.length;n++){var i=t[n];e.emailAddresses.push(i.emailAddress);if(i.name){e.names.push(i.name)}else{e.names.push(null)}}return e},getSubject:function(){return this.getSubjectInput().val()},getHiddenDraftValue:function(){return this._getFormFieldValue("uet")},getSendButton:function(){return this._jQueryNode.find(".IZ").find(".Up > div > [role=button]")},getDiscardButton:function(){return this._jQueryNode.find(".gU.az5 .oh")},getContactRows:function(){return this._jQueryNode.find(".GS tr")},getToEmailAddresses:function(){return t.map(this.getToContacts(),function(e){return e.emailAddress})},getToContacts:function(){var e=[];var t=this._jQueryNode.find("span.vN[email]");for(var n=0;n<t.length;n++){var i={emailAddress:t[n].getAttribute("email")};if(t[n].innerText!==i.emailAddress){i.name=t[n].innerText}e.push(i)}return e},getCCContacts:function(){var e=this.getContactRows();var t=n(e[1]);return this._extractPeopleContacts(t)},getBCCContacts:function(){var e=this.getContactRows();var t=n(e[2]);return this._extractPeopleContacts(t)},_extractPeopleContacts:function(e){var t=[];var n=this._jQueryNode.find("span.vN[email]");for(var i=0;i<n.length;i++){var r={emailAddress:n[i].getAttribute("email")};if(n[i].innerText!==r.emailAddress){r.name=n[i].innerText}t.push(r)}return t},getFromAddress:function(){var t=this._jQueryNode.find(".GS tr");var i=n(t[3]);var r=i.find("span");if(r.length===0){return e.BentoBox.getUser().getEmail()}var a=e.Utils.extractEmailAddresses(r.text());if(a.length===0){return e.BentoBox.getUser().getEmail()}return a[0]},getElement:function(){return this._jQueryNode},isAttachedToBody:function(){return this._jQueryNode.is(":inBody")},getDraftId:function(){var e=this._getFormFieldValue("draft");if(!e||e==="undefined"){e=this._storedDraftId}return e},getComposeid:function(){return this._composeid},getAddressesContainer:function(){return this._jQueryNode.find(".fX")},getExtraRecipientsContainer:function(){return this._jQueryNode.find(".aA6 > span > span, .ow > span > span").first()},getAttachmentDOMElements:function(){return this._jQueryNode.find(".dL")},getStatusTextArea:function(){return this._jQueryNode.find(".aWQ")},hasAttachments:function(){return this.getAttachmentDOMElements().length>0},isMinimized:function(){return this._jQueryNode&&this._jQueryNode.children().filter("[style*=none]:not(.streak__compose_externalSidebar_wrapper)").length>0},getInsertLinkButton:function(){return this._jQueryNode.find(".e5.aaA.aMZ")},getAttachFilesButton:function(){return this._jQueryNode.find(".a1")},getInsertDriveFileButton:function(){return this._jQueryNode.find(".aA7")},getInsetPhotoButton:function(){return this._jQueryNode.find(".a2X")}});t.extend(s.prototype,{minimize:function(){this.getMinimizeButton().simulateRawClick()},restore:function(){this.getMinimizeButton().simulateRawClick()},popOut:function(){this.getPopOutButton().simulateRawClick()},close:function(){this.getCloseButton().simulateRawClick()},send:function(){this.getSendButton().simulateRawClick()},discard:function(){this.getDiscardButton().simulateRawClick()},clearAttachments:function(){this.getAttachmentDOMElements().find("[role=button], [role=link]").simulateRawClick()},destroy:function(){clearTimeout(this._setupTimeout);for(var n=0;n<this._viewControllers.length;n++){this._viewControllers[n].destroy()}for(var n=0;n<this._unbinders.length;n++){if(t.isFunction(this._unbinders[n])){this._unbinders[n]()}}for(var n=0;n<this._tabUnbinders.length;n++){if(t.isFunction(this._tabUnbinders[n])){this._tabUnbinders[n]()}}this._viewControllers.length=0;this._sendButtonAreaViewControllers.length=0;this._toolbarBeforeFormattingViewControllers.length=0;this._unbinders.length=0;this._tabUnbinders.length=0;if(this._characterSequenceController){this._characterSequenceController.destroy();this._characterSequenceController=null}if(this._additionalAreas){for(var i in this._additionalAreas){var r=this._additionalAreas[i];if(r){r.remove()}this._additionalAreas[i]=null}this._additionalAreas=null}for(var n=0;n<this._eventListeners.length;n++){this._removeEventListener(this._eventListeners[n])}if(this._toolbarOverflowButton){this._toolbarOverflowButton.destroy()}this._jQueryNode=null;e.NotificationCenter.unsubscribe({observer:this});e.ViewControllerBase.prototype.destroy.call(this)},hide:function(){this._jQueryNode.hide()},unhide:function(){this._jQueryNode.show()},isDestroyed:function(){return this._jQueryNode===null}});t.extend(s.prototype,{addViewControllers:function(e){t.mutate("union",this._viewControllers,e);t.mutate("union",this._delegates,e);if(!this.isReady()){var n=this;clearTimeout(this._setupTimeout);this._setupTimeout=setTimeout(function(){n.addViewControllers([])},100);return}for(var i=0;i<e.length;i++){e[i].initialize(this)}this._callDelegateFunction("allModificationsInitialized");var r=this._getFormattingAreaOffsetLeft();for(var i=0;i<e.length;i++){this._processModifierViewController(e[i]);this._processListenerViewController(e[i])}this._updateInsertMoreAreaLeft(r)},addViewControllersAfterReady:function(e){t.mutate("union",this._viewControllers,e);t.mutate("union",this._delegates,e);for(var n=0;n<e.length;n++){e[n].initialize(this)}this._callDelegateFunction("allModificationsInitialized");var i=this._getFormattingAreaOffsetLeft();for(var n=0;n<e.length;n++){this._processModifierViewController(e[n]);this._processListenerViewController(e[n])}this._updateInsertMoreAreaLeft(i)},_processModifierViewController:function(e){if(!e){return}if(!e.shouldProcessModification||!e.shouldProcessModification()){return}e.aboutToProcessModification();switch(e.getModificationType()){case"ADD_ELEMENT":this._handleAddElementModifier(e);e.justAdded();break}},_handleAddElementModifier:function(e){switch(e.getModificationArea()){case"BOTTOM_TOOLBAR":this._addElementToBottomToolbar(e);break;case"BOTTOM":this._addElementToBottom(e);break;case"INTERNAL_SIDEBAR":this._addInternalSidebar(e);break;case"EXTRA_RECIPIENTS":this._addElementToExtraRecipients(e);break;case"RECIPIENTS_OVERLAY":this._addElementAsRecipientsOverlay(e);break;case"NEW_RECIPIENT_ROW":this._addElementAsNewRecipientRow(e);break;case"EXTERNAL_SIDEBAR":this._addExternalSidebar(e);break}},reloadModification:function(e){if(!e){return}var t=this._getFormattingAreaOffsetLeft();this._undoModification(e);this._processModifierViewController(e);this._updateInsertMoreAreaLeft(t)},_undoModification:function(e){switch(e.getModificationType()){case"ADD_ELEMENT":this._handleUndoAddElement(e);break}},_handleUndoAddElement:function(e){switch(e.getModificationArea()){case"BOTTOM":this._detachElementFromBottom(e);break;case"BOTTOM_TOOLBAR":this._detachElementFromBottomToolbar(e);break;case"INTERNAL_SIDEBAR":this._removeInternalSidebar(e);break;case"EXTERNAL_SIDEBAR":this._removeExternalSidebar(e);break;case"EXTRA_RECIPIENTS":this._detachElementFromExtraRecipients(e);break;case"RECIPIENTS_OVERLAY":this._detachElementAsRecipientsOverlay(e);break;case"NEW_RECIPIENT_ROW":this._detachElementAsNewRecipientRow(e);break}},_addElementToSendButtonArea:function(e){var t=e.getModificationElement();if(!t){return}this.getSendButton().after(t);this._sendButtonAreaViewControllers.push(e)},_addElementToBottom:function(e){var t=e.getModificationElement();if(t.parents().filter(this._getToolbarArea()[0]).length>0){return}this._getToolbarArea().append(t);if(!e.shouldModificationAdjustHeight||!e.shouldModificationAdjustHeight()){return}var n=t.height();var i=this._getToolbarArea().height();this._getToolbarArea().height(i+n);t.height(n)},_detachElementFromBottom:function(e){var t=e.getModificationElement();if(!t){return}if(!t.is(":inBody")){return}if(e.shouldModificationAdjustHeight&&e.shouldModificationAdjustHeight()){var n=t.height();var i=this._getToolbarArea().height();this._getToolbarArea().height(i-n)}t.detach()},_addElementToBottomToolbar:function(e){switch(e.getModificationPlacement()){case"BEFORE_FORMATTING":this._addElementToBottomToolbarBeforeFormatting(e);break;case"SEND_BUTTON":this._addElementToSendButtonArea(e);break;case"STATUS_AREA":this._addElementToStatusArea(e);break}},_detachElementFromBottomToolbar:function(e){if(e.getModificationPlacement()==="STATUS_AREA"){this._detachElementFromStatusArea(e);return}var t=e.getModificationElement();if(!t){return}var n=t.is(":inBody");var i=n&&this._getFormattingAreaOffsetLeft();t.detach();if(n){this._updateInsertMoreAreaLeft(i);this._toolbarBeforeFormattingViewControllers.removeVal(e)}},_addElementToExtraRecipients:function(e){var t=e.getModificationElement();if(!t){return}var n=this.getExtraRecipientsContainer();n.prepend(t);var i=this._jQueryNode.find("[name=to]");var r=this._jQueryNode.find(".__streak_mainMMLink");i.width(i.width()-r.width())},_detachElementFromExtraRecipients:function(e){var t=e.getModificationElement();if(!t){return
}t.detach()},_addInternalSidebar:function(e){var t=e.getModificationElement();if(!t){return}this._addPadding();this._jQueryNode.find(".I5").append(t);var n=this._jQueryNode.find(".aoD").css("border-bottom-color");t.css({borderLeft:"1px solid "+n,borderBottom:"1px solid "+n});this._jQueryNode.find(".aDg, .aDl").css("z-index","1");this._internalSidebar=e;this._internalSidebar.getFirstTabFocusElement().focus()},_removeInternalSidebar:function(){if(!this._internalSidebar){return}this._internalSidebar.getModificationElement().remove();this._internalSidebar=null;this._removePadding()},_addExternalSidebar:function(t){var i=t.getModificationElement();if(!i){return}this._externalSidebar=n(document.createElement("div"));this._externalSidebar.addClass("streak__compose_externalSidebar_wrapper");var r=n(document.createElement("div"));r.addClass("streak__compose_externalSidebar_header");this._externalSidebar.append(r);var a=n(document.createElement("div"));a.addClass("streak__compose_externalSidebar_body");this._externalSidebar.append(a);var o=n(document.createElement("div"));o.addClass("streak__compose_externalSidebar_footer aDh");this._externalSidebar.append(o);r.append(t.getModificationTitle());a.append(i);this._jQueryNode.append(this._externalSidebar);this._externalSidebarCSSRule=e.CSSStyleManipulator.addRule(".aSs > div { width: 50% !important; margin-left: 30%; }",0);if(t.getWidth){var s=t.getWidth();this._externalSidebar.width(s);this._externalSidebar.css("left",-1*(s+1))}this._externalSidebarViewController=t},_removeExternalSidebar:function(e){if(!this._externalSidebar||this._externalSidebarViewController!==e){return}this._externalSidebar.remove();this._externalSidebarCSSRule.stylesheet.removeRule(this._externalSidebarCSSRule.rule)},_addElementAsRecipientsOverlay:function(e){var t=e.getModificationElement();if(!t){return}this._jQueryNode.find("form > div").first().css({height:e.getModificationHeight()});this._jQueryNode.find(".aoD.hl").css({height:e.getModificationHeight()});this._jQueryNode.find(".nH .aaZ").append(t)},_detachElementAsRecipientsOverlay:function(e){var t=e.getModificationElement();if(!t){return}this._jQueryNode.find("form > div").first().css("height","");this._jQueryNode.find(".aoD.hl").css("height","");t.detach()},_addElementAsNewRecipientRow:function(e){var t=e.getModificationElement();if(!t){return}var i=n(document.createElement("tr"));var r=n(document.createElement("td"));var a=n(document.createElement("td"));i.append(r);i.append(a);i.addClass("streak__recipientRow");a.append(t);this.getAddressesContainer().find("tbody").append(i)},_detachElementAsNewRecipientRow:function(e){var t=e.getModificationElement();if(!t){return}var n=t.closest("row.streak__recipientRow");t.detach();n.remove()},addTextAtCurrentCursorPosition:function(e,n){if(!this._elementOfLastFocus){this._elementOfLastFocus="EDITOR"}if(this._elementOfLastFocus==="EDITOR"){this.getEditor().insertHTMLAtCaret(e)}else if(this._elementOfLastFocus==="SUBJECT"){var i=0;if(t.isReal(this._lastSubjectPosition)){i=this._lastSubjectPosition}var r=this.getSubject();r=r.insert(n||e,this._lastSubjectPosition);this.setSubject(r)}this._callDelegateFunction("emailBodyChanged",this.getComposeBodyHTML());this._callDelegateFunction("subjectChanged",this.getSubject())},replaceLastNCharacters:function(e,t){this.getEditor().deleteText(e);this.addTextAtCurrentCursorPosition(t)},addElementAtCursorPosition:function(e){r.elements.body.append(e);var t=this._getCaretPosition();var n=this.getEditor().css("font-size");var i=parseInt(n,10)*1.5;e.css({top:t.top+i,left:t.left,position:"fixed"});this.getEditor().containRelativeElement(e,0,i)},notify:function(e){this._callDelegateFunction.apply(this,[e].concat(t.toArray(arguments).slice(1)))},notifyMinimized:function(){if(this._externalSidebar){this._externalSidebar.hide()}},notifyRestored:function(){if(this._externalSidebar){this._externalSidebar.show()}},setModuleActive:function(e){if(this._activeModules.indexOf(e)>-1){return}this._activeModules.push(e);this.notify("activeModulesChanged",this._activeModules)},setModuleInactive:function(e){if(this._activeModules.indexOf(e)===-1){return}this._activeModules.removeVal(e);this.notify("activeModulesChanged",this._activeModules)},getActiveModules:function(){return this._activeModules},setModuleStorageValue:function(e,t){this._moduleStorage[e]=t;this.notify("moduleStorageValueChanged",e,t)},getModuleStorageValue:function(e){return this._moduleStorage[e]}});t.extend(s.prototype,{setToAddresses:function(e){if(typeof e==="string"){e=[e]}this._jQueryNode.find(".vO").html(e.join(","))},setSubject:function(e){this.getSubjectInput().val(e);this._getFormField("subjectbox").val(e);this._callDelegateFunction("subjectChanged",this.getSubject())},setEmailBody:function(e){this._getFormField("body").val(e);this.getEditor()[0].innerHTML=e},removeSelectorFromBody:function(e){this.getEditor().find(e).remove()},addHTMLToBodyBeforeQuotedText:function(e){if(this._isThereQuotedText()){this._addHTMLBeforeQuotedText(e)}else{this.addHTMLAtEndOfBody(e)}},addHTMLAtEndOfBody:function(e){var t=this.getComposeBodyHTML();t+=e;this.setEmailBody(t)},disableEditing:function(){this.getEditor().attr("contenteditable",false);this.getSubjectInput().attr("disabled",true)},enableEditing:function(){this.getEditor().attr("contenteditable",true);this.getSubjectInput().removeAttr("disabled")},focusSubject:function(){this.getSubjectInput().focus()},_addHTMLBeforeQuotedText:function(e){this.getEditor().find(".gmail_extra").first().before(e)},_isThereQuotedText:function(){return this.getEditor().find(".gmail_extra").length>0}});t.extend(s.prototype,{_getFormField:function(e){if(!this._jQueryNode){return null}return this._jQueryNode.find("input[type=hidden][name="+e+"]")},_getFormFieldValue:function(e){var t=this._getFormField(e);if(t===null){return null}if(t.length===0){return""}else if(t.length===1){return t.val()}else{var i=[];for(var r=0;r<t.length;r++){i.push(n(t[r]).val())}return i}},_getFormattingArea:function(){return this._jQueryNode.find(".oc")},_getInsertMoreArea:function(){return this._jQueryNode.find(".eq")},_getToolbarArea:function(){return this._jQueryNode.find(".aDh:not(.streak__compose_externalSidebar_footer)")},_setComposeid:function(){this._composeid=this._getFormFieldValue("composeid")},_getFormattingAreaOffsetLeft:function(){var e=this._getFormattingArea();if(!e){return 0}var t=e.offset();if(!t){return 0}return t.left},_getCaretPosition:function(){var e=this._getCurrentEditorSelectionRange();var t=n(this.getEditor().insertHTMLAtCaret("<span>&nbsp;</span>"));var i=t.offset();t.remove();this.getEditor().focus();this.getEditor()[0].ownerDocument.getSelection().removeAllRanges();this.getEditor()[0].ownerDocument.getSelection().addRange(e);return i},_getCurrentEditorSelectionRange:function(){return this.getEditor()[0].ownerDocument.getSelection().getRangeAt(0).cloneRange()}});t.extend(s.prototype,{_bindToComposeEvents:function(){this._bindToDraftSaving();this._bindToSendButton();this._bindToDiscardButton();this._bindToEmailSent();this._bindToCloseButton()},_bindToDraftSaving:function(){e.NotificationCenter.subscribe({eventName:"draftSaved",filterParameters:{composeid:this.getComposeid()},functionToCall:this._draftSaved,observer:this})},_draftSaved:function(){this._storedDraftId=this.getDraftId();this._callDelegateFunction("draftSaved");this._callDelegateFunction("emailBodyChanged",this.getComposeBodyHTML(),{fromDraftSaving:true})},_bindToSendButton:function(){var t=this;var n=this.getSendButton();if(n.length===0){return}this._addEventListener(n[0],"mousedown",function(e){t._handlePresend(e)},true);this._addEventListener(this._jQueryNode[0],"keydown",function(i){if(i.srcElement!==n[0]){return}if(e.jwerty.is("space/enter",i)){t._handlePresend(i)}},true);this._unbinders.push(e.BentoBox.Keyboard.bindChordToEl({el:this._jQueryNode,chord:"ctrl+enter/cmd+enter",useCapture:true,cb:function(e){t._handlePresend(e)}}))},_handlePresend:function(t){this._callDelegateFunction("emailBodyChanged",this.getComposeBodyHTML());var n=false;for(var i=0;i<this._viewControllers.length;i++){if(this._viewControllers[i]&&this._viewControllers[i].shouldNotSend){n=n||this._viewControllers[i].shouldNotSend()}}if(n){t.preventDefault();t.stopPropagation();t.stopImmediatePropagation();this._callDelegateFunction("sendCancelled");e.BentoBox.Tracker.trackGmail("sending rejected")}else{this._callDelegateFunction("aboutToSend");e.BentoBox.Tracker.trackGmail("email sending")}},_bindToEmailSent:function(){e.NotificationCenter.subscribe({eventName:"emailSent",filterParameters:{composeid:this.getComposeid()},functionToCall:this._handleEmailSent,observer:this})},_handleEmailSent:function(){this._callDelegateFunction("emailSent")},sentEmailThreadMetaDataFound:function(e){this._callDelegateFunction("sentEmailThreadMetaDataFound",e)},_bindToDiscard:function(){e.NotificationCenter.subscribe({eventName:"emailDiscarded",filterParameters:{composeid:this.getComposeid()},functionToCall:this._handleEmailDiscarded,observer:this})},_handleEmailDiscarded:function(){this._callDelegateFunction("discarded")},_bindToDiscardButton:function(){var t=this;var n=this.getDiscardButton();this._addEventListener(n[0],"mousedown",function(e){t._handlePrediscard(e)},true);this._addEventListener(this._jQueryNode[0],"keydown",function(i){if(i.srcElement!==n[0]){return}if(e.jwerty.is("space/enter",i)){t._handlePrediscard(i)}},true)},_handlePrediscard:function(e){var t=false;for(var n=0;n<this._viewControllers.length;n++){if(this._viewControllers[n]&&this._viewControllers[n].shouldNotDiscard){t=t||this._viewControllers[n].shouldNotDiscard()}}if(t){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();this._callDelegateFunction("discardCancelled")}else{this._callDelegateFunction("aboutToDiscard")}},_bindToCloseButton:function(){var t=this;this._addEventListener(this.getCloseButton()[0],"mousedown",function(e){t._callDelegateFunction("composeClose")});this._addEventListener(this._jQueryNode[0],"keydown",function(n){if(e.jwerty.is("escape",n)){t._callDelegateFunction("composeClose")}})},_addEventListener:function(e,t,n,i){if(!e){return}e.addEventListener(t,n,i);this._eventListeners.push([e,t,n,i])},_removeEventListener:function(e){e[0].removeEventListener(e[1],e[2],e[3])}});t.extend(s.prototype,{_processListenerViewController:function(e){switch(e.getListenerType()){case"CHARACTER_SEQUENCE":this._addCharacterSequenceViewController(e);break;case"CHORD":this._addChordListenerViewController(e);break}},_addCharacterSequenceViewController:function(e){this._characterSequenceController.addDataSource(e.getCharacterSequenceListener())},_setupKeyboardEvents:function(){this._bindKeyPressEvents();this._setupCharacterSequenceController()},_bindKeyPressEvents:function(){var t=this;if(this.getEditor().length===0){setTimeout(function(){t._bindKeyPressEvents()},100);return}this._addEventListener(this.getEditor()[0],"keydown",function(e){t._callDelegateFunction("keydown",e)},true);this._addEventListener(this.getEditor()[0],"keypress",function(e){t._callDelegateFunction("keypress",e)},true);this._addEventListener(this.getEditor()[0],"keyup",function(e){t._callDelegateFunction("keyup",e)},true);this._addEventListener(this.getEditor()[0],"blur",function(e){setTimeout(function(){if(t.getEditor()&&!t.getEditor().is(":focus")){t._callDelegateFunction("editorBlur")}},100)},true);this._addEventListener(this._jQueryNode[0],"keydown",function(n){if(e.jwerty.is("escape",n)){t._callDelegateFunction("escapePressed",n)}t._callDelegateFunction("composeKeydown",n)},true)},_setupCharacterSequenceController:function(){this._characterSequenceController=new e.BentoBox.Controllers.CharacterSequenceController;this.addDelegate(this._characterSequenceController)},_addChordListenerViewController:function(t){var n=this;var i=t.getListenerChord();this._unbinders.push(e.BentoBox.Keyboard.bindChordToEl({el:this.getEditor(),chord:i,noBubble:true,noDefault:true,useCapture:true,cb:function(e){if(n._toolbarOverflowButton){n._toolbarOverflowButton.on()}t.callListenerCallback()}}))},_bindToEmailContentChanges:function(){var e=this;if(this.getEditor().length===0){setTimeout(function(){e._bindToEmailContentChanges()},100);return}this._addEventListener(this.getSubjectInput()[0],"input",function(t){e._lastSubjectPosition=e.getSubjectInput()[0].selectionEnd;e._callDelegateFunction("subjectChanged",e.getSubject())});var n=t.debounce(function(){e._callDelegateFunction("emailBodyChanged",e.getComposeBodyHTML())},300,false);this._addEventListener(this.getEditor()[0],"input",n);this._addEventListener(this.getSubjectInput()[0],"focus",function(t){e._elementOfLastFocus="SUBJECT"});this._addEventListener(this.getEditor()[0],"focus",function(t){e._elementOfLastFocus="EDITOR"});this._bindToAddressChanges()},_bindToAddressChanges:function(){if(!a){return}var e=this;var t={childList:true,subtree:true};var n=new a(function(t){t.forEach(function(t){if(t.addedNodes.length===0&&t.removedNodes.length===0){return}for(var n=0;n<t.addedNodes.length;n++){var i=t.addedNodes[n];if(i.className==="vR"){e._callDelegateFunction("addressesChanged");return}}for(var n=0;n<t.removedNodes.length;n++){var i=t.removedNodes[n];if(i.className==="vR"){e._callDelegateFunction("addressesChanged");return}}})});n.observe(this.getAddressesContainer()[0],t)},_startWatchingAttachments:function(){if(!a){return}var t=this;var n=new a(function(n){n.forEach(function(n){if(n.addedNodes.length===0){return}for(var i=0;i<n.addedNodes.length;i++){var r=n.addedNodes[i];if(r.querySelector(".dL")){e.NotificationCenter.postNotification({eventName:"newAttachmentAdded",composeId:t.getComposeid(),sender:this});t.notify("newAttachmentAdded")}}})});var i=this._jQueryNode.find(".GM > div")[0];if(i){n.observe(i,{childList:true})}else{e.BentoBox.logError("no attachmentParent element found")}}});t.extend(s.prototype,{_addPadding:function(){this._jQueryNode.find("form").css("padding-right","200px");this._jQueryNode.find(".GQ").css("padding-right","200px")},_removePadding:function(){this._jQueryNode.find("form").css("padding-right","");this._jQueryNode.find(".GQ").css("padding-right","")},_addElementToBottomToolbarBeforeFormatting:function(e){var t=e.getModificationPriority();var n=e.getModificationElement();if(!this._additionalAreas.toolbarBeforeFormatting){this._additionalAreas.toolbarBeforeFormatting=this._addAdditionalToolbarArea("beforeFormatting")}var i=null;var r=-1;var a;for(var o=0;o<this._toolbarBeforeFormattingViewControllers.length;o++){a=this._toolbarBeforeFormattingViewControllers[o].getModificationPriority();if(t>a&&a>r){i=this._toolbarBeforeFormattingViewControllers[o].getModificationElement();r=a}}if(!i){this._additionalAreas.toolbarBeforeFormatting.prepend(n)}else{i.after(n)}this._toolbarBeforeFormattingViewControllers.push(e)},_addAdditionalToolbarArea:function(e){var t=n(document.createElement("td"));t[0].setAttribute("class","streakArea gU");this._getFormattingArea().before(t);var i=document.createElement("td");i.setAttribute("class","streakComposeSeparator gU");i.innerHTML='<div class="Uz"></div>';t.after(i);t.closest("table").find("colgroup col").first().after('<col class="streakAreaColumn"></col><col class="streakComposeSeparatorColumn"></col>');return n("<div/>").appendTo(t)},openComposeToolbarOverflow:function(){var t=this;return new e.RSVP.Promise(function(e,n){if(t._jQueryNode.find(".inboxsdk__compose_groupedActionToolbar").length>0){if(!t._jQueryNode.find(".inboxsdk__compose_groupedActionToolbar").is(":visible")){t._jQueryNode.find(".inboxsdk__compose_groupedActionButton").simulateRawClick()}}e()})},_updateInsertMoreAreaLeft:function(e){var t=this._getFormattingAreaOffsetLeft();var n=parseInt(this._getInsertMoreArea().css("left"),10);var i=t-e;this._getInsertMoreArea().css("left",n+i+"px")},_addElementToStatusArea:function(e){var t=e.getModificationElement();if(!t){return}var i=this.getStatusTextArea();i.find(".aWR").hide();i.find(".wM").css("display","block");var r=n('<span class="oG streak__statusText"><span class="streak__statusText_separator">| </span></span>');r.append(t);i.prepend(r);i.find(".streak__statusText_separator").hide();this._additionalAreas.statusText=r},_detachElementFromStatusArea:function(e){var t=e.getModificationElement();if(!t){return}t.detach();this._additionalAreas.statusText.remove();this._additionalAreas.statusText=null;var n=this.getStatusTextArea();n.find(".aWR").show();n.find(".wM").css("display","")}});e.Gmail.GmailComposeWindowViewController=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._currentCallback=null};n.extend(u.prototype,{requestNewComposeWindow:function(e){this._currentCallback=e;this._setupComposeListener();this._openNewCompose()},_setupComposeListener:function(){o.subscribe({eventName:"newComposeWindow",functionToCall:this._newComposeWindow,observer:this,unsubscribeImmediately:true})},_openNewCompose:function(){i.getComposeButton().simulateRawClick()},_newComposeWindow:function(e){if(this._currentCallback){this._currentCallback(e.composeWindowController)}}});e.DependencyManager.addFunction({functionKey:"gmailComposeWindowRequesterInitialized",functionToCall:function(e){i.GmailComposeWindowRequester=new u;if(e){e()}},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._dataSources=[];this._pendingComposeWindows=[];this._readyToLoad=false;this._setupListener()};n.extend(u.prototype,{_setupListener:function(){o.subscribe({eventName:"newComposeWindow",functionToCall:this._newComposeWindow,observer:this})},_newComposeWindow:function(e){if(!this._readyToLoad){this._pendingComposeWindows.push(e);return}var t=e.composeWindowController;var i=n.chain(this._dataSources).map(function(e){return e.getViewControllers()}).flatten().compact().value();t.addViewControllers(i)},markReadyToLoad:function(){this._readyToLoad=true;for(var e=0;e<this._pendingComposeWindows.length;e++){this._newComposeWindow(this._pendingComposeWindows[e])}this._pendingComposeWindows.length=0},registerModifierModule:function(e){if(this._dataSources.indexOf(e)>-1){return}this._dataSources.push(e);var t=i.GmailComposeWindowMasterController.getComposeWindows();if(t.length===0){return}var n=e.getViewControllers();if(!n||n.length===0){return}for(var r=0;r<t.length;r++){if(t[r].isReady()){t[r].addViewControllers(n)}else{t[r].addViewControllersAfterReady(n)}}}});i.GmailComposeManager=new u;e.DependencyManager.addFunction({functionKey:"gmailComposeManager.markReadyToLoad",functionReference:i.GmailComposeManager.markReadyToLoad,functionContext:i.GmailComposeManager,dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailEmailBodyManipulator",superclass:e.Object,_memberVariables:[{name:"_manipulations",destroy:true,defaultValue:[]}],registerManipulation:function(e){this._manipulations.push(e);if(!r.isReady()){return}if(r.isConversationVisible()){this._processEmailBodyManipulation(e)}},_initialize:function(){e.Object.prototype._initialize.call(this);this._bindToEvents()},_bindToEvents:function(){var e=this;r.observe("conversationThreadLoadedEvent",function(){e._processEmailBodies()});r.observe("conversationMessageStateChanged",function(){e._processEmailBodies()})},_processEmailBodies:function(){var e=r.getConversationMessageBodies();for(var t=0;t<this._manipulations.length;t++){this._manipulations[t].applyBodyManipulation(e)}},_processEmailBodyManipulation:function(e){var t=r.getConversationMessageBodies();e.applyBodyManipulation(t)}});i.set("Gmail.GmailEmailBodyManipulator",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailEmailBodyManipulation",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},applyBodyManipulation:function(e){throw new Error("must implement applyBodyManipulation")}});i.set("Gmail.GmailEmailBodyManipulation",d)})(Streak);(function(e){var t=e._,n=e.$,i=e.Gmail;var r=function(){this._replyAreas=[];this._detectNewReplyAreas()};r.prototype=Object.create(e.ViewControllerBase.prototype);t.extend(r.prototype,{_detectNewReplyAreas:function(){var e=this;i.inboxSDK.Compose.registerComposeViewHandler(this._processNewReplyArea.bind(this))},_processNewReplyArea:function(t){if(!t.isInlineReplyForm()){return}var n=new i.GmailReplyAreaViewController;n.setComposeView(t);this._replyAreas.push(n);e.NotificationCenter.postNotification({eventName:"newReplyArea",replyAreaController:n,sender:this});var r=this;t.on("close",function(){r._replyAreaClosed(t)})},_replyAreaClosed:function(e){var t=this;var n=t._replyAreas.slice(0);this._replyAreas.length=0;for(var i=0;i<n.length;i++){if(n[i].getComposeView()===e){n[i].destroy();break}else{this._replyAreas.push(n[i])}}}});e.DependencyManager.addFunction({functionKey:"gmailReplyAreaMasterControllerInitialized",functionToCall:function(e){i.GmailReplyAreaMasterController=new r;if(e){e()}},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailReplyAreaViewController",superclass:r.GmailComposeWindowViewController,setComposeView:function(e){this._composeView=e;this._jQueryNode=t(e._composeViewImplementation.getElement());this._setComposeid();this._bindToComposeEvents();this._setupKeyboardEvents();this._bindToEmailContentChanges();this._bindToStatusChanges();this._startWatchingAttachments()},getComposeView:function(){return this._composeView},setSubject:function(){},addTextAtCurrentCursorPosition:function(e){this.getEditor().insertHTMLAtCaret(e);this._callDelegateFunction("emailBodyChanged",this.getComposeBodyHTML())},getSendAndArchiveButton:function(){var e=this.getSendButton().siblings();if(e.length===0){return}return e.first().find("[role=button]")},_bindToSendButton:function(){r.GmailComposeWindowViewController.prototype._bindToSendButton.call(this);var t=this;var n=this.getSendAndArchiveButton();if(!n||n.length===0){return}this._addEventListener(n[0],"mousedown",function(e){t._handlePresend(e)},true);this._addEventListener(this._jQueryNode[0],"keydown",function(i){if(i.srcElement!==n[0]){return}if(e.jwerty.is("space/enter",i)){t._handlePresend(i)}},true);this._unbinders.push(e.BentoBox.Keyboard.bindChordToEl({el:this._jQueryNode,chord:"ctrl+enter/cmd+enter",useCapture:true,cb:function(e){t._handlePresend(e)}}))},_addElementToBottom:function(e){r.GmailComposeWindowViewController.prototype._addElementToBottom.call(this,e);var t=e.getModificationElement();if(!e.shouldModificationAdjustHeight||!e.shouldModificationAdjustHeight()){return}this._getToolbarArea().closest("td.HE")[0].style.paddingTop="40px";this._getToolbarArea().closest("td.HE")[0].style.paddingBottom="40px"},_detachElementFromBottom:function(e){var t=e.getModificationElement();if(!t){return}if(!t.is(":inBody")){return}if(e.shouldModificationAdjustHeight&&e.shouldModificationAdjustHeight()){this._getToolbarArea().closest("td.HE")[0].style.paddingTop="";this._getToolbarArea().closest("td.HE")[0].style.paddingBottom=""}r.GmailComposeWindowViewController.prototype._detachElementFromBottom.call(this,e)},_bindToStatusChanges:function(){var t=this;var n=this._jQueryNode.find(".wM");if(n.length>0){this._unbinders.push(e.DomWatcher.notifyAttributeChanged(n[0],"class",function(){if(t._jQueryNode.find(".wM").length){t._extraAttachmentsHide()}else{t._extraAttachmentsShow()}}))}var i=this._jQueryNode.find('.aWQ .oG[id^=":"]');if(i.length>0){this._unbinders.push(e.DomWatcher.notifyAttributeChanged(i[0],"class",function(){if(t._jQueryNode.find('.aWQ .oG.aOy[id^=":"]').length){t._savingTextShow()}else{t._savingTextHide()}}))}},_extraAttachmentsShow:function(){if(!this._additionalAreas.statusText){return}this._additionalAreas.statusText.hide()},_extraAttachmentsHide:function(){if(!this._additionalAreas.statusText){return}var e=this;setTimeout(function(){e._additionalAreas.statusText.show()},100)},_savingTextShow:function(){if(!this._additionalAreas.statusText){return}this._additionalAreas.statusText.find(".streak__statusText_separator").show()},_savingTextHide:function(){if(!this._additionalAreas.statusText){return}this._additionalAreas.statusText.find(".streak__statusText_separator").hide()},isReply:function(){return true}});i.set("Gmail.GmailReplyAreaViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._dataSources=[];this._pendingReplyAreas=[];this._readyToLoad=false;this._setupListener()};n.extend(u.prototype,{_setupListener:function(){o.subscribe({eventName:"newReplyArea",functionToCall:this._newReplyArea,observer:this})},_newReplyArea:function(e){if(!this._readyToLoad){this._pendingReplyAreas.push(e);return}var t=e.replyAreaController;var i=n.chain(this._dataSources).map(function(e){return e.getViewControllers()}).flatten().compact().value();t.addViewControllers(i)},markReadyToLoad:function(e){this._readyToLoad=true;for(var t=0;t<this._pendingReplyAreas.length;t++){this._newReplyArea(this._pendingReplyAreas[t])}this._pendingReplyAreas.length=0;if(e){e()}},registerModifierModule:function(e){if(this._dataSources.indexOf(e)>-1){return}this._dataSources.push(e)}});i.GmailReplyManager=new u;e.DependencyManager.addFunction({functionKey:"gmailReplyManager.markReadyToLoad",functionToCall:i.GmailReplyManager.markReadyToLoad,functionContext:i.GmailReplyManager,dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailThreadListViewProvider",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getRelevantRequestParameters:function(){throw new Error("must implement getRelevantRequestParameters")},start:function(e){throw new Error("temporary error test")},getCrapFormatThreads:function(t,n){return new e.RSVP.Promise(function(e,t){throw new Error("must implement getCrapFormatThreads")})},isCustomList:function(){return true}});i.set("Gmail.GmailThreadListViewProvider",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Object;var h=e.Class.subclass({className:"GmailThreadListViewRegister",superclass:d,_memberVariables:[{name:"_providers",destroy:true,defaultValue:[]}],_initialize:function(){d.prototype._initialize.call(this)},registerProvider:function(e){var t=this._getUrlParameters(e);this._providers.push({urlParameters:t,gmailThreadListViewProvider:e})},isRequestRelevant:function(e){return!!this._getMatchingProvider(e)},getAjaxInterceptor:function(e){var t=this._getMatchingProvider(e);if(!t){return}return new r.GmailThreadListViewAjaxInterceptor(new t.gmailThreadListViewProvider)},isCustomThreadListView:function(){return r.getMainList()&&(r.getMainList().find("[streakthreadid]").length>0||r.getMainList().find("[streakhiderow]").length>0)},_getUrlParameters:function(e){var t=e.prototype.getRelevantRequestParameters();if(!t){throw new Error("thread list view provider did not give url parameters")}return t},_getMatchingProvider:function(e){var t=null;var n=null;for(var i=0;i<this._providers.length;i++){var r=this._providers[i];var a=r.urlParameters;if(this._doUrlParametersMatch(a,e)){if(this._areParametersMoreSpecific(n,a)){t=r;n=a}}}return t},_doUrlParametersMatch:function(e,t){for(var n in e){if(e[n]!==t[n]){return false}}return true},_areParametersMoreSpecific:function(e,t){if(!e){return true}return Object.keys(e).length<Object.keys(t).length}});e.Gmail.GmailThreadListViewRegister=new h})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=e.Object;var u=e.Class.subclass({className:"GmailThreadListViewAjaxInterceptor",superclass:l,_memberVariables:[{name:"_gmailThreadListViewProvider",destroy:true}],_initialize:function(e,t){l.prototype._initialize.call(this);this._gmailThreadListViewProvider=e;this._gmailThreadListViewProvider.start(t)},getNewResponseText:function(t,n){var i=this;return this._gmailThreadListViewProvider.getCrapFormatThreads(t,n).catch(function(t){e.BentoBox.logError("thread list view provider error",t);return null}).then(function(e){a.postNotification({eventName:"gmailThreadListGettingThreads",sender:i,isCustomList:i._gmailThreadListViewProvider.isCustomList()});if(e){return r.ThreadResponseProcessor.replaceThreadsInResponse(n,e)}else{return n}}).catch(function(t){e.BentoBox.logError("thread list replacement error",t);return n})}});i.set("Gmail.GmailThreadListViewAjaxInterceptor",u)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailThreadListViewPolisher",superclass:e.Object,_memberVariables:[{name:"_shouldRenderEmpty",destroy:true},{name:"_emptyElement",destroy:true},{name:"_isGettingThreads",destroy:false,defaultValue:false},{name:"_cssRuleHidingTable",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._createEmptyElement();r.observe("newInboxEmails",this._handleNewInboxEmails.bind(this));r.observe("viewChanged",this._handleViewChanged.bind(this));l.subscribe({eventName:"newThreadDOMRow",functionToCall:this._handleNewThreadDOMRow,observer:this});l.subscribe({eventName:"gmailThreadListGettingThreads",functionToCall:this._handleGettingThreads,observer:this});l.subscribe({eventName:"gmailThreadListGotThreads",functionToCall:this._handleGotThreads,observer:this})},_createEmptyElement:function(){this._emptyElement=t('<div class="ae4 UI streak__recentViews_emptyMessage" gh="tl"><div class="Cp"></div><div><table cellpadding="0" class="cf TB"><colgroup><col class="Cm"><col class="TE"><col></colgroup><tbody><tr class="TD"><td class="TC" colspan="3" style="text-align:center">There are no conversations here.</td></tr></tbody></table></div></div>')},_handleNewThreadDOMRow:function(e){if(!r.GmailThreadListViewRegister.isCustomThreadListView()){return}if(!e.threadDOMRow){return}if(e.threadDOMRow.rowNode.find("[streakhiderow]").length>0){e.threadDOMRow.rowNode.hide()}},_handleNewInboxEmails:function(){if(!r.GmailThreadListViewRegister.isCustomThreadListView()){this._showThreadTable();return}this._hideFakeRows();if(this._cssRuleHidingTable){this._cssRuleHidingTable.destroy()}this._cssRuleHidingTable=null;this._isGettingThreads=false;if(this._hasEmptyResults()){this._showEmptyMessage()}else{this._hideEmptyMessage()}},_handleViewChanged:function(){if(!r.GmailThreadListViewRegister.isCustomThreadListView()){this._showThreadTable();return}this._hideThreadTable();this._hideFakeRows();this._removeDocsSection();this._removeListNumbersAndPaging();this._removeTrashSection();this._hideMailText();if(this._hasEmptyResults()){this._showEmptyMessage()}else{this._hideEmptyMessage()}this._showThreadTable()},_handleGettingThreads:function(e){if(!e.isCustomList){this._isGettingThreads=false;return}this._isGettingThreads=true},_handleGotThreads:function(e){var t=this._isGettingThreads;this._isGettingThreads=false;if(!e.isCustomList){this._showThreadTable();return}if(!r.GmailThreadListViewRegister.isCustomThreadListView()&&!t){this._showThreadTable();return}this._hideThreadTable(t)},_hideThreadTable:function(t){if(!this._cssRuleHidingTable&&(this._isGettingThreads||t)){this._cssRuleHidingTable=e.CSSStyleManipulator.addRule("[role=main] [gh=tl] table {visibility: hidden;}")
}},_showThreadTable:function(){if(this._cssRuleHidingTable){this._cssRuleHidingTable.destroy();this._cssRuleHidingTable=null}},_hideFakeRows:function(){if(r.isVerticalSplitPreviewPane()){this._hidePreviewPaneRows()}else{r.getMainList().find("[streakhiderow]").parents("tr").hide()}},_hidePreviewPaneRows:function(){var e=r.getMainList().find("[streakhiderow]").parents("tr");for(var n=0;n<e.length;n++){var i=t(e[n]);i.hide();i.next().hide();i.next().next().hide()}},_removeDocsSection:function(){r.getMainList().nextAll().remove()},_removeListNumbersAndPaging:function(){r.getCurrentMainContainer().find(".Cr").filterOutInvisible().remove()},_removeTrashSection:function(){r.getMainList().children(".Cp").nextAll().remove()},_hideToolbarButtons:function(){r.$("[gh=mtb]").hide()},_hideMailText:function(){r.$(".Wc").hide()},_hasEmptyResults:function(){return r.getMainList().find("[streakhiderow]").parents("tr").length===r.getMainList().find("tr").length},_showEmptyMessage:function(){r.getListToolbarContainer().removeClass("Qj");r.getMainList().after(this._emptyElement)},_hideEmptyMessage:function(){this._emptyElement.detach()}});i.set("Gmail.GmailThreadListViewPolisher",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailThreadListViewRefresher",superclass:e.Object,_memberVariables:[{name:"_state",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._bindToEvents()},_bindToEvents:function(){l.subscribe({eventName:"gmailThreadListViewClicked",functionToCall:this._viewClicked,observer:this});l.subscribe({eventName:"gmailThreadListGettingThreads",functionToCall:this._gettingThreads,observer:this});r.observe("viewChanged",this._viewChanged.bind(this))},_viewClicked:function(e){this._state="viewClicked";if(!r.GmailThreadListViewRegister.isCustomThreadListView()){return}if(location.hash.indexOf(e.url)===-1){return}r.triggerListRefresh();l.postNotification({eventName:"gmailThreadListViewRefreshing",sender:this})},_gettingThreads:function(){this._state=null},_viewChanged:function(){if(!r.GmailThreadListViewRegister.isCustomThreadListView()){return}if(this._state!=="viewClicked"){return}r.triggerListRefresh();l.postNotification({eventName:"gmailThreadListViewRefreshing",sender:this})}});i.set("Gmail.GmailThreadListViewRefresher",new d)})(Streak);(function(e){var t=e._,n=e.$,i=e.Date,r=e.Gmail,a=e.APIRequester,o=e.Model,s=e.Collection,l=e.BentoBox;var u=function(e){this._messageBlocks=[];this._generateBlockArray()};u.BLOCK_TYPES={COLLAPSED:"COLLAPSED",CONDENSED:"CONDENSED",EXPANDED:"EXPANDED"};t.extend(u.prototype,{_generateBlockArray:function(){var e=this._getRowEls();if(e.length===0){return}this._containerTop=e[0].closest("td").offset().top;var t=[];for(var n=0;n<e.length+1;n++){var i=e[n];if(i){if(i.is(c.BLOCK_DIV_CLASSES.CONDENSED)){t.push(i)}else{if(t.length>0){this._messageBlocks.push(this._generateRowInfo(t,u.BLOCK_TYPES.CONDENSED));t.length=0}if(i.is(c.BLOCK_DIV_CLASSES.COLLAPSED)){this._messageBlocks.push(this._generateRowInfo(i,u.BLOCK_TYPES.COLLAPSED))}else if(i.is(c.BLOCK_DIV_CLASSES.EXPANDED)){this._messageBlocks.push(this._generateRowInfo(i,u.BLOCK_TYPES.EXPANDED))}}}else{if(t.length>0){this._messageBlocks.push(this._generateRowInfo(t,u.BLOCK_TYPES.CONDENSED))}}}},_getRowEls:function(){var e=r.getCurrentMain().find(".Bk");var t=[];for(var i=0;i<e.length;i++){t.push(n(e[i]).parent())}return t},_generateRowInfo:function(e,t){var n=this;var i={};i.el=e;i.type=t;if(t===u.BLOCK_TYPES.CONDENSED){i.geometry=n._calculateCondensedRowGeometry(e)}else{i.geometry=n._calculateRowGeometry(e);i.sender=n._extractSender(e);i.body=n._extractMessageBody(e)}return i},_calculateRowGeometry:function(e){var t={};t.width=e.width();t.height=e.find(".ads").filterOutInvisible().outerHeight();t.top=e.offset().top-this._containerTop;t.left=e.offset().left;t.middle=t.top+t.height/2;t.bottom=t.top+t.height;return t},_calculateCondensedRowGeometry:function(e){var n={};var i=e[0];var r=t.last(e);n.top=i.offset().top-this._containerTop;n.bottom=r.offset().top+r.outerHeight()-this._containerTop;n.left=i.offset().left;n.width=i.width();n.height=n.bottom-n.top;n.middle=n.top+n.height/2;return n},_extractSender:function(e){var t=this;var n=e.find(".gF.gK span");var i=n.attr("email");var r=n.attr("name");return{email:i.toLowerCase(),name:r}},_extractMessageBody:function(e){return e.find(".adP")},getMessageBlocks:function(){return this._messageBlocks},dsfsfdsfs13212fs:function(){}});var c={BLOCK_DIV_CLASSES:{COLLAPSED:".kv",CONDENSED:".kx, .kQ",EXPANDED:".h7"}};r.GmailConversationGeometryModel=u})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var e=this;if(!e.initialized){e.initialized=true;e._delegates=[];e._convoStateChangeBindId=Math.random();n.observe("conversationMessageStateChanged",function(){e._callDelegatesForGmailMessagesChange()},e._convoStateChangeBindId)}};o.extend(s.prototype,{addDelegate:function(e){this._delegates.push(e)},processConversation:function(){this._callDelegatesForGmailMessagesChange()},_callDelegatesForGmailMessagesChange:function(){var e=this;var t=new n.GmailConversationGeometryModel;o.each(e._delegates,function(e){if(o.isReal(e.gmailThreadRowsChanged)){e.gmailThreadRowsChanged(t)}})},destroy:function(){n.unobserve("conversationMessageStateChanged",this._convoStateChangeBindId);this._delegates.length=0;this._delegates=null}});n.GmailConversationWatchController=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.Template,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h={SETTINGS_PATH:"leftLink/labelToggleState/",TRACKED_KEY:"label:all before:5000/01/01",URL_KEY:"label%3Aall+before%3A5000%2F01%2F01",SEARCH_URL:"label%3Aall+before%3A5000%2F01%2F01",SEARCH_REPLACEMENT:"is:recentlyviewed",GMAIL_SELECTED_CLASS:"ain",GMAIL_SELECTED_INNER_CLASS:"nZ aiq",GMAIL_HOVER_CLASS:"NQ",EXPANDO_POINT_DOWN_CLASS:"aih",EXPANDO_POINT_RIGHT_CLASS:"aii",EXPANDO_HOVER_CLASS:"aij",MANIPULATIONS:{LINK_MANIPULATION:"LINK_MANIPULATION"}};var f={sent:"getSentMailLink",inbox:"getInboxLink"};var p=e.Class.subclass({className:"GmailLeftNavManipulator",superclass:e.Object,_memberVariables:[{name:"_manipulations",destroy:true,defaultValue:[]},{name:"_labelToLinkMap",destroy:true,defaultValue:{}},{name:"_labelToToggleButtonMap",destroy:true,defaultValue:{}},{name:"_linkTemplate",destroy:true},{name:"_expandoTemplate",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._linkTemplate=s.underscore("core/gmail/gmailLeftNav/link");this._expandoTemplateString='<div class="TH J-J5-Ji expando streak__leftNav_expando aih" role="link" tabindex="0"></div>';r.observe("viewChanged",n.bind(this._handleViewChanged,this))},addNewLink:function(e){var t=e.getNavRelativeLabel();if(!this._isLabelValid(t)){return}var n=this._createNewLink(e);var i=this._getLabelLink(t);var r=e.getNavRelativeLocation();this._addNewLinkToNav(n,i,t,r,e.shouldPrepend);this._manipulations.push({manipulation:e,type:h.MANIPULATIONS.LINK_MANIPULATION,link:n,relativeLabel:t,relativeLabelLink:i,location:r})},_handleViewChanged:function(){for(var e=0;e<this._manipulations.length;e++){var t=this._manipulations[e];if(t.type!==h.MANIPULATIONS.LINK_MANIPULATION){continue}var n=t.link;if(this._isCurrentUrlIsRelevantToManipulation(t)){n.addClass(h.GMAIL_SELECTED_CLASS);n.find(".TO").addClass(h.GMAIL_SELECTED_INNER_CLASS)}else{n.removeClass(h.GMAIL_SELECTED_CLASS);n.find(".TO").removeClass(h.GMAIL_SELECTED_INNER_CLASS)}}},_isCurrentUrlIsRelevantToManipulation:function(e){if(!e.manipulation.getUrl||!e.manipulation.getUrl()){return false}return location.hash.indexOf(e.manipulation.getUrl())>-1},_isLabelValid:function(e){var t=r[f[e]]();if(!t||t.length===0){return false}return true},_createNewLink:function(n){var i=this;var a=t(this._linkTemplate({text:n.getNavLinkName()}));a[0].addEventListener("click",function(t){t.preventDefault();t.stopPropagation();e.NotificationCenter.postNotification({eventName:"gmailThreadListViewClicked",sender:i,url:n.getUrl()});r.setURL(n.getUrl());if(n.linkClickedFunction){n.linkClickedFunction()}},true);if(n.getClass){a.addClass(n.getClass())}a.find(".TO").easyHoverClass(h.GMAIL_HOVER_CLASS);return a},_addNewLinkToNav:function(e,t,n,i,r){t.addClass("streak__leftNav_gmailLink");switch(i){case"BEFORE":t.prepend(e);e.addClass("streak__leftNavLink_mainList");break;case"AFTER":t.append(e);e.addClass("streak__leftNavLink_mainList");break;case"NESTED":this._nestNewLink(e,t,n,r);this._updateNestedLabelVisibility(t,n);break}},_getLabelLink:function(e){if(!this._labelToLinkMap[e]){this._labelToLinkMap[e]=r[f[e]]()}return this._labelToLinkMap[e]},_nestNewLink:function(e,t,n,i){if(!this._labelToToggleButtonMap[n]){this._setupLabelWithToggleButton(t,n);t.addClass("streak__leftNav_"+n+"Nested")}if(i&&t.find(".streak__leftNavLink_nested").length>0){t.find(".streak__leftNavLink_nested").first().before(e)}else{if(t.find(".streak__leftNavLink_nested").length>0){t.find(".streak__leftNavLink_nested").last().after(e)}else{t.append(e)}}e.addClass("streak__leftNavLink_nested")},_setupLabelWithToggleButton:function(e,n){var i=t(this._expandoTemplateString);i.addClass("streak__leftNav_"+n+"Expando");var r=this;i[0].addEventListener("click",function(t){r._toggleLinkVisibilityStatus(e,i,n);t.preventDefault();t.stopPropagation()},true);i.easyHoverClass(h.EXPANDO_HOVER_CLASS);e.find("> .TO > .TN").prepend(i);this._labelToToggleButtonMap[n]=i},_toggleLinkVisibilityStatus:function(t,n,i){var r=this._getCurrentExpandoStatus(i);var a=!r;e.BentoBox.LocalSettings.set(h.SETTINGS_PATH+i,a);e.BentoBox.LocalSettings.save();this._updateNestedLabelVisibility(t,i)},_getCurrentExpandoStatus:function(t){return e.BentoBox.LocalSettings.get(h.SETTINGS_PATH+t)},_updateNestedLabelVisibility:function(e,t){var n=this._getCurrentExpandoStatus(t);var i=this._labelToToggleButtonMap[t];if(n===true){i.addClass(h.EXPANDO_POINT_DOWN_CLASS);i.removeClass(h.EXPANDO_POINT_RIGHT_CLASS);e.find(".streak__leftNavLink_nested").show()}else{i.removeClass(h.EXPANDO_POINT_DOWN_CLASS);i.addClass(h.EXPANDO_POINT_RIGHT_CLASS);e.find(".streak__leftNavLink_nested").hide()}}});i.set("Gmail.GmailLeftNavManipulator",new p)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailLeftNavManipulation",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getUrl:function(){throw new Error("must define getUrl")},getNavRelativeLabel:function(){throw new Error("must define getNavRelativeLabel")},getNavRelativeLocation:function(){throw new Error("must define getNavRelativeLocation")},getNavLinkName:function(){throw new Error("must define getNavLinkName")},getClass:function(){},linkClickedFunction:function(){}});i.set("Gmail.GmailLeftNavManipulation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailSearchBarContentReplacer",superclass:e.Object,_memberVariables:[{name:"_manipulations",destroy:true,defaultValue:[]}],_initialize:function(){e.Object.prototype._initialize.call(this);r.observe("viewChanged",this._handleViewChanged.bind(this));this._bindToSearchEntry()},addManipulation:function(e){this._manipulations.push(e)},_handleViewChanged:function(){var e=r.getSearchInput();var t=e.val();if(t){t=this._applyDisplayManipulations(t);e.val(t)}},_applyDisplayManipulations:function(e){for(var t=0;t<this._manipulations.length;t++){var n=this._manipulations[t];e=n.applyDisplayManipulation(e)}return e},_bindToSearchEntry:function(){var t=r.getSearchButton();if(!t||t.length===0){return}var n=this;var i=r.getSearchInput();t[0].addEventListener("mousedown",function(e){n._applyValueManipulations()},true);t[0].addEventListener("keydown",function(t){if(!e.jwerty.is("space/enter",t)){return}n._applyValueManipulations()},true);i[0].addEventListener("keydown",function(t){if(!e.jwerty.is("enter",t)){return}n._applyValueManipulations()},true)},_applyValueManipulations:function(){var e=r.getSearchInput();var t=e.val();for(var n=0;n<this._manipulations.length;n++){var i=this._manipulations[n];t=i.applyValueManipulation(t)}e.val(t)}});e.DependencyManager.addFunction({functionKey:"gmailSearchBarContentReplacerInitialized",functionReference:function(){i.set("Gmail.GmailSearchBarContentReplacer",new d)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager;var c=e.Class.subclass({className:"ThreadResponseProcessor",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},extractThreads:function(e){var t=this.deserialize(e);return h(t)},extractMessageIdFromSentEmail:function(e){var t=this.deserialize(e);var n="a";var i=m(t,n,g);if(!i){return null}return i[3][0]},extractHexGmailThreadIdFromMessageIdSearch:function(e){if(!e){return null}var t=this.deserialize(e);var n="cs";var i=m(t,n,v);if(!i){return}return i[1]},rewriteSingleQuotes:function(e){var t=0,n="";while(true){var i=e.substr(t).match(/['"]/);if(!i){n+=e.substr(t);break}n+=e.substr(t,i.index)+'"';t+=i.index+1;if(i[0]=='"'){i=e.substr(t).match(/^([^"\\]|\\.)*"/);if(!i){throw new Error("Unclosed double quote")}n+=e.substr(t,i[0].length);t+=i[0].length}else{i=e.substr(t).match(/^([^'\\]|\\.)*'/);if(!i){throw new Error("Unclosed single quote")}var r=e.substr(t,i[0].length-1).replace(/"/g,'\\"');n+=r+'"';t+=i[0].length}}return n},deserialize:function(e){var t=e.substring(e.indexOf("["),e.lastIndexOf("]")+1);t=t.replace(/[\r\n\t]/g,"");t=this.rewriteSingleQuotes(t);var n=false;t=t.replace(/(^|")([^"\\]|\\.)*/g,function(e){if(!n){e=e.replace(/\]\d+\[/g,"],[").replace(/,\s*(?=,|\])/g,",null").replace(/\[\s*(?=,)/g,"[null")}n=!n;return e});t="["+t+"]";var i;try{i=JSON.parse(t)}catch(r){throw new Error("deserialization error")}return i},serialize:function(e,t){if(!e){return""}var i=")]}'\n\n";for(var r=0;r<e.length;r++){var a=e[r];var o=this.serializeArray(a);if(t){i+=o;continue}var s=o.length+1;i+=s+"\n"+o}if(t){var l=i.split(/\r|\n/);var u=n.initial(l,3);var c=n.last(l,3);i=u.join("\n");i+="\n"+c[0]+c[1].replace(/\"/g,"'")}return i},serializeArray:function(e){var t=f(e);var i="[";for(var r=0;r<e.length;r++){var a=e[r];var o="";if(n.isArray(a)){o=this.serializeArray(a)}else if(a==null){o=""}else{o=JSON.stringify(a);o=o.replace(/\</gim,"\\u003c").replace(/\=/gim,"\\u003d").replace(/\>/gim,"\\u003e").replace(/\&/gim,"\\u0026")}if(r>0){i+=","}i+=o}i+="]\n";return i},replaceThreadsInResponse:function(e,t){var n=p(e);var i=this.deserialize(e);var r=d(i,t);var a=this.serialize(r,!n);return a},test:function(e){var t=this.deserialize(e);return this.serialize(t)}});function d(e,t){var i=0;var r=h(e);var a={};for(var o=0;o<t.length;o++){a[t[o][0]]=true}var s;for(var o=0;o<r.length;o++){if(!a[r[o][0]]){s=n.clone(r[o]);s[7]=s[7].replace("<span",'<span streakhiderow="true"');s[7]=s[7].replace("<font",'<font streakhiderow="true"');break}}for(var o=0;o<r.length;o++){var l=r[o];if(i>=t.length){for(var u=0;u<s.length;u++){l[u]=s[u]}continue}var c=t[i];for(var u=0;u<c.length;u++){l[u]=c[u]}i++}return e}function h(e){var t=[];for(var i=0;i<e.length;i++){var r=e[i];if(f(r)){t.push(r)}else if(n.isArray(r)){var a=h(r);if(n.isReal(a)){t=t.concat(a)}}}if(t.length>0){return t}}function f(e){return n.isArray(e)&&e.length>=30&&n.isString(e[0])&&e[0].length===16&&n.isString(e[1])&&e[1].length===16&&n.isString(e[2])&&e[2].length===16}function p(e){var t=e.split(/\n|\r/);return!!t[2].match(/^\d/)}function m(t,n,i){var r=e.searchObject(t,n,100,false,true);if(!r){return}for(var a=0;r.length;a++){var o=_(r[a]);var s=y(t,o);if(i(s)){return s}}}function _(e){var t=n.rest(e.path.split("/"));return n.initial(t)}function g(e){return e.length>3&&n.isArray(e[3])&&e[3].length>0}function v(e){return e.length>20}function y(e,t){var n=e;for(var i=0;i<t.length;i++){var r=t[i];n=n[r]}return n}r.ThreadResponseProcessor=new c})(Streak);(function(e,t){var n=e._;var i={flags:{},getSentMail:function(e,t){this.get({view:"tl",start:"0",num:"100",rt:"c",search:"sent"}).getPromise().then(e,t)},getThread:function(e,t,n){var i={view:"cv",th:e,rt:"c",pcd:"1",mb:"0",search:"inbox"};this.get(i).getPromise().then(t,n)},get:function(t){if(!t){t={}}t.ik=GLOBALS[9];return new e.Request("GET",location.origin,location.pathname,{queryParameters:t,responseType:"text"})},getCurrentList:function(t,n){this.getList(location.hash.substring(1).split("?")[0],e.Gmail.getVisibleThreadRows().length).getPromise().then(t,n)},getList:function(t,i){var r=t.split("/");if(!i){i=100}var a=n.last(r);var o=0;if(a.match(/p\d+/)){var s=parseInt(a.replace(/p/,""),10);o=(s-1)*i}var l={ui:2,view:"tl",start:o,num:i,rt:"c",pcd:"1",mb:"0"};function u(e){var t=r[1].split("&");for(var n=0;n<t.length;n++){var i=t[n].split("=");l[e+"_"+i[0]]=decodeURIComponent(i[1])}}if(r.length>0){if(r[0]==="label"){l.search="cat";l.cat=e.Utils.decodeGmailURLSearchString(r[1])}else if(r[0]==="search"){l.search="query";l.q=e.Utils.decodeGmailURLSearchString(r[1]);l.qs="true"}else if(r[0]==="advanced-search"){u("as");l.search="adv"}else if(r[0]==="create-filter"){u("cf1");l.search="cf"}else{l.search=r[0];l.apps=r[0];if(r.length>1){l.q=e.Utils.decodeGmailURLSearchString(r[1])}}}return this.post(l)},post:function(t,n,i,r){if(!t){t={}}t.ik=GLOBALS[9];return new e.Request("POST",location.origin,location.pathname,{bodyData:t,responseType:"text"})},getContactDetails:function(t){var n={ac:false,cr:true,ct:true,emls:t,ev:true,f:"g2",gp:false,hl:"en",id:"personal",out:"js",type:4};return new e.Request("GET",location.origin,"/mail/c/u/0/data/contactstore",{queryParameters:n,responseType:"text"}).getPromise().then(function(e){var n=e.first(e.lastIndexOf("}")).substring(e.indexOf("{"));var i=n.match(/,\\"(\D+?\s?\w*?)\\"/gim);var r={email:t};if(i&&i.length>3){r.fullName=i[0].replace(/,\\\"(.*?)\\.*/gim,"$1");r.familyName=i[1].replace(/,\\\"(.*?)\\.*/gim,"$1");r.givenName=i[2].replace(/,\\\"(.*?)\\.*/gim,"$1")}return r})}};e.Gmail.GmailRequester=i})(Streak,window);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.RSVP,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h={getGmailThreadsForRFCMessageIds:function(e){var t=p(e||[]);return l.all(n.map(t,function(e){return m(e)})).then(function(e){return v(e)})}};var f={GROUP_SIZE:10};function p(e){var t=[];var n;for(var i=0;i<e.length;i++){if(i%f.GROUP_SIZE===0){if(n){t.push(n)}n=[]}n.push(e[i])}if(n&&n.length){t.push(n)}return t}function m(e){var t=_(e);return r.GmailRequester.getList(t).getPromise().then(function(e){try{var t=r.ThreadResponseProcessor.deserialize(e);return g(t)}catch(n){throw new Error(n)}})}function _(e){var t=n.map(e,function(e){return"rfc822msgid:"+e}).join(" OR ");return"apps/"+encodeURIComponent(t)}function g(e){if(!n.isArray(e)){return[]}if(e[0]==="tb"){return e[2]}return n.flatten(n.map(n.compact(e),g),true)}function v(e){return n.compact(n.flatten(e,true))}r.GmailThreadRequester=h})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=a.getEventStream();a.getSearchEventStream=function(){if(!a.searchEventStream){a.searchEventStream=h.filter(function(e){return e.eventName==="search"}).map(".arguments.0").filter(function(e){return e&&e.indexOf("label:all")===-1})}return a.searchEventStream}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={};d.TYPES={ENTITY_GROUP_WRITE:"ENTITY_GROUP_WRITE",ENTITY_GROUP_READ:"ENTITY_GROUP_READ",BOX_MOVE_PIPELINE:"BOX_MOVE_PIPELINE"};d.RULES={};d.RULES[d.TYPES.ENTITY_GROUP_WRITE]={TIME_BETWEEN_REQUESTS:1*1e3};d.RULES[d.TYPES.ENTITY_GROUP_READ]=null;d.RULES[d.TYPES.BOX_MOVE_PIPELINE]={TIME_BETWEEN_REQUESTS:2*1e3};i.set("Operations.OperationLimiterRules",d)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"OperationQueue",superclass:e.Object,_memberVariables:[{name:"_operationQueue",destroy:true,defaultValue:[]},{name:"_operationMetaDataMap",destroy:true,defaultValue:{}},{name:"_debug_isLogging",destroy:true,set:true,defaultValue:false},{name:"_debug_dontStartOperationsAutomatically",destroy:true,set:true,defaultValue:false},{name:"_mapOfOperationLimiterTagsAndTypesToStats",destroy:true,defaultValue:{}},{name:"_pendingOperationsCheckTimeout",destroy:true},{name:"_operationCount",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._operationCount=0},addOperation:function(t,n,i){if(!(t instanceof e.Operations.Operation)){throw new Error("must pass in an operation")}if(n&&!(n instanceof e.Operations.OperationStatusChangeHandler)){throw new Error("operationStatusChangeHandler is not valid")}if(this._debug_isLogging){console.debug("add operation: ",t)}i=i||e.guid();this._addOperationToQueue(t,n,i);if(this._debug_dontStartOperationsAutomatically){return}this._runOperationIfPossible(t);return i},addMultipleOperations:function(t,n){var i=e.guid();for(var r=0;r<t.length;r++){this._addOperationToQueue(t[r],n,i)}if(this._debug_dontStartOperationsAutomatically){return}for(var r=0;r<t.length;r++){this._runOperationIfPossible(t[r])}return i},getOperationProgressId:function(e){return this._operationMetaDataMap[e.getId()].operationProgressId},_addOperationToQueue:function(t,n,i){t.setState(e.Operations.Operation.STATES.NOT_STARTED);this._operationMetaDataMap[t.getId()]={timestamp:a.now(),operationCount:this._operationCount,operationStatusChangeHandler:n,operationProgressId:i};this._operationQueue.push(t);this._operationCount++},_debug_runNextOperation:function(){var t=this._queryOperationQueue({states:[e.Operations.Operation.STATES.NOT_STARTED]});if(t.length===0){return}this._runOperationIfPossible(t[0])},_runOperationIfPossible:function(t){if(this._areOperationDependenciesSatisfied(t)){this._changeOperationState(t,e.Operations.Operation.STATES.PENDING);this._runPendingOperations()}},_areOperationDependenciesSatisfied:function(t){var n=t.getDependentOnTags();if(!n||n.length===0){return true}var i=this._queryOperationQueue({states:[e.Operations.Operation.STATES.NOT_STARTED,e.Operations.Operation.STATES.PENDING,e.Operations.Operation.STATES.RUNNING],containsTags:n,beforeOperation:t});return i.length===0},_runPendingOperations:function(){clearTimeout(this._pendingOperationsCheckTimeout);var t=this._queryOperationQueue({states:[e.Operations.Operation.STATES.PENDING]});var n=[];for(var i=0;i<t.length;i++){var r=t[i];if(this._isOperationNotBlockedOnRateLimit(r)){this._startOperation(r)}else{n.push(r)}}if(n.length===0){return}var a=this._getSoonestPendingOperationTime(n);this._scheduleRunPendingOperations(a)},_isOperationNotBlockedOnRateLimit:function(e){var t=e.getLimiterTagsAndTypes();if(!t||t.length===0){return true}var n=true;for(var i=0;i<t.length;i++){n=n&&!this._isLimiterTagAndTypeBlocking(t[i])}return n},_isLimiterTagAndTypeBlocking:function(t){if(!this._mapOfOperationLimiterTagsAndTypesToStats[t.type]){return false}var n=this._mapOfOperationLimiterTagsAndTypesToStats[t.type];if(!n[t.tag]){return false}var i=n[t.tag];if(this._isOperationRunningFor(i)){return true}var r=e.Operations.OperationLimiterRules.RULES[t.type];return this._doesOperationFailRule(i.lastOperationStartTime,i.lastOperationEndTime,r)},_isOperationRunningFor:function(e){if(!e.lastOperationStartTime){return false}if(!e.lastOperationEndTime){return true}return e.lastOperationStartTime>e.lastOperationEndTime},_doesOperationFailRule:function(e,t,n){if(!n||!n.TIME_BETWEEN_REQUESTS){return false}var i=n.TIME_BETWEEN_REQUESTS;var r=a.now()-t;return r<n.TIME_BETWEEN_REQUESTS},_startOperation:function(t){this._updateMapOfOperationLimiterTagsAndTypes(t,"lastOperationStartTime");this._changeOperationState(t,e.Operations.Operation.STATES.RUNNING);try{t.doOperation(this._operationSucceeded.bind(this,t),this._operationFailed.bind(this,t))}catch(n){this._operationFailed(t);e.BentoBox.logError("Error doing operation",n)}},_updateMapOfOperationLimiterTagsAndTypes:function(e,t){var n=e.getLimiterTagsAndTypes();if(!n||n.length===0){return}for(var i=0;i<n.length;i++){var r=n[i];if(!this._mapOfOperationLimiterTagsAndTypesToStats[r.type]){this._mapOfOperationLimiterTagsAndTypesToStats[r.type]={}}var o=this._mapOfOperationLimiterTagsAndTypesToStats[r.type];if(!o[r.tag]){o[r.tag]={}}o[r.tag][t]=a.now()}},_getSoonestPendingOperationTime:function(e){if(!e||e.length===0){return}var t=Infinity;for(var n=0;n<e.length;n++){var i=this._getSoonestRateLimitedTimeToRun(e[n]);if(t>i){t=i}}},_scheduleRunPendingOperations:function(e){this._pendingOperationsCheckTimeout=setTimeout(this._runPendingOperations.bind(this),e)},_getSoonestRateLimitedTimeToRun:function(t){var n=t.getLimiterTagsAndTypes();if(!n||n.length===0){return 0}var i=Infinity;for(var r=0;r<n.length;r++){var a=n[r];var o=e.Operations.OperationLimiterRules.RULES[a.type];if(!o.TIME_BETWEEN_REQUESTS){continue}if(o.TIME_BETWEEN_REQUESTS<i){i=o.TIME_BETWEEN_REQUESTS}}return i},_operationSucceeded:function(t){this._changeOperationState(t,e.Operations.Operation.STATES.SUCCEEDED);this._finalizeOperation(t)},_operationFailed:function(t){this._changeOperationState(t,e.Operations.Operation.STATES.FAILED);this._finalizeOperation(t)},_changeOperationState:function(t,n){if(this._debug_isLogging){console.debug("change operation state. state:",n,"operation:",t)}t.setState(n);if(this._operationMetaDataMap[t.getId()].operationStatusChangeHandler){try{this._operationMetaDataMap[t.getId()].operationStatusChangeHandler.operationStateChanged(t)}catch(i){e.BentoBox.logError("Error changing operation state",i)}}},_finalizeOperation:function(e){this._updateMapOfOperationLimiterTagsAndTypes(e,"lastOperationEndTime");this._sendNotificationOfOperationCompletion(e);this._checkAndRunOperationsDependentOn(e);this._pruneOperationQueue()},_checkAndRunOperationsDependentOn:function(t){var i=t.getTags();if(!i||i.length===0){return}var r=this._queryOperationQueue({states:[e.Operations.Operation.STATES.NOT_STARTED],containsDependentOnTags:i});var a=this;n.chain(r).filter(function(e){return a._areOperationDependenciesSatisfied(e)}).each(function(t){a._changeOperationState(t,e.Operations.Operation.STATES.PENDING)});this._runPendingOperations()},queryOperationQueue:function(e){return this._queryOperationQueue(e)},_queryOperationQueue:function(e){var t=e.afterTimestamp||-Infinity;var i=e.beforeTimestamp||Infinity;var r=-Infinity;var a=Infinity;if(e.afterOperation){r=this._operationMetaDataMap[e.afterOperation.getId()].operationCount}if(e.beforeOperation){a=this._operationMetaDataMap[e.beforeOperation.getId()].operationCount}var o=[];for(var s=0;s<this._operationQueue.length;s++){var l=this._operationQueue[s];if(!l){continue}var u=this._operationMetaDataMap[l.getId()];if(!u){continue}var c=u.timestamp;if(c<=t||c>=i){continue}var d=u.operationCount;if(d<=r||d>=a){continue}if(e.states&&e.states.length>0){if(e.states.indexOf(l.getState())===-1){continue}}if(e.notStates&&e.notStates.length>0){if(e.notStates.indexOf(l.getState())!==-1){continue}}if(e.containsTags&&e.containsTags.length>0){if(!n.doArraysIntersect(l.getTags(),e.containsTags)){continue}}if(e.containsDependentOnTags&&e.containsDependentOnTags.length>0){if(!n.doArraysIntersect(l.getDependentOnTags(),e.containsDependentOnTags)){continue}}if(e.operationProgressId&&this._operationMetaDataMap[l.getId()].operationProgressId!==e.operationProgressId){continue}if(e.notOperationId&&e.notOperationId===l.getId()){continue}o.push(l)}return o},_pruneOperationQueue:function(){if(this._operationQueue.length<20){return}var t=0;var n={};for(var i=0;i<this._operationQueue.length;i++){var r=this._operationQueue[i];if(r.getState()!==e.Operations.Operation.STATES.SUCCEEDED&&r.getState()!==e.Operations.Operation.STATES.FAILED){return}}for(var i=0;i<this._operationQueue.length;i++){try{this._operationQueue[i].destroy()}catch(a){}}this._operationMetaDataMap={};this._operationQueue=[]},_sendNotificationOfOperationCompletion:function(e){var t=this._operationMetaDataMap[e.getId()].operationProgressId;var n=this._queryOperationQueue({operationProgressId:t});var i=this._calculateOperationProgressStats(n);l.postNotification({eventName:"operationProgressUpdate",operation:e,operationProgressId:t,operationProgressStats:i,operationIsComplete:i.total===i.succeeded+i.failed,operationHasErrors:i.failed>0,sender:this})},_calculateOperationProgressStats:function(t){var n={total:0,succeeded:0,failed:0};for(var i=0;i<t.length;i++){var r=t[i];var a=r.getState();switch(a){case e.Operations.Operation.STATES.SUCCEEDED:n.succeeded+=1;break;case e.Operations.Operation.STATES.FAILED:n.failed+=1;break}n.total+=1}n.isFinished=n.total===n.succeeded+n.failed;return n}});var h=new d;i.set("Operations.OperationQueue",d);i.set("Operations.OperationQueue.Singleton",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"Operation",superclass:e.Object,_memberVariables:[{name:"_id",destroy:true,get:true},{name:"_state",destroy:true,get:true,set:true},{name:"_isCanceled",destroy:true,defaultValue:false},{name:"_tags",destroy:true,get:true,set:true},{name:"_dependentOnTags",destroy:true,get:true,set:true},{name:"_limiterTagsAndTypes",destroy:true,get:true},{name:"_followUpOperation",destroy:false,get:true,set:true}],_initialize:function(t){e.Object.prototype._initialize.call(this);this._id=e.guid();if(t){this._tags=t.tags;this._dependentOnTags=t.dependentOnTags}},doOperation:function(e,t){if(this._isCanceled){t();return}throw new Error("must define doOperation")},cancel:function(){this._isCanceled=true}});d.STATES={NOT_STARTED:"NOT_STARTED",PENDING:"PENDING",RUNNING:"RUNNING",SUCCEEDED:"SUCCEEDED",FAILED:"FAILED"};i.set("Operations.Operation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"CallbackOperation",superclass:e.Operations.Operation,_memberVariables:[{name:"_callback",destroy:true}],_initialize:function(t){e.Operations.Operation.prototype._initialize.call(this,t);this._callback=t.callback},doOperation:function(e,t){try{this._callback();e()}catch(n){t()}}});i.set("Operations.CallbackOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.APIRequester,d=e.BentoBox;var h=32e3;var f=e.Class.subclass({className:"AjaxRequestOperation",superclass:e.Operations.Operation,_memberVariables:[{name:"_successCallback",destroy:false},{name:"_failureCallback",destroy:false},{name:"_method",destroy:true,set:true,get:true},{name:"_params",destroy:true,set:true,get:true},{name:"_response",destroy:false,get:true},{name:"_xhr",destroy:false,get:true},{name:"_currentBackoff",destroy:true,defaultValue:400}],_initialize:function(t){e.Operations.Operation.prototype._initialize.call(this,t);if(t){this._params=t.params||{};this._method=t.method;if(t.url){this._params.url=t.url}}},doOperation:function(e,t){this._successCallback=e;this._failureCallback=t;this._executeAjaxRequest()},_executeAjaxRequest:function(){var e=this.getParams();var t=e.url;delete e.url;c[this.getMethod().toLowerCase()](t,e).getPromise().then(this._handleSuccess.bind(this),this._handleError.bind(this))
},_handleSuccess:function(e){this._response=e;this._successCallback(this);delete this._successCallback;delete this._failureCallback},_handleError:function(e){var t=e&&e.response;var n=e&&e.xhr;switch(n&&n.status){case 0:case 500:this._backoffAndExecuteAjaxRequest();return}this._response=t;this._xhr=n;this._failureCallback(this);delete this._successCallback;delete this._failureCallback},_backoffAndExecuteAjaxRequest:function(){this._currentBackoff=Math.min(this._currentBackoff*2,h);setTimeout(this._executeAjaxRequest.bind(this),this._currentBackoff)}});i.set("Operations.AjaxRequestOperation",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.APIRequester,d=e.BentoBox;var h={LIMIT:1e3,BRANCH_FACTOR:3};var f=e.Class.subclass({className:"ListFanoutAjaxRequestOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_requestStage",destroy:true},{name:"_countHint",destroy:false,defaultValue:0},{name:"_requestResults",destroy:true}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);if(this.getCountHint){this._countHint=this.getCountHint()||0}this._requestResults=[]},_executeAjaxRequest:function(){this._requestStage=-1;this._requestNextStage()},_requestNextStage:function(){this._requestStage+=1;var e=this._getResultStartIndex();var t=this._getResultEndIndex();for(var n=e;n<=t;n++){this._requestListPage(n)}},_getResultStartIndex:function(){var e=0;for(var t=0;t<this._requestStage;t++){e+=Math.pow(h.BRANCH_FACTOR,t)}if(this._requestStage>0){e+=this._getShiftFactor()}return e},_getResultEndIndex:function(){var e=this._getShiftFactor();for(var t=0;t<this._requestStage+1;t++){e+=Math.pow(h.BRANCH_FACTOR,t)}return e-1},_getShiftFactor:function(){if(this._countHint){return this._countHint<=h.LIMIT?0:Math.ceil(this._countHint/h.LIMIT)}else{return 0}},_requestListPage:function(e){var t=this;var i={limit:h.LIMIT,page:e};i.limit=h.LIMIT;i.page=e;if(this.getParams()){n.extend(i,this.getParams())}var r=i.url;delete i.url;var a;if(this.getExtraOptions&&this.getExtraOptions()){a=this.getExtraOptions()}c[this.getMethod().toLowerCase()](r,i,a).getPromise().then(function(n){if(n&&n.error){t._requestResults[e]=-1}else{t._requestResults[e]=n}t._verifyResponses()},function(){t._requestResults[e]=-1;t._verifyResponses()})},_verifyResponses:function(){var e=this._getResultStartIndex();var t=this._getResultEndIndex();var i=false;var r=false;var a=false;var o=-1;for(var s=e;s<=t;s++){var l=this._requestResults[s];if(n.isNotReal(l)){a=true;break}if(l===-1){i=true;break}if(l.results){if(l.hasNextPage){o=s}r=true}else{if(l.length<h.LIMIT){r=true}}}if(a){return}if(i){this._error();return}if(o==t){this._requestNextStage();return}if(!r){this._requestNextStage();return}this._consolidateResults()},_consolidateResults:function(){var e=[];for(var t=0;t<this._requestResults.length;t++){var n=this._requestResults[t];if(n){if(n.results){e=e.concat(n.results)}else{e=e.concat(this._requestResults[t])}}}this._handleSuccess(e)},_error:function(){this._failureCallback(this)}});i.set("Operations.ListFanoutAjaxRequestOperation",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"CollectionRequestOperation",superclass:e.Operations.ListFanoutAjaxRequestOperation,_memberVariables:[{name:"_collection",destroy:false,get:true}],_initialize:function(t){this._collection=t.collection;e.Operations.ListFanoutAjaxRequestOperation.prototype._initialize.call(this,t)},getTags:function(){return this._collection.getRequestTags("REFRESH")},getDependentOnTags:function(){return this._collection.getRequestDependentOnTags("REFRESH")}});i.set("Operations.CollectionRequestOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"CollectionRefreshOperation",superclass:e.Operations.CollectionRequestOperation,_memberVariables:[],_initialize:function(t){e.Operations.CollectionRequestOperation.prototype._initialize.call(this,t)},getMethod:function(){return"GET"},getParams:function(){var e={url:this._collection.getApiURL()};if(this._collection.refreshParameters){n.extend(e,this._collection.refreshParameters)}return e},getCountHint:function(){if(this._collection.getCountHint){return this._collection.getCountHint()}},getExtraOptions:function(){return this._collection.getRequestExtraOptions()}});i.set("Operations.CollectionRefreshOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ModelRequestOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_model",destroy:false,get:true}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);this._model=t.model;this._tags=this._getTags();this._dependentOnTags=this._getDependentOnTags();this._limiterTagsAndTypes=this._getLimiterTagsAndTypes()},_getTags:function(){var e=this._tags||[];return e.concat(this._model.getRequestTags(this._getRequestType()))},_getDependentOnTags:function(){var e=this._dependentOnTags||[];return e.concat(this._model.getRequestDependentOnTags(this._getRequestType()))},_getLimiterTagsAndTypes:function(){return this._model.getRequestLimiterTagsAndTypes(this._getRequestType())},_getRequestObject:function(){var e={};n.extend(e,this._model.getWrappedObject());if(!this._model.getExtraRequestParameters||!this._model.getExtraRequestParameters(this._getRequestType())){return e}var t=this._model.getExtraRequestParameters(this._getRequestType());var i={};n.extend(i,t,e);return i},_handleError:function(e){var t=e&&e.response;var n=e&&e.xhr;switch(n&&n.status){case 0:case 500:this._backoffAndExecuteAjaxRequest();return;break;case 404:this._model.remove();break}this._response=t;this._xhr=n;this._broadcastErrorNotification();this._failureCallback(this)},_broadcastErrorNotification:function(){switch(this._xhr&&this._xhr.status){case 401:e.NotificationCenter.postNotification({eventName:"unauthorizedRequest",sender:this});break;case 409:e.NotificationCenter.postNotification({eventName:"409Conflict",model:this._model,response:this._response,sender:this});break}}});i.set("Operations.ModelRequestOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ModelRefreshOperation",superclass:e.Operations.ModelRequestOperation,_memberVariables:[],_initialize:function(t){e.Operations.ModelRequestOperation.prototype._initialize.call(this,t)},getMethod:function(){return"GET"},getParams:function(){var e=this._getRequestObject();return{url:n.template(this._model.apiURLs.get)(e)}},_getRequestType:function(){return"REFRESH"}});i.set("Operations.ModelRefreshOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ModelDeleteOperation",superclass:e.Operations.ModelRequestOperation,_memberVariables:[],_initialize:function(t){e.Operations.ModelRequestOperation.prototype._initialize.call(this,t)},doOperation:function(t,n){if(this._model.isSavedOnServer()){e.Operations.ModelRequestOperation.prototype.doOperation.apply(this,[t,n]);return}this._successCallback=t;this._failureCallback=n;setTimeout(t,1,this)},getMethod:function(){return"DELETE"},getParams:function(){var e=this._getRequestObject();return{url:n.template(this._model.apiURLs["delete"])(e)}},_getRequestType:function(){return"DELETE"}});i.set("Operations.ModelDeleteOperation",d)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ModelCreateOperation",superclass:e.Operations.ModelRequestOperation,_memberVariables:[{name:"_editOperations",destroy:false,set:true,get:true}],_initialize:function(t){this._editOperations=t.editOperations;e.Operations.ModelRequestOperation.prototype._initialize.call(this,t)},getMethod:function(){return"PUT"},getParams:function(){var e=this._getRequestObject();var t={url:n.template(this._model.apiURLs.create)(e)};var i=this._model.createProperties;n.each(i,function(n){if(e[n]!==undefined){t[n]=e[n]}});return t},_getTags:function(){var e=this._tags||[];return e.concat(this._model.getRequestTags(this._getRequestType(),this._editOperations,this.getId()))},_getLimiterTagsAndTypes:function(){return this._model.getRequestLimiterTagsAndTypes(this._getRequestType(),this._editOperations,this.getId())},_getRequestType:function(){return"CREATE"},_getRequestBaseObject:function(){return e.Operations.ModelRequestOperation.prototype._getRequestObject.call(this)},_getRequestObject:function(){var e=this._getRequestBaseObject();n.each(this._editOperations,function(t){if(t.operationId===this.getId()){e[t.property]=t.value}},this);return e},_needsToBeCreated:function(){return!this._model.isSavedOnServer()}});i.set("Operations.ModelCreateOperation",d)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ModelUpdateOperation",superclass:e.Operations.ModelRequestOperation,_memberVariables:[{name:"_editOperations",destroy:false,set:true,get:true}],_initialize:function(t){this._editOperations=t.editOperations;e.Operations.ModelRequestOperation.prototype._initialize.call(this,t)},doOperation:function(t,n){var i=this._getEditOperations();if(i.length===0){setTimeout(t,1,this)}else{e.Operations.ModelRequestOperation.prototype.doOperation.apply(this,[t,n])}},getMethod:function(){return"POST"},getParams:function(){var e=this._getRequestObject();var t={url:n.template(this._model.apiURLs.update,this._getURLObject()),json:JSON.stringify(e)};var i=this._model.getExtraUpdateParameters();n.extend(t,i);return t},_getTags:function(){var e=this._tags||[];return e.concat(this._model.getRequestTags(this._getRequestType(),this._editOperations,this.getId()))},_getLimiterTagsAndTypes:function(){return this._model.getRequestLimiterTagsAndTypes(this._getRequestType(),this._editOperations,this.getId())},_getRequestType:function(){return"UPDATE"},_getRequestObject:function(){var e={};this._getEditOperations().forEach(function(t){e[t.property]=t.value});return e},_getURLObject:function(){var t=e.Operations.ModelRequestOperation.prototype._getRequestObject.call(this);this._getEditOperations().forEach(function(e){t[e.property]=e.value});return t},_getEditOperations:function(){var e=this.getId();return this._editOperations.filter(function(t){return t.operationId===e})}});i.set("Operations.ModelUpdateOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"OperationStatusChangeHandler",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},operationStateChanged:function(t){if(t.getState()===e.Operations.Operation.STATES.SUCCEEDED){this._operationSucceeded(t);return}if(t.getState()===e.Operations.Operation.STATES.FAILED){this._operationFailed(t);return}},_operationSucceeded:function(e){throw new Error("must implement _operationSucceeded function")},_operationFailed:function(e){throw new Error("must implement _operationFailed function")}});i.set("Operations.OperationStatusChangeHandler",d)})(Streak);(function(e,t){var n=e.jQuery,i=e._,r=e.Gmail,a=e.APIRequester,o=e.HTML,s=e.Eventer;Messenger.storeData("clientVersion",e.clientVersion);var l=e.getCombined("css",true);var u="mailfoogae.appspot.com";var c="pnnfemgpilpdaojpnkjdgfgbnnjojfik";e.DependencyManager.notifyFunctionFinished("bentoBoxServerSet");var d=new s;i.extend(d,{currentTime:null,Controllers:{},Services:{},Models:{},Modules:{},Widgets:{},isError:false,maxGetUserAttempts:2,Constants:{SERVER:null,EMAIL_BLACK_LIST:["gmail.com","facebook.com","aol.com","yahoo.com","hotmail.com","att.net","googlemail.com"],COLOR_LIST:["RGB(99,99,48)","IndianRed","Salmon","CornflowerBlue","DodgerBlue","LightSlateGray","LightSteelBlue","RGB(90,105,134)","RGB(235,112,0)","RGB(179,109,0)","RGB(171,139,0)"]},user:null,userSettings:null,userEmail:null,_isReady:false,_readyFuncs:[],_isLoggedOutReady:false,_loggedOutReadyFuncs:[],_isLoaded:false,_isDataInitialized:false,_loadedFuncs:[],_isDisconnected:false,_isTornDown:false,init:function(t){this.userEmail=e.userEmail;var n=this;this.bind("criticalError",function(){n.criticalError()});this.bind("newClientVersion",function(){n.newClientVersion()});this.bind("newExtVersion",function(){n.newExtVersion()});this.bind("noThirdPartyCookie",function(){n.noThirdPartyCookie()});e.NotificationCenter.subscribe({eventName:"unauthorizedRequest",functionToCall:this.unauthorizedRequest,observer:this});e.NotificationCenter.subscribe({eventName:"reauthorized",functionToCall:this.reauthorized,observer:this});if(t){t()}},unauthorizedRequest:function(){if(this._isDisconnected){return}this._isDisconnected=true;this.teardown();this.Modules.TopNav.gotLoggedOut()},reauthorized:function(){this._isDisconnected=false;this.reup()},isLoggedIn:function(){return this.getUser()&&this.getUser().get("isOauthComplete")},criticalError:function(){if(this._isDisconnected){return}this._isDisconnected=true;if(this._isReady){this.teardown();this.establishConnection()}else{this.teardown()}},newClientVersion:function(){this.teardown();this.Modules.TopNav.showClientUpdateNeeded();this.Modules.TopNav.openMenu()},newExtVersion:function(){this.teardown();this.Modules.TopNav.showExtensionUpdateNeeded();this.Modules.TopNav.openMenu()},establishConnection:function(e,t){var n=this;if(!e){e=1}if(e===1){this.ButterBarManager.showError("Error communicating with Streak servers, retrying now...",{messageKey:"bentoBoxCommunicationError"})}this.connectionTest(function(){n._isDisconnected=false;n.ButterBarManager.hideMessage("bentoBoxCommunicationError");n.reup()},function(){e+=1;if(!t){t=2e3}else{t=Math.min(t*2,6e4)}n.ButterBarManager.showError("Streak: retrying in "+t/1e3+" seconds",{messageKey:"bentoBoxCommunicationError"});setTimeout(function(){n.establishConnection(e,t)},t)})},connectionTest:function(e,t){var n=this;a.get("users/me").then(function(t){if(t&&t.isOauthComplete){e()}else{n.reset()}},function(e){if(e&&e.error==="user not logged in"){n.reset()}else{t()}})},reset:function(){this.ButterBarManager.hideMessage("messageKey");this.reup();this.trigger("logged_out")},teardown:function(){var t=this;if(t._isTornDown){return}t._isTornDown=true;delete e.DependencyManager._mapOfFinishedFunctionKeys["teardown"];e.DependencyManager.addFunction({functionKey:"teardown",functionToCall:function(n){t.UI.teardown();for(var i in t.Modules){if(t.Modules[i].teardown){t.Modules[i].teardown()}}e.NotificationCenter.postNotification({eventName:"streak.teardown"});t.Modules.TopNav.haltExecution();r.teardown();if(n){n()}},dependentFunctionKeys:["topNavInitialized","gmailLoaded","htmlLoaded","localeLoaded"]})},reup:function(){var t=this;if(!t._isTornDown){return}t._isTornDown=false;for(var n in t.Modules){if(t.Modules[n].reup){try{t.Modules[n].reup()}catch(i){t.logError("Reupping bad for: "+n,i)}}}e.NotificationCenter.postNotification({eventName:"streak.reup"});r.reup();r.detectViewChange({fragment:location.hash.substring(1)});t.trigger("reup")},isTornDown:function(){return this._isTornDown},destroy:function(){this.teardown();this.Modules.TopNav.destroy();r.destroy();this.UI.destroy();v()},addCSSFile:function(e){r.insertCss(l);if(e){e()}},triggerFirstGmailViewChange:function(t){this._isReady=true;r.checkAndTriggerInitialConversationView();r.detectViewChange({fragment:location.hash.substring(1)});if(t){t()}e.NotificationCenter.postNotification({eventName:"bentoBoxIsReady"})},setUser:function(e){this.user=this.Models.User.create(e)},getUser:function(){return this.user},isExperimentEnabled:function(e){return this.EnabledFeaturesController.isFeatureEnabled(e)},isFeatureEnabled:function(e){return this.EnabledFeaturesController.isFeatureEnabled(e)},getUserSettings:function(){return this.userSettings},logError:function(t,n,i){if(!t&&!n){console.error("logError() called with no arguments.");return}t=t||"No message given.";if(n){if(n.alreadyLogged){return}n.alreadyLogged=true;if(n.message){t+="\n message: "+n.message}else{try{t+="\n error: "+JSON.stringify(n)}catch(r){t+="\n error: "+n}}if(n.stack){t+="\n stack: "+n.stack}if(n.details){var o=n.details;if(typeof o=="object"){try{o=JSON.stringify(o)}catch(s){}}t+="\n details: "+o}}else{t+="\n stack:\n"+e.Utils.getStackTrace()}if(i){if(typeof i=="object"){try{i=JSON.stringify(i)}catch(s){}}t+="\n extra: "+i}if(this.userEmail){t+="\n user: "+this.userEmail}t+="\n clientVersion: "+e.clientVersion;t+="\n extVersion: "+e.extVersion;t+="\n sdkVersion: "+(e.Gmail.inboxSDK&&e.Gmail.inboxSDK.LOADER_VERSION);t+="\n sdkImplVersion: "+(e.Gmail.inboxSDK&&e.Gmail.inboxSDK.IMPL_VERSION);t+="\n url: "+location.toString();t+="\n operationQueue length: "+e.Operations.OperationQueue.Singleton._operationQueue.length;t+="\n subscription length:"+e.NotificationCenter._subscriptions.length;console.debug(t);a.error(t).getPromise().catch(function(e){console.error("Error reporting error:",e)})},installErrorReporter:function(t,n){"use strict";t.addEventListener("error",function o(e){try{var t=e.message;var i=e.filename;var r=e.lineno;var a=e.colno;var o=e.error;if(!b(t,i,r)){if(d.isErrorOurs(o)||d.isUrlOurs(i)||d.isUrlOurs(t)){var s="Caught by window.onerror"+"\n  Original Error Object Present: "+!!o+"\n  Location: "+i+":"+r+(a!=null?":"+a:"");if(n){s+="\n  Window label: "+n}d.logError(t,o,s)}}}catch(l){console.error("Error reporting error!",l)}},false);var r=!e.isNotContentScript||navigator.userAgent.toLowerCase().indexOf("chrome")==-1;if(r){g(t,"setTimeout",function(e){return function t(){var t=i.toArray(arguments);if(typeof t[0]=="function"){t[0]=m(t[0],"setTimeout callback")}return e.apply(this,t)}});g(t,"setInterval",function(e){return function t(){var t=i.toArray(arguments);if(typeof t[0]=="function"){t[0]=m(t[0],"setInterval callback")}return e.apply(this,t)}});var a=t.EventTarget?t.EventTarget.prototype:t.Node.prototype;g(a,"addEventListener",function(e){return function t(){var t=i.toArray(arguments);if(typeof t[1]=="function"){try{var n=t[1].__streak_logged;if(!n){n=m(t[1],"event listener");t[1].__streak_logged=n}t[1]=n}catch(r){console.error("Failed to error wrap function",r)}}return e.apply(this,t)}});g(a,"removeEventListener",function(e){return function t(){var t=i.toArray(arguments);if(typeof t[1]=="function"&&t[1].__streak_logged){t[1]=t[1].__streak_logged}return e.apply(this,t)}});g(t,"MutationObserver",function(e){e=e||t.WebKitMutationObserver;function n(){var t=i.toArray(arguments);if(typeof t[0]=="function"){t[0]=m(t[0],"MutationObserver callback")}if(e.bind&&e.bind.apply){return new(e.bind.apply(e,[null].concat(t)))}else{return new e(t[0])}}n.prototype=e.prototype;return n})}},isUrlOurs:function(e){return typeof e=="string"&&(e.indexOf(u)>-1||e.indexOf(c)>-1)},isErrorOurs:function(t,n){if(!t){return false}if(!e.isNotContentScript){return true}var i=t.stack;if(typeof i=="string"&&n){i=i.trim().replace(/\n[^\n]*$/,"")}return this.isUrlOurs(t.message)||this.isUrlOurs(t.fileName)||this.isUrlOurs(i)}});e.userEmail=GLOBALS[10];if(!e.userEmail||!e.userEmail.isValidEmail()){Messenger.storeData("useremail","broken.noemail@streak.com");return}else{try{var h=e.searchObject(GLOBALS,e.userEmail,100,true,true);if(h.length>0){for(var f=0;f<h.length;f++){if(h[f].el.toLowerCase()===e.userEmail&&h[f].el!==e.userEmail){e.originalEmail=h[f].el;break}}}}catch(p){}Messenger.storeData("useremail",e.userEmail)}var m=function(e,t){return function(){try{return e.apply(this,arguments)}catch(n){if(n.stack){if(d.isErrorOurs(n,true)){var i=t?"Uncaught error in "+t:"Uncaught error";d.logError(i,n)}else{n.alreadyLogged=true}}throw n}}};var _=[];var g=function(e,t,n){var i=n(e[t]);i.__streak_original=e[t];e[t]=i;_.push({parent:e,name:t})};var v=function(){i.each(_,function(e){if(e.parent[e.name].__streak_original){e.parent[e.name]=e.parent[e.name].__streak_original}else{d.logError("Function already un-error-wrapped: "+e.name)}});_.length=0};d.installErrorReporter(t);try{var y=top.document.getElementById("js_frame");if(y){d.installErrorReporter(y.contentWindow,"js_frame")}}catch(w){d.logError("Failed to install error reporter on js_frame",w)}e.RSVP.on("error",function(e){d.logError("possibly uncaught error in promise",e)});function b(e,t,n){if(e=="Script error."&&!n){return true}if(e=='Uncaught SecurityError: Blocked a frame with origin "https://mail.google.com" from accessing a cross-origin frame.'){return true}return false}e.BentoBox=d;d.Locale=e.Locale;e.logError=e.BentoBox.logError;e.DependencyManager.addFunction({functionKey:"bentoBoxInitialized",functionToCall:d.init,functionContext:d});e.DependencyManager.addFunction({functionKey:"bentoBox.addCSSFile",functionToCall:d.addCSSFile,functionContext:d,dependentFunctionKeys:["gmailLoaded"]});e.DependencyManager.addFunction({functionKey:"bentoBox.triggerFirstGmailViewChange",functionToCall:d.triggerFirstGmailViewChange,functionContext:d,dependentFunctionKeys:["navMenuInitialized","labelIndicatorsInitialized","snippetsComposeMasterControllerInitialized","userSettingsInitialized","enabledFeaturesControllerInitialized","data.pipelines.initialized","data.boxes.initialized","accessManagerInitialized"]})})(Streak,window);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox,d=e.Operations,h=e.Operations.OperationQueue.Singleton;var f=e.Class.subclass({className:"ModelOperationManager",superclass:d.OperationStatusChangeHandler,_memberVariables:[],_initialize:function(){d.OperationStatusChangeHandler.prototype._initialize.call(this)},refresh:function(e){var t=this._createRefreshOperation(e);var n=this;return h.addOperation(t,n)},_createRefreshOperation:function(t){return new e.Operations.ModelRefreshOperation({model:t})},del:function(t){var n=this._createDeleteOperation(t);var i=e.Operations.OperationQueue.Singleton.addOperation(n,this);this._showDeletingMessage(i,t);return i},deleteAll:function(e){var t=[];for(var n=0;n<e.length;n++){var i=this._createDeleteOperation(e[n]);t.push(i)}var r=h.addMultipleOperations(t,this);return r},_createDeleteOperation:function(t){return new e.Operations.ModelDeleteOperation({model:t})},save:function(e,t,i){var r=[];if(e.needsCreateOperation()){var a=this._getValidCreateEditOperations(e,t);r=n.difference(t,a);var o=this._getNewModelCreateOperation(e,a);t=a;e.setCreateOperationGenerated()}else{var o=this._getNewModelUpdateOperation(e,t)}this._markEditOperations(t,o);var s=h.addOperation(o,this);if(!i){this._showSavingMessage(s,{operation:o,model:e,editOperations:t})}if(r.length>0){this.save(e,r,i)}return s},saveAll:function(e,t,i){var r=[];for(var a=0;a<e.length;a++){var o=e[a];var s=t[a];if(o.needsCreateOperation()){var l=this._getValidCreateEditOperations(o,s);var u=n.difference(s,l);if(!n.isEmpty(u)){e.push(o);s.push(u)}var c=this._getNewModelCreateOperation(o,l);s=l;o.setCreateOperationGenerated()}else{var c=this._getNewModelUpdateOperation(o,s)}this._markEditOperations(s,c);r.push(c)}var d=h.addMultipleOperations(r,this);if(!i){this._showSavingMessage(d)}return d},dependentSaveAll:function(t,i){var r=[];var a=e.guid();for(var o=0;o<t.length;o++){var s=t[o];var l=i[o];if(s.needsCreateOperation()){var u=this._getValidCreateEditOperations(s,l);var c=n.difference(l,u);if(!n.isEmpty(c)){t.push(s);l.push(c)}l=u;var d=this._getNewModelCreateOperation(s,l);s.setCreateOperationGenerated()}else{var d=this._getNewModelUpdateOperation(s,l)}d.getTags().push(a);d.getDependentOnTags().push(a);this._markEditOperations(l,d);r.push(d)}var f=h.addMultipleOperations(r,this);return f},_getNewModelCreateOperation:function(t,n){return new e.Operations.ModelCreateOperation({model:t,editOperations:n})},_getNewModelUpdateOperation:function(t,n){return new e.Operations.ModelUpdateOperation({model:t,editOperations:n})},_getValidCreateEditOperations:function(e,t){return n.filter(t,function(t){return n.contains(e.createProperties,t.property)})},_operationSucceeded:function(e){if(e.getMethod()==="DELETE"){return}this.updateModel(e.getModel(),e.getResponse(),e.getId())},_operationFailed:function(e){e.getModel().clearEditOperationsWithOperationId(e.getId(),{isUndo:true});e.getModel().postNotification("change");var t=e.getModel().getModelsAffectedByServerResponse();for(var n=0;n<t.length;n++){this._notifyModelRequestsComplete(t[n],true,e)}},updateModel:function(e,t,n,i){if(!t){this._notifyModelRequestsComplete(e);return false}var r=false;var a=e.getModelsAffectedByServerResponse(t);for(var o=0;o<a.length;o++){r=r||this._mergeResponseServerObjectWithModel(a[o],t,n);if(!i){this._notifyModelRequestsComplete(a[o])}}return r},_markEditOperations:function(e,t){if(!e){return}for(var n=0;n<e.length;n++){var i=e[n];if(!i.operationId){i.operationId=t.getId()}}},_mergeResponseServerObjectWithModel:function(e,t,n){var i=e.getResponseObjectAffectingModel(t);if(i){if(!e.isResponseMoreRecent(i)){return false}e.updateWrappedObjectAndClearEditOperations(i,n)}var r=e.getCollectionProperties();if(!r||r.length===0){return}for(var a=0;a<r.length;a++){this._modifyPropertyCollection(r[a],e,t)}return true},_modifyPropertyCollection:function(t,n,i){var r=n.getPropertyCollection(t);var a=n.getResponseForCollection(t,i);e.Operations.CollectionOperationManager.Singleton.updateCollectionWithResponse(r,a)},_notifyModelRequestsComplete:function(t,n,i){var r=h.queryOperationQueue({states:[e.Operations.Operation.STATES.NOT_STARTED,e.Operations.Operation.STATES.PENDING,e.Operations.Operation.STATES.WORKING],containsTags:[t.getModelTag()]});if(r&&r.length>0){return}if(t.requestsCompleted){var a=null;if(n){a=new Error("Model request error");a.response=i.getResponse();a.details={response:a.response,status:i.getXhr().status,method:i.getMethod(),entityType:t.entityType}}t.requestsCompleted(n,a)}},_showSavingMessage:function(e,t){if(t&&t.model&&t.editOperations){if(!t.model.shouldShowSavingMessage(t.editOperations)){return}}var n=null;if(t&&t.operation){n=t.operation.getMethod()}c.ButterBarManager.showSaving({operationProgressId:e,showConfirmation:n!=="PUT"})},_showDeletingMessage:function(e,t){c.ButterBarManager.showMessage(c.Locale.getString("deleting"),{operationProgressId:e})}});i.set("Operations.ModelOperationManager",f);i.set("Operations.ModelOperationManager.Singleton",new f)})(Streak);(function(e,t){"use strict";var n=e._,i=e.NotificationCenter;var r=e.iframe.contentWindow.Array;n.extend(r.prototype,{init:function(t){this._apiURL=t.apiURL;this._requestExtraOptions=t.requestExtraOptions;this.getCountHint=t.getCountHint;this._keyToModelMap={};this._idToModelMap={};this._id=e.guid();this.createModelFromRawJSON=t.createModelFromRawJSON;this._isInTransaction=false;this._hasLoaded=false;this._afterLoadDeferred=e.Promise.defer();this._requestTags=t.requestTags;this._requestDependentOnTags=t.requestDependentOnTags;this._refreshRequeueOperationTags=t.refreshRequeueOperationTags;this._modelKeyPropertyName=t.modelKeyPropertyName;this._isSorted=false;this._sortParameter=null;this._bindToModelEvents();var i=this;this._postCollectionChangeNotification=n.debounce(function(){i._postNotification("collectionChange")},50)},getId:function(){return this._id},getApiURL:function(){return this._apiURL},getRequestExtraOptions:function(){return this._requestExtraOptions},add:function(e){if(this._keyToModelMap[e.key()]){return}this.push(e);this._isSorted=false;if(e.key()){this._keyToModelMap[e.key()]=e}this._idToModelMap[e.getId()]=e;this._postNotification("add",{model:e});this._postNotification("change",{model:e});this._postCollectionChangeNotification()},remove:function(e){this._removeFromArray(e);if(!this._idToModelMap[e.getId()]){return}delete this._keyToModelMap[e.key()];delete this._idToModelMap[e.getId()];e.postNotification("removedFromCollection");this._postNotification("remove",{model:e});this._postNotification("change");this._postCollectionChangeNotification()},refresh:function(t){var n=e.Operations.CollectionOperationManager.Singleton.refresh(this);e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:n,operationIsComplete:true},unsubscribeImmediately:true,functionToCall:function(){this._hasLoaded=true;this._afterLoadDeferred.resolve();if(t){t.apply(this,arguments)}},observer:this});return n},getByKey:function(e){return this._keyToModelMap[e]},getRequestTags:function(e){return this._requestTags},getRequestDependentOnTags:function(e){return this._requestDependentOnTags},getRefreshRequeueOperationTags:function(){return this._refreshRequeueOperationTags},startTransaction:function(){this._isInTransaction=true;i.startTransaction(this.getId())},endTransaction:function(e){this._isInTransaction=false;i.endTransaction(this.getId(),e)},getHasLoaded:function(){return this._hasLoaded},afterLoad:function(){return this._afterLoadDeferred.promise},watch:function(e,t,n){if(!e){return}if(!t){return}return i.subscribe({eventName:e,filterParameters:{sender:this},functionToCall:t,observer:n})},getEventStream:function(){var e=this;return i.getNotificationStream().filter(function(t){return t.sender===e})},postNotification:function(e,t){this._postNotification(e,t)},sortByParameter:function(e){if(this._isSorted&&this._sortParameter===e){return}this.sort(function(t,n){var i=t.get(e);var r=n.get(e);if(i!==r){if(i>r||i===void 0)return 1;if(i<r||r===void 0)return-1}return 0});this._isSorted=true;this._sortParameter=e},sort:function(){this._isSorted=false;Array.prototype.sort.apply(this,n.toArray(arguments))},_postNotification:function(e,t){if(!e){return}var r=e;var a={collectionId:this.getId(),collection:this,sender:this};var o;if(this._isInTransaction){o=this.getId()}if(t){n.extend(a,t)}a.eventName=r;i.postNotification(a,o)},_bindToModelEvents:function(){var e=this;i.subscribe({functionToCall:this._modelEvent,observer:this})},_modelEvent:function(e){if(e.collection){return}if(!this._idToModelMap[e.modelId]&&!this._idToModelMap[e.parentModelId]){return}switch(e.eventName){case"keyChanged":this._modelKeyChanged(e);break;case"delete":this._modelDeleted(e);break}var t={};n.extend(t,e);t.sender=this;if(t.parentModelId&&this._idToModelMap[t.parentModelId]){t.model=this._idToModelMap[t.parentModelId];t.modelId=t.model.getId();delete t.parentModelId;delete t.parentModel}this._postNotification(e.eventName,t)},_modelKeyChanged:function(e){var t=e.oldKey;if(t){delete this._keyToModelMap[t]}if(e.newKey){this._keyToModelMap[e.newKey]=e.model}},_modelDeleted:function(e){this.remove(e.model)},_removeRegionFromArray:function(e,t){var n=this.slice((t||e)+1||this.length);this.length=e<0?this.length+e:e;return this.push.apply(this,n)},_removeFromArray:function(e){var t=this.indexOf(e);if(t>-1){this._removeRegionFromArray(t);return true}return false}});r.refreshAll=function(t){return e.Operations.CollectionOperationManager.Singleton.refreshAll(t)};e.Collection=r})(Streak,window);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox,d=e.Operations,h=e.Operations.OperationQueue.Singleton;var f=e.Class.subclass({className:"CollectionOperationManager",superclass:d.OperationStatusChangeHandler,_memberVariables:[],_initialize:function(){e.Operations.OperationStatusChangeHandler.prototype._initialize.call(this)
},refresh:function(e){var t=this._getRefreshOperationForCollectionRefresh(e);if(t){return h.getOperationProgressId(t)}var n=this._createRefreshOperation(e);var i=this;return h.addOperation(n,i)},refreshAll:function(e){var t=n.map(e,this._createRefreshOperation);var i=this;return h.addMultipleOperations(t,i)},_getRefreshOperationForCollectionRefresh:function(t){var n=t.getRequestTags("REFRESH");var i=h.queryOperationQueue({notStates:[e.Operations.Operation.STATES.SUCCEEDED,e.Operations.Operation.STATES.FAILED],containsTags:n});if(i.length>0){return i[0]}return null},_createRefreshOperation:function(e){return new d.CollectionRefreshOperation({collection:e})},_operationSucceeded:function(e){var t=e.getCollection();if(this._shouldRequeueOperation(e)){h.addOperation(new d.CollectionRefreshOperation({collection:t}),this);return}var n=this.updateCollectionWithResponse(t,e.getResponse());if(e instanceof d.CollectionRefreshOperation){t.postNotification("collectionRefreshed",{didCollectionChange:n})}},_operationFailed:function(e){},_shouldRequeueOperation:function(e){var t=e.getCollection();var n=t.getRefreshRequeueOperationTags();var i=h.queryOperationQueue({notStates:[d.Operation.STATES.FAILED],containsTags:n,afterOperation:e});return i.length>0},updateCollectionWithResponse:function(e,t,i){e.startTransaction();var r=[];var a=t||[];var o=e._modelKeyPropertyName;var s={};var l=false;for(var u=0;u<a.length;u++){var c=a[u];var h=e.getByKey(c[o]);if(!h){h=e.createModelFromRawJSON(c);e.add(h);n.each(h.getCollectionProperties(),function(e){d.ModelOperationManager.Singleton._modifyPropertyCollection(e,h,c)});l=true}else{l=l||d.ModelOperationManager.Singleton.updateModel(h,c,null,true)}if(!i){s[h.key()]=true}}if(!i){for(var u=0;u<e.length;u++){if(!e[u].key()){continue}if(!s[e[u].key()]){r.push(e[u])}}for(var u=0;u<r.length;u++){e.remove(r[u],true);l=true}}e.endTransaction();return l}});i.set("Operations.CollectionOperationManager",f);i.set("Operations.CollectionOperationManager.Singleton",new f)})(Streak);(function(e,t){"use strict";var n=e._,i=e.Date,r=e.NotificationCenter,a=e.Operations.ModelOperationManager.Singleton;var o=function(t){e.Object.call(this);t=t||{};this._createOperationGenerated=false;this._guid=e.guid();this._setupWrappedObject(t);this._isInTransaction=false;this._eventStream=null;this._setupEventStream()};o.prototype=Object.create(e.Object.prototype);n.extend(o.prototype,{getWrappedObject:function(){return d(this._index)},updateWrappedObjectAndClearEditOperations:function(e,t){this.startTransaction();var n=this.getLatestObject()||{};c(this._index,e);if(t){this.clearEditOperationsWithOperationId(t)}e=this.getLatestObject()||{};this._notifyChangeInWrappedObjects(n,e);this.endTransaction()},clearEditOperationsWithOperationId:function(e,t){var n=this.getEditOperations();var i=[];var r=[];var a={};for(var o=0;o<n.length;o++){if(n[o].operationId===e){r.push(o)}else{i.push(n[o])}a[n[o].property]=o}this.setEditOperations(i);if(!t||!t.isUndo){return}for(var o=0;o<r.length;o++){var s=r[o];var l=n[s];var u=l.property;if(a[u]===s){this._sendOutChangeNotifications(u,l.value,l.previousValue)}}},setWrappedObject:function(e){var t=this.getLatestObject()||{};c(this._index,e);e=this.getLatestObject()||{};this._notifyChangeInWrappedObjects(t,e)},_notifyChangeInWrappedObjects:function(t,n){if(t[this.keyName]!==n[this.keyName]){this._postNotification({eventName:"keyChanged",oldKey:t[this.keyName],newKey:n[this.keyName]})}if(t[this.nameProperty]!==n[this.nameProperty]){y(this._index,n[this.nameProperty])}if(e.Utils.isDeepEquals(t,n)){return}for(var i in n){var r=t[i];var a=n[i];if(!e.Utils.isDeepEquals(r,a)){this._sendOutChangeNotifications(i,r,a)}}},getLatestObject:function(){var e=JSON.deepClone(this.getWrappedObject()||{});var t=this.getEditOperations()||[];for(var n=0;n<t.length;n++){e[t[n].property]=t[n].value}return e},getId:function(){return this._guid},getModelTag:function(){return this.tagEntityName+"_"+this.tagEntityName+"Key_"+this.key()},getRequestTags:function(e){if(this.syncParent){return this.syncParent.getRequestTags(e)}var t=[this.tagEntityName,this.tagEntityName+"_"+this.tagEntityName+"ClientId"+this.getId()];if(e){t.push(this.tagEntityName+"_"+e.toLowerCase())}switch(e){case"CREATE":t.push(this.tagEntityName+"_"+this.tagEntityName+"ClientId"+this.getId());break;default:t.push(this.tagEntityName+"_"+this.tagEntityName+"Key_"+this.key());if(e){t.push(this.tagEntityName+"_"+e.toLowerCase()+"_"+this.tagEntityName+"Key_"+this.key())}break}return t},getRequestDependentOnTags:function(e){if(this.syncParent){return this.syncParent.getRequestDependentOnTags(e)}var t=[this.tagEntityName+"_"+this.tagEntityName+"ClientId"+this.getId()];switch(e){case"CREATE":t.push(this.tagEntityName+"_"+this.tagEntityName+"ClientId"+this.getId());break;default:if(this.syncParent){t=t.concat(this.syncParent.getRequestDependentOnTags(e))}t.push(this.tagEntityName+"_"+this.tagEntityName+"Key_"+this.key());if(e){t.push(this.tagEntityName+"_"+e.toLowerCase()+"_"+this.tagEntityName+"Key_"+this.key())}break}return t},getRequestLimiterTagsAndTypes:function(e){if(this.syncParent){return this.syncParent.getRequestLimiterTagsAndTypes(e)}return null},getExtraRequestParameters:function(e){return null},getExtraUpdateParameters:function(){return null},set:function(e,t){var n=this.get(e);p(this._index).push({property:e,previousValue:n,value:t});if(this.nameProperty===e){y(this._index,t)}this._sendOutChangeNotifications(e,n,t)},get:function(e){var t=p(this._index);var i=d(this._index)||{};var r=i[e];n.each(t,function(t){if(t.property===e){r=t.value}});return n.isReal(r)?r:""},getEditOperations:function(){return p(this._index)},setEditOperations:function(e){f(this._index,e)},watch:function(e,t,i,a){if(!e||!t){return}var o={sender:this};if(n.isString(a)){o.property=a}r.subscribe({eventName:e,filterParameters:o,functionToCall:t,observer:i})},startTransaction:function(){this._isInTransaction=true;r.startTransaction(this.getId())},endTransaction:function(){this._isInTransaction=false;r.endTransaction(this.getId())},postNotification:function(e){if(n.isString(e)){e={eventName:e}}this._postNotification(e)},save:function(e,t,n){if(!this._canSave()&&t){t()}if(e||t){g(this._index).push({cb:e,errCb:t})}var i=a.save(this,p(this._index),n);this.postNotification("save");return i},_canSave:function(){return!this.syncParent||this.syncParent._canSave()},del:function(e,t){if(!this._canDelete()&&t){t()}g(this._index).push({cb:e,errCb:t});var n=a.del(this);this.postNotification("delete");return n},_canDelete:function(){return!this.syncParent||this.syncParent._canDelete()},remove:function(){this.postNotification("delete")},refresh:function(e){g(this._index).push({cb:e,errCb:e});a.refresh(this)},isSavedOnServer:function(){return this.key().length>0&&this.key().indexOf("__new__")===-1},needsCreateOperation:function(){return!this.isSavedOnServer()&&!this._createOperationGenerated},setCreateOperationGenerated:function(){this._createOperationGenerated=true},link:function(){return e.Gmail.inboxSDK.Router.createLink(this.typeName+"/:key",this.key()).split("#")[1]},key:function(){return this.get(this.keyName)},displayName:function(){return this.displayNameHTML()},displayNameHTML:function(){var e=w(this._index);if(n.isNotReal(e)){y(this._index,this.get(this.nameProperty));e=w(this._index)}return e},displayNameText:function(){return this.get(this.nameProperty)},createPatch:function(){return new e.ModelPatch(this)},getModelsAffectedByServerResponse:function(){return[this]},getResponseObjectAffectingModel:function(e){return e},isResponseMoreRecent:function(t){if(t.lastSavedTimestamp){if(this.get("lastSavedTimestamp")){if(t.lastSavedTimestamp<t.lastUpdatedTimestamp||t.lastSavedTimestamp<this.get("lastSavedTimestamp")){e.BentoBox.Tracker.track("bad last saved",{response:JSON.stringify(t),responseMessed:t.lastSavedTimestamp<t.lastUpdatedTimestamp,clientMoreRecent:t.lastSavedTimestamp<this.get("lastSavedTimestamp")})}}}return!t.lastUpdatedTimestamp||!this.get("lastUpdatedTimestamp")||t.lastUpdatedTimestamp>this.get("lastUpdatedTimestamp")},getCollectionProperties:function(){},getPropertyCollection:function(e){},getResponseForCollection:function(e,t){},shouldShowSavingMessage:function(e){return true},_setupWrappedObject:function(e){this._index=l();c(this._index,e)},sendOutChangeNotifications:function(e,t,n){this._sendOutChangeNotifications(e,t,n)},_sendOutChangeNotifications:function(e,t,n){this._postNotification({eventName:"change",property:e,previousValue:t,newValue:n});this._postNotification({eventName:"set",property:e,previousValue:t,newValue:n});if(e===this.keyName){this._postNotification({eventName:"keyChanged",oldKey:t,newKey:n})}},_postNotification:function(e){n.extend(e,{model:this,modelId:this.getId(),sender:this});if(this.syncParent){e.parentModel=this.syncParent;e.parentModelId=this.syncParent.getId()}var t;if(this._isInTransaction){t=this.getId()}r.postNotification(e,t)},_setupEventStream:function(){var e=this._guid;var t=this;this._eventStream=r.getNotificationStream().filter(function(n){return(n.modelId===e||n.parentModelId===e)&&n.sender===t})},getEventStream:function(){return this._eventStream},requestsCompleted:function(e,t){var i=n.clone(g(this._index));g(this._index).length=0;t||(t=new Error("Unknown error"));var r=false;n.each(i,function(i){if(e){if(n.isFunction(i.errCb)){r=r||i.errCb(t)}}else if(n.isFunction(i.cb)){i.cb()}});this.postNotification("requestsCompleted")},destroy:function(){c(this._index,null);f(this._index,null);_(this._index,null);y(this._index,null)}});o.saveAll=function(t){var i=n.map(t,function(e){return p(e._index)});return e.Operations.ModelOperationManager.Singleton.saveAll(t,i)};o.dependentSaveAll=function(t){var i=n.map(t,function(e){return p(e._index)});return e.Operations.ModelOperationManager.Singleton.dependentSaveAll(t,i)};o.deleteAll=function(t){for(var n=0;n<t.length;n++){t[n].postNotification("delete")}return e.Operations.ModelOperationManager.Singleton.deleteAll(t)};var s=0;function l(){s+=1;return s}var u=[];function c(e,t){u[e]=t}function d(e){return u[e]}var h=[];function f(e,t){h[e]=t}function p(e){if(!h[e]){h[e]=[]}return h[e]}var m=[];function _(e,t){m[e]=t}function g(e){if(!m[e]){m[e]=[]}return m[e]}var v=[];function y(t,n){n=n||"";v[t]=e.Utils.escapeAngleBrackets(n)}function w(e){return v[e]}e.Model=o})(Streak,window);(function(e){var t=e._,n=e.NotificationCenter;var i=e.Object;var r=e.Class.subclass({className:"ModelPatch",superclass:i,_memberVariables:[{name:"_model",destroy:false},{name:"_patch",destroy:true}],_initialize:function(e){i.prototype._initialize.call(this);this._model=e;this._patch={}},destroy:function(){n.unsubscribe({sender:this});n.unsubscribe({observer:this});i.prototype.destroy.call(this)},get:function(e){this._assertUncommitted();if(!this._patch){if(!this._model){return""}else{return this._model.get(e)}}if(this._patch[e]===void 0){return this._model.get(e)}else{return this._patch[e]}},set:function(e,t){this._assertUncommitted();if(t===void 0){throw new Error("Cannot set a value to 'undefined' using ModelPatch.set.")}var n=this.get(e);this._patch[e]=t;this._sendOutChangeNotifications(e,n,t)},commit:function(){this._assertUncommitted();for(var e in this._patch){if(this._patch.hasOwnProperty(e)){this._model.set(e,this._patch[e])}}n.postNotification({eventName:"ModelPatch.commit",sender:this});var t=this._model;this.destroy();return t},_assertUncommitted:function(){if(this._model===void 0){throw new Error("Cannot use a patch after it has been committed")}},_postNotification:function(e){t.extend(e,{model:this._model,modelId:this._model.getId(),sender:this});if(this.syncParent){e.parentModel=this._model.syncParent;e.parentModelId=this._model.syncParent.getId()}var i;if(this._isInTransaction){i=this.getId()}n.postNotification(e,i)},watch:e.Model.prototype.watch,_sendOutChangeNotifications:e.Model.prototype._sendOutChangeNotifications});e.ModelPatch=r})(Streak);(function(e){var t=e.jQuery,n=e.Date,i=e._,r=e.BentoBox,a=e.RSVP,o=e.APIRequester;var s=function(){};e._.extend(s.prototype,{init:function(){var t=this;this._checkActiveAI();return this._initializeUserInformation().then(function(){if(r.isLoggedIn()){e.NotificationCenter.postNotification({eventName:"reauthorized"})}})},userLoggedIn:function(t){r.setUser(t);if(r.getUser().get("isOauthComplete")||e.ai){if(!this._sawUserLoggedIn){e.DependencyManager.notifyFunctionFinished("userLoggedIn")}else{e.NotificationCenter.postNotification({eventName:"reauthorized"})}}},sawUserLoggedIn:function(){this._sawUserLoggedIn=true},ai:function(e){sessionStorage.streak_ai=e;location.reload()},_checkActiveAI:function(){if(!sessionStorage.streak_ai){return}t("[role=banner] > div > div").css("background","red");e.ai=sessionStorage.streak_ai;delete sessionStorage.streak_ai;e.DependencyManager.addFunction({functionKey:"disableStreakSettings",functionReference:function(){r.UserSettings.active=false},dependentFunctionKeys:["userSettingsInitialized"]})},_initializeUserInformation:function(){var t=[this._getUserInfo(),this._loadStreakCheck()];return e.RSVP.all(t).then(function(){})},_getInstallAppId:function(){return e.Utils.timeout(new e.RSVP.Promise(function(e,t){Messenger.sendMessage("installAppIdRequest",null,"installAppIdResponse",function(t){e(t.value)})}),800)},_loadStreakCheck:function(){var t=this;return new a.Promise(function(n,o){var s=t._getInstallAppId().then(function(e){if(i.contains(["DocSend","addDocSend"],e)){if(r.LocalSettings.get("activeApps/docsend")==null){r.LocalSettings.set("activeApps/docsend",true)}}if(e&&e!=="DocSend"){if(r.LocalSettings.get("activeApps/streak")==null){r.LocalSettings.set("activeApps/streak",true)}}},function(e){console.error("installAppId check failed",e)});var l=s;l.then(function(){if(r.LocalSettings.get("activeApps/docsend")){e.DependencyManager.notifyFunctionFinished("docsendEnabled")}});var u;if(r.LocalSettings.get("activeApps/streak")){u=a.resolve(null)}else{u=s.then(function(){if(!r.LocalSettings.get("activeApps")){r.LocalSettings.set("activeApps/streak",true)}})}a.all([u,l]).then(function(){r.Tracker.trackStreakActive({eventName:"activeAppsSettingInitialized",activeApps:r.LocalSettings.get("activeApps")})});n(u)}).then(function(){if(r.LocalSettings.get("activeApps/streak")){return t._tryToGetUserFromServer()}else{e.DependencyManager.notifyFunctionFinished("noCRM")}})},_getUserInfo:function(){return o.get("users/me/info").getPromise().then(function(t){e.debugTrackUser=e.debugTrackUser||t;if(e.debugTrackUser&&e.debugTrackUser.isUserFirstCall){r.Tracker.trackStreakActive({eventName:"firstTimeUserSeen"})}})},_tryToGetUserFromServer:function(){var e=this;return o.get("users/me").getPromise().then(function(t){e._handleSuccessfulResponse(t)},function(t){if(t.xhr&&t.xhr.status===401){return e._userNotLoggedIn()}else{e._logGetUserError(t.response,t.xhr)}})},_handleSuccessfulResponse:function(e){if(this._isUserLoggedIn(e)){this.userLoggedIn(e);return}return this._userNotLoggedIn()},_userNotLoggedIn:function(){return this._checkThirdPartyCookiesEnabled()},_isUserLoggedIn:function(t){return t&&!t.error&&t.userKey&&t.isOauthComplete||e.ai},_checkThirdPartyCookiesEnabled:function(){var e=this;return this._setThirdPartyCookie().then(function(t,n){return e._checkCookieWasSet(t,n)})},_setThirdPartyCookie:function(){return o.put("webclient/cookies",null,{cookieName:"randomCookie"}).getPromise().catch(this._logCookieError.bind(this))},_isCookieResponseValid:function(e){return!!e},_checkCookieWasSet:function(e,t){var n=this;if(!n._isCookieResponseValid(e)){n._logCookieError(null,t);return false}var i=this._constructCookieRequestParameters(e);return o.get("webclient/cookies",i).getPromise().then(this._validateCheckCookieResponse.bind(this),this._logCookieError.bind(this))},_constructCookieRequestParameters:function(e){var t={cookieName:"randomCookie"};for(var n in e){t[n]=e[n]}return t},_validateCheckCookieResponse:function(t){if(this._isCheckCookieResponseValid(t)){e.DependencyManager.notifyFunctionFinished("userLoggedOut")}else{this._thirdPartyCookiesDisabled()}},_isCheckCookieResponseValid:function(e){return e&&e.success},_thirdPartyCookiesDisabled:function(){r.Modules.TopNav.showThirdPartyCookiesDisabled()},_logGetUserError:function(e){var t="Server threw an error getting user";t+="\n attempt: 5";if(e&&e.error){t+="\nServer msg: "+e.error}r.logError(t);r.trigger("criticalError");r.isError=true},_logCookieError:function(e,t){t||(t=e.xhr);var n="Error in determining 3rd party cookies";if(t){n+="\n status: "+t.status;n+="\n response: "+JSON.stringify(t)}else{n+="\n xhr param missing"}r.logError(n,e);r.isError=true;r.trigger("criticalError")}});r.UserStateController=new s;e.DependencyManager.addFunction({functionKey:"userStateInitialized",functionReference:r.UserStateController.init,functionContext:r.UserStateController,dependentFunctionKeys:["topNavInitialized","localSettingsInitialized"]});e.DependencyManager.addFunction({functionKey:"userStateSawUserLoggedIn",functionReference:r.UserStateController.sawUserLoggedIn,functionContext:r.UserStateController,dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={BumpLater:["bumpLater"]};var h=e.Class.subclass({className:"EnabledFeaturesController",superclass:e.Object,_memberVariables:[{name:"_currentPlans",destroy:false},{name:"_experiments",destroy:false},{name:"_installAppIdFeatures",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this)},setup:function(){this._experiments=c.getUser().get("experiments");if(c.getUser().get("installAppId")){this._installAppIdFeatures=d[c.getUser().get("installAppId")]}return this._getUserPlan()},_getUserPlan:function(){var t=this;this._currentPlans=c.Data.getParticipatingPlans();var n=new e.Promise(function(e,n){t._currentPlans.refresh(e)});return n},isFeatureEnabled:function(e){return this._isExperimentEnabled(e)||this._isFeatureInPlan(e)||this._isFeatureInInstallAppId(e)},_isExperimentEnabled:function(e){if(!this._experiments){return false}if(!this._experiments[e]){return false}return this._experiments[e].inExperiment},_isFeatureInPlan:function(e){if(!this._currentPlans||this._currentPlans.length===0){return false}for(var t=0;t<this._currentPlans.length;t++){var n=this._currentPlans[t].get("features");if(!n){continue}if(n.indexOf(e)>-1){return true}}return false},_isFeatureInInstallAppId:function(e){if(!this._installAppIdFeatures){return}return this._installAppIdFeatures.indexOf(e)>-1}});e.DependencyManager.addFunction({functionKey:"enabledFeaturesControllerInitialized",functionReference:function(){var e=new h;var t=e.setup();i.set("BentoBox.EnabledFeaturesController",e);return t},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o={};var s={};var l=function(e){i.call(this,e);this._unsavedView=null;this._uiSettingsObject=null;var t=this;this.watch("set",function(){t._uiSettingsObject=null},this,"uiSettings");this._checkSystemColumnsForCaseIdAndFix()};l.prototype=Object.create(i.prototype);t.extend(l.prototype,{keyName:"pipelineKey",nameProperty:"name",entityType:"Workflow",typeName:"pipeline",createProperties:["name","stageNames","fieldNames","fieldTypes"],apiURLs:{get:"pipelines/<%= pipelineKey %>",update:"pipelines/<%= pipelineKey %>",create:"pipelines","delete":"pipelines/<%= pipelineKey %>"},tagEntityName:"pipeline",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["pipeline_create_noKey","pipelineCollection_noKey"]);break;case"DELETE":return t.concat(["pipeline_delete_noKey","pipelineCollection_noKey"]);break}return t},getRequestDependentOnTags:function(e){var t=i.prototype.getRequestDependentOnTags.call(this,e);if(e==="DELETE"){t=t.concat(["boxCollection_pipelineKey_"+this.key()])}return t},getResponseObjectAffectingModel:function(e){return e},getCollectionProperties:function(){return["stages","fields"]},getPropertyCollection:function(e){switch(e){case"stages":return this._getStagesCollection();break;case"fields":return this._getFieldsCollection();break}},getResponseForCollection:function(e,t){switch(e){case"stages":return this._getResponseForStageCollection(t);break;case"fields":return this._getResponseForFieldCollection(t);break}},isResponseMoreRecent:function(t){var n=e.Model.prototype.isResponseMoreRecent.call(this,t);if(n){return n}if(t.formulasLastUpdatedTimestamp){if(t.formulasLastUpdatedTimestamp!=this.get("formulasLastUpdatedTimestamp")){return true}}else if(this.get("formulasLastUpdatedTimestamp")){return true}if(this.get("firstInvalidTimestamp")!=t.firstInvalidTimestamp){return true}if(this.get("validSinceTimestamp")!=t.validSinceTimestamp){return true}return false},_getStagesCollection:function(){if(!s[this.getId()]){s[this.getId()]=a.Models.Stage.createCollection(this.key())}return s[this.getId()]},_getFieldsCollection:function(){if(!o[this.getId()]){o[this.getId()]=a.Models.PipelineField.createCollection(this)}return o[this.getId()]},_getResponseForStageCollection:function(e){return t(e.stages).at(e.stageOrder).each(function(e){e.pipelineKey=this.key()},this).value()},_getResponseForFieldCollection:function(e){return e.fields||[]},link:function(t){if(!t){return i.prototype.link.call(this)}return e.Gmail.inboxSDK.Router.createLink("pipeline/:key/:viewKey",{key:this.key(),viewKey:t}).split("#")[1]},addStage:function(n,i){var r=a.Models.Stage.create({name:n,pipelineKey:this.key()},this);this.getStages().add(r);var o=r.save(i);e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationIsComplete:true,operationProgressId:o},observer:this,unsubscribeImmediately:true,functionToCall:function(){var e=t.map(this.getStages(),function(e){return e.key()});this.set("stageOrder",e);i()}})},setStageOrder:function(e){this.set("stageOrder",e);var n=this.getStages();var i={};t.each(n,function(e){i[e.key()]=e});n.length=0;t(i).at(e).compact().each(function(e){n.push(e)})},addField:function(e,t){this.getFields().add(e);var n=this;e.save(function(){n.postNotification({eventName:"fieldAdded",fieldKey:e.key()});t()})},removeField:function(e,t){var n=this.getField(e);if(n){n.del(t)}else if(t){t()}},getFields:function(){return this._getFieldsCollection()},getField:function(e){return o[this.getId()].getByKey(e)},getFieldByName:function(e){if(!e){return}var n=this._getFieldsCollection();return t.find(n,function(t){return t.displayNameText().toLowerCase()===e.toLowerCase()})},getStage:function(e){return s[this.getId()].getByKey(e)},getStageByName:function(e){return t.find(this.getStages(),function(t){return t.displayName()===e})},getStageNamesText:function(){return t.map(this.getStages(),function(e){return e.displayNameText()})},getStages:function(){return this._getStagesCollection()},getStageIndex:function(e){return this.get("stageOrder").indexOf(e)},getStagesAsListText:function(){return t.map(this.getStages(),function(e){return{text:e.displayNameText(),value:e.key()}})},addSystemColumn:function(e,t,i,r){var a=this.getSystemColumns();var o=t||n.now()+Math.random()+"";a.push({property:e.property,uniqueKey:o});this.setUISettings("systemColumns",a,i,r);return o},removeSystemColumn:function(e){var n=this.getSystemColumns();var i=t.filter(n,function(t){return t.uniqueKey!==e.uniqueKey});this.setUISettings("systemColumns",i)},getFilterableSystemColumns:function(){return t.filter(this.getUniqueSystemColumns(),function(e){return l.isPropertyFilterable(e.property)})},getGroupableSystemColumns:function(){return t.filter(this.getUniqueSystemColumns(),function(e){return l.isPropertyGroupable(e.property)})},getUniqueSystemColumns:function(){return t.uniq(this.getActiveSystemColumns(),function(e){return e.property})},getSystemColumnByProperty:function(e){return t.find(this.getSystemColumns(),function(t){return t.property===e})},getSystemColumn:function(e){return t.find(this.getActiveSystemColumns(),function(t){return e===t.uniqueKey||e===t.property})},isDefaultProperty:function(e){return l.isDefaultProperty(e)},getSystemColumns:function(){var e=this.getUISettingsByPath("systemColumns");if(t.isUndefined(e)){e=[]}var n=t.map(e,function(e){var n=l.getSystemProperty(e.property);if(n){return t.extend({},n,e)}else{return null}});return t.compact(n)},getActiveSystemColumns:function(){var e=this.getSystemColumns();var t=l.getDefaultSystemProperties();return t.concat(e)},getAllSystemColumns:function(){var e=this.getActiveSystemColumns();var n=l.getAllSystemProperties();var i=e.concat(n);return t.uniq(i,false,"property")},doesEmailAddressHaveAccess:function(e){var n=this.get("aclEntries");var i=t(n).pluck("email").contains(e);if(i){return true}if(this.get("orgWide")){var r=e.split("@")[1].split(".")[0];var a=this.get("organization").organizationId||"";return r.toLowerCase()===a.toLowerCase()}return false},getUISettingsByPath:function(t){if(!this._uiSettingsObject){this._uiSettingsObject=e.ObjectPath.create(this.get("uiSettings"))}return this._uiSettingsObject.get(t)},setUISettings:function(t,n,i,r){if(!this._uiSettingsObject){this._uiSettingsObject=e.ObjectPath.create(this.get("uiSettings"))}this._uiSettingsObject.set(t,n);this.set("uiSettings",this._uiSettingsObject.toString());if(!r){this.save(i,null,true)}},isHidden:function(){return a.UserSettings.get("pipeline/"+this.key()+"/uiSettings/leftLink")},setHidden:function(e){a.UserSettings.set("pipeline/"+this.key()+"/uiSettings/leftLink",e);a.UserSettings.save();this.postNotification("hiddenSettingChanged")},setColor:function(e){a.UserSettings.set("pipeline/"+this.key()+"/uiSettings/indicator/color",e);a.UserSettings.save(true);this.postNotification("uiSettingChanged")},getColor:function(){var e=a.UserSettings.get("pipeline/"+this.key()+"/uiSettings/indicator/color");if(!e){e={backgroundColor:"rgb(194, 194, 194)",textColor:"rgb(255, 255, 255)"}}return e},isDefaultColor:function(){return!a.UserSettings.get("pipeline/"+this.key()+"/uiSettings/indicator/color")},getSavedViews:function(){return this.getUISettingsByPath("savedViews/list")||[]},getSavedView:function(e){if(this._unsavedView&&this._unsavedView.viewKey===e){return this._unsavedView}return t.find(this.getSavedViews(),function(t){return t.viewKey===e})},addSavedView:function(e,t){var i={name:e,viewKey:n.now()+"."+Math.random(),settings:t};var r=this.getSavedViews();r.push(i);this.setUISettings("savedViews/list",r);this.postNotification({eventName:"savedViewAdded",savedView:i});return i},updateSavedView:function(e,n){if(this._unsavedView&&this._unsavedView.viewKey===e.viewKey){t.extend(this._unsavedView,e);return}var i=this.getSavedViews();var r=t.find(i,function(t){return t.viewKey===e.viewKey});t.extend(r,e);this.setUISettings("savedViews/list",i,null,n);this.postNotification({eventName:"savedViewChanged",viewKey:e.viewKey})},setUnsavedView:function(t){this._unsavedView={name:"("+a.Locale.getString("unsaved_view")+")",viewKey:e.guid(),settings:t,isUnsaved:true};this.postNotification({eventName:"savedViewAdded",savedView:this._unsavedView});return this._unsavedView},clearUnsavedView:function(){this.postNotification({eventName:"savedViewRemoved",savedView:this._unsavedView});this._unsavedView=null},getUnsavedView:function(){return this._unsavedView},doesHaveUnsavedView:function(){return!!this._unsavedView},getCollaborationStatus:function(){if(a.isFeatureEnabled("unlimitedCollaborators")){return"OK"}var n=this.get("problematicCollaborators");if(!n||!t.isArray(n)||n.length===0){return"OK"}if(!this.get("firstInvalidTimestamp")&&!this.get("validSinceTimestamp")){return"OK"}else if(this.get("validSinceTimestamp")){return"OK"}else if(this.get("firstInvalidTimestamp")){var i=new e.Date;var r=this.get("endOfWarningPeriod");return i<=r?"WARNING":"LOCKDOWN"}},getNumberOfDaysUntilLockdown:function(){var t=new e.Date;var n=this.get("endOfWarningPeriod");var i=(n-t)/1e3/60/60/24;return Math.ceil(i)},getIsEditable:function(){return this.getCollaborationStatus()!=="LOCKDOWN"},_checkSystemColumnsForCaseIdAndFix:function(){var e=false;var n=this.getUISettingsByPath("systemColumns");t.each(n,function(t){if(t&&t.property==="caseId"){t.property="boxId";e=true}});if(e){this.setUISettings("systemColumns",n,null,true)}},isSharingRestrictedToOrg:function(e){if(this.get("sharingRestrictedToOrg")){e(true);return}},didBillingAdminRestrictSharingToOrg:function(){return e.APIRequester.get("users/"+this.get("creatorKey")+"/billingadmin").getPromise().then(function(e){return e&&e.billingAdminSettings&&e.billingAdminSettings.externalSharingRestrictionOnTeamsPipelines},function(){return false})},getAllAssignedToValues:function(){var e=a.Data.getPipelineBoxes(this.key());return t(e).chain().map(function(e){return e.getAssignedToSharingEntries()}).flatten().filter(function(e){return t.isReal(e)&&t.isReal(e.displayName)}).sortBy(function(e){return e.displayName.toLowerCase()}).uniq(false,function(e){return e.email}).map(function(e){return{value:e,display:e.displayName,normalized:null}}).value()},_canSave:function(){return!this.isSavedOnServer()||a.Services.AccessManager.isAccessAllowed(this,"Pipeline","UPDATE")},_canDelete:function(){return!this.isSavedOnServer()||a.Services.AccessManager.isAccessAllowed(this,"Pipeline","DELETE")}});l.createCollection=function(){var e=new r;e.init({modelKeyPropertyName:"pipelineKey",apiURL:"pipelines?includeCollaborators=true",requestTags:["pipelineCollection_noKey"],requestDependentOnTags:["pipelineCollection_noKey"],refreshRequeueOperationTags:["pipeline_create_noKey","pipeline_delete_noKey"],createModelFromRawJSON:l.create});return e};l.create=function(e){return new l(e)};a.Models.Pipeline=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.Template,s=e.NotificationCenter,l=e.DependencyManager,u=e.BentoBox;var c=u.Models.Pipeline;var d=[{name:"system_name",property:"name",type:"TEXT",filterAndGroupType:"TEXT",sortType:"TEXT",summaryType:"NONE",isEditable:true,isDefault:true,isGroupable:false,isFilterable:true},{name:"system_stage",property:"stageKey",type:"SIMPLE_DROPDOWN",filterAndGroupType:"STAGE",sortType:"TEXT",summaryType:"NONE",isEditable:true,isDefault:true,isGroupable:true,isFilterable:true,sortFunction:function(e){return e.getPipeline().getStageIndex(e.get("stageKey"))},textValueFunction:function(e){return e.getStage().displayNameText()},filterValueFunction:function(e){return this.textValueFunction(e)}},{name:"system_notes",property:"notes",type:"TEXT_INPUT",filterAndGroupType:"TEXT",sortType:"TEXT",summaryType:"BASIC",isEditable:true,isDefault:true,isGroupable:false,isFilterable:true,textValueFunction:function(e){return e.get("notes")}},{name:"system_id",property:"boxId",type:"NUMBER",filterAndGroupType:"NUMBER",sortType:"NUMBER",summaryType:"BASIC",group:"ID",isGroupable:false,isFilterable:true},{name:"system_created",property:"creationTimestamp",type:"DATE",filterAndGroupType:"DATE",sortType:"DATE",summaryType:"DATE",group:"DATE",isGroupable:true,isFilterable:true},{name:"system_updated",property:"lastUpdatedTimestamp",type:"DATE",filterAndGroupType:"DATE",sortType:"DATE",summaryType:"DATE",group:"DATE",isGroupable:true,isFilterable:true},{name:"system_last_stage_change",property:"lastStageChangeTimestamp",type:"DATE",filterAndGroupType:"DATE",sortType:"DATE",summaryType:"DATE",group:"DATE",isGroupable:true,isFilterable:true},{name:"system_followers",property:"followerCount",type:"NUMBER",filterAndGroupType:"NUMBER",sortType:"NUMBER",summaryType:"BASIC",group:"COUNT",isGroupable:true,isFilterable:true},{name:"system_comments",property:"commentCount",type:"NUMBER",filterAndGroupType:"NUMBER",sortType:"NUMBER",summaryType:"BASIC",group:"COUNT",isGroupable:true,isFilterable:true},{name:"system_reminder_count",property:"reminderCount",type:"NUMBER",group:"COUNT",filterAndGroupType:"NUMBER",summaryType:"BASIC",sortType:"NUMBER",isGroupable:true,isFilterable:true},{name:"system_file_count",property:"fileCount",type:"NUMBER",group:"COUNT",filterAndGroupType:"NUMBER",summaryType:"BASIC",sortType:"NUMBER",isGroupable:true,isFilterable:true},{name:"system_last_email",property:"lastEmailUpdatedTimestamp",type:"DATE",group:"DATE",filterAndGroupType:"DATE",summaryType:"DATE",sortType:"DATE",isGroupable:true,isFilterable:true},{name:"system_next_reminder",property:"soonestReminderTimestamp",type:"DATE",group:"DATE",filterAndGroupType:"DATE",summaryType:"DATE",sortType:"DATE",isGroupable:true,isFilterable:true},{name:"system_thread_count",property:"gmailThreadCount",type:"NUMBER",filterAndGroupType:"NUMBER",sortType:"NUMBER",summaryType:"BASIC",group:"COUNT",isGroupable:true,isFilterable:true},{name:"system_email_addresses",property:"emailAddresses",type:"COMPUTED",filterAndGroupType:"TEXT",sortType:"TEXT",summaryType:"LIST",isEditable:false,isGroupable:false,isFilterable:true,group:"A_COUNT",computeFunction:function(e){var t="";
var i=n.without(e.get("emailAddresses")||[],u.userEmail);for(var r=0;r<i.length;r++){t+='<span class="people" email="'+i[r]+'">'+i[r]+(r===i.length-1?"":",")+"</span>"}return t},sortFunction:function(e){return n.without(e.get("emailAddresses")||[],u.userEmail).join(",")},groupByFunction:function(e){return n.without(e.get("emailAddresses")||[],u.userEmail)},textValueFunction:function(e){return n.without(e.get("emailAddresses")||[],u.userEmail).join(",")}},{name:"system_assigned_to",property:"assignedToSharingEntries",type:"COMPUTED",filterAndGroupType:"PERSON",sortType:"PERSON",summaryType:"LIST",isEditable:true,isGroupable:true,isFilterable:true,group:"A_ASSIGNED",computeFunction:function(t){var i="";var r=t.get("assignedToSharingEntries");n.each(r,function(t){if(!t.displayName){t.displayName=t.fullName||t.email||""}var n="";if(t.email){n='email="'+t.email+'"'}var r=t.imageUrl?t.imageUrl:t.image;r=r?r.unescapeHTML():e.server+e.combinedPath+"images/unknownContact.png";var a='<img class="people" height="23" width="23" src="'+r+'" title="'+t.displayName+'">';a+='<span class="people" '+n+">"+t.displayName+"</span>";i+=a});return i},sortFunction:function(e){var t=e.get("assignedToSharingEntries");return n(t).chain().map(function(e){if(e.displayName){return e.displayName}return e.email}).sortBy(function(e){return e}).join(", ").value()},groupByFunction:function(e){var t=e.get("assignedToSharingEntries");if(t&&t.length>0){return n.pluck(t,"email")}return null},textValueFunction:function(e){var t=e.get("assignedToSharingEntries");var i=[];if(t&&t.length>0){n.each(t,function(e){if(e.fullName){i.push(e.fullName+" <"+e.email+">")}else{i.push(e.email)}})}return i.join(", ")}},{name:"system_summary",property:"summaryCount",type:"COMPUTED",sortType:"NUMBER",summaryType:"NONE",group:"A_COUNT",isGroupable:false,isFilterable:false,computeFunction:function(e){return o.underscore("core/models/pipeline/systemSummary")({fileCount:e.getProcessedHTMLValue("fileCount"),reminderCount:e.getProcessedHTMLValue("reminderCount"),gmailThreadCount:e.getProcessedHTMLValue("gmailThreadCount"),commentCount:e.getProcessedHTMLValue("commentCount")})},sortFunction:function(e){return[parseFloat(e.getSortValue("gmailThreadCount")),parseFloat(e.getSortValue("fileCount")),parseFloat(e.getSortValue("commentCount")),parseFloat(e.getSortValue("reminderCount"))]},textValueFunction:function(e){return o.underscore("core/models/pipeline/systemSummaryText")({fileCount:e.getProcessedHTMLValue("fileCount"),reminderCount:e.getProcessedHTMLValue("reminderCount"),gmailThreadCount:e.getProcessedHTMLValue("gmailThreadCount"),commentCount:e.getProcessedHTMLValue("commentCount")}).trim()}},{name:"system_freshness",property:"freshness",type:"COMPUTED",group:"A_COUNT",isGroupable:true,isFilterable:true,filterAndGroupType:"NUMBER",sortType:"NUMBER",summaryType:"BASIC",computeFunction:function(e){var t=this._getRoundedValue(e);var n=['<div class="__streak__FreshnessIndicator">'];for(var i=0;i<5;i++){n.push("<span");if(i<t){n.push(' class="__streak__FreshnessIndicatorFresh"')}n.push("></span>")}n.push("</div>");return n.join("")},sortFunction:function(e){return e.get("freshness")},groupByFunction:function(e){return this.textValueFunction(e)},filterValueFunction:function(e){return this.textValueFunction(e)},textValueFunction:function(e){return this._getRoundedValue(e)+""},_getRoundedValue:function(e){var t=e.get("freshness");try{t=parseFloat(t);return Math.round(t*5)}catch(n){}return 0}}];var h=function(e){for(var t=0;t<d.length;t++){if(e===d[t].property){return d[t]}}return null};c.systemProperties=d;n.extend(c,{getDefaultSystemProperties:function(){var e=[];n.each(d,function(t){if(t.isDefault){f(t);e.push(t)}});return e},getExtraSystemProperties:function(){var e=[];n.each(d,function(t){if(!t.isDefault&&!t.isLinkedProperty){f(t);e.push(t)}});return e},getLinkedBoxProperties:function(){var e=[];n.each(d,function(t){if(t.isLinkedProperty){f(t);e.push(t)}});return e},getAllSystemProperties:function(){return c.getDefaultSystemProperties().concat(c.getExtraSystemProperties()).concat(c.getLinkedBoxProperties())},getFilterableSystemProperties:function(){var e=[];n.each(d,function(t){if(t.isFilterable){f(t);e.push(t)}});return e},getGroupableSystemProperties:function(){var e=[];n.each(d,function(t){if(t.isGroupable){f(t);e.push(t)}});return e},isDefaultProperty:function(e){var t=h(e);if(n.isNull(t)||n.isUndefined(t)){return false}return!!t.isDefault},getSystemProperty:function(e){var t=h(e);if(t){f(t);return t}return null},getSystemPropertyByName:function(e){if(!e){return null}var t=c.getAllSystemProperties();for(var n=0;n<t.length;n++){if(e.toLowerCase()===t[n].name.toLowerCase()){return t[n]}}return null},getPropertyName:function(e){var t=this.getSystemProperty(e);if(t){return t.name}return e},getPropertyType:function(e){var t=this.getSystemProperty(e);if(t){return t.type}return null},getPropertyFilterAndGroupType:function(e){var t=this.getSystemProperty(e);if(t){return t.filterAndGroupType}return null},getPropertySortType:function(e){var t=this.getSystemProperty(e);if(t){return t.sortType}return null},isPropertyEditable:function(e){var t=this.getSystemProperty(e);if(t){return t.isEditable}return false},isPropertyGroupable:function(e){var t=this.getSystemProperty(e);if(t){return t.isGroupable}return false},isPropertyFilterable:function(e){var t=this.getSystemProperty(e);if(t){return t.isFilterable}return false}});function f(e){if(!e.title){e.title=u.Locale.getString(e.name);e.name=u.Locale.getString(e.name)}}})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;a.Models.Pipeline.Templates={get:function(e){var t=e.split("/");if(t.length>1){var n=this.definitions[t[0]];if(n){var i=n.templates[t[1]];if(!i.translated){i.friendlyName=a.Locale.getString(i.friendlyName);for(var r=0;r<i.stageNames.length;r++){i.stageNames[r]=a.Locale.getString(i.stageNames[r])}for(var r=0;r<i.fields.length;r++){i.fields[r].name=a.Locale.getString(i.fields[r].name)}i.translated=true}return i}}},getAll:function(){},definitions:{business:{name:"pipeline_template_group_business",templates:{sales:{friendlyName:"pipeline_template_sales_name",stageNames:["pipeline_template_stage_lead","pipeline_template_stage_prospect","pipeline_template_stage_needs","pipeline_template_stage_presentation","pipeline_template_stage_objections","pipeline_template_stage_negotiation","pipeline_template_stage_closed_won","pipeline_template_stage_closed_lost"],fields:[{name:"pipeline_template_field_amount",type:"TEXT_INPUT"}],systemProperties:["assignedToSharingEntries"]},hiring:{friendlyName:"pipeline_template_hiring_name",stageNames:["pipeline_template_stage_resume","pipeline_template_stage_phone","pipeline_template_stage_interview","pipeline_template_stage_negotiation","pipeline_template_stage_hired","pipeline_template_stage_passed","pipeline_template_stage_rejected"],fields:[{name:"pipeline_template_field_position",type:"TEXT_INPUT"},{name:"pipeline_template_field_start_date",type:"DATE"}],systemProperties:["assignedToSharingEntries"]},support:{friendlyName:"pipeline_template_support_name",stageNames:["pipeline_template_stage_new","pipeline_template_stage_assigned","pipeline_template_stage_working","pipeline_template_stage_resolved"],fields:[{name:"pipeline_template_field_priority",type:"TEXT_INPUT"}],systemProperties:["assignedToSharingEntries"]},productDevelopment:{friendlyName:"pipeline_template_product_development_name",stageNames:["pipeline_template_stage_idea","pipeline_template_stage_spec","pipeline_template_stage_working","pipeline_template_stage_launched"],fields:[{name:"pipeline_template_field_priority",type:"TEXT_INPUT"},{name:"pipeline_template_field_due_date",type:"DATE"}],systemProperties:["assignedToSharingEntries"]},bugTracking:{friendlyName:"pipeline_template_bug_tracking_name",stageNames:["pipeline_template_stage_reported","pipeline_template_stage_reproducible","pipeline_template_stage_working","pipeline_template_stage_launched"],fields:[{name:"pipeline_template_field_priority",type:"TEXT_INPUT"},{name:"pipeline_template_field_due_date",type:"DATE"}],systemProperties:["assignedToSharingEntries"]},dealflow:{friendlyName:"pipeline_template_dealflow_name",stageNames:["pipeline_template_stage_lead","pipeline_template_stage_pitched","pipeline_template_stage_term_sheet","pipeline_template_stage_signed","pipeline_template_stage_passed"],fields:[{name:"pipeline_template_field_amount",type:"TEXT_INPUT"},{name:"pipeline_template_field_valuation",type:"TEXT_INPUT"}],systemProperties:["assignedToSharingEntries"]},fundraising:{friendlyName:"pipeline_template_fundraising_name",stageNames:["pipeline_template_stage_lead","pipeline_template_stage_pitched","pipeline_template_stage_term_sheet","pipeline_template_stage_signed","pipeline_template_stage_money"],fields:[{name:"pipeline_template_field_amount",type:"TEXT_INPUT"},{name:"pipeline_template_field_valuation",type:"TEXT_INPUT"},{name:"pipeline_template_field_lead",type:"PERSON"}],systemProperties:["assignedToSharingEntries"]}}},personal:{name:"pipeline_template_group_personal",templates:{todo:{friendlyName:"pipeline_template_todo_name",stageNames:["pipeline_template_stage_todo","pipeline_template_stage_working","pipeline_template_stage_done"],fields:[{name:"pipeline_template_field_priority",type:"TEXT_INPUT"}]},jobHunting:{friendlyName:"pipeline_template_job_hunting_name",stageNames:["pipeline_template_stage_applied","pipeline_template_stage_interview","pipeline_template_stage_negotiation","pipeline_template_stage_signed","pipeline_template_stage_passed","pipeline_template_stage_rejected"],fields:[{name:"pipeline_template_field_salary",type:"TEXT_INPUT"},{name:"pipeline_template_field_start_date",type:"DATE"}]},apartmentHunting:{friendlyName:"pipeline_template_apartment_hunting_name",stageNames:["pipeline_template_stage_interested","pipeline_template_stage_viewing","pipeline_template_stage_applied","pipeline_template_stage_negotiation","pipeline_template_stage_signed","pipeline_template_stage_passed"],fields:[{name:"pipeline_template_field_rent",type:"TEXT_INPUT"},{name:"pipeline_template_field_start_date",type:"DATE"},{name:"pipeline_template_field_landlord",type:"PERSON"}]},lending:{friendlyName:"pipeline_template_lending_name",stageNames:["pipeline_template_stage_lent","pipeline_template_stage_notified","pipeline_template_stage_paid_back"],fields:[{name:"pipeline_template_field_amount",type:"TEXT_INPUT"}]},tripPlanning:{friendlyName:"pipeline_template_trip_name",stageNames:["pipeline_template_stage_options","pipeline_template_stage_researched","pipeline_template_stage_booking","pipeline_template_stage_booked","pipeline_template_stage_paid"],fields:[{name:"pipeline_template_field_amount",type:"TEXT_INPUT"}]}}},custom:{name:"pipeline_template_group_custom",templates:{blank:{friendlyName:"pipeline_template_blank_name",stageNames:["pipeline_template_stage_default"],fields:[]}}}}}})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.BentoBox;var a=function(e,t){i.call(this,e);this.pipeline=t;this.syncParent=t};a.prototype=Object.create(i.prototype);t.extend(a.prototype,{keyName:"key",entityType:"Field",createProperties:["name","type","pipelineKey"],modifyProperties:["key","pipelineKey"],nameProperty:"name",apiURLs:{create:"pipelines/<%= pipelineKey %>/fields",update:"pipelines/<%= pipelineKey %>/fields/<%= key %>","delete":"pipelines/<%= pipelineKey %>/fields/<%= key %>"},tagEntityName:"pipelineField",getExtraRequestParameters:function(){return{pipelineKey:this.pipeline.key()}},getResponseObjectAffectingModel:function(e){if(e.fields){for(var t=0;t<e.fields.length;t++){if(e.fields[t].key===this.key()){return e.fields[t]}}}return e}});a.create=function(e,t){return r.Models.BoxField.createPipelineFieldModel(e,t)};a.createCollection=function(t){var n=new e.Collection;n.init({modelKeyPropertyName:"key",createModelFromRawJSON:function(e){return r.Models.BoxField.createPipelineFieldModel(e,t)}});return n};r.Models.PipelineField=a})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineFormulaField",superclass:c.Models.PipelineField,_memberVariables:[{name:"_formulaObject",destroy:false}],_initialize:function(){c.Models.PipelineField.prototype._initialize.call(this)},getFormula:function(){return this.get("defaultValue")},getRelevantFormula:function(e,t,n){this._formulaObject=null;if(e==="BOX"){var i=n.getFieldValue(this.key());if(!i){return""}if(i.formula){return i.formula}return""}var r=this._getFormulaObject();if(e==="STAGE"){if(r[t]){return r[t]}return""}if(e==="ALL"){if(r["ALL"]){return r["ALL"]}return""}},doesFormulaSectionExistForBox:function(e){var t=e.getFieldValue(this.key());if(!t){return false}if(t.formula){return true}return false},doesFormulaSectionExistForStage:function(e){return n.isReal(this._getFormulaObject()[e])},setAndSaveFormulaSection:function(e,t,n,i){switch(e){case"ALL":this._setAndSaveColumnLevelFormula(n,t,i);break;case"STAGE":this._setAndSaveStageLevelFormula(n,t,i);break;case"BOX":this._setAndSaveBoxLevelFormula(n,i);break}},_setAndSaveColumnLevelFormula:function(e,t,n){var i;if(this.doesFormulaSectionExistForBox(e)){var r=this._setAndSaveBoxLevelFormula(e,"");this._addSetPendingWatcher(e,r)}var a=this._getFormulaObject();delete a[t];a["ALL"]=n;this.set("defaultValue",this._processFormulaObjectBackIntoFormulaString(a));this.save()},_setAndSaveStageLevelFormula:function(e,t,n){if(this.doesFormulaSectionExistForBox(e)){this._setAndSaveBoxLevelFormula(e,"")}var i=this._getFormulaObject();i[t]=n;this.set("defaultValue",this._processFormulaObjectBackIntoFormulaString(i));this.save()},_setAndSaveBoxLevelFormula:function(e,t){var n=e.getFieldModel(this.key());var i=e.getFieldValue(this.key());if(!i){i={}}i.formula=d.serverfyColumnFunctions(t,this.pipeline);n.set("value",i);return n.save()},_addSetPendingWatcher:function(t,n){var i=this.key();e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:n,operationIsComplete:true},unsubscribeImmediately:true,functionToCall:function(){t.markFieldCalculating(i)},observer:this})},_getFormulaObject:function(){if(!this._formulaObject){this._formulaObject=this._processFormulaIntoFormulaObject(this.get("defaultValue"))}return this._formulaObject},_processFormulaObjectBackIntoFormulaString:function(e){var t="";keys=n.keys(e);if(!keys||keys.length===0){return t}t='switch(col("stageKey")){ //STREAK_START_SWITCH\n';for(var i=0;i<keys.length;i++){var r=keys[i];if(r==="ALL"){continue}if(i>0){t+="else "}t+='case "'+keys[i]+'": //STREAK_START_SECTION '+keys[i]+" \n";t+=d.serverfyColumnFunctions(e[keys[i]],this.pipeline)+"\n";t+="break; //STREAK_END_SECTION \n"}if(e["ALL"]){t+="default:  //STREAK_START_SECTION ALL \n";t+=d.serverfyColumnFunctions(e["ALL"],this.pipeline)+"\n";t+="break; //STREAK_END_SECTION \n"}t+="} //STREAK_END_SWITCH";return t},_processFormulaIntoFormulaObject:function(e){var t={};if(!e){return t}var n=e.split(/\r|\n/);var i=[];var r=null;var a=null;var o=this;var s=h({ongroupSectionFound:function(){i=[];r=_(a)},onendGroupFound:function(){t[r]=d.prettifyColumnFunctions(i.join("\n"),o.pipeline);i=null}});for(var l=0;l<n.length;l++){a=n[l].trim();if(f(a)){s.groupSectionFound()}else if(p(a)){s.endGroupFound()}else if(m(a)){}else if(i){i.push(a)}}if(i&&!t["ALL"]){t["ALL"]=d.prettifyColumnFunctions(i.join("\n"),this.pipeline)}return t}});d.serverfyColumnFunctions=function(e,t){if(!e){return e}return e.replace(/\$(\'|\")(.+?)(\'|\")/gi,function(e,n,i){var r=i;if(i.toLowerCase()===c.Locale.getString("stage").toLowerCase()){r="stageName"}else if(i.toLowerCase()===c.Locale.getString("all_linked_boxes").toLowerCase()){r="linkedBoxKeys"}else{var a=t.getFieldByName(i);if(a){r=a.key()}else{var o=c.Models.Pipeline.getSystemPropertyByName(i);if(o){r=o.property}}}return"col("+n+r+n+")"})};d.prettifyColumnFunctions=function(e,t){if(!e){return e}return e.replace(/col\((\'|\")(.+?)(\'|\")\)/gi,function(e,n,i){var r=i;if(i.toLowerCase()==="linkedboxkeys"){r=c.Locale.getString("all_linked_boxes")}else if(i.toLowerCase()==="stagename"){r=c.Locale.getString("stage")}else{var a=t.getField(i);if(a){r=a.displayNameText()}else{var o=c.Models.Pipeline.getSystemProperty(i);if(o){r=o.name}}}return"$"+n+r+n})};function h(t){return e.StateMachine.create({initial:"start",events:[{name:"groupSectionFound",from:["start"],to:"inGroupSection"},{name:"endGroupFound",from:["inGroupSection"],to:"start"}],callbacks:t})}function f(e){return e.indexOf("//STREAK_START_SECTION")>-1}function p(e){return e.indexOf("//STREAK_END_SECTION")>-1}function m(e){return e.indexOf("//STREAK_START_SWITCH")>-1||e.indexOf("//STREAK_END_SWITCH")>-1}function _(e){return e.replace(/.*?\/\/STREAK_START_SECTION (.*?)\s*$/,"$1")}function g(e,t,i){return n.chain(e).filter(function(e){return t==="ALL"||e.get("stageKey")===t}).map(function(e){var t=e.getFieldValue(i);if(!t){return t}switch(t.calculationStatus){case"SUCCESS":case"NOT_ATTEMPTED":return t.calculationStatus;break;default:return"ERROR"}}).value()}function v(e,t){var n=e[t];return!n}function y(e,t){return n.all(e,function(e){return e===t})}function w(e,t){return n.any(e,function(e){return e===t})}i.set("BentoBox.Models.PipelineFormulaField",d)})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.BentoBox;var a=function(e,t){r.Models.PipelineField.apply(this,[e,t])};a.prototype=Object.create(r.Models.PipelineField.prototype);t.extend(a.prototype,{_propertyName:"dropdownSettings",getOptions:function(){return t(this.get(this._propertyName).items).chain().filter(function(e){return!!e.key}).sortBy(function(e){return e.name}).value()},getOption:function(e){if(!e){return null}var t=this.getOptions();for(var n=0;n<t.length;n++){if(t[n].key===e){return t[n]}}return{name:e}},getOptionByName:function(e){var t=this.getOptions();for(var n=0;n<t.length;n++){if(t[n].name===e){return t[n]}}return null},addOption:function(e){var n=t.clone(this.get(this._propertyName));n.items.push({name:e});this.set(this._propertyName,n)},addOptionAndSet:function(e,t){this.addOption(e);r.Models.PipelineColumnAddOptionOperationManager.addOptionSetOnBox(this,e,t)}});r.Models.PipelineDropdownField=a})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.BentoBox;var a=function(e,t){r.Models.PipelineField.apply(this,[e,t])};a.prototype=Object.create(r.Models.PipelineField.prototype);t.extend(a.prototype,{_propertyName:"tagSettings",getOptions:function(){return t(this.get(this._propertyName).tags).chain().filter(function(e){return!!e.key}).sortBy(function(e){return e.tag.toLowerCase()}).value()},getOption:function(e){if(!e){return null}var t=this.getOptions();for(var n=0;n<t.length;n++){if(t[n].key===e){return t[n]}}return{tag:e}},getOptionByName:function(e){var t=this.getOptions();for(var n=0;n<t.length;n++){if(t[n].tag===e){return t[n]}}return null},updateTags:function(e,n,i){if(e.length===0){var a=i.get("value");if(!t.isArrayDifferentSet(n,a)){return}i.set("value",n);i.save();return}if(t.isArrayDifferentSet(n,a)){r.Models.PipelineColumnAddTagOperationManager.createTagsAndUpdateBoxField(e,this,n,i)}else{this._saveNewTags(e)}},_saveNewTags:function(e){var n=t.clone(this.get("tagSettings"));n.tags=t.chain(e).map(function(e){return{tag:e}}).concat(n.tags).value();this.set("tagSettings",n);this.save()}});r.Models.PipelineTagField=a})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=l.Models.Pipeline;var c=e.Class.subclass({superclass:e.Object,_initialize:function(){this._setupBinding();return this},_setupBinding:function(){var e=this;var t=l.Data.getAllPipelines();n.each(t,function(t){e._generateSystemPropertyDefinition(t)});t.watch("add",function(t){if(t.model&&t.model.key()){e._generateSystemPropertyDefinition(t.model)}},this);o.subscribe({eventName:"set",filterParameters:{sender:t,property:"key"},functionToCall:function(t){if(t.model&&t.model.key()){e._generateSystemPropertyDefinition(t.model)}},observer:this});e._generateSystemPropertyDefinition()},_generateSystemPropertyDefinition:function(e){var t=n.clone(d);if(e){t.property="linkedBoxes."+e.key();Object.defineProperty(t,"title",{enumerable:true,configurable:false,get:function(){return e.displayName()}});Object.defineProperty(t,"name",{enumerable:true,configurable:false,get:function(){return e.displayName()}})}else{t.title=l.Locale.getString("all_linked_boxes");t.name=t.title;t.property="linkedBoxes"}u.systemProperties.push(t)}});var d={type:"COMPUTED",sortType:"TEXT",filterAndGroupType:"TEXT",summaryType:"LIST",isEditable:true,isGroupable:true,isFilterable:true,isLinkedProperty:true,group:"Z_LINKED_BOXES",computeFunction:function(e){var t=h(e,this);var n=t.length;if(n===0){return""}var i=[];i.push('<span class="streak__linkedBoxes_wrapper');if(n>1){i.push(" streak__linkedBoxes_wrapper_moreThanOne")}i.push('">');i.push('<span class="streak__linkedBoxes_names">');for(var r=0;r<t.length;r++){i.push('<span class="streak__linkedBoxes_name">');if(r>0){i.push(", ")}i.push(t[r].displayName());i.push("</span>")}i.push("</span>");if(n>1){i.push('<span class="streak__linkedBoxes_numberOfBoxes">');i.push("("+n+")");i.push("</span>")}i.push("</span>");return i.join("")},textValueFunction:function(e){var t=h(e,this);return n.map(t,function(e){return e.displayName()}).join(", ")},filterValueFunction:function(e){var t=h(e,this);return n.map(t,function(e){return e.displayName()}).join(" ")},groupByFunction:function(e){var t=h(e,this);return n.map(t,function(e){return e.displayName()})},sortFunction:function(e){var t=h(e,this);return n.map(t,function(e){return e.displayName()}).join(" ")}};function h(e,t){var i=t.property.split(".");var r;if(i.length>1){r=t.property.split(".")[1]}var a=e.get("linkedBoxKeys");return n.chain(a).map(function(e){return l.Data.getBox(e)}).filter(function(e){return e&&(!r||e.getPipeline().key()===r)}).sort(function(e){return e.displayName()}).value()}u.getLinkedBoxSystemColumn=function(e){if(e){return u.getSystemProperty("linkedBoxes."+e.key())}return u.getSystemProperty("linkedBoxes")};e.DependencyManager.addFunction({functionKey:"pipelineLinkedBoxesPropertyInitialized",functionToCall:function(t){e.Library.set("BentoBox.Models.Pipeline.PipelineLinkedBoxesProperty",new c);if(t){t()}},dependentFunctionKeys:["data.pipelines.collectionCreated","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox,d=e.Operations,h=e.Operations.OperationQueue.Singleton;var f=e.Class.subclass({className:"PipelineColumnAddOptionOperationManager",superclass:d.ModelOperationManager,_memberVariables:[],_initialize:function(){e.Operations.ModelOperationManager.prototype._initialize.call(this)},addOptionSetOnBox:function(t,n,i){var r=e.guid();var a=t.getEditOperations();var o=this._getNewModelUpdateOperation(t,a);o.optionName=n;this._markEditOperations(a,o);o.getTags().push(r);o.getDependentOnTags().push(r);var s=i.getEditOperations();var l=i.get("value");s.push({property:"value",waitingForKey:true,value:n,placeHolder:n});i.sendOutChangeNotifications("value",l,n);var u=this._getNewModelUpdateOperation(i,s);this._markEditOperations(s,u);u.getTags().push(r);u.getDependentOnTags().push(r);o.setFollowUpOperation(u);var d=h.addMultipleOperations([o,u],this);c.ButterBarManager.showMessage({message:c.Locale.getString("adding_option"),operationProgressId:d})},_operationSucceeded:function(e){if(!e.getFollowUpOperation()){d.ModelOperationManager.prototype._operationSucceeded.call(this,e);return}this.updateModel(e.getModel(),e.getResponse(),e.getId());var t=e.getModel().getOptionByName(e.optionName);if(!t){e.getFollowUpOperation().cancel();return}var i=e.getFollowUpOperation();var r=i.getEditOperations();n.each(r,function(e){if(e.operationId===i.getId()&&e.waitingForKey){e.value=t.key}});d.ModelOperationManager.prototype._operationSucceeded.call(this,e)},_operationFailed:function(e){if(!e.getFollowUpOperation()){d.ModelOperationManager.prototype._operationFailed.call(this,e);return}e.getFollowUpOperation().cancel();d.ModelOperationManager.prototype._operationFailed.call(this,e)}});i.set("BentoBox.Models.PipelineColumnAddOptionOperationManager",new f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox,d=e.Operations,h=e.Operations.OperationQueue.Singleton;var f=e.Class.subclass({className:"PipelineColumnAddTagOperationManager",superclass:d.ModelOperationManager,_memberVariables:[],_initialize:function(){e.Operations.ModelOperationManager.prototype._initialize.call(this)},createTagsAndUpdateBoxField:function(t,i,r,a){var o=e.guid();var s=n.clone(i.get("tagSettings"));s.tags=n.chain(t).map(function(e){return{tag:e}}).concat(s.tags).value();i.set("tagSettings",s);var l=i.getEditOperations();var u=this._getNewModelUpdateOperation(i,l);u.newTagsToBeCreated=t;this._markEditOperations(l,u);u.getTags().push(o);u.getDependentOnTags().push(o);var c=a.getEditOperations();var d=a.get("value");c.push({property:"value",waitingForKey:true,value:r});a.sendOutChangeNotifications("value",d,r);var f=this._getNewModelUpdateOperation(a,c);this._markEditOperations(c,f);f.getTags().push(o);f.getDependentOnTags().push(o);u.setFollowUpOperation(f);var p=h.addMultipleOperations([u,f],this);this._showSavingMessage(p)},_operationSucceeded:function(e){if(!e.getFollowUpOperation()){d.ModelOperationManager.prototype._operationSucceeded.call(this,e);return}this.updateModel(e.getModel(),e.getResponse(),e.getId());var t=n.map(e.newTagsToBeCreated,e.getModel().getOptionByName.bind(e.getModel()));var i={};n.each(t,function(e){i[e.tag]=e.key});var r=e.getFollowUpOperation();var a=r.getEditOperations();for(var o=0;o<a.length;o++){var s=a[o];if(s.operationId===r.getId()&&s.waitingForKey){var l=s.value;for(var u=0;u<l.length;u++){var c=i[l[u]];if(c){l[u]=c}}}}d.ModelOperationManager.prototype._operationSucceeded.call(this,e)},_operationFailed:function(e){if(!e.getFollowUpOperation()){d.ModelOperationManager.prototype._operationFailed.call(this,e);return}e.getFollowUpOperation().cancel();d.ModelOperationManager.prototype._operationFailed.call(this,e)}});i.set("BentoBox.Models.PipelineColumnAddTagOperationManager",new f)})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e,t){i.call(this,e);this.syncParent=t};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"key",entityType:"Stage",createProperties:["name","pipelineKey"],modifyProperties:["key","pipelineKey"],nameProperty:"name",tagEntityName:"stage",apiURLs:{get:"pipelines/<%= pipelineKey %>/stages/<%= key %>",update:"pipelines/<%= pipelineKey %>/stages/<%= key %>","delete":"pipelines/<%= pipelineKey %>/stages/<%= key %>",create:"pipelines/<%= pipelineKey %>/stages"},getExtraRequestParameters:function(){return{pipelineKey:this.syncParent.key()}},getResponseObjectAffectingModel:function(e){if(e.stages){return e.stages[this.key()]}return e}});o.create=function(e,t){return new o(e,t)};o.createCollection=function(t){var n=new e.Collection;var i=a.Data.getPipeline(t);n.init({modelKeyPropertyName:"key",createModelFromRawJSON:function(e){return o.create(e,i)}});return n};a.Models.Stage=o})(Streak);(function(e){"use strict";var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=a.Models.Pipeline;var s=[];var l={};var u=function(e){i.call(this,e)};u.prototype=Object.create(i.prototype);t.extend(u.prototype,{keyName:"boxKey",nameProperty:"name",entityType:"Case",typeName:"box",createProperties:["pipelineKey","name","stageKey"],apiURLs:{get:"boxes/<%= boxKey %>",update:"boxes/<%= boxKey %>",create:"pipelines/<%= pipelineKey %>/boxes","delete":"boxes/<%= boxKey %>"},tagEntityName:"box",getRequestTags:function(e,t,n){t=t||[];var r=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return r.concat(["box_create_pipelineKey_"+this.get("pipelineKey"),"boxCollection_pipelineKey_"+this.get("pipelineKey")]);break;case"DELETE":return r.concat(["box_delete_pipelineKey_"+this.get("pipelineKey"),"boxCollection_pipelineKey_"+this.get("pipelineKey")]);break}return r},getModelsAffectedByServerResponse:function(){var e=[this];if(this._getFieldModels()){e=e.concat(this._getFieldModels())}return e},getRequestLimiterTagsAndTypes:function(t,n,i){switch(t){case"CREATE":case"DELETE":return[{tag:this.getPipeline().get("orgKey"),type:e.Operations.OperationLimiterRules.TYPES.ENTITY_GROUP_WRITE}];break;case"UPDATE":var r=[{tag:this.getPipeline().get("orgKey"),type:e.Operations.OperationLimiterRules.TYPES.ENTITY_GROUP_WRITE}];return r;break}},getResponseObjectAffectingModel:function(e){return e},isResponseMoreRecent:function(t){var n=e.Model.prototype.isResponseMoreRecent.call(this,t);if(n){return n}var i=t.fields;if(!i){return n}for(var r in i){var a=i[r];var o=this.getFieldValue(r);if(!o){return true}if(!a){return true}if(a.lastCalculatedTimestamp&&o.lastCalculatedTimestamp){if(a.lastCalculatedTimestamp>o.lastCalculatedTimestamp){return true}}if(a.calculationStatus&&a.calculationStatus!==o.calculationStatus&&o.calculationStatus==="NOT_ATTEMPTED"){return true}}return false},getThreads:function(){return e.BentoBox.Data.getGmailThreadCollectionForBox(this.key())},getFieldSortValue:function(e){return a.Models.BoxField.getSortValue(this,e)},getFieldFilterValue:function(e,t){return a.Models.BoxField.getFilterValue(this,e,t)},getFieldGroupByValue:function(e){return a.Models.BoxField.getGroupByValue(this,e)},getFieldSearchValue:function(e){return a.Models.BoxField.getSearchValue(this,e)},getFieldTextValue:function(e){return a.Models.BoxField.getTextValue(this,e)},getFieldDisplayTextValue:function(e){return a.Models.BoxField.getDisplayTextValue(this,e)},getFieldValue:function(e){var t=this._getFieldModel(e);if(t){return t.get("value")}var n=this.get("fields");return n?n[e]:""},getFieldModel:function(e){var t=this._getFieldModel(e);if(!t){t=this._generateFieldModel(e)}return t},getFieldModels:function(){var e=this.getPipeline().getFields();return t.map(e,function(e){return this.getFieldModel(e.key())},this)},addLinkedBox:function(n){var i=a.Services.LinkedBoxesLimiter;if(i.isLocked()){i.showGateway()}else{var r=t.clone(this.get("linkedBoxKeys")||[]);r.push(n.key());r=t.uniq(r);this.set("linkedBoxKeys",r);r=n.get("linkedBoxKeys")||[];r.push(this.key());n.set("linkedBoxKeys",r);e.Model.saveAll([this,n]);i.incrementUsage()}},removeLinkedBox:function(n){var i=t.clone(this.get("linkedBoxKeys")||[]);i.removeVal(n.key());this.set("linkedBoxKeys",i);i=n.get("linkedBoxKeys")||[];i.removeVal(this.key());n.set("linkedBoxKeys",i);e.Model.saveAll([this,n])},_generateFieldModel:function(e){var t=this.getFieldValue(e);var n=a.Models.BoxField.create({key:e,boxKey:this.key(),value:t,type:this.getPipeline().getField(e).get("type")},this);this._addFieldModelToMap(n);return n},_getFieldModel:function(e){if(!this._getFieldModels()){return null}return t.find(this._getFieldModels(),function(t){return t.key()===e})},_addFieldModelToMap:function(e){if(!l[this.getId()]){l[this.getId()]=[]}l[this.getId()].push(e)},_getFieldModels:function(){if(!l[this.getId()]){return null}return l[this.getId()]},clearFields:function(){this.getWrappedObject().fields={};delete l[this.getId()]},getStage:function(){var e=this.getPipeline();if(e){return e.getStage(this.get("stageKey"))}return null},getStageName:function(){return this.getStage().displayNameHTML()},getAssignedToSharingEntries:function(){return this.get("assignedToSharingEntries")},getIsEditable:function(){return this.getPipeline().getIsEditable()},getPipelineKey:function(){return this.get("pipelineKey")},getPipeline:function(){return a.Data.getPipeline(this.get("pipelineKey"))},markFieldCalculating:function(e){var t=this._getFieldModel(e);if(t){var n=t.get("value");
n.calculationStatus="NOT_ATTEMPTED";if(n.lastCalculatedTimestamp){n.lastCalculatedTimestamp++}return}var i=this.get("fields")||{};var r=i[e];if(!r){i[e]={};r=i[e]}r.calculationStatus="NOT_ATTEMPTED";if(r.lastCalculatedTimestamp){r.lastCalculatedTimestamp++}},_canSave:function(){var e=this.getPipeline();var t=this.isSavedOnServer()?"UPDATE":"CREATE";return!e||a.Services.AccessManager.isAccessAllowed(e,"Box",t)},_canDelete:function(){var e=this.getPipeline();return!e||!this.isSavedOnServer()||a.Services.AccessManager.isAccessAllowed(e,"Box","DELETE")}});u.create=function(e){return new u(e)};u.createCollection=function(e,t){var n=new r;n.init({modelKeyPropertyName:"boxKey",apiURL:e?"pipelines/"+e+"/boxes":"/boxes",requestExtraOptions:{prefix:"/api/v2/"},requestTags:["boxCollection_pipelineKey_"+e],requestDependentOnTags:["boxCollection_pipelineKey_"+e],refreshRequeueOperationTags:["box_create_pipelineKey_"+e,"box_delete_pipelineKey_"+e,"box_move_pipelineKey_"+e],createModelFromRawJSON:u.create,getCountHint:function(){return a.Data.getPipeline(e).get("boxCountHint")}});return n};a.Models.Box=u})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=a.Models.Pipeline;t.extend(a.Models.Box.prototype,{getProcessedHTMLValue:function(n){if(n==="stageKey"){return this.getStageName()}var i=o.getPropertyType(n);var r=this.get(n);switch(i){case"DATE":return t.escape(e.DateString.prettyDate(r));break;case"NUMBER":if(!r){r=0}return t.escape(r+"");break;case"COMPUTED":var a=o.getSystemProperty(n);return a.computeFunction(this);break;default:return t.escape(r+"")}},getSortValue:function(e){var t=o.getPropertyType(e);var n=this.get(e);var i=o.getSystemProperty(e);if(i.sortFunction){return i.sortFunction.call(i,this)}switch(t){case"DATE":return parseInt(n);break;case"NUMBER":if(!n){n=0}return parseFloat(n);break;default:if(n&&n.trim){return n.trim()}return n}},getGroupByValue:function(e){var t=o.getPropertyType(e);var n=this.get(e);var i=[];if(e==="stageKey"){if(this.getStage()){i.push(this.get(e))}}else{switch(t){case"COMPUTED":var r=o.getSystemProperty(e);i=r.groupByFunction.call(r,this);break;case"DATE":i.push(n);break;default:i.push(this.getProcessedHTMLValue(e))}}if(!i||i.length===0){i=["no_value"]}return i},getTextValue:function(t){var n=o.getSystemProperty(t);if(!n){return""}if(n.type==="DATE"){var i=this.get(t);return e.DateString.format(i,"export")}else if(n.textValueFunction){return n.textValueFunction.call(n,this)}else{return this.getProcessedHTMLValue(t)}},getSearchValue:function(t){var n=o.getSystemProperty(t);if(!n){return""}if(n.type==="DATE"){return e.DateString.prettyDate(this.get(t))}else if(n.textValueFunction){return n.textValueFunction.call(n,this)}else{return this.getProcessedHTMLValue(t)}},getDisplayTextValue:function(t){var n=o.getSystemProperty(t);if(!n){return""}if(n.type==="DATE"){var i=this.get(t);var r=e.DateString.prettyDate(i);return r||""}else if(n.textValueFunction){return n.textValueFunction.call(n,this)}else{return""+this.get(t)}},getFilterValue:function(e){var t=o.getSystemProperty(e);if(!t){return""}if(t.filterValueFunction){return t.filterValueFunction.call(t,this)}else{return this.get(e)}}})})(Streak);(function(e){"use strict";var t=e._,n=e.Date,i=e.Model,r=e.BentoBox;var a=function(e,t){i.call(this,e);this.syncParent=t;this._sortValue=null;this.setSortValue()};a.prototype=Object.create(i.prototype);t.extend(a.prototype,{keyName:"key",entityType:"Field",modifyProperties:["key","boxKey"],nameProperty:"value",set:function(e,t){i.prototype.set.apply(this,[e,t]);this.clearSortValue()},apiURLs:{update:"boxes/<%= boxKey %>/fields/<%= key %>"},tagEntityName:"boxField",getExtraRequestParameters:function(e){return{boxKey:this.syncParent.key()}},getExtraUpdateParameters:function(){if(r.isFeatureEnabled("formulaFields")){return{returnCase:true}}},getModelsAffectedByServerResponse:function(e){if(e.fields){return this.syncParent.getModelsAffectedByServerResponse()}return[this]},getResponseObjectAffectingModel:function(e){if(!e.fields){return e}return{key:this.key(),value:e.fields[this.key()]}},isResponseMoreRecent:function(t){var n=this.get("value");if(!n){return true}if(!n.lastCalculatedTimestamp){return true}var i=t.value;if(i&&i.lastCalculatedTimestamp){if(i.lastCalculatedTimestamp>n.lastCalculatedTimestamp){return true}}return e.Model.prototype.isResponseMoreRecent.call(this,i)},setWrappedObject:function(e){i.prototype.setWrappedObject.call(this,e);this.clearSortValue()},needsCreateOperation:function(){return false},getIsEditable:function(){return this.syncParent.getIsEditable()},getSortValue:function(){if(!this._sortValue){this.setSortValue()}return this._sortValue},setSortValue:function(){this._sortValue=a.getSortValue(this.syncParent,this.key())},clearSortValue:function(){this._sortValue=null},_getType:function(){return this.syncParent.getPipeline().getField(this.key()).get("type")}});a.create=function(e,t){return new a(e,t)};r.Models.BoxField=a})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.BentoBox;var u=l.Models.BoxField;u.copyFieldOptions=function(e,t){var i=e.getFields();var r=t.getFields();for(var a=0;a<i.length;a++){var o=i[a];var s=r[a];switch(o.get("type")){case"DROPDOWN":var l=o.get("dropdownSettings");var u={items:n.chain(l.items).pluck("name").uniq().map(function(e){return{name:e}}).value()};s.set("dropdownSettings",u);s.save();break;case"TAG":var c=o.get("tagSettings");var d={tags:n.chain(c.tags).pluck("tag").uniq().map(function(e){return{tag:e}}).value()};s.set("tagSettings",d);s.save();break}}};u.getCustomColumnTypes=function(){var e=[{name:l.Locale.getString("column_type_free"),type:"TEXT_INPUT"},{name:l.Locale.getString("column_type_person"),type:"PERSON"},{name:l.Locale.getString("column_type_date"),type:"DATE"},{name:l.Locale.getString("column_type_checkbox"),type:"CHECKBOX"},{name:l.Locale.getString("column_type_dropdown"),type:"DROPDOWN"},{name:l.Locale.getString("column_type_tag"),type:"TAG"},{name:l.Locale.getString("column_type_formula"),type:"FORMULA"}];return e};u.getColumnEditStatusTransformOptions=function(e,t){var n=e.getField(t);var i=n.get("type");var r={isEditable:true,isActionable:false,isRenameable:true};switch(i){case"CHECKBOX":r.isEditable=false;r.isActionable=true;r.isCheckbox=true;break;case"FORMULA":r.isEditable=l.Services.AccessManager.isAccessAllowed(e,"FieldPipeline","UPDATE");break}return r};u.getFilterType=function(e,t){var n=e.getField(t);if(n.get("type")!=="FORMULA"){return n.get("type")}var i=l.Data.getPipelineBoxes(e.key());var r=null;for(var a=0;a<i.length;a++){var o=i[a].getFieldValue(t);if(!o){continue}if(o.calculationStatus!=="SUCCESS"){continue}if(!o.calculationValueType){continue}if(!r){r=o.calculationValueType;continue}if(r!==o.calculationValueType){r="MIXED"}}if(!r){return"BASIC_TEXT"}if(r.indexOf("List")>-1||r.indexOf("Map")>-1){return"BASIC_TEXT"}switch(r){case"java.lang.Double":case"java.lang.Integer":case"java.lang.Long":return"NUMBER";break;case"java.lang.Boolean":return"BOOLEAN";break;case"java.util.Date":return"DATE";break;case"java.lang.String":return"BASIC_TEXT";break;default:return"BASIC_TEXT";break}};u.getFilterOperations=function(e,t){switch(e){case"BASIC_TEXT":return[{name:l.Locale.getString("filter_contains"),value:"contains"},{name:l.Locale.getString("filter_not_contains"),value:"notContains"}];break;case"TEXT":case"TEXT_INPUT":return[{name:l.Locale.getString("filter_contains"),value:"contains"},{name:l.Locale.getString("filter_not_contains"),value:"notContains"},"__separator",{name:l.Locale.getString("filter_equals"),value:"eq"},{name:l.Locale.getString("filter_not_equals"),value:"ne"},{name:l.Locale.getString("filter_greater_than"),value:"gt"},{name:l.Locale.getString("filter_less_than"),value:"lt"},"__separator",{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"}];break;case"STAGE":var n=[{name:l.Locale.getString("filter_is_any"),value:"isAny"},{name:l.Locale.getString("filter_is_not_any"),value:"isNotAny"}];if(t==="eq"){n.push("__separator");n.push({name:l.Locale.getString("filter_equals"),value:"eq"})}if(t==="ne"){n.push("__separator");n.push({name:l.Locale.getString("filter_not_equals"),value:"ne"})}if(t==="contains"){n.push("__separator");n.push({name:l.Locale.getString("filter_contains"),value:"contains"})}if(t==="notContains"){n.push("__separator");n.push({name:l.Locale.getString("filter_not_contains"),value:"notContains"})}return n;break;case"NUMBER":return[{name:l.Locale.getString("filter_equals"),value:"eq"},{name:l.Locale.getString("filter_not_equals"),value:"ne"},{name:l.Locale.getString("filter_greater_than"),value:"gt"},{name:l.Locale.getString("filter_less_than"),value:"lt"},"__separator",{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"}];break;case"DATE":return[{name:l.Locale.getString("date_filter_before"),value:"before"},{name:l.Locale.getString("date_filter_after"),value:"after"},{name:l.Locale.getString("date_filter_range"),value:"on"},"__separator",{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"}];break;case"PERSON":var n=[{name:l.Locale.getString("filter_is_any"),value:"isAny"},{name:l.Locale.getString("filter_is_not_any"),value:"isNotAny"},{name:l.Locale.getString("filter_is_exactly"),value:"isExactly"}];if(t==="includes"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_includes"),value:"includes"})}if(t==="doesNotInclude"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_not_includes"),value:"doesNotInclude"})}if(t==="isOnly"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_only"),value:"isOnly"})}n=n.concat(["__separator",{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"},"__separator",{name:l.Locale.getString("filter_contains"),value:"contains"},{name:l.Locale.getString("filter_not_contains"),value:"notContains"}]);return n;break;case"TAG":var n=[{name:l.Locale.getString("filter_is_any"),value:"isAny"},{name:l.Locale.getString("filter_is_not_any"),value:"isNotAny"},{name:l.Locale.getString("filter_is_exactly"),value:"isExactly"}];if(t==="includes"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_includes"),value:"includes"})}if(t==="doesNotInclude"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_not_includes"),value:"doesNotInclude"})}if(t==="isOnly"){n.push("__separator");n.push({name:l.Locale.getString("people_filter_only"),value:"isOnly"})}if(t==="contains"){n.push("__separator");n.push({name:l.Locale.getString("filter_contains"),value:"contains"})}if(t==="notContains"){n.push("__separator");n.push({name:l.Locale.getString("filter_not_contains"),value:"notContains"})}n.push("__separator");n=n.concat([{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"}]);return n;break;case"CHECKBOX":return[{name:l.Locale.getString("filter_is_checked"),value:"isChecked"},{name:l.Locale.getString("filter_is_unchecked"),value:"isUnchecked"}];break;case"DROPDOWN":var n=[{name:l.Locale.getString("filter_is_any"),value:"isAny"},{name:l.Locale.getString("filter_is_not_any"),value:"isNotAny"}];if(t==="contains"){n.push("__separator");n.push({name:l.Locale.getString("filter_contains"),value:"contains"})}if(t==="notContains"){n.push("__separator");n.push({name:l.Locale.getString("filter_not_contains"),value:"notContains"})}if(t==="eq"){n.push("__separator");n.push({name:l.Locale.getString("filter_equals"),value:"eq"})}if(t==="ne"){n.push("__separator");n.push({name:l.Locale.getString("filter_not_equals"),value:"ne"})}n=n.concat(["__separator",{name:l.Locale.getString("filter_is_set"),value:"isSet"},{name:l.Locale.getString("filter_not_set"),value:"notSet"}]);return n;break;case"BOOLEAN":return[{name:l.Locale.getString("filter_is_true"),value:"isTrue"},{name:l.Locale.getString("filter_is_false"),value:"isFalse"}];break}};u.getFilterTextValues=function(e,t,i,r){switch(e){case"STAGE":return n.map(i.getStages(),function(e){return{name:e.displayNameText(),displayText:e.displayNameText(),value:e.key()}});break;case"DATE":switch(t){case"on":return[{name:l.Locale.getString("date_filter_value_today"),value:"today"},{name:l.Locale.getString("date_filter_value_yesterday"),value:"yesterday"},{name:l.Locale.getString("date_filter_value_tomorrow"),value:"tomorrow"},"__separator",{name:l.Locale.getString("date_filter_value_this_week"),value:"this week"},{name:l.Locale.getString("date_filter_value_this_month"),value:"this month"},{name:l.Locale.getString("date_filter_value_this_year"),value:"this year"},"__separator",{name:l.Locale.getString("date_filter_value_last_week"),value:"last week"},{name:l.Locale.getString("date_filter_value_last_month"),value:"last month"},{name:l.Locale.getString("date_filter_value_last_year"),value:"last year"},"__separator",{name:l.Locale.getString("date_filter_value_next_week"),value:"next week"},{name:l.Locale.getString("date_filter_value_next_month"),value:"next month"},{name:l.Locale.getString("date_filter_value_next_year"),value:"next year"}];break;default:return[{name:l.Locale.getString("date_filter_specific"),value:"__specific"},{name:l.Locale.getString("date_filter_specific_range"),value:"__specific_range"},"__separator",{name:l.Locale.getString("date_filter_value_today"),value:"today"},{name:l.Locale.getString("date_filter_value_yesterday"),value:"yesterday"},{name:l.Locale.getString("date_filter_value_tomorrow"),value:"tomorrow"},"__separator",{name:l.Locale.getString("date_filter_value_last_days_ago",{number:7}),value:"last 7 days"},{name:l.Locale.getString("date_filter_value_last_days_ago",{number:30}),value:"last 30 days"},{name:l.Locale.getString("date_filter_value_last_days_ago",{number:90}),value:"last 90 days"},{name:l.Locale.getString("date_filter_value_last_days_ago",{number:180}),value:"last 180 days"},{name:l.Locale.getString("date_filter_value_last_days_ago",{number:365}),value:"last 365 days"},"__separator",{name:l.Locale.getString("date_filter_value_days_from_now",{number:7}),value:"next 7 days"},{name:l.Locale.getString("date_filter_value_days_from_now",{number:30}),value:"next 30 days"},{name:l.Locale.getString("date_filter_value_days_from_now",{number:90}),value:"next 90 days"},{name:l.Locale.getString("date_filter_value_days_from_now",{number:180}),value:"next 180 days"},{name:l.Locale.getString("date_filter_value_days_from_now",{number:365}),value:"next 365 days"}];break}break;case"PERSON":var a=[{name:"Me",displayText:"Me",value:"me"}];var o=u.getExistingTextValuesInBoxes(i,r);if(o.length>0){a.push("__separator");a=a.concat(o)}return a;break;case"DROPDOWN":if(!r){return[]}var s=i.getField(r);return n.map(s.getOptions(),function(e){return{name:e.name,value:e.key,displayText:e.name}});break;case"TAG":if(!r){return[]}var c=i.getField(r);return n.chain(c.getOptions()).filter(function(e){return!!e.key}).sortBy(function(e){return e.tag}).map(function(e){return{name:e.tag,value:e.key,displayText:e.tag}}).value();break}};u.getFilterValue=function(e,t,n){var i=e.getPipeline().getField(t).get("type");if(i==="FORMULA"){var r=e.getFieldValue(t);switch(n){case"DATE":if(r){if(r.calculationStatus==="SUCCESS"&&r.calculationValueType==="java.util.Date"){var o=a.create(r.calculationValue);if(o.isValid()){return r.calculationValue}}}return null;break;case"BOOLEAN":if(r){if(r.calculationStatus==="SUCCESS"&&r.calculationValueType==="java.lang.Boolean"){return r.calculationValue}}return null;break;default:return f(r);break}}else{return e.getFieldValue(t)}};u.getAssignedToFilterTextValues=function(e){var t=[{name:"Me",displayText:"Me",value:"me"}];var i=l.Data.getPipelineBoxes(e.key());i.sortByParameter("lastUpdatedTimestamp");var r=n(i).chain().last(100).map(function(e){return e.get("assignedToSharingEntries")}).flatten().filter(function(e){return n.isReal(e)&&n.isReal(e.displayName)}).map(function(e){return ret={value:e,display:e.displayName,displayText:e.displayName}}).sortBy(function(e){return e.display.toLowerCase()}).uniq(false,function(e){return e.value.email}).value();if(r.length>0){t.push("__separator");t=t.concat(r)}return t};u.getSidebarInputWidget=function(e,t,n,i){var r={model:e.getFieldModel(t.key()),property:"value",border:"always",trackingContext:i,parent:n};switch(t.get("type")){case"TEXT_INPUT":r.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),t.key());r.readHTML=true;return l.Widgets.SidebarTextarea.create(r);break;case"DATE":return new l.Widgets.SmartTextCalendarViewController(r);break;case"PERSON":r.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),t.key());r.includeNames=true;r.imgHeight=23;r.imgWidth=23;return l.Widgets.PeoplePicker.create(r);break;case"CHECKBOX":return new l.Widgets.SmartCheckboxViewController(r);break;case"FORMULA":r.fieldKey=t.key();r.box=e;return new l.Widgets.FormulaValueLabel(r);break;case"DROPDOWN":r.optionSource=t;return new l.Widgets.SmartTextDropdownViewController(r);break;case"TAG":r.optionSource=t;r.alwaysShowBorder=true;return new l.Widgets.SmartTagsViewController(r);break}};u.getBoxViewInputWidget=function(e,t,n,i){var r={model:e.getFieldModel(t.key()),property:"value",border:"hover",trackingContext:i,parent:n};switch(t.get("type")){case"TEXT_INPUT":r.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),t.key());r.readHTML=true;return l.Widgets.SidebarTextarea.create(r);break;case"DATE":return new l.Widgets.SmartTextCalendarViewController(r);break;case"PERSON":r.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),t.key());r.includeNames=true;r.imgHeight=20;r.imgWidth=20;return l.Widgets.PeoplePicker.create(r);break;case"CHECKBOX":return new l.Widgets.SmartCheckboxViewController(r);break;case"FORMULA":r.box=e;r.fieldKey=t.key();return new l.Widgets.FormulaValueLabel(r);break;case"DROPDOWN":r.optionSource=t;return new l.Widgets.SmartTextDropdownViewController(r);break;case"TAG":r.optionSource=t;return new l.Widgets.SmartTagsViewController(r);break}};u.getSpreadsheetInputOptions=function(e,t,n,i,r){var a=e.getPipeline();var o=a.getField(t);var s={model:e.getFieldModel(t),property:"value",type:o.get("type")};switch(s.type){case"TEXT_INPUT":case"PERSON":s.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),o.key());break;case"DROPDOWN":s.optionSource=o;break;case"FORMULA":s.model=a.getField(t);s.property="defaultValue";s.pipeline=a;s.stageKey=e.get("stageKey");s.box=e;s.tableModel=i;s.spreadsheetRedrawFunction=r.redrawContentRows.bind(r);s.coord=[0,n[1]];s.coord[0]=i.getGroupRowIndex(i._getClosestGroupID(n[0]));break;case"TAG":s.optionSource=o;break}return s};u.getMailMergeInputWidget=function(e,t){var n={model:e.getFieldModel(t),property:"value",border:"always",trackingContext:{widgetContext:"mailMerge"}};var i=e.getPipeline().getField(t);switch(i.get("type")){case"TEXT_INPUT":n.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),i.key());n.readHTML=false;n.border="alwaysGmail";return l.Widgets.SidebarTextarea.create(n);break;case"DATE":return new l.Widgets.SmartTextCalendarViewController(n);break;case"PERSON":n.existingList=u.getExistingTextValuesInBoxes(e.getPipeline(),i.key());n.includeNames=true;n.imgHeight=23;n.imgWidth=23;return l.Widgets.PeoplePicker.create(n);break;case"CHECKBOX":return new l.Widgets.SmartCheckboxViewController(n);break;case"DROPDOWN":n.optionSource=i;return new l.Widgets.SmartTextDropdownViewController(n);break;case"TAG":n.optionSource=i;return new l.Widgets.SmartTagsViewController(n);break;case"FORMULA":return new l.Widgets.FormulaValueLabel(n);break}};u.getExistingTextValuesInBoxes=function(e,t){var i=l.Data.getPipelineBoxes(e.key());var r=e.getField(t).get("type");if(r==="DATE"||r==="CHECKBOX"||r==="FORMULA"){return[]}if(r==="DROPDOWN"){return n.map(e.getField(t).getOptions(),function(e){return{value:e.key,display:e.name,displayText:e.name,normalized:e.name.toLowerCase().removeWhitespace()}})}else if(r==="TAG"){return n.map(e.getField(t).getOptions(),function(e){return{value:e.key,displayText:e.tag}})}i.sortByParameter("lastUpdatedTimestamp");return n(i).chain().last(500).map(function(e){return e.getFieldValue(t)}).flatten().filter(function(e){if(r==="PERSON"){return n.isReal(e)&&n.isReal(e.displayName)}return e}).map(function(e){var t={value:e,display:null,normalized:null};switch(r){case"TEXT_INPUT":t.display=t.value.replace(/\n/gim," ");t.normalized=t.display.toLowerCase().removeWhitespace();break;case"DATE":t.display=t.value;break;case"PERSON":case"ASSIGNED_TO":t.display=t.value.displayName;t.displayText=t.display;break}return t}).sortBy(function(e){return e.display.toLowerCase()}).uniq(false,function(e){if(r==="ASSIGNED_TO"){return e.value.email}else if(r==="PERSON"){return e.value.email||e.display}return e.value.trim().toLowerCase()}).value()};u.getSortValue=function(e,t){var i=e.getFieldValue(t);var r=e.getPipeline().getField(t).get("type");switch(r){case"TEXT_INPUT":case"DATE":if(i&&i.trim){i=i.trim()}break;case"PERSON":try{var a=i;var o=[];for(var s=0;s<a.length;s++){o.push(a[s].displayName)}o.sort();i=o.join(",")}catch(u){i=""}break;case"CHECKBOX":i=i?1:0;break;case"DROPDOWN":if(i){var c=e.getPipeline().getField(t);i=c.getOption(i).name}else{i=""}break;case"TAG":if(i){var c=e.getPipeline().getField(t);i=p(c,i)}else{i=""}break;case"FORMULA":if(!i){return""}if(i.calculationStatus==="SUCCESS"){if(n.isReal(i.calculationValue)){return f(i)}}else if(i.calculationStatus==="NOT_ATTEMPTED"){return l.Locale.getString("formula_calculating")}else{return l.Locale.getString("formula_error")}return"";break}return i};u.getGroupByValue=function(e,t,i){var r=e.getPipeline().getField(t);if(!r){l.logError("Could not find field",null,{fieldKey:t});return null}var a=r.get("type");var o=e.getFieldValue(t);switch(a){case"DATE":return o?[m(o,i)]:["no_value"];break;case"TEXT_INPUT":return o?[o]:[""];break;case"PERSON":return o&&o.length?n.pluck(o,"displayName"):[""];break;case"CHECKBOX":return o?["Checked"]:["Unchecked"];break;case"FORMULA":if(!o){return["no_value"]}if(o.calculationStatus==="SUCCESS"){if(n.isReal(o.calculationValue)){return[f(o)]}}else if(o.calculationStatus==="NOT_ATTEMPTED"){return[l.Locale.getString("formula_calculating")]}else{return[l.Locale.getString("formula_error")]}return["no_value"];break;case"DROPDOWN":if(o){var s=r.getOption(o);o=s.name||o;return[o]}else{return[l.Locale.getString("no_value")]}break;case"TAG":if(o&&o.length>0){var r=e.getPipeline().getField(t);return n.chain(o).map(r.getOption.bind(r)).pluck("tag").value()}else{return[""]}break}};u.getGroupByDisplayTextValue=function(e,t,n,i){var r=t.getField(n);switch(r.get("type")){case"DATE":var o=a.create(e);if(o.isValid()){return _(o,i)}break;case"TEXT_INPUT":case"PERSON":case"FORMULA":case"CHECKBOX":case"DROPDOWN":case"TAG":if(e){return e}break}return l.Locale.getString("no_value")};u.getTextValue=function(t,i){var r=t.getFieldValue(i);var a=t.getPipeline().getField(i).get("type");switch(a){case"TEXT_INPUT":r=r?r:"";break;case"DATE":r=e.DateString.format(r,"export");break;case"PERSON":try{var o=r;var s=[];for(var u=0;u<o.length;u++){if(o[u].email===o[u].displayName){s.push(o[u].email)}else{var c=o[u].givenName+" "+o[u].familyName;if(o[u].email){c+=" <"+o[u].email+">"}s.push(c)}}r=s.join(",")}catch(d){r=""}break;case"CHECKBOX":if(r){r="Checked"}else{r="Unchecked"}break;case"DROPDOWN":if(r){var h=t.getPipeline().getField(i);r=h.getOption(r).name}else{r=""}break;case"FORMULA":if(!r){return""}if(r&&r.calculationStatus==="SUCCESS"){if(n.isReal(r.calculationValue)){return f(r)}}else if(r.calculationStatus==="NOT_ATTEMPTED"){return l.Locale.getString("formula_calculating")}else{return l.Locale.getString("formula_error")}return"";break;case"TAG":if(r){var h=t.getPipeline().getField(i);return p(h,r)}else{r=""}break}return r};u.getSearchValue=function(t,n){var i=t.getPipeline().getField(n).get("type");if(i==="DATE"){return e.DateString.prettyDate(t.getFieldValue(n))}return u.getTextValue(t,n)};u.getDisplayTextValue=function(t,i){var r=t.getFieldValue(i);var a=t.getPipeline().getField(i).get("type");switch(a){case"TEXT_INPUT":break;case"DATE":r=e.DateString.prettyDate(r);break;case"PERSON":try{var o=r;var s=[];for(var u=0;u<o.length;u++){if(o[u].email===o[u].displayName){s.push(o[u].email)}else{var c=o[u].displayName;if(o[u].email){c+=" <"+o[u].email+">"}s.push(c)}}r=s.join(",")}catch(d){r=""}break;case"CHECKBOX":r=r?"Checked":"Unchecked";break;case"DROPDOWN":if(r){var h=t.getPipeline().getField(i);r=h.getOption(r).name}else{r=""}break;case"FORMULA":if(!r){return""}if(r.calculationStatus==="SUCCESS"){if(n.isReal(r.calculationValue)){return f(r)}}else if(r.calculationStatus==="NOT_ATTEMPTED"){return l.Locale.getString("formula_calculating")}else{return l.Locale.getString("formula_error")}return"";break;case"TAG":if(r){var h=t.getPipeline().getField(i);return p(h,r)}else{r=""}break}if(n.isReal(r)){return r}return""};u.getHTMLValue=function(t,i){var r=t.getPipeline().getField(i);if(!r){l.logError("Could not find field",null,{fieldKey:i});return""}var a=r.get("type");var o=t.getFieldValue(i);switch(a){case"TEXT_INPUT":o=o?n.escape(o):"";break;case"DATE":o=e.DateString.prettyDate(o);break;case"PERSON":try{o=c(o)}catch(s){l.logError("error parsing people object",s,o);o=""}break;case"CHECKBOX":o=d(o);break;case"FORMULA":o=h(o,t,i);break;case"DROPDOWN":if(o){var r=t.getPipeline().getField(i);var u=r.getOption(o);o=u.name||o}else{o=""}o=n.escape(o);break;case"TAG":if(o){var r=t.getPipeline().getField(i);return p(r,o)}else{o=""}break}return o};u.createPipelineFieldModel=function(e,t){switch(e.type){case"DROPDOWN":return new l.Models.PipelineDropdownField(e,t);break;case"FORMULA":return new l.Models.PipelineFormulaField(e,t);case"TAG":return new l.Models.PipelineTagField(e,t);break;default:return new l.Models.PipelineField(e,t)}};function c(t){if(!t){return""}var i="";n.each(t,function(t){t=l.Contacts.updateContact(t);if(!t.displayName){t.displayName=t.fullName||t.email||""}var r="";if(t.email){r='email="'+n.escape(t.email)+'"'}var a=t.imageUrl||t.image||e.server+e.combinedPath+"images/unknownContact.png";var o='<img class="people" height="23" width="23" src="'+n.escape(a)+'" title="'+n.escape(t.displayName)+'">';o+='<span class="people" '+r+">"+n.escape(t.displayName)+"</span>";i+=o});return i}function d(e){var t='<div class="oZ-jc T-Jo J-J5-Ji ';if(e){t+="T-Jo-Jp"}t+='"">';t+='<div class="T-Jo-auh"></div>';t+="</div>";return t}function h(e,t,i){if(!e){return""}if(!e.calculationStatus){return""}switch(e.calculationStatus){case"SUCCESS":if(n.isReal(e.calculationValue)){return u.getFormulaHTMLForType(e,t,i)}else{return""}break;case"NOT_ATTEMPTED":return'<span class="streak__spreadsheet_cornerTriangle streak__spreadsheet_cornerTriangle_yellow"></span>'+'<div class="streak__spreadsheet_formulaErrorMessage">'+l.Locale.getString("formula_calculating")+"</div>";default:var r=l.Locale.getString("formula_error_"+e.calculationStatus.toLowerCase());if(e.errorDetails){r+=": \n\n"+e.errorDetails}return'<span class="streak__spreadsheet_cornerTriangle streak__spreadsheet_cornerTriangle_red"></span>'+'<div class="streak__spreadsheet_formulaTooltipDiv" data-tooltip="'+n.escape(r)+'">'+l.Locale.getString("formula_error")+"</div>"}}u.getFormulaHTMLForType=function(e,t,i){try{var r=n.escape(f(e));if(e.formula){return'<span class="streak__spreadsheet_cornerTriangle streak__spreadsheet_cornerTriangle_blue"></span>'+'<div class="streak__spreadsheet_formulaTooltipDiv" data-tooltip="'+l.Locale.getString("box_level_formula")+'">'+r+"</div>"}else if(t.getPipeline().getField(i).doesFormulaSectionExistForStage(t.get("stageKey"))){return'<span class="streak__spreadsheet_cornerTriangle streak__spreadsheet_cornerTriangle_lightBlue"></span>'+'<div class="streak__spreadsheet_formulaTooltipDiv" data-tooltip="'+l.Locale.getString("stage_level_formula")+'">'+r+"</div>"}else{return r}}catch(a){l.logError("failed to render formula HTML",a);return'<span class="streak__spreadsheet_cornerTriangle streak__spreadsheet_cornerTriangle_red"></span>Error'}};function f(t){var i=t.calculationValue;switch(t.calculationValueType){case"java.lang.Double":case"java.lang.String":case"java.lang.Boolean":case"java.lang.Integer":case"java.lang.Long":break;case"java.util.Date":var r=e.Date.create(i);if(r&&r.isValid()){i=r.prettyDate(true)}break;case"java.util.List<java.lang.Double>":case"java.util.List<java.lang.String>":case"java.util.List<java.lang.Boolean>":case"java.util.List<java.lang.Integer>":case"java.util.List<java.lang.Long>":i=i.join(", ");break;case"java.util.List<java.util.Date>":i=n.map(i,function(t){var n=e.Date.create(t);if(n&&n.isValid()){return n.prettyDate(true)}return t}).join(", ");break;case"java.util.Map<java.lang.String,java.lang.Double>":case"java.util.Map<java.lang.String,java.lang.String>":case"java.util.Map<java.lang.String,java.lang.Boolean>":case"java.util.Map<java.lang.String,java.lang.Integer>":case"java.util.Map<java.lang.String,java.lang.Long>":var a=[];for(var o in i){a.push(o+"="+i[o])}i=a.join(", ");break;case"java.util.Map<java.lang.String,java.util.Date>":var a=[];for(var o in i){var s=i[o];var r=e.Date.create(s);if(r&&r.isValid()){a.push(o+"="+r.prettyDate(true))}else{a.push(o+"="+s)}}i=a.join(", ");break}if(typeof i=="object"){i=JSON.stringify(i)}else{i=""+i}return i}function p(e,t){return n.chain(t).map(e.getOption.bind(e)).pluck("tag").map(n.escape).value().join(", ")}function m(t,n){return e.moment(t).startOf(n).toDate()}function _(t,n){var i=e.moment(t);switch(n){case"DAY":case"WEEK":return t.prettyDate(true);break;case"MONTH":return i.format("MMMM YYYY");break;case"QUARTER":return"Q"+i.format("Q YYYY");break;case"YEAR":return i.format("YYYY");break;default:return t.prettyDate(true)}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxOperationManager",superclass:e.Operations.ModelOperationManager,_memberVariables:[],_initialize:function(){e.Operations.ModelOperationManager.prototype._initialize.call(this)},moveBoxes:function(t,n,i){var r=[];for(var a=0;a<t.length;a++){var o=this._createMoveBoxOperation(t[a],i);r.push(o)}var s=e.Operations.OperationQueue.Singleton.addMultipleOperations(r,this);c.ButterBarManager.showMessage(c.Locale.getString("starting_to_move_boxes",{total:t.length},[t.length]),{priority:-2});this._setupOperationProgressHandler(s,n,i);return s},getBoxesInBatch:function(t,n){var i=new c.Models.BatchBoxGetOperation(t,n);e.Operations.OperationQueue.Singleton.addOperation(i,this)},_operationSucceeded:function(t){if(t instanceof c.Models.BatchBoxGetOperation){this._handleBatchBoxGetOperation(t);return}e.Operations.ModelOperationManager.prototype._operationSucceeded.call(this,t)},_operationFailed:function(t){if(t instanceof c.Models.BatchBoxGetOperation){return}e.Operations.ModelOperationManager.prototype._operationFailed.call(this,t)},_createMoveBoxOperation:function(e,t){var n=new c.Models.MoveBoxOperation({model:e,newPipelineKey:t});return n},_setupOperationProgressHandler:function(e,t,i){var r=c.Data.getPipelineBoxes(i);var a=c.Data.getPipelineBoxes(t);c.ButterBarManager.showProgress({initial:false,progressSuccess:"moved_boxes_status_update",progressSuccessCallback:function(e){e.operation.getModel().postNotification("delete");r.add(e.operation.getModel())},progressError:function(e,t){t.box=n.escape(e.operation.getModel().displayName());return c.Locale.getString("moved_boxes_error_update",t)},completeSuccess:undefined,completeError:"moved_boxes_error",operationProgressId:e})},_handleBatchBoxGetOperation:function(t){e.Operations.CollectionOperationManager.Singleton.updateCollectionWithResponse(c.Data.getPipelineBoxes(t.getPipelineKey()),t.getResponse(),true);c.Data.getPipelineBoxes(t.getPipelineKey()).postNotification("collectionBatchUpdated")
}});i.set("BentoBox.Models.BoxOperationManager",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MoveBoxOperation",superclass:e.Operations.ModelUpdateOperation,_memberVariables:[{name:"_oldPipelineKey",destroy:false},{name:"_newPipelineKey",destroy:false}],_initialize:function(t){this._newPipelineKey=t.newPipelineKey;this._oldPipelineKey=t.model.get("pipelineKey");e.Operations.ModelUpdateOperation.prototype._initialize.call(this,t)},doOperation:function(t,n){e.Operations.ModelRequestOperation.prototype.doOperation.apply(this,[t,n])},_getTags:function(){var t=e.Operations.ModelUpdateOperation.prototype._getTags.call(this);t=t.concat(["boxCollection_pipelineKey_"+this._newPipelineKey,"boxCollection_pipelineKey_"+this._oldPipelineKey,"box_move_pipelineKey_"+this._newPipelineKey,"box_move_pipelineKey_"+this._oldPipelineKey]);return t},_getLimiterTagsAndTypes:function(){var t=e.Operations.ModelUpdateOperation.prototype._getLimiterTagsAndTypes.call(this);t=t.concat([{tag:c.Data.getPipeline(this._newPipelineKey).get("orgKey"),type:e.Operations.OperationLimiterRules.TYPES.BOX_MOVE_PIPELINE},{tag:c.Data.getPipeline(this._oldPipelineKey).get("orgKey"),type:e.Operations.OperationLimiterRules.TYPES.ENTITY_GROUP_WRITE},{tag:c.Data.getPipeline(this._newPipelineKey).get("orgKey"),type:e.Operations.OperationLimiterRules.TYPES.BOX_MOVE_PIPELINE}]);return t},_getRequestObject:function(){var t=e.Operations.ModelRequestOperation.prototype._getRequestObject.call(this);t.pipelineKey=this._newPipelineKey;return t},_getEditOperations:function(){return[]}});i.set("BentoBox.Models.MoveBoxOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BatchBoxGetOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_boxKeys",destroy:false},{name:"_pipelineKey",destroy:false,get:true}],_initialize:function(t,n){e.Operations.AjaxRequestOperation.prototype._initialize.call(this);this._boxKeys=t;this._pipelineKey=n},getMethod:function(){return"POST"},_executeAjaxRequest:function(){var t="pipelines/"+this._pipelineKey+"/boxes/batch";var n=JSON.stringify(this._boxKeys);e.APIRequester.post(t,n,null,{contentType:"application/json"}).getPromise().then(this._handleSuccess.bind(this),this._handleError.bind(this))}});i.set("BentoBox.Models.BatchBoxGetOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.Model,u=e.Collection,c=e.NotificationCenter,d=e.DependencyManager,h=e.BentoBox;var f=function(e){l.call(this,e)};f.prototype=Object.create(l.prototype);n.extend(f.prototype,{keyName:"bumpLaterKey",entityType:"BumpLater",typeName:"bumpLater",createProperties:["gmailThreadId","bumpDate","subject","rfcMessageId","onlyBumpIfNoResponse"],apiURLs:{get:"bumplaters/<%= bumpLaterKey %>",update:"bumplaters/<%= bumpLaterKey %>",create:"bumplaters","delete":"bumplaters/<%= bumpLaterKey %>"},tagEntityName:"bumpLater",getRequestTags:function(e){var t=l.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["bumpLater_create_noKey","bumpLaterCollection_noKey"]);break;case"DELETE":return t.concat(["bumpLater_delete_noKey","bumpLaterCollection_noKey"]);break}return t},getBumpDateObject:function(){if(!this.get("bumpDate")){return null}return a.create(this.get("bumpDate"))},isActive:function(){var e=this.getBumpDateObject();if(!e){return false}return this.getBumpDateObject().isFuture()}});f.create=function(e){return new f(e)};f.createCollection=function(){var e=new u;e.init({modelKeyPropertyName:"bumpLaterKey",apiURL:"bumplaters",requestTags:["bumpLaterCollection_noKey"],requestDependentOnTags:["bumpLaterCollection_noKey"],refreshRequeueOperationTags:["bumpLaterCollection_delete_noKey","bumpLaterCollection_create_noKey"],createModelFromRawJSON:f.create});e.getActiveBumpLater=function(){var e;var t;for(var n=0;n<this.length;n++){var i=this[n];var r=i.getBumpDateObject();if(!r||i.get("status")!=="SCHEDULED"&&i.get("status")){continue}if(!e||t.isAfter(r)){e=i;t=r}}return e};return e};i.set("BentoBox.Models.BumpLater",f)})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"importJobKey",entityType:"ImportJob",typeName:"ImportJob",createProperties:["pipelineKey"],apiURLs:{get:"importjobs/<%= importJobKey %>",update:"importjobs/<%= importJobKey %>",create:"pipelines/<%= pipelineKey %>/importjobs","delete":"importjobs/<%= importJobKey %>"},tagEntityName:"importJob",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["importJob_create_pipelineKey_"+this.get("pipelineKey"),"importJobCollection"+this.get("pipelineKey")]);break;case"DELETE":return t.concat(["importJob_delete_pipelineKey"+this.get("pipelineKey"),"importJobCollection"+this.get("pipelineKey")]);break}return t},shouldShowSavingMessage:function(e){return false}});o.create=function(e){return new o(e)};o.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"importJobKey",apiURL:"pipelines/"+e+"/importjobs",refreshParameters:{statusList:["UPLOADED","VERIFIED","PROCESSING","INVALID_FILE","ERROR_IMPORTING"]},requestTags:["importJobCollection_pipelineKey_"+e],requestDependentOnTags:["importJobCollection_pipelineKey_"+e],refreshRequeueOperationTags:["importJob_create_pipelineKey_"+e,"importJob_delete_pipelineKey"+e],createModelFromRawJSON:o.create});return t};a.Models.ImportJob=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"gmailThreadKey",entityType:"GmailThread",typeName:"thread",createProperties:["boxKey","json"],apiURLs:{get:"threadinfo/<%= hexGmailThreadId %>/threads",create:"boxes/<%= boxKey %>/threads",update:"threads/<%= gmailThreadKey %>","delete":"threads/<%= gmailThreadKey %>"},getExtraRequestParameters:function(e){if(e==="CREATE"){return{json:JSON.stringify(a.Services.Threads.ThreadStorer.getThreadMetaData(this.get("hexGmailThreadId")))}}},tagEntityName:"gmailThread",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["gmailThread_create_boxKey_"+this.get("boxKey"),"gmailThreadCollection_boxKey_"+this.get("boxKey"),"gmailThread_create_hexGmailThreadId_"+this.get("hexGmailThreadId"),"gmailThread_hexGmailThreadId_"+this.get("hexGmailThreadId")]);break;case"DELETE":return t.concat(["gmailThread_delete_boxKey_"+this.get("boxKey"),"gmailThreadCollection_boxKey_"+this.get("boxKey"),"gmailThread_delete_hexGmailThreadId_"+this.get("threadGmailId"),"gmailThread_hexGmailThreadId_"+this.get("threadGmailId")]);break}return t},getRequestDependentOnTags:function(e){var t=i.prototype.getRequestDependentOnTags.call(this,e);switch(e){case"CREATE":return t.concat(["gmailThread_create_boxKey_"+this.get("boxKey"),"gmailThreadCollection_boxKey_"+this.get("boxKey"),"gmailThread_create_hexGmailThreadId_"+this.get("hexGmailThreadId"),"gmailThread_delete_hexGmailThreadId_"+this.get("hexGmailThreadId"),"gmailThread_hexGmailThreadId_"+this.get("hexGmailThreadId")]);break;case"DELETE":return t.concat(["gmailThread_delete_boxKey_"+this.get("boxKey"),"gmailThreadCollection_boxKey_"+this.get("boxKey"),"gmailThread_create_hexGmailThreadId_"+this.get("threadGmailId"),"gmailThread_delete_hexGmailThreadId_"+this.get("threadGmailId"),"gmailThread_hexGmailThreadId_"+this.get("threadGmailId")]);break}},getRequestLimiterTagsAndTypes:function(e){if(!this.get("boxKey")){return[]}var t=a.Data.getBox(this.get("boxKey"));return t.getRequestLimiterTagsAndTypes(e)},getResponseObjectAffectingModel:function(e){if(t.isArray(e)){return e[0]}return e}});o.create=function(e){return new o(e)};o.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"gmailThreadKey",apiURL:"boxes/"+e+"/threads",requestTags:["gmailThreadCollection_boxKey_"+e],requestDependentOnTags:["gmailThreadCollection_boxKey_"+e],refreshRequeueOperationTags:["gmailThread_create_boxKey_"+e,"gmailThread_delete_boxKey_"+e],createModelFromRawJSON:o.create});return t};a.Models.GmailThread=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=e.Gmail;var s=function(e){i.call(this,e);this._numberOfReplies=0};s.prototype=Object.create(i.prototype);t.extend(s.prototype,{keyName:"sendLaterKey",entityType:"SendLater",typeName:"sendLater",createProperties:["gmailDraftId","sendDate","subject","sendLaterType"],apiURLs:{get:"sendlaters/<%= sendLaterKey %>",update:"sendlaters/<%= sendLaterKey %>",create:"sendlaters","delete":"sendlaters/<%= sendLaterKey %>"},tagEntityName:"sendLater",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["sendLater_create_noKey","sendLaterCollection_noKey"]);break;case"DELETE":return t.concat(["sendLater_delete_noKey","sendLaterCollection_noKey"]);break}return t},link:function(){return o.Constants.Drafts+"/"+this.get("gmailDraftId")},incrementNumberOfReplies:function(){this._numberOfReplies+=1},decrementNumberOfReplies:function(){this._numberOfReplies-=1;if(this._numberOfReplies===0){this.del()}},isScheduled:function(){return this.get("sendDate")&&(this.get("status")==="SCHEDULED"||!this.get("status"))}});s.create=function(e){return new s(e)};s.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"sendLaterKey",apiURL:"sendlaters",refreshParameters:{sendLaterStatusList:JSON.stringify(["SCHEDULED","ERROR_ON_SEND"])},requestTags:["sendLaterCollection_noKey"],requestDependentOnTags:["sendLaterCollection_noKey"],refreshRequeueOperationTags:["sendLaterCollection_delete_noKey","sendLaterCollection_create_noKey"],createModelFromRawJSON:s.create});t.getSendLaterForHexGmailThreadId=function(e){for(var t=0;t<this.length;t++){var n=this[t];if(n.get("gmailDraftId")===e){return n}}return null};return t};a.Models.SendLater=s})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"reminderKey",entityType:"Reminder",createProperties:["remindDate","boxKey","workflowKey","message","remindFollowers"],apiURLs:{get:"reminders/<%= reminderKey %>",update:"reminders/<%= reminderKey %>",create:"boxes/<%= boxKey %>/reminders","delete":"reminders/<%= reminderKey %>"},tagEntityName:"reminder",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["reminder_create_boxKey_"+this.get("boxKey"),"reminderCollection_boxKey_"+this.get("boxKey")]);break;case"DELETE":return t.concat(["reminder_delete_boxKey_"+this.get("boxKey"),"reminderCollection_boxKey_"+this.get("boxKey")]);break}return t}});o.create=function(e){return new o(e)};o.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"reminderKey",apiURL:"boxes/"+e+"/reminders",requestTags:["reminderCollection_boxKey_"+e],requestDependentOnTags:["reminderCollection_boxKey_"+e],refreshRequeueOperationTags:["reminder_create_boxKey_"+e,"reminder_delete_boxKey_"+e],createModelFromRawJSON:o.create});return t};a.Models.Reminder=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"snippetKey",entityType:"Snippet",typeName:"snippet",createProperties:["snippetName","snippetText","subject"],requiredCreate:["snippetName","snippetText"],nameProperty:"snippetName",apiURLs:{get:"snippets/<%= snippetKey %>",update:"snippets/<%= snippetKey %>",create:"snippets","delete":"snippets/<%= snippetKey %>"},tagEntityName:"snippet",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["snippet_create_noKey","snippetCollection_noKey"]);break;case"DELETE":return t.concat(["snippet_delete_noKey","snippetCollection_noKey"]);break}return t},getText:function(){var t=this.get("snippetText");if(t&&t.value){t=t.value}if(this.get("snippetType")==="TEXT"){t=e.$.getTextHTML(t)}return t},preSaveFunction:function(e){if(!e.snippetText){return false}if(!e.snippetName){return false}e.partOfPipeline=!!e.pipelineKey;return true}});o.create=function(e){return new o(e)};o.createCollection=function(){var e=new r;e.init({modelKeyPropertyName:"snippetKey",apiURL:"snippets",requestTags:["snippetCollection_noKey"],requestDependentOnTags:["snippetCollection_noKey"],refreshRequeueOperationTags:["snippetCollection_delete_noKey","snippetCollection_create_noKey"],createModelFromRawJSON:o.create});return e};a.Models.Snippet=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"fileKey",entityType:"File",typeName:"File",nameProperty:"fileName",apiURLs:{get:"files/<%= fileKey %>","delete":"files/<%= fileKey %>"},link:function(){if(this.get("fileType")==="DRIVE"){return this.get("driveUrl")}else{var t=e.server+"/api/v1/files/"+this.get("fileKey")+"/redirect";if(e.ai){t+="?ai=true&email="+encodeURIComponent(e.ai)}else{t+="?email="+encodeURIComponent(e.userEmail)+"&clientVersion="+encodeURIComponent(e.clientVersion)}return t}},tagEntityName:"file",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["file_create_boxKey_"+this.get("boxKey"),"fileCollection_boxKey_"+this.get("boxKey")]);break;case"DELETE":return t.concat(["file_delete_boxKey_"+this.get("boxKey"),"fileCollection_boxKey_"+this.get("boxKey")]);break}return t}});o.create=function(e){return new o(e)};o.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"fileKey",apiURL:"boxes/"+e+"/files",requestTags:["fileCollection_boxKey_"+e],requestDependentOnTags:["fileCollection_boxKey_"+e],refreshRequeueOperationTags:["file_create_boxKey_"+e,"file_delete_boxKey_"+e],createModelFromRawJSON:o.create});return t};a.Models.File=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e);this.streakSettings=null;this._isGoogleAppsUser=a.Constants.EMAIL_BLACK_LIST.indexOf(this.getDomain().toLowerCase())===-1};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{entityType:"User",keyName:"userKey",nameProperty:"displayName",apiURLs:{get:"users/me",update:"users/<%= userKey %>"},tagEntityName:"user",getHeadsUpSections:function(){return a.UserSettings.getSetting("headsUp/sections")||[]},saveHeadsUpSections:function(e){var t=e||a.UserSettings.getSetting("headsUp/sections");a.UserSettings.setSetting("headsUp/sections",t);a.UserSettings.saveSettings()},getEmail:function(){return this.get("email").toLowerCase()},getDomain:function(){return this.get("email").split("@")[1]},isGoogleAppsUser:function(){return this._isGoogleAppsUser},isExternalSharingRestricted:function(){return!!this.get("externalSharingRestrictionOnTeamsPipelines")},setIsExternalSharingRestricted:function(e){this.set("externalSharingRestrictionOnTeamsPipelines",e)},isSecurityReportEnabled:function(){return this.get("securityReportOnTeamsPipelines")},setIsSecurityReportEnabled:function(e){this.set("securityReportOnTeamsPipelines",e)},isAutomaticInvoiceEmailEnabled:function(){return this.get("automaticallySendInvoiceEmails")},setAutomaticInvoiceEmailEnabled:function(e){this.set("automaticallySendInvoiceEmails",e)}});o.create=function(e){return new o(e)};a.Models.User=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"userUISettingsKey",entityType:"userUISettings",typeName:"userUISettings",apiURLs:{get:"users/me/uisettings",update:"users/me/uisettings/<%= userUISettingsKey %>"},tagEntityName:"userUiSettings",shouldShowSavingMessage:function(e){return false}});o.create=function(e){return new o(e)};a.Models.UserUISettings=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{entityType:"StreakSettings",keyName:"streakSettingsKey",apiURLs:{get:"users/me/settings",update:"users/me/settings/<%= streakSettingsKey %>"},tagEntityName:"streakSettings",setValueByKey:function(e,n,i,r,a){var o=this.get("pages");var s=t.find(o,function(t){return t.key===e});var l=t.find(s.sections,function(e){return e.key===n});var u;t.each(l.settings,function(e){if(e.key===i){e[r]=a}else{t.each(e.subsettings,function(e){if(e.key===i){e[r]=a}})}});this.set("pages",o)},setSelectedValues:function(e,t,n,i){this.setValueByKey(e,t,n,"selectedValues",i);a.Tracker.trackStreakActive({widgetContext:"streakSettigns"},{settingKey:n},{eventName:"setSelectedValues"});this.save()},setSettingValue:function(e,t){var n=this.getSetting(e);n.selectedValues=t;this.save()},getPages:function(){return this.get("pages")},forceRefresh:function(){try{this.refresh()}catch(e){}},getSetting:function(e){var n;var i=this.get("pages");t.each(i,function(i){t.each(i.sections,function(i){t.each(i.settings,function(i){if(i.displayName===e){n=i}else{t.each(i.subsettings,function(t){if(t.displayName===e){n=t}})}})})});return n},settingIsEnabled:function(e){var n=this.getSetting(e);if(t.isDefined(n)){var i=n.selectedValues;if(t.contains(n.selectedValues,"default")){i=n.defaultValues}if(t.contains(i,"enabled")){return true}}return false}});o.create=function(e){return new o(e)};a.Models.StreakSettings=o})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=a.Locale;var s=function(e){i.call(this,e)};s.prototype=Object.create(i.prototype);t.extend(s.prototype,{keyName:"key",nameProperty:"value",createProperties:["type","value","boxKey"],apiURLs:{get:"emailfilters/<%= key %>","delete":"emailfilters/<%= key %>",create:"emailfilters"},tagEntityName:"emailFilter",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["emailFilter_create_boxKey_"+this.get("boxKey"),"emailFilterCollection_boxKey_"+this.get("boxKey")]);break;case"DELETE":return t.concat(["emailFilter_delete_boxKey_"+this.get("boxKey"),"emailFilterCollection_boxKey_"+this.get("boxKey")]);break}return t},matches:function(e){var t=this.get("type"),n=this.get("value");if(t==="EMAIL_ADDRESS_FILTER"){return n===e}else if(t==="DOMAIN_FILTER"){return e.endsWith(n)}else{return false}},filterDisplayHtml:function(){var e=this.get("type"),n=this.get("value");if(e==="EMAIL_ADDRESS_FILTER"){return o.getString("email_suggestion_creation_one_email",{email:t.escape(n)})}else if(e==="DOMAIN_FILTER"){return o.getString("email_suggestion_creation_one_domain",{domain:t.escape(n)})}else{return"Error."}}});s.create=function(e){return new s(e)};s.createCollection=function(e){var t=new r;t.init({modelKeyPropertyName:"key",apiURL:"boxes/"+e+"/emailfilters",requestTags:["emailFilterCollection_refresh_boxKey_"+e],requestDependentOnTags:["emailFilterCollection_refresh_boxKey_"+e],refreshRequeueOperationTags:["emailFilter_create_boxKey_"+e,"emailFilter_delete_boxKey_"+e],createModelFromRawJSON:s.create});return t};a.Models.EmailFilter=s})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox;var o=function(e){i.call(this,e)};o.prototype=Object.create(i.prototype);t.extend(o.prototype,{keyName:"key",nameProperty:"blacklistEmail",createProperties:["blacklistEmail"],apiURLs:{get:"emailfilterpromoblacklists/<%= key %>","delete":"emailfilterpromoblacklists/<%= key %>",create:"emailfilterpromoblacklists",update:"emailfilterpromoblacklists/<%= key %>"},tagEntityName:"emailFilterBlacklist",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["emailFilterBlacklist_create_noKey","emailFilterBlacklistCollection_noKey"]);break;case"DELETE":return t.concat(["emailFilterBlacklist_delete_noKey","emailFilterBlacklistCollection_noKey"]);break}return t},matches:function(e){return this.get("blacklistEmail")===e}});o.create=function(e){return new o(e)};o.createCollection=function(){var e=new r;e.init({modelKeyPropertyName:"key",apiURL:"emailfilterpromoblacklists",requestTags:["emailFilterBlacklistCollection_noKey"],requestDependentOnTags:["emailFilterBlacklistCollection_noKey"],refreshRequeueOperationTags:["emailFilterBlacklist_create_noKey","emailFilterBlacklist_delete_noKey"],createModelFromRawJSON:o.create});return e};a.Models.EmailFilterBlacklist=o})(Streak);(function(e){var t=e._,n=e.Model,i=e.Collection,r=e.BentoBox,a=r.Locale;var o=function(e){n.call(this,e)};var s={HIDDEN_FEATURES:["unlimitedPixelTracking"]};o.prototype=Object.create(n.prototype);t.extend(o.prototype,{keyName:"key",nameProperty:"name",createProperties:["billingPeriodType","billingUnitType","restrictionType","upgradeType","name","price","features","defaultDiscountPercentage","defaultTrialPeriodDays","creationTimestamp","lastUpdatedTimestamp","restrictionMaxUsers","autoUpgradeToPlanId"],apiURLs:{get:"plans/<%= key %>","delete":"plans/<%= key %>",create:"plans"},tagEntityName:"plan",getDescriptionFeatures:function(){var e=this.get("features");var n=t.difference(e,s.HIDDEN_FEATURES);return n},getSummaryFeatures:function(){var e=this.get("features");e=t.difference(e,s.HIDDEN_FEATURES);var n=t.chain(e).map(function(e){return a.getString("feature_summary_"+e)}).reject(function(e){return e.indexOf("feature_summary_")!=-1}).value();return n},getLocalizedName:function(){var e="plan_name_"+this.get("planId");var t=a.getString(e);if(t===e){t=this.get("name")}return t},getLearnMoreText:function(){var e="plan_learn_more_"+this.get("planId");var t=a.getString(e);var n=t!=e?t:"";return n},getCollaboratorLimit:function(){if(this.get("hasAllowedCollaboratorLimit")){return this.get("collaboratorLimit")}else{return null}},getPlanId:function(){return this.get("planId")}});o.create=function(e){return new o(e)};o.createCollection=function(){var e=new i;e.init({modelKeyPropertyName:"key",apiURL:"plans",requestTags:["planCollection_noKey"],requestDependentOnTags:["planCollection_noKey"],refreshRequeueOperationTags:["planCollection_delete_noKey","planCollection_create_noKey"],createModelFromRawJSON:o.create});return e};o.getParticipatingPlans=function(e){e=e||{};var t=new i;var n=e.userKey?e.userKey:"me";t.init({modelKeyPropertyName:"key",apiURL:"users/"+n+"/plans",requestTags:["planCollection_user"],requestDependentOnTags:["planCollection_user"],refreshRequeueOperationTags:["planCollection_delete_user","planCollection_create_user"],createModelFromRawJSON:o.create});return t};r.Models.Plan=o})(Streak);(function(e){var t=e._,n=e.Model,i=e.Collection,r=e.BentoBox;var a=function(e){n.call(this,e)};a.prototype=Object.create(n.prototype);t.extend(a.prototype,{keyName:"key",nameProperty:"name",createProperties:["userEmailList","planId","enrollmentType","trialPeriodDays","enrollmentType","discountPercentage"],apiURLs:{get:"planinstances/<%= key %>",update:"planinstances/<%= key %>",create:"users/me/planinstances"},isActive:function(){return this.get("state")==="ACTIVE"},activate:function(){this.set("state","ACTIVE");var t=this;return new e.RSVP.Promise(function(e,n){t.save(e,n)})},getPlanId:function(){if(this.get("plan")){return this.get("plan").planId}return undefined}});a.create=function(e){return new a(e)};a.getBillingPlanInstances=function(e){e=e||{};var t=e.userKey?e.userKey:"me";var n=new i;n.init({modelKeyPropertyName:"key",apiURL:"users/"+t+"/planinstances",requestTags:["planInstanceCollection_noKey"],requestDependentOnTags:["planInstanceCollection_noKey"],refreshRequeueOperationTags:["planInstanceCollection_create_noKey","planInstanceCollection_delete_noKey"],createModelFromRawJSON:a.create});return n};r.Models.PlanInstance=a})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;var a=InboxManipulator={CONSTANTS:{COLUMN_NAMES:["CHECKBOX","STAR","PEOPLE","IMPORTANCE","SUBJECT","ATTACHMENTS","DATE","LABELS"],TABLE_MANIPULATION_TYPES:["COLUMN_WIDTH"],ROW_MANIPULATION_TYPES:["PREPEND_ELEMENT","APPEND_ELEMENT","REMOVE_ELEMENT","REPLACE_CONTENT"]},_columnNameColGroupMap:{CHECKBOX:"Ci",STAR:"y5",PEOPLE:"yY",IMPORTANCE:"yF",SUBJECT:"null",ATTACHMENTS:"yg",DATE:"xX"},_columnNameRowObjectMap:{STAR:"starHolder",LABELS:"labelContainer",SUBJECT:"subjectLink",ATTACHMENTS:"attachmentsContainer",DATE:"date"},_dataSources:[],init:function(){e.NotificationCenter.subscribe({eventName:"gmail.newThreadDOMRows",observer:this,functionToCall:this.refreshAll});e.NotificationCenter.subscribe({eventName:"gmail.newThreadDOMRow",observer:this,functionToCall:this.handleNewThreadDOMRow});e.NotificationCenter.subscribe({eventName:"threadStorerDataChanged",observer:this,filterParameters:{valueType:"boxKey"},functionToCall:this.refreshAll});e.NotificationCenter.subscribe({eventName:"threadStorerDataChanged",observer:this,filterParameters:{valueType:"sendLater"},functionToCall:this.refreshAll});e.NotificationCenter.subscribe({eventName:"threadStorerDataChanged",observer:this,filterParameters:{valueType:"trackedThread"},functionToCall:n.debounce(this.refreshAll.bind(this),100)});e.NotificationCenter.subscribe({eventName:"threadStorerDataChanged",observer:this,filterParameters:{valueType:"bumpLaterCollection"},functionToCall:n.debounce(this.refreshAll.bind(this),100)})},refreshAll:n.debounce(function(e){if(!i.isListView()){return}if(e!==null){a._getAndApplyTableManipulations()}var t=i.getThreadDOMRows();var o=r.Services.Threads.HexGmailThreadIdExtractor.getHexGmailThreadIdList(t);var s=n.any(o,function(e){return!e});if(s&&e!==true){a._getThreadResponseForCurrentList();return}i.getCurrentMain().find(".streak__inboxManipulatorElement").remove();for(var l=0;l<t.length;l++){if(o[l]){a._refreshRow(o[l],t[l])}}},20),handleNewThreadDOMRow:function(e){this.refreshRow(e.threadDOMRow)},refreshRow:function(e){var n=r.Services.Threads.HexGmailThreadIdExtractor.getHexGmailThreadIdList([e]);if(!n){return}if(e.node){for(var i=0;i<e.node.length;i++){t(e.node).find(".streak__inboxManipulatorElement").remove()}}this._refreshRow(n,e)},addDataSource:function(e){a._dataSources.push(e);a._dataSources=n.sortBy(a._dataSources,function(e){return e.priority});if(e.getGlobalManipulation&&e.getGlobalManipulation()){a._applyGlobalManipulation(e.getGlobalManipulation())}a.refreshAll()},_getThreadResponseForCurrentList:function(){i.GmailRequester.getCurrentList(function(t){var n=i.ThreadResponseProcessor.extractThreads(t);e.BentoBox.Services.Threads.ThreadMetaDataCreator.processCrapFormatThreads(n);a.refreshAll(true)},function(){a.refreshAll(true);return true})},_applyGlobalManipulation:function(e){if(!e){return}switch(e.type){case"CSS_CHANGE":a._applyCSSManipulation(e.columnName,e.cssRule);break}},_applyCSSManipulation:function(t,n){var i="[gh=tl] colgroup col."+a._columnNameColGroupMap[t];e.CSSStyleManipulator.addRule(i+"{ "+n+";}",0)},_getAndApplyTableManipulations:function(){for(var e=0;e<a._dataSources.length;e++){if(a._dataSources[e]&&a._dataSources[e].getTableManipulation){a._applyTableManipulation(a._dataSources[e].getTableManipulation())}}},_applyTableManipulation:function(e){if(!e){return}switch(e.type){case"COLUMN_WIDTH":a._changeColumnWidth(e.columnName,e.width);break}},_changeColumnWidth:function(e,t){var n=a._getColGroup(e);n.css("width",t+"px")},_getColGroup:function(e){return i.getCurrentMain().find("[gh=tl] colgroup col."+a._columnNameColGroupMap[e])},_refreshRow:function(e,t){var n=a._getRowManipulations(e,t);a._applyRowManipulations(t,n)},_getRowManipulations:function(e,t){var n=[];for(var i=0;i<a._dataSources.length;i++){try{if(e){n.push(a._dataSources[i].getRowManipulation(e,t))}}catch(o){r.logError("get row manipulation fail",o)}}return n},_applyRowManipulations:function(e,t){if(!t){return}for(var n=0;n<t.length;n++){try{a._applyOneOrMoreRowManipulations(e,t[n])}catch(i){r.logError("row manipulation fail",i)}}},_applyOneOrMoreRowManipulations:function(e,t){if(!t){return}if(n.isArray(t)){for(var i=0;i<t.length;i++){this._applyRowManipulation(e,t[i])}}else{this._applyRowManipulation(e,t)}},_applyRowManipulation:function(e,t){t.setThreadDOMRow(e);switch(t.getManipulationType()){case"PREPEND_ELEMENT":a._insertElementIntoRow(e,t.getColumnName(),t.getElement(),"prepend");break;case"APPEND_ELEMENT":a._insertElementIntoRow(e,t.getColumnName(),t.getElement(),"append");break;case"REMOVE_ELEMENT":a._removeElement(e,t.getColumnName(),t.getSelector());break;case"REPLACE_CONTENT":a._replaceContent(e,t.getColumnName(),t.getElement());break}},_insertElementIntoRow:function(e,n,i,r){if(!i){return}if(n==="ATTACHMENTS"){a._expandAttachmentsIfNeeded(e)}var o=e[a._columnNameRowObjectMap[n]];if(o&&o[r]){for(var s=0;s<i.length;s++){t(i[s]).addClass("streak__inboxManipulatorElement");e[a._columnNameRowObjectMap[n]][r](i[s])}}},_removeElement:function(e,t,n){e[a._columnNameRowObjectMap[t]].find(n).remove()},_replaceContent:function(e,t,n){n.addClass("streak__inboxManipulatorElement");e[a._columnNameRowObjectMap[t]].html(n)},_expandAttachmentsIfNeeded:function(e){if(e.type==="vertical"){return}if(!a._rowHasAttachment(e)){return}a._changeColumnWidth("ATTACHMENTS",50)},_rowHasAttachment:function(e){return e.rowNode.find("td.yf img").length>0||e.rowNode.find("td.yf span").length>0}};e.DependencyManager.addFunction({functionKey:"inboxManipulatorInitialized",functionReference:InboxManipulator.init,functionContext:InboxManipulator,dependentFunctionKeys:["gmailLoaded"]});e.NotificationCenter.subscribe({eventName:"streak.teardown",functionToCall:function(){InboxManipulator.refreshAll()},observer:InboxManipulator});e.NotificationCenter.subscribe({eventName:"streak.reup",functionToCall:function(){InboxManipulator.refreshAll()},observer:InboxManipulator});e.Gmail.InboxManipulator=InboxManipulator})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=e.Class.subclass({className:"InboxRowManipulationBase",superclass:e.Object,_memberVariables:[{name:"_threadDOMRow",destroy:false,set:true}],_initialize:function(){e.Object.prototype._initialize.call(this)},getManipulationType:function(){throw new Error("must define get manipulation types")},getColumnName:function(){throw new Error("must define get column name")},getElement:function(){throw new Error("must define get element")}});i.InboxManipulator.InboxRowManipulationBase=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"InboxSectionManager",superclass:e.Object,_memberVariables:[{name:"_sections",destroy:true,defaultValue:[]}],_initialize:function(){e.Object.prototype._initialize.call(this);this._initBindings()},addSection:function(e){this._sections.push(e);if(a.isListView()){this._processSection(e)}},_initBindings:function(){var e=this;a.getEventStream().filter(function(e){return e.eventName==="viewChanged"}).onValue(function(){if(a.isListView()){e._processSections()}else{e._removeSections()}})},_processSections:function(){for(var e=0;e<this._sections.length;e++){this._processSection(this._sections[e])}},_processSection:function(e){if(this._isSectionRelevant(e)){this._injectSection(e)}else{this._removeSection(e)}},_isSectionRelevant:function(e){if(a.hash.parts.length<2){return e.isViewRelevant(a.view)}var t=n.last(a.hash.parts);if(t.match(/^p\d+$/)){var i=parseInt(t.replace(/p/,""),10);if(i>1){return false}}return e.isViewRelevant(a.view)},_injectSection:function(e){var t=e.getElement();var n=a.getCurrentMain();if(!n.isVisible()){return}n.before(t);
return;n.find("[gh=tl]").filter(":first").before(t);n.find(".aAD").filter(":first").removeClass("aAD");n.find(".Wg").filter(":first").addClass("aAD")},_removeSections:function(){for(var e=0;e<this._sections.length;e++){this._removeSection(this._sections[e])}},_removeSection:function(e){e.removeElement()}});r.set("Gmail.InboxSectionManager",new h)})(Streak);Streak.UI={};(function(e){var t=e._;var n=e.Object;e.UI.Delegator=e.Class.subclass({superclass:n,memberVariables:[{name:"_delegates",destroy:false},{name:"_delegate",destroy:false,set:true},{name:"_eventStream",destroy:false,get:true}],_initialize:function(){n.prototype._initialize.call(this);this._delegates=[];this._eventStream=new e.Bacon.Bus},addDelegate:function(e){if(this._delegates.indexOf(e)===-1){this._delegates.push(e)}},removeDelegate:function(e){var t=this._delegates.indexOf(e);if(t>-1){this._delegates.splice(t,1)}},removeAllDelegates:function(){this._delegates.length=0},_callDelegateFunction:function(n){var i=t.rest(t.toArray(arguments));if(this._delegate&&this._delegate[n]){this._delegate[n].apply(this._delegate,i)}if(!this._delegates){return}var r=t.clone(this._delegates);for(var a=0;a<r.length;a++){if(r[a][n]){try{r[a][n].apply(r[a],i)}catch(o){e.BentoBox.logError("error in delegator",o)}}}},_callDelegateFunctionOnDelegate:function(e,n){var i=t.rest(t.toArray(arguments),2);if(n&&n[e]){n[e].apply(n,i)}},destroy:function(){if(this._eventStream){this._eventStream.end()}e.Object.prototype.destroy.call(this)}})})(Streak);(function(e){var t=e.UI;t.DataSourceDelegateMixin=function(e){return{memberVariables:[{name:"_dataSource",destroy:false}],setDataSource:function(e){this._removeCurrentDataSource();this._dataSource=e;e.addDelegate(this)},_removeCurrentDataSource:function(){if(this._dataSource!==null){this._dataSource.removeDelegate(this);this._dataSource=null}},handleDataUpdated:function(e){},destroy:function(){this._removeCurrentDataSource();e.prototype.destroy.call(this)}}}})(Streak);(function(e){var t=e.$;var n=e.UI.Delegator;e.UI.View=e.Class.subclass({className:"View",superclass:n,memberVariables:[{name:"_element",destroy:true,get:true},{name:"_eventStream",destroy:true,get:true}],_initialize:function(){n.prototype._initialize.call(this);this._setupElement();this._eventStream=new e.Bacon.Bus},_setupElement:function(){this._element=t(document.createElement("div"))},addSubView:function(e){this._element.append(e.getElement())},prependSubView:function(e){this._element.prepend(e.getElement())},setSubview:function(e){this._element.html(e.getElement())},setText:function(e){this._element.text(e)},setHTML:function(e){this._element[0].innerHTML=e},addClass:function(e){this._element.addClass(e)},removeClass:function(e){this._element.removeClass(e)},empty:function(){this._element[0].innerHTML=""}})})(Streak);(function(e){var t=e.UI;var n=t.Delegator;t.ViewController=e.Class.subclass({className:"ViewController",superclass:n,memberVariables:[{name:"_view",destroy:true,get:true},{name:"_viewEventStreamUnplugger",destroy:true}],_initialize:function(){n.prototype._initialize.call(this);this._setupView();this._devAssociateElement();if(this._view&&this._view.setDelegate){this._view.setDelegate(this)}if(this._view&&this._view.getEventStream&&this._view.getEventStream()){this._viewEventStreamUnplugger=this._eventStream.plug(this._view.getEventStream())}},_setupView:function(){this._view=new t.View},_devAssociateElement:function(){if(e.isDev){try{var t=this._view&&this._view.getElement&&this._view.getElement();if(t){var n=e.$(t).data("debug")||{};n.viewController=this;e.$(t).data("debug",n)}}catch(i){e.BentoBox.logError("Could not associate element in view controller",i)}}},setView:function(e){if(this._view){this._view.destroy()}this._view=e;this._devAssociateElement()}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.ViewController;n.CollectionViewController=e.Class.subclass({superclass:i,memberVariables:[{name:"_viewControllers",destroy:false}],_initialize:function(){i.prototype._initialize.call(this);this._viewControllers=[]},addViewController:function(e){this._viewControllers.push(e);this._view.addSubView(e.getView())}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.ViewController;n.HorizontalCollectionViewController=e.Class.subclass({superclass:i,memberVariables:[{name:"_viewControllers",destroy:false}],_initialize:function(){i.prototype._initialize.call(this);this._viewControllers=[];this._view.addClass("__streak_horizontal_layout")},addViewController:function(e){this._viewControllers.push(e);this._view.addSubView(e.getView())}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.ViewController;n.SplitRowsCollectionViewController=e.Class.subclass({superclass:i,memberVariables:[{name:"_numberOfColumnsInRow",destroy:false},{name:"_numberOfRows",destroy:false},{name:"_verticalViewControllers",destroy:false}],_initialize:function(){i.prototype._initialize.call(this);this._numberOfColumnsInRow={};this._numberOfRows=0;this._verticalViewControllers=[]},addRow:function(){this._numberOfRows+=1;var e=new n.HorizontalCollectionViewController;this._verticalViewControllers.push(e);this._view.addSubView(e.getView());return this._numberOfRows-1},getLastRow:function(){return this._numberOfRows-1},addViewControllerToRow:function(e,t){this._numberOfColumnsInRow[t]=(this._numberOfColumnsInRow[t]||0)+1;var n=this._verticalViewControllers[t];n.addViewController(e);return this._numberOfColumnsInRow[t]-1}})})(Streak);(function(e){var t=e.UI;var n=t.View;t.ChartView=e.Class.subclass({superclass:n,memberVariables:[{name:"_data",destroy:false}],_initialize:function(){n.prototype._initialize.call(this);this._setupChart()},_setupChart:function(){},setData:function(e){this._data=e;this._drawChart()},_drawChart:function(){},windowResized:function(){this._drawChart()}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.ChartView;n.GoogleChartView=e.Class.subclass({superclass:i,memberVariables:[{name:"_googleChartClass",destroy:false},{name:"_chart",destroy:false},{name:"_googleFormattedData",destroy:false},{name:"_chartOptions",destroy:false,get:true}],setGoogleChartClass:function(e){this._googleChartClass=e;this._chart=new this._googleChartClass(this.getChartContainerElement());this._chartOptions={}},getChartContainerElement:function(){return this._element[0]},setChartOptions:function(e){t.extend(this._chartOptions,this._chartOptions,e)},setData:function(e){if(e){if(t.isArray(e)){this._googleFormattedData=google.visualization.arrayToDataTable(e)}else{this._googleFormattedData=e}}else{this._googleFormattedData=null}i.prototype.setData.call(this,e)},setVAxisLabel:function(e){if(!this._chartOptions.vAxis){this._chartOptions.vAxis={}}this._chartOptions.vAxis.title=e},setSeriesOptions:function(e){this._chartOptions.series=e},_drawChart:function(){if(this._googleFormattedData){this._chart.draw(this._googleFormattedData,this.getChartOptions())}}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.GoogleChartView;n.BarChartView=e.Class.subclass({superclass:i,memberVariables:[{name:"_legendWidth",destroy:false,get:true}],_initialize:function(){i.prototype._initialize.call(this);this.setGoogleChartClass(google.visualization.BarChart);this._chartOptions={hAxis:{viewWindow:{},gridlines:{},minorGridlines:{},titleTextStyle:{},textStyle:{}},chartArea:{},legend:{}}},setIsStacked:function(e){this._chartOptions.isStacked=e},setLegendWidth:function(e){this._legendWidth=e},_computeWidth:function(){if(this._legendWidth){this.setChartWidthPercentage((this._element.width()-this._legendWidth)*100/this._element.width())}},setSeriesColors:function(e){this._chartOptions.series=t.map(e,function(e){return{color:e}})},setHeight:function(e){this._chartOptions.height=e},setChartHeightPercentage:function(e){if(e){this._chartOptions.chartArea.height=e+"%"}else{this._chartOptions.chartArea.height=null}},setChartWidthPercentage:function(e){if(e){this._chartOptions.chartArea.width=e+"%"}else{this._chartOptions.chartArea.width=null}},setMinimum:function(e){this._chartOptions.hAxis.minValue=e;this._chartOptions.hAxis.viewWindow.min=e},setTitle:function(e){this._chartOptions.title=e},showHAxis:function(e){if(e){delete this._chartOptions.hAxis.baselineColor;delete this._chartOptions.hAxis.titleTextStyle.color;delete this._chartOptions.hAxis.textStyle.color}else{this._chartOptions.hAxis.baselineColor="transparent";this._chartOptions.hAxis.titleTextStyle.color="transparent";this._chartOptions.hAxis.textStyle.color="transparent"}},showHGridlines:function(e){if(e){delete this._chartOptions.hAxis.minorGridlines.color;delete this._chartOptions.hAxis.gridlines.color}else{this._chartOptions.hAxis.minorGridlines.color="transparent";this._chartOptions.hAxis.gridlines.color="transparent"}},showLegend:function(e){if(e){delete this._chartOptions.legend.position}else{this._chartOptions.legend.position="none"}},getChartOptions:function(){this._computeWidth();return i.prototype.getChartOptions.call(this)}})})(Streak);(function(e){var t=e._,n=e.UI;var i=n.GoogleChartView;n.TimelineChartView=e.Class.subclass({superclass:i,memberVariables:[{name:"_chartOptions",destroy:false}],_initialize:function(){i.prototype._initialize.call(this);this.setGoogleChartClass(google.visualization.Timeline);this._chartOptions={}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.HTML,a=e.UI;var o=a.GoogleChartView;a.RingChartView=e.Class.subclass({superclass:o,_memberVariables:[{name:"_googleRingChartContainer",destroy:true},{name:"_centerLabelElementContainer",destroy:true},{name:"_centerLabelValue",set:true,get:true,destroy:true},{name:"_centerLabelUnit",set:true,get:true,destroy:true},{name:"_centerLabelValueElement",destroy:true},{name:"_centerLabelUnitElement",destroy:true}],_initialize:function(e){o.prototype._initialize.call(this,e);this.setGoogleChartClass(google.visualization.PieChart,this._googleRingChartContainer)},_setupElement:function(){o.prototype._setupElement.call(this);this._element=r.getElement("streak__ringChart");this._googleRingChartContainer=this._element.find(".streak__googleRingChartContainer");this._centerLabelValueElement=this._element.find(".streak__ringChartCenterLabelValue");this._centerLabelUnitElement=this._element.find(".streak__ringChartCenterLabelUnit");this._centerLabelElementContainer=this._element.find(".streak__ringChartCenterLabelContainer")},getChartContainerElement:function(){return this._googleRingChartContainer[0]},_drawChart:function(){o.prototype._drawChart.apply(this,arguments);var e=this._chart.getChartLayoutInterface().getChartAreaBoundingBox();var t=this._chart.getChartLayoutInterface().getBoundingBox("legend");this._centerLabelElementContainer[0].style.top=e.top+"px";this._centerLabelElementContainer[0].style.left=e.left+"px";this._centerLabelElementContainer[0].style.height=e.height+"px";if(t){this._centerLabelElementContainer[0].style.width=t.left-e.left-18+"px"}else{this._centerLabelElementContainer[0].style.width=e.width+"px"}if(this.getCenterLabelValue()&&this.getCenterLabelUnit()){this._centerLabelValueElement.html(this.getCenterLabelValue());this._centerLabelUnitElement.html(this.getCenterLabelUnit())}else if(this.getCenterLabelValue()){this._centerLabelValueElement.html(this.getCenterLabelValue())}}})})(Streak);(function(e){var t=e._,n=e.UI;var i=e.Class.mixin(n.ViewController,n.DataSourceDelegateMixin);n.ChartViewController=e.Class.subclass({superclass:i,memberVariables:[{name:"_data",destroy:false}],setDataSource:function(e){i.prototype.setDataSource.call(this,e);this._retrieveData()},_retrieveData:function(){this._data=this._dataSource.getChartData();if(this._view.setData){this._view.setData(this._data)}},handleDataUpdated:function(e){this._retrieveData()},windowResized:function(){this._view.windowResized()}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.UI;var a=e.Class.subclass({superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},createChart:function(e){var t=this["_create"+e.type.camelize()](e);delete e.type;t.setChartOptions(e);return t},_createLineChart:function(e){var t=new r.GoogleChartView;t.setGoogleChartClass(google.visualization.LineChart);return t},_createRingChart:function(e){var t=new r.RingChartView;if(!e.pieHole){e.pieHole=.5}return t},_createBarChart:function(e){var t=new r.BarChartView;return t},_createColumnChart:function(){var e=new r.GoogleChartView;e.setGoogleChartClass(google.visualization.ColumnChart);return e}});i.set("UI.ChartFactory",new a)})(Streak);if(!window.streakpanel){window.streakpanel=[]}(function(e){var t=Array.prototype,n=Object.prototype,i=t.slice,r=n.toString,a=n.hasOwnProperty,o=window.console,s=window.navigator,l=window.document,u=s.userAgent;var c=new R("eventQueue"),d=null;var h="streakpanel",f="__mps",p="__mpso",m="__mpa",_="__mpap",g="$set",v="$set_once",y="$add",w="$append",b="$people_distinct_id",C="__alias",S=[f,p,m,_,b,C];var T=e&&e["__SV"]||1.2,x=e&&e["__THROTTLE"]||120*1e3,k=true,M=!k&&u.indexOf("MSIE")==-1;var L={},B=false,E={api_host:Streak.server,cross_subdomain_cookie:true,cookie_name:"",loaded:function(){},store_google:true,save_referrer:true,test:false,verbose:false,img:false,track_pageview:false,debug:false,track_links_timeout:300,cookie_expiration:365*10,upgrade:false,disable_cookie:false,secure_cookie:false,ip:true},D=false;(function(){var e=t.forEach,n=t.indexOf,o=Array.isArray,s={};var l=L.each=function(t,n,i){if(t==null)return;if(e&&t.forEach===e){t.forEach(n,i)}else if(t.length===+t.length){for(var r=0,o=t.length;r<o;r++){if(r in t&&n.call(i,t[r],r,t)===s)return}}else{for(var l in t){if(a.call(t,l)){if(n.call(i,t[l],l,t)===s)return}}}};L.extend=function(e){l(i.call(arguments,1),function(t){for(var n in t){if(t[n]!==void 0)e[n]=t[n]}});return e};L.isArray=o||function(e){return r.call(e)==="[object Array]"};L.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(t){return false}};L.isArguments=function(e){return!!(e&&a.call(e,"callee"))};L.toArray=function(e){if(!e)return[];if(e.toArray)return e.toArray();if(L.isArray(e))return i.call(e);if(L.isArguments(e))return i.call(e);return L.values(e)};L.values=function(e){var t=[];if(e==null)return t;l(e,function(e){t[t.length]=e});return t};L.identity=function(e){return e};L.include=function(e,t){var i=false;if(e==null)return i;if(n&&e.indexOf===n)return e.indexOf(t)!=-1;l(e,function(e){if(i||(i=e===t)){return s}});return i};L.includes=function(e,t){return e.indexOf(t)!==-1}})();L.inherit=function(e,t){e.prototype=new t;e.prototype.constructor=e;e.superclass=t.prototype;return e};L.isObject=function(e){return e===Object(e)&&!L.isArray(e)};L.isEmptyObject=function(e){if(L.isObject(e)){for(var t in e){if(a.call(e,t)){return false}}return true}return false};L.isUndefined=function(e){return e===void 0};L.isString=function(e){return r.call(e)=="[object String]"};L.isDate=function(e){return r.call(e)=="[object Date]"};L.isNumber=function(e){return r.call(e)=="[object Number]"};L.encodeDates=function(e){L.each(e,function(t,n){if(L.isDate(t)){e[n]=L.formatDate(t)}else if(L.isObject(t)){e[n]=L.encodeDates(t)}});return e};L.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())};L.strip_empty_properties=function(e){var t={};L.each(e,function(e,n){if(L.isString(e)&&e.length>0){t[n]=e}});return t};L.bind=function(e,t){var n=i.call(arguments,2);return function(){return e.apply(t,n.concat(i.call(arguments)))}};L.truncate=function(e,t){var n;if(typeof e==="string"){n=e.slice(0,t)}else if(L.isArray(e)){n=[];L.each(e,function(e){n.push(L.truncate(e,t))})}else if(L.isObject(e)){n={};L.each(e,function(e,i){n[i]=L.truncate(e,t)})}else{n=e}return n};L.JSONEncode=function(){return function(e){var t;var n=e;var i;var o=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.lastIndex=0;return t.test(e)?'"'+e.replace(t,function(e){var t=n[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'};var s=function(e,t){var n="";var i="    ";var l=0;var u="";var c="";var d=0;var h=n;var f=[];var p=t[e];if(p&&typeof p==="object"&&typeof p.toJSON==="function"){p=p.toJSON(e)}switch(typeof p){case"string":return o(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p){return"null"}n+=i;f=[];if(r.apply(p)==="[object Array]"){d=p.length;for(l=0;l<d;l+=1){f[l]=s(l,p)||"null"}c=f.length===0?"[]":n?"[\n"+n+f.join(",\n"+n)+"\n"+h+"]":"["+f.join(",")+"]";n=h;return c}for(u in p){if(a.call(p,u)){c=s(u,p);if(c){f.push(o(u)+(n?": ":":")+c)}}}c=f.length===0?"{}":n?"{"+f.join(",")+""+h+"}":"{"+f.join(",")+"}";n=h;return c}};return s("",{"":n})}}();L.JSONDecode=function(){var e,t,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},i,r=function(t){throw{name:"SyntaxError",message:t,at:e,text:i}},a=function(n){if(n&&n!==t){r("Expected '"+n+"' instead of '"+t+"'")}t=i.charAt(e);e+=1;return t},o=function(){var e,n="";if(t==="-"){n="-";a("-")}while(t>="0"&&t<="9"){n+=t;a()}if(t==="."){n+=".";while(a()&&t>="0"&&t<="9"){n+=t}}if(t==="e"||t==="E"){n+=t;a();if(t==="-"||t==="+"){n+=t;a()}while(t>="0"&&t<="9"){n+=t;a()}}e=+n;if(!isFinite(e)){r("Bad number")}else{return e}},s=function(){var e,i,o="",s;if(t==='"'){while(a()){if(t==='"'){a();return o}if(t==="\\"){a();if(t==="u"){s=0;for(i=0;i<4;i+=1){e=parseInt(a(),16);if(!isFinite(e)){break}s=s*16+e}o+=String.fromCharCode(s)}else if(typeof n[t]==="string"){o+=n[t]}else{break}}else{o+=t}}}r("Bad string")},l=function(){while(t&&t<=" "){a()}},u=function(){switch(t){case"t":a("t");a("r");a("u");a("e");return true;case"f":a("f");a("a");a("l");a("s");a("e");return false;case"n":a("n");a("u");a("l");a("l");return null}r("Unexpected '"+t+"'")},c,d=function(){var e=[];if(t==="["){a("[");l();if(t==="]"){a("]");return e}while(t){e.push(c());l();if(t==="]"){a("]");return e}a(",");l()}}r("Bad array")},h=function(){var e,n={};if(t==="{"){a("{");l();if(t==="}"){a("}");return n}while(t){e=s();l();a(":");if(Object.hasOwnProperty.call(n,e)){r('Duplicate key "'+e+'"')}n[e]=c();l();if(t==="}"){a("}");return n}a(",");l()}}r("Bad object")};c=function(){l();switch(t){case"{":return h();case"[":return d();case'"':return s();case"-":return o();default:return t>="0"&&t<="9"?o():u()}};return function(n){var a;i=n;e=0;t=" ";a=c();l();if(t){r("Syntax error")}return a}}();L.base64Encode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var n,i,r,a,o,s,l,u,c=0,d=0,h="",f=[];if(!e){return e}e=L.utf8Encode(e);do{n=e.charCodeAt(c++);i=e.charCodeAt(c++);r=e.charCodeAt(c++);u=n<<16|i<<8|r;a=u>>18&63;o=u>>12&63;s=u>>6&63;l=u&63;f[d++]=t.charAt(a)+t.charAt(o)+t.charAt(s)+t.charAt(l)}while(c<e.length);h=f.join("");switch(e.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"=";break}return h};L.utf8Encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t="",n,i;var r=0,a;n=i=0;r=e.length;for(a=0;a<r;a++){var o=e.charCodeAt(a);var s=null;if(o<128){i++}else if(o>127&&o<2048){s=String.fromCharCode(o>>6|192,o&63|128)}else{s=String.fromCharCode(o>>12|224,o>>6&63|128,o&63|128)}if(s!==null){if(i>n){t+=e.substring(n,i)}t+=s;n=i=a+1}}if(i>n){t+=e.substring(n,e.length)}return t};L.UUID=function(){var e=function(){var e=1*new Date,t=0;while(e==1*new Date){t++}return e.toString(16)+t.toString(16)};var t=function(){return Math.random().toString(16).replace(".","")};var n=function(e){var t=u,n,i,r=[],a=0;function o(e,t){var n,i=0;for(n=0;n<t.length;n++){i|=r[n]<<n*8}return e^i}for(n=0;n<t.length;n++){i=t.charCodeAt(n);r.unshift(i&255);if(r.length>=4){a=o(a,r);r=[]}}if(r.length>0){a=o(a,r)}return a.toString(16)};return function(){var i=(screen.height*screen.width).toString(16);return e()+"-"+t()+"-"+n()+"-"+i+"-"+e()}}();L.isBlockedUA=function(){var e=u;if(/(google web preview|baiduspider|yandexbot)/i.test(e)){return true}return false};L.HTTPBuildQuery=function(e,t){var n,i,r,a=[];if(typeof t==="undefined"){t="&"}L.each(e,function(e,t){i=encodeURIComponent(e.toString());r=encodeURIComponent(t);a[a.length]=r+"="+i});return a.join(t)};L.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+t+"=([^&#]*)",i=new RegExp(n),r=i.exec(e);if(r===null||r&&typeof r[1]!=="string"&&r[1].length){return""}else{return decodeURIComponent(r[1]).replace(/\+/g," ")}};L.cookie={get:function(e){var t=e+"=";var n=l.cookie.split(";");for(var i=0;i<n.length;i++){var r=n[i];while(r.charAt(0)==" ")r=r.substring(1,r.length);if(r.indexOf(t)==0)return decodeURIComponent(r.substring(t.length,r.length))}return null},parse:function(e){var t;try{t=L.JSONDecode(L.cookie.get(e))||{}}catch(n){}return t},set:function(e,t,n,i,r){var a="",o="",s="";if(i){var u=l.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),c=u?u[0]:"";a=c?"; domain=."+c:""}if(n){var d=new Date;d.setTime(d.getTime()+n*24*60*60*1e3);o="; expires="+d.toGMTString()}if(r){s="; secure"}l.cookie=e+"="+encodeURIComponent(t)+o+"; path=/"+a+s},remove:function(e,t){L.cookie.set(e,"",-1,t)}};L.register_event=function(){var e=function(e,n,i,r){if(!e){V.error("No valid element provided to register_event");return}if(e.addEventListener&&!r){e.addEventListener(n,i,false)}else{var a="on"+n;var o=e[a];e[a]=t(e,i,o)}};function t(e,t,i){var r=function(r){r=r||n(window.event);if(!r){return undefined}var a=true;var o,s;if(L.isFunction(i)){o=i(r)}s=t.call(e,r);if(false===o||false===s){a=false}return a};return r}function n(e){if(e){e.preventDefault=n.preventDefault;e.stopPropagation=n.stopPropagation}return e}n.preventDefault=function(){this.returnValue=false};n.stopPropagation=function(){this.cancelBubble=true};return e}();L.dom_query=function(){function e(e){return e.all?e.all:e.getElementsByTagName("*")}var t=/[\t\r\n]/g;function n(e,n){var i=" "+n+" ";return(" "+e.className+" ").replace(t," ").indexOf(i)>=0}function i(t){if(!l.getElementsByTagName){return new Array}var i=t.split(" ");var r;var a=new Array(l);for(var o=0;o<i.length;o++){r=i[o].replace(/^\s+/,"").replace(/\s+$/,"");if(r.indexOf("#")>-1){var s=r.split("#");var u=s[0];var c=s[1];var d=l.getElementById(c);if(!d||u&&d.nodeName.toLowerCase()!=u){return new Array}a=new Array(d);continue}if(r.indexOf(".")>-1){var s=r.split(".");var u=s[0];var h=s[1];if(!u){u="*"}var f=new Array;var p=0;for(var m=0;m<a.length;m++){var _;if(u=="*"){_=e(a[m])}else{_=a[m].getElementsByTagName(u)}for(var g=0;g<_.length;g++){f[p++]=_[g]}}a=new Array;var v=0;for(var y=0;y<f.length;y++){if(f[y].className&&L.isString(f[y].className)&&n(f[y],h)){a[v++]=f[y]}}continue}if(r.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){var u=RegExp.$1;var w=RegExp.$2;var b=RegExp.$3;var C=RegExp.$4;if(!u){u="*"}var f=new Array;var p=0;for(var m=0;m<a.length;m++){var _;if(u=="*"){_=e(a[m])}else{_=a[m].getElementsByTagName(u)}for(var g=0;g<_.length;g++){f[p++]=_[g]}}a=new Array;var v=0;var S;switch(b){case"=":S=function(e){return e.getAttribute(w)==C};break;case"~":S=function(e){return e.getAttribute(w).match(new RegExp("\\b"+C+"\\b"))};break;case"|":S=function(e){return e.getAttribute(w).match(new RegExp("^"+C+"-?"))};break;case"^":S=function(e){return e.getAttribute(w).indexOf(C)==0};break;case"$":S=function(e){return e.getAttribute(w).lastIndexOf(C)==e.getAttribute(w).length-C.length};break;case"*":S=function(e){return e.getAttribute(w).indexOf(C)>-1};break;default:S=function(e){return e.getAttribute(w)}}a=new Array;v=0;for(var y=0;y<f.length;y++){if(S(f[y])){a[v++]=f[y]}}continue}u=r;var f=new Array;var p=0;for(var m=0;m<a.length;m++){var _=a[m].getElementsByTagName(u);for(var g=0;g<_.length;g++){f[p++]=_[g]}}a=f}return a}return i}();L.info={campaignParams:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",n={};L.each(e,function(e){t=L.getQueryParam(l.URL,e);if(t.length){n[e]=t}});return n},searchEngine:function(e){if(e.search("https?://(.*)google.([^/?]*)")===0){return"google"}else if(e.search("https?://(.*)bing.com")===0){return"bing"}else if(e.search("https?://(.*)yahoo.com")===0){return"yahoo"}else if(e.search("https?://(.*)duckduckgo.com")===0){return"duckduckgo"}else{return null}},searchInfo:function(e){var t=L.info.searchEngine(e),n=t!="yahoo"?"q":"p",i={};if(t!==null){i["searchEngine"]=t;var r=L.getQueryParam(e,n);if(r.length){i["searchEngineKeyword"]=r}}return i},browser:function(){var e=u,t=s.vendor||"";if(window.opera){if(L.includes(e,"Mini")){return"Opera Mini"}return"Opera"}else if(/(BlackBerry|PlayBook|BB10)/i.test(e)){return"BlackBerry"}else if(L.includes(e,"Chrome")){return"Chrome"}else if(L.includes(t,"Apple")){if(L.includes(e,"Mobile")){return"Mobile Safari"}return"Safari"}else if(L.includes(e,"Android")){return"Android Mobile"}else if(L.includes(e,"Konqueror")){return"Konqueror"}else if(L.includes(e,"Firefox")){return"Firefox"}else if(L.includes(e,"MSIE")){return"Internet Explorer"}else if(L.includes(e,"Gecko")){return"Mozilla"}else{return""}},os:function(){var e=u;if(/Windows/i.test(e)){if(/Phone/.test(e)){return"Windows Mobile"}return"Windows"}else if(/(iPhone|iPad|iPod)/.test(e)){return"iOS"}else if(/Android/.test(e)){return"Android"}else if(/(BlackBerry|PlayBook|BB10)/i.test(e)){return"BlackBerry"}else if(/Mac/i.test(e)){return"Mac OS X"}else if(/Linux/.test(e)){return"Linux"}else{return""}},device:function(){var e=u;if(/iPhone/.test(e)){return"iPhone"}else if(/iPad/.test(e)){return"iPad"}else if(/iPod/.test(e)){return"iPod Touch"}else if(/(BlackBerry|PlayBook|BB10)/i.test(e)){return"BlackBerry"}else if(/Windows Phone/i.test(e)){return"Windows Phone"}else if(/Android/.test(e)){return"Android"}else{return""}},referringDomain:function(e){var t=e.split("/");if(t.length>=3){return t[2]}return""},properties:function(){return L.strip_empty_properties({os:L.info.os(),browser:L.info.browser(),referrer:l.referrer,referringDomain:L.info.referringDomain(l.referrer),device:L.info.device()})},people_properties:function(){return L.strip_empty_properties({$os:L.info.os(),$browser:L.info.browser()})},pageviewInfo:function(e){return L.strip_empty_properties({mp_page:e,mp_referrer:l.referrer,mp_browser:L.info.browser(),mp_platform:L.info.os()})}};var V={log:function(){if(B&&!L.isUndefined(o)&&o){try{o.log.apply(o,arguments)}catch(e){L.each(arguments,function(e){o.log(e)})}}},error:function(){if(B&&!L.isUndefined(o)&&o){var e=["Streakpanel error:"].concat(L.toArray(arguments));try{o.error.apply(o,e)}catch(t){L.each(e,function(e){o.error(e)})}}},critical:function(){if(!L.isUndefined(o)&&o){var e=["Streakpanel error:"].concat(L.toArray(arguments));try{o.error.apply(o,e)}catch(t){L.each(e,function(e){o.error(e)})}}}};var I=function(){};I.prototype.create_properties=function(){};I.prototype.event_handler=function(){};I.prototype.after_track_handler=function(){};I.prototype.init=function(e){this.mp=e;return this};I.prototype.track=function(e,t,n,i){var r=this,a=L.dom_query(e);if(a.length==0){V.error("The DOM query ("+e+") returned 0 elements");return}L.each(a,function(e){L.register_event(e,this.override_event,function(e){var a={},o=r.create_properties(n,this),s=r.mp.get_config("track_links_timeout");r.event_handler(e,this,a);window.setTimeout(r.track_callback(i,o,a,true),s);r.mp.track(t,o,r.track_callback(i,o,a))})},this);return true};I.prototype.track_callback=function(e,t,n,i){i=i||false;var r=this;return function(){if(n.callback_fired){return}n.callback_fired=true;if(e&&e(i,t)===false){return}r.after_track_handler(t,n,i)}};I.prototype.create_properties=function(e,t){var n;if(typeof e==="function"){n=e(t)}else{n=L.extend({},e)}return n};var P=function(){this.override_event="click"};L.inherit(P,I);P.prototype.create_properties=function(e,t){var n=P.superclass.create_properties.apply(this,arguments);if(t.href){n["url"]=t.href}return n};P.prototype.event_handler=function(e,t,n){n.new_tab=e.which===2||e.metaKey||t.target==="_blank";n.href=t.href;if(!n.new_tab){e.preventDefault()}};P.prototype.after_track_handler=function(e,t,n){if(t.new_tab){return}setTimeout(function(){window.location=t.href},0)};var A=function(){this.override_event="submit"};L.inherit(A,I);A.prototype.event_handler=function(e,t,n){n.element=t;e.preventDefault()};A.prototype.after_track_handler=function(e,t,n){setTimeout(function(){t.element.submit()},0)};var F=function(e){this["props"]={};this.campaign_params_saved=false;if(e["cookie_name"]){this.name="mp_"+e["cookie_name"]}else{this.name="mp_"+e["token"]+"_streakpanel"}this.load();this.update_config(e);this.upgrade(e);this.save()};F.prototype.properties=function(){var e={};L.each(this["props"],function(t,n){if(!L.include(S,n)){e[n]=t}});return e};F.prototype.load=function(){if(this.disabled){return}var e=L.cookie.parse(this.name);if(e){this["props"]=L.extend({},e)}};F.prototype.upgrade=function(e){var t=e["upgrade"],n,i;if(t){n="mp_super_properties";if(typeof t==="string"){n=t}i=L.cookie.parse(n);L.cookie.remove(n);L.cookie.remove(n,true);if(i){this["props"]=L.extend(this["props"],i["all"],i["events"])}}if(!e["cookie_name"]&&e["name"]!=="streakpanel"){n="mp_"+e["token"]+"_"+e["name"];i=L.cookie.parse(n);if(i){L.cookie.remove(n);L.cookie.remove(n,true);this.register_once(i)}}};F.prototype.save=function(){if(this.disabled){return}L.cookie.set(this.name,L.JSONEncode(this["props"]),this.expire_days,this.cross_subdomain,this.secure)};F.prototype.remove=function(){L.cookie.remove(this.name,false);L.cookie.remove(this.name,true)};F.prototype.clear=function(){this.remove();this["props"]={}};F.prototype.register_once=function(e,t,n){if(L.isObject(e)){if(typeof t==="undefined"){t="None"}this.expire_days=typeof n==="undefined"?this.default_expiry:n;L.each(e,function(e,n){if(!this["props"][n]||this["props"][n]===t){this["props"][n]=e}},this);this.save();return true}return false};F.prototype.register=function(e,t){if(L.isObject(e)){this.expire_days=typeof t==="undefined"?this.default_expiry:t;L.extend(this["props"],e);this.save();return true}return false};F.prototype.unregister=function(e){if(e in this["props"]){delete this["props"][e];this.save()}};F.prototype.update_campaign_params=function(){if(!this.campaign_params_saved){this.register_once(L.info.campaignParams());this.campaign_params_saved=true}};F.prototype.update_search_keyword=function(e){this.register(L.info.searchInfo(e))};F.prototype.update_referrer_info=function(e){this.register_once({referrer:e||"$direct",referringDomain:L.info.referringDomain(e)||"$direct"},"")};F.prototype.get_referrer_info=function(){return L.strip_empty_properties({referrer:this["props"]["initial_referrer"],referringDomain:this["props"]["referringDomain"]})};F.prototype.safe_merge=function(e){L.each(this["props"],function(t,n){if(!(n in e)){e[n]=t}});return e};F.prototype.update_config=function(e){this.default_expiry=this.expire_days=e["cookie_expiration"];this.set_disabled(e["disable_cookie"]);this.set_cross_subdomain(e["cross_subdomain_cookie"]);this.set_secure(e["secure_cookie"])};F.prototype.set_disabled=function(e){this.disabled=e;if(this.disabled){this.remove()}};F.prototype.set_cross_subdomain=function(e){if(e!==this.cross_subdomain){this.cross_subdomain=e;this.remove();this.save()}};F.prototype.get_cross_subdomain=function(){return this.cross_subdomain};F.prototype.set_secure=function(e){if(e!==this.secure){this.secure=e?true:false;this.remove();this.save()}};F.prototype._add_to_people_queue=function(e,t){var n=this._get_queue_key(e),i=t[e],r=this._get_or_create_queue(g),a=this._get_or_create_queue(v),o=this._get_or_create_queue(y),s=this._get_or_create_queue(w,[]);if(n===f){L.extend(r,i);this._pop_from_people_queue(y,i)}else if(n===p){L.each(i,function(e,t){if(!(t in a)){a[t]=e}})}else if(n===m){L.each(i,function(e,t){if(t in r){r[t]+=e}else{if(!(t in o)){o[t]=0}o[t]+=e}},this)
}else if(n===_){s.push(i)}V.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):");V.log(t);this.save()};F.prototype._pop_from_people_queue=function(e,t){var n=this._get_queue(e);if(!L.isUndefined(n)){L.each(t,function(e,t){delete n[t]},this);this.save()}};F.prototype._get_queue_key=function(e){if(e===g){return f}else if(e===v){return p}else if(e===y){return m}else if(e===w){return _}else{V.error("Invalid queue:",e)}};F.prototype._get_queue=function(e){return this["props"][this._get_queue_key(e)]};F.prototype._get_or_create_queue=function(e,t){var n=this._get_queue_key(e),t=L.isUndefined(t)?{}:t;return this["props"][n]||(this["props"][n]=t)};var O=function(t,n,i){var r,a=i===h?e:e[i];if(a&&!L.isArray(a)){V.error("You have already initialized "+i);return}r=new N;r._init(t,n,i);r["people"]=new H;r["people"]._init(r);B=B||r.get_config("debug");if(!L.isUndefined(a)){r._execute_array.call(r["people"],a["people"]);r._execute_array(a)}return r};function R(e){if(typeof e!="string"){throw new Error("PersistentQueue requires a string id")}this._fallbackQueue=[];this._sid="streak__persistentqueue_"+e}R.prototype._getSavedQueue=function(){var e=JSON.parse(localStorage.getItem(this._sid));if(e==null){e=[]}return e};R.prototype._putSavedQueue=function(e){localStorage.setItem(this._sid,JSON.stringify(e))};R.prototype._clearSavedQueue=function(){localStorage.removeItem(this._sid)};R.prototype.add=function(e){var t=false;if(window.localStorage){try{var n=this._getSavedQueue();n.push(e);this._putSavedQueue(n);t=true}catch(i){}}if(!t){this._fallbackQueue.push(e)}};R.prototype.remove=function(){var e=undefined;if(window.localStorage){try{var t=this._getSavedQueue();var n=t.shift();this._putSavedQueue(t);e=n}catch(i){}}if(e===undefined){e=this._fallbackQueue.shift()}return e};R.prototype.removeAll=function(){var e=undefined;if(window.localStorage){try{var t=this._getSavedQueue();this._clearSavedQueue();e=t}catch(n){}}if(e===undefined){e=[]}e=e.concat(this._fallbackQueue);this._fallbackQueue=[];return e};R.prototype.peekAll=function(){var e=undefined;if(window.localStorage){try{var e=this._getSavedQueue()}catch(t){}}if(e===undefined){e=[]}e=e.concat(this._fallbackQueue);return e};R.prototype.clear=function(){if(window.localStorage){try{this._clearSavedQueue()}catch(e){}}this._fallbackQueue.length=0};var N=function(){};N.prototype.init=function(t,n,i){if(typeof i==="undefined"){V.error("You must name your new library: init(token, config, name)");return}if(i===h){V.error("You must initialize the main streakpanel object right after you include the Streakpanel js snippet");return}var r=O(t,n,i);e[i]=r;r._loaded();return r};N.prototype._init=function(e,t,n){this["__loaded"]=true;this["config"]={};this.set_config(L.extend({},E,t,{name:n,token:e,callback_fn:(n===h?n:h+"."+n)+"._jsc"}));this["_jsc"]=function(){};this.__dom_loaded_queue=[];this.__request_queue=[];this.__disabled_events=[];this._flags={disable_all_events:false,identify_called:false};this["cookie"]=new F(this["config"])};N.prototype._loaded=function(){this.get_config("loaded")(this);if(this.get_config("track_pageview")){this.track_pageview()}};N.prototype._dom_loaded=function(){L.each(this.__dom_loaded_queue,function(e){this._track_dom.apply(this,e)},this);L.each(this.__request_queue,function(e){this._send_request.apply(this,e)},this);delete this.__dom_loaded_queue;delete this.__request_queue};N.prototype._track_dom=function(e,t){if(this.get_config("img")){V.error("You can't use DOM tracking functions with img = true.");return false}if(!D){this.__dom_loaded_queue.push([e,t]);return false}var n=(new e).init(this);return n.track.apply(n,t)};N.prototype._prepare_callback=function(e,t){if(L.isUndefined(e)){return null}if(k){var n=function(n){e(n,t)};return n}else{var i=this["_jsc"],r=""+Math.floor(Math.random()*1e8),a=this.get_config("callback_fn")+'["'+r+'"]';i[r]=function(n){delete i[r];e(n,t)};return a}};N.prototype._send_request=function(e,t,n){if(M){this.__request_queue.push(arguments);return}var i=this.get_config("verbose");if(this.get_config("test")){t["test"]=1}if(i){t["verbose"]=1}if(this.get_config("img")){t["img"]=1}if(n&&!k){t["callback"]=n}var r=L.HTTPBuildQuery(t);if("img"in t){var a=l.createElement("img");a.src=e;l.body.appendChild(a)}else if(k){var o=new XMLHttpRequest;o.open("POST",e,true);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.withCredentials=true;o.onreadystatechange=function(e){if(o.readyState===4){if(o.status===200){if(n){if(i){n(L.JSONDecode(o.responseText))}else{n(Number(o.responseText))}}}else{var t="Bad HTTP status: "+o.status+" "+o.statusText;V.error(t);if(n){if(i){n({status:0,error:t})}else{n(0)}}}}};o.send(r)}else{var s=l.createElement("script");s.type="text/javascript";s.async=true;s.defer=true;s.src=e;var u=l.getElementsByTagName("script")[0];u.parentNode.insertBefore(s,u)}};N.prototype._execute_array=function(e){var t,n=[],i=[],r=[];L.each(e,function(e){if(e){t=e[0];if(typeof e==="function"){e.call(this)}else if(L.isArray(e)&&t==="alias"){n.push(e)}else if(L.isArray(e)&&t.indexOf("track")!=-1&&typeof this[t]==="function"){r.push(e)}else{i.push(e)}}},this);var a=function(e,t){L.each(e,function(e){this[e[0]].apply(this,e.slice(1))},t)};a(n,this);a(i,this);a(r,this)};N.prototype.push=function(e){this._execute_array([e])};N.prototype.disable=function(e){if(typeof e==="undefined"){this._flags.disable_all_events=true}else{this.__disabled_events=this.__disabled_events.concat(e)}};N.prototype.track=function(e,t,n){if(typeof e==="undefined"){V.error("No event name provided to streakpanel.track");return}if(L.isBlockedUA()||this._flags.disable_all_events||L.include(this.__disabled_events,e)){if(typeof n!=="undefined"){n(0)}return}t=t||{};this["cookie"].update_search_keyword(l.referrer);if(this.get_config("store_google")){this["cookie"].update_campaign_params()}if(this.get_config("save_referrer")){this["cookie"].update_referrer_info(l.referrer)}t=L.extend({},{timestamp:(new Date).getTime()*1e3,screenWidth:screen.width,screenHeight:screen.height,windowWidth:window.innerWidth,windowHeight:window.innerHeight},L.info.properties(),this["cookie"].properties(),t);var i={event:e,properties:t};c.add(i);this.send_batched_requests_throttled();return i};N.prototype.send_batched_requests=function(){var e=c.removeAll();if(e.length==0){return}var t={data:e,clientRequestTimestamp:(new Date).getTime()*1e3};var n=L.JSONEncode(t);this._send_request(this.get_config("api_host")+"/eventtracking/track",{json:n},null)};N.prototype.send_batched_requests_throttled=function(){if(d){clearTimeout(d)}d=setTimeout(L.bind(this.send_batched_requests,this),x)};N.prototype.track_pageview=function(e){if(typeof e==="undefined"){e=l.location.href}this.track("mp_page_view",L.info.pageviewInfo(e))};N.prototype.track_links=function(){return this._track_dom.call(this,P,arguments)};N.prototype.track_forms=function(){return this._track_dom.call(this,A,arguments)};N.prototype.register=function(e,t){this["cookie"].register(e,t)};N.prototype.register_once=function(e,t,n){this["cookie"].register_once(e,t,n)};N.prototype.unregister=function(e){this["cookie"].unregister(e)};N.prototype._register_single=function(e,t){var n={};n[e]=t;this.register(n)};N.prototype.identify=function(e,t,n,i,r){if(e!=this.get_distinct_id()&&e!=this.get_property(C)){this.unregister(C);this._register_single("distinct_id",e)}this._flags.identify_called=true;this["people"]._flush(t,n,i,r)};N.prototype.get_distinct_id=function(){return this.get_property("distinct_id")};N.prototype.alias=function(e,t){if(e===this.get_property(b)){V.critical("Attempting to create alias for existing People user - aborting.");return-2}var n=this;if(L.isUndefined(t)){t=this.get_distinct_id()}if(e!==t){this._register_single(C,e);return this.track("$create_alias",{alias:e,distinct_id:t},function(t){n.identify(e)})}else{V.error("alias matches current distinct_id - skipping api call.");this.identify(e);return-1}};N.prototype.name_tag=function(e){this._register_single("mp_name_tag",e)};N.prototype.set_config=function(e){if(L.isObject(e)){L.extend(this["config"],e);if(this["cookie"]){this["cookie"].update_config(this["config"])}B=B||this.get_config("debug")}};N.prototype.get_config=function(e){return this["config"][e]};N.prototype.get_property=function(e){return this["cookie"]["props"][e]};N.prototype.toString=function(){var e=this.get_config("name");if(e!==h){e=h+"."+e}return e};var H=function(){};H.prototype._init=function(e){this._streakpanel=e};H.prototype.set=function(e,t,n){var i={};var r={};if(L.isObject(e)){L.each(e,function(e,t){if(t=="$distinct_id"||t=="$token"){return}else{r[t]=e}});n=t}else{r[e]=t}if(this._get_config("save_referrer")){this._streakpanel.cookie.update_referrer_info(l.referrer)}r=L.extend({},L.info.people_properties(),this._streakpanel.cookie.get_referrer_info(),r);i[g]=r;return this._send_request(i,n)};H.prototype.set_once=function(e,t,n){var i={};var r={};if(L.isObject(e)){L.each(e,function(e,t){if(t=="$distinct_id"||t=="$token"){return}else{r[t]=e}});n=t}else{r[e]=t}i[v]=r;return this._send_request(i,n)};H.prototype.increment=function(e,t,n){var i={};var r={};if(L.isObject(e)){L.each(e,function(e,t){if(t=="$distinct_id"||t=="$token"){return}else if(isNaN(parseFloat(e))){V.error("Invalid increment value passed to streakpanel.people.increment - must be a number");return}else{r[t]=e}});n=t}else{if(L.isUndefined(t)){t=1}r[e]=t}i[y]=r;return this._send_request(i,n)};H.prototype.append=function(e,t,n){var i={};var r={};if(L.isObject(e)){L.each(e,function(e,t){if(t=="$distinct_id"||t=="$token"){return}else{r[t]=e}});n=t}else{r[e]=t}i[w]=r;return this._send_request(i,n)};H.prototype.track_charge=function(e,t,n){if(!L.isNumber(e)){e=parseFloat(e);if(isNaN(e)){V.error("Invalid value passed to streakpanel.people.track_charge - must be a number");return}}return this.append("$transactions",L.extend({$amount:e},t),n)};H.prototype.clear_charges=function(e){return this.set("$transactions",[],e)};H.prototype.delete_user=function(){if(!this._identify_called()){V.error("streakpanel.people.delete_user() requires you to call identify() first");return}var e={$delete:this._streakpanel.get_distinct_id()};return this._send_request(e)};H.prototype.toString=function(){return this._streakpanel.toString()+".people"};H.prototype._send_request=function(e,t){e["$token"]=this._get_config("token");e["$distinct_id"]=this._streakpanel.get_distinct_id();var n=L.encodeDates(e),i=L.truncate(n,255),r=L.JSONEncode(n),a=L.base64Encode(r);if(!this._identify_called()){this._enqueue(e);if(!L.isUndefined(t)){if(this._get_config("verbose")){t({status:-1,error:null})}else{t(-1)}}return i}V.log("MIXPANEL PEOPLE REQUEST:");V.log(i);this._streakpanel._send_request(this._get_config("api_host")+"/engage/",{data:a},this._streakpanel._prepare_callback(t,i));return i};H.prototype._get_config=function(e){return this._streakpanel.get_config(e)};H.prototype._identify_called=function(){return this._streakpanel._flags.identify_called===true};H.prototype._enqueue=function(e){if(g in e){this._streakpanel.cookie._add_to_people_queue(g,e)}else if(v in e){this._streakpanel.cookie._add_to_people_queue(v,e)}else if(y in e){this._streakpanel.cookie._add_to_people_queue(y,e)}else if(w in e){this._streakpanel.cookie._add_to_people_queue(w,e)}else{V.error("Invalid call to _enqueue():",e)}};H.prototype._flush=function(e,t,n,i){var r=this,a=L.extend({},this._streakpanel.cookie._get_queue(g)),o=L.extend({},this._streakpanel.cookie._get_queue(v)),s=L.extend({},this._streakpanel.cookie._get_queue(y)),l=this._streakpanel.cookie._get_queue(w);if(!L.isUndefined(a)&&L.isObject(a)&&!L.isEmptyObject(a)){r._streakpanel.cookie._pop_from_people_queue(g,a);this.set(a,function(t,n){if(t==0){r._streakpanel.cookie._add_to_people_queue(g,a)}if(!L.isUndefined(e)){e(t,n)}})}if(!L.isUndefined(o)&&L.isObject(o)&&!L.isEmptyObject(o)){r._streakpanel.cookie._pop_from_people_queue(v,o);this.set_once(o,function(e,t){if(e==0){r._streakpanel.cookie._add_to_people_queue(v,o)}if(!L.isUndefined(i)){i(e,t)}})}if(!L.isUndefined(s)&&L.isObject(s)&&!L.isEmptyObject(s)){r._streakpanel.cookie._pop_from_people_queue(y,s);this.increment(s,function(e,n){if(e==0){r._streakpanel.cookie._add_to_people_queue(y,s)}if(!L.isUndefined(t)){t(e,n)}})}if(!L.isUndefined(l)&&L.isArray(l)&&l.length){for(var u=l.length-1;u>=0;u--){var c=l.pop();r.append(c,function(e,t){if(e==0){r._streakpanel.cookie._add_to_people_queue(w,c)}if(!L.isUndefined(n)){n(e,t)}})}r._streakpanel.cookie.save()}};L["toArray"]=L.toArray;L["isObject"]=L.isObject;L["JSONEncode"]=L.JSONEncode;L["JSONDecode"]=L.JSONDecode;L["isEmptyObject"]=L.isEmptyObject;N.prototype["init"]=N.prototype.init;N.prototype["disable"]=N.prototype.disable;N.prototype["track"]=N.prototype.track;N.prototype["track_links"]=N.prototype.track_links;N.prototype["track_forms"]=N.prototype.track_forms;N.prototype["track_pageview"]=N.prototype.track_pageview;N.prototype["register"]=N.prototype.register;N.prototype["register_once"]=N.prototype.register_once;N.prototype["unregister"]=N.prototype.unregister;N.prototype["identify"]=N.prototype.identify;N.prototype["alias"]=N.prototype.alias;N.prototype["name_tag"]=N.prototype.name_tag;N.prototype["set_config"]=N.prototype.set_config;N.prototype["get_config"]=N.prototype.get_config;N.prototype["get_property"]=N.prototype.get_property;N.prototype["get_distinct_id"]=N.prototype.get_distinct_id;N.prototype["toString"]=N.prototype.toString;F.prototype["properties"]=F.prototype.properties;F.prototype["update_search_keyword"]=F.prototype.update_search_keyword;F.prototype["update_referrer_info"]=F.prototype.update_referrer_info;F.prototype["get_cross_subdomain"]=F.prototype.get_cross_subdomain;F.prototype["clear"]=F.prototype.clear;H.prototype["set"]=H.prototype.set;H.prototype["set_once"]=H.prototype.set_once;H.prototype["increment"]=H.prototype.increment;H.prototype["append"]=H.prototype.append;H.prototype["track_charge"]=H.prototype.track_charge;H.prototype["clear_charges"]=H.prototype.clear_charges;H.prototype["delete_user"]=H.prototype.delete_user;H.prototype["toString"]=H.prototype.toString;if(L.isUndefined(e)){V.critical("'streakpanel' object not initialized. Ensure you are using the latest version of the Streakpanel JS Library along with the snippet we provide.");return}if(e["__loaded"]||e["config"]&&e["cookie"]){V.error("Streakpanel library has already been downloaded at least once.");return}if(T<1.1){V.critical("Version mismatch; please ensure you're using the latest version of the Streakpanel code snippet.");return}var j={};L.each(e["_i"],function(e){var t,n;if(e&&L.isArray(e)){t=e[e.length-1];n=O.apply(this,e);j[t]=n}});var U=function(){L.each(j,function(t,n){if(n!==h){e[n]=t}});e["_"]=L};e["init"]=function(t,n,i){if(i){if(!e[i]){e[i]=j[i]=O(t,n,i);e[i]._loaded()}}else{var r=e;if(j[h]){r=j[h]}else if(t){r=O(t,n,h)}window[h]=e=r;U()}};e["init"]();L.each(j,function(e){e._loaded()});function G(){if(G.done){return}G.done=true;D=true;M=false;L.each(j,function(e){e._dom_loaded()})}if(l.addEventListener){if(l.readyState=="complete"){G()}else{l.addEventListener("DOMContentLoaded",G,false)}}L.register_event(window,"load",G,true)})(window["streakpanel"]);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){};n.extend(u.prototype,{getDetailsText:function(e){var t=e.getPipeline();var i=this._getFieldsInOrder(t);i=n.uniq(i,false,function(e){return e.key()});var r=[];var a=e.get("notes").trim();if(a){r.push(a)}for(var o=0;o<i.length;o++){var s=e.getFieldDisplayTextValue(i[o].key()).trim();if(s.length>0){r.push(s)}}return r.join(", ")},_getFieldsInOrder:function(e){var t=l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(e);var i=l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.load(e);if(!t||!t.data||!n.isArray(t.data)){return e.getFields()}var r=[];for(var a=0;a<t.data.length;a++){var o=t.data[a];var s=o.split("|");if(s[0]==="field"){r.push(e.getField(s[1]))}}return r},destroy:function(){}});l.Services.BoxDisplayText=new u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox;var r={searchNameByQuery:function(t,r){t=(t||"").toLowerCase();r=r||8;var a=i.Services.AccessManager.getPipelinePermissionsMap([{entityType:"Box",action:"UPDATE"},{entityType:"GmailThread",action:"CREATE"}]);var o=n.chain(i.Data.getAllBoxes()).filter(function(e){return a[e.getPipelineKey()]}).map(function(n){var i=n.displayName();var r=e.Utils.stringScore(i,t,.1);if(i.toLowerCase().indexOf(t)>-1){r+=1}return[r,n]}).sortBy(function(e){return-1*e[0]}).filter(function(e){return e[0]>.5}).map(function(e){return e[1]}).value();var s=[];for(var l=0;l<o.length;l++){if(s.length<r||o[l].displayName().toLowerCase()===t){s.push(o[l])}}return s},getBoxesWithOverlappingEmailAddresses:function(e,t){var r=i.getUser();if(!r){return[]}var a=r.getEmail().toLowerCase();if(i.getUser().isGoogleAppsUser()){var o=i.getUser().getDomain().toLowerCase();e=n.filter(e,function(e){return e.toLowerCase().indexOf(o)===-1})}e=n(e).map(function(e){return e.toLowerCase()}).filter(function(e){if(e.indexOf("mailfoogae.appspotmail.com")>-1){return false}return e!==a});return n.filter(i.Data.getAllBoxes(),function(n){if(t&&n.key()===t.key()){return false}var i=n.get("emailAddresses");for(var r=0;r<i.length;r++){if(e.indexOf(i[r].toLowerCase())>-1){return true}}return false})}};i.Services.BoxSearcher=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox;var r={getSuggestions:function(e){var r=this;var a;if(e&&e.length>0){var o={names:{},companies:{}};var s=n.sortedPluck(e,{pluck:function(e){var t=[];if(e.emailAddresses){for(var n=0;n<e.emailAddresses.length;n++){if(e.emailAddresses[n]!=i.getUser().getEmail()){var r=e.names;if(r&&r.length>0){if(r[n]){t.push(r[n].capitalize())}else{t.push(e.emailAddresses[n].split("@")[0])}}}}}return t},filter:function(e){return e!=="me"}});s.reverse();for(a=0;a<s.length;a++){s[a]=t.trim(s[a].replace("✆","")).split(" ").map(function(e){return e.capitalize()}).join(" ")}var l={};for(a=0;a<s.length;a++){if(s[a].indexOf(" ")>-1){l[s[a].split(" ")[0].toLowerCase()]=s[a]}}s=n.filter(s,function(e){if(e.indexOf(" ")===-1){return!l[e.toLowerCase()]}return true});var u=i.getUser().get("email").split("@")[1].split(".")[0];var c=n.sortedPluck(e,{pluck:function(e){return e.emailAddresses},map:function(e){return e.split("@")[1].capitalize().split(".")[0]},filter:function(e){return i.Constants.EMAIL_BLACK_LIST.indexOf(e.toLowerCase())===-1&&e.toLowerCase()!==u.toLowerCase()}});c.reverse();var d=[];var h=n.pluckPlus(e,function(e){try{return e.subject.stripTags()}catch(t){return""}});d=d.concat(n.firstIfPresent([h,c,s]));d=d.concat(n.restIfPresent([s,c,h]));var f=n.chain(d).uniq().compact().filter(this._doesBoxNameNotExist).value();return f}},_doesBoxNameNotExist:function(e){var t=i.Data.getAllBoxes();for(var n=0;n<t.length;n++){if(t[n].displayName().toLowerCase()===e.toLowerCase()){return false}}return true}};i.Services.SuggestedBoxNames=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=/[^\w]|\s/;var c=function(){this._keyBuffer=null;this._bufferHistory=[];this._stateMachine=null;this._sequences=[];this._characterSequenceModels=[];this._setupShortcutListenerStateMachine()};n.extend(c.prototype,{addDataSource:function(e){this._characterSequenceModels.push(e);n.mutate("union",this._sequences,e.getSequences());e.addDelegate(this)},sequencesChanged:function(e){var t=this;var i=n.chain(this._characterSequenceModels).map(function(e){return e.getSequences()}).flatten().value();this._sequences.length=0;n.mutate("union",this._sequences,i)}});n.extend(c.prototype,{_setupShortcutListenerStateMachine:function(){var t=this;this._stateMachine=e.StateMachine.create({initial:"start",events:[{name:"charPress",from:["start","someMatches"],to:"bufferCheck"},{name:"charPress",from:["noMatches"],to:"noMatches"},{name:"noMatching",from:["bufferCheck"],to:"noMatches"},{name:"matching",from:["bufferCheck"],to:"someMatches"},{name:"deletePress",from:["noMatches","someMatches"],to:"bufferCheck"},{name:"deletePress",from:["start"],to:"start"},{name:"reset",from:["noMatches","someMatches","bufferCheck","start"],to:"start"}],callbacks:{onstart:n.bind(this._onStart,this),onnoMatches:n.bind(this._onNoMatches,this),onsomeMatches:n.bind(this._onSomeMatches,this),onbufferCheck:n.bind(this._onBufferCheck,this),onbeforedeletePress:n.bind(this._onBeforeDeletePress,this)}})},_onStart:function(e,t,n){this._keyBuffer="";this._bufferHistory.length=0;this._callNoMatchCallbacks()},_onNoMatches:function(e,t,n){if(this._keyBuffer.length>0){this._bufferHistory.push(this._keyBuffer)}this._callNoMatchCallbacks()},_onSomeMatches:function(e,t,n){if(this._keyBuffer.length>0){this._bufferHistory.push(this._keyBuffer)}},_onBufferCheck:function(e,t,n,i){if(!this._keyBuffer||this._keyBuffer.length===0){this._stateMachine.reset();return}var r=this._findPartialMatchSequences();if(r.length===0){if(this._keyBuffer.match(/\s/)){this._stateMachine.reset()}this._keyBuffer="";this._stateMachine.noMatching();return}this._callPartialMatchCallbacks(r);if(this._isThereAnExactMatch(r)){if(this._shouldSuppressKeypress()){i.preventDefault()}this._callRelevantCallbacks();this._stateMachine.reset();return}this._stateMachine.matching()},_onBeforeDeletePress:function(e,t,n){if(this._bufferHistory.length>1){this._keyBuffer=this._bufferHistory.pop();this._keyBuffer=this._bufferHistory.pop()}else{this._keyBuffer=""}},_findPartialMatchSequences:function(){var e=this;return n.filter(this._sequences,function(t){return t&&t.indexOf(e._keyBuffer)===0})},_isThereAnExactMatch:function(e){for(var t=0;t<e.length;t++){if(e[t]===this._keyBuffer){return true}}return false},_shouldSuppressKeypress:function(){var e=this._findMatchingSequenceModels();for(var t=0;t<e.length;t++){if(e[t].onMatchShouldSuppress()){return true}}},_findMatchingSequenceModels:function(e){if(!e){e=[this._keyBuffer]}var t=this._keyBuffer;return n.filter(this._characterSequenceModels,function(t){var n=t.getSequences();for(var i=0;i<n.length;i++){for(var r=0;r<e.length;r++){if(n[i]===e[r]){return true}}}})},_callNoMatchCallbacks:function(){for(var e=0;e<this._characterSequenceModels.length;e++){this._characterSequenceModels[e].noMatchFound()}},_callRelevantCallbacks:function(){var e=this._findMatchingSequenceModels();for(var t=0;t<e.length;t++){e[t].exactMatchFound(this._keyBuffer)}},_callPartialMatchCallbacks:function(e){var t=this._findMatchingSequenceModels(e);for(var n=0;n<t.length;n++){t[n].partialMatchFound(this._keyBuffer)}}});n.extend(c.prototype,{destroy:function(){this._bufferHistory.length=0;this._sequences.length=0;this._characterSequenceModels.length=0},keydown:function(e){if(i.is("left/right",e)){this._stateMachine.reset()}},keypress:function(e){if(i.is("enter",e)){this._stateMachine.reset();return}var t=String.fromCharCode(e.keyCode);if(t.match(/\s/)&&this._stateMachine.is("noMatches")){this._stateMachine.reset();return}if(this._stateMachine.is("noMatches")&&t.match(u)){this._stateMachine.reset();return}this._keyBuffer+=t;this._stateMachine.charPress(e)},keyup:function(e){if(i.is("backspace",e)){this._stateMachine.deletePress()}},editorBlur:function(){this._stateMachine.reset()}});l.Controllers.CharacterSequenceController=c})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this)};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{getSequences:function(){return this._sequences},addSequence:function(e){this._callDelegateFunction("sequencesChanged")},removeSequence:function(e){this._callDelegateFunction("sequencesChanged")},exactMatchFound:function(){this._callDelegateFunction.apply(this,["exactMatchFound"].concat(n.toArray(arguments)))},partialMatchFound:function(){this._callDelegateFunction.apply(this,["partialMatchFound"].concat(n.toArray(arguments)))},noMatchFound:function(){this._callDelegateFunction.apply(this,["noMatchFound"].concat(n.toArray(arguments)))},onMatchShouldSuppress:function(){return false}});s.Controllers.CharacterSequenceController.CharacterSequenceBaseDataSource=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.Locale,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=l.Models.Pipeline;var c="-";var d={Functions:{sum:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}return _(n.reduce(f(e),function(e,t){return e+t},0))},count:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}return p(e).length},unique:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}if(t=="DATE"){e=n.map(e,m)}return n.uniq(p(e)).length},average:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}var i=f(e);if(i.length==0){return c}return _(n.reduce(i,function(e,t){return e+t},0)/i.length)},min:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}var i=f(e);if(i.length==0){return c}var r=Math.min.apply(Math,i);if(t=="DATE"){r=m(r)}return r},max:function(e,t){if(t==="FORMULA"){e=n.map(e,g)}var i=f(e);if(i.length==0){return c}var r=Math.max.apply(Math,i);if(t=="DATE"){r=m(r)}return r},most_frequent:function(e,t,i,r){var a=h(e,t,i,r);if(a===null){return c}return n.max(a,function(e){return e[1]})[0]},least_frequent:function(e,t,i,r){var a=h(e,t,i,r);if(a===null){return c}return n.min(a,function(e){return e[1]})[0]},percentage_set:function(e,t){var i=e.length||0;if(i===0){return 0}var r=n.countBy(e,n.toBoolean)["true"]||0;return r/i},number_set:function(e,t){return n.countBy(e,n.toBoolean)["true"]||0}},ListTypes:{NONE:[],BASIC:["sum","|","average","min","max","|","count","unique","|","most_frequent","least_frequent"],LIST:["count","unique","|","average","min","max","|","most_frequent","least_frequent"],DATE:["count","unique","|","min","max","|","most_frequent","least_frequent"],BOOLEAN:["percentage_set","number_set","|","most_frequent","least_frequent"],TEXT_VALUE:["count","unique","|","most_frequent","least_frequent"]},FieldTypesToListTypes:{TEXT:"BASIC",NUMBER:"BASIC",FORMULA:"BASIC",PERSON:"LIST",DATE:"DATE",CHECKBOX:"BOOLEAN",DROPDOWN:"TEXT_VALUE",TAG:"LIST"},getLocalizedName:function(e){return a.getString("summary_type_"+e)}};function h(e,t,i,r){if(t==="FORMULA"){e=n.map(e,g)}var a=p(e);if(a.length==0){return null}switch(t){case"DATE":a=n.map(a,m);break;case"CHECKBOX":a=n.map(e,function(e){if(e){return l.Locale.getString("checked")}else{return l.Locale.getString("unchecked")}});break;case"DROPDOWN":var o=i.getField(r);a=n.map(a,function(e){return o.getOption(e).name});break;case"TAG":var o=i.getField(r);a=n.map(a,function(e){return o.getOption(e).tag});break}return counts=n.pairs(n.countBy(a,n.identity))}function f(e){return n(e).chain().map(function(e){if(n.isArray(e)){return e.length}if(n.isBoolean(e)){return e?1:0}return parseFloat(e)}).filter(function(e){return!isNaN(e)}).value()}function p(e){return n(e).chain().flatten(true).map(function(e){if(e&&e.email){e=e.email}if(typeof e=="string"){e=e.trim()}return e}).filter(function(e){return!!e||typeof e=="number"}).value()}function m(e){if(!e){return""}var t=r.create(e);if(t.isValid()){return t.prettyDate(true)}else{return""}}function _(e){return Math.round(e*100)/100}function g(e){if(n.isReal(e.calculationValue)){return e.calculationValue}return""}l.ColumnSummary=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.NotificationCenter,s=e.BentoBox;var l=false;var u=[];var c;c=s.AssignedToController={initialized:false,init:function(e){if(!c.initialized){o.subscribe({eventName:"409Conflict",observer:this,functionToCall:this._conflictFound});c.initialized=true}if(e){e()}},_conflictFound:function(e){if(e.model instanceof s.Models.Box){this._handleBoxConflict(e.model,e.response)}else if(e.model instanceof s.Models.Pipeline){this._handlePipelineConflict(e.model,e.response)}},_handleBoxConflict:function(t,i){if(!i||!i.details){return}var r=n.map(i.details,function(e){return n.extend(e,{permissionSetName:"__defaultOrgPermissionSet__"})});var a=s.Locale.getString("assigned_to_share_body",{pipeline:t.getPipeline().displayName(),box:t.displayName()})+"<br />"+"<ul>";n.each(r,function(e){var t="<li>";if(e.fullName){t+=e.fullName+" - "}if(e.email){t+=e.email}t+="</li>";a+=t});a+="</ul>";s.Widgets.Modal.confirm(s.Locale.getString("assigned_to_share_title"),a,function(){var i=t.getPipeline();var a=i.get("aclEntries");a=a.concat(r);a=n.uniq(a,"email");i.set("aclEntries",a);var o=t.getAssignedToSharingEntries()||[];o=o.concat(r);o=n.uniq(o,"email");t.set("assignedToSharingEntries",o);e.Model.dependentSaveAll([i,t])},function(){})},_handlePipelineConflict:function(e,t){var i=t.details;if(n.isEmpty(i)){return}this._promptForPipelineUnshare(e,i)},_promptForPipelineUnshare:function(e,t){var i=e.get("aclEntries");var r=e.get("orgWide");var a=n.pluck(t,"email").join(", ");var o=s.Locale.getString("assigned_to_unshare_pipeline_body",{contacts:a});s.Widgets.Modal.simpleConfirm(s.Locale.getString("assigned_to_unshare_pipeline_title"),o)}};e.DependencyManager.addFunction({functionKey:"assignedToControllerInitialized",functionToCall:s.AssignedToController.init,functionContext:s.AssignedToController,dependentFunctionKeys:["data.pipelines.initialized","data.boxes.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={trackingContext:{widgetContext:"boxGeneratedBySuggestions"},initialized:false,init:function(e){var t=this;if(!t.initialized){var n=o.Data.getAllBoxes();t.blackListOrgs.push(o.getUser().getDomain().toLowerCase());n.watch("add",function(e){t.updateBoxStemmingCache(e.model)},this);n.watch("remove",function(e){try{t.removeBoxStemmingCache(e.model)}catch(n){}},this);n.watch("change",function(e){var n=e.model;var i=e.property;if(i==="name"){t.updateBoxStemmingCache(n)}},this);t.initialized=true}if(e){e()}},getBoxSuggestions:function(e){var t=this;if(!e){return[]}var i=t.extractthreadsInfo(e);var r=t._getComputedBoxes(i);var a=o.Services.AccessManager.getPipelinePermissionsMap([{entityType:"Box",action:"UPDATE"},{entityType:"GmailThread",action:"CREATE"}]);var s=n.filter(r,function(e){return a[e.box.getPipelineKey()]});var l=n.first(s,3);l=n.filter(l,function(e){return e.rank>=t.OVERALL_THREASHOLD});var u=n.map(l,function(e){var i=e.rankingFactors;var r=i;var a=t.generateSourceText(i);var o=function(e){var r=n.map(i,function(e,t){return t});var a={algosArrayString:r.join(","),algosJSON:JSON.stringify(i)};t.track("suggestedBoxChosen",a)};return{box:e.box,clickCallback:o,_source:a,sourceRaw:r}});return u},removeBoxStemmingCache:function(e){var t=this;var i=t.boxesStemmedKeywordsCache[e.key()];if(n.isReal(i)){n.each(i,function(i){var r=t.keywordToBoxMapStemmingCache[i];if(n.isReal(r)){r=n.filter(r,function(t){return t!==e});t.keywordToBoxMapStemmingCache[i]=r}})}t.boxesStemmedKeywordsCache[e.key()]=null},updateBoxStemmingCache:function(t){var i=this;try{var r=t.get("name").split(" ");r=n.map(r,function(r){var a=e.Stemmer(r.toLowerCase().trim());if(!n.isReal(i.keywordToBoxMapStemmingCache[a])){i.keywordToBoxMapStemmingCache[a]=[]}i.keywordToBoxMapStemmingCache[a].push(t);return a});i.boxesStemmedKeywordsCache[t.key()]=r}catch(a){}},keywordToBoxMapStemmingCache:{},algosAndWeighting:{emailsAlgo:{weighting:.65,sourceReason:"emails in common with box contacts",lowerBoundthreashHold:.6},orgsAlgo:{weighting:.65,sourceReason:"similar organizations associated with box ",lowerBoundthreashHold:.6},orgNameMatchAlgo:{weighting:.8,lowerBoundthreashHold:0},subjectsAlgo:{weighting:1,sourceReason:"subject similarity to box name",lowerBoundthreashHold:.4},wordsAlgo:{weighting:.9,sourceReason:"keywords in common with box name",lowerBoundthreashHold:.2},nameAlgo:{weighting:.5,lowerBoundthreashHold:.2}},OVERALL_THREASHOLD:.1,BOXLEN:3,COMMON_ENGLISH_WORDS:["the","is","was","to","an","did","and","a","or","you","this","they","her","not","he","she","they","would","there","their","with","about","from","have","look","know","seem","feel","leave","thing","want"],boxesStemmedKeywordsCache:{},wordsAlgo:function(t){if(t.keywordsInSubject.length===0){return[]
}var i=this;var r=t.keywordsInSubject;var a=[];var o=e.BentoBox.Data.getAllBoxes();var s={};n.each(r,function(e){var t=i.keywordToBoxMapStemmingCache[e];if(n.isReal(t)){s[e]=t}});var l=i.wordAlgoCombineBoxes(s);return l},wordAlgoCombineBoxes:function(e){var t={};n.each(e,function(e,i){var r=.9999*1/e.length;n.each(e,function(e){if(t[e.key()]){t[e.key()].confidenceInSuggestion+=r}else{t[e.key()]={box:e,boxKey:e.key(),confidenceInSuggestion:r}}})});var i=[];n.each(t,function(e){i.push(e)});i=n.sortBy(i,function(e){return e.confidenceInSuggestion});return i.reverse()},stringsMatchingWeighted:function(t,n){return e.Utils.stringScore(t,n,.1)},subjectsAlgo:function(t){if(t.subjects.length===0){return[]}var i=this;var r=t.subjects;var a=[];var o=e.BentoBox.Data.getAllBoxes();o.sortByParameter("lastUpdatedTimestamp");n.each(n.last(o,2e3),function(e){var t=0;var o=0;var s=[];n.each(r,function(n){var r=i.stringsMatchingWeighted(n,e.get("name"));if(r>.1){s.push(r);t++;o+=r}});if(o!==0&&t!==0){var l=function(e){var t=e.length;var i=0;n.each(e,function(e){i=e/t});return i};var u=l(s);a.push({box:e,boxKey:e.key(),confidenceInSuggestion:u})}});return a},emailsAlgo:function(t){if(t.emailAddressesCount===0){return[]}var i=[];var r=e.BentoBox.Data.getAllBoxes();var a=t.emailAddresses;n.each(r,function(e){var r=e.get("emailAddresses");var o=0;n.each(a,function(e,t){if(n.contains(r,t)){o+=e}});var s=1*o*(1/t.emailAddressesCount);if(s>0){i.push({box:e,boxKey:e.key(),confidenceInSuggestion:s})}});return i},nameAlgo:function(t){if(!t.namesCount){return[]}var n=[];var i=o.Data.getAllBoxes();i.sortByParameter("lastUpdatedTimestamp");var r=Math.min(i.length,2e3);var a=i.length-1;var s=a-r;for(var l=a;l>s;l--){var u=i[l];var c=u.displayName();var d=0;for(var h in t.names){d+=e.Utils.stringScore(c,h,.1)*t.names[h]}if(d>.7){n.push({box:u,boxKey:u.key(),confidenceInSuggestion:d/t.namesCount})}}return n},extractKeywordsFromSubject:function(t){var i=this;var r=t.split(" ");r=n.filter(r,function(e){var t=e.toLowerCase().trim();return t.length>2&&!n.contains(i.COMMON_ENGLISH_WORDS,t)});r=n.map(r,function(t){return e.Stemmer(t.toLowerCase().trim())});return r},extractthreadsInfo:function(e){var t=this;var i={emailAddresses:{},emailAddressesCount:0,names:{},namesCount:0,subjects:[],orgs:{},threads:e};n.each(e,function(e){var r=e.emailAddresses;n.each(r,function(e){i.emailAddressesCount++;if(i.emailAddresses[e]){i.emailAddresses[e]++}else{i.emailAddresses[e]=1}});var a=e.names||[];for(var o=0;o<a.length;o++){i.namesCount++;var s=a[o];if(i.names[s]){i.names[s]++}else{i.names[s]=1}}var l=e.subject.trim();i.subjects.push(l);i.keywordsInSubject=t.extractKeywordsFromSubject(l)});i.orgs=t.extractOrgs(i);return i},processAndCombineBoxesIntoSortedArray:function(e){var t=[];n.each(e,function(e,n){t.push(e)});var i=n.sortBy(t,function(e){return e.rank});return i},_getComputedBoxes:function(e){var t=this;var i={};var r=[];n.each(t.algosAndWeighting,function(r,a){var o=t[a](e);n.each(o,function(e){var t=i[e.boxKey];if(n.isReal(t)){if(e.confidenceInSuggestion>r.lowerBoundthreashHold){i[e.boxKey].rankingFactors[a]={original:e.confidenceInSuggestion,processed:s};i[e.boxKey].rank+=e.confidenceInSuggestion*r.weighting}}else{if(e.confidenceInSuggestion>r.lowerBoundthreashHold){var o={};var s=e.confidenceInSuggestion*r.weighting;o[a]={original:e.confidenceInSuggestion,processed:s};i[e.boxKey]={box:e.box,rank:s,rankingFactors:o}}}})});return t.processAndCombineBoxesIntoSortedArray(i).reverse()},generateSourceText:function(e){var t=this;var i=[];n.each(e,function(e,n){i.push(" - "+t.algosAndWeighting[n].sourceReason)});return i.join("<br />")},extractOrgs:function(e){var t={};n.each(e.emailAddresses,function(e,i){var r=i.split("@")[1].toLowerCase();if(n.contains(self.blackListOrgs,r)){return}var a=[r,r.split(".")[0]];n.each(a,function(n){if(t[n]){t[n]+=e}else{t[n]=e}})});return t},blackListOrgs:n.clone(e.BentoBox.Constants.EMAIL_BLACK_LIST),getMainOrg:function(e){var t;var i=0;n.each(e,function(e,n){if(e>i){i=e;t=n}});return t},orgsAlgo:function(t){var i=n.size(t.orgs);if(i===0){return[]}var r=this;var a=[];var o=e.BentoBox.Data.getAllBoxes();var s=r.getMainOrg(t.orgs);n.each(o,function(e){var t=r.extractOrgsFromBox(e);if(n.isReal(t[s])){var o=t[s]/i;if(o>0){a.push({box:e,boxKey:e.key(),confidenceInSuggestion:o})}}});return a},boxOrgsCache:{},extractOrgsFromBox:function(t){var i=this;var r=i.boxOrgsCache[t.key()];if(r){return r}var a=[];var o={};var s=t.get("emailAddresses");var l=e.BentoBox.getUser().getDomain()||"";l=l.toLowerCase();n.each(s,function(e){var t=e.split("@")[1]||"";t=t.toLowerCase();if(!n.contains(i.blackListOrgs,t)&&t!==l){if(o[t]){o[t]+=1}else{o[t]=1;a.push(t)}}});i.boxOrgsCache[t.key()]=o;return o},orgNameMatchAlgo:function(e){var t=e.orgs;var n=[];var i=o.Data.getAllBoxes();for(var r=0;r<i.length;r++){var a=i[r].displayName().toLowerCase();if(!t[a]){continue}n.push({box:i[r],boxKey:i[r].key(),confidenceInSuggestion:t[a]})}for(var r=0;r<n.length;r++){var s=n[r];s.confidenceInSuggestion=s.confidenceInSuggestion/n.length}return n},storeRecentlySeenBox:function(){},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}};e.DependencyManager.addFunction({functionKey:"boxSuggestionsControllerInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["data.boxes.initialized","userLoggedIn"]});o.Modules.BoxSuggestionsController=s})(Streak);(function(e){"use strict";var t=e.Utils,n=e.BentoBox;var i={_loaded:null,init:function(){if(!this._loaded){this._loaded=t.loadScript("https://www.google.com/jsapi")}return this._loaded},load:function(t,n,i){return this.init().then(function(){return new e.RSVP.Promise(function(e,r){if(!i){i={}}i.callback=e;google.load(t,n,i)})})}};n.Services.GoogleJSAPI=i})(Streak);(function(e){"use strict";var t=e.Utils,n=e.DependencyManager,i=e.BentoBox;function r(){return i.Services.GoogleJSAPI.load("visualization","1",{packages:["corechart","table","timeline"]})}e.DependencyManager.addFunction({functionKey:"chartsInitialized",functionReference:r,dependentFunctionKeys:[]})})(Streak);(function(e){"use strict";var t=e.Utils,n=e.DependencyManager,i=e.BentoBox;var r={_loaded:null,init:function(){if(!this._loaded){this._loaded=t.loadScript("https://apis.google.com/js/platform.js")}return this._loaded},render:function(){return this.init().then(function(){gapi.plusone.go()}).catch(function(e){i.logError("failed to render +1 button",e)})}};i.Services.GooglePlusOne=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.APIRequester,s=e.BentoBox;var l={};var u={};var c=false;var d=[];var h;s.Contacts={init:function(e){this.suggestionTemplate=a.get("peoplePickerSuggestion");if(e){e()}},makeContactRequest:function(e,i,r){if(!i.limit){i.limit=15}r=r||function(){};var a=this;return o.get(e,i).getPromise().then(function(e){if(!e){r(null);return}else if(n.isString(e)){try{e=JSON.parse(e)}catch(i){r(null);return}}var o=[];var l;if(e&&e.feed&&e.feed.entry&&e.feed.entry.length>0){l=e.feed.entry}else if(n.isArray(e)){l=e}if(l&&l.length>0){t.each(l,function(e,i){var r={};r.id=i.id.$t;if(i.gd$name){r.fullName=i.gd$name.gd$fullName?i.gd$name.gd$fullName.$t:null;r.givenName=i.gd$name.gd$givenName?i.gd$name.gd$givenName.$t:null;r.familyName=i.gd$name.gd$familyName?i.gd$name.gd$familyName.$t:null;r.displayName=r.fullName}if(i.link){for(var a=0,l=i.link.length;a<l;a++){if(i.link[a].type=="image/*"&&n.isReal(i.link[a]["gd$etag"])){r.imageUrl=s.UI.getResourceURL("api/v1/contacts/photo?email="+encodeURIComponent(s.userEmail)+"&photoUrl="+encodeURIComponent(i.link[a].href));r.googleImageUrl=i.link[a].href;break}}}r.lastUpdated=i.updated?i.updated.$t:null;if(i.gd$email){for(var a=0,l=i.gd$email.length;a<l;a++){if(i.gd$email[a]){var u=t.extend({},r);u.email=i.gd$email[a].address;u.id=r.id+"_"+u.email;u.fullName=r.fullName||u.email;u.displayName=u.fullName;o.push(u)}}}})}o=n.uniq(o,false,function(e){return e.email});o=n.map(o,a.updateContact,a);r(o);return o},function(){r(null);return null})},queryContacts:function(e,t,n){s.Contacts.makeContactRequest("contacts/search",{query:e,limit:n},function(n){var i=n||[];i=i.sortBy(function(t){return-1*(t.fullName.intersectionRatio(e)+t.email.intersectionRatio(e))});t(i)})},getTopContacts:function(e,t){if(h){e(h);return}d.push(e);if(c){return}c=true;s.Contacts.makeContactRequest("contacts/top",{limit:t},function(e){h=e;for(var t=0;t<d.length;t++){d[t](h)}c=false})},getTopContactsInStreak:function(e){return s.Contacts.makeContactRequest("contacts/team/existing",{limit:e})},getTopContactsNotInStreak:function(e){return s.Contacts.makeContactRequest("contacts/team/suggestions",{limit:e})},convertStringData:function(e){var t=null;if(e.isValidEmail()){t={id:e,fullName:e,email:e}}else{t={id:e,fullName:e}}return t},convertResultToLiElement:function(e,n){var i=t(s.Contacts.suggestionTemplate({image:n.imageUrl,name:n.fullName?n.fullName.escapeHTML():n.email,tag:n.fullName?n.email:"&nbsp;"}));return i},compareContactAndQuery:function(e,t){var n=false;if(t.fullName){n=t.fullName.toLowerCase().indexOf(e)>-1}if(t.email){n=n||t.email.toLowerCase().indexOf(e)>-1}return n},getContact:function(e){if(l[e]){return l[e]}return{email:e}},getLatestContactInformation:function(e,t){var n=l[e];if(!n){n={email:e}}if(n.updatedFromServer){setTimeout(function(){t(n)},10);return}r.GmailRequester.getContactDetails(e).then(function(n){if(n&&n.fullName){n.updatedFromServer=true;s.Contacts.updateContact(n)}t(l[e])},function(){t(n)});return n},updateContact:function(e){var t=e,i;if(e.email){i=l[e.email];t=n.extend({},i,e);l[e.email]=t}return t},getImageURL:function(t){var n=t.imageUrl?t.imageUrl:t.image;n=n?n:e.server+e.combinedPath+"images/unknownContact.png";return n},getContactImage:function(e,t){n.defaults(t,{circle:false});var i=e.displayName||e.fullName||e.email;var r=s.Contacts.getImageURL(e);var a=document.createElement("img");a.setAttribute("src",r);a.setAttribute("title",i.escapeHTML());if(t.circle){a.setAttribute("class","streak__circleContactImage")}a.setAttribute("email",e.email);return a},getContactsFromUserKeys:function(e,t){if(!e||e.length===0){t([]);return}var n=[];var i=[];for(var r=0;r<e.length;r++){var a=u[e[r]];if(a){n.push(a)}else{i.push(e[r])}}if(i.length===0){t(n);return}var s=this;o.get("users",{userKeyList:JSON.stringify(i)}).getPromise().then(function(e){if(!e){t(n);return}for(var r=0;r<e.length;r++){var a=e[r];var o={imageUrl:a.googleProfilePhotoUrl,email:a.email,displayName:a.displayName,fullName:a.googleProfileFullName};o=s.updateContact(o);u[i[r]]=o;n.push(o)}t(n)})},getGravatarURL:function(t){t=t||"";var n=e.CryptoJS.MD5(t.trim().toLowerCase()).toString();return"https://www.gravatar.com/avatar/"+n+"?r=g&s=32"}};e.DependencyManager.addFunction({functionKey:"contactsInitialized",functionToCall:s.Contacts.init,functionContext:s.Contacts,dependentFunctionKeys:["htmlLoaded","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox;i.Cursor={defaults:{selectedClass:"selected",highlightClass:null,selectFunc:t.noop,highlightFunc:t.noop,dimensions:1,highlightOnHover:false,highlightOnClick:false,selectOnClick:false,rollOver:false,input:null,noScroll:false,scrollStop:null,positionChangeFunc:t.noop,textSearch:false,aggressiveInputCapture:false},create:function(e){var n={};t.extend(n,this.defaults,e);if(!n.highlightClass){n.highlightClass=n.selectedClass}return new this.impl(n)},impl:function(r){var a=null,o=null,s=null,l=false,u=function(e){var n,i;if(e&&a){if(r.dimensions<2){if(a[0]>=o.length){a[0]=o.length-1}}else{try{if(a[0]>=o.length){a[0]=o.length-1}else if(a[1]>=o[a[0]].length){a[1]=o[a[0]].length-1}}catch(s){a=f()}}}else{a=f()}if(r.dimensions===1){for(n=0;n<o.length;n++){c(t(o[n]),[n])}}else if(r.dimensions===2){for(n=0;n<o.length;n++){for(i=0;i<o[n].length;i++){var l=o[n][i];l.setAttribute("cursorPosition",n+","+i)}}}g()},c=function(e,t){e.off(".bbStreakCursor");if(r.highlightOnHover){e.on("mouseenter.bbStreakCursor",function(n){a=t;g(null,e,false,true)});e.on("mouseleave.bbStreakCursor",function(t){e.removeClass(r.selectedClass)})}if(r.highlightOnClick){e.on("click.bbStreakCursor",function(n){g(t,e)})}else if(r.selectOnClick){e.on("click.bbStreakCursor",function(n){g(t,e);y()})}},d=function(){a=f()},h=function(e){if(!o){return null}var n=o;for(var i=0;i<e.length;i++){n=n[e[i]]}if(e.length===r.dimensions){return t(n)}else{return n}},f=function(){var e=new Array(r.dimensions);for(var t=0;t<r.dimensions;t++){e[t]=0}return e},p=function(e,t){if(!t){t=0}if(!o){return}var n=o;if(!a){d()}for(var i=0;i<t;i++){n=n[a[i]]}if(e==="up"){if(a[t]-1<0){if(r.rollOver){a[t]=n.length-1}}else{a[t]=a[t]-1;if(r.dimensions>1&&t===1){var s=h(a.first(1));if(a[t]>=s.length){a[t]=s.length-2}}}}else if(e==="down"){if(a[t]+1>=n.length){if(r.rollOver){a[t]=0}}else{a[t]=a[t]+1}}g(a)},m=function(e){if(e===0){a[0]=0}else{a[e]=0}g(a)},_=function(e){if(e===0){a[0]=o.length-1}else{a[e]=h(a.first(e)).length-1}g(a)},g=function(e,t,i,o){r.positionChangeFunc();if(e){a=e}var l=n.clone(a);if(r.dimensions>1){for(var u=1;u<r.dimensions;u++){var c=h(l.first(u));if(l[u]>=c.length){l[u]=c.length-1}}}if(!t){t=h(l)}S();t.addClass(r.selectedClass);if(!r.noScroll&&!o){if(!t.is(".noScroll")){t.scrollintoview({duration:0,scrollStop:r.scrollStop})}}s=t;if(!i){t.trigger("bbCursorSelect");r.highlightFunc(s)}},v=function(e,t){if(!l){r.selectFunc(e,t)}},y=function(e){if(!a){d()}var t=h(a);if(t){v(t,e)}},w=function(e,t){o=e.slice();u(t)},b=function(e){o=e},C=function(){if(o!==null){g()}},S=function(){if(s){s.removeClass(r.selectedClass);s.trigger("bbCursorDeselect")}},T=function(){return h(a)},x=function(e){var t=e.getAttribute("cursorPosition");if(t&&t.length>0){var n=t.split(",");var i=[parseInt(n[0]),parseInt(n[1])];g(i)}},k=function(){l=true},M=function(){l=false};if(r.input){i.Keyboard.bindChordToEl({el:r.input,chord:"up/down",keyEvent:"keyup",useCapture:true,cb:function(t){if(l){return}t.preventDefault();t.stopImmediatePropagation();t.stopPropagation();if(e.jwerty.is("down",t)){p("down")}else{p("up")}}});i.Keyboard.bindChordToElement(r.input,"home",function(){m(0)},true);i.Keyboard.bindChordToElement(r.input,"end",function(){_(0)},true);i.Keyboard.bindChordToElement(r.input,"enter",function(e){if(!l){y(true);e.preventDefault();e.stopImmediatePropagation()}},false,false,false,"keydown",r.aggressiveInputCapture)}if(r.textSearch){var L=t(document.createElement("input"));L[0].setAttribute("type","text");i.Keyboard.bindChordToElement(r.input,"[a-z]/shift+[a-z]/backspace",function(t){clearTimeout(timeout);if(e.jwerty.is("backspace",t)){L.val(L.val().first(L.val().length-1))}else{L.val(L.val()+String.fromCharCode(t.which))}B();timeout=setTimeout(function(){L.val("")},1e3)},true,true,true);i.Keyboard.bindChordToElement(r.input,"up/down/home/end",function(e){L.val("");if(!l){e.preventDefault();e.stopImmediatePropagation();e.stopPropagation()}});var B=function(){var e=L.val().toLowerCase();t.each(o,function(n,i){if(t(i)[0].innerText.trim().toLowerCase().startsWith(e)){g([n]);return}})}}return{setup:w,getPosition:function(){return a},updatePosition:p,moveToBeginning:m,moveToEnd:_,select:y,focus:C,setPosition:g,setCursorPosition:x,unfocus:S,reset:d,getCell:T,pause:k,resume:M,fastSetup:b}}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox;i.VirtualCursorModel={defaults:{highlightFunc:t.noop,selectFunc:t.noop},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)},impl:function(e){var t=null,i=null,r=null,a=false,o=false,s=[],l={},u={},c={},d=function(){t=[0,0]},h=function(e){if(!t){d()}if(!e){e=n.clone(t)}var i=0;if(r){i=r.getLastRowNumber()}e[0]=Math.min(i,e[0]);var a=0;if(r){a=r.getLastColumnForCurrentRow([e[0],0])}e[1]=Math.min(a,e[1]);return e},f=function(){if(!t){d()}return t},p=function(e,n){this.notToTop=true;if(!n){n=0}if(e==="up"){if(n===1){t=h()}t[n]=Math.max(t[n]-1,0)}else if(e==="down"){t[n]=t[n]+1;if(n===0){t[n]=Math.min(r.getLastRowNumber(),t[n])}else if(n===1){t=h()}}g(t);this.notToTop=false},m=function(e){this.notToTop=true;h();if(e===0){t[0]=0}else{t[e]=0}g();this.notToTop=false},_=function(e){this.notToTop=true;h();if(e===0){t[0]=r.getLastRowNumber()}else{t[e]=r.getLastColumnForCurrentRow(t)}g();this.notToTop=false},g=function(r){if(r){t=r}var a=h();b();i=n.clone(a);e.highlightFunc(a)},v=function(){e.selectFunc(h())},y=function(e){r=e;if(!t){d()}u={};c={}},w=function(){if(r!==null){g()}},b=function(){if(i){e.unhighlightFunc(h(i))}},C=function(){a=true},S=function(){a=false},T=function(e,t){return e[0]===t[0]&&e[1]===t[1]},x=function(e){l[e]=true},k=function(){var e=[];n.each(l,function(t,n){e.push(n)});return e},M=function(e,t){u[e]=[t];x(t)},L=function(e,t){x(t);if(n.isUndefined(u[e])){u[e]=[]}u[e]=n.union(u[e],[t]);if(n.isUndefined(c[t])){c[t]=[]}c[t]=n.unionPlus(c[t],[e],T)},B=function(e){s.push(e);x(e.cssClass)},E=function(e){s=n.filter(s,function(t){return t.cssClass!==e})},D=function(){return s},V=function(e,t){x(e);var i=c[e];if(!i){i=[]}n.each(t,function(t){if(u[t]===undefined){u[t]=[]}if(!n.contains(u[t],e)){u[t].push(e)}});c[e]=n.unionPlus(i,t,T)},I=function(e){u[e]=[]},P=function(e,t){u[e]=n.without(u[e],t);c[t]=n.withoutPlus(c[t],e,T)},A=function(e){n.each(c[e],function(t){var i=u[t];if(!n.isEmpty(i)){u[t]=i.removeVal(e)}});c[e]=[]},F=function(e){var t=u[e]||[];t=t.concat(O(e));return t.join(" ")},O=function(e){var t=n.filter(s,function(t){return R(t,e)});var i=n.pluck(t,"cssClass");n.each(t,function(t){if(e[0]===t.startCoord[0]){i.push("streak__cursorRangeTop")}if(e[0]===t.endCoord[0]){i.push("streak__cursorRangeBottom")}if(e[1]===t.startCoord[1]){i.push("streak__cursorRangeLeft")}if(e[1]===t.endCoord[1]){i.push("streak__cursorRangeRight")}});return i},R=function(e,t){var n=e.startCoord;var i=e.endCoord;return t[0]>=n[0]&&t[1]>=n[1]&&t[0]<=i[0]&&t[1]<=i[1]};return{setup:y,updatePosition:p,moveToBeginning:m,moveToEnd:_,select:v,focus:w,setPosition:g,unfocus:b,reset:d,pause:C,resume:S,getPosition:h,getRawPosition:f,addCoordinateClass:L,updateDisplay:g,getClassesPrettyString:F,removeCoordinateClass:P,removeAllCoordinateClasses:I,removeClassForAllCoordinates:A,getActiveClasses:k,setCoordinateClass:M,addCursorRange:B,removeCursorRange:E,getCursorRanges:D,addClassToCoordinates:V}}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadStorer",superclass:e.Object,_memberVariables:[{name:"_hexGmailThreadIdMap",destroy:true,defaultValue:{}},{name:"_transactionId",destroy:true,defaultValue:"threadStorer"},{name:"_isInTransaction",destroy:true,defaultValue:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._transactionId="ThreadStorer"},startTransaction:function(){this._isInTransaction=true;l.startTransaction(this._transactionId)},endTransaction:function(){this._isInTransaction=false;l.endTransaction(this._transactionId)},getGmailThread:function(e){return this._getValue(e,h.GMAIL_THREAD)},getBoxKey:function(e){return this._getValue(e,h.BOX_KEY)},getReminderBoxKey:function(e){return this._getValue(e,h.REMINDER_BOX_KEY)},getSendLater:function(e){return this._getValue(e,h.SEND_LATER)},getThreadMetaData:function(e){return this._getValue(e,h.THREAD_META_DATA)},getTrackedThread:function(e){return this._getValue(e,h.TRACKED_THREAD)},getLastThreadInfoTimestamp:function(e){return this._getValue(e,h.LAST_THREAD_INFO_TIMESTAMP)},getBumpLaterCollection:function(e){return this._getValue(e,h.BUMP_LATER_COLLECTION)},getGmailThreadList:function(e,t){return this._getValueList(e,h.GMAIL_THREAD)},getBoxKeyList:function(e){return this._getValueList(e,h.BOX_KEY)},getReminderBoxKeyList:function(e){return this._getValueList(e,h.REMINDER_BOX_KEY)},getSendLaterList:function(e){return this._getValueList(e,h.SEND_LATER)},getThreadMetaDataList:function(e){return this._getValueList(e,h.THREAD_META_DATA)},getTrackedThreadList:function(e){return this._getValueList(e,h.TRACKED_THREAD)},getLastThreadInfoTimestampList:function(e){return this._getValueList(e,h.LAST_THREAD_INFO_TIMESTAMP)},getBumpLaterCollectionList:function(e){return this._getValueList(e,h.BUMP_LATER_COLLECTION)},_getValue:function(e,t){if(!this._hexGmailThreadIdMap[e]){return null}if(!this._hexGmailThreadIdMap[e][t]){return null}return this._hexGmailThreadIdMap[e][t]},_getValueList:function(e,t){var n=[];for(var i=0;i<e.length;i++){n.push(this._getValue(e[i],t))}return n},getAllValues:function(e){if(!this._hexGmailThreadIdMap[e]){return null}return this._hexGmailThreadIdMap[e]},getAllThreadMetaData:function(){return this._getAll(h.THREAD_META_DATA)},getAllBumpLaterCollections:function(){return this._getAll(h.BUMP_LATER_COLLECTION)},_getAll:function(e){var t=[];for(var n in this._hexGmailThreadIdMap){var i=this._hexGmailThreadIdMap[n];if(i[e]){t.push(i[e])}}return t},setGmailThread:function(e,t){this._setValue(e,h.GMAIL_THREAD,t)},setBoxKey:function(e,t){this._setValue(e,h.BOX_KEY,t)},setThreadMetaData:function(e,t){this._setValue(e,h.THREAD_META_DATA,t)},setReminderBoxKey:function(e,t){this._setValue(e,h.REMINDER_BOX_KEY,t)},setSendLater:function(e,t){this._setValue(e,h.SEND_LATER,t)},setTrackedThread:function(e,t){this._setValue(e,h.TRACKED_THREAD,t)},setLastThreadInfoTimestamp:function(e,t){this._setValue(e,h.LAST_THREAD_INFO_TIMESTAMP,t)},setBumpLaterCollection:function(e,t){this._setValue(e,h.BUMP_LATER_COLLECTION,t)},_setValue:function(e,t,n){this._initializeMapFor(e,t);this._hexGmailThreadIdMap[e][t]=n;this._postNotification(e,t,n)},removeThreadMetaData:function(e){this._removeValue(e,h.THREAD_META_DATA)},removeGmailThread:function(e){this._removeValue(e,h.GMAIL_THREAD)},removeBoxKey:function(e){this._removeValue(e,h.BOX_KEY)},removeReminderBoxKey:function(e){this._removeValue(e,h.REMINDER_BOX_KEY)},removeSendLater:function(e){this._removeValue(e,h.SEND_LATER)},removeTrackedThread:function(e){this._removeValue(e,h.TRACKED_THREAD)},removeLastThreadInfoTimestamp:function(e){this._removeValue(e,h.LAST_THREAD_INFO_TIMESTAMP)},removeBumpLaterCollection:function(e){this._removeValue(e,h,BUMP_LATER_COLLECTION)},_removeValue:function(e,t,n){if(!this._hexGmailThreadIdMap[e]){return}if(!this._hexGmailThreadIdMap[e][t]){return}delete this._hexGmailThreadIdMap[e][t];this._postNotification(e,t,null)},_initializeMapFor:function(e,t){if(!this._hexGmailThreadIdMap[e]){this._hexGmailThreadIdMap[e]={}}},_postNotification:function(e,t,n){l.postNotification({eventName:"threadStorerDataChanged",hexGmailThreadId:e,valueType:t,value:n,sender:this,transactionId:this._isInTransaction?this._transactionId:null})}});var h={GMAIL_THREAD:"gmailThread",THREAD_META_DATA:"threadMetaData",SEND_LATER:"sendLater",BOX_KEY:"boxKey",REMINDER_BOX_KEY:"reminderBoxKey",TRACKED_THREAD:"trackedThread",LAST_THREAD_INFO_TIMESTAMP:"lastThreadInfoTimestamp",BUMP_LATER_COLLECTION:"bumpLaterCollection"};i.set("BentoBox.Services.Threads.ThreadStorer",new d);u.notifyFunctionFinished("threadsInitialized")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HexGmailThreadIdExtractor",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getHexGmailThreadIdList:function(e){var t=[];var i=c.Services.Threads.ThreadStorer.getAllThreadMetaData();i=n.sortBy(i,"timestamp").reverse();var r=n.map(e,this._extractMetaDataFrom.bind(this));var a={};for(var o=0;o<r.length;o++){var s=r[o];s.uniqueKey=s.subject+s.emailString+s.date;var l=this._findHexGmailThreadIdFor(s,i,a);t.push(l);if(l){a[s.uniqueKey]=(a[s.uniqueKey]||0)+1}}return t},_extractMetaDataFrom:function(e){if(!e){return{}}if(e.type==="vertical"){return this._extractMetaDataFromVerticalPreviewPaneRow(e)}var n=e.rowNode;var i={};var r=n.find("td").filter(":last");var a=r.find("span");if(a&&a.length>0){i.timeString=a.attr("title");i.date=t.cleanString(a[0].innerHTML)}else{i.timeString="";i.date=""}if(e.subjectLink&&e.subjectLink.length>0){var o=e.subjectLink.find("span[id]");i.subject=o[0].textContent.stripNonPrintableCharacters();i.isUnread=o[0].innerHTML.indexOf("<b>")>-1}else{i.subject="";i.isUnread=false}if(n.find(".y2").length>0){var s=t.cleanString(n.find(".y2").cleanText()).trim();if(s[0]==="-"){s=s.substring(1).trim()}i.bodyString=s}else{i.bodyString=""}i.names=[];i.emailAddresses=[];i.emailString="";n.find("span[email]").each(function(e,n){i.names.push(t(n)[0].innerHTML);i.emailAddresses.push(t(n).attr("email"))});if(i.emailAddresses.length>0){i.emailString=n.find("span[email]").closest("td").find("div.yW")[0].innerHTML.replace(/zF|yP/,"")}if(n.find("[streakthreadid]").length>0){i.hexGmailThreadId=n.find("[streakthreadid]").attr("streakthreadid")}if(n.find("[title*=streakthreadid]").length>0){i.hexGmailThreadId=n.find("[title*=streakthreadid]")[0].title.split(" ")[1]}return i},_extractMetaDataFromVerticalPreviewPaneRow:function(e){var n={};var i=e.node;if(!i||i.length<2){return n}if(i[0].find("td.apt .apm span").length>0){n.timeString=i[0].find("td.apt .apm span").attr("title");n.date=t.cleanString(i[0].find("td.apt .apm span")[0].innerHTML)}var r=i[1].find("td[role=link] span[id]");n.subject=r[0].textContent.stripNonPrintableCharacters();n.isUnread=r[0].innerHTML.indexOf("<b>")>-1;if(i.length<3){n.bodyString=""}else if(i[2].find(".y2").length>0){n.bodyString=t.cleanText(i[2].find(".y2").cleanText())}n.names=[];n.emailAddresses=[];n.emailString="";i[0].find("span[email]").each(function(e,i){n.names.push(t(i)[0].innerHTML);n.emailAddresses.push(t(i).attr("email"))});if(n.emailAddresses.length>0){n.emailString=i[0].find("span[email]").closest("div")[0].innerHTML.replace(/zF|yP/,"")}if(i[0].find("[streakthreadid]").length>0){n.threadGmailId=i[0].find("[streakthreadid]").attr("streakthreadid")}return n},_findHexGmailThreadIdFor:function(e,t,n){if(e.hexGmailThreadId){return e.hexGmailThreadId}var i=this._filterThreadMetaDataOn(t,"subject",e.subject);if(i.length===0){return null}if(i.length===1){return i[0].hexGmailThreadId}i=this._filterThreadMetaDataOn(i,"emailString",e.emailString);if(i.length===0){return null}if(i.length===1){return i[0].hexGmailThreadId}i=this._filterThreadMetaDataOn(i,"date",e.date);if(i.length===0){return null}if(i.length===1){return i[0].hexGmailThreadId}if(!n[e.uniqueKey]){return i[0].hexGmailThreadId}var r=i[n[e.uniqueKey]];if(r){return r.hexGmailThreadId}return null},_filterThreadMetaDataOn:function(e,t,n){var i=[];for(var r=0;r<e.length;r++){if(e[r][t]===n){i.push(e[r])}}return i},getThreadIdForMessageId:function(e){var t=c.Services.Threads.ThreadStorer.getAllThreadMetaData();var i=n.filter(t,function(t){return n.contains(t.messageIds,e)});if(i.length){return i[0].threadGmailId}return e}});i.set("BentoBox.Services.Threads.HexGmailThreadIdExtractor",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadMetaDataCreator",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},gmailLoaded:function(){this._bindToAjaxRequests();this._bindToConversationLoaded();try{this._processOnPageCrapFormatThreads()}catch(e){c.logError("processing on page threads failed",e)}},processCrapFormatThreads:function(e){if(e){for(var t=0;t<e.length;t++){var n=this.convertToThreadMetaData(e[t]);c.Services.Threads.ThreadStorer.setThreadMetaData(n.hexGmailThreadId,n)}}},convertToThreadMetaData:function(e){var n={threadGmailId:e[0],encodedThreadId:e[0],hexGmailThreadId:e[0],subject:t.domCleanString(e[9]).stripNonPrintableCharacters(),date:t.cleanString(e[14]),timeString:t.cleanString(e[15]),emailString:e[7].replace(/zF|yP/,""),timestamp:e[16]/1e3,isUnread:e[9].indexOf("<b>")>-1,lastEmailAddress:e[28],bodyString:t.cleanString(e[10]),names:[],emailAddresses:[],messageIds:[e[1],e[2]]};var i=t(document.createElement("div"));i[0].innerHTML=n.emailString;i.find("span[email]").each(function(e,i){n.names.push(t(i)[0].innerHTML);n.emailAddresses.push(t(i).attr("email"))});return n},getActiveThreadMetaDataList:function(){var e=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);return c.Services.Threads.ThreadStorer.getThreadMetaDataList(e)},_bindToAjaxRequests:function(){l.subscribe({eventName:"gmail.newThreadListResponse",observer:this,functionToCall:this._handleThreadListResponse})},_handleThreadListResponse:function(e){if(!e.response){return}this._updateThreadStorer(e.response)},_bindToConversationLoaded:function(){r.observe("conversationThreadLoadedEvent",this._handleConversationLoaded.bind(this))},_handleConversationLoaded:function(){var e=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);var n;if(e.length===0||e.length>1){return}n=e[0];var i=c.Services.Threads.ThreadStorer.getThreadMetaData(n);if(i){return}i={};i.hexGmailThreadId=n;i.threadGmailId=n;i.encodedThreadId=n;i.subject=r.getCurrentMain().find(".Bs .ha .hP").text();i.names=[];i.emailAddresses=[];i.bodyString="";i.isUnread=false;var a=r.getCurrentMain().find("table.Bs div.hx span.gD, table.Bs div.hx span.g2");a.each(function(e,n){var r=t(n);var a=r.attr("email");if(a){if(r.isVisible()){i.names.push(r.text());i.emailAddresses.push(a)}}});c.Services.Threads.ThreadStorer.setThreadMetaData(i.hexGmailThreadId,i)},_processOnPageCrapFormatThreads:function(){var e=this._getOnPageThreadResponseString();if(!e){return}e=e.replace(/.*var VIEW_DATA=/,"").replace(/;var GM_TIMING.*/,"");this._updateThreadStorer(e)},_getOnPageThreadResponseString:function(){var e=t("script");var n=/var VIEW_DATA\=\[\[/;for(var i=0;i<e.length;i++){var r=e[i];if(r.src){continue}var a=r.innerHTML;if(n.test(a)){return a}}return null},_updateThreadStorer:function(e){this.processCrapFormatThreads(r.ThreadResponseProcessor.extractThreads(e))}});i.set("BentoBox.Services.Threads.ThreadMetaDataCreator",new d);e.DependencyManager.addFunction({functionKey:"threadMetaDataCreatorInitialized",functionReference:c.Services.Threads.ThreadMetaDataCreator.gmailLoaded,functionContext:c.Services.Threads.ThreadMetaDataCreator,dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SentEmailsMetaDataManager",superclass:e.Object,_memberVariables:[{name:"_sentEmailPollingChecker",destroy:true},{name:"_sentEmailsPollingFor",destroy:true,defaultValue:[]},{name:"_isCurrentlyPolling",destroy:true,defaultValue:false},{name:"_lastSentThreadMetaData",destroy:false,get:true}],_initialize:function(){e.Object.prototype._initialize.call(this);l.subscribe({eventName:"gmail.emailSent",observer:this,functionToCall:this._handleEmailSent})},_handleEmailSent:function(e){var t=e.response;if(!e.requestParameters||!e.requestParameters.composeid){return}var n=e.requestParameters.composeid;if(!this._areSubscribersInterestedInThreadId(n)||!this._areSubscribersInterestedInRfcMessageId(n)){this._postNotificationAllMetaDataRetrieved(n);return}var i=this._tryToExtractMessageIdFrom(t);if(i){this._getHexGmailThreadIdBySearching(i,e.requestParameters);return}this._getHexGmailThreadIdByPolling(e.requestParameters)},_areSubscribersInterestedInThreadId:function(e){return l.areThereSubscribers({eventName:"hexGmailThreadIdForSentEmailFound",composeid:e})},_areSubscribersInterestedInRfcMessageId:function(e){return l.areThereSubscribers({eventName:"rfcMessageIdForSentEmailFound",composeid:e})},_tryToExtractMessageIdFrom:function(e){var t;try{t=r.ThreadResponseProcessor.extractMessageIdFromSentEmail(e)}catch(n){var i="could not extract messageId";try{e=JSON.stringify(r.ThreadResponseProcessor.deserialize(e))}catch(a){i+="\n not parsed"}i+="\n"+e;c.logError(i,n);return}return t},_getHexGmailThreadIdBySearching:function(e,t){var n=this;
this._getCrapFormatThread(e,function(e){var i;try{i=r.ThreadResponseProcessor.extractHexGmailThreadIdFromMessageIdSearch(e)}catch(a){}if(i){var o=n._extractThreadMetaData(i,t);n._registerSentEmail(o);return}n._getHexGmailThreadIdByPolling(t)})},_getCrapFormatThread:function(e,t){r.GmailRequester.getThread(e,t,function(){t(null)})},_registerSentEmail:function(e){c.Services.Threads.ThreadStorer.setThreadMetaData(e.hexGmailThreadId,e);l.postNotification({eventName:"hexGmailThreadIdForSentEmailFound",sender:this,hexGmailThreadId:e.hexGmailThreadId,composeid:e.composeid,threadMetaData:e});this._lastSentThreadMetaData=e;if(this._areSubscribersInterestedInRfcMessageId(e.composeid)){this._getRfcMessageIdForThread(e)}else{this._postNotificationAllMetaDataRetrieved(e)}},_extractThreadMetaData:function(e,t){var n={threadGmailId:e,encodedThreadId:e,hexGmailThreadId:e,subject:t.subject,emailAddresses:this._extractEmails(t),names:this._extractNames(t),draft:t.draft,composeid:t.composeid};return n},_extractNames:function(e){var t=this._extractRecipients(e);var i=this;var r=[];n.each(t,function(e){if(e.length>0){var t=e.indexOf("<");var n=e.substring(0,t);r.push(n)}});return r},_extractEmails:function(e){var t=this._extractRecipients(e);var i=this;var r=[];n.each(t,function(e){if(e.length===0){return}if(e.indexOf("<")<0){r.push(e)}else{var t=/\<.+?\>/g.exec(e);if(n.isReal(t)&&t.length>0){var i=t[t.length-1];i=i.substring(1,i.length-1);r.push(i)}}});return r},_extractRecipients:function(e){var t=[];if(n.isArray(e.to)){t=t.concat(e.to)}if(n.isArray(e.cc)){t=t.concat(e.cc)}if(n.isArray(e.bcc)){t=t.concat(e.bcc)}return t},_getHexGmailThreadIdByPolling:function(e){if(e.rm!=="undefined"&&e.rm!==""){return}e.timestamp=a.now();this._sentEmailPollingChecker=0;this._sentEmailsPollingFor.push(e);if(!this._isCurrentlyPolling){this._startPolling()}},_startPolling:function(){this._isCurrentlyPolling=true;this._checkSentMail()},_checkSentMail:function(){var e=this;r.GmailRequester.getSentMail(function(t){if(e._sentEmailPollingChecker>10){e._logSentEmailsCantBeFound(t)}else{e._processSentMailResponse(t)}})},_logSentEmailsCantBeFound:function(e){var t="sent emails couldn't be found";if(self._sentEmailPollingFor){for(var n=0;n<self._sentEmailsPollingFor.length;n++){var i=self._sentEmailsPollingFor[n];if(!i.found){t+="\n email subject: "+i.subject;t+=" | to: "+JSON.stringify(i.to);t+=" | timestamp: "+i.timestamp}}}c.logError(t);self._resetPolling()},_resetPolling:function(){this._sentEmailsPollingFor.length=0;this._sentEmailPollingChecker=0;this._isCurrentlyPolling=false},_processSentMailResponse:function(e){if(!e){return}var t=r.ThreadResponseProcessor.extractThreads(e);var i=[];for(var a=0;a<t.length;a++){i.push(c.Services.Threads.ThreadMetaDataCreator.convertToThreadMetaData(t[a]))}if(!i||i.length===0){return}var o=0;for(var a=0;a<this._sentEmailsPollingFor.length;a++){var s=this._sentEmailsPollingFor[a];for(var l=0;l<i.length;l++){if(this._compareSentMail(i[l],s)){var u=i[l];i.removeAt(l);if(!s.found){u.draft=s.draft;u.composeid=s.composeid;u.names=this._extractNames(s);u.emailAddresses=this._extractEmails(s);this._registerSentEmail(u)}s.found=true;o++;break}}}if(o===this._sentEmailsPollingFor.length){this._resetPolling();return}this._sentEmailPollingChecker++;setTimeout(n.bind(this._checkSentMail,this),2e3)},_compareSentMail:function(i,r){var a=false;var o=t.domCleanString(e.cleanupEmailSubject(r.subject)).removeWhitespace();if(o===t.domCleanString(e.cleanupEmailSubject(i.subject)).removeWhitespace()){a=true}if(o.trim().length===0){if(i.subject.match(/^\((\s|\w)*?\)$/)){a=true}}if(a){if(n.isArray(r.to)){for(var s=0;s<r.to.length;s++){if(this._compareEmailAddresses(r.to[s],i.emailString)){var l=this._compareTimestamps(r.timestamp,i.timestamp);if(l){return true}else{c.Logger.log("timestamps not matched")}}}c.Logger.log("array to not matched");return false}else{var u=this._compareEmailAddresses(r.to,i.emailString);if(u){var l=this._compareTimestamps(r.timestamp,i.timestamp);if(l){return true}else{c.Logger.log("timestamps not matched")}}c.Logger.log("single email not matched");return false}}else{c.Logger.log("subject not matched")}return false},_compareEmailAddresses:function(e,t){if(!e||!t){return false}var n=e.match(/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/gi);if(n&&n.length>0){for(var i=0;i<n.length;i++){var r=n[i].toLowerCase();if(t.toLowerCase().indexOf(r)>-1){return true}}}else{return false}return false},_compareTimestamps:function(e,t){var n=a.create(e);var i=a.create(t);return Math.abs(n.minutesSince(i))<4},_getRfcMessageIdForThread:function(e){var t=this;r.RFCMessageIdExtractor.getRFCMessageIdForThread(e.hexGmailThreadId,function(n){if(n){e.rfcMessageId=n;l.postNotification({eventName:"rfcMessageIdForSentEmailFound",sender:t,hexGmailThreadId:e.hexGmailThreadId,rfcMessageId:n,composeid:e.composeid,threadMetaData:e})}t._postNotificationAllMetaDataRetrieved(e)})},_postNotificationAllMetaDataRetrieved:function(e){l.postNotification({eventName:"allMetaDataRetrievedForCompose",sender:this,composeid:e.composeid,threadMetaData:e})}});e.DependencyManager.addFunction({functionKey:"sentEmailsMetaDataManagerInitialized",functionReference:function(){i.set("BentoBox.Services.Threads.SentEmailsMetaDataManager",new d)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadInfoRequestOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_hexGmailThreadId",destroy:false,get:true}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);this._hexGmailThreadId=t.hexGmailThreadId;this._dependentOnTags=this._getDependentOnTags()},getMethod:function(){return"POST"},getParams:function(){return{url:"threadinfo",hexGmailThreadId:this._hexGmailThreadId}},_getDependentOnTags:function(){return["gmailThread_hexGmailThreadId_"+this._hexGmailThreadId]},_handleError:function(e){var t=e&&e.response;var n=e&&e.xhr;switch(n&&n.status){case 0:case 500:this._backoffAndExecuteAjaxRequest();return}this._response=t;this._xhr=n;this._broadcastErrorNotification();this._failureCallback(this)},_broadcastErrorNotification:function(){switch(this._xhr&&this._xhr.status){case 401:e.NotificationCenter.postNotification({eventName:"unauthorizedRequest",sender:this});break}}});i.set("BentoBox.Services.Threads.ThreadInfoRequestOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadInfoListRequestOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_hexGmailThreadIdList",destroy:false}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);this._hexGmailThreadIdList=t.hexGmailThreadIdList},getMethod:function(){return"POST"},getParams:function(){return{url:"threadinfo",hexGmailThreadIdList:JSON.stringify(this._hexGmailThreadIdList)}},_handleError:function(e){var t=e&&e.response;var n=e&&e.xhr;switch(n&&n.status){case 0:case 500:this._backoffAndExecuteAjaxRequest();return}this._response=t;this._xhr=n;this._broadcastErrorNotification();this._failureCallback(this)},_broadcastErrorNotification:function(){switch(this._xhr&&this._xhr.status){case 401:e.NotificationCenter.postNotification({eventName:"unauthorizedRequest",sender:this});break}}});i.set("BentoBox.Services.Threads.ThreadInfoListRequestOperation",d)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=5*60*1e3;var h;var f=e.Class.subclass({className:"ThreadInfoOperationManager",superclass:e.Operations.OperationStatusChangeHandler,_memberVariables:[],gmailLoaded:function(){h=c.Services.Threads.ThreadStorer;this._bindToDOMEvents();if(r.isConversation()){this._getSingleThreadDataFromServer(r.getConversationId())}else{this._getThreadDataFromServer(c.Services.Threads.HexGmailThreadIdExtractor.getHexGmailThreadIdList(r.getThreadDOMRows()))}},refreshHexGmailThreadId:function(e){this._getSingleThreadDataFromServer(e)},updateThreadStorerTrackedThreadFor:function(e,t){this._updateThreadStorerTrackedThreadFor(e,t)},_bindToDOMEvents:function(){l.subscribe({eventName:"gmail.conversationThreadLoaded",observer:this,functionToCall:this._handleConversationLoaded});l.subscribe({eventName:"gmail.newThreadDOMRows",observer:this,functionToCall:this._handleNewThreadDOMRows})},_handleConversationLoaded:function(e){if(r.isPreviewPaneConversation()){this._handlePreviewConversationLoaded();return}if(r.isConversation()){this._getSingleThreadDataFromServer(r.getConversationId());return}},_handlePreviewConversationLoaded:function(){var e=r.getPreviewedThreadDOMRow();var t=c.Services.Threads.HexGmailThreadIdExtractor.getHexGmailThreadIdList([e]);this._getSingleThreadDataFromServer(t[0])},_getSingleThreadDataFromServer:function(t){var n=this._createThreadInfoRequestOperation(t);var i=this;e.Operations.OperationQueue.Singleton.addOperation(n,i)},_createThreadInfoRequestOperation:function(e){return new c.Services.Threads.ThreadInfoRequestOperation({hexGmailThreadId:e})},_handleNewThreadDOMRows:function(e){var t=c.Services.Threads.HexGmailThreadIdExtractor.getHexGmailThreadIdList(e.threadDOMRows);if(r.isDrafts()){this._getSendLatersFromServer(t);return}t=this._filterOutRecentlyUpdated(t);if(t.length===0){return}this._getThreadDataFromServer(t)},_filterOutRecentlyUpdated:function(e){var t=h.getLastThreadInfoTimestampList(e);var i=[];for(var r=0;r<e.length;r++){var a=e[r];var o=t[r];if(o&&n.isDate(o)&&Math.abs(o.millisecondsFromNow())<d){continue}i.push(a)}return i},_getThreadDataFromServer:function(t){if(!t||t.length===0){return}var n=this._createThreadInfoListRequestOperation(t);var i=this;e.Operations.OperationQueue.Singleton.addOperation(n,i)},_createThreadInfoListRequestOperation:function(e){return new c.Services.Threads.ThreadInfoListRequestOperation({hexGmailThreadIdList:e})},_operationSucceeded:function(e){if(e instanceof c.Services.Threads.ThreadInfoRequestOperation){this._singleThreadDataSucceeded(e);return}var t=e.getResponse();this._updateThreadStorer(t,e)},_singleThreadDataSucceeded:function(t){var n=t.getHexGmailThreadId();var i=e.Operations.OperationQueue.Singleton.queryOperationQueue({containsTags:["gmailThread_hexGmailThreadId_"+n],afterOperation:t});var r=t.getResponse();if(i.length===0){this._updateThreadStorerGmailThreadFor(n,r.gmailThread);this._updateThreadStorerBoxKeyFor(n,r)}this._updateThreadStorerTrackedThreadFor(n,r.trackedThread);this._updateThreadStorerBumpLaterFor(n,r.bumpLaters)},_operationFailed:function(e){},_updateThreadStorer:function(e,t){h.startTransaction();var n=this._getHexGmailThreadIdToPendingStatusOperationMap(e,t);for(var i in e){if(n[i]){continue}this._updateThreadStorerFor(i,e[i])}h.endTransaction()},_getHexGmailThreadIdToPendingStatusOperationMap:function(t,i){var r=n.chain(t).keys().map(function(e){return"gmailThread_hexGmailThreadId_"+e}).value();var a=e.Operations.OperationQueue.Singleton.queryOperationQueue({containsTags:r,afterOperation:i});var o={};for(var s=0;s<a.length;s++){o[a[s].getModel().get("hexGmailThreadId")]=true}return o},_updateThreadStorerFor:function(e,t){this._updateThreadStorerGmailThreadFor(e,t.gmailThread);this._updateThreadStorerBoxKeyFor(e,t);this._updateThreadStorerTrackedThreadFor(e,t.trackedThread);this._updateThreadStorerBumpLaterFor(e,t.bumpLaters);this._updateLastThreadInfoTimestampFor(e)},_updateThreadStorerGmailThreadFor:function(t,n){var i=h.getGmailThread(t);if(!i&&n){var r=c.Models.GmailThread.create(n);c.Data.getAllGmailThreads().add(r);return}if(i&&!n){c.Data.getAllGmailThreads().remove(i);return}if(i&&n){e.Operations.ModelOperationManager.Singleton.updateModel(i,n)}},_updateThreadStorerBoxKeyFor:function(t,n){var i=false;if(n.box){var r=c.Data.getBox(n.box.boxKey);if(r){e.Operations.ModelOperationManager.Singleton.updateModel(r,n.box,null,true)}else{c.Data.addBox(n.box);i=true}}var a=h.getBoxKey(t);var o=n.boxKey;if(!o&&n.box){o=n.box.boxKey}if(a&&!o){h.removeBoxKey(t);return}if(!a&&!o){return}if(a!==o||i){h.setBoxKey(t,o)}},_updateThreadStorerTrackedThreadFor:function(e,t){if(!t){return}var i=h.getTrackedThread(e);var r=n.extend({},i,t);h.setTrackedThread(e,r)},_getSendLatersFromServer:function(t){var n=this;e.APIRequester.get("sendlaters",{hexGmailThreadIdList:JSON.stringify(t)}).getPromise().then(function(e){n._handleSendLatersFromServer(e,t)})},_handleSendLatersFromServer:function(e,t){if(!e||e.error){return}for(var n=0;n<e.length;n++){var i=c.Models.SendLater.create(e[n]);c.Data.getAllSendLaters().add(i)}},_updateThreadStorerBumpLaterFor:function(t,i){if(i&&!n.isArray(i)){i=[i]}var r=h.getBumpLaterCollection(t);if(!r||r.length===0){if(!i||i.length===0){return}r=c.Models.BumpLater.createCollection()}if(!i){i=[]}e.Operations.CollectionOperationManager.Singleton.updateCollectionWithResponse(r,i);h.setBumpLaterCollection(t,r)},_updateLastThreadInfoTimestampFor:function(e){h.setLastThreadInfoTimestamp(e,a.create())}});i.set("BentoBox.Services.Threads.ThreadInfoOperationManager",new f);e.DependencyManager.addFunction({functionKey:"threadInfoOperationManagerInitialized",functionReference:c.Services.Threads.ThreadInfoOperationManager.gmailLoaded,functionContext:c.Services.Threads.ThreadInfoOperationManager,dependentFunctionKeys:["threadMetaDataCreatorInitialized","userLoggedIn","bentoBox.triggerFirstGmailViewChange","threadsInitialized"]})})(Streak);(function(e){var t=e._,n=e.Date,i=e.BentoBox,r=e.APIRequester;var a={MAX_BACKOFF:10*60*1e3,SETUP_MAX_BACKOFF:10*60*1e3};i.Realtime={active:true,initialized:false,connectDelay:4e3,setupDelay:4e3,handlers:{},connectTimeout:null,setupTimeout:null,heartbeatArrived:false,heartbeatTimer:null,heartbeatData:null,currentConnectionTime:null,tokenRefreshTimer:null,init:function(e){var t=this;if(!this.initialized){this.setupObservers();this.setupChannelFramework();this.initialized=true;i.bind("reup",function(){t.connectChannel()})}if(e){e()}},setupObservers:function(){var e=this;this.handlers.open=function(t){e.connectDelay=4e3;e.setupHeartbeat();w()};this.handlers.error=function(e){console.error("realtimedata:",e)};this.handlers.close=function(t){e.setupBackoff()};this.handlers.message=function(t){var n=JSON.parse(t.data);console.log("realtime message: ",n);if(n.hash){e.handleHeartbeat(n.hash);return}switch(n.REALTIME_EVENT){case"DESKTOP_NOTIFICATION":b(n);return;break;case"BATCH_UPDATE":M(n);break}switch(n.entityType){case"Box":o(n);break;case"Pipeline":s(n);break;case"Reminder":u(n);break;case"Comment":l(n);break;case"GmailThread":c(n);break;case"GmailThreadIdentifier":d(n);break;case"Snippet":h(n);break;case"User":f(n);break;case"UserUISettings":p(n);break;default:i.logError("Realtime Error - entityType "+n.entityType+" is not supported yet.");break}};Messenger.observe("channelConnectMessage",function(t){if(e.handlers[t.op]){e.handlers[t.op](t.data)}});Messenger.observe("channelConnectResetTeardown",function(e){});Messenger.observe("channelConnectResetReup",function(t){e.setupChannelFramework()})},setupBackoff:function(){var e=this;this.setupDelay=Math.min(this.setupDelay*2,a.SETUP_MAX_BACKOFF);clearTimeout(this.setupTimeout);this.setupTimeout=setTimeout(function(){if(i.isTornDown()){e.setupBackoff();return}e.connectChannel()},this.setupDelay)},setupChannelFramework:function(){var n=this;Messenger.sendMessage("channelSetup",{src:(e.devRealtimeServer||e.server)+"/_ah/channel/jsapi",isDevServer:t.isReal(e.devRealtimeServer)},"channelSetupReturn",function(){n.connectChannel()})},getToken:function(){var e=this;return r.put("realtime/token").getPromise().then(function(t){e.setupTokenExpiration();return t.message})},setupTokenExpiration:function(){if(this.tokenRefreshTimer){this.tokenRefreshTimer.stop();this.tokenRefreshTimer.start();return}this.tokenRefreshTimer=t.repeatEvery(t.bind(this.backoff,this),179*60*1e3+59*1e3+999,true)},connectChannel:function(){var e=this;this.getToken().then(this._doConnectChannel.bind(this)).catch(function(t){if(!t||!t.xhr||t.xhr.status!==401){i.logError("couldn't get token",t);e.backoff()}})},_doConnectChannel:function(t){if(!t){throw new Error("Missing token")}Messenger.sendMessage("channelConnect",{token:t,server:e.server})},backoff:function(){var e=this;e.connectDelay=Math.min(e.connectDelay*2,a.MAX_BACKOFF);clearTimeout(this.connectTimeout);this.connectTimeout=setTimeout(function(){if(i.isTornDown()){e.backoff();return}e.setupChannelFramework()},e.connectDelay)},setupHeartbeat:function(){var i=this;if(!this.heartbeatTimer){this.heartbeatTimer=t.repeatEvery(function(){i.heartbeatData=Math.random()+"."+n.now();i.heartbeatArrived=false;e.APIRequester.post("realtime/heartbeat",null,{hash:i.heartbeatData},{responseType:"text"}).getPromise().then(function(){setTimeout(function(){if(!i.heartbeatArrived){i.logBadConnection();i.setupChannelFramework()}},120*1e3)})},30*60*1e3,true)}else{this.heartbeatTimer.stop();this.heartbeatTimer.start()}this.currentConnectionTime=n.create()},handleHeartbeat:function(e){if(e===this.heartbeatData){this.heartbeatArrived=true}},logBadConnection:function(){i.Modules.PerformanceModule.recordStat("realtimeConnectionLength",n.create().minutesSince(this.currentConnectionTime))}};var o=function(e){var t;switch(e.REALTIME_EVENT){case"CREATE":t=i.Data.getBox(e.key);if(!t){i.Data.addNewBox(e.key)}break;case"DELETE":t=i.Data.getBox(e.key);if(t){var n=t.get("pipelineKey");t.postNotification("delete")}break;case"UPDATE":t=i.Data.getBox(e.key);if(t){t.refresh()}else{i.Data.addNewBox(e.key)}break}};var s=function(e){var t;switch(e.REALTIME_EVENT){case"NEW_ACL":case"CREATE":case"REMOVE_ACL":i.Data.getAllPipelines().refresh();break;case"DELETE":i.Data.removePipeline(e.key);break;case"COLLABORATORS_MAY_HAVE_CHANGED":case"UPDATE":t=i.Data.getPipeline(e.key);if(t){t.refresh()}else{i.Data.addNewPipeline(e.key)}break;case"UPDATE_CASCADE":t=i.Data.getPipeline(e.key);if(t){i.Data.getPipelineBoxes(e.key).refresh()}else{i.Data.addNewPipeline(e.key)}break;case"CALCULATION_COMPLETE":t=i.Data.getPipeline(e.key);if(!t){return}i.Data.getPipelineBoxes(e.key).refresh(function(){t.postNotification("calculationComplete")});break}};var l=function(e){var t=i.Data.getBox(e.caseKey);if(t){t.postNotification("newComment")}};var u=function(e){var t=i.Data.getBox(e.caseKey);if(t){}};var c=function(e){var t=i.Data.getBox(e.caseKey);if(t){i.Data.getGmailThreadCollectionForBox(t.key()).refresh()}};var d=function(e){if(e.gmailThreadId){i.Services.Threads.ThreadInfoOperationManager.refreshHexGmailThreadId(e.gmailThreadId)}};var h=function(e){switch(e.REALTIME_EVENT){case"CREATE":case"DELETE":i.Data.getAllSnippets().refresh();break;case"UPDATE":var t=i.Data.getSnippet(e.key);if(t){t.refresh()}else{i.Data.getAllSnippets().refresh()}break}};var f=function(e){var t=i.getUser();if(t){t.refresh()}};var p=function(e){i.UserSettings.refresh()};var m=false;var _=[];var g=false;var v=null;var y=false;var w=function(){clearTimeout(g);g=setTimeout(function(){y=false},5*1e3);y=true};var b=function(e){if(!window.Notification){return}if(y){T(e);return}if(i.LocalSettings.get("notifications/desktop/deniedPermission")){return}var t=window.Notification.permission;if(t==="granted"){k(e)}else if(t==="default"){_.push(e);if(!m){m=true;i.Widgets.Modal.create({title:i.Locale.getString("notification_permission_title"),inner:i.Locale.getString("notification_permission_message"),showCancel:false,confirmText:i.Locale.getString("ok"),confirmFunc:function(){window.Notification.requestPermission(x)},cancelFunc:function(){i.LocalSettings.set("notifications/desktop/deniedPermission",true)}}).show()}}};var C=[];var S=null;var T=function(e){if(i.getUser().getDomain().toLowerCase()!=="streak.com"){return}console.log("missed notification",e);C.push(e);clearTimeout(S);S=setTimeout(function(){var e=new window.Notification("Missed Notifications",{body:"You missed "+C.length+" notifications"});C.length=0},5e3)};var x=function(){var e=window.Notification.permission;switch(e){case"granted":for(var t=0;t<_.length;t++){k(_[t])}break;case"denied":_.length=[];break}};var k=function(e){var n=new window.Notification(e.title,{body:e.message,icon:e.photoUrl});n.onclick=function(){i.Tracker.trackStreakActive({eventName:"desktopNotificationClicked",entityType:e.entityType});if(t.isReal(e.entityType)){switch(e.entityType){case"Case":var n=i.Data.getBox(e.key);if(n){Gmail.inboxSDK.Router.goto(n.link())}break;case"Workflow":var r=i.Data.getPipeline(e.key);if(r){Gmail.inboxSDK.Router.goto(r.link())}break;case"GmailThread":i.Data.getGmailThread(e.key,function(e){if(!e){return}if(e.get("isRequestingUserOwner")){i.UI.goToThread(e.key())}else if(e.get("doesRequestingUserHaveThread")){i.UI.goToThread(e.get("requestingUserThreadGmailId"))}else{Gmail.inboxSDK.Router.goto(e.link())}});break;case"EmailThread":if(e.key){i.UI.goToThread(e.key)}break;default:}}};n.onshow=function(){setTimeout(n.close.bind(n),7e3)}};function M(e){i.Models.BoxOperationManager.getBoxesInBatch(e.keys,e.pipelineKey)}e.DependencyManager.addFunction({functionKey:"realtimeInitialized",functionToCall:i.Realtime.init,functionContext:i.Realtime,dependentFunctionKeys:["userLoggedIn"]})})(Streak);Streak.initializeData=function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.APIRequester,o=e.Model,s=e.Collection,l=e.BentoBox;l.Data={};n.extend(l.Data,{pipelines:{list:l.Models.Pipeline.createCollection()},initPipelinesList:function(){var t=this;t.pipelines.list.watch("add",function(e){var n=e.model;if(n.key()){t.pipelines.list.sort(function(e,t){return(e.displayName()>t.displayName())-(e.displayName()<t.displayName())})}},this);t.pipelines.list.watch("remove",function(e){var n=e.model;t.removePipelineBoxes(n.key());l.trigger("change")},this);e.DependencyManager.notifyFunctionFinished("data.pipelines.collectionCreated")},setupPipelineBoxCollection:function(e){var t=this;var n=l.Models.Box.createCollection(e);n.watch("add",function(e){t.boxes.list.add(e.model)},this);n.watch("remove",function(e){t.removeBox(e.model)},this);this.boxes.grouped[e]=n;return n},resetPipeline:function(e){delete self.boxes.grouped[e.key()]},createSimilarPipeline:function(e){var t;var n={name:e.displayNameText()+"*"};var i=[];var a=[];var o=e.getStageNamesText();for(t=0;t<e.getFields().length;t++){i.push(e.getFields()[t].displayNameText());a.push(e.getFields()[t].get("type"))}var s=l.Models.Pipeline.create(n);s.set("stageNames",o);s.set("fieldNames",i);s.set("fieldTypes",a);var u=this;s.save(function(){for(var t=0;t<e.getSystemColumns().length;t++){s.addSystemColumn(e.getSystemColumns()[t],null,null,true)}l.Models.BoxField.copyFieldOptions(e,s);l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.copyColumnOrder(e,s);s.save(function(){l.Data.getAllPipelines().add(s);r.inboxSDK.Router.goto(s.link())})})},createPipelineFromTemplate:function(e,t){e.name=e.name||e.friendlyName;var n=[];var i=[];var r=[];if(e.stageOrder&&e.stageOrder.length>0){for(var a=0;a<e.stageOrder.length;a++){var o=e.stages[e.stageOrder[a]];n.push(o.name)}}for(a=0;a<e.fields.length;a++){var s=e.fields[a];i.push(s.name);r.push(s.type)}var u=l.Models.Pipeline.create({name:e.name,stageNames:n,fieldNames:i,fieldTypes:r});var c=u.save(function(){for(var n=0;n<e.systemProperties.length;n++){u.addSystemColumn({property:e.systemProperties[n]},null,null,true)}u.save(function(){if(t){t(u)}})});l.Data.getAllPipelines().add(u);return c},getPipeline:function(e){return this.pipelines.list.getByKey(e)},getAllPipelines:function(){return this.pipelines.list},addNewPipeline:function(e){var t=this;a.get("pipelines/"+e).getPromise().then(function(e){var n=l.Models.Pipeline.create(e);t.pipelines.list.add(n)})},removePipeline:function(e){if(this.getPipeline(e)){this.getPipeline(e).postNotification("delete");return true}return false},hasSharedPipelines:function(){var e=l.Data.getAllPipelines();if(!e){return false}for(var t=0;t<e.length;t++){if(e[t].get("shareState")!=="PRIVATE"){return true}}return false},numSharedPipelines:function(){var e=l.Data.getAllPipelines();var t=0;if(!e){return 0}for(var n=0;n<e.length;n++){if(e[n].get("shareState")!=="PRIVATE"){return t++}}return t},numBoxesCreatedByCurrentUser:function(){return e._.filter(e.BentoBox.Data.getAllBoxes(),function(t){return t.get("creatorKey")===e.BentoBox.getUser().key()}).length},numBoxesCreatedByCurrentUserThatContainAThread:function(){return e._.filter(e.BentoBox.Data.getAllBoxes(),function(t){return t.get("creatorKey")===e.BentoBox.getUser().key()&&t.get("gmailThreadCount")>0}).length}});n.extend(l.Data,{boxes:{list:l.Models.Box.createCollection(),grouped:{},byHex:{},hexList:{}},addBox:function(e){if(this.getBox(e.boxKey)){}else{if(e.pipelineKey){var t=this.getPipelineBoxes(e.pipelineKey);if(t){var n=l.Models.Box.create(e);t.add(n)}}}},addNewBox:function(e,t){var n=this;a.get("boxes/"+e).getPromise().then(function(e){n.addBox(e)})},getBox:function(e){return this.getAllBoxes().getByKey(e)},initAllBoxes:function(){var e=this.getAllPipelines();for(var t=0;t<e.length;t++){var n=this.getPipelineBoxes(e[t].key());for(var i=0;i<n.length;i++){this.boxes.list.add(n[i])}}},getAllBoxes:function(){return this.boxes.list},getCreatedBoxes:function(){return n.filter(this.boxes.list,function(e){return e.get("creatorKey")===l.getUser().key()})},getPipelineBoxes:function(e){var t=this.boxes.grouped[e];if(!t){this.setupPipelineBoxCollection(e)}return this.boxes.grouped[e]},removePipelineBoxes:function(e){var t=this.getPipelineBoxes(e);this.boxes.list.startTransaction();for(var n=0;n<t.length;n++){this.boxes.list.remove(t[n])}this.boxes.list.endTransaction(true);delete this.boxes.grouped[e]},removeBox:function(e){var t=this;if(t.boxes.grouped[e.get("pipelineKey")]&&t.boxes.grouped[e.get("pipelineKey")].indexOf(e)>=0){t.boxes.grouped[e.get("pipelineKey")].remove(e)}var i=t.boxes.hexList[e.key()];if(i&&i.length>0){n.each(i,function(e){delete t.boxes.byHex[e]});delete t.boxes.hexList[e.key()]}t.boxes.list.remove(e)},createBox:function(e,t){var n=l.Models.Box.create({name:e,pipelineKey:t,stageKey:this.getPipeline(t).getStages()[0].key()});this.getPipelineBoxes(t).add(n);return n.save()}});n.extend(l.Data,{reminders:{grouped:{}},getReminderCollection:function(e){if(!this.reminders.grouped[e]){this.reminders.grouped[e]=l.Models.Reminder.createCollection(e)}return this.reminders.grouped[e]}});n.extend(l.Data,{emailFilters:{grouped:{}},getEmailFilterCollection:function(e){if(!this.emailFilters.grouped[e]){this.emailFilters.grouped[e]=l.Models.EmailFilter.createCollection(e)}return this.emailFilters.grouped[e]}});n.extend(l.Data,{emailFilterBlacklist:null,getEmailFilterBlacklistCollection:function(){if(!n.isReal(this.emailFilterBlacklist)){this.emailFilterBlacklist=l.Models.EmailFilterBlacklist.createCollection()}return this.emailFilterBlacklist}});n.extend(l.Data,{PlanCollection:{all:null,byUser:{},forCurrentUser:null},getPlanCollection:function(){if(!n.isReal(this.PlanCollection.all)){this.PlanCollection.all=l.Models.Plan.createCollection()}return this.PlanCollection.all},getParticipatingPlans:function(e){e=e||{};if(e.userKey){if(!n.isReal(this.PlanCollection.forCurrentUser)){this.PlanCollection.forCurrentUser=l.Models.Plan.getParticipatingPlans()}return this.PlanCollection.forCurrentUser}else{if(!n.isReal(this.PlanCollection.byUser[e.userKey])){this.PlanCollection.byUser[e.userKey]=l.Models.Plan.getParticipatingPlans({userKey:e.userKey})}return this.PlanCollection.byUser[e.userKey]}}});n.extend(l.Data,{PlanInstanceCollection:{byBillingAdmin:{},whereCurrentUserIsBillingAdmin:null},getBillingPlanInstances:function(e){e=e||{};if(e.userKey){if(!n.isReal(this.PlanInstanceCollection.whereCurrentUserIsBillingAdmin)){this.PlanInstanceCollection.whereCurrentUserIsBillingAdmin=l.Models.PlanInstance.getBillingPlanInstances()}return this.PlanInstanceCollection.whereCurrentUserIsBillingAdmin}else{if(!n.isReal(this.PlanInstanceCollection.byBillingAdmin[e.userKey])){this.PlanInstanceCollection.byBillingAdmin[e.userKey]=l.Models.PlanInstance.getBillingPlanInstances({userKey:e.userKey})}return this.PlanInstanceCollection.byBillingAdmin[e.userKey]}}});n.extend(l.Data,{Files:{grouped:{}},getFileGroup:function(e){if(!this.Files.grouped[e]){this.Files.grouped[e]=l.Models.File.createCollection(e)}return this.Files.grouped[e]}});n.extend(l.Data,{gmailThreads:{list:l.Models.GmailThread.createCollection(),grouped:{}},initGmailThreads:function(){var e=this;e.gmailThreads.list.watch("add",function(t){var n=t.model;if(n.get("boxKey")){e.getGmailThreadCollectionForBox(n.get("boxKey")).add(n)}},this)},getAllGmailThreads:function(){return this.gmailThreads.list},createGmailThreadGroup:function(e){this.gmailThreads.grouped[e]=l.Models.GmailThread.createCollection(e)},getGmailThreadCollectionForBox:function(e){if(!this.gmailThreads.grouped[e]){this.gmailThreads.grouped[e]=l.Models.GmailThread.createCollection(e)}return this.gmailThreads.grouped[e]},getGmailThreads:function(e,t,n){var i=this;if(n){return this.gmailThreads.grouped[e]}if(!this.gmailThreads.grouped[e]){this.createGmailThreadGroup(e)}this.gmailThreads.grouped[e].refresh(function(){t(i.gmailThreads.grouped[e])})},getGmailThread:function(e,t,n){var i=this;var r=i.gmailThreads.list.getByKey(e);if(r||n){if(n){return r}else{t(r)}}else{a.get("threads/"+e).getPromise().then(function(e){var n=l.Models.GmailThread.create(e);i.gmailThreads.list.add(n);t(n)})}}});n.extend(l.Data,{sendLaters:{list:l.Models.SendLater.createCollection()},getSendLater:function(e){return this.sendLaters.keyed[e]},newSendLater:function(e){var t=l.Models.SendLater.create(e||{});this.sendLaters.list.add(t);return t},getAllSendLaters:function(){return this.sendLaters.list}});n.extend(l.Data,{snippets:{list:l.Models.Snippet.createCollection(),grouped:{}},initSnippetsList:function(){var e=this;var t="snippets_personal";this.snippets.list.watch("add",function(n){var i=n.model;var r=i.get("pipelineKey");if(!r){r=t}if(!e.snippets.grouped[r]){e.snippets.grouped[r]=[]}e.snippets.grouped[r].push(i)},this);this.snippets.list.watch("remove",function(n){var i=n.model;var r=i.get("pipelineKey");if(!r)r=t;e.snippets.grouped[r].removeVal(i)},this)},getAllSnippets:function(){return this.snippets.list},getSnippet:function(e){return this.snippets.list.getByKey(e)},getSnippetsByPipeline:function(e){return n.filter(this.snippets.list,function(t){return t.get("pipelineKey")===e})},newSnippet:function(e,t){var n=this;var i=l.Models.Snippet.create(e);n.snippets.list.add(i);i.save(function(){if(t){t()}});return i}});n.extend(l.Data,{bumpLaters:{list:l.Models.BumpLater.createCollection()},getBumpLater:function(e){return this.bumpLaters.list.getByKey(e)},getAllBumpLaters:function(){return this.bumpLaters.list}})};Streak.initializeData(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.APIRequester,d=e.BentoBox;var h=e.Class.subclass({className:"DataInitializer",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},setupInitializationProcess:function(){this._initializePipelineData();this._initializeSendLaterData();this._initializeSnippetData();this._initializeGmailThreadsData();this._initializeStreakSettingsData();this._initializeOauth2ScopesData();this._initializeBillingPlans()},_initializePipelineData:function(){d.Data.initPipelinesList();d.Data.pipelines.list.refresh(this._initializePipelineBoxes.bind(this))},_initializePipelineBoxes:function(){var t=[];var n=d.Data.getAllPipelines();if(n.length===0){u.notifyFunctionFinished("data.pipelines.initialized");u.notifyFunctionFinished("data.boxes.initialized");
return}for(var i=0;i<n.length;i++){var r=d.Data.setupPipelineBoxCollection(n[i].key());t.push(r)}var a=e.Collection.refreshAll(t);l.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:a,operationIsComplete:true},functionToCall:this._initializeAllBoxes,observer:this,unsubscribeImmediately:true});u.notifyFunctionFinished("data.pipelines.initialized")},_initializeAllBoxes:function(){d.Data.initAllBoxes();u.notifyFunctionFinished("data.boxes.initialized")},_initializeSendLaterData:function(){var e=d.Data.sendLaters.list.refresh();var t="data.sendLaters.initialized";this._addDataNotificationWatcher(e,t)},_initializeSnippetData:function(){d.Data.initSnippetsList();var e=d.Data.snippets.list.refresh();var t="data.snippets.initialized";this._addDataNotificationWatcher(e,t)},_initializeGmailThreadsData:function(){d.Data.initGmailThreads();u.notifyFunctionFinished("data.gmailThreads.initialized")},_initializeStreakSettingsData:function(){var t=new e.Operations.AjaxRequestOperation({method:"GET",url:"users/me/settings"});var n=e.Operations.OperationQueue.Singleton.addOperation(t);l.subscribe({eventName:"operationProgressUpdate",filterParameters:{operation:t,operationIsComplete:true},functionToCall:function(){d.Data.streakSettings=d.Models.StreakSettings.create(t.getResponse());u.notifyFunctionFinished("data.streakSettings.initialized")},observer:this,unsubscribeImmediately:true})},_initializeOauth2ScopesData:function(){var t=new e.Operations.AjaxRequestOperation({method:"GET",url:"users/me/oauth2scopes"});var n=e.Operations.OperationQueue.Singleton.addOperation(t);l.subscribe({eventName:"operationProgressUpdate",filterParameters:{operation:t,operationIsComplete:true},functionToCall:function(){d.getUser().set("oauth2Scopes",t.getResponse()||[]);u.notifyFunctionFinished("data.oauth2Scopes.initialized")},observer:this,unsubscribeImmediately:true})},_addDataNotificationWatcher:function(e,t){l.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:e,operationIsComplete:true},functionToCall:function(e){if(e.operationProgressStats.isFinished){u.notifyFunctionFinished(t)}},observer:this,unsubscribeImmediately:true})},_initializeBillingPlans:function(){d.Data.getPlanCollection().refresh();d.Data.getBillingPlanInstances().refresh()}});var f=new h;i.set("BentoBox.DataInitializer",f);e.DependencyManager.addFunction({functionKey:"dataInitialized",functionReference:f.setupInitializationProcess,functionContext:f,dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadStorerValueManager",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);this._setupGmailThreadManagement();this._setupSendLaterManagement();this._setupBumpLaterManagement()},_setupGmailThreadManagement:function(){c.Data.getAllGmailThreads().watch("add",this._handleGmailThreadAdded,this);c.Data.getAllGmailThreads().watch("remove",this._handleGmailThreadRemoved,this)},_handleGmailThreadAdded:function(e){var t=e.model.get("requestingUserThreadGmailId");if(!t){t=e.model.get("hexGmailThreadId")||e.model.get("threadGmailId")}c.Services.Threads.ThreadStorer.setGmailThread(t,e.model);c.Services.Threads.ThreadStorer.setBoxKey(t,e.model.get("boxKey"))},_handleGmailThreadRemoved:function(e){var t=e.model.get("hexGmailThreadId")||e.model.get("threadGmailId");c.Services.Threads.ThreadStorer.removeGmailThread(t);c.Services.Threads.ThreadStorer.removeBoxKey(t)},_setupSendLaterManagement:function(){var e=c.Data.getAllSendLaters();e.watch("add",this._handleSendLaterAdded,this);e.watch("remove",this._handleSendLaterRemoved,this);l.subscribe({eventName:"set",filterParameters:{collectionId:e.getId(),property:"gmailDraftId"},observer:this,functionToCall:this._handleGmailDraftIdSet})},_handleSendLaterAdded:function(e){var t=e.model.get("gmailDraftId");c.Services.Threads.ThreadStorer.setSendLater(t,e.model)},_handleSendLaterRemoved:function(e){var t=e.model.get("gmailDraftId");c.Services.Threads.ThreadStorer.removeSendLater(t)},_handleGmailDraftIdSet:function(e){var t=e.previousValue;var n=e.newValue;c.Services.Threads.ThreadStorer.removeSendLater(t);c.Services.Threads.ThreadStorer.setSendLater(n,e.model)},_setupBumpLaterManagement:function(){var e=c.Data.getAllBumpLaters();e.watch("add",this._handleBumpLaterAdded,this);e.watch("remove",n.delayed(this._handleBumpLaterRemoved,5),this)},_handleBumpLaterAdded:function(e){var t=e.model.get("gmailThreadId");var n=e.model;var i=c.Services.Threads.ThreadStorer.getBumpLaterCollection(t);if(!i){i=c.Models.BumpLater.createCollection()}i.add(n);c.Services.Threads.ThreadStorer.setBumpLaterCollection(t,i)},_handleBumpLaterRemoved:function(e){if(!e.model){return}var t=e.model.get("gmailThreadId");var n=c.Services.Threads.ThreadStorer.getBumpLaterCollection(t);if(n){n.remove(e.model)}c.Services.Threads.ThreadStorer.setBumpLaterCollection(t,n)}});i.set("BentoBox.Services.Threads.ThreadStorerValueManager",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){};n.extend(u.prototype,{extractEmailAddressesFromCSVRows:function(e){var t={};var i=[];var r=null;for(var a=0;a<e.length;a++){r=this._extractEmailsFromRow(e[a]);this._updateMapWithEmails(t,r,e[a]);n.mutate("union",i,r)}return{emailAddresses:i,emailAddressToRowListMap:t}},_extractEmailsFromRow:function(e){var t=[];for(var n in e){t.push(e[n])}return t.join(" ").toLowerCase().replace(/\r|\t|\n/gim," ").match(/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/g)},extractEmailAddressesFromBoxes:function(e,t){var i={};var r=[];var a=null;for(var o=0;o<t.length;o++){a=this._extractEmailsFromBox(e,t[o]);this._updateMapWithEmails(i,a,t[o]);n.mutate("union",r,a)}return{emailAddresses:r,emailAddressToBoxListMap:i}},_extractEmailsFromBox:function(e,t){var i=[];var r=null;if(e.extractEmailsFrom.threads){var a=t.get("emailAddresses");n.mutate("union",i,n.map(a,function(e){if(e){return e.toLowerCase()}}))}if(e.extractEmailsFrom.assignedTo){r=this._extractEmailPropertyFromPeopleField(t.get("assignedToSharingEntries"));n.mutate("union",i,r)}if(e.extractEmailsFrom.columns){r=this._extractEmailsFromColumns(t,e.columnSettings);n.mutate("union",i,r)}n.mutate("compact",i);var o=l.getUser().get("email").toLowerCase();var s=l.getUser().getDomain().toLowerCase();return n.filter(i,function(t){if(e.ignoreEmails.myself){if(t.toLowerCase()===o){return false}}if(e.ignoreEmails.org){if(t.split("@")[1].toLowerCase()===s){return false}}return true})},_extractEmailPropertyFromPeopleField:function(e){if(!e){return[]}return n.chain(e).pluck("email").compact().map(function(e){return e.toLowerCase()}).value()},_extractEmailsFromPeopleField:function(e){if(!e){return[]}return n.chain(e).map(function(e){return[(e.email||"").toLowerCase(),(e.displayName||"").toLowerCase()]}).flatten().compact().value()},_extractEmailsFromColumns:function(e,t){var i=[];var r=false;if(!t){r=true}if(r||t.name){i.push(e.get("name"))}if(r||t.notes){i.push(e.get("notes"))}var a=this._getBoxFieldValueMap(e);var o=e.getPipeline().getFields();for(var s=0;s<o.length;s++){if(!r&&!t[o[s].key()]){continue}var l=a[o[s].key()];if(o[s].get("type")==="PERSON"){n.mutate("union",i,this._extractEmailsFromPeopleField(l))}else if(o[s].get("type")==="TEXT_INPUT"){i.push(l)}}return i.join(" ").toLowerCase().match(/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/g)},_updateMapWithEmails:function(e,t,n){if(!t){return}for(var i=0;i<t.length;i++){var r=t[i].toLowerCase();if(!e[r]){e[r]=[]}e[r].push(n)}},_getBoxFieldValueMap:function(e){var t={};var n=e.getPipeline().getFields();for(var i=0;i<n.length;i++){t[n[i].key()]=e.getFieldValue(n[i].key())}return t}});e.DependencyManager.addFunction({functionKey:"emailAddressExtractorInitialized",functionToCall:function(e){l.Services.EmailAddressExtractor=new u;if(e){e()}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d="hihakjfhbmlmjdnnhegiciffjplmdhin";var h=e.Class.subclass({className:"RapportiveStatusController",superclass:e.Object,_memberVariables:[{name:"_isEnabled",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);Messenger.sendMessage("extensionListRequest",null,"extensionListResponse",this._checkExtensions.bind(this))},_checkExtensions:function(e){this._isEnabled=n.filter(e,function(e){return!e.isApp&&e.mayDisable&&e.enabled&&e.id===d}).length>0},isEnabled:function(){return this._isEnabled},getSidebar:function(){return r.getCurrentMain().find("#rapportive-sidebar")}});e.DependencyManager.addFunction({functionKey:"RapportiveStatusControllerInitialized",functionReference:function(){i.set("BentoBox.Services.RapportiveStatusController",new h)}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=/\{\{((box|email|field)_(.+?))\}\}/gi;var c=function(){this._lookupTables={}};n.extend(c.prototype,{getCompiledString:function(e,t,n,i,r){if(!i){return""}var a;if(e){a=this._getLookupTable(e.getPipeline())}var o=this;return i.replace(u,function(){return o._generateReplacementString(arguments,e,t,n,a,r)})},_generateReplacementString:function(e,i,r,a,o,s){var l=e[0];var u=e[1];var c=e[2];var d=e[3];if(c==="email"){if(!r){return""}if(s){return r[d]||""}else{return t.getTextHTML(r[d])||""}}if(!o){if(a&&a[d]){if(s){return a[d]}else{return t.getTextHTML(a[d])}}return""}if(!o[d]){return l}var h=o[d];if(!h){return l}if(h.columnType==="field"){if(s){return i.getFieldDisplayTextValue(h.value.fieldKey)}else{return n.escape(i.getFieldDisplayTextValue(h.value.fieldKey))}}else{if(s){return i.getDisplayTextValue(h.value.property)}else{return n.escape(i.getDisplayTextValue(h.value.property))}}},findReferencedFields:function(e){var t=[];var i={email:{},box:{},other:{}};var r=n.toArray(arguments).slice(1);for(var a=0;a<r.length;a++){if(r[a]){n.mutate("union",t,r[a].match(u))}}for(var a=0;a<t.length;a++){if(t[a]){this._updateReferencedFields(i,t[a],this._getLookupTable(e))}}return i},_getLookupTable:function(e){if(!e){return}if(this._lookupTables[e.key()]){return this._lookupTables[e.key()]}this._buildReverseColumnLookup(e);return this._lookupTables[e.key()]},_buildReverseColumnLookup:function(e){var t={};var i=l.UI.getPipelineColumnList(e,e.getAllSystemColumns());var r=this;n.each(i,function(e){t[e.name]=e});this._lookupTables[e.key()]=t},_updateReferencedFields:function(e,t,i){var r=t.replace("{{","").replace("}}","");var a=r.split("_");if(a.length<2){return}var o=a[0];var s=n.rest(a).join("_");if(o==="field"){if(i&&i[s]){e["box"][s]=i[s];return}e["other"][s]=true}else{e[o][s]=true}}});l.Services.TemplateProcessor=new c})(Streak);(function(e){var t=e.jQuery,n=e.BentoBox,i=e.HTML;n.FirstRun={init:function(e){this.elements={};this.elements.stage2modal=i.get("stage2_modal",true);this.elements.stage3modal=i.get("stage2_modal",true);if(e){e()}},getStage:function(){return 3},setupModals:function(){this.s2modal=n.Widgets.Modal.create({title:n.Locale.getString("stage2_modal_title"),confirmText:"OK",showCancel:false,inner:this.elements.stage2modal,confirmFunc:t.noop,maxHeight:"600px",onClose:function(){n.Modules.BoxesButton.el.css({zIndex:"1"})},trackingContext:{widgetContext:"firstRun"}});this.s3modal=n.Widgets.Modal.create({title:n.Locale.getString("stage3_modal_title"),confirmText:"OK",showCancel:false,inner:this.elements.stage3modal,maxHeight:"600px",trackingContext:{widgetContext:"firstRun"}})},showStageModal:function(e){var t=this;t["showStage"+(e?e:t.getStage())+"Modal"]()},showStage1Modal:function(){n.Modules.LeftLink.newPipelineShow()},showStage2Modal:function(){if(!this.s2Modal){this.setupModals()}n.Modules.BoxesButton.el.css({zIndex:"2000"});this.s2modal.show()},showStage3Modal:function(){if(!this.s2Modal){this.setupModals()}this.s3modal.show()}};e.DependencyManager.addFunction({functionKey:"firstRunInitialized",functionToCall:n.FirstRun.init,functionContext:n.FirstRun,dependentFunctionKeys:["HTML"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Gmail,a=e.BentoBox;a.Keyboard={activeTimer:null,clearTime:1e3,activeChords:[],multiChords:[],chordHelp:[],initialized:false,helpRendered:false,helpEl:null,init:function(e){var t=this;if(!this.initialized){r.elements.body.bind("keydown",function(e){t.handleChordKeyEntry(e)});t.bindChord("shift+/",function(){setTimeout(function(){t.renderHelpItems()},20)});this.initialized=true}if(e){e()}},bindChord:function(e,n,a){var o=e.split(",");if(o.length===1){var s=i.event(e,n);r.elements.body[0].addEventListener("keydown",function(e){if(!t(e.target).is("input,textarea,[contentEditable=true],.input")){s(e)}},true)}else{this.multiChords.push({chord:o,cb:n})}if(a){this.addChordHelpItem(e,a)}},addChordHelpItem:function(e,t){this.chordHelp.push({chord:e,description:t})},handleChordKeyEntry:function(e){var n,r,a,o;var s=this;if(!t(e.target).is("input,textarea,[contentEditable=true],.input")){if(s.activeTimer){clearTimeout(s.activeTimer)}s.activeTimer=setTimeout(function(){s.activeChords=[]},s.clearTime);var l=[];var u=[];for(n=0;n<s.multiChords.length;n++){r=s.multiChords[n];a=r.chord[0];if(i.is(a,e)){o=r.chord.slice();o.shift();l.push({chord:o,cb:r.cb})}}for(n=0;n<s.activeChords.length;n++){r=s.activeChords[n];a=r.chord.shift();if(i.is(a,e)){if(r.chord.length===0){u.push(r.cb)}else{l.push(r)}}}if(u.length>0){s.activeChord=[];clearTimeout(s.activeTimer);for(n=0;n<u.length;n++){u[n](e)}}else{s.activeChords=l}if(u.length>0){e.preventDefault();e.stopPropagation()}}},bindChordToElement:function(e,t,n,i,r,a,o,s){this.bindChordToEl({el:e,chord:t,cb:n,noBubble:i,noDefault:r,notOnInput:a,keyEvent:o,useCapture:s})},bindChordToEl:function(e){var r=e.el,a=e.chord,o=e.cb,s=e.noBubble,l=e.noDefault,u=e.notOnInput,c=e.keyEvent,d=e.useCapture,h=e.delegate;if(!c){c="keydown"}var f=i.event(a,o);var p;var m=function(n){if(d){p=_;r.each(function(){this.addEventListener(c,p,true)})}else{p=function(e){if(!(u&&t(e.target).is("input,textarea,[contentEditable=true],.input"))){_(e)}};r.on(n,e.delegate,null,p)}};var _=function(e){f(e);if(s&&i.is(a,e)){if(d){e.stopPropagation();e.stopImmediatePropagation()}else{e.stopPropagation()}}if(l&&i.is(a,e)){e.preventDefault()}};if(n.isArray(c)){n.each(c,function(e){m(e)})}else{m(c)}return function(){if(d){r.each(function(){this.removeEventListener(c,p,true)})}else{r.off(event,e.delegate,p)}}},renderHelpItems:function(){var e=this;var i=t(document.createElement("tr"));i[0].innerHTML='<th class="Do"></th><th class="Do"><span class="boxIcon"></span>Streak</th>';this.getKeyboardHelpFirstColumn().append(i);n.each(e.chordHelp,function(t){e.renderChordHelpItem(t.chord,t.description)})},renderSeparator:function(e){switch(e){case",":return'</span> <span class="wb">then</span> ';break;case"+":return'</span> <span class="wb">+</span> ';break;default:return""}},renderChordHelpItem:function(e,i){var r=e.split(/[,+]/g);var a=e.match(/[,+]/g);var o=t(document.createElement("tr"));var s='<td class="wg Dn">';for(var l=0;l<r.length-1;l++){s+='<span class="wh">'+r[l].escapeHTML()+this.renderSeparator(a[l])}s+='<span class="wh">'+n.last(r)+"</span>"+" :</td>";s+='<td class="we Dn">'+i+"<td>";o[0].innerHTML=s;this.getKeyboardHelpFirstColumn().append(o)},getKeyboardHelpFirstColumn:function(){return r.getKeyboardHelp().find(".cf.wd .cf").filter(":first").find("tbody")}};e.DependencyManager.addFunction({functionKey:"keyboardInitialized",functionToCall:a.Keyboard.init,functionContext:a.Keyboard,dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Model,o=e.BentoBox;LocalSettings=e.Eventer.create({settings:null,initialized:false,init:function(){if(!this.initialized){this.email=e.userEmail;this.settings=e.ObjectPath.create(localStorage["streakLocalSettings"+this.email]);this.initialized=true}},get:function(e){return this.settings.get(e)},setSetting:function(e,t){this.set(e,t)},getItem:function(e){return this.get(e)},setItem:function(e,t){this.set(e,t)},set:function(e,t){this.settings.set(e,t);this.save();this.trigger("localSettingsSet")},save:function(){localStorage["streakLocalSettings"+this.email]=this.settings.toString()}});o.LocalSettings=LocalSettings;e.DependencyManager.addFunction({functionKey:"localSettingsInitialized",functionReference:o.LocalSettings.init,functionContext:o.LocalSettings})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.BentoBox;var a=window.performance;if(!a){a={}}if(!a.webkitNow){a.webkitNow=function(){return(new i).getTime()}}r.Logger={isDebug:false,init:function(e){e()},log:function(){if(this.isDebug){console.log.apply(console,n.toArray(arguments))}},debug:function(){if(this.isDebug){console.debug.apply(console,n.toArray(arguments))}},colorLog:function(){var e=n.toArray(arguments);var t=["%cdebug: ","color:"+n.last(e)+";"].concat(n.initial(e));this.debug.apply(this,t)},output:function(e,t){console.debug(e+": "+t+" ticks")},start:function(e){return new function(){var t=a.webkitNow();var n=a.webkitNow();var i=function(n){if(r.Logger.isDebug){r.Logger.output(n||e,a.webkitNow()-t)}};var o=function(t){if(r.Logger.isDebug){r.Logger.output(t||e,a.webkitNow()-n);n=a.webkitNow()}};return{end:i,mark:o}}}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=MailHelper={initialized:false,_queuedEmailLists:[],_currentEmailList:null,_nextSendTimeout:null,_hideComposeWindowRule:null,_sendingEmails:false,_sentCounter:0,sendEmail:function(e){if(s._currentEmailList&&s._currentEmailList.sendingEmail){s._currentEmailList.sendingEmail(e)}r.GmailComposeWindowRequester.requestNewComposeWindow(function(t){setTimeout(function(){try{s._handleComposeWindow(t,e)}catch(i){o.logError("mail merge sending error",i);if(n.isFunction(s._currentEmailList.finishedSendingCallback)){s._currentEmailList.finishedSendingCallback()}o.ButterBarManager.showError("Error with mail merge: "+s._sentCounter+" email(s) sent",{time:5e3})}},2e3)})},sendMultipleEmails:function(e){if(s._currentEmailList){s._queuedEmailLists.push(e)}else{s._currentEmailList=e;s._prepareSendingEmails();s._processEmailList()}},cancelSending:function(){if(s._currentEmailList){clearTimeout(s._nextSendTimeout);s._processNextEmailList()}},isMailHelperSendingEmails:function(){return this._sendingEmails},_processEmailList:function(){if(n.isFunction(s._currentEmailList.startSendingCallback)){s._currentEmailList.startSendingCallback(s._currentEmailList.emailPackages.length)}this._sentCounter=0;s._runThroughEmailList()},_runThroughEmailList:function(){if(n.isArray(s._currentEmailList.emailPackages)&&s._currentEmailList.emailPackages.length>0){var e=s._currentEmailList.delayBetweenEmails||2e3;var t=s._currentEmailList.emailPackages.shift();t.emailSentCallback=function(){if(!s._currentEmailList){s._processNextEmailList();return}if(n.isFunction(s._currentEmailList.emailSentCallback)){s._currentEmailList.emailSentCallback(s._sentCounter,s._currentEmailList.emailPackages.length)}s._nextSendTimeout=setTimeout(s._runThroughEmailList,e);s._sentCounter+=1};s.sendEmail(t)}else{if(n.isFunction(s._currentEmailList.finishedSendingCallback)){s._currentEmailList.finishedSendingCallback()}s._processNextEmailList()}},_processNextEmailList:function(){if(s._queuedEmailLists.length>0){s._prepareSendingEmails();s._currentEmailList=s._queuedEmailLists.shift();s._processEmailList()}else{s._currentEmailList=null;s._finishSendinEmails()}},_prepareSendingEmails:function(){this._sendingEmails=true;this._hideComposeWindows()},_finishSendinEmails:function(){this._sendingEmails=false;this._unhideComposeWindows()},_hideComposeWindows:function(){s._hideComposeWindowRule=e.CSSStyleManipulator.addRule(".Wk [role=dialog], .dw [role=dialog] {visibility: hidden;}",0)},_unhideComposeWindows:function(){e.document.styleSheets[0].removeRule(s._hideComposeWindowsRule)},_init:function(e){if(!s.initialized){r.bind("newSentEmail",s._handleNewSentMail)}s.initialized=true;if(e){e()}},_handleComposeWindow:function(t,i){t.notify("mailHelperSendingEmails");if(i.toAddresses){t.setToAddresses(i.toAddresses)}if(i.subject){t.setSubject(i.subject)}if(i.body){t.setEmailBody(i.body)}if(i.attachments){}e.NotificationCenter.subscribe({eventName:"rfcMessageIdForSentEmailFound",filterParameters:{composeid:t.getComposeid()},observer:this,functionToCall:function(e){var t=e.threadMetaData;if(i.boxKey){s._addEmailToBox(i,t)}if(i.isPixelTracked){s._addEmailToTrackedThread(i,t)}if(n.isFunction(i.emailSentCallback)){i.emailSentCallback()}},unsubscribeImmediately:true});setTimeout(function(){t.send()},250)},_addEmailToBox:function(e,t){var i=o.Data.getBox(e.boxKey);if(n.isReal(i)){o.Modules.BoxesMenu.BoxAndGmailThreadCreator.createGmailThread(i.key(),t,"mailMerge");o.Tracker.track("addThreadsToBox",{threadCount:1,context:"mailMerge"})}},_addEmailToTrackedThread:function(t,n){var i=t.pixelTrackingGuid;var r=n.hexGmailThreadId;var a=n.subject;var s=t.toAddresses;var l=[""];var u=n.rfcMessageId;var c=new e.BentoBox.Models.TrackedLink({guid:i,hexGmailThreadId:r,snippetKeyList:t.snippetKeyList,mailMergeId:t.mailMergeId,subject:a,names:l,emails:s,isMailMerge:true,rfcMessageId:u});c.save();o.Tracker.trackStreakActive("pixel_track_email_sent",{source:"mailMerge"});o.Modules.PixelTrackerConversationImageFixer.sendIgnoreImageRequest(i)}};e.DependencyManager.addFunction({functionKey:"mailHelperInitialized",functionToCall:MailHelper._init,functionContext:MailHelper,dependentFunctionKeys:["gmailLoaded"]});o.MailHelper=MailHelper})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MoveBoxHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},moveBox:function(e,t){this.moveBoxes(e.getPipeline(),t,[e])},moveBoxes:function(e,t,n){var i=this;var r=this._getMoveBoxesMessage(e,t,n);c.Tracker.track("moveBoxesAsk");c.Widgets.Modal.confirm(c.Locale.getString("move_boxes_confirm_title",{pluralize:[n]}),r,function(){i._startMovingBoxes(e,t,n)},function(){c.Tracker.track("moveBoxesCancelled")})},_getMoveBoxesMessage:function(e,t,i){var r=e.getFields();var a=t.getFields();var o=[];for(var s=0;s<r.length;s++){var l=r[s];var u=n.any(a,function(e){return e.get("name")===l.get("name")&&e.get("type")===l.get("type")});if(!u){o.push(l.get("name"))}}var d=null;if(o.length>0){d=c.Locale.getString("move_boxes_confirm_message_fields",{oldPipeline:e.displayName(),newPipeline:t.displayName(),number:i.length,fields:o.join(", "),pluralize:[i.length,o.length]})}else{d=c.Locale.getString("move_boxes_confirm_message",{number:i.length,oldPipeline:e.displayName(),newPipeline:t.displayName(),pluralize:[i.length]})}return d},_startMovingBoxes:function(e,t,n){c.Tracker.track("moveBoxesAccepted",{numberOfBoxes:n?n.length:0});c.Models.BoxOperationManager.moveBoxes(n,e.key(),t.key())}});i.set("BentoBox.MoveBoxHelper",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=PixelTrackingHTMLGenerator={getGuid:function(){return e.guid()},injectTrackingHTML:function(e){var t=this.getGuid();var n=this.getTrackingHTML(t);e.removeSelectorFromBody("[hspace=streak-pt-mark]");e.addHTMLToBodyBeforeQuotedText(n);return t},getTrackingHTML:function(e){if(!e){e=this.getGuid()}return['<div hspace="streak-pt-mark" style="max-height:1px;">',this._getImage(e),this._getSearchMarker(),"</div>"].join("")},getEncodedEmailAddress:function(){return encodeURIComponent("a"+btoa(o.getUser().getEmail()))},_getImage:function(t){return'<img style="width:0px; max-height:0px;" src=\''+e.server+"/t?sender="+this.getEncodedEmailAddress()+"&type=zerocontent&guid="+t+"'/>"},_getSearchMarker:function(){var e=this;return'<font color="#ffffff" size="1">'+o.Modules.PixelTrackerSearch.CONSTANTS.TRACKED_KEY+"</font>"}};o.PixelTrackingHTMLGenerator=PixelTrackingHTMLGenerator})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;var a={GA_USER_KEY_HANDLE:"dimension1",GA_ORG_KEY_HANDLE:"dimension2",GA_EXPERIMENTS_HANDLE:"dimension3",GA_STREAK_CLIENT_VERSION_HANDLE:"dimension4",GA_IS_GOOGLE_APPS_HANDLE:"dimension5",GA_INSTALLED_EXTENSIONS_HANDLE:"dimension6",GA_ACCOUNT_AGE_HANDLE:"metric1",GA_NUM_SHARED_PIPELINES_HANDLE:"metric2"};r.Tracker={isDebug:false,init:function(e){var t=this;t.initializeAnalytics();e()},trackAssociateBoxWithThread:function(e){var t={};var n=r.Data.numBoxesCreatedByCurrentUserThatContainAThread();t.eventName="associateBoxWithThread";t.numThreads=n;t.boxType=e.boxType;t.source=e.source;t.value=n;r.Tracker.trackStreakActive(t);if(n===0){r.Tracker.trackStreakActive({eventName:"boxedFirstThread"})}},initializeStreakpanel:function(){streakpanel.init("streaktoken2")},initializeAnalytics:function(){var e=this;e.initializeStreakpanel()},currentTrackableViewName:function(){var e=r.UI.getCurrentView();return e},addTracking:function(e,t,n){e.bind(t,function(){r.Tracker.trackStreakActive(n)})},addPassiveTracking:function(e,t,n){e.bind(t,function(){r.Tracker.trackStreakPassive(n)})},addDelegatedTracking:function(e,t,n,i){e.on(n,t,function(){r.Tracker.trackStreakActive(i)})},trackStreakActive:function(){var e=n.compact(arguments);var t=n.extend.apply(null,e);if(t!==null){t.category="StreakActive";r.Tracker.recordEvent(t)}},trackStreakPassive:function(e){if(e!==null){e.category="StreakPassive";r.Tracker.recordEvent(e)}},track:function(e){var t={eventName:e};this.trackStreakActive.apply(this,[t].concat(n.toArray(arguments).slice(1)))},trackStreakPerformance:function(e){if(!e){e={}}e.category="ExtensionPerformance";r.Tracker.recordEvent(e)},trackGmail:function(e){var t={eventName:e,category:"Gmail",context:r.Tracker.currentTrackableViewName()};var i=[t].concat(n.compact(n.toArray(arguments).slice(1)));var a=n.extend.apply(null,i);r.Tracker.recordEvent(a)},getExperimentsString:function(){var t=",";var n=e.BentoBox.getUser().get("experiments");e._.each(n,function(n,i){if(e._.isReal(n)&&n.inExperiment===true){t+=i+","}});if(t===","){t=""}return t},getStreakpanelSuperProperties:function(){var t={};if(n.isReal(e.BentoBox.getUser())){t["experiments"]=r.Tracker.getExperimentsString()}if(r.user){t["userKey"]=r.getUser().key();t["orgKey"]=r.getUser().get("orgKey")}t["email"]=e.userEmail;t["clientVersion"]=e.clientVersion;t["extensionVersion"]=e.extVersion;t["language"]=r.Locale.getCurrent();t["previewPane"]=i.getPreviewPaneSettings();t["isConversationViewDisabled"]=i.isConversationViewDisabled();return t},sendStreakpanel:function(e){var t=r.Tracker.getStreakpanelSuperProperties();var i=n.extend(n.clone(e),t);delete i.eventName;streakpanel.track(e.eventName,i)},recordEvent:function(e){try{if(this.isDebug){console.log("track event:",e)}r.Tracker.sendStreakpanel(e)}catch(t){r.Logger.log(t)}}};e.DependencyManager.addFunction({functionKey:"trackerInitialized",functionToCall:r.Tracker.init,functionContext:r.Tracker})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;var a={LoggedInToCurrentAccountKey:"streak__loggedInToAccountEver "+e.userEmail.toLowerCase()};r.TrackerListener={init:function(e){var t=this;t.trackStreakLoadedLoggedOut();t.listenForGmailEvents();if(e){e()}},loggedInInit:function(e){this.listenForNewPipeline();this.trackStreakLoadedLoggedIn();if(e){e()}},listenForNewPipeline:function(){r.Data.getAllPipelines().watch("add",function(){var e=r.Data.getAllPipelines().length;r.Tracker.trackStreakPassive({eventName:"pipelineCreated",numPipelines:e});if(e===1){r.Tracker.trackStreakPassive({eventName:"firstPipelineCreated"})}},this)},listenForGmailEvents:function(){i.observe("viewChanged",function(e){var t="viewChanged";var n=r.UI.getPreviousView();if(i.isGmailView()){r.Tracker.trackGmail(t,{lastView:n})}else{r.Tracker.trackStreakPassive({eventName:t,lastView:n,context:r.Tracker.currentTrackableViewName()})}})},trackStreakLoadedLoggedOut:function(){var e="hasLoggedInToCurrentAccountBefore";if(!localStorage["streak__loggedInEver"]){e="neverLoggedInToAnyAccountBefore"}else if(!localStorage[a.LoggedInToCurrentAccountKey]){e="neverLoggedInToCurrentAccountBefore"}r.Tracker.trackStreakPassive({eventName:"StreakLoadedLoggedOut",status:e})},trackStreakLoadedLoggedIn:function(){var e="hasLoggedInToCurrentAccountBefore";if(!localStorage["streak__loggedInEver"]){localStorage["streak__loggedInEver"]=true;e="loggedInForFirstTime"}else if(!localStorage[a.LoggedInToCurrentAccountKey]){localStorage[a.LoggedInToCurrentAccountKey]=true;e="loggedInToCurrentAccountForFirstTime"}r.Tracker.trackStreakPassive({eventName:"StreakLoadedLoggedIn",status:e});if(r.Data.getAllPipelines().length===0){r.Tracker.trackStreakPassive({eventName:"noPipelinesWhenStreakLoaded"})}if(r.Data.numBoxesCreatedByCurrentUserThatContainAThread()===0){r.Tracker.trackStreakPassive({eventName:"noBoxesCreatedByCurrentUserThatContainAThreadWhenStreakLoaded"})}}};e.DependencyManager.addFunction({functionKey:"trackerListenerInitialized",functionToCall:r.TrackerListener.init,functionContext:r.TrackerListener,dependentFunctionKeys:["gmailLoaded","trackerInitialized"]});e.DependencyManager.addFunction({functionKey:"trackerListenerLoggedInInit",functionToCall:r.TrackerListener.loggedInInit,functionContext:r.TrackerListener,dependentFunctionKeys:["userLoggedIn","trackerInitialized","data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.BentoBox;var o={COLORS:["#FA573C","#FFAD46","#B3DC6C","#16A765","#9FC6E7","#4986E7","#7BD148","#F83A22","#AC725E","#92E1C0","#42D692","#D06B64","#FAD165","#FF7537","#9FE1E7"]};a.UI={suppressSearch:false,originalHash:null,el:null,interval:false,initialized:false,viewHistory:[],fullViewHistory:[],init:function(e){var n=this;if(!n.initialized){n.el=t(document.createElement("div"));n.el.addClass("BltHke nH oy8Mbf");n.el.attr("id","workflowArea");n.el.hide();r.observe("viewChanged",function(e){n.setupViewCanvas()},null,1);if(!n.interval){n.interval=true;t(window).bind("resize.mainResize",function(){if(n.isBentoBoxView()){n.setHeight()}})}}n.initialized=true;if(e){e()}},teardown:function(){if(this.isBentoBoxView()){this.setURL(r.Constants.Inbox);this.el.hide();this.el.siblings().show()}},destroy:function(){if(this.el){this.el.remove()}},setHeight:function(){var e=parseInt(r.getLeftBar()[0].style.height,10);if(this.height!==e){this.height=e;this.el[0].style.height=this.height+33+"px"}},fixTopOffset:function(){var e=this.el.parentsUntil("body").last();e.offset({top:0})},setGmailView:function(){this.el.hide();this.el.siblings().show()},setupViewCanvas:function(){this.fullViewHistory.push(r.hash.partsString);this.fullViewHistory=n.last(this.fullViewHistory,100);if(r.isConversation()){this.viewHistory.push("conversation")}else{this.viewHistory.push(r.view)}this.viewHistory=n.last(this.viewHistory,100);var e=false;if(this.isBentoBoxView()){var t=r.getCurrentMainContainer()[0];t.insertBefore(this.el[0],t.firstChild);this.el.siblings().fastHide();this.el.show();this.setHeight();this.fixTopOffset()}else{if(this.el.isVisible()){e=true}this.el.hide();this.el.siblings().fastShow("");this.el.detach();if(r.view===r.Constants.Contact){var i=r.$(".acn textarea.R5").filterOutInvisible();if(i&&i.length>0){var a=i.closest(".nn");if(a.length>0){var o=a.parent();a.height(o.height())}}}if(e){var s=document.createEvent("UIEvents");s.initUIEvent("resize",true,false,window,0);window.dispatchEvent(s)}}this.suppressSearch=false},goBack:function(){var e=this.fullViewHistory.pop();e=this.fullViewHistory.pop();
this.setURL(e)},isBoxView:function(){return r.view==r.Constants.Box},isPipelineView:function(){return r.view==r.Constants.Pipeline},isPipelineReportsView:function(){return r.view==r.Constants.PipelineReports},isDeepLinkLoadingView:function(){return r.view==r.Constants.DeepLinkLoading},isBentoBoxView:function(e){if(typeof e==="undefined"){e=r.view}return r.Constants.BentoBoxViews.indexOf(e)>-1},getCanvas:function(){return this.el},goToThread:function(e){var t=r.Constants.Inbox+"/"+e;var n=r.GmailComposeWindowMasterController.getComposeWindows();if(n.length>0){var i=false;var a=[];for(var o=0;o<n.length;o++){var s=n[o].getDraftId();if(s){a.push(s)}else{i=true}}if(i){a.push("new")}t+="?compose="+a.join(encodeURIComponent(","))}this.setURL(t)},linkify:function(e,t){if(e.link){return e.link()}else{if(e=="thread"||e=="GmailThread"){return r.Constants.GmailThread+"/"+t}}},setURL:function(t,n,i){var o=this;return new e.RSVP.Promise(function(e,s){var l=r.observe("viewChanged",function(){r.unobserve("viewChanged",l);var t=this.event;r.bind("finishedExecuting_viewChanged",function(i){if(i!==t){return false}if(n){try{n()}catch(r){a.logError("error with setURL callback",r)}}try{o.fixTopOffset()}catch(r){a.logError("error with setURL fixTopOffset",r)}e();return true})});if(i){window.location.replace("#"+t)}else{window.location.hash="#"+t}})},appendURLQuery:function(e){var t=null;if(r.hash.query===null){t="?"}else{t=encodeURIComponent(",")}location.hash=location.hash+t+e},getResourceURL:function(t){return e.server+(t.indexOf("/")===0?"":"/")+t+(t.indexOf("?")>-1?"&":"?")+"clientVersion="+encodeURIComponent(e.clientVersion)+"&email="+encodeURIComponent(e.ai||e.userEmail)},getPreviousView:function(){return n.chain(this.viewHistory).last(2).first(1).value()[0]},getCurrentView:function(){if(this.viewHistory.length>0){return n.last(this.viewHistory)}return null},dateNameConstants:["today","tomorrow","this sunday","this monday","this tuesday","this wednesday","this thursday","this friday","this saturday","this week","this month","this sunday","this monday","this tuesday","this wednesday","this thursday","this friday","this saturday","this week","this month"],getAssignedToSharingEntriesForPipelineBoxes:function(e){var t=a.Data.getPipelineBoxes(e.key());return n(t).chain().filter(function(e){var t=e.getAssignedToSharingEntries();return t&&t.length>0}).map(function(e){return e.getAssignedToSharingEntries()}).flatten().uniq(function(e){return e.email}).map(function(e){return{display:e.fullName||e.email,value:e}}).value()},getFieldValues:function(e,t){return a.Models.BoxField.getExistingTextValuesInBoxes(e,t)},processString:function(t,i,r){var o=i||a.Locale;var s=r||e.HTML;if(!n.isString(t)){return t}else if(n.isObject(t)){for(var l in t){t[l]=this.processString(t[l],o,s)}return t}var u=t;var c=t;for(var d=0;d<100;d++){u=c.replace(/%\w+%/,function(e){return o.getString(e.substring(1,e.length-1))}).replace(/\*\w+\*/,function(e){return s.get(e.substring(1,e.length-1))()});if(u===c){break}else{c=u}}return u},getPipelineColumnList:function(e,t,i){var r=n.map(e.getFields(),function(e){return{name:e.displayName(),columnType:"field",value:{fieldKey:e.key(),columnKey:"field|"+e.key()}}});if(!i){r=r.concat(n.map(t,function(e){return{name:e.title,columnType:"property",value:{property:e.property,columnKey:"property|"+(e.uniqueKey||e.property)}}}))}return r.sortBy(function(e){return e.name})},getSortedVisiblePipelines:function(){var e=[];var t=a.UserSettings.get("leftLink/pipelineSort");if(t){for(var i=0;i<t.length;i++){var r=a.Data.getPipeline(t[i]);if(r&&!r.isHidden()){e.push(r)}}}n.chain(a.Data.getAllPipelines()).filter(function(e){return!e.isHidden()}).filter(function(e){if(t){if(t.indexOf(e.key())>-1){return false}}return true}).sortBy(function(e){return e.displayName()}).each(function(t){e.push(t)});return e},getSortedPipelines:function(){var e=[];var t=a.UserSettings.get("leftLink/pipelineSort");if(t){for(var i=0;i<t.length;i++){var r=a.Data.getPipeline(t[i]);if(r&&!r.isHidden()){e.push(r)}}}n.chain(a.Data.getAllPipelines()).filter(function(e){return!e.isHidden()}).filter(function(e){if(t){if(t.indexOf(e.key())>-1){return false}}return true}).sortBy(function(e){return e.displayName()}).each(function(t){e.push(t)});n.chain(a.Data.getAllPipelines()).filter(function(e){return e.isHidden()}).sortBy(function(e){return e.displayName()}).each(function(t){e.push(t)});return e},getSortedPipelineKeys:function(){var e=a.UserSettings.get("leftLink/pipelineSort");if(e&&e.length>0){e=n.filter(e,function(e){return!!a.Data.getPipeline(e)});e=e.concat(n.chain(a.Data.getAllPipelines()).map(function(e){return e.key()}).difference(e).value())}else{e=n.chain(a.Data.getAllPipelines()).sortBy(function(e){return e.displayName()}).map(function(e){return e.key()}).value()}var t=[];var i=[];for(var r=0;r<e.length;r++){if(a.Data.getPipeline(e[r]).isHidden()){i.push(e[r])}else{t.push(e[r])}}return t.concat(i)},getStageColors:function(e){var t=a.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings.load(e);if(n.isNotReal(t.data["property|stageKey"])){t.data["property|stageKey"]={}}var i=t.data["property|stageKey"];var r=n.pluck(e.getStagesAsListText(),"value");var o={};for(var s=0;s<r.length;s++){stageKey=r[s];if(i[stageKey]){o[stageKey]=i[stageKey]}else{o[stageKey]={backgroundColor:this.getIndexColor(s,i),textColor:"white"}}}return o},getIndexColor:function(e,t){var i=n.pluck(n.values(t),"backgroundColor");var r=o.COLORS.length;var a=i.length;for(var s=e;s<100;s++){var l=o.COLORS[s%o.COLORS.length];var u=i.indexOf(l);if(u===-1){return l}if(Math.abs(e-u)>10){return l}}return o.COLORS[Number.random(0,o.COLORS.length-1)]},getBoxListDisplayHTML:function(e){var t=e.getPipeline().getColor();var n="";if(a.Data.getAllPipelines().length>1){n='<span class="streak__boxListDisplay_pipeline" '+'style="background-color:'+t.backgroundColor+"; color: "+t.textColor+';">'+e.getPipeline().displayNameHTML()+"</span>"}return'<span class="streak__boxListDisplay">'+'<span class="streak__boxListDisplay_box">'+e.displayNameHTML()+"</span>"+n+"</span>"}};a.UI.originalHash=location.hash;e.DependencyManager.addFunction({functionKey:"uiInitialized",functionToCall:a.UI.init,functionContext:a.UI,dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Model,o=e.BentoBox;var s=e.Eventer.create({userUISettings:null,settings:null,active:true,saveTimeout:null,init:function(e){var t=this;this.userUISettings=o.Models.UserUISettings.create({});this.userUISettings.refresh(function(){t.refreshSettings();if(e){e()}})},refresh:function(){this.userUISettings.refresh(this.refreshSettings.bind(this))},refreshSettings:function(){if(this.userUISettings.get("clientJSONUISettings")){try{this.settings=new a(JSON.parse(this.userUISettings.get("clientJSONUISettings")))}catch(e){}}if(!this.settings){this.settings=new a({})}this.trigger("refresh")},getSetting:function(e){var t=e.split("/");var n=this.settings.get(t[0]);for(var i=1;i<t.length;i++){if(n){n=n[t[i]]}}return n},get:function(e){return this.getSetting(e)},setSetting:function(t,i){var r=t.split("/");if(r.length===1){this.settings.set(r[0],i)}else{var a=this.settings.get(r[0]);if(!a){a={}}var o=a;for(var s=1;s<r.length-1;s++){var l=o[r[s]];if(!l){l={};o[r[s]]=l}o=l}o[n.last(r)]=i;this.settings.set(r[0],a)}e.NotificationCenter.postNotification({eventName:"userSettingSet",sender:this,path:t,value:i})},set:function(e,t){this.setSetting(e,t)},saveSettings:function(){if(this.active){var e=this;clearTimeout(this.saveTimeout);this.saveTimeout=setTimeout(function(){var t=e.settings.getWrappedObject();var n=e.settings.getEditOperations();if(n){for(var i=0;i<n.length;i++){t[n[i].property]=n[i].value}}e.userUISettings.set("clientJSONUISettings",JSON.stringify(t));e.userUISettings.save(null,null,true)},500)}},save:function(e){this.saveSettings();if(e){this.trigger("refresh")}}});o.UserSettings=s;e.DependencyManager.addFunction({functionKey:"userSettingsInitialized",functionToCall:o.UserSettings.init,functionContext:o.UserSettings,dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;o.Workers={pool:null,size:3,initialized:false,init:function(t){if(!this.initialized){this.initialized=true;this.pool=e.jobPool.create(this.size)}if(t){t()}},run:function(e,t,n){this.pool.dispatch({callable:e,parameters:t,oncomplete:n})},prepareObject:function(e){return JSON.parse(JSON.stringify(e))},terminate:function(){this.pool.terminate(true)}};o.onLoad(function(e){o.Workers.init(e)})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TourChapterViewController",superclass:s.ViewController,currentChapterViewController:null,_memberVariables:[{name:"_currentChapterDefinition",destroy:false},{name:"_tourHistory",destroy:false},{name:"_currentTourPageViewController",destroy:true},{name:"_defaultChapterClasses",destroy:true},{name:"_currentChapterClasses",destroy:false},{name:"_chapters",destroy:false},{name:"_tourWidgetFactory",destroy:true},{name:"_pagesViewed",destroy:true},{name:"_currentMark",destroy:false},{name:"_isDestroyed",destroy:false}],_initialize:function(){s.ViewController.prototype._initialize.call(this);this._isDestroyed=false;this._tourHistory=[];this._defaultChapterClasses=[];this._currentChapterClasses=[];this._initializeDefaultChapterClasses()},run:function(e,t){if(d.currentChapterViewController){d.currentChapterViewController.destroy()}if(!e.pages||e.pages.length===0){return}c.Tracker.track("helpTour started",{chapterName:e.name});d.currentChapterViewController=this;this._chapters=t;this._currentChapterDefinition=e;this._pagesViewed=0;this._initializeTourWidgetFactory();this._fillInIncludes();this._startRunningTourChapter()},_initializeTourWidgetFactory:function(){this._tourWidgetFactory=i.getInstance("BentoBox.Tour.TourWidgetFactory")},_initializeDefaultChapterClasses:function(){this._defaultChapterClasses.push(i.getInstance("BentoBox.Tour.HelperClass.PipelineTourHelper"));this._defaultChapterClasses.push(i.getInstance("BentoBox.Tour.HelperClass.BoxTourHelper"));this._defaultChapterClasses.push(i.getInstance("BentoBox.Tour.HelperClass.ComposeTourHelper"));this._defaultChapterClasses.push(i.getInstance("BentoBox.Tour.HelperClass.InboxTourHelper"));this._defaultChapterClasses.push(i.getInstance("BentoBox.Tour.HelperClass.TourSelectorHelper"))},_fillInIncludes:function(){var e=this._currentChapterDefinition.pages.slice();var t=(this._currentChapterDefinition.classNames||[]).slice();for(var i=0;i<1e4;i++){var r=false;var a=[];for(var o=0;o<e.length;o++){var s=e[o];if(s.include){var l=[];if(s.onEnter){l.push(s.onEnter)}else if(s.onEnterFunctionArray){l=s.onEnterFunctionArray}r=true;var u=this._getChapterDefinition(s.include);var c=u.pages;this._addOnEnterFunctionsToIncludeChapterPages(l,c);a=a.concat(c);t=t.concat(u.classNames)}else{a.push(s)}}e=a;if(!r){break}}this._currentChapterDefinition.pages=e;this._currentChapterDefinition.classNames=n.uniq(t)},_addOnEnterFunctionsToIncludeChapterPages:function(e,t){for(ii=0;ii<t.length;ii++){var i=n.clone(e);var r=t[ii];if(r.onEnter){i.push(r.onEnter)}else if(r.onEnterFunctionArray){i=i.concat(r.onEnterFunctionArray)}r.onEnter=null;r.onEnterFunctionArray=i}},_startRunningTourChapter:function(){this._notifyTourStarting();this._resetTourState();this._initializeChapterClasses();this._loadNextChapterPage()},_notifyTourStarting:function(){l.postNotification({eventName:"tourStarting",sender:this})},_notifyTourFinished:function(){l.postNotification({eventName:"tourFinished",sender:this})},_resetTourState:function(){this._tourHistory.length=0;this._resetChapterClasses()},_initializeChapterClasses:function(){this._resetChapterClasses();var e=this._currentChapterDefinition.classNames;if(!e||e.length===0){return}for(var t=0;t<e.length;t++){if(!e[t]){continue}var n=i.getInstance("BentoBox.Tour.HelperClass."+e[t]);this._currentChapterClasses.push(n)}},_resetChapterClasses:function(){for(var e=0;e<this._currentChapterClasses.length;e++){this._currentChapterClasses[e].destroy()}this._currentChapterClasses.length=0},_loadNextChapterPage:function(){this._resetTourPageViewController();var e=this._getNextTourHistoryEntry();if(!e){this.finish();return}this._tourHistory.unshift(e);this._setupTourPageViewController(e.pageDefinition);if(this._isDestroyed){return}c.Tracker.track("helpTour next page",{chapterName:this._currentChapterDefinition.name,pagesViewed:this._pagesViewed,chapterPageIndex:e.pageDefinition.pageIndex})},_resetTourPageViewController:function(){if(this._currentTourPageViewController){this._currentTourPageViewController.destroy();this._currentTourPageViewController=null}},_getNextTourHistoryEntry:function(){if(this._tourHistory.length===0){return{chapterDefinition:this._currentChapterDefinition,pageIndex:0,pageDefinition:this._currentChapterDefinition.pages[0]}}var e=this._tourHistory[0].pageIndex+1;if(this._currentChapterDefinition.pages.length<=e){return}return{chapterDefinition:this._currentChapterDefinition,pageIndex:e,pageDefinition:this._currentChapterDefinition.pages[e]}},_setupTourPageViewController:function(e){this._currentTourPageViewController=new c.Tour.TourPageViewController;this._currentTourPageViewController.setDelegate(this);this._currentTourPageViewController.run(JSON.deepClone(e),this._tourWidgetFactory);this._pagesViewed+=1},callFunction:function(e,t,n){var i=null;var r=null;if(this[e]){return this[e].apply(this,[t,n])}var a=this._currentChapterClasses.concat(this._defaultChapterClasses);for(var o=0;o<a.length;o++){var s=a[o];if(s&&s[e]){return s[e].apply(s,[t,n])}}},next:function(){this._loadNextChapterPage()},previous:function(){this._resetTourPageViewController();var e=this._getPreviousTourEntry();if(!e){this.destroy();return}if(e.chapterDefinition.name!==this._currentChapterDefinition.name){this._currentChapterDefinition=e.chapterDefinition;this._initializeChapterClasses()}this._setupTourPageViewController(e.pageDefinition);c.Tracker.track("helpTour previous page",{chapterName:this._currentChapterDefinition.name,pagesViewed:this._pagesViewed,chapterPageIndex:e.pageDefinition.pageIndex})},moveBackPages:function(e){this._resetTourPageViewController();var t;for(var n=0;n<e;n++){t=this._getPreviousTourEntry();if(!t){this.destroy();return}}if(t.chapterDefinition.name!==this._currentChapterDefinition.name){this._currentChapterDefinition=t.chapterDefinition;this._initializeChapterClasses()}this._setupTourPageViewController(t.pageDefinition);c.Tracker.track("helpTour move back pages",{chapterName:this._currentChapterDefinition.name,pagesViewed:this._pagesViewed,chapterPageIndex:t.pageDefinition.pageIndex})},_getPreviousTourEntry:function(){var e;for(var t=0;t<1e4;t++){this._tourHistory.shift();if(this._tourHistory.length===0){e=null;break}e=this._tourHistory[0];if(!e.pageDefinition.noHistory){break}}return e},earlyExit:function(e){c.Tracker.track("helpTour early exit",{chapterName:this._currentChapterDefinition.name,pagesViewed:this._pagesViewed,chapterPageIndex:this._tourHistory[0].pageIndex,reason:e});this.destroy()},finish:function(){c.Tracker.track("helpTour finish",{chapterName:this._currentChapterDefinition.name,pagesViewed:this._pagesViewed,chapterPageIndex:this._tourHistory[0].pageIndex});this.destroy()},closeClicked:function(){l.postNotification({eventName:"tourHelpCloseClicked",sender:this})},changeChapter:function(e,t){this._resetTourPageViewController();var i=this._getChapterDefinition(e);this._currentChapterDefinition=i;this._initializeChapterClasses();if(!n.isNumber(t)){t=0}var r={chapterDefinition:this._currentChapterDefinition,pageIndex:t,pageDefinition:this._currentChapterDefinition.pages[t]};this._tourHistory.unshift(r);this._setupTourPageViewController(r.pageDefinition)},_getChapterDefinition:function(e){var t=this._chapters;for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e){return JSON.deepClone(i)}}return null},delay:function(t){return new e.Promise(function(e,n){setTimeout(e,t)})},destroy:function(){d.currentChapterViewController=null;this._notifyTourFinished();s.ViewController.prototype.destroy.call(this);this._isDestroyed=true}});d.stopCurrentTour=function(){if(d.currentChapterViewController){d.currentChapterViewController.destroy()}};i.set("BentoBox.Tour.TourChapterViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TourPageViewController",superclass:s.ViewController,_memberVariables:[{name:"_widgets",destroy:false},{name:"_pageDefinition",destroy:false},{name:"_tourWidgetFactory",destroy:false},{name:"_nextPageSelectorTimer",destroy:true},{name:"_isDestroyed",destroy:false}],_initialize:function(){s.ViewController.prototype._initialize.call(this);this._widgets=[];this._isDestroyed=false},run:function(e,t){this._pageDefinition=e;this._tourWidgetFactory=t;this._loadOnEnter()},_loadOnEnter:function(){if(!this._pageDefinition.onEnter&&!this._pageDefinition.onEnterFunctionArray){this._waitForSelector();return}if(this._pageDefinition.onEnter){this._handleOnEnter();return}this._handleOnEnterFunctionArray()},_handleOnEnter:function(){var e=this._getBasicTourCallbacks();var t=this._convertWidgetFunction(this._pageDefinition.onEnter);var n=t(e);if(this._isDestroyed){return}if(!n){this._waitForSelector();return}n.then(this._waitForSelector.bind(this))},_handleOnEnterFunctionArray:function(){if(this._isDestroyed){return}var t=this;var n=this._getBasicTourCallbacks();var i=[];var r=this._pageDefinition.onEnterFunctionArray;for(var a=0;a<r.length;a++){var o=this._convertWidgetFunction(r[a]);var s=o(n);if(s){i.push(s)}}if(i.length===0){this._waitForSelector()}else{e.RSVP.Promise.all(i).then(this._waitForSelector.bind(this)).catch(function(e){c.logError("error in TourPageViewController._handleOnEnterFunctionArray",e)})}},_waitForSelector:function(){if(this._isDestroyed){return}if(!this._pageDefinition.waitForSelector){this._loadWidgets();return}var e=this;n.checkAndThenRun(function(){return e._isDestroyed||t(e._pageDefinition.waitForSelector).length>0},function(){if(e._isDestroyed){return}e._loadWidgets()},50)},_getBasicTourCallbacks:function(){var e=this._delegate;return{moveBackPages:function(t){e.callFunction("moveBackPages",t)},previous:function(){e.callFunction("previous")},next:function(){e.callFunction("next")},earlyExit:function(){e.callFunction("earlyExit")},finish:function(){e.callFunction("finish")}}},_loadWidgets:function(){var e=this._pageDefinition.widgets;if(e&&e.length>0){for(var t=0;t<e.length;t++){this._loadWidget(e[t])}}this._tourWidgetFactory.flush();if(!e){this._delegate.callFunction("next");return}this._startWaitingForNextPageSelector()},_loadWidget:function(e){if(e.type==="COMPOSITE"){var t=e.widgetTypes;for(var n=0;n<t.length;n++){var i=t[n];var r=JSON.deepClone(e);r.type=i;this._loadWidget(r)}return}var a=this._processWidgetDefinition(JSON.deepClone(e));var o=this._tourWidgetFactory.get(a);if(!o){return}this._widgets.push(o);if(o.show){o.show()}},_processWidgetDefinition:function(e){this._processStrings(e);this._processFunctions(e);var t=this._delegate;e.previousFunction=function(){t.callFunction("previous")};e.nextFunction=function(){t.callFunction("next")};e.earlyExitTourFunction=function(e){t.callFunction("earlyExit",e)};e.finishFunction=function(){t.callFunction("finish")};e.closeClicked=function(){t.callFunction("closeClicked")};return e},_processStrings:function(e){for(var t in e){var i=e[t];if(t==="textBody"){e.body=i}else if(t==="htmlBody"){e.body=o.getStringWithSelector(i)}if(n.isObject(i)){this._processStrings(i)}}},_processFunctions:function(e){if(!n.isObject(e)){return}for(var t in e){if(t.toLowerCase().indexOf("function")>-1){e[t]=this._convertWidgetFunction(e[t])}var i=e[t];if(n.isObject(i)){this._processFunctions(i)}else if(n.isArray(i)){for(var r=0;r<i.length;r++){this._processFunctions(i[r])}}}},_convertWidgetFunction:function(e){var t=this._delegate;var i=null;var r=null;if(n.isString(e)){i=e}else if(n.isObject(e)){i=e.name;r=e.arguments}return function(e){if(!r){r=e}if(t){return t.callFunction(i,r,e)}}},_startWaitingForNextPageSelector:function(){if(!this._pageDefinition.goToNextPageWhenSelectorVisible&&!this._pageDefinition.goToNextPageWhenSelectorNotVisible){return}var e=this;this._nextPageSelectorTimer=n.checkAndThenRun(function(){if(e._isDestroyed){return true}if(e._pageDefinition.goToNextPageWhenSelectorVisible){return t(e._pageDefinition.goToNextPageWhenSelectorVisible).filter(":visible").length>0}if(e._pageDefinition.goToNextPageWhenSelectorNotVisible){return t(e._pageDefinition.goToNextPageWhenSelectorNotVisible).filter(":visible").length===0}},function(){if(e._isDestroyed){return}e._delegate.callFunction("next")},100)},destroy:function(){if(this._pageDefinition.onExit){var e=this._convertWidgetFunction(this._pageDefinition.onExit);var t=this._getBasicTourCallbacks();e(t)}for(var n=0;n<this._widgets.length;n++){this._tourWidgetFactory.release(this._widgets[n])}s.ViewController.prototype.destroy.call(this);this._isDestroyed=true}});i.set("BentoBox.Tour.TourPageViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TourWidgetFactory",superclass:e.Object,_memberVariables:[{name:"_widgetMap",destroy:false},{name:"_listOfAllReusableWidgets",destroy:true},{name:"_tourSelectorModifierHelper",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._widgetMap={};this._listOfAllReusableWidgets=[];this._tourSelectorModifierHelper=i.getInstance("BentoBox.Tour.TourSelectorModifierHelper")},get:function(e){var t=e.type;var n=this._processWidgetDefinition(e);return this._getWidget(t,n)},release:function(e){if(!e.reuse){e.destroy();return}if(!e.getType){e.destroy();return}var t=e.getType();var n=this._widgetMap[t];if(!n){n=[];this._widgetMap[t]=n}n.push(e);this._listOfAllReusableWidgets.push(e)},flush:function(){for(var e=0;e<this._listOfAllReusableWidgets.length;e++){this._listOfAllReusableWidgets[e].destroy()}this._listOfAllReusableWidgets.length=0},_processWidgetDefinition:function(e){var t=this["_processWidgetDefinitionFor"+e.type.camelize()];if(!t){return e}return t.call(this,e)},_processWidgetDefinitionForModal:function(e){var t={};if(typeof e.leftButton!=="undefined"){if(e.leftButton){t.cancelFunc=e.leftButton.function;t.cancelText=e.leftButton.name;t.cancelButtonColor=e.leftButton.color}else{t.showCancel=false}}else{t.cancelFunc=e.previousFunction;t.cancelText="Previous"}if(typeof e.rightButton!=="undefined"){if(e.rightButton){t.confirmFunc=e.rightButton.function;t.confirmText=e.rightButton.name;t.doneButtonColor=e.rightButton.color}else{t.showCancel=false}}else{t.confirmFunc=e.nextFunction;t.confirmText="Next"}t.close=false;t.force=true;t.opacity=65;t.dontStack=true;t.escClose=false;t.inner=e.body;t.title=e.title;t.width=e.width;return t},_processWidgetDefinitionForHighlight:function(e){e.targetSelector=this._tourSelectorModifierHelper.getElement(e.targetSelector);return e},_processWidgetDefinitionForWaitForClick:function(e){e.rawTargetSelector=e.targetSelector;e.targetSelector=this._tourSelectorModifierHelper.getElement(e.targetSelector);if(!e.function){e.function=e.nextFunction}return e},_processWidgetDefinitionForWaitForEvent:function(e){e.rawTargetSelector=e.targetSelector;e.targetSelector=this._tourSelectorModifierHelper.getElement(e.targetSelector);if(!e.function){e.function=e.nextFunction}if(!e.event){e.event="focusout"}return e},_processWidgetDefinitionForTooltip:function(e){e.targetSelector=this._tourSelectorModifierHelper.getElement(e.targetSelector);return e},_processWidgetDefinitionForBar:function(e){var t={html:e.body};if(typeof e.leftButton==="undefined"){t.leftButtonFunction=e.previousFunction;t.leftButtonHTML="Previous"}else{if(e.leftButton){t.leftButtonFunction=e.leftButton.function;t.leftButtonHTML=e.leftButton.name}else{t.showLeft=false}}if(typeof e.rightButton==="undefined"){t.rightButtonFunction=e.nextFunction;t.rightButtonHTML="Next"}else{if(e.rightButton){t.rightButtonFunction=e.rightButton.function;t.rightButtonHTML=e.rightButton.name}else{t.showRight=false}}return t},_processWidgetDefinitionForOverlay:function(e){var t={showLeftButton:false,showRightButton:false};if(e.leftButton){t.leftButtonFunction=e.leftButton.function;t.leftButtonText=e.leftButton.name;t.leftButtonColor=e.leftButton.color}if(e.rightButton){t.rightButtonFunction=e.rightButton.function;t.rightButtonText=e.rightButton.name;t.rightButtonColor=e.rightButton.color}t.infoHTML=e.body;t.infoCss=e.bodyCSS;if(e.tips&&e.tips.length>0){var n=[];for(var i=0;i<e.tips.length;i++){var r=e.tips[i];var a={targetElement:this._tourSelectorModifierHelper.getElement(r.targetSelector),description:r.body,buttons:r.buttons};n.push(a)}t.tips=n}return t},_processWidgetDefinitionForBottomModal:function(e){if(e.backButtonFunction){return}e.backButtonFunction=e.finishFunction;return e},_getWidget:function(e,t){var n=this._widgetMap[e];if(n&&n.length>0){var i=n.pop();i.reuse(t);this._listOfAllReusableWidgets.removeVal(i);return i}return this["_create"+e.camelize()](t)},_createModal:function(e){return c.Widgets.Modal.create(e)},_createHighlight:function(e){return c.Widgets.Tour.Highlight.create(e)},_createTooltip:function(e){var t=new c.Widgets.Tour.GmailTooltip;t.setup(e);return t},_createBar:function(e){return c.Widgets.Tour.Bar.create(e)},_createOverlay:function(e){return c.Widgets.Tour.Overlay.create(e)},_createWaitForClick:function(e){var t=new c.Widgets.Tour.WaitForClick;t.setup(e);return t},_createWaitForEvent:function(e){var t=new c.Widgets.Tour.WaitForEvent;t.setup(e);return t},_createFunction:function(e){e.function(e.callbacks)},_createBottomModal:function(e){var t=new c.Widgets.Tour.BottomModal;t.setup(e);return t}});i.set("BentoBox.Tour.TourWidgetFactory",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TourSelectorModifierHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getElement:function(e){if(e.indexOf(".gmail_")===-1){return e}return this._processGmailSelector(e)},_processGmailSelector:function(e){var t=e.match(/(\.gmail_.*?)(\s|$|:)/);if(!t){return e}var n=t[1];var i=e.replace(n,"");if(n.indexOf("inboxRow")>-1){return this._getGmailInboxRow(n)}return this._getGmailElement(n)},_getGmailElement:function(e){var t=e.replace(".gmail_","");if(r["get"+t.camelize()]){return r["get"+t.camelize()]()}return this["_getGmail"+t.camelize()]()},_getGmailInboxRow:function(){return r.getVisibleThreadRows()[0].rowNode}});i.set("BentoBox.Tour.TourSelectorModifierHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxTourHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},skipPageIfAnyBoxExists:function(e){var t=c.Data.getAllBoxes();if(t&&t.length>0){e.next()}},skipPageIfBoxExists:function(e){var t=r.getConversationId();var n=c.Data.getPipelineBoxes(t);if(n&&n.length>0){e.next()}},skipPageIfOnBoxView:function(e){if(c.UI.isBoxView()){e.next()}},skipPageIfMoreThanOneBoxExists:function(e){var t=c.Data.getAllBoxes();if(t&&t.length>1){e.next()}}});i.set("BentoBox.Tour.HelperClass.BoxTourHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ComposeTourHelper",superclass:e.Object,_memberVariables:[{name:"_composeWindowViewController",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this)},openComposeWindow:function(){var t=this;return new e.RSVP.Promise(function(e,n){r.GmailComposeWindowRequester.requestNewComposeWindow(function(n){t._composeWindowViewController=n;e()})})},openComposeToolbarOverflow:function(){var t=this;return e.Utils.wait(1).then(function(){return t._composeWindowViewController.openComposeToolbarOverflow()})},closeComposeWindow:function(){if(!this._composeWindowViewController.isDestroyed()){try{this._composeWindowViewController.close()}catch(e){}}},ensureTrackingIsOff:function(){this._composeWindowViewController.notify("turnOffTracking")},contactUs:function(e){r.GmailComposeWindowRequester.requestNewComposeWindow(function(t){t.setToAddresses(["support@streak.com"]);e.doneFunction()})}});i.set("BentoBox.Tour.HelperClass.ComposeTourHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineTourHelper",superclass:e.Object,_memberVariables:[{name:"_newPipelineModal",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this)},skipPageIfPipelineExists:function(e){if(c.Data.getAllPipelines().length>0){e.next()}},skipPageIfOnPipelineView:function(e){if(c.UI.isPipelineView()){e.next()}},ensurePipelineListVisible:function(e){c.Modules.NavMenuController.open()},createPipeline:function(e){this._newPipelineModal=c.Widgets.NewPipelineModal.create({title:c.FirstRun.getStage()===1?c.Locale.getString("left_link_setup_first"):c.Locale.getString("left_link_make_new"),noPipelineChosenCallback:e.noPipelineCreatedFunction,pipelineSavedCallback:e.pipelineCreatedFunction});this._newPipelineModal.show()},goToPipelineView:function(){if(c.UI.isPipelineView()){return}var t=c.Data.getAllPipelines()[0];var n=new e.Promise(function(e,n){c.UI.setURL(t.link(),e)});return n},bringUpPipelineSearchBox:function(){c.Modules.PipelineView.activePipelineView.showSearchBox();var t=new e.Promise(function(e,t){setTimeout(e,500)});return t},closePipelineSearchBox:function(){c.Modules.PipelineView.activePipelineView.hideSearchBox()}});i.set("BentoBox.Tour.HelperClass.PipelineTourHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"InboxTourHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},goToInboxView:function(){r.inboxSDK.Router.goto(r.inboxSDK.Router.NativeRouteIDs.INBOX);var t=this;var i=new e.Promise(function(e,t){n.checkAndThenRun(function(){return r.getCurrentMain().find("[gh=tl]").length>0},e,100)});return i},skipPageIfGmailSettingsVisible:function(e){if(r.getGearButton().is(":FastVisible")){e.next()}},skipPageIfOnGmailSettings:function(e){if(r.view===r.Constants.Settings){e.next()}},skipPageIfOnStreakSettings:function(e){if(r.view==="settingsStreak"){e.next()}},skipPageIfInboxRowsPresent:function(e){if(r.getVisibleThreadRows().length>0){e.next()}},skipPageIfThreadWithMultipleMessagesPresent:function(e){var t=r.getMainList();var n=t.find("tr .yW:contains(()");if(n.length>0){e.next()}},skipPageIfThreadViewEnabled:function(e){if(!r.isConversationViewDisabled()){e.next()}},waitUntilConversationViewVisible:function(){return new e.RSVP.Promise(function(e,t){n.checkAndThenRun(r.isConversationVisible.bind(r),e,100)})},goToInboxViewAndWaitForSettings:function(e){r.inboxSDK.Router.goto(r.inboxSDK.Router.NativeRouteIDs.INBOX);n.checkAndThenRun(function(){return r.getGearButton().is(":FastVisible")},e.nextFunction,100)},waitForGmailSettingsVisible:function(t){var i=new e.Promise(function(e,t){n.checkAndThenRun(function(){return r.getGearButton().is(":FastVisible")},e,500)});return i}});i.set("BentoBox.Tour.HelperClass.InboxTourHelper",d)
})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailTrackingTourHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);this._searchValue=null},ensureTrackedSearchLinkVisible:function(){r.inboxSDK.NavMenu.SENT_MAIL.setCollapsed(false);var t=new e.Promise(function(e,t){setTimeout(e,100)});return t},showHasTrackingInSearch:function(e){this._searchValue=r.getSearchInput().val();r.getSearchInput().val("has:tracking")},restoreSearch:function(){r.getSearchInput().val(this._searchValue)},showUnlockPixelTracking:function(t){var n=e.Library.getInstance("BentoBox.Modules.PixelTrackingShareModalViewController");n.show(t.doneFunction)}});i.set("BentoBox.Tour.HelperClass.EmailTrackingTourHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TourSelectorHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},skipPageIfSelectorVisible:function(e,n){if(t(e).is(":visible")){n.next()}},skipPageIfSelectorNotVisible:function(e,n){if(!t(e).is(":visible")){n.next()}},wait:function(t){return new e.Promise(function(e,n){setTimeout(e,t)})}});i.set("BentoBox.Tour.HelperClass.TourSelectorHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SavedViewTourHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},skipPageIfSavedViewsExist:function(e){var t=n.some(c.Data.getAllPipelines(),function(e){return e.getSavedViews().length!=0});if(t){e.next()}},expandFirstSavedView:function(e){var n=t(".streak__savedViewsHolder .linkItem");if(!n.is(":visible")){n.parent().prev().find(".expando").simulateRawClick()}},ensureAssignedToColumnFilterSelected:function(e){var n=t(".savedViewsFilterSection .filterColumnOptions .dropdown .bbButton").text().trim();var i=c.Locale.getString("system_assigned_to").trim();if(n!==i){e.moveBackPages(2)}else{e.next()}},ensureIsAnyOfFilterOptionChosen:function(e){var n=t(".savedViewsFilterSection .filterOperationOptions .dropdown .bbButton").text().trim();var i=c.Locale.getString("filter_is_any").trim();if(n!==i){e.moveBackPages(2)}else{e.next()}},ensureMeFilterValueChosen:function(e){var n=t(".savedViewsFilterSection .filterValueOptions .streak__valuesMultiSelect").text().trim();var i="Me";if(n!==i){e.moveBackPages(2)}else{e.next()}}});i.set("BentoBox.Tour.HelperClass.SavedViewTourHelper",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.APIRequester,d=e.BentoBox;var h=function(e,t){d.Tracker.trackStreakActive(t,{eventName:e})};var f=e.Class.subclass({className:"MobileModalTourHelper",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},showIOSModal:function(n){var i=t(o.get("extendedTouriPhoneModalInner")());var r=i.find(".extendedTourIPhoneModalInput");var a=r.find("input");var s=i.find(".extendedTourIPhoneModalInputStatus");var l;var u=new e.Promise(function(e){l=e});var f=d.Widgets.Button.create({name:"Send To My Phone",color:"blue",onFunc:function(e){h("send_ios_link_attempt");f.disable();p.getOkButton().disable();f.el.html("<div>Sending...</div>");var t=a.val();c.post("promos/ioslink",{phoneNumber:t}).getPromise().then(function(e){if(e.success){h("send_ios_link_successful");f.el.html("<div>Sent!</div>");setTimeout(function(){p.close()},2*1e3)}else{h("send_ios_link_failure");p.getOkButton().enable();f.enable();f.el.html("<div>Send To My Phone</div>");s.css("color","red");s.html("Sorry there was an error. Please go to www.streak.com/iphone on your iPhone.");s.show()}},function(){s.css("color","red");s.html("Sorry there was an error. Please go to www.streak.com/iphone on your iPhone.");s.show()})}});r.find(".extendedTourIPhoneModalInputButton").append(f.el);a.on("keydown",function(e){if(e.which===13){f.on()}});a.on("focus",function(e){r.addClass("acm")});a.on("blur",function(e){r.removeClass("acm")});t.tabChain([a,f.el]);var p=d.Widgets.Modal.create({title:"Get Streak for your iPhone",width:"550px",inner:i,showConfirm:true,showCancel:false,confirmText:"No thanks",doneButtonColor:"normal",onClose:l});p.show();setTimeout(function(){a.focus()},50);return u}});i.set("BentoBox.Tour.HelperClass.MobileModalTourHelper",f)})(Streak);(function(e){var t=e._,n=e.Library,i=e.Gmail,r=e.NotificationCenter,a=e.BentoBox;var o=0;var s=e.Class.subclass({className:"ButterBarManager",superclass:e.Object,memberVariables:[{name:"_currentPacket",destroy:true},{name:"_hiddenPackets",destroy:true,defaultValue:[]}],_initialize:function(){e.Object.prototype._initialize.call(this)},_dummyPacket:{destroy:function(){},_destroyed:true,_notice:null,_pushBack:function(){},options:{}},_ancientComplainTime:2*60*1e3,FOREVER:o,showMessage:function(n,i){i=this._interpretParameters(arguments);if(i.priority==null){i.priority=-1}if(i.time==null){if(!i.operationProgressId){i.time=15*1e3}else{i.time=o}}if(i.hideOnViewChanged==null){i.hideOnViewChanged=i.time!=o}this.hideMessage(i.messageKey);var r=!this._currentPacket||i.priority>=this._currentPacket.options.priority;if(!r&&!i.persistent)return this._dummyPacket;if(i.hideOnViewChanged){i.hideOnViewChanged=false;this._initViewChangeKiller();setTimeout(function(){i.hideOnViewChanged=true},0)}if(i.persistent)this._initPersistenceManager();var a={};a.options=i;a.creationStack=e.Utils.getStackTrace();var s=this;a.destroy=t.once(function(){a._destroyed=true;s._cleanupPacketRefs();if(a._notice)a._notice.destroy();delete a._notice;clearTimeout(a.timeout)});if(!r){this._hiddenPackets.push(a)}else{this._displayPacket(a)}if(i.time!=o){a.timeout=setTimeout(a.destroy,i.time)}if(i.operationProgressId){var l=e.Promise.defer();l.promise.done(a.destroy);this._watchForOperationCompleteNotification(this,l,i.operationProgressId)}return a},showLoading:function(e){e=this._interpretParameters(arguments);e.message=e.message||a.Locale.getString("loading");e.priority=-3;e.time=o;e.persistent=true;e.hideOnViewChanged=true;return this.showMessage(e)},showSaving:function(n){n=this._interpretParameters(arguments);n=t.defaults(n,{message:a.Locale.getString("saving"),priority:-2,time:o,persistent:true,showConfirmation:true});var i=this.showMessage(n);var s=e.Promise.defer();var l=this;if(n.showConfirmation){s.promise.then(function(){l.showMessage({message:a.Locale.getString("saved"),messageKey:n.messageKey,time:1*1e3,priority:200})})}s.promise.done(function(){i.destroy();if(n.operationProgressId)r.unsubscribe({observer:s})});if(n.operationProgressId){this._watchForOperationCompleteNotification(s,s,n.operationProgressId)}return s},showError:function(e,t){t=this._interpretParameters(arguments);t.priority=100;return this.showMessage(t)},showCriticalError:function(e,t){return this.showError(e,t)},showProgress:function(n){n=t.defaults(n,{initial:"saving",progressSuccess:"generic_progress",progressError:"generic_progress_bad",completeSuccess:"generic_progress_success",completeError:"generic_progress_error",progressSuccessCallback:false,progressErrorCallback:false,completeSuccessCallback:false,completeErrorCallback:false});if(!n.operationProgressId)throw new Error("ButterBarManager.showProgress() calls require an operationProgressId!");var i={};if(n.initial){this.showMessage({message:a.Locale.getString(n.initial),messageKey:i,priority:-2,persistent:true,time:o})}var r=this;e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:n.operationProgressId},observer:i,functionToCall:function(t){var s={succeeded:t.operationProgressStats.succeeded,failed:t.operationProgressStats.failed,total:t.operationProgressStats.total};function l(e){if(typeof e=="function")return e(t,s);else return a.Locale.getString(e,s)}var u=t.operationIsComplete?5e3:o;if(t.operation.getState()===e.Operations.Operation.STATES.SUCCEEDED){if(n.progressSuccessCallback){n.progressSuccessCallback(t)}if(n.progressSuccess){r.showMessage({message:l(n.progressSuccess),messageKey:i,priority:-2,persistent:true,time:u})}}else if(t.operation.getState()===e.Operations.Operation.STATES.FAILED){if(n.progressErrorCallback){n.progressErrorCallback(t)}if(n.progressError){r.showError({message:l(n.progressError),messageKey:i,persistent:true,time:u})}}if(t.operationIsComplete){e.NotificationCenter.unsubscribe({observer:i});if(t.operationProgressStats.failed>0){if(n.completeErrorCallback){n.completeErrorCallback(t)}if(n.completeError){r.showError({message:l(n.completeError),messageKey:i})}}else{if(n.completeSuccessCallback){n.completeSuccessCallback(t)}if(n.completeSuccess){r.showMessage({message:l(n.completeSuccess),messageKey:i,priority:200,time:3e3})}}}}})},hideMessage:function(e){if(!e)return;t.map(this._hiddenPackets,function(t){if(t.options.messageKey===e)t.destroy()});if(this._currentPacket&&this._currentPacket.options.messageKey===e){this._currentPacket.destroy()}},_displayPacket:function(e){if(this._currentPacket)this._currentPacket._pushBack();this._currentPacket=e;e._notice=i.newNotice(e.options.message);var n=setTimeout(this._complainAboutAncientMessage.bind(this,e),this._ancientComplainTime);var r=this;e._pushBack=t.once(function(){clearTimeout(n);if(e._destroyed)return;delete e._notice;if(r._currentPacket===e)r._currentPacket=null;if(e.options.persistent)r._hiddenPackets.push(e);else e.destroy()});e._notice.endPromise.done(e._pushBack)},_interpretParameters:function(e){var t;if(typeof e[0]==="string"){t=e[1]||{};t.message=e[0]}else{t=e[0]||{}}return t},_initViewChangeKiller:t.once(function(){var n=this;e.Gmail.observe("viewChanged",function(){t.map(n._hiddenPackets,function(e){if(e.options.hideOnViewChanged)e.destroy()});if(n._currentPacket&&n._currentPacket.options.hideOnViewChanged)n._currentPacket.destroy()})}),_initPersistenceManager:t.once(function(){var e=this;r.subscribe({eventName:"gmail.noticesCleared",observer:this,functionToCall:function(t){if(t.noticeSpawned)return;if(e._currentPacket)e._currentPacket._pushBack();var n;do{n=e._hiddenPackets.pop()}while(n&&n._destroyed);if(n){e._displayPacket(n);t.noticeSpawned=true}}})}),_cleanupPacketRefs:function(){if(this._currentPacket&&this._currentPacket._destroyed)this._currentPacket=null;this._cleanupHiddenPacketRefs()},_cleanupHiddenPacketRefs:t.throttle(function(){this._hiddenPackets=t.filter(this._hiddenPackets,function(e){return!e._destroyed})},100,{leading:false}),_complainAboutAncientMessage:function(e){a.logError("ButterBarManager message was displayed for more than "+this._ancientComplainTime+" milliseconds.\n"+"creationStack:\n"+e.creationStack,null,JSON.stringify({options:e.options}));e.destroy()},_watchForOperationCompleteNotification:function(e,t,n){r.subscribe({eventName:"operationProgressUpdate",observer:e,filterParameters:{operationProgressId:n,operationIsComplete:true},unsubscribeImmediately:true,functionToCall:function(e){if(!e.operationProgressStats.failed)t.resolve();else t.reject()}})}});n.set("BentoBox.ButterBarManager",new s)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s="T-I-Js-IF",l="T-I-Js-Gs";var u=e.Class.subclass({className:"ToolbarManager",superclass:e.Object,memberVariables:[{name:"_buttons",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._buttons=[];r.observe("viewChanged",this._update.bind(this));r.observe("toolbarUpdate",this._update.bind(this))},registerButton:function(e){if(!e||!e.element||!e.showFor){throw new Error("button missing properties")}this._buttons.push(e);this._update()},_checkShowFor:function(e,t){if(n.isFunction(e)){return e(t)}else if(n.isArray(e)){return n.intersection(t,e).length>0}else if(n.isString(e)){return n.contains(t,e)}},_getViewTags:function(){var e=[];var t=r.isInConversation()?"conversation":r.getLiveView();switch(t){case"inbox":case"starred":case"imp":case"label":case"search":case"sent":case"spam":case"trash":case"apps":case"all":e.push("threadList");e.push("threadSelection");break;case"drafts":e.push("drafts");break;case"conversation":e.push("conversation");e.push("threadSelection");break;case"pipeline":e.push("pipeline");break;case"box":e.push("box");break}return e},_updateButtonForIconMode:function(e,t){t.toggleClass("streak__iconMode",e);var n=t.find(".buttonText").toggle(!e);if(e){var i=n.text();t.attr({"aria-label":i,"data-tooltip":i})}else{t.removeAttr("aria-label data-tooltip")}},_update:function(){var e=this;var t=this._getViewTags();var i;if(t.length){i=n.filter(this._buttons,function(n){return e._checkShowFor(n.showFor,t)})}var a=n.difference(this._buttons,i);n.each(a,function(e){e.element.detach()});var u=["default"];if(n.intersection(t,["threadList","conversation"])){u.push("archiveGroup");u.push("moveGroup")}var c=n.groupBy(i,function(e){var t=typeof e.placement=="string"?[e.placement]:e.placement;return n.intersection(t,u)[0]||"default"});u.forEach(function(e){if(!c[e]){c[e]=[]}});var d=r.isIconButtonModeActive();n.each(c,function(i,a){i=n.sortBy(i,"orderHint");n.each(i,function(t,n){t.element.toggleClass(l,a!="default"||n!=0).toggleClass(s,n!=i.length-1);e._updateButtonForIconMode(d,t.element)});if(a=="archiveGroup"){var u=r.getDeleteButton().first();var c=u.nextAll().filter(":not(.bbButton)").length>0;u.toggleClass(s,c||i.length>0);n.each(i.reverse(),function(e,t){if(c&&t==i.length-1){e.element.addClass(s)}e.element.insertAfter(u).show()})}else if(a=="moveGroup"){var h=r.getMoveAndLabelDropdownButtons().last();h.toggleClass(s,i.length>0);n.each(i.reverse(),function(e){e.element.insertAfter(h).show()})}else if(a=="default"){var f=r.getCurrentMoreButton().first();var p=!n.contains(t,"threadList")||r.getSelectedThreadRows().length>0;n.each(i.reverse(),function(e){e.element.insertAfter(f).toggle(p)})}else{o.logError("unknown button placement type",null,{placement:a})}})}});i.set("BentoBox.Services.ToolbarManager",new u)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s=e.Class.subclass({className:"EmailOptionManager",superclass:e.Object,memberVariables:[{name:"_buttons",destroy:true},{name:"_menu",destroy:false},{name:"_email",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._buttons=[];r.observe("emailMenuOpen",this._menuOpen.bind(this));r.observe("viewChanged",this._onViewChanged.bind(this))},registerButton:function(e){this._buttons.push(e);this._buttons=n.sortBy(this._buttons,"orderHint");this._update()},_clearManagedItems:function(){if(this._menu){this._menu.find(".emailOptionManagerRuler, .emailOptionManagerItem").remove()}},_onViewChanged:function(e){if(e!="conversation"){this._clearManagedItems();this._menu=null;this._email=null}},_menuOpen:function(e,t){this._clearManagedItems();this._menu=e;this._email=t;this._update()},_showFor:function(e,t){if(!t.showFor){return true}else{return t.showFor(e)}},_update:function(){if(!this._menu){return}this._clearManagedItems();var e=this,i=this._menu,a=this._email;var s=r.getMessageIdFromElement(a);if(!s){o.logError("Could not get message id for email",null,{$emailLength:a.length});return}var l=n.filter(this._buttons,this._showFor.bind(this,s));if(l.length){i.append(t("<div/>").addClass("J-Kh").addClass("emailOptionManagerRuler"));n.each(l,function(e){var a=t("<div/>").addClass("J-N").addClass("emailOptionManagerItem").attr("role","menuitem").text(e.text).click(function(){r.closeActiveEmailMenu();e.fn(s)}).hover(function(){t(this).addClass("J-N-JT")},function(){t(this).removeClass("J-N-JT")}).appendTo(i);n.each(e.extraCSSClasses,function(e){a.addClass(e)})})}}});e.DependencyManager.addFunction({functionKey:"emailOptionManagerInitialized",functionReference:function(){i.set("BentoBox.Services.EmailOptionManager",new s)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"FeatureLimiter",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},incrementUsage:function(e){if(!e){e=1}var t=this._getFeatureKey()+"/count";var n=c.LocalSettings.get(t)||0;c.LocalSettings.set(t,n+e)},isLocked:function(){if(c.isFeatureEnabled(this._getFeatureKey())){return false}return this._isOverLimit()},showGateway:function(){var e=this._getGatewayTitle();var t=this._getGatewayBodyText();var n=this._getFeatureKey();var i=new c.Widgets.PaywallGatewayViewController({title:e,text:t});i.show({closed:function(e){if(e){c.Tracker.track(n+"GatewayUpgradePressed")}else{c.Tracker.track(n+"GatewayCancelPressed")}}});c.Tracker.track(n+"GatewayShown")},_isOverLimit:function(){var e=this._getFeatureKey()+"/count";var t=c.LocalSettings.get(e)||0;return t>=this._getLimit()},_getFeatureKey:function(){throw new Error("must define _getFeatureKey")},_getGatewayTitle:function(){throw new Error("must define _getGatewayTitle")},_getGatewayBodyText:function(){throw new Error("must define _getGatewayBodyText")},_getLimit:function(){throw new Error("must define _getLimit")}});i.set("BentoBox.Services.FeatureLimiter",d)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s=e.Class.subclass({className:"MoreMenuManager",superclass:e.Object,memberVariables:[{name:"_buttons",destroy:true},{name:"_menu",destroy:false},{name:"_lastView",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._buttons=[];r.observe("moreMenuOpen",this._menuOpen.bind(this));r.observe("viewChanged",this._onViewChanged.bind(this))},registerButton:function(e){this._buttons.push(e);this._buttons=n.sortBy(this._buttons,"orderHint");this._update()},_clearManagedItems:function(){if(this._menu){this._menu.find(".moreManagerRuler, .moreManagerItem").remove()}},_onViewChanged:function(e){if(this._lastView&&this._lastView!=e){this._clearManagedItems();this._menu=null;this._email=null}this._lastView=e},_menuOpen:function(e,t){this._clearManagedItems();this._menu=e;this._email=t;this._update()},_showFor:function(e,t){return t.showFor(e)},_enableFor:function(e,t){return!t.enableFor||t.enableFor(e)},_update:function(){if(!this._menu){return}this._clearManagedItems();var e=this,i=this._menu;var a=r.isInConversation()?"conversation":r.getLiveView();var o=i.find(".J-N").first().parent();var s=n.filter(this._buttons,this._showFor.bind(this,a));if(s.length){o.append(t("<div/>").addClass("J-Kh").addClass("moreManagerRuler"));n.each(s,function(i){var s=e._enableFor(a,i);var l=t("<div/>").addClass("J-N-Jz").text(i.text);var u=t("<div/>").addClass("J-N").addClass("moreManagerItem").attr("role","menuitem").append(l).appendTo(o);n.each(i.extraCSSClasses,function(e){u.addClass(e)});if(s){u.click(function(){r.getCurrentMoreButton().simulateRawClick();i.fn()}).hover(function(){t(this).addClass("J-N-JT")},function(){t(this).removeClass("J-N-JT")})}else{u.addClass("J-N-JE").show().attr("aria-disabled",true)}})}}});e.DependencyManager.addFunction({functionKey:"moreMenuManagerInitialized",functionReference:function(){i.set("BentoBox.Services.MoreMenuManager",new s)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e._;var n=FileStore={RESERVATION_SIZE:50*1024*1024,init:function(){this._isActive=false;this._validEmailPath="/"+e.userEmail.replace("@","_").replace(".","_")+"/";this._filer=new e.Filer;try{this._filer.init({persistent:false,size:this.RESERVATION_SIZE},function(e){n._isActive=true},function(){})}catch(t){this._isActive=false}},isEnabled:function(){return this._isActive},load:function(e,t){if(!this._isActive){this._callCallback(t,null)}var i=this._validEmailPath+e;this._filer.open(i,function(e){n._readAndParseJSONFile(e,t)},function(){n._callCallback(t,null)})},store:function(e,t,i){if(!e){this._callCallback(i);return}var r=this._validEmailPath+e;this._makeDirectory(r,function(){n._writeFile(r,t,i)})},remove:function(e,n){if(!t.isFunction(n)){n=function(){}}this._filer.rm(this._validEmailPath+e,n)},_makeDirectory:function(e,n){var i=t.initial(e.split("/")).join("/");this._filer.mkdir(i,false,n,this._logError)},_writeFile:function(e,t,i){this._filer.write(e,{data:t,type:"text",append:false},function(e,t){n._callCallback(i,e)},this._logError)},_readAndParseJSONFile:function(e,t){if(!e){this._callCallback(t,null);return}var i=new FileReader;i.onload=function(){var e;if(i.result){try{e=JSON.parse(i.result)}catch(r){n._logError(r)}}n._callCallback(t,e)};i.onerror=this._logError;i.readAsText(e,"UTF-8")},_callCallback:function(e){if(e){e.apply(null,t.rest(arguments))}},_logError:function(t){e.BentoBox.logError("problem with file store",t)}};e.FileStore=FileStore;e.DependencyManager.addFunction({functionKey:"fileStoreLoaded",functionReference:FileStore.init,functionContext:FileStore})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=function(e){this.options=null;this.setOptions(e)};n.extend(s.prototype,{defaults:{},initialized:false,init:function(e){if(!this.initialized&&this.initializeWidget){this.initializeWidget(e)}else if(e){e()}},setOptions:function(e){this.options=n.extend({},this.defaults,this.options,e)},destroy:function(){}});o.Widgets.Widget=s;o.Widgets.UIControllers={}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"FormulaValueLabel",superclass:s.ViewController,_memberVariables:[{name:"_unbinders",destroy:false}],_initialize:function(e){s.ViewController.prototype._initialize.call(this);this._model=e.model;this._property=e.property;this._fieldKey=e.fieldKey;this._box=e.box;this._view.addClass("streak__formulaValueLabel");this._bindToModel();this._updateDisplay()},getElement:function(){return this._view.getElement()},setEnabled:function(e){},_bindToModel:function(){l.unsubscribe({observer:this});this._model.watch("set",this._updateDisplay,this,this._property)},_updateDisplay:function(){this._view.setHTML(this._getValue())},_getValue:function(){var e=this._model.get(this._property);if(!e){return""}switch(e.calculationStatus){case"SUCCESS":if(n.isReal(e.calculationValue)){return c.Models.BoxField.getFormulaHTMLForType(e,this._box,this._fieldKey)}else{return""}break;case"NOT_ATTEMPTED":return c.Locale.getString("formula_calculating");break;default:return this._getErrorHTML(e)}},_getErrorHTML:function(e){var t=c.Locale.getString("formula_error_"+e.calculationStatus.toLowerCase());if(e.errorDetails){t+=": \n\n"+n.escape(e.errorDetails)}return'<div class="streak__formulaError" data-tooltip="'+t+'">Error</div>'},destroy:function(){l.unsubscribe({observer:this});s.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.FormulaValueLabel",d)})(Streak);(function(e){var t=e.$,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"PipelineLockdownWarningView",superclass:a,_memberVariables:[{name:"_message",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._message=this._element.find(".streak__message")},_setupElement:function(){this._element=t(i.getElement("streak__pipeline_lockdown_warning"))},setWarning:function(){this._element.removeClass("streak__pipeline_lockdown").show()},setLockdown:function(){this._element.addClass("streak__pipeline_lockdown").show()},setHelpButton:function(e){this._element.find(".streak__lockdown_learn_more").html(e.getElement())},setEmailButton:function(e){this._element.find(".streak__email_button").html(e.getElement())},setRemoveButton:function(e){this._element.find(".streak__remove_button").html(e.getElement())},setUpgradeButton:function(e){this._element.find(".streak__lockdown_upgrade_button").html(e.getElement())},toggleUpgrade:function(e){if(e){this._element.find(".streak__upgrade").show().css("display","")}else{this._element.find(".streak__upgrade").hide()}},toggleEmail:function(e){if(e){this._element.find(".streak__email").show().css("display","")}else{this._element.find(".streak__email").hide()}},toggleRemove:function(e){if(e){this._element.find(".streak__remove").show().css("display","")}else{this._element.find(".streak__remove").hide()}},setDaysRemaining:function(e){this._element.find(".streak__days_remaining").text(e)},setTotalCollaborators:function(e){this._element.find(".streak__numberOfCollaborators").text(e)},hide:function(){this._element.hide()}});n.set("BentoBox.Widgets.PipelineLockdownWarningView",o)})(Streak);(function(e){var t=e.$,n=e._,i=e.Gmail,r=e.Library,a=e.Locale,o=e.UI,s=e.BentoBox,l=s.Tracker;var u=o.ViewController;var c={USER_PLAN_IS_TOO_SMALL:1,USER_HAS_NO_PLAN:2,BILLING_ADMIN_PLAN_TOO_SMALL:3};var d=e.Class.subclass({className:"PipelineLockdownWarningViewController",superclass:u,_memberVariables:[{name:"_pipeline",destroy:false},{name:"_participatingPlans",destroy:false},{name:"_billingPlanInstances",destroy:false},{name:"_emailButton",destroy:true},{name:"_upgradeButton",destroy:true},{name:"_removeButton",destroy:true},{name:"_peopleToEmail",destroy:false},{name:"_peopleToRemove",destroy:false},{name:"_peopleToAdd",destroy:false},{name:"_numberOfPeopleNeededOnNewPlan",destroy:true},{name:"_helpButton",destroy:true},{name:"_problems",destroy:true},{name:"_status",destroy:true},{name:"_daysRemaining",destroy:true},{name:"_totalCollaborators",destroy:true},{name:"_helpModal",destroy:true},{name:"_timedUpdateID",destroy:false},{name:"_helpUpgradeAllButton",destroy:true},{name:"_removeCollaboratorsLink",destroy:true},{name:"_canUpgradeUsers",destroy:true},{name:"_pipelineSharingSettingsModalViewController",destroy:true}],_initialize:function(e){u.prototype._initialize.call(this);this._pipeline=e;this._setupEmailButton();this._setupUpgradeButton();this._setupRemoveButton();this._setupHelpButton();this._setupParticipatingPlans();this._setupBillingPlans();this._setupTimedUpdate();this._updateCollaboratorStatus();this._subscribeToPipelineStatusChanges()},destroy:function(){this._removeHelpModal();e.NotificationCenter.unsubscribe({observer:this});this._clearTimedUpdate();u.prototype.destroy.apply(this,arguments);this.destroyed=true},_setupParticipatingPlans:function(){this._participatingPlans=s.Data.getParticipatingPlans();if(!this._participatingPlans.getHasLoaded()){this._participatingPlans.refresh(this._updateCollaboratorStatus.bind(this))}this._participatingPlans.watch("change",this._updateCollaboratorStatus,this)},_setupBillingPlans:function(){this._billingPlanInstances=s.Data.getBillingPlanInstances();if(!this._billingPlanInstances.getHasLoaded()){this._billingPlanInstances.refresh(this._updateCollaboratorStatus.bind(this))}this._billingPlanInstances.watch("change",this._updateCollaboratorStatus,this)},_subscribeToPipelineStatusChanges:function(){this._pipeline.watch("change",this._updateCollaboratorStatus,this)},_setupView:function(){this._view=r.getInstance("BentoBox.Widgets.PipelineLockdownWarningView")},_updateCollaboratorStatus:function(){var e=!this.destroyed&&this._userPlanLoaded()&&this._billingPlanLoaded();if(!e){if(this._view)this._view.hide();return}this._status=this._pipeline.getCollaborationStatus();if(this._status==="OK"){this._view.hide();return}var t=[];this._daysRemaining=this._pipeline.getNumberOfDaysUntilLockdown();this._totalCollaborators=this._pipeline.get("numberOfTotalCollaborators");this._view.setTotalCollaborators(this._totalCollaborators);this._view.setDaysRemaining(this._daysRemaining);this._orgWideCollaborators=this._pipeline.get("numberOfOrgWideOnlyCollaborators");var i=this.getBillingPlanInstance();var r=!!i;var a=!!this.getUserPlan();var o=this._pipeline.get("problematicCollaborators");var u=n.select(o,this._onAPlan);var d=n.reject(u,function(e){if(!r)return false;var t=e.planInstance;if(!t)return false;return t.get("key")===i.get("key")});var h=n.reject(o,this._onAPlan);var f=h.length>0&&a&&!r;if(d.length>0||f){this._canUpgradeUsers=false;this._peopleToEmail=[];if(d.length>0){t=t.concat(n.map(d,function(e){return{problem:c.USER_PLAN_IS_TOO_SMALL,collaborator:e}}));this._peopleToEmail=this._peopleToEmail.concat(d)}if(f){t=t.concat(n.map(h,function(e){return{problem:c.USER_HAS_NO_PLAN,collaborator:e}}));this._peopleToEmail=this._peopleToEmail.concat(h)}this._view.toggleEmail(true);this._view.toggleUpgrade(false)}else{this._canUpgradeUsers=true;if(this._totalCollaborators>this.getPlanCollaboratorLimit()){t.push({problem:c.BILLING_ADMIN_PLAN_TOO_SMALL,currentPlan:this.getPlanName(),currentPlanLimit:this.getPlanCollaboratorLimit()})}if(h.length>0){t=t.concat(n.map(h,function(e){return{problem:c.USER_HAS_NO_PLAN,collaborator:e}}))}this._peopleToAdd=h;this._view.toggleEmail(false);this._view.toggleUpgrade(true)}this._view.toggleRemove(true);this._peopleToRemove=o;this._problems=t;if(this._status==="LOCKDOWN"){this._view.setLockdown();l.track("lockdownWarning.pipelineLockedDownShown")}else if(this._status==="WARNING"){this._view.setWarning();l.track("lockdownWarning.pipelineWarningShown")}else{s.logError("Collaborator status took an unexpected value",status);this._view.hide()}},_onAPlan:function(e){return e.planKey&&e.planKey!==""},_isBillingAdmin:function(e){return e.get("planInstance")},getUserPlan:function(){if(!this._userPlanLoaded()){throw new Error("User plan was not loaded when getUserPlan was called")}return this._participatingPlans[0]},getBillingPlanInstance:function(){if(!this._billingPlanLoaded()){throw new Error("Admin billing plan was not loaded when getBillingPlanInstance was called")}return n.select(this._billingPlanInstances,function(e){return e.isActive()})[0]},_setupEmailButton:function(){var e=this;this._emailButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:s.Locale.getString("pipeline_collaborator_email_users"),color:"blue",onFunction:function(){e._emailButtonPressed()}});this._view.setEmailButton(this._emailButton)},_setupUpgradeButton:function(){var e=this;this._upgradeButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:s.Locale.getString("pipeline_collaborator_upgrade_plan"),color:"blue",onFunction:function(){e._upgradeButtonPressed()}});this._view.setUpgradeButton(this._upgradeButton)},_setupRemoveButton:function(){var e=this;this._removeButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:s.Locale.getString("pipeline_collaborator_remove_from_plan"),color:"blue",onFunction:function(){e._removeButtonPressed()}});this._view.setRemoveButton(this._removeButton)},_setupHelpButton:function(){var e=this;this._helpButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:a.getString("pipeline_collaborator_learn_more"),color:"blue",onFunction:function(){e._helpButtonPressed()}});this._view.setHelpButton(this._helpButton)},_emailButtonPressed:function(){l.track("lockdownWarning.emailButtonPressed");var e=this;i.GmailComposeWindowRequester.requestNewComposeWindow(function(t){t.setToAddresses(n.map(e._peopleToEmail,function(e){return e.user.email}));t.setSubject(a.getString("pipeline_collaborator_email_subject",{pipeline:e._pipeline.get("name")}));var i=e._problemsBody();t.setEmailBody(i.innerHTML)})},_problemsBody:function(){var e=this;var i=t("<div></div>");var r=a.getString(this._orgWideCollaborators?"pipeline_collaborator_email_body_prelude_org_wide":"pipeline_collaborator_email_body_prelude",{pipeline:this._pipeline.get("name"),totalCollaborators:this._totalCollaborators,orgWideCollaborators:this._orgWideCollaborators,explicitCollaborators:this._totalCollaborators-this._orgWideCollaborators});
i.append("<p>"+r+"</p>");var o=t("<ul></ul>");n.each(this._problems,function(n){var i=t("<li></li>");if(n.problem===c.USER_HAS_NO_PLAN){i.html(a.getString("pipeline_collaborator_problem_user_no_plan",{user:n.collaborator.user.email,totalCollaborators:e._totalCollaborators}))}else if(n.problem===c.USER_PLAN_IS_TOO_SMALL){i.html(a.getString("pipeline_collaborator_problem_user_small_plan",{user:n.collaborator.user.email,totalCollaborators:e._totalCollaborators}))}else if(n.problem===c.BILLING_ADMIN_PLAN_TOO_SMALL){return}else{throw new Error("Unknown problem type")}o.append(i)});i.append(o);if(this._status==="WARNING"){var s=a.getString("pipeline_collaborator_email_body_end_warning",{days:this._daysRemaining});i.append("<p>"+s+"</p>")}if(this._status==="LOCKDOWN"){var l=a.getString("pipeline_collaborator_email_body_end_lockdown");i.append("<p>"+l+"</p>")}return i[0]},_upgradeButtonPressed:function(){l.track("lockdownWarning.upgradeButtonPressed");s.Modules.PaywallViewMasterController.showPaywall({peopleToAdd:this._peopleToAdd,numberOfPeopleNeededOnNewPlan:this._totalCollaborators>this.getPlanCollaboratorLimit()?this._totalCollaborators:null})},_removeButtonPressed:function(){l.track("lockdownWarning.removeButtonPressed");this._setupSharingModal()},_setupSharingModal:function(){if(this._pipelineSharingSettingsModalViewController){this._pipelineSharingSettingsModalViewController.destroy()}this._pipelineSharingSettingsModalViewController=new s.Services.PipelineSharingSettings.PipelineSharingSettingsModalViewController(this._pipeline);this._pipelineSharingSettingsModalViewController.show()},_helpButtonPressed:function(){l.track("lockdownWarning.learnMorePressed");if(!this._helpModal){this._helpModal=r.getInstance("BentoBox.Widgets.Tour.BottomModal");this._helpModal.setup({title:a.getString("pipeline_collaborator_help_title"),body:this._getHelpBody(),displayAlone:true,finishFunction:this._removeHelpModal.bind(this)});this._helpModal.show()}},_getHelpBody:function(){var e=this;var i=t("<div></div>");var r=a.getString("pipeline_collaborator_lockdown_help_body1",{pipeline:this._pipeline.displayName(),totalCollaborators:this._totalCollaborators,neededPlan:l});i.append("<p>"+r+"</p>");var o=t("<ul></ul>");n.each(this._problems,function(e){var n=t("<li></li>");if(e.problem===c.USER_HAS_NO_PLAN){n.text(e.collaborator.user.email)}else if(e.problem===c.USER_PLAN_IS_TOO_SMALL){n.text(e.collaborator.user.email)}else if(e.problem===c.BILLING_ADMIN_PLAN_TOO_SMALL){return}else{throw new Error("Unknown problem type")}o.append(n)});i.append(o);var l;if(this._totalCollaborators>5){l="Starter Plan"}if(this._totalCollaborators>10){l="Corporate Plan"}if(this._totalCollaborators>25){l="Enterprise Plan"}var u=a.getString("pipeline_collaborator_lockdown_help_neededPlan",{neededPlan:l});i.append(u);if(this._status==="WARNING"){var d=a.getString("pipeline_collaborator_email_body_end_warning",{days:this._daysRemaining});i.append("<p>"+d+"</p>")}if(this._status==="LOCKDOWN"){var h=a.getString("pipeline_collaborator_email_body_end_lockdown");i.append("<p>"+h+"</p>")}var f=t(document.createElement("div"));f.addClass("streak__pipelineLockdownHelp_removeCollaboratorsWrapper");if(this._canUpgradeUsers){this._helpUpgradeAllButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:a.getString("upgrade_all_users"),onFunction:this._upgradeButtonPressed.bind(this)});var p=t(document.createElement("div"));p.addClass("streak__pipelineLockdownHelp_upgradeButton");p.append(this._helpUpgradeAllButton.getElement());i.append(p);f.addClass("streak__pipelineLockdownHelp_removeCollaboratorsWrapperWithUpgradeButton");f.append(s.Locale.getString("or"))}this._removeCollaboratorsLink=s.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:s.Locale.getString("remove_some_collaborators"),onFunction:function(){e._setupSharingModal()}});f.append(this._removeCollaboratorsLink.getElement());i.append(f);return i},_removeHelpModal:function(){if(this._helpModal){this._helpModal.destroy()}delete this._helpModal},_billingPlanLoaded:function(){return this._billingPlanInstances&&this._billingPlanInstances.getHasLoaded()},_userPlanLoaded:function(){return this._participatingPlans&&this._participatingPlans.getHasLoaded()},getPlanName:function(){if(this.getUserPlan()){this.getUserPlan().getLocalizedName()}else{return a.getString("free_plan_name")}},getPlanCollaboratorLimit:function(){if(this.getUserPlan()){this.getUserPlan().get("collaboratorLimit")}else{return 5}},getEmailFromCollaborator:function(e){return e.user.email},getDisplayNameFromCollaborator:function(e){return e.user.displayName},_clearTimedUpdate:function(){if(this._timedUpdateID){clearInterval(this._timedUpdateID);this._timedUpdateID=null}},_setupTimedUpdate:function(){this._clearTimedUpdate();this._timedUpdateID=setInterval(this._updateCollaboratorStatus.bind(this),1e3*60*60)}});r.set("BentoBox.Widgets.PipelineLockdownWarningViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(){e.ViewControllerBase.call(this);this._view=new i.Widgets.SearchSimpleView;this._view.addDelegate(this);this._suppressTab=false};l.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(l.prototype,{reset:function(){this._view.reset()},focus:function(){this._view.focus()},getFocusElement:function(){return this._view.getFocusElement()},setPlaceholder:function(e){this._view.setPlaceholder(e)},clearQuery:function(){this._view.clearQuery();this.queryChange("")},setQuery:function(e){this._view.setQuery(e)},setEnabled:function(e){this._view.setEnabled(e)},getView:function(){return this._view},queryChange:function(e){this._callDelegateFunction("queryChange",e)},getQuery:function(){return this._view.getQuery()},keyPressed:function(e,t){this._callDelegateFunction("keyPressed",e,t)},keydown:function(t){this._callDelegateFunction("keydown",t);if(this._suppressTab){if(e.jwerty.is("tab",t)){t.preventDefault()}}},setSupressTab:function(e){this._suppressTab=e},destroy:function(){e.ViewControllerBase.prototype.destroy.call(this);this._view.destroy()},inputFocus:function(e){this._callDelegateFunction("inputFocus",e)},inputBlur:function(e){this._callDelegateFunction("inputBlur",e)},isEmpty:function(){return this._view.isEmpty()}});i.Widgets.SearchSimpleVC=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(n){e.ViewControllerBase.call(this);this._el=t(r.get("simpleSearchMain")());this._initInput()};l.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(l.prototype,{_initInput:function(){this._input=this._el.find(".streak__simpleinput");this._setupKeybinding();this._setupFocusBlurEvents()},_setupKeybinding:function(){var t=this;this._input.off("keyup");this._input.on("keyup",function(e){if(t._currValue!==t._input.val()){t._queryChange(t._input.val())}t._callDelegateFunction("keyPressed",e.which,t._isCursorAtEnd());e.stopPropagation()});this._input.off("keydown");this._input.on("keydown",function(n){t._callDelegateFunction("keydown",n);if(e.jwerty.is("down/up",n)){n.preventDefault()}})},_setupFocusBlurEvents:function(){var e=this;this._input.on("focus",function(t){e._callDelegateFunction("inputFocus",t);e._el.addClass("acm");e._el.removeClass("aco")});this._input.on("blur",function(t){e._callDelegateFunction("inputBlur",t);e._el.addClass("aco");e._el.removeClass("acm")})},setPlaceholder:function(e){if(!o.isReal(e)){return}this._input[0].setAttribute("placeholder",e)},getEl:function(){return this._el},getElement:function(){return this._el},getFocusElement:function(){return this._input},focus:function(){this._input.focus()},clearQuery:function(){this._input.val("");this._currValue=""},setQuery:function(e){this._input.val(e);this._queryChange(e)},getQuery:function(){return this._input.val()},reset:function(){this._setupKeybinding();this.clearQuery()},setEnabled:function(e){this._input.prop("disabled",!e);if(e){this._el.removeClass("disabled")}else{this._el.addClass("disabled")}},_queryChange:function(e){this._currValue=e;this._callDelegateFunction("queryChange",e)},_isCursorAtEnd:function(){return this._input.caret().start>=this._input.val().length},isEmpty:function(){return this._input.val().length===0},destroy:function(){e.ViewControllerBase.prototype.destroy.call(this);this._el.remove()}});i.Widgets.SearchSimpleView=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.jwerty,l=e.Date;var u=function(){e.ViewControllerBase.call(this)};u.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(u.prototype,{keyPressed:function(e,t){if(e===s.KEYS.keys.right){this._callDelegateFunction("cursorRight",t)}if(e===s.KEYS.keys.left){this._callDelegateFunction("cursorLeft")}},keydown:function(e,t){var n=e.which;if(s.is("enter",e)){this._callDelegateFunction("cursorEnter");e.preventDefault();e.stopPropagation()}if(n===s.KEYS.keys.up){this._callDelegateFunction("cursorUp");e.preventDefault()}if(n===s.KEYS.keys.down){this._callDelegateFunction("cursorDown");e.preventDefault()}}});i.Modules.CursorController=u})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(){this._delegates=[];this._view=new i.Widgets.BoxesDetailsView};o.extend(l.prototype,{setModel:function(e){this._model=e;this._view.setModel(e)},getView:function(){var e=this;return e._view},hideView:function(){var e=this;e._view.hide()},addDelegate:function(e){var t=this;t._delegates.push(e)},destroy:function(){this._view.destroy()}});i.Widgets.BoxesDetailsVC=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(){var e=this;e._delegates=[];e._el=t(r.get("boxesDetailsPaneHolder")({}));e._templates={};e._templates.boxDetails=r.get("boxesDetailsPane")};o.extend(l.prototype,{getEl:function(){return this._el},getElement:function(){return this._el},setModel:function(e){var t=this;t._model=e;t._refresh()},hide:function(){var e=this;e._el.hide()},_refresh:function(){var e=this;e._el.show();var t=e._el.find(".streak__boxname");e._el.empty();var n=e._displayBox(e._model);e._el.append(n)},addDelegate:function(e){var t=this;t._delegates.push(e)},_displayBox:function(e){var n=this;var r=e.getPipeline();var a=t(n._templates.boxDetails());a.find(".boxName").text(e.get("name"));a.find(".pipelineName").text(i.Locale.getString("in")+" "+r.displayName());if(e.get("notes")){a.find(".boxNotes").show();a.find(".boxNotes").plainText(e.get("notes"))}else{a.find(".boxNotes").hide()}var s="<b>"+i.Locale.getString("stage")+":</b>"+e.getStageName();var l=r.getFields();for(var u=0;u<l.length;u++){var c=e.getFieldDisplayTextValue(l[u].key());if(c){if(s.length>0){s+="<br />"}s+="<b>"+r.getFields()[u].displayName()+":</b>"+o.escape(c)}}a.find(".boxFieldValues").html(s);return a},destroy:function(){this._el.remove()}});i.Widgets.BoxesDetailsView=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;o.Widgets.SidebarAssignedTo={templates:{},defaults:{imgHeight:25,imgWidth:25,numPerRow:-1,border:"never",model:null,delayedBind:false,bindTab:false},init:function(e){this.templates.wrapper=a.get("peoplePicker");if(e){e()}},create:function(e){var t={};n.extend(t,this.defaults,e);return new o.Widgets.SidebarAssignedTo.impl(t)}};o.Widgets.SidebarAssignedTo.impl=function(t){var i=n.extend(t,{model:t.box,property:"assignedToSharingEntries",existingList:t.pipeline.getAllAssignedToValues(),jsonified:false,onlyValidEmailAddress:true});var r=o.Widgets.PeoplePicker.create(i);e.NotificationCenter.subscribe({eventName:"409Conflict",filterParameters:{model:t.box},observer:r,functionToCall:function(){r.updateDisplay(true)}});return r};e.DependencyManager.addFunction({functionKey:"widgets.sidebarAssignedTo.initialized",functionToCall:o.Widgets.SidebarAssignedTo.init,functionContext:o.Widgets.SidebarAssignedTo,dependentFunctionKeys:["htmlLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){};n.extend(l.prototype,{createButton:function(e){e.buttonType=this._getButtonType(e);return s.Widgets.Buttons.NewButton.create(e)},createToggleButton:function(e){e.buttonType=this._getButtonType(e);return s.Widgets.Buttons.ToggleButton.create(e)},createMenuButton:function(e){e.buttonType=this._getButtonType(e);var t;if(e.isFixedPosition){t=s.Widgets.Buttons.FixedPositionMenuButton.create(e)}else{t=s.Widgets.Buttons.MenuButton.create(e)}return t},createTooltipMenuButton:function(e){e.buttonType=this._getButtonType(e);return new s.Widgets.Buttons.TooltipMenuButton(e)},createSplitMenuButton:function(e){e.buttonType=this._getButtonType(e);return new s.Widgets.Buttons.SplitMenuButton(e)},createChecklistMenuButton:function(e){e.buttonType=this._getButtonType(e);return new s.Widgets.Buttons.ChecklistMenuButton(e)},createMultiSelectMenuButton:function(e){e.buttonType=this._getButtonType(e);return new s.Widgets.Buttons.MultiSelectMenuButton(e)}});n.extend(l.prototype,{_getButtonType:function(e){return new s.Widgets.Buttons.ButtonTypes[e.type+"ButtonType"](e)}});s.Widgets.Buttons={ButtonTypes:{}};o.addFunction({functionKey:"buttonFactoryInitialized",functionToCall:function(e){s.Widgets.Buttons.ButtonFactory=new l;if(e){e()}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;var o={classes:{normal:{inactive:"T-I-ax7",hover:"T-I-JW",active:"T-I-Kq"},blue:{inactive:"T-I-atl",hover:"T-I-JW",active:"T-I-JO"},red:{inactive:"T-I-KE",hover:"T-I-JW",active:"T-I-JO"},icon:{inactive:"J-Z-I",hover:"J-Z-I-JW",active:"J-Z-I-KO"}},defaults:{button:{name:null,nameText:null,isRefresh:false,isToggle:false,enableDepressedState:true,onFunc:t.noop,offFunc:t.noop,color:"normal",hasButtonToLeft:false,hasButtonToRight:false,customButton:null,onClass:null,hoverClass:null,isDropdown:false,isOn:false,iconClassName:undefined,tooltip:undefined,tabIndex:0},group:{}},templates:{button:null,group:null,refresh:null},init:function(e){o.templates.refresh=i.get("refreshButton");if(e){e()}},create:function(e){var t={};n.extend(t,this.defaults.button,e);return new this.impl(t)},createGroup:function(e){var t={};n.extend(t,this.defaults.group,e);return new this.groupImpl(t)}};o.impl=function(e){var i=e,r=i.isOn;var s=null;var l=null;var u=false;if(i.customButton){s=t(i.customButton)}else{s=t(document.createElement("div"));l=t(document.createElement("div"));s.append(l);if(n.isDefined(i.tooltip)){s.attr("data-tooltip",i.tooltip)}if(n.isDefined(i.iconClassName)){var c=t("<div class='bbIcon' ></div>");c.addClass(i.iconClassName);s.prepend(c);if(i.name){c.attr("style","vertical-align: middle; padding-top:2px;padding-right: 4px;");l.attr("style","vertical-align: middle; display: inline-block;")}else{c.attr("style","vertical-align: middle;");s[0].setAttribute("style","min-width: 0px; padding-right: 10px; padding-left: 10px")}}s[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton");s[0].setAttribute("tabindex",i.tabIndex);if(i.isRefresh){l[0].innerHTML=o.templates.refresh()}else{if(i.name){l.append(i.name)}else if(i.nameText){l.text(i.nameText)}}if(i.isDropdown){l.append('<div class="downArrow G-asx T-I-J3 J-J5-Ji">&nbsp;</div>')}}var d=function(n,a){if(u){return}var l=i.isRefresh?"refresh":t.trim(s.text());l=i.overridenTrackingName?i.overridenTrackingName:l;if(e.isToggle){if(e.enableDepressedState){if(i.customButton){s.addClass(i.onClass)}else{s.addClass("J-Zh-I-Jo").addClass("J-Zh-I-Kq").addClass("bbActive").addClass(o.classes[i.color].active)}}r=true;if(i.enableDepressedState){s.trigger("hold")}}if(!n){i.onFunc(a)}},h=function(e){i.onFunc=e},f=function(t,n){if(r){if(!t)i.offFunc(n)}r=false;s.trigger("unhold");if(e.enableDepressedState){if(i.customButton){s.removeClass(i.onClass)}else{s.removeClass("J-Zh-I-Jo").removeClass("J-Zh-I-Kq").removeClass("bbActive").removeClass(o.classes[i.color].active)}}};if(i.hasButtonToRight){s.addClass("T-I-Js-IF")}if(i.hasButtonToLeft){s.addClass("T-I-Js-Gs")}if(i.customButton){if(i.hoverClass){s.easyHoverClass(i.hoverClass)}}else{s.addClass(o.classes[i.color].inactive);s.easyHoverClass(o.classes[i.color].hover+" J-Zh-I-JW")}s.click(function(e){if(r){f(false,e)}else{d(false,e)}e.stopPropagation()});a.Keyboard.bindChordToElement(s,"enter/space",function(){if(r){f()}else{d()}},true,true);return{setOnFunc:h,el:s,innerEl:l,on:d,off:f,getElement:function(){return s},changeIconByClass:function(e,t){if(n.isDefined(c)){c.removeClass(e);c.addClass(t)}},toggleRoundLeft:function(){var e="T-I-Js-Gs";if(n.isDefined(s)&&s.hasClass(e)){s.removeClass(e)}else if(n.isDefined(s)){s.addClass(e)}},toggleRoundRight:function(){var e="T-I-Js-IF";if(n.isDefined(s)&&s.hasClass(e)){s.removeClass(e)}else if(n.isDefined(s)){s.addClass(e)}},disable:function(){if(!i.customButton){s.addClass("T-I-JE")}s.trigger("disabled");u=true},enable:function(){if(!i.customButton){s.removeClass("T-I-JE")}s.trigger("enabled");u=false},setEnabled:function(e){if(e){this.enable()}else{this.disable()}},destroy:function(){l.remove();s.remove()}}};o.groupImpl=function(e){var n=e,i=t(document.createElement("div"));i[0].setAttribute("class","VP5otc-HT6HAf J-J5-Ji G-Ni bbButtonGroup");return{el:i,destroy:function(){i.remove()}}};e.DependencyManager.addFunction({functionKey:"widgets.button.initialized",functionToCall:o.init,functionContext:o,dependentFunctionKeys:["htmlLoaded","localeLoaded"]});a.Widgets.Button=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;var o={text:"click me",clickFunction:t.noop,stopPropagation:true,preventDefault:true};var s=function(e){this.el=t("<span/>").addClass("streak__linkButton bbButton").attr("tabindex",0).text(e.text);this.el.on("mousedown",function(e){e.preventDefault()});this.el.on("click",function(t){e.clickFunction();if(e.preventDefault){t.preventDefault()}if(e.stopPropagation){t.stopPropagation()}});var n=this;a.Keyboard.bindChordToEl({el:this.el,chord:"enter/space",cb:function(){setTimeout(function(){n.el.click()},150)},noDefault:true,noBubble:true,useCapture:true});this.getElement=function(){return this.el}};n.extend(s.prototype,{getElement:function(){return this.el},destroy:function(){this.el.remove()}});s.create=function(e){var t=n.extend({},o,e);return new s(t)};a.Widgets.LinkButton=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;BaseButtonType=function(){this._element=null;this._setupElement()};n.extend(BaseButtonType.prototype,{_setupElement:function(){throw new Error("_setupElement not defined")},getElement:function(){return this._element},setText:function(e){this._element.text(e)},setHTML:function(e){this._element[0].innerHTML=e},addClass:function(e){this._element.addClass(e)},removeClass:function(e){this._element.removeClass(e)},setTooltip:function(e){this._element[0].setAttribute("data-tooltip",e)},setTabIndex:function(e){this._element[0].setAttribute("tabindex",e)},activate:function(){},deactivate:function(){},setEnabled:function(){},setDisabled:function(){},destroy:function(){this._element.remove()}});s.Widgets.Buttons.ButtonTypes.BaseButtonType=BaseButtonType})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){s.Widgets.Buttons.ButtonTypes.BaseButtonType.call(this);this.setText(e.text)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.BaseButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("streak__circleButtonType")}});s.Widgets.Buttons.ButtonTypes.CircleButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){s.Widgets.Buttons.ButtonTypes.BaseButtonType.call(this);this.addClass(e.iconClass)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.BaseButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("streak__iconButtonType")}});s.Widgets.Buttons.ButtonTypes.IconButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox;var r=function(e){this._innerElement=null;this._color=e.color||"default";i.Widgets.Buttons.ButtonTypes.BaseButtonType.call(this);if(e.text){this.setText(e.text)}else if(e.html){this.setHTML(e.html)}if(e.hasButtonToRight){this.addClass("T-I-Js-IF")}if(e.hasButtonToLeft){this.addClass("T-I-Js-Gs")}};r.prototype=Object.create(i.Widgets.Buttons.ButtonTypes.BaseButtonType.prototype);n.extend(r.prototype,{classes:{"default":{INACTIVE_CLASS:"T-I-ax7",HOVER_CLASS:"T-I-JW",ACTIVE_CLASS:"T-I-Kq"},blue:{INACTIVE_CLASS:"T-I-atl",HOVER_CLASS:"T-I-JW",ACTIVE_CLASS:"T-I-JO"},red:{INACTIVE_CLASS:"T-I-KE",HOVER_CLASS:"T-I-JW",ACTIVE_CLASS:"T-I-JO"},icon:{INACTIVE_CLASS:"J-Z-I",HOVER_CLASS:"J-Z-I-JW",ACTIVE_CLASS:"J-Z-I-KO"},green:{INACTIVE_CLASS:"streak__gmailButton_green_inactive",HOVER_CLASS:"streak__gmailButton_green_hover",ACTIVE_CLASS:"streak__gmailButton_green_active"}},_setupElement:function(){this._element=t(document.createElement("div"));this._innerElement=t(document.createElement("div"));this._element.append(this._innerElement);this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton "+this.classes[this._color].INACTIVE_CLASS);this._element[0].setAttribute("tabIndex",-1);this._setupHoverEvents()},_setupHoverEvents:function(){this._element.easyHoverClass(this.classes[this._color].HOVER_CLASS)},getElement:function(){return this._element},setText:function(e){this._innerElement.text(e)},setHTML:function(e){this._innerElement[0].innerHTML=e},activate:function(){this.addClass(this.classes[this._color].ACTIVE_CLASS+" "+this.classes[this._color].HOVER_CLASS)},deactivate:function(){this.removeClass(this.classes[this._color].ACTIVE_CLASS+" "+this.classes[this._color].HOVER_CLASS)},setEnabled:function(){this._element.css("opacity","")},setDisabled:function(){this._element.css("opacity",.55)},setColor:function(e){this._color=e;this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton "+this.classes[this._color].INACTIVE_CLASS)},destroy:function(){this._innerElement.remove();this._element.remove()}});i.Widgets.Buttons.ButtonTypes.GmailButtonType=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){this._innerElement=null;s.Widgets.Buttons.ButtonTypes.GmailButtonType.call(this,e);this.changeIconClass(e.iconClass)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton G-Ni "+this.classes[this._color].INACTIVE_CLASS);this._innerElement=t(document.createElement("div"));this._rawIconElement=document.createElement("div");this._rawIconElement.innerHTML="&nbsp;";this._element.append(this._innerElement);this._innerElement.append(this._rawIconElement);this._setupHoverEvents()},setText:function(){},changeIconClass:function(e){this._rawIconElement.setAttribute("class",e)}});s.Widgets.Buttons.ButtonTypes.GmailIconButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){this._innerElement=null;s.Widgets.Buttons.ButtonTypes.GmailButtonType.call(this,e);this.setText(e.text)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton streak__GmailArrowButtonType G-Ni "+this.classes[this._color].INACTIVE_CLASS);this._innerElement=t(document.createElement("div"));this._innerElement[0].innerHTML='<div class="downArrow G-asx T-I-J3 - J-J5-Ji">&nbsp;</div>';this._element.append(this._innerElement);this._rawTextElement=document.createElement("span");this._rawTextElement.setAttribute("class","buttonText");this._innerElement.prepend(this._rawTextElement);this._setupHoverEvents()},setText:function(e){if(!e){t(this._rawTextElement).hide()}else{t(this._rawTextElement).show();this._rawTextElement.innerHTML=n.escape(e)}},setHTML:function(e){if(!e){t(this._rawTextElement).hide()}else{t(this._rawTextElement).show();this._rawTextElement.innerHTML=e}}});s.Widgets.Buttons.ButtonTypes.GmailArrowButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){this._innerElement=null;s.Widgets.Buttons.ButtonTypes.GmailButtonType.call(this,e);this.changeIconClass(e.iconClass);this.setText(e.text)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton streak__gmailIconArrowButtonType G-Ni "+this.classes[this._color].INACTIVE_CLASS);this._innerElement=t(document.createElement("div"));this._innerElement[0].innerHTML='<div class="downArrow G-asx T-I-J3 - J-J5-Ji">&nbsp;</div>';this._element.append(this._innerElement);this._rawIconElement=document.createElement("span");this._rawTextElement=document.createElement("span");this._rawTextElement.setAttribute("class","buttonText streak__gmailIconArrowButtonType_text");this._innerElement.prepend(this._rawTextElement);this._innerElement.prepend(this._rawIconElement);this._setupHoverEvents()},setText:function(e){this._rawTextElement.innerHTML=n.escape(e)},setHTML:function(e){this._rawTextElement.innerHTML=e},changeIconClass:function(e){this._rawIconElement.setAttribute("class",e)}});s.Widgets.Buttons.ButtonTypes.GmailIconArrowButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e){this._innerElement=null;s.Widgets.Buttons.ButtonTypes.GmailButtonType.call(this,e);this.changeIconClass(e.iconClass);this.setText(e.text)};l.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype);n.extend(l.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton G-Ni "+this.classes[this._color].INACTIVE_CLASS);this._innerElement=t(document.createElement("div"));this._rawIconElement=document.createElement("div");this._rawIconElement.innerHTML="&nbsp;";this._element.append(this._innerElement);this._innerElement.append(this._rawIconElement);this._setupHoverEvents()},setText:function(e){t(this._rawIconElement).detach();this._innerElement.text(e);this._innerElement.prepend(this._rawIconElement)},setHTML:function(e){t(this._rawIconElement).detach();this._innerElement.html(e);this._innerElement.prepend(this._rawIconElement)},changeIconClass:function(e){this._rawIconElement.setAttribute("class",e)}});s.Widgets.Buttons.ButtonTypes.GmailTextIconButtonType=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=function(e){this._mainButton=null;this._arrowButton=null;this._color=e.color||"default";c.Widgets.Buttons.ButtonTypes.GmailButtonType.call(this,e);this.setText(e.text)};d.prototype=Object.create(c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype);n.extend(d.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("J-J5-Ji streak__gmailSplitArrowButtonType T-I");this._setupMainButton();this._setupArrowButton()},_setupMainButton:function(){this._mainButton=new c.Widgets.Buttons.ButtonTypes.GmailButtonType({hasButtonToRight:true});this._element.append(this._mainButton.getElement())},_setupArrowButton:function(){this._arrowButton=t(document.createElement("div"));this._arrowButton[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton streak__GmailArrowButtonType G-Ni T-I-Js-Gs "+c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].INACTIVE_CLASS);this._arrowButton[0].innerHTML='<div class="downArrow G-asx T-I-J3 - J-J5-Ji">&nbsp;</div>';this._element.append(this._arrowButton)},_setupHoverEvents:function(){},getMainClickableElement:function(){return this._mainButton.getElement()},getMenuClickableElement:function(){return this._arrowButton},getElement:function(){return this._element},setText:function(e){this._mainButton.setText(e);return this},setHTML:function(e){this._mainButton.setHTML(e);return this},activate:function(){this._arrowButton.addClass(c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].ACTIVE_CLASS+" "+c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].HOVER_CLASS);return this},deactivate:function(){this._arrowButton.removeClass(c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].ACTIVE_CLASS+" "+c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].HOVER_CLASS);return this},setEnabled:function(){this._element.css("opacity","");return this},setDisabled:function(){this._element.css("opacity",.55);return this},disableMenu:function(){this._arrowButton.css("opacity",.55);return this},enableMenu:function(){this._arrowButton.css("opacity","");return this},setColor:function(e){this._color=e;this._mainButton.setColor(e);this._arrowButton[0].setAttribute("class","T-I J-J5-Ji ar7 L3 J-Zh-I bbButton streak__GmailArrowButtonType G-Ni T-I-Js-Gs "+c.Widgets.Buttons.ButtonTypes.GmailButtonType.prototype.classes[this._color].INACTIVE_CLASS);return this},destroy:function(){this._mainButton.destroy();this._element.remove()}});i.set("BentoBox.Widgets.Buttons.ButtonTypes.GmailSplitArrowButtonType",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;TextButtonType=function(e){s.Widgets.Buttons.ButtonTypes.BaseButtonType.call(this);if(e.text){this.setText(e.text)}else if(e.html){this.setHTML(e.html)}this.setColor(e.color)};TextButtonType.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.BaseButtonType.prototype);n.extend(TextButtonType.prototype,{classes:{blue:"streak__textButton_blue",cornflowerblue:"streak__textButton_cornflowerBlue",lightblue:"streak__textButton_lightBlue"},_setupElement:function(){this._element=t(document.createElement("span"));this._element.addClass("streak__textButton");this.setTabIndex(-1)},setColor:function(e){if(!e){return}this._element.addClass(this.classes[e])}});s.Widgets.Buttons.ButtonTypes.TextButtonType=TextButtonType})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;TextArrowButtonType=function(e){s.Widgets.Buttons.ButtonTypes.TextButtonType.call(this,e);this.setText(e.text);this.setColor(e.color)};TextArrowButtonType.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.TextButtonType.prototype);n.extend(TextArrowButtonType.prototype,{_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("streak__textButton streak__textArrowButton");this._element[0].innerHTML='<span class="streak__textArrowButton_text"></span><div class="downArrow G-asx T-I-J3 - J-J5-Ji">&nbsp;</div>'},setText:function(e){this._element.find(".streak__textArrowButton_text").text(e)},setHTML:function(e){this._element.find(".streak__textArrowButton_text").html(e)},getMainClickableElement:function(){return this._element.find(".streak__textArrowButton_text")},getMenuClickableElement:function(){return this._element.find(".downArrow")}});s.Widgets.Buttons.ButtonTypes.TextArrowButtonType=TextArrowButtonType})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;
XButtonType=function(e){s.Widgets.Buttons.ButtonTypes.BaseButtonType.call(this)};XButtonType.prototype=Object.create(s.Widgets.Buttons.ButtonTypes.BaseButtonType.prototype);n.extend(XButtonType.prototype,{_setupElement:function(){this._element=t(document.createElement("span"));this._element.addClass("Kj-JD-K7-Jq");this._element.addClass("streak__littleX")}});s.Widgets.Buttons.ButtonTypes.XButtonType=XButtonType})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={templates:{},defaults:{css:{left:"0px",width:"auto"},buttonCss:{},buttonInner:"",showButtonArrow:true,menuInner:"",onFunc:t.noop,postOnFunc:t.noop,offFunc:t.noop,postOffFunc:t.noop,color:"normal",closeOnSelect:true,customButton:null,onClass:null,hoverClass:null,justMenu:false,dynamicPosition:false,fixedPosition:false,rightAligned:false,bottomAligned:false,menu:null,isLast:false,identityClass:null,attachTo:null},init:function(e){this.templates.menu=r.get("buttonMenuMenu");if(e){e()}},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(e){var r=e,s=a.Widgets.Button.createGroup(),l=r.menu||t(o.templates.menu({inner:r.menuInner})),u=r.justMenu,c=false,d=null,h=null;if(r.trackingContext){r.trackingContext.widgetContext="/buttonMenu"}s.el.addClass(r.identityClass);var f=function(e){c=true;if(!r.onFunc(e)){l.show();if(r.dynamicPosition){}else if(r.fixedPosition){l.css({position:"fixed",left:"auto"})}else if(r.isLast){l.css({left:-1*l.width()})}if(r.bottomAligned){if(r.fixedPosition){l.css("bottom",i.elements.body[0].clientHeight-g.offset().top+"px")}else{l.css("bottom",_.el.outerHeight()+"px")}}else{if(r.fixedPosition){l.css("top",g.offset().top+g.outerHeight()+"px")}}if(r.rightAligned){var t=r.justMenu?_:_.el;var n;if(r.dynamicPosition){n=t.position().left}else if(r.fixedPosition){n=t.offset().left}l.css({left:n+(t.outerWidth()-l.outerWidth())});l.css({minWidth:l.width()})}if(r.fixedPosition){l.containByScreen(g)}if(r.postOnFunc){r.postOnFunc(e)}if(e){e.stopPropagation()}l.bodyCloseAndStop({closeFunction:function(){if(c&&!u){_.off()}else if(c&&u){p()}},body:i.elements.body,stop:u?_[0]:s.el[0]})}},p=function(e){c=false;r.offFunc(e);l.hide();if(r.postOffFunc){r.postOffFunc(e)}if(e){e.stopPropagation()}l.unbindBodyCloseAndStop()},m=function(){return c},_=null,g=null;if(u){d=p;h=f;_=r.customButton;_.on("click.buttonMenu",function(e){if(c){p()}else{f()}});g=_}else{_=a.Widgets.Button.create({name:r.buttonInner,isToggle:true,onFunc:function(e){f(e)},offFunc:function(e){p(e)},color:r.color,hasButtonToLeft:r.hasButtonToLeft,hasButtonToRight:r.hasButtonToRight,customButton:r.customButton,onClass:r.onClass,hoverClass:r.hoverClass,isDropdown:r.showButtonArrow});g=_.el;_.el.css(r.buttonCss);s.el.append(_.el);if(r.attachTo){r.attachTo.append(l)}else{s.el.append(l)}}l.hide();l.css(r.css);l.click(function(e){if(r.closeOnSelect){_.off()}e.stopPropagation()});var v=function(e){if(_){if(_.enable&&_.disable){if(e){_.enable()}else{_.disable()}}else if(_.on&&_.off){if(e){_.on(".buttonMenu")}else{_.off(".buttonMenu")}}}};return{el:s.el,group:s,button:_,menu:l,setEnabled:v,on:h||_.on,off:d||_.off,isOn:m,getElement:function(){return s.el},getButtonElement:function(){return g},updateOptions:function(e){n.extend(r,e)},destroy:function(){if(n.isFunction(_.destroy)){_.destroy()}l.remove();s.destroy()}}};e.DependencyManager.addFunction({functionKey:"widgets.buttonMenu.initialized",functionToCall:o.init,functionContext:o,dependentFunctionKeys:["htmlLoaded","localeLoaded"]});a.Widgets.ButtonMenu=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;var o={buttonType:null,onFunction:t.noop};var s=function(e){var t=n.extend({},o,e);a.Widgets.Widget.call(this,t);this._isDisabled=false;this._buttonType=t.buttonType;this._setupEventBindings(t.useEventBubbling)};s.prototype=Object.create(a.Widgets.Widget.prototype);n.extend(s.prototype,{on:function(){if(this._isDisabled){this.getElement().simulateHover();return}if(this.options.onFunction){this.options.onFunction()}},enable:function(){if(!this._isDisabled){return}this._isDisabled=false;this._buttonType.setEnabled()},disable:function(){if(this._isDisabled){return}this._isDisabled=true;this._buttonType.setDisabled()},toggleDisabled:function(e){if(e){this.disable()}else{this.enable()}},setColor:function(e){this._buttonType.setColor(e)},setText:function(e){this._buttonType.setText(e)},setHTML:function(e){this._buttonType.setHTML(e)},addClass:function(e){this._buttonType.addClass(e)},removeClass:function(e){this._buttonType.removeClass(e)},setTooltip:function(e){this._buttonType.setTooltip(e)},setTabIndex:function(e){this._buttonType.setTabIndex(e)},changeIconClass:function(e){this._buttonType.changeIconClass(e)},setOnFunction:function(e){if(!this.options){this.options={}}this.options.onFunction=e},destroy:function(){this._buttonType.destroy()},getElement:function(){return this._buttonType.getElement()},_setupEventBindings:function(e){var t=this;this.getElement()[0].addEventListener("click",function(e){t._buttonClicked();e.preventDefault();e.stopImmediatePropagation()},!e);a.Keyboard.bindChordToEl({el:this.getElement(),chord:"enter/space",cb:function(){setTimeout(function(){t._buttonClicked()},150)},noDefault:true,noBubble:true,useCapture:true})},_buttonClicked:function(){this.on()}});s.create=function(e){return new s(e)};s.classes={normal:{inactive:"T-I-ax7",hover:"T-I-JW",active:"T-I-Kq"},blue:{inactive:"T-I-atl",hover:"T-I-JW",active:"T-I-JO"},red:{inactive:"T-I-KE",hover:"T-I-JW",active:"T-I-JO"},icon:{inactive:"J-Z-I",hover:"J-Z-I-JW",active:"J-Z-I-KO"}};a.Widgets.Buttons.NewButton=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l={holdOnState:true,noDeactivation:false};var u=function(e){var t=n.extend({},l,e);s.Widgets.Buttons.NewButton.call(this,t);this._isOn=e.isOn||false;this._noDeactivation=e.noDeactivation;if(!this._isOn&&!this._noDeactivation){this._buttonType.deactivate()}};u.prototype=Object.create(s.Widgets.Buttons.NewButton.prototype);n.extend(u.prototype,{on:function(){if(this._isDisabled){this.getElement().simulateHover();return}this._isOn=true;s.Widgets.Buttons.NewButton.prototype.on.call(this);if(!this._noDeactivation){this._buttonType.activate()}},off:function(){if(this._isDisabled){this.getElement().simulateHover();return}this._isOn=false;if(!this._noDeactivation){this._buttonType.deactivate()}if(this.options.offFunction){this.options.offFunction()}},_buttonClicked:function(){if(this._isOn){this.off()}else{this.on()}}});u.create=function(e){return new u(e)};s.Widgets.Buttons.ToggleButton=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l={menu:null,preOnFunction:null,postOnFunction:null,preOffFunction:null,postOffFunction:null,doesEscapeCloseMenu:true,menuClickTriggersOff:false};var u=function(e){if(!e.menu){throw new Error("need a menu widget")}var t=n.extend({},l,e);s.Widgets.Buttons.ToggleButton.call(this,t);this._escapeUnbinder=null};u.prototype=Object.create(s.Widgets.Buttons.ToggleButton.prototype);n.extend(u.prototype,{on:function(){if(this._isDisabled){this.getElement().simulateHover();return}if(this.options.preOnFunction){if(this.options.preOnFunction()){return}}s.Widgets.Buttons.ToggleButton.prototype.on.call(this);this._showMenu();if(this.options.postOnFunction){this.options.postOnFunction()}if(!this.options.noCloseOnOutsideClick){this._registerGlobalClickBinding()}},_showMenu:function(){this._buttonType.getElement().after(this.options.menu.getElement());this.options.menu.getElement().show();this.options.menu.getElement().css({position:"",top:"",bottom:"",left:"",right:""})},off:function(){if(this._isDisabled){this.getElement().simulateHover();return}if(this.options.preOffFunction){if(this.off.preOffFunction()){return true}}s.Widgets.Buttons.ToggleButton.prototype.off.call(this);if(!this.options.noCloseOnOutsideClick){this._unregisterGlobalClickBinding()}this._hideMenu();if(this.options.postOffFunction){this.options.postOffFunction()}},_hideMenu:function(){this.options.menu.getElement().detach()},_registerGlobalClickBinding:function(){var e=this;this.options.menu.getElement().bodyCloseAndStop({closeFunction:function(){e.off()},body:i.elements.body,stop:this._buttonType.getElement(),useCapture:this.options.useCapture,stopOnSelf:!this.options.menuClickTriggersOff});if(this.options.doesEscapeCloseMenu){this._escapeUnbinder=s.Keyboard.bindChordToEl({el:this.options.menu.getElement(),chord:"escape",noBubble:true,noDefault:true,cb:function(){e.off()}})}},_unregisterGlobalClickBinding:function(){this.options.menu.getElement().unbindBodyCloseAndStop();if(this.options.doesEscapeCloseMenu&&this._escapeUnbinder){this._escapeUnbinder()}},destroy:function(){if(this._isOn){this.off()}s.Widgets.Buttons.ToggleButton.prototype.destroy.call(this)}});u.create=function(e){if(!e.menu){throw new Error("need a menu widget")}return new u(e)};s.Widgets.Buttons.MenuButton=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l={isBottomAligned:false,isRightAligned:false};var u=function(e){if(!e.menu){throw new Error("need a menu widget")}var t=n.extend({},l,e);s.Widgets.Buttons.MenuButton.call(this,t)};u.prototype=Object.create(s.Widgets.Buttons.MenuButton.prototype);n.extend(u.prototype,{_showMenu:function(){var e=this.options.menu.getElement();var t=this._buttonType.getElement();i.elements.body.append(e);e[0].style.position="fixed";e.containByScreen(t,this.options)}});u.create=function(e){return new u(e)};s.Widgets.Buttons.FixedPositionMenuButton=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={content:null,preOnpreOnFunction:null,postOnFunction:null,preOffFunction:null,postOffFunction:null,doesEscapeCloseMenu:true};var h=function(e){if(!e.content){throw new Error("need tooltip content")}var t=n.extend({},d,e);t.menu=e.content;c.Widgets.Buttons.MenuButton.call(this,t);this._tooltipViewController=null};h.prototype=Object.create(c.Widgets.Buttons.MenuButton.prototype);n.extend(h.prototype,{_showMenu:function(){this._initializeTooltipViewController();this._tooltipViewController.show();this._tooltipViewController.addArrowClass("streak__tooltipMenuButton_tooltipArrow")},_initializeTooltipViewController:function(){this._destroyTooltip();this._tooltipViewController=new c.Widgets.TooltipViewController;this._tooltipViewController.setContent(this.options.content);this._tooltipViewController.setTarget(this.getElement());this._tooltipViewController.hideClose();this._tooltipViewController.setPlacement({position:"bottom"});this._tooltipViewController.getView().addClass("streak__tooltipMenuButton_tooltip")},_hideMenu:function(){this._destroyTooltip()},_registerGlobalClickBinding:function(){var e=this;this._tooltipViewController.getView().getElement().bodyCloseAndStop({closeFunction:function(){e.off()},body:r.elements.body,stop:this._buttonType.getElement()});if(this.options.doesEscapeCloseMenu){this._escapeUnbinder=c.Keyboard.bindChordToEl({el:this._tooltipViewController.getView().getElement(),chord:"escape",noBubble:true,noDefault:true,cb:function(){e.off()}})}},_unregisterGlobalClickBinding:function(){this._tooltipViewController.getView().getElement().unbindBodyCloseAndStop();if(this.options.doesEscapeCloseMenu&&this._escapeUnbinder){this._escapeUnbinder()}},_destroyTooltip:function(){if(!this._tooltipViewController){return}this._tooltipViewController.destroy();this._tooltipViewController=null},destroy:function(){this._destroyTooltip();c.Widgets.Buttons.MenuButton.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.Buttons.TooltipMenuButton",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=function(e){c.Widgets.Buttons.FixedPositionMenuButton.call(this,e);this._isMenuDisabled=false};d.prototype=Object.create(c.Widgets.Buttons.FixedPositionMenuButton.prototype);n.extend(d.prototype,{on:function(){if(this._isDisabled){this.getElement().simulateHover();return}if(this.options.preOnFunction&&this.options.preOnFunction()){return}this._isOn=true;this._showMenu();if(this.options.postOnFunction){this.options.postOnFunction()}this._registerGlobalClickBinding();this._buttonType.activate()},_setupEventBindings:function(e){var t=this;this._getMainClickableElement()[0].addEventListener("click",function(e){c.Widgets.Buttons.NewButton.prototype.on.call(t);e.preventDefault();e.stopImmediatePropagation()},!e);c.Keyboard.bindChordToEl({el:this._getMainClickableElement(),chord:"enter/space",cb:function(){setTimeout(function(){c.Widgets.Buttons.NewButton.prototype.on.call(t)},150)},noDefault:true,noBubble:true,useCapture:true});this._getMenuClickableElement()[0].addEventListener("click",function(e){if(t._isMenuDisabled){return}t._buttonClicked();e.preventDefault();e.stopImmediatePropagation()},!e);c.Keyboard.bindChordToEl({el:this._getMenuClickableElement(),chord:"enter/space",cb:function(){if(t._isMenuDisabled){return}setTimeout(function(){c.Widgets.Buttons.NewButton.prototype.on.call(t)},150)},noDefault:true,noBubble:true,useCapture:true})},disableMenu:function(){this._buttonType.disableMenu();this._isMenuDisabled=true},enableMenu:function(){this._buttonType.enableMenu();this._isMenuDisabled=false},_getMainClickableElement:function(){return this._buttonType.getMainClickableElement()},_getMenuClickableElement:function(){return this._buttonType.getMenuClickableElement()}});c.Widgets.Buttons.SplitMenuButton=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;CollapseSection={templates:{},defaults:{title:"Section",bodyEl:null,startOpen:true,openFunc:t.noop,closeFunc:t.noop,localToggleStateKey:null,titleClick:true},init:function(e){this.templates.main=i.get("collapseSection");if(e){e()}},create:function(e){var t={};n.extend(t,this.defaults,e);return new a.Widgets.CollapseSection.impl(t)}};CollapseSection.impl=function(e){var i=e.title,r=e.bodyEl,o=e.localToggleStateKey,s=(o&&n.isReal(a.LocalSettings.get(o))?a.LocalSettings.get(o):e.startOpen)||false,l=t(document.createElement("div")),u=function(){l.toggleClass("open",s);if(s){l.find(".bbIndicator").removeClass("Wo").addClass("Wq")}else{l.find(".bbIndicator").removeClass("Wq").addClass("Wo")}},c=function(t){if(n.isReal(t)){s=t}else{s=!s}u();if(o){a.LocalSettings.set(o,s)}if(s){e.openFunc()}else{e.closeFunc()}},d=function(e){i=e;l.find(".titleSection .title").text(i)},h=function(e){l.find(".streak__titleRight").remove();var n=t(document.createElement("div"));n.addClass("streak__titleRight");n.append(e);l.find(".titleSection").append(n)};l.addClass("collapseSection");l[0].innerHTML=CollapseSection.templates.main();var f=l.find(".titleSection");var p=l.find(".bodySection");p.append(r);var m="bbCursorClick";if(e.titleClick){m+=" click"}l.find(".titleSection").on(m,function(e){c()});if(o){c(s)}else{u()}d(i);return{el:l,titleSection:f,bodySection:p,toggle:c,updateTitle:d,addToRightOfTitle:h,isOpen:function(){return s},destroy:function(){l.remove()}}};e.DependencyManager.addFunction({functionKey:"widgets.collapseSection.initialized",functionToCall:CollapseSection.init,functionContext:CollapseSection,dependentFunctionKeys:["htmlLoaded"]});a.Widgets.CollapseSection=CollapseSection})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={templates:{},defaults:{label:"Pick a color",previewText:"preview",color:{backgroundColor:null,textColor:null},colorChosenFunc:function(e){},showRemove:false,removeColorFunc:function(){}},init:function(e){this.templates.container=a.get("colorPickerMenuContainer");this.templates.menu=a.get("colorPickerMenuInner")();this.templates.modal=a.get("colorPickerModal")();this.initStaticPicker();if(e){e()}},initStaticPicker:function(){var e=this;this.currentOptions=null;this.modal=null;this.selectedText=null;this.selectedBg=null;this.elements={};this.elements.innerMenu=t(this.templates.menu);this.elements.innerModal=t(this.templates.modal);this.elements.modalPreviewEl=this.elements.innerModal.find(".previewTextBox");this.elements.modalPreviewTextEl=this.elements.modalPreviewEl.find(".previewText");this.elements.innerModal.find(".background").on("click","[role=gridcell]",function(n){e.selectBackgroundColor(t(this))});this.elements.innerModal.find(".text").on("click","[role=gridcell]",function(n){e.selectTextColor(t(this))})},updateSelected:function(){if(this.currentOptions.color.backgroundColor&&this.currentOptions.color.textColor){var e=this.elements.innerMenu.find("[role=gridcell]");for(var n=0;n<e.length;n++){var i=e[n].children[0];var r=i.style.backgroundColor;var a=i.style.color;if(r===this.currentOptions.color.backgroundColor&&a===this.currentOptions.color.textColor){i.innerHTML="";t(e[n]).addClass("JA-Kn-Jr-Kw-Jn-KO")}else{i.innerHTML="a";t(e[n]).removeClass("JA-Kn-Jr-Kw-Jn-KO")}}}},openModal:function(){var e=this;t.modal.close();this.modal=o.Widgets.Modal.create({title:o.Locale.getString("color_add_custom"),confirmText:o.Locale.getString("apply"),cancelText:o.Locale.getString("modal_cancel"),inner:this.elements.innerModal,persist:true,width:"364px",confirmFunc:function(){e.currentOptions.colorChosenFunc(e.currentOptions.color);o.Tracker.trackStreakActive(e.currentOptions.trackingContext,{eventName:"choseColor",type:"modal"})}});this.modal.show();this.updateModalPreview()},updateModalPreview:function(){if(this.currentOptions.color.backgroundColor&&this.currentOptions.color.textColor){this.elements.modalPreviewEl[0].style.backgroundColor=this.currentOptions.color.backgroundColor;this.elements.modalPreviewEl[0].style.borderColor=this.currentOptions.color.backgroundColor;this.elements.modalPreviewEl[0].children[0].style.borderColor=this.currentOptions.color.backgroundColor;this.elements.modalPreviewTextEl[0].style.color=this.currentOptions.color.textColor}},selectTextColor:function(e){if(this.selectedText){this.selectedText.removeClass("ajZ-Jn-KO")}this.selectedText=e;this.selectedText.addClass("ajZ-Jn-KO");this.currentOptions.color.textColor=t(this.selectedText[0].children[0]).css("background-color");this.updateModalPreview()},selectBackgroundColor:function(e){var n,i;if(this.selectedBg){this.selectedBg.removeClass("ajZ-Jn-KO")}this.selectedBg=e;this.selectedBg.addClass("ajZ-Jn-KO");this.currentOptions.color.backgroundColor=t(this.selectedBg[0].children[0]).css("background-color");var r=e.closest(".ajZ")[0].getAttribute("group");if(r==="blackAndWhite"){var a=this.elements.innerModal.find(".text [group=blackAndWhite] td");var o=e.index();n=a.length;i=0;if(n/2>o){i=n-1}this.selectTextColor(t(a[i]))}else if(r==="solidColors"){this.selectTextColor(t(this.elements.innerModal.find(".text [group=gradients] tr").filter(":last").find("td")[e.index()]))}else if(r==="gradients"){var s=e.closest("tr").index();var l=e.index();var u=this.elements.innerModal.find(".text [group=gradients] tr");n=u.length;i=0;if(n/2>s){i=n-1}this.selectTextColor(t(t(u[i]).find("td")[l]))}},updateOptions:function(e){this.currentOptions=e;this.selectedText=null;this.selectedBg=null;if(e.showRemove){this.elements.innerMenu.filter(".removeColor").show()}else{this.elements.innerMenu.filter(".removeColor").hide()}this.elements.innerModal.find(".previewText").text(e.previewText)},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};s.impl=function(e){var n=e;var i=t(s.templates.container({label:n.label}));i.filter(".removeColor").easyHoverClass("J-N-JT");i.filter(".removeColor").click(function(e){n.removeColorFunc()});i.filter(".customColor").easyHoverClass("J-N-JT");i.filter(".customColor").click(function(e){s.openModal()});function r(){s.updateOptions(n);s.updateSelected();i.filter(".colorGrid").append(s.elements.innerMenu);i.find("[role=grid]").on({mouseenter:function(){t(this).addClass("JA-Kn-Jr-Kw-Jn-JW")},mouseleave:function(){t(this).removeClass("JA-Kn-Jr-Kw-Jn-JW")}},"[role=gridcell]");i.find("[role=grid]").on("click","[role=gridcell]",function(e){var i=t(this).find("div");var r=i.css("background-color");var a=i.css("color");n.color.backgroundColor=r;n.color.textColor=a;s.updateSelected();n.colorChosenFunc(n.color);e.stopImmediatePropagation();o.Tracker.trackStreakActive(n.trackingContext,{eventName:"choseColor",type:"grid"})})}return{el:i,showMenu:r,updateColor:function(e,t){n.color=e;n.previewText=t}}};e.DependencyManager.addFunction({functionKey:"widgets.colorPicker.initialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["htmlLoaded","localeLoaded"]});o.Widgets.ColorPicker=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;t.fn.ContactAutoSuggest=function(e){var i={doneCB:t.noop,listChangeFunc:t.noop,suggestionTemplate:t.noop,list:[],el:null,immediateDone:false,onlyValidEmailAddress:false};var a={};t.extend(a,i,e);return this.each(function(){var e=t(this);e.MultipleAutoSuggest(n.extend({data:a.list,wrapperCss:{display:"inline-block",verticalAlign:"middle"},clickStop:a.el,clickBody:r.elements.body,immediateDone:a.immediateDone,noResultsFoundText:o.Locale.getString("auto_suggest_no_results"),doneFunc:a.doneFunc,listChangeFunc:a.listChangeFunc,existingList:a.existingList,onlyValidEmailAddress:a.onlyValidEmailAddress,isRightAligned:a.isRightAligned},o.Widgets.PersonPicker.ContactAutoSuggestFunctions))})}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.StateMachine,r=e.Gmail,a=e.BentoBox;var o={templates:{},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(i){var r=i;var o=this;var s=r.box;var l=r._fileCollection;var u=function(){var t="caseKey="+encodeURIComponent(s.key())+"&email="+encodeURIComponent(a.getUser().get("email"))+"&serverURL="+encodeURIComponent(e.server)+"&clientVersion="+e.clientVersion+"&extVersion="+e.extVersion;var i=e.server+"/drivePicker.jsp?"+t;var r=800;var o=600;var u=window.screenY+(window.outerHeight/2-o/2);var c=window.screenX+(window.outerWidth/2-r/2);var d=window.open(i,"Drive Picker","height="+o+",width="+r+",top="+u+",left="+c+",toolbar=0,resizable=0,menubar=0,location=0,status=0,scrollbars=0");var h=n.repeatEvery(function(){if(d&&d.closed){h.stop();l.refresh()}},500)};var c=function(e){t.modal.close()};function d(){if(a.getUser().get("oauth2Scopes").indexOf("https://www.googleapis.com/auth/drive")===-1){h.disable();a.Widgets.Modal.confirm(a.Locale.getString("streak_reauthorize_title"),a.Locale.getString("streak_reauthorize_body"),function(){h.disable();a.Modules.TopNav.startOauth();a.bind("userReady",function(){a.Data.initOauth2Scopes(function(){d()})})},t.noop,t.noop,a.Locale.getString("streak_reauthorize_button"))}else{h.enable();u()}}var h=a.Widgets.Button.create({color:"blue",name:a.Locale.getString("add_drive_file"),onFunc:d});t(h.el).addClass("boxDriveButtons");if(s){if(s.getIsEditable()&&a.Services.AccessManager.isAccessAllowed(s.getPipeline(),"Box","UPDATE")){h.enable()}else{h.disable()}}return{destroy:function(){clearTimeout(o.timeOutId);t.modal.close();t(o.divHolder).remove();t(o.iframe).remove();t(h.el).remove()},el:h.el}};a.Widgets.DrivePickerButton=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._element=null;this._setupUIElement()};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{_setupUIElement:function(){this._element=t(document.createElement("input"));this._element[0].setAttribute("type","text");this._element[0].setAttribute("tabindex","-1");this._element[0].style.height="0px";this._element[0].style.width="0px";this._element[0].style.border="0";this._element[0].style.position="absolute";this._element[0].style.outline="none";this.setupKeyBinding()},setupKeyBinding:function(){var e=this;this._element.off("keyup");this._element.on("keyup",function(t){t.preventDefault();e._callDelegateFunction("keyPressed",t.which);t.stopPropagation();return false});this._element.on("keydown",function(t){e._callDelegateFunction("keydown",t)})},getElement:function(){return this._element},focus:function(){this._element.focus()},destroy:function(){this._element.remove()}});s.Widgets.KeyboardCaptureWidget=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={templates:{},defaults:{},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(){if(!this.templates.button){this.templates.button=a.get("iconButton")}}};s.impl=function(e){var t=e,n=s.templates.button({iconClass:t["iconClass"]});t.name=n;t.color="icon";return o.Widgets.Button.create(t)};o.Widgets.IconButton=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={templates:{},defaults:{title:null,canSubmitFunc:function(){return true},confirmFunc:t.noop,cancelFunc:t.noop,showCancel:true,cancelText:null,showConfirm:true,confirmText:null,width:"400px",minHeight:null,onClose:t.noop,inner:"",showTitle:true,doneButtonColor:"blue",cancelButtonColor:"normal",showLink:false,linkText:null,linkFunc:t.noop,escClose:true,close:true},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(){if(!this.defaults.cancelText){this.defaults.cancelText=a.Locale.getString("modal_cancel");this.defaults.confirmText=a.Locale.getString("modal_done");this.templates.modal=r.get("modalModal")}},confirm:function(e,t,n,i,r,s,l){var u=o.create({title:e,inner:t,confirmFunc:n,cancelFunc:i,onClose:r,doneButtonColor:"red",confirmText:s||a.Locale.getString("ok"),trackingContext:{eventName:"confirmModal"}});u.show();if(l){return u}setTimeout(function(){u.getOkButton().el.focus()},100);return u},simpleConfirm:function(e,t){var n=o.create({title:e,inner:t,showCancel:false,doneButtonColor:"red",confirmText:a.Locale.getString("ok"),trackingContext:{eventName:"confirmModal"}});n.show()},confirmDelete:function(e,t,i,r){var o=a.Locale.getString("confirm_delete_title",{item:e});var s=a.Locale.getString("confirm_delete_message",{item:"<strong>"+e+"</strong>"});if(i){s+="<br /><br />"+n.escape(i)}a.Widgets.Modal.confirm(o,s,t,r,null,null,true)},textboxModal:function(i){var r=i.title;var a=i.subheading;var s=i.extraText;var l=i.callback;var u=i.cancelCallback;var c=i.allowEmpty;var d=i.placeholderText||"";var h=i.startingText;var f=t(document.createElement("div"));f.addClass("streak__textboxModalInner");if(n.isReal(a)){var p=t(document.createElement("div"));p[0].innerHTML=a;f.append(p)}var m=t('<input type="text" placeholder="'+n.escape(d)+'">');f.append(m);if(n.isReal(s)){var _=t(document.createElement("div"));_.text(s);f.append(_)}if(n.isReal(h)){m.val(h)}var g=o.create({title:r,inner:f,confirmFunc:function(){if(m.val().trim().length===0&&!c){return true}var e=m.val().trim();if(e===h){return}if(n.isFunction(l)){l(e)}},cancelFunc:function(){if(n.isFunction(u)){u()}},showCancel:n.isFunction(u)});g.show();m.on("keydown",function(t){if(e.jwerty.is("enter",t)){g.confirm()}});var v=[m];if(g.getOkButton()){v.push(g.getOkButton().el)}if(g.getCancelButton()){v.push(g.getCancelButton().el)}t.tabChain(v);setTimeout(function(){m.focus()},100)}};o.impl=function(e){var r=e,s=null,l=null,u=null,c=null;if(r.trackingContext){r.trackingContext.widgetContext+="/modal";r.trackingContext.widget="modal"}var d=function(e){a.Tracker.trackStreakActive(r.trackingContext,{eventName:e})},h=function(){if(r.canSubmitFunc()){l.enable();return true}else{l.disable();return false}},f=function(){c=t(o.templates.modal({title:r.title,confirm:r.confirmText}));c.find(".inner").append(r.inner);if(!r.showTitle){c.find(".title").hide()}c.width(r.width);if(!r.showCancel&&!r.showConfirm){c.find(".buttonArea").hide()}if(r.showLink){s=a.Widgets.LinkButton.create({text:r.linkText,clickFunction:function(){r.linkFunc()}});c.find(".buttonArea").append(s.el)}if(r.showCancel){u=a.Widgets.Button.create({name:r.cancelText,onFunc:function(){d("cancelButtonPressed");r.cancelFunc();i.currentVisibleModal="";_()},isToggle:false,color:r.cancelButtonColor,trackingContext:n.clone(r.trackingContext)});c.find(".buttonArea").append(u.el)}if(r.showConfirm){l=a.Widgets.Button.create({name:r.confirmText,onFunc:function(){d("confirmButtonPressed");if(r.confirmFunc){if(r.confirmFunc()){return}}i.currentVisibleModal="";_()},isToggle:false,color:r.doneButtonColor,trackingContext:n.clone(r.trackingContext)});c.find(".buttonArea").append(l.el);h()}if(r.close){c.find(".close").click(function(e){r.cancelFunc();_()})}else{c.find(".close").css("display","none")}if(r.escClose){a.Keyboard.bindChordToElement(c,"escape",function(){r.cancelFunc();_()})}c.on("keydown",function(e){e.stopPropagation()});if(u&&l){u.el.easyTab({prev:l.el,next:l.el});l.el.easyTab({prev:u.el,next:u.el})}},p=function(e){i.currentVisibleModal=r.title;if(!c){f()}c.bbmodal({appendTo:i.elements.body,onClose:function(){i.currentVisibleModal="";if(r.onClose){r.onClose()}},dontStack:e,overlayCss:r.overlayCss});c.focus()};var m=function(){if(!c){f()}return c};var _=function(){if(c){if(c.is(":FastVisible")){t.modal.close()}}};return{show:p,checkCanSubmit:h,confirm:function(){l.on()},getEl:m,getOkButton:function(){return l},getCancelButton:function(){return u},destroy:function(){_()},close:_,getType:function(){return"MODAL"},setConfirmFunc:function(e){r.confirmFunc=e}}};a.Widgets.Modal=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.APIRequester,s=e.BentoBox;var l={};var u=[];var c=false;function d(){if(!c){l.newPipelineItem=a.get("newPipelineItem");l.group=a.get("newPipelineListGroup");h.prototype.defaults.title=s.Locale.getString("left_link_make_new");h.prototype.defaults.cancelText=s.Locale.getString("modal_done");c=true;return o.get("templates").getPromise().then(function(e){u=e})}}var h=function(e){s.Widgets.Widget.call(this,e);this.newModalInner=a.get("newPipelineModal",true);this.options.inner=this.newModalInner;this.options.cancelFunc=this.options.noPipelineChosenCallback;this.newModal=s.Widgets.Modal.create(this.options)};h.prototype=Object.create(s.Widgets.Widget.prototype);n.extend(h.prototype,{show:function(t){this.newModal.show();this.loadPipelineTemplates();if(t){this.setOptions(t)}this.newModalInner.find(".subHeadingText")[0].innerHTML=this.options.subHeadingText;this.newModal.getEl().find("span.title")[0].innerHTML=this.options.title;e.NotificationCenter.postNotification({eventName:"newPipelineModalShowing",sender:this})},loadPipelineTemplates:function(){this.newModalInner.find(".templateList").empty();var e=this;var t={};n.each(u,function(n){var i=t[n.categoryType];if(!i){i=e.renderGroup(n.categoryType)}t[n.categoryType]=i;var r=e.renderTemplate(n);i.find(".list").append(r)});this.loaded=true},renderGroup:function(e){var n=t(l.group({name:e}));this.newModalInner.find(".templateList").append(n);return n},renderTemplate:function(e){var n=this;var i=t(l.newPipelineItem({name:e.templateTitle,description:e.shortDescription,src:s.UI.getResourceURL(e.templateImageUrl),beginComment:"<!--",endComment:"-->"}));i.click(function(i){n.createNewPipeline(e);t.modal.close()});return i},createNewPipeline:function(e){var t=this;s.ButterBarManager.showLoading(s.Locale.getString("creating_pipeline"),{messageKey:"creatingPipeline"});if(t.options.pipelineChosenCallback){t.options.pipelineChosenCallback()}o.get("templates/"+e.templateType).getPromise().then(function(e){var n=s.Data.createPipelineFromTemplate(e,function(e){s.ButterBarManager.hideMessage("creatingPipeline");t.options.pipelineSavedCallback(e)});t.options.pipelinePrecreateCallback(n)},function(){s.ButterBarManager.hideMessage("creatingPipeline");s.ButterBarManager.showError("Error: Could not create pipeline")})},close:function(){this.newModal.close()},defaults:{subHeadingText:"",noPipelineChosenCallback:t.noop,pipelineChosenCallback:t.noop,pipelinePrecreateCallback:t.noop,pipelineSavedCallback:t.noop,showConfirm:false,width:"725px",maxHeight:"600px",minHeight:"600px",destroy:function(){this.newModal.close();
this.newModalInner.remove()}}});h.create=function(e){return new h(e)};h.show=function(e){var t;var n=e.noPipelineChosenCallback;e.noPipelineChosenCallback=function(){t.destroy();if(n){n()}};var i=e.pipelineSavedCallback;e.pipelineSavedCallback=function(e){t.destroy();if(i){i(e)}};t=new h(e);t.show()};s.Widgets.NewPipelineModal=h;e.DependencyManager.addFunction({functionKey:"newPipelineModalInitialized",functionReference:d,dependentFunctionKeys:["htmlLoaded","localeLoaded","userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={templates:{},defaults:{isSoftCloseEnabled:true,topbar_text:"",closeCallback:t.noop,startOpen:true,minimizeCallback:t.noop},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(){if(!this.templates.NewComposeInspiredModal){this.templates.NewComposeInspiredModal=a.get("NewComposeInspiredModal")}}};s.impl=function(e){var n=e;var i=t(s.templates.NewComposeInspiredModal({topbar_text:n.topbar_text}));var r=i.find(".streak_NCIModalContent");r.append(e.innerHTML);var a=true;var o=i.find(".streak_NCIMinimizeButton");if(n.startOpen){r.show();i.removeClass("streak_NCIModalCollapsed")}else{r.hide();i.addClass("streak_NCIModalCollapsed")}var l=function(){n.minimizeCallback();if(a){r.hide();i.addClass("streak_NCIModalCollapsed")}else{r.show();i.removeClass("streak_NCIModalCollapsed")}a=!a};o.click(function(e){e.stopPropagation();l()});var u=i.find(".streak_NCIModalTopBar");u.click(l);var c=function(e){if(n.isSoftCloseEnabled){i.hide()}else{i.remove()}};var d=i.find(".streak_NCICloseButton");d.click(function(e){n.closeCallback();c();e.stopPropagation()});return{el:i,getElement:function(){return i},destroy:function(){i.remove();n=null},close:c}};o.Widgets.NewComposeInspiredModal=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.BentoBox;var a={imgHeight:30,imgWidth:30,numPerRow:-1,border:"always",display:"grid",includeNames:false,circle:false};var o=e.UI.View;var s=e.Class.subclass({className:"PeopleList",superclass:o,memberVariables:[{name:"_options",destroy:false}],_initialize:function(e){this._options=n.defaults(e||{},a);o.prototype._initialize.call(this);if(this._options.numPerRow>-1){this._element.width(this._options.imgWidth*this._options.numPerRow+"px")}switch(this._options.border){case"never":this._element.addClass("peopleListNoborder");break;case"hover":break;case"always":this._element.addClass("peopleListBorder");break}},_setupElement:function(){this._element=t(i.getElement("peopleList"))},destroy:function(){this._element.empty();this._element.remove()},setTab:function(e,t){this._element.easyTab({prev:e,next:t})},updateDisplay:function(e){this._element.empty();if(e&&e.length>0){var t=this;n.each(e,function(e){var n=t.elementForContact(e);t._element.append(n)});this._element.append('<div style="clear:both;"></div>')}else{this._element.html("&nbsp;")}},elementForContact:function(e){e=r.Contacts.updateContact(e);var n,i;var a=e.displayName||e.fullName||e.email;var o=this.imageForContact(e);switch(this._options.display){case"grid":if(this._options.includeNames){i=t(document.createElement("div"));i.addClass("imgItem");n=t(document.createElement("span"));n.addClass("people");if(e.email){n.attr("email",e.email)}n.text(a);i.append(o);i.append(n);return i}else{return o}break;case"list":i=t(document.createElement("div"));i[0].setAttribute("class","item");n=t(document.createElement("div"));n.addClass("streak__name");n.text(a);n.css("margin-left",this._options.imgWidth+5+"px");n.css("line-height",this._options.imgHeight+"px");if(e.email){n.attr("email",e.email)}i.append(o).append(n);return i}},imageForContact:function(e){var i=t(r.Contacts.getContactImage(e,n.pick(this._options,"circle")));i.css("height",this._options.imgHeight);i.css("width",this._options.imgWidth);return i}});s.create=function(e){return new r.Widgets.PeopleList(e)};r.Widgets.PeopleList=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={border:"never",display:"list",imgHeight:32,imgWidth:32,circle:true};var s=a.Widgets.PeopleList;a.Widgets.People=e.Class.subclass({className:"People",superclass:s,memberVariables:[{name:"_emailAllButton",destroy:true},{name:"_emailIndividualButtons",destroy:true},{name:"_relatedEmailButtons",destroy:true},{name:"_contacts",destroy:true}],_initialize:function(e){e=e||{};n.defaults(e,o);s.prototype._initialize.call(this,e)},_setupElement:function(){this._element=t(r.getElement("boxViewPeople"))},findEmailsRelatedTo:function(e){a.Tracker.track("People.findEmailsRelatedTo.clicked",{trackingContext:this._options.trackingContext,contact:e.email});var t="from:"+e.email;i.setURL("search/"+encodeURIComponent(t))},emailSingleUser:function(e){a.Tracker.track("People.emailSingleUser.clicked",{trackingContext:this._options.trackingContext,contact:e.email});i.GmailComposeWindowRequester.requestNewComposeWindow(function(t){t.setToAddresses([e.email]);t.focusSubject()})},emailAllUsers:function(e){a.Tracker.track("People.emailAllUsers.clicked",{trackingContext:this._options.trackingContext});i.GmailComposeWindowRequester.requestNewComposeWindow(function(t){t.setToAddresses(n.map(e,"email"));t.focusSubject()})},updateDisplay:function(e){this._contacts=e;s.prototype.updateDisplay.call(this,e)},elementForContact:function(e){e=a.Contacts.updateContact(e);var n=e.displayName||e.fullName||e.email;var i=this.imageForContact(e);var o=t(r.getElement("boxViewPeople_item"));var s=o.find(".text");s.css("margin-left",this._options.imgWidth+5+"px");s.css("line-height",this._options.imgHeight+"px");if(e.email){s.attr("email",e.email)}s.find(".streak__name").text(n);var l=this._createButtonToEmail(e);if(l){s.find(".streak__emailButton").html(l.getElement())}var u=this._createButtonToFindRelatedEmails(e);if(u){s.find(".streak__relatedEmailsButton").html(u.getElement())}o.find(".image").html(i);return o},createEmailAllButton:function(){var e=this;var t=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:a.Locale.getString("email_all"),color:"blue",onFunction:function(){e.emailAllUsers(e._contacts)}});return t},_createButtonToEmail:function(e){if(!e.email)return null;var t=this;var n=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:e.email,color:"blue",onFunction:function(){t.emailSingleUser(e)}});return n},_createButtonToFindRelatedEmails:function(e){var t=this;var n=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:a.Locale.getString("related_emails"),color:"blue",onFunction:function(){t.findEmailsRelatedTo(e)}});return n}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"NewPeopleListViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_expandedNumberToShow",destroy:false,defaultValue:3,get:true,set:true},{name:"_collapsedMenuButton",destroy:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._expandedNumberToShow=t||this._expandedNumberToShow;this._view.addClass("streak__peopleList")},renderList:function(e){this._view.empty();if(this._collapsedMenuButton){this._collapsedMenuButton.destroy();this._collapsedMenuButton=null}if(!e||e.length===0){return}var t=Math.min(e.length,this._expandedNumberToShow);for(var n=0;n<t;n++){this._renderContact(e[n])}if(t===e.length-1){this._renderContact(e[t]);return}if(t<e.length){this._renderCollapsedContacts(t,e)}},_renderContact:function(e){var t=this._renderContactImage(e);this._view.getElement().append(t)},_renderCollapsedContacts:function(e,t){var n=t.length-e;var i=this._renderMenuContent(e,t);this._collapsedMenuButton=c.Widgets.Buttons.ButtonFactory.createTooltipMenuButton({type:"Circle",text:"+"+n,content:i});this._view.getElement().append(this._collapsedMenuButton.getElement())},_renderMenuContent:function(e,n){var i=t(document.createElement("div"));i.addClass("streak__peopleList_extraContacts");for(var r=e;r<n.length;r++){var a=this._renderExpandedContact(n[r]);i.append(a)}return i},_renderExpandedContact:function(e){var n=t(document.createElement("div"));n[0].setAttribute("class","streak__peopleList_extraContact");var i=this._renderContactImage(e);n.append(i);var r=e.displayName||e.fullName||e.email;var a=t(document.createElement("span"));a.text(r);n.append(a);return n},_renderContactImage:function(e){e=c.Contacts.updateContact(e);return c.Contacts.getContactImage(e,{circle:true})}});i.set("BentoBox.Widgets.NewPeopleListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={HOVER_CLASS:"aco",FOCUS_CLASS:"acm"};o.Widgets.PeoplePicker={templates:{},defaults:{imgHeight:25,imgWidth:25,numPerRow:-1,border:"never",model:null,delayedBind:false,bindTab:false,existingList:[],jsonified:false,parent:null,onlyValidEmailAddress:false,neverShowRead:false},create:function(e){this._init();var t={};n.extend(t,this.defaults,e);return new o.Widgets.PeoplePicker.impl(t)},_init:function(){if(!this.templates.wrapper){this.templates.wrapper=a.get("peoplePicker")}}};o.Widgets.PeoplePicker.impl=function(a){var l={};var u=null,c=null,d=null,h=false,f=null,p=false,m=false,_=null,g=o.Widgets.PeopleList.create({imgHeight:a.imgHeight,imgWidth:a.imgWidth,numPerRow:a.numPerRow,border:"hover",includeNames:a.includeNames}),v=function(){if(u){u.remove()}u=t(document.createElement("div"));u[0].innerHTML=o.Widgets.PeoplePicker.templates.wrapper();u[0].setAttribute("class","smartInput peoplePickerWrapper");u[0].setAttribute("tabindex","-1");u.append(g.getElement());if(a.model){D(a.model.getIsEditable())}c=u.find(".peoplePicker");u.click(function(e){if(!p){L()}else{d.focus()}});u.focus(function(){if(!p){r.elements.body.trigger("bodyCloseAndStop");setTimeout(function(){L()},10)}});switch(a.border){case"never":u.addClass("peoplePickerNoborder");break;case"hover":g.addClass("R5");c.addClass("R5");u.easyHoverClass(s.HOVER_CLASS,null,true);break;case"always":u.addClass("peoplePickerBorder");break}if(a&&a.model){a.model.watch("set",F,l,a.property);S(true);x();I(true)}},y=function(e,t){u.easyTab({prev:e,next:t})},w=function(){return a.model.get(a.property)},b=function(){var e=w();if(a.jsonified){e=e&&e.length>0?JSON.parse(e):null}return e},C=function(){var e=w();if(!JSON.isEqual(e,f)){if(n.isNotReal(f)){f=[]}a.model.set(a.property,f);a.model.save(function(){o.Tracker.trackStreakActive("boxDataEdited",{property:a.property,widget:"peoplePickerInstance"},a.trackingContext)})}},S=function(e){if(e||!JSON.isEqual(P,w())){P=w();g.updateDisplay(b())}},T=function(){C("")},x=function(){if(a.neverShowRead){return}g.updateDisplay(b());c.hide();g.getElement().show();u.removeClass("active");if(a.border==="hover"){u.removeClass(s.FOCUS_CLASS);if(b()&&b().length>0){u.trigger("unhold")}else{u.trigger("hold")}}else{u.trigger("unhold")}p=false},k=function(){d.data("peopleList",b());d.data("existingList",a.existingList);d.trigger("setPeopleList");g.getElement().hide();c.show();if(a.border==="hover"){u.addClass(s.FOCUS_CLASS)}u.addClass("active");p=true;m=true},M=function(e){d.ContactAutoSuggest({list:e,el:n.isReal(a.parent)?a.parent:u,immediateDone:true,listChangeFunc:function(e){if(a.jsonified){f=e&&e.length>0?JSON.stringify(e):""}else{f=e}},doneFunc:function(e){if(!m){return}C();x()},onlyValidEmailAddress:a.onlyValidEmailAddress,existingList:a.existingList,isRightAligned:a.isRightAligned})},L=function(){if(u.hasClass("disabled")){return}I();k();d.val("");d.focus();d.attr("size",1);d.trigger("bbFocus");if(a.border=="hover"){u.trigger("hold")}P=w();f=P},B=function(e){a.model=e.model;a.property=e.property;a.parent=e.parent;a.existingList=e.existingList;v()},E=function(e){L();d.val(e);d[0].setArrowMode(true)},D=function(e){if(e){u.removeClass("disabled")}else{u.addClass("disabled")}},V=function(){L();d[0].setArrowMode(false)},I=function(e){if(!h||e){c[0].innerHTML='<div><input type="text" /></div>';d=u.find("input");M(b());d.keydown(function(e){if(e.which===27){}else if(e.which===9){}else if(e.which!==9){e.stopPropagation()}});d.bind("escapePressed",function(e){d.data("peopleList",b());d.trigger("setPeopleList");x()});d.spreadsheetArrow(["up","down"]);h=true;u.addClass("bbBound")}},P=null;var A="peoplePickerUpdateDisplay"+i.create().getTime();var F=function(){if(p){return}S(true)};v();n.extend(l,{el:u,getElement:function(){return u},setTab:y,clear:T,focus:V,set:E,setup:B,setEnabled:D,updateValue:C,updateDisplay:S,done:function(){m=false},destroy:function(){e.NotificationCenter.unsubscribe({observer:l});g.destroy();if(d){d.unbind();d.remove()}u.empty();u.remove()}});return l}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;a.Widgets.PersonPicker={templates:{},defaults:{selectFunc:t.noop,allowEmail:true,allowName:true,initial:[]},create:function(e){var t={};n.extend(t,this.defaults,e);return new a.Widgets.PersonPicker.impl(t)}};a.Widgets.PersonPicker.ContactAutoSuggestFunctions={dataFunc:a.Contacts.queryContacts,stringDataFunc:a.Contacts.convertStringData,convertFunc:a.Contacts.convertResultToLiElement,compareFunc:a.Contacts.compareContactAndQuery};a.Widgets.PersonPicker.impl=function(e){var i=t('<input type="text" placeholder="'+a.Locale.getString("person_picker_input_placeholder")+'"/>'),r=t("<div></div>"),o=function(e,t){r.easyTab({prev:e,next:t})},s=function(){i.val("");i.focus()},l=[];r.addClass("personPicker");r.append(i);r.focus(function(e){i.val("");i.focus()});i.AutoSuggest(n.extend({noResultsFoundText:a.Locale.getString("auto_suggest_no_results"),loadingResultsText:a.Locale.getString("auto_suggest_loading_results"),selectFunc:function(t){if(t){e.selectFunc(t)}},getExcludedIDsFunc:function(){return n.pluck(l,"email")},isRightAligned:false},a.Widgets.PersonPicker.ContactAutoSuggestFunctions));return{el:r,setTab:o,focus:s,setExcluded:function(e){l=e},getElement:function(){return r},destroy:function(){r.remove()},selectItem:function(){r.find("input").trigger("bbSelect")}}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PersonPickerViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_textInput",destroy:true},{name:"_addButton",destroy:true},{name:"_excludedEmails",destroy:false,get:true,set:true,defaultValue:[]},{name:"_contactSelectedCallback",destroy:false}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this,t);this._contactSelectedCallback=t.contactSelectedCallback},setExcluded:function(e){this._excludedEmails=n.pluck(e,"email")},focus:function(){this._textInput.focus()},_setupView:function(){e.UI.ViewController.prototype._setupView.call(this);this._view.addClass("streak__personPicker");this._createTextInput();this._createAddButton()},_createTextInput:function(){var e=this;this._textInput=i.getInstance("BentoBox.Widgets.GmailTextareaViewController",{plainTextOnly:false});this._textInput.getView().getElement().find("[contenteditable=true]").AutoSuggest({noResultsFoundText:c.Locale.getString("auto_suggest_no_results"),loadingResultsText:c.Locale.getString("auto_suggest_loading_results"),isRightAligned:false,dataFunc:c.Contacts.queryContacts,stringDataFunc:c.Contacts.convertStringData,convertFunc:c.Contacts.convertResultToLiElement,compareFunc:c.Contacts.compareContactAndQuery,getExcludedIDsFunc:this.getExcludedEmails.bind(this),selectFunc:function(t){if(t&&e._contactSelectedCallback){e._contactSelectedCallback(t)}}});this._view.addSubView(this._textInput.getView())},_createAddButton:function(){var e=this;this._addButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:c.Locale.getString("add"),onFunction:function(){e._textInput.getView().getElement().find("[contenteditable=true]").trigger("bbSelect")}});this._view.addSubView(this._addButton)}});i.set("BentoBox.Widgets.PersonPickerViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.BentoBox;var o={defaults:{changeCallback:t.noop},create:function(e){var t={};n.extend(t,this.defaults,e);return new this.impl(t)}};o.impl=function(e){var n=e,i=[],r=[],a=[],o=t(document.createElement("div"));o.addClass("streakRadioList");function s(e,s){var u=t(document.createElement("span"));var c=t('<input type="radio" />');u.append(c);u.append(e);u.on("click",function(e){l(s);if(n.changeCallback){n.changeCallback(s)}});i.push(u);r.push(c);a.push(s);o.append(u)}function l(e){for(var t=0;t<r.length;t++){if(a[t]===e){r[t][0].checked=true}else{r[t][0].checked=false}}}return{el:o,addOption:s,setSelected:l}};a.Widgets.RadioList=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.jwerty,a=e.Gmail,o=e.HTML,s=e.BentoBox;var l={templates:{},defaults:{overrideTab:false,list:[{name:"Default",value:"Default"}],currentIndex:0,maxHeight:200,extraHTML:null,prefixHTML:null,unselectedDisplayText:null,fixPosition:false,border:null,changeFunc:function(e){},comparisonFunction:function(e,t){return e===t}},create:function(e){this._init();var t={};n.extend(t,this.defaults,e);return new this.impl(t)},_init:function(){if(!this.templates.menu){this.templates.menu=o.get("smartDropdownMenu");this.templates.item=o.get("smartDropdownItem")}}};l.impl=function(e){var i=e,a=t(document.createElement("div")),o=i.span||t(document.createElement("span")),u=i.extraHTML||"",c=i.prefixHTML||"",d=t(document.createElement("input")),h=t(l.templates.menu()),f=false,p=true,m=null,_=function(){o.text(m.name||m.display);if(c){o.prepend(c)}o.append(u)},g=function(){if(!p){return}y();d.val("");x=false;h.show();if(i.fixPosition){var e=n.clone(a.offset());e.top+=parseFloat(a.height());h.position({top:0,left:0});h.offset(e)}else{h.show()}var t=0;var r=0;for(var o=0;o<i.list.length;o++){var s=i.list[o];if(!s.value){continue}if(i.comparisonFunction){if(i.comparisonFunction(s.value,m.value)){t=r}}r++}T.setPosition([t])},v=function(){h.hide()},y=function(){if(!f){w();a.bind("blur",function(e){h.hide();a.trigger("menuClosed")});s.Keyboard.bindChordToElement(a,"[a-z]/shift+[a-z]/backspace",function(e){clearTimeout(k);if(r.is("backspace",e)){d.val(d.val().first(d.val().length-1))}else{d.val(d.val()+String.fromCharCode(e.which))}b();k=setTimeout(function(){d.val("")},1e3)},true,true);s.Keyboard.bindChordToElement(a,"up/down/home/end",function(e){d.val("")},true,true);s.Keyboard.bindChordToElement(a,"escape",function(e){h.hide();a.trigger("menuClosed")},true,true,true);if(i.overrideTab){s.Keyboard.bindChordToElement(a,"tab",function(e){T.select();a.trigger("innerTabPressed")},true,true,true);s.Keyboard.bindChordToElement(a,"shift+tab",function(e){T.select();a.trigger("innerShiftTabPressed")},true,true,true)}f=true;a.addClass("bbBound")}},w=function(e){if(e){if(e.length>0){if(m.value!=="__unselected"){m=e[0]}}i.list=e}h.find(".bb_menu_inner").empty();for(var r=0;r<i.list.length;r++){var a=i.list[r];if(a==="__separator"){var o=document.createElement("div");o.setAttribute("class","J-Kh");o.setAttribute("role","separator");h.find(".bb_menu_inner").append(o)}else{var l=a.name||a.display;if(l){var u=t(document.createElement("div"));u[0].setAttribute("class","J-N item");u[0].setAttribute("role","menuitem");var c='<div class="J-LC-Jz value" style="">'+n.escape(l);if(a.extraText){c+='<span class="streak__menuItem_extra">('+n.escape(a.extraText)+")"}c+="</div>";u[0].innerHTML=c;u.data("itemValue",a);h.find(".bb_menu_inner").append(u)}else{s.logError("tried to add menu entry with no name",null,a)}if(a.isHeader){u.addClass("streak__menuItemHeader");u.removeClass("item")}}}T.setup(h.find(".item"),h.find(".item"));T.setPosition([i.currentIndex])},b=function(){var e=d.val().toLowerCase();for(var t=0;t<i.list.length;t++){var n=i.list[t];if((n.name||n.display||"").toLowerCase().startsWith(e)){T.setPosition([t]);return}}},C=function(e){e=e||null;m=n.find(i.list,function(t){if(t==="__separator"){return false}if(t.isHeader){return false}if(i.comparisonFunction){return i.comparisonFunction(t.value,e)}});if(n.isNotReal(m)){S();return}_()},S=function(){if(n.isReal(i.unselectedDisplayText)){m={name:i.unselectedDisplayText,value:"__unselected"}}else if(i.list.length>0){C(i.list[0].value)}_()},T=s.Cursor.create({selectedClass:"J-N-JT",selectOnClick:true,aggressiveInputCapture:true,selectFunc:function(e){m=e.data("itemValue");_();i.changeFunc(m);v();a.trigger("itemSelected")},highlightOnHover:true,rollOver:true,input:a}),x=false;a[0].setAttribute("class","dropdown smartInput customDropdown");o.addClass("input");d[0].setAttribute("type","text");a.append(o);if(n.isNotReal(i.span)){a[0].setAttribute("tabindex","-1");a.append('<div class="downArrow G-asx T-I-J3 J-J5-Ji">&nbsp;</div>')}a.append(h);a.bind("bbCursorSelect",function(e){e.stopPropagation()});a.bind("focus",function(e){g()});if(i.border==="alwaysGmail"){a.addClass("R5")}h[0].style.maxHeight=i.maxHeight+"px";var k=null;m=i.list[i.currentIndex];_();y();return{el:a,focus:g,menu:h,setMenuList:w,setSelected:C,deselect:S,getSelected:function(){return m},disable:function(){p=false},enable:function(){p=true},getElement:function(){return a},destroy:function(){a.remove()},hide:v}};s.Widgets.CustomDropdown=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{buttonColor:"normal",autoClose:true,overrideTab:false,list:[{name:"Default",value:"Default"}],currentIndex:0,maxHeight:200,changeFunc:function(e){},comparisonFunction:function(e,t){return e===t}},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(e){var t=e;var n=false;t.trackingContext.widgetContext+="/ButtonCustomDropdown";var r;r=a.Widgets.Button.create({trackingContext:t.trackingContext,color:t.buttonColor,isToggle:true,onFunc:function(e){o.focus();o.menu.containByScreen(r.el)},offFunc:function(e){o.hide();r.el.focus()},isDropdown:true,hasButtonToRight:t.hasButtonToRight,hasButtonToLeft:t.hasButtonToLeft});t.span=r.el;t.extraHTML='<div class="downArrow G-asx T-I-J3 J-J5-Ji">&nbsp;</div>';t.fixPosition=true;var o=a.Widgets.CustomDropdown.create(t);o.el.bind({menuClosed:function(){r.off()},itemSelected:function(){r.off()},innerTabPressed:function(){r.off();r.el.trigger("tabPressed")},innerShiftTabPressed:function(){r.off();r.el.trigger("shiftTabPressed")}});o.menu.css("position","fixed");r.el.bodyCloseAndStop({closeFunction:function(){r.off();r.el.blur()},body:i.elements.body,stop:o.el[0]});o.disable=r.disable;o.enable=r.enable;o.el.addClass("TI");o.destroy=function(){o.el.remove();r.destroy()};return o};a.Widgets.ButtonCustomDropdown=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.jwerty,a=e.Gmail,o=e.HTML,s=e.BentoBox;var l={templates:{},defaults:{borderOnHover:false,property:null,fieldIndex:-1,model:null,list:null,autoSave:true,delayedBind:false,overrideTab:false,extraHTML:null},create:function(e){this._init();var t={};n.extend(t,this.defaults,e);return new this.impl(t)},_init:function(){if(!this.templates.menu){this.templates.menu=o.get("smartDropdownMenu");this.templates.item=o.get("smartDropdownItem")}}};l.impl=function(a){var o={};var u=a,c=t(document.createElement("div")),d=u.span||t(document.createElement("span")),h=u.extraHTML||"",f=t(document.createElement("input")),p=t(l.templates.menu()),m=false,_=false,g="smartDropdown"+(new i).getTime(),v=function(){if(u.property){return u.model.get(u.property)}else if(u.fieldKey){return u.model.getFieldModel(u.fieldKey)}},y=function(){var e=u.list.findIndex(function(e){return(e.value?e.value:e)===v()});return u.list[e]},w=function(){var e=u.list.findIndex(function(e){return(e.value?e.value:e)===v()});if(e>-1){var t=u.list[e];if(E){E.setPosition([e])}d.data("itemValue",t);d.empty();d.text(t.text?t.text:t);d.append(h)}},b=function(){var e=d.data("itemValue");if(e!=D){var t=e.value?e.value:e;if(u.property){u.model.set(u.property,t)}if(u.autoSave){u.model.save(function(){s.Tracker.trackStreakActive({property:u.property,widget:"smartDropdown"},u.trackingContext)})}D=e}},C=function(){},S=function(){k();f.val("");c.focus();V=false},T=function(e){S();f.val(e);B();V=true},x=function(){p.hide()},k=function(){if(!m){M();s.Keyboard.bindChordToElement(c,"[a-z]/shift+[a-z]/backspace",function(e){clearTimeout(P);if(r.is("backspace",e)){f.val(f.val().first(f.val().length-1))}else{f.val(f.val()+String.fromCharCode(e.which))}B();P=setTimeout(function(){f.val("")},1e3)},true,true);s.Keyboard.bindChordToElement(c,"up/down/home/end",function(e){f.val("")},true,true);s.Keyboard.bindChordToElement(c,"right",function(e){if(V){c.trigger("rightPressed");E.select()}});s.Keyboard.bindChordToElement(c,"left",function(e){if(V){c.trigger("leftPressed");E.select()}});s.Keyboard.bindChordToElement(c,"escape",function(e){p.hide();c.trigger("menuClosed")},true,true,true);if(u.overrideTab){s.Keyboard.bindChordToElement(c,"tab",function(e){setTimeout(function(){c.trigger("innerTabPressed")},10)},true,true,true);s.Keyboard.bindChordToElement(c,"shift+tab",function(e){setTimeout(function(){c.trigger("innerShiftTabPressed")},10)},true,true,true)}m=true;c.addClass("bbBound")}},M=function(){p.unbind(".smartDropdown");d.unbind(".smartDropdown");p.bind("click.smartDropdown",function(e){E.select()});c.bind("focus",function(e){L();p.show()});if(!u.overrideTab){c.bind("blur",function(e){p.hide();c.trigger("menuClosed")})}},L=function(e){if(e){u.list=e;_=false;return}if(_){return}e=u.list;p.find(".bb_menu_inner").empty();n.each(u.list,function(e){var n=e.text?e.text:e;var i=t(l.templates.item({name:n}));i.data("itemValue",e);p.find(".bb_menu_inner").append(i)});E=s.Cursor.create({selectedClass:"J-N-JT",selectFunc:function(e){var t=e.data("itemValue");d.data("itemValue",e.data("itemValue"));b();c.trigger("itemSelected")},highlightOnHover:true,rollOver:true,input:c,noScroll:true});E.setup(p.find(".item"),p.find(".item"));w()},B=function(){var e=f.val().toLowerCase();t.each(u.list,function(t,n){if((n.text?n.text:n).toLowerCase().startsWith(e)){E.setPosition([t]);return}})},E=null,D=v(),V=false;c[0].setAttribute("class","dropdown smartInput");c[0].setAttribute("tabindex","-1");d.addClass("input");f[0].setAttribute("type","text");c.append(d);c.append(p);c.bind("bbCursorSelect",function(e){e.stopPropagation()});function I(){d.data("itemValue",y());w()}u.model.watch("set",I,o,u.property);var P=null;if(!u.delayedBind){k()}w();var A=function(e){u.list=e;M()};o.el=c;o.clear=C;o.focus=S;o.set=T;o.reset=A;o.renderMenu=L;o.hide=x;o.destroy=function(){e.NotificationCenter.unsubscribe({observer:o});p.remove();c.remove();if(f){f.remove()}if(d){d.remove()}};return o};s.Widgets.SmartDropdown=l})(Streak);(function(e){var t=e.jQuery,n=e.BentoBox;n.Widgets.SmartInput={create:function(e,t){return n.Models.BoxField.getInputWidget(e,t)}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;var a={HOVER_CLASS:"aco",FOCUS_CLASS:"acm"};r.Widgets.SidebarTextarea={template:'<div contentEditable="true" class="textAreaBaseStyle edit"></div>',defaults:{model:null,property:null,border:"always",enter:false,placeholder:null,autoSave:true,readHTML:false,useAutocomplete:true,existingList:[]},create:function(e){var t={};n.extend(t,this.defaults,e);return new r.Widgets.SidebarTextarea.impl(t)}};r.Widgets.SidebarTextarea.impl=function(n){var o={};var s=n;var l=t('<div><div class="sidebarTextareaRead"></div></div>');var u=l.find("div");var c=s.property;var d=s.model;var h=s.autoSave;var f=null;var p=false;var m=null;var _=null;var g=false;var v=false;var y=false;var w=s.isValueValidFunction;var b=function(){return d.get(c)||""};var C=function(){return t.cleanText(b(),true).escapeHTML()};var S=function(){var e=b();E.find(".bbAutocomplete").hide();var t=E.plainText();E.find(".bbAutocomplete").show();if(t.length===0){if(!E.is(":FastVisible")){t=l.plainText()}}if(w){if(!w(t)){return}}if(f!==t){g=true;d.set(c,t);clearTimeout(_);_=setTimeout(T,500)}f=t};var T=function(){S();clearTimeout(_);_=null;if(!g){return}v=true;if(h){d.save()}g=false};var x=function(e){if(e){l.removeClass("disabled")}else{l.addClass("disabled")}};var k=function(){if(b()!==f){if(l.is(".active")){return}}else{return}M()};var M=function(){E.trigger("detach");E.detach();if(s.readHTML){u.setPlainText(b())}else{u[0].innerHTML=C()}l.removeClass("active");l.empty();l.append(u);E.unbindBodyCloseAndStop();if(s.border==="hover"){l.removeClass(a.FOCUS_CLASS);if(C()){l.removeClass(a.HOVER_CLASS);l.trigger("unhold")}else{l.trigger("hold");l.addClass(a.HOVER_CLASS)}}else if(s.border==="alwaysGmail"){l.removeClass(a.FOCUS_CLASS)}};var L=function(){if(l.hasClass("disabled")||E.is(":focus")){return}u.detach();E.detach();E.setPlainText(b());f=b();l.append(E);l.addClass("active");if(s.border==="hover"||s.border==="alwaysGmail"){l.addClass(a.FOCUS_CLASS)}D();V();if(s.useAutocomplete){E[0].setAutoCompleteList(s.existingList)}E.focus();B()};var B=function(){setTimeout(function(){var t,n;var i=e.document;if(i.createRange){n=i.createRange();n.selectNodeContents(E[0]);n.collapse(false);t=i.getSelection();t.removeAllRanges();t.addRange(n)}},1)};var E=t(r.Widgets.SidebarTextarea.template);var D=function(){if(!p){E[0].addEventListener("keydown",function(e){if(e.which===13){if(e.metaKey||e.ctrlKey){e.stopImmediatePropagation()}}},true);E.on("escapePressed",function(e){E.setPlainText(f);M();l.trigger("blurred")});r.Keyboard.bindChordToEl({el:E,chord:"tab/shift+tab",useCapture:true,cb:function(e){T();M()}});E.delayedSave({saveFunction:S,delay:0,saveOnBlur:false,enter:true});if(s.useAutocomplete){E.autoComplete("plainText")}p=true}};function V(){l.bodyCloseAndStop({closeFunction:function(){l.unbindBodyCloseAndStop();if(E.isVisible()){S();T();M()}},stop:l,body:i.elements.body,useCapture:true})}l.addClass("smartInput sidebarTextarea");l[0].setAttribute("tabindex",-1);l.click(function(){if(!E.is(":FastVisible(noCompute)")){setTimeout(L,50)}});l.focus(function(){if(!E.is(":FastVisible(noCompute)")){i.elements.body.trigger("bodyCloseAndStop");setTimeout(L,50)}});switch(s.border){case"never":l.addClass("noTextareaBorder");break;case"hover":u.addClass("R5");E.addClass("R5");l.easyHoverClass(a.HOVER_CLASS);break;case"always":l.addClass("textareaBorder");break;case"alwaysGmail":u.addClass("R5");E.addClass("R5");l.addClass(a.HOVER_CLASS)}if(d){d.watch("set",k,o,c);if(d.getIsEditable){x(d.getIsEditable())}M()}if(s.placeHolder){l.attr("placeholder",s.placeHolder)}o.el=l;o.setEnabled=x;o.getElement=function(){return l};o.focus=function(){l.focus()};o.focusAndSelect=function(){l.focus();setTimeout(function(){E.selectContents()},150)};o.setModelAndProperty=function(t,n){e.NotificationCenter.unsubscribe({observer:o});d=t;c=n;d.watch("set",k,o,c);E.setPlainText("");k()};o.destroy=function(){l.unbindBodyCloseAndStop();e.NotificationCenter.unsubscribe({observer:o});u.remove();E.find("*").unbind();E.remove();l.empty();l.remove();if(v){r.Tracker.trackStreakActive({eventName:"boxDataEdited",property:s.property,widget:"sidebarTextarea"},s.trackingContext)}};return o}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;var a={HOVER_CLASS:"aco",FOCUS_CLASS:"acm"};r.Widgets.SmartTextarea={template:'<div class="streak__smartTextarea"><div class="R5" contentEditable="true"></div></div>',defaults:{model:null,property:null,useRawHTML:false,border:"always",enter:false,autoSave:true,trackingContext:{widget:"smartTextarea"}},create:function(e){var t={};n.extend(t,this.defaults,e);return new r.Widgets.SmartTextarea.impl(t)}};r.Widgets.SmartTextarea.impl=function(i){var o={};var s=i,l=false,u=t(r.Widgets.SmartTextarea.template),c=null,d=null,h=function(e,t){v.easyTab({prev:e,next:t})},f=function(){var e=s.model.get(s.property);var t=null;if(s.useRawHTML){t=v.html()}else{t=v.plainText()}if(e!==t){s.model.set(s.property,t);clearTimeout(c);c=setTimeout(p,1);l=true}},p=function(){if(!l){return}clearTimeout(c);c=null;l=false;s.model.save(function(){r.Tracker.trackStreakActive(n.extend({property:s.property,widget:"smartTextarea"},s.trackingContext))
})},m=function(){var e=s.model.get(s.property);return t.trim(e)},_=function(e){v.prop("contenteditable",!!e);if(e){v.removeClass("disabled")}else{v.addClass("disabled")}},g=function(){if(!u.is("."+a.FOCUS_CLASS)){if(s.useRawHTML){v.html(m())}else{v.setPlainText(m())}}if(s.border==="hover"){if(s.model.get(s.property)){u.removeClass(a.HOVER_CLASS);v.trigger("unhold")}else{v.trigger("hold");u.addClass(a.HOVER_CLASS)}}if(s.placeholder){if(!s.model.get(s.property)){u.append(y)}else{y.detach()}}};var v=u.find(".R5");u[0].setAttribute("tabindex",-1);v.addClass("textAreaBaseStyle");if(s.useRawHTML){v.addClass("streak__textArea_rawHTML")}v[0].setAttribute("tabindex",-1);v.delayedSave({delay:4e3,saveFunction:function(){f()},enter:s.enter});var y=t('<div class="smartTextareaPlaceholder"></div>');if(s.placeholder){y[0].innerHTML=s.placeholder}u.focus(function(){v.focus()});v.focus(function(){if(v.hasClass("disabled")){return}y.detach();u.addClass(a.FOCUS_CLASS)});v.blur(function(){f();g();u.removeClass(a.FOCUS_CLASS)});v.click(function(){v.focus()});if(s.model&&s.model.getIsEditable){_(s.model.getIsEditable())}switch(s.border){case"never":v.addClass("noTextareaBorder");break;case"hover":u.addClass("noTextareaBorder");v.easyHoverClass(a.HOVER_CLASS,null,true,u);break;case"always":v.addClass("textareaBorder");break;case"alwaysHover":u.addClass(a.HOVER_CLASS);break}if(s.model){s.model.watch("set",g,o,s.property);g()}return{el:u,getElement:function(){return u},focus:function(){v.focus()},destroy:function(){e.NotificationCenter.unsubscribe({observer:o});u.find("*").unbind();u.empty();u.remove()},setModelAndProperty:function(t,n){e.NotificationCenter.unsubscribe({observer:o});s.model=t;s.property=n;s.model.watch("set",g,o,s.property);g()},placeholderEl:y,setTab:h,setEnabled:_}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.BentoBox;var o={HOVER_CLASS:"aco",FOCUS_CLASS:"acm"};a.Widgets.SmartTextbox={template:'<div><input type="textbox"></div>',defaults:{model:null,border:"hover",enter:true,property:null,autoSave:true,onlyEnter:false,autoGrow:false,delay:300,delayedBind:false,allowEmpty:true},create:function(e){var t={};n.extend(t,this.defaults,e);return new a.Widgets.SmartTextbox.impl(t)}};a.Widgets.SmartTextbox.impl=function(n){var i={};var r=t(a.Widgets.SmartTextbox.template),s=r.find("input"),l=false,u=false,c=function(e,t){s.easyTab({prev:e,next:t})},d=function(e){s.prop("disabled",!e)},h=function(){return n.model.get(n.property)},f=function(){if(!s.val()&&!w){return}if(s.val()===w){return}if(!n.allowEmpty&&!s.val()){m(true);return}w=s.val();n.model.set(n.property,s.val().trim());u=true},p=function(){if(!u){return}u=false;n.model.save(function(){a.Tracker.trackStreakActive({property:n.property,widget:"smartTextbox"},n.trackingContext)})},m=function(e){if(e||h()!==w){if(s.is(":focus"))return;s.val(h());s.change()}},_=function(){s.val("");f()},g=function(){y();w=h();s.focus();b=false},v=function(e){s.val(e);g();b=true},y=function(){if(!l){s.focus(function(e){r.addClass(o.FOCUS_CLASS)});s.blur(function(){f();p();r.removeClass(o.FOCUS_CLASS)});if(n.autoGrow){s.autoGrowInput()}a.Keyboard.bindChordToElement(s,"escape",function(e){s.val(w)});a.Keyboard.bindChordToElement(s,"enter",function(e){s.blur();s.trigger("enterPressed")},true,true);a.Keyboard.bindChordToElement(s,"up",function(e){if(b){s.trigger("upPressed")}});a.Keyboard.bindChordToElement(s,"down",function(e){if(b){s.trigger("downPressed")}});a.Keyboard.bindChordToElement(s,"right",function(e){if(s.caret().start===s.val().length){e.preventDefault();e.stopPropagation()}if(b){if(s.caret().start===s.val().length){s.trigger("rightPressed")}}});a.Keyboard.bindChordToElement(s,"left",function(e){if(s.caret().start===0){e.preventDefault();e.stopPropagation()}if(b){if(s.caret().start===0){s.trigger("leftPressed")}}});s.addClass("bbBound");l=true}},w=h(),b=false;r[0].setAttribute("class","smartInput streak__smartTextbox");r[0].setAttribute("tabindex","-1");if(n.model.getIsEditable){d(n.model.getIsEditable())}n.model.watch("set",m,i,n.property);m(true);switch(n.border){case"never":r.addClass("textboxNoborder");break;case"hover":r.addClass("textboxNoborder");r.easyHoverClass("textboxBorder");break;case"gmailHover":s.addClass("R5");r.easyHoverClass(o.HOVER_CLASS);break;case"always":r.addClass("textboxBorder");break}if(!n.delayedBind){y()}r.focus(function(e){g()});return{el:r,setTab:c,clear:_,focus:g,set:v,getElement:function(){return r},destroy:function(){e.NotificationCenter.unsubscribe({observer:i});r.remove()},setEnabled:d}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Object;var h=e.Class.subclass({className:"EmailInvoiceButtonController",superclass:d,_memberVariables:[{name:"_button",get:true,destroy:false},{name:"_rowId",destroy:false}],_initialize:function(e){d.prototype._initialize.call(this);this._rowId=e;if(!this._rowId){throw new Error("rowId not initialized in EmailInvoiceButtonController")}this._setupButton()},_setupButton:function(){var e=this;this._button=c.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:c.Locale.getString("email_invoice"),color:"blue",onFunction:function(){e.sendEmailInvoice()}})},sendEmailInvoice:function(){var e=this;c.Tracker.track("invoice.email.send",this.rowId);this._sendEmailInvoicePromise().then(function(){c.ButterBarManager.showMessage({message:c.Locale.getString("email_invoice_success"),messageKey:"email_invoice"})}).catch(function(t){c.Tracker.track("invoice.email.send.failed",e.rowId);c.ButterBarManager.showError(c.Locale.getString("email_invoice_failure"),{messageKey:"email_invoice"})})},_sendEmailInvoicePromise:function(){var t=this;return new e.RSVP.Promise(function(n,r){var a=i.getInstance("BentoBox.Modules.Paywall.EmailInvoiceOperation",{invoiceId:t._rowId});var o=e.Operations.OperationQueue.Singleton.addOperation(a);c.ButterBarManager.showMessage({message:c.Locale.getString("email_invoice_start"),operationProgressId:o,messageKey:"email_invoice"});var s=function(e){if(e.operationHasErrors){r()}else{n()}};e.NotificationCenter.subscribe({observer:{},filterParameters:{operationIsComplete:true,operationProgressId:o},unsubscribeImmediately:true,functionToCall:s})})}});i.set("BentoBox.Widgets.EmailInvoiceButtonController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.BentoBox;FilterableGroupList={templates:{},defaults:{searchInput:null,closedSectionList:[],openFunc:t.noop,closeFunc:t.noop,selectFunc:t.noop,compareFunc:t.noop,parentHeaderClass:"titleSection",itemClass:"menuItem",selectedClass:"J-N-JT",highlightClass:"J-N-JT"},create:function(e){var t={};n.extend(t,this.defaults,e);return new FilterableGroupList.impl(t)}};FilterableGroupList.impl=function(e){var i=t(document.createElement("div"));var a=null;var o=r.Cursor.create({selectedClass:e.selectedClass,selectFunc:function(t,n){if(t.hasClass("titleSection")){t.trigger("bbCursorClick")}else{e.selectFunc(t.data("groupListData"))}},highlightOnHover:true,selectOnClick:true,rollOver:true,input:e.searchInput});var s="";var l=e.closedSectionList||[];function u(){i.empty();n.each(a,function(t,o){var u=[];var c=r.Widgets.CollapseSection.create({title:a[o].title,startOpen:l.indexOf(o)===-1,titleClick:false,openFunc:function(){l.removeVal(o);e.openFunc(l);c.bodySection.find("."+e.itemClass).addClass("cursorItem");h()},closeFunc:function(){l=n.union(l,[o]);e.closeFunc(l);c.bodySection.find(".cursorItem").removeClass("cursorItem");h()}});var d=l.indexOf(o)===-1;c.titleSection.addClass("cursorItem");var f=a[o].list;for(var p=0;p<f.length;p++){if(!e.compareFunc(s,f[p].data)){continue}var m=r.Widgets.Menu.createItem(f[p].display);m.data("groupListData",f[p].data);m.addClass(e.itemClass);if(d){m.addClass("cursorItem")}c.bodySection.append(m);u.push(m)}if(u.length>0){i.append(c.el);c.titleSection.find(".bbResults").remove();c.titleSection.find(".title").append('<span class="bbResults">('+u.length+")</span>")}});h()}function c(e,t){a=e;s="";l=t||[];u()}function d(e){n.extend(a,e);u()}function h(){var e=o.getPosition();o.setup(i.find(".cursorItem"));o.setPosition(e)}e.searchInput.delayedSave({delay:100,saveFunction:function(t){if(!t){s=e.searchInput.val();u()}},dontPropagate:true});return{el:i,render:u,setData:c}};r.Widgets.FilterableGroupList=FilterableGroupList})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.BentoBox;r.Widgets.FirstPipelinePromo={templates:{},defaults:{width:"300px",useBentoBoxTitle:false,buttonFirst:false,showBottomBorder:false},create:function(e){var t={};n.extend(t,this.defaults,e);return new r.Widgets.FirstPipelinePromo.impl(t)}};r.Widgets.FirstPipelinePromo.impl=function(e){var t=i.get("firstPipelinePromo",true);t.css("width",e.width);if(e.useBentoBoxTitle){t.find(".firstPipelineTitle").html("Streak")}else{t.find(".firstPipelineTitle").hide()}if(e.showBottomBorder){t.find(".am6").show()}if(e.buttonFirst){var n=t.find(".newPipelineContainer");n.detach();n.insertAfter(t.find(".firstPipelineTitle"))}var a=r.Widgets.Button.create({name:r.Locale.getString("create_first_pipeline"),onFunc:function(){r.FirstRun.showStageModal(1)},isToggle:false,color:"blue"});t.find(".newPipelineContainer").append(a.el);return{el:t}}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.Template,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"FeedListViewController",superclass:e.Object,_memberVariables:[{name:"_model",destroy:false},{name:"_scrollViewport",destroy:false},{name:"_closeCallback",destroy:false},{name:"_element",destroy:true,get:true},{name:"_feedListContent",destroy:false},{name:"_mostRecentFeedListData",destroy:true},{name:"_postCommentViewController",destroy:true},{name:"_titlePositions",destroy:true},{name:"_$all",destroy:true},{name:"_$important",destroy:true},{name:"_$comments",destroy:true}],_initialize:function(t){e.Object.prototype._initialize.call(this);this._element=o.getElement("feedList");this._feedListContent=this._element.find(".feedListContent");this._model=t.model;this._closeCallback=t.closeCallback;this._scrollViewport=t.scrollViewport||this._element.find(".feedListContentScrollable");this._manualTop=t.manualTop;if(t.usePostWidget){this._setupPostWidget()}this._setupFilterButtons();this._addEventTracking();this._watchModel();this._setupScrollHandler();this.refresh(true)},filterMode:{ALL:"ALL",IMPORTANT:"IMPORTANT",COMMENTS:"COMMENTS"},_setupPostWidget:function(){if(!this._isBox()){throw new Error("FeedList widget can only have comment widget in a box")}this._postCommentViewController=new d.Widgets.PostCommentViewController(this._model,this);this._element.find(".postCommentWidget").html(this._postCommentViewController.getElement())},_setupFilterButtons:function(){var e=this;this._$all=this._element.find(".feedListOption.allFilter");this._$important=this._element.find(".feedListOption.importantFilter");this._$comments=this._element.find(".feedListOption.commentsFilter");if(this._isBox()){this._$important.remove();this.chooseFilter(d.LocalSettings.get("boxView/feed/filterMode")||this.filterMode.ALL)}else{this._$comments.remove();this.chooseFilter(d.LocalSettings.get("pipelineView/feed/filterMode")||this.filterMode.IMPORTANT)}this._$all.click(this._filterClick.bind(this,this.filterMode.ALL));this._$important.click(this._filterClick.bind(this,this.filterMode.IMPORTANT));this._$comments.click(this._filterClick.bind(this,this.filterMode.COMMENTS));var t=this._element.find(".streak__feedListCloseBtn");if(!this._closeCallback){t.remove()}else{t.click(function(t){t.preventDefault();e._closeCallback()})}},_filterClick:function(e,t){t.preventDefault();t.stopPropagation();this.chooseFilter(e);if(this._isBox()){d.LocalSettings.set("boxView/feed/filterMode",e)}else{d.LocalSettings.set("pipelineView/feed/filterMode",e)}},chooseFilter:function(e){if(this._currentFilter==e){return}var t=this._currentFilter;this._currentFilter=e;switch(this._currentFilter){case this.filterMode.ALL:this._$all.addClass("selected");this._$important.removeClass("selected");this._$comments.removeClass("selected");break;case this.filterMode.IMPORTANT:this._$all.removeClass("selected");this._$important.addClass("selected");this._$comments.removeClass("selected");break;case this.filterMode.COMMENTS:this._$all.removeClass("selected");this._$important.removeClass("selected");this._$comments.addClass("selected");break;default:throw new Error("Invalid newsfeed filter mode")}this.refresh(true)},_setupScrollHandler:function(){this._boundResizeHandler=this._configureScrollHandler.bind(this);t(window).on("resize",this._boundResizeHandler);this._boundScrollHandler=this._onscroll.bind(this);this._scrollViewport.on("scroll",this._boundScrollHandler)},_onscroll:function(e){if(!this._titlePositions||!this._titlePositions.length){return}var t=this._scrollViewport.scrollTop();t-=this._feedListContent.children().offset().top-this._scrollViewport.children().offset().top;var n=this._titlePositions.length;for(var i=0;i<n;i++){if(this._titlePositions[i].top>=t){break}}var r=i-1;var a=i;var o=this._titlePositions[r];var s=this._titlePositions[a];if(o!==this._currentStickyTitle){if(this._currentStickyTitle&&this._currentStickyTitle.$el){this._currentStickyTitle.$spacer.hide();this._currentStickyTitle.$el.removeClass("streak__feedListSectionTitleSticky").css({position:"static",top:""})}if(o&&o.$el){o.$spacer.show();o.$el.addClass("streak__feedListSectionTitleSticky").css({position:"absolute"})}this._currentStickyTitle=o}if(o&&o.$el){var l=0;if(s){l=s.top-t-o.height;if(l>0){l=0}}if(this._manualTop){l+=t}o.$el.css("top",l+"px")}},reconfigureSize:function(){this._configureScrollHandler()},_configureScrollHandler:n.throttle(function(){if(!this._element||!this._feedListContent){return}var e=[];var n=this._feedListContent.find(".streak__feedListSectionTitle");if(n.length){var i=this._feedListContent.children().position().top;n.each(function(n){var r=t(this);var a=r.outerHeight();var o=r.next(".streak__spacer");if(!o.length){o=t("<div/>").addClass("streak__spacer").hide().insertAfter(r)}o.css("height",a);var s=(o.is(":visible")?o:r).position().top-i;e.push({top:s,height:a,$el:r,$spacer:o})});var r=this._feedListContent.children().last();e.push({top:r.position().top-i+r.height()})}this._titlePositions=e;this._onscroll()},500),_destroyScrollHandler:function(){t(window).off("resize",this._boundResizeHandler);if(this._scrollViewport){this._scrollViewport.off("scroll",this._boundScrollHandler)}},newCommentPosted:function(){this.refresh()},refresh:n.debounce(function(e){this._refresh(e)},100),_refresh:function(n){if(!this._model||!this._model.key||!this._model.key()){return}var i=this;if(this._currentRequest){this._currentRequest.cancel()}if(n){this._mostRecentFeedListData=this._titlePositions=null;this._feedListContent.html(o.getElement("feedListLoading"))}var r;if(this._isBox()){r="boxes/"+this._model.key()+"/newsfeed"}else{r="pipelines/"+this._model.key()+"/newsfeed"}var a=this._getWhatParams();this._currentRequest=e.APIRequester.get(r,a);this._currentRequest.getPromise().then(this._renderFeedItems.bind(this),function(e){if(!i._model||e.message=="Canceled"){return}i._feedListContent.find(".streak__feedListLoading").remove();i._feedListContent.append(t("<div/>").addClass("streak__feedListNotice").text(d.Locale.getString("feed_load_fail")))})},_getWhatParams:function(){switch(this._currentFilter){case this.filterMode.IMPORTANT:return{detailLevel:"CONDENSED"};case this.filterMode.COMMENTS:return{detailLevel:"COMMENTS_ONLY"};default:return{detailLevel:"ALL"}}},_getNewsfeedFilterSetting:function(e,t){var n=this._isBox()?"box":"pipeline";var i=d.UserSettings.getSetting("newsFeed/"+n+"/"+this._model.key()+"/"+e);if(i===undefined||i===""){i=d.UserSettings.getSetting("newsFeed/pipeline/global/"+e);return i===undefined||i===""?t:i}else{return i}},_rerender:function(){if(this._mostRecentFeedListData){this._renderFeedItems(this._mostRecentFeedListData)}},_renderFeedItems:function(i){if(!this._feedListContent){return}var r=this;this._mostRecentFeedListData=i;var l=e.moment().startOf("day");var u=[{name:"today",time:l},{name:"yesterday",time:l.clone().subtract(1,"days")},{name:"this_week",time:l.clone().startOf("week")},{name:"last_week",time:l.clone().startOf("week").subtract(1,"weeks")},{name:"this_month",time:l.clone().startOf("month")},{name:"last_month",time:l.clone().startOf("month").subtract(1,"months")},{name:"this_year",time:l.clone().startOf("year")},{name:"last_year",time:l.clone().startOf("year").subtract(1,"years")},{name:"long_ago"}];var c=n.groupBy(i,function(t){var i=e.moment(t.timestamp);return n.find(u,function(e){return!e.time||i>=e.time}).name});r._feedListContent.empty();n.each(u,function(e){var i=n.filter(c[e.name],function(e){if(r._isBox()&&!d.Data.getBox(e.boxKey)){return false}if(!d.Data.getPipeline(e.pipelineKey)){return false}return true});if(i.length==0){return}i=n.sortBy(i,function(e){return-e.timestamp});var l=d.Locale.getString("newsfeed_time_"+e.name);var u=o.getElement("feedListSection");u.find(".streak__feedListSectionTitle").text(l);r._feedListContent.append(u);n.each(i,function(e){try{var n=d.Data.getPipeline(e.pipelineKey);var i=a.create(e.timestamp);var o=t("<div/>").addClass("bb_feeditem").html(s.underscore("widgets/feedList/feedListRow")({datetime:i.getGmailFormatted(true),completeDatetime:i.customFormat("longDateTime"),storyHtml:r._generateStoryHtml(e),userImageUrl:r._getUserImageUrl(e),comment:r._getComment(e),detail:r._getDetailText(e),objects:r._getObjects(e)}));if(r._getComment(e)){o.addClass("hasComment")}r._setupPipelineLink(o,n);o.addClass("loaded");u.find(".streak__feedListSectionContent").append(o)}catch(l){d.logError("Error rendering newsfeed item",l)}})});if(r._feedListContent.html().trim()==""){r._feedListContent.append(t("<div/>").addClass("streak__feedListNotice").text(d.Locale.getString("feed_load_nothing")))}this._setupBoxLinks(this._feedListContent);this._configureScrollHandler()},_getObjects:function(t){if(t.boxKey&&t.boxKey!==this._model.key()){var n;var i=e.BentoBox.Data.getBox(t.boxKey);if(i){n=i.get("name")}else if(t.newsfeedEntrySpecific!="ADD_LINKED_BOX"&&t.newsfeedEntrySpecific!="REMOVE_LINKED_BOX"){n=t.specificVariables.BOX_NAME}else{n="(deleted)"}return[s.underscore("widgets/feedList/boxObject")({name:n,key:t.boxKey})]}},_generateStoryHtml:function(t){var i=n.clone(t.specificVariables);var r=t.storyText||t.storyTextBox||t.storyTextPipeline||t.storyTextGlobal;if(!r){throw new Error("Server did not give story for newsfeed entry key "+t.newsfeedEntryKey)}switch(i.FIELD_TYPE){case"DATE":var o=i.FIELD_VALUE;if(!o){i.FIELD_VALUE=""}else{i.FIELD_VALUE=a.create(i.FIELD_VALUE).customFormat("shortDate")}break;case"PERSON":try{var s=JSON.parse(i.FIELD_VALUE);var l=[];for(var u=0;u<s.length;u++){var c=s[u].displayName||s[u].fullName||s[u].email;if(c===undefined){throw new Error("No displayName or fullName property found for person")}l.push(c)}i.FIELD_VALUE=l.join(", ")}catch(h){d.logError("Could not parse person JSON",h,{FIELD_VALUE:i.FIELD_VALUE,newsfeedEntryKey:t.newsfeedEntryKey});i.FIELD_VALUE=""}break}var f=this._sanitizeStoryVariables(i);f.BOX='<a href="#" class="streak__newsfeed_box">BOX</a>';f.PIPELINE='<a href="#" class="streak__newsfeed_pipeline">PIPELINE</a>';f.STORY_AUTHOR_DISPLAY_NAME='<span class="streak__author_name">'+i.STORY_AUTHOR_DISPLAY_NAME+"</span>";try{n.each(f,function(t,n){var i=new RegExp(e.Utils.RegExpQuote("<"+n+">"),"g");r=r.replace(i,t.replace(/\$/g,"$$$$"))})}catch(p){d.logError("newsfeed failed to render story template",null,{story:r,sanitizedStoryVariables:f});r=r.escapeHTML()}return r},_sanitizeStoryVariables:function(e){var t={};for(var n in e){var i=e[n];if(i){t[n]=(""+i).escapeHTML()}else{t[n]=i}}return t},_getUserImageUrl:function(t){if(t.userImageUrl){return t.userImageUrl}t.userImageUrl=e.server+e.combinedPath+"images/unknownContact.png";return t.userImageUrl},_getComment:function(e){if(e.detailText){var t=e.detailText.replace(/[<>]/g,"");if(t==="COMMENT"){return e.specificVariables[t]}}},_getDetailText:function(e){if(e.detailText){var t=e.detailText.replace(/[<>]/g,"");if(t!=="COMMENT"){return e.specificVariables[t]}}},_setupBoxLinks:function(e){e.find("a.streak__newsfeed_box").each(function(){var e=t(this);var n=e.attr("data-key");if(!n){d.logError("newsfeed box link had no key");return}var i=d.Data.getBox(n);if(!i){e.addClass("deleted")}else{e.attr("href","#"+i.link())}}).off("click").click(function(e){e.preventDefault();e.stopPropagation();var n=t(this);var i=n.attr("data-key");if(!i){return}var a=d.Data.getBox(i);if(!a){d.ButterBarManager.showError("That box could not be found.")}else{r.inboxSDK.Router.goto(a.link())}})},_setupPipelineLink:function(e,t){var n=e.find(".streak__newsfeed_pipeline");if(n.length===0){return}n.text(t.displayNameText());n.on("click",function(e){e.preventDefault();e.stopPropagation();r.inboxSDK.Router.goto(t.link())})},_addEventTracking:function(){d.Tracker.addDelegatedTracking(this._element,"a.streak__newsfeed_box","click",{eventName:"BoxClicked",widget:"Newsfeed"});d.Tracker.addDelegatedTracking(this._element,"a.streak__newsfeed_pipeline","click",{eventName:"PipelineClicked",widget:"Newsfeed"})},_watchModel:function(){this._model.watch("newComment",this.refresh.bind(this,false),this);u.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationIsComplete:true},observer:this,functionToCall:this._operationCompleted})},_operationCompleted:function(e){if(e.operationHasErrors){return}if(!e.operation||!e.operation.getModel||!e.operation.getModel()){return}var t=e.operation.getModel();if(t===this._model){this.refresh();return}},_isBox:function(){return this._model instanceof d.Models.Box},destroy:function(){this._destroyScrollHandler();u.unsubscribe({observer:this});e.Object.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.FeedListViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(e){var t=this;t._path=e.path;t._cssClass=e.cssClass;t._uniqueId=(Math.random()+"").replace(".","_");t._rawIframe=null;t._iframe=null;t._iframeLoaded=false;t._messageQueue=[];t._constructIframe()};o.extend(s.prototype,{_constructIframe:function(){var t=this;var n=e.$('<iframe class="'+this._cssClass+'"  src="'+e.server+"/clientiFrames/"+t._path+'.jsp"></iframe>');t._rawIframe=n[0];t._iframe=n;t._iframe.load(function(){t._iframeLoaded=true;t.handleQueuedMessages()})},sendMessage:function(e,t){var n=this;var i={functionName:e,args:t};n.handleMessage(i)},handleQueuedMessages:function(e){self=this;for(var t=0;t<self._messageQueue.length;t++){self.postMessageToIframe(self._messageQueue[t])}},handleMessage:function(e){var t=this;if(t._iframeLoaded){t.postMessageToIframe(e)}else{t._messageQueue.push(e)}},postMessageToIframe:function(e){this._rawIframe.contentWindow.postMessage(e,this._rawIframe.src)},addHandlerForIncomingMessages:function(e){var t=this},getFrameElement:function(){return this._iframe},destroy:function(){this._iframe.remove()},_handleMessage:function(e){var t=this},fff:function(){}});a.Widgets.IframeBridge=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={templates:{},defaults:{css:null,maxHeight:350},init:function(e){this.templates.menu=r.get("menuMenu");this.templates.item=r.get("menuMenuItem");this.templates.headerItem=r.get("menuHeaderItem");this.templates.checkItem=r.get("menuCheckItem");this.templates.radioItem=r.get("menuRadioItem");if(e){e()}},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)},createItem:function(e){var n=t(document.createElement("div"));n[0].innerHTML=this.templates.item();n=n.children();n.find(".text").empty().append(e);return n}};o.impl=function(e){var i=e,r=t(document.createElement("div")),a=null,s=null,l=null;var u=i.isLast;var c=[];var d=function(e,t,n){var i=h(e,t);m(i,n);return i},h=function(e,n){var i=t(document.createElement("div"));i[0].innerHTML=o.templates.item();i=i.children();i.find(".text").empty().append(e);var r=true;i.setEnabled=function(e){r=e;if(r){this.removeClass("disabled");this.attr("aria-disabled",false)}else{this.addClass("disabled");this.attr("aria-disabled",true)}};i.getEnabled=function(){return r};if(n){i.click(function(e){if(r){n(e)}})}i.superEasyHoverClass("J-N-JT");return i},f=function(e){var n=t(document.createElement("div"));n[0].innerHTML=o.templates.headerItem();n=n.children();n.find(".text").empty().append(e);m(n);return n},p=function(e,t){if(t){a.prepend(e)}else{a.append(e)}s.addClass("streak__bodyMenu_overflowAuto")},m=function(e,t){if(t){s.prepend(e)}else{s.append(e)}},_=function(e,t){if(t){l.prepend(e)}else{l.append(e)}s.addClass("streak__overflowAuto")},g=function(e){var t=v();m(t,e);return t},v=function(){var e=document.createElement("div");e.setAttribute("class","J-Kh");e.setAttribute("role","separator");return t(e)},y=function(e,t,n){var i=w(e,t,n);m(i);return i},w=function(e,n,i){var r=i;var a=t(document.createElement("div"));a[0].innerHTML=o.templates.checkItem();a=a.children();a.find(".text").html(e);if(r){a.addClass("J-LC-JR-Jp")}else if(r===null){a.addClass("J-LC-Ky-Jp")}if(n){a.click(function(e){e.stopPropagation();if(!s){return}r=r===null?false:!r;if(!r){a.removeClass("J-LC-JR-Jp");a.removeClass("J-LC-Ky-Jp")}else{a.addClass("J-LC-JR-Jp");a.removeClass("J-LC-Ky-Jp")}n(r,e)})}a.superEasyHoverClass("J-N-JT");a.setCheckboxState=function(e){r=e;a.toggleClass("J-LC-Ky-Jp",r===null);a.toggleClass("J-LC-JR-Jp",!!r)};var s=true;a.setEnabled=function(e){s=e;if(s){this.removeClass("disabled");this.attr("aria-disabled",false)}else{this.addClass("disabled");this.attr("aria-disabled",true)}};a.getEnabled=function(){return s};return a},b=function(e,t){var n=C(e,t);m(n);return n},C=function(e,i){var r=t(document.createElement("div"));r.addClass(e);r.addClass("J-awr");r.append('<div class="J-N">'+n.escape(i)+"</div>");return r},S=function(e,n,i,r){var a=r;var s=t(document.createElement("div"));s[0].innerHTML=o.templates.radioItem();s=s.children();s.find(".text").html(e);if(a){s.addClass("J-Ks-KO")}if(i){s.click(function(e){n.find(".radioItem").removeClass("J-Ks-KO");s.addClass("J-Ks-KO");a=true;i(a,e)})}s.select=function(){n.find(".radioItem").removeClass("J-Ks-KO");s.addClass("J-Ks-KO");a=true};s.superEasyHoverClass("J-N-JT");n.append(s);return s},T=function(e,t,n){var i=e,a=t,o=false;var s;var l;if(n){s=n.itemType;l=n.itemCallback}var h;if(s==="checkItem"){h=y(i,function(e,t){if(!o){if(l){l(e)}t.stopPropagation()}o=false},n.isChecked)}else{h=d(i,function(e){if(!o){if(l){l()}e.stopPropagation()}o=false})}c.push(a);a.setIsLast(u);a.el.click(function(){o=true});a.el[0].style.position="fixed";h.addClass("subMenuItem");h.append('<span class="outerMenuArrow"><span class="menuArrow"></span></span>');h.append(a.el);var f;h.hover(function(){if(!h.getEnabled()){return}a.el.show();clearTimeout(f);var e={top:h.offset().top,left:h.offset().left+r.outerWidth()-5};if(u){e.left+=-1*(r.outerWidth()+a.el.outerWidth())+5}a.el.css(e);a.el.containByScreen(h,{isAligned:true,isTopAligned:true,forceFit:true})},function(){f=setTimeout(function(){a.el.hide()},100)});return h},x=function(){a.hide()},k=function(){s.hide()},M=function(){l.hide()},L=function(){a.show()},B=function(){s.show()},E=function(){l.show()},D=function(e,t){if(t){s.prepend(e)}else{s.append(e)}return e},V=function(){a.empty();s.empty();l.empty()},I=function(){r.find(".J-N-JT").removeClass("J-N-JT");r.find(".hover").removeClass("hover");r.find(".bb_menu").hide();r.find(".J-LC-JR-Jp").removeClass("J-LC-JR-Jp")};r.addClass("J-M uEPqDe bb_menu");if(i.css){r.css(i.css)}r[0].innerHTML=o.templates.menu();a=r.find(".menuHeader");s=r.find(".menuBody");l=r.find(".menuFooter");if(i.maxHeight){r.css("max-height",i.maxHeight)}if(i.bodyMaxHeight){s.css("max-height",i.bodyMaxHeight)}return{el:r,addItem:d,addHeaderItem:f,addItemToBody:m,addItemToHeader:p,addItemToFooter:_,addCheckItem:y,addSubMenu:T,addSeparator:g,addSection:D,addRadioGroup:b,addRadioItem:S,createCheckItem:w,createItem:h,createRadioGroup:C,createSeparator:v,hideHeader:x,hideBody:k,hideFooter:M,showHeader:L,showBody:B,showFooter:E,empty:V,reset:I,getElement:function(){return r},setIsLast:function(e){u=e;for(var t=0;t<c.length;t++){if(c[t]&&c[t].setIsLast){c[t].setIsLast(u)}}},destroy:function(){r.remove()}}};e.DependencyManager.addFunction({functionKey:"menuInitialized",functionToCall:o.init,functionContext:o,dependentFunctionKeys:["htmlLoaded","localeLoaded"]});a.Widgets.Menu=o})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.UI,r=e.BentoBox.Widgets,a=e.Locale;var o=i.ViewController;n.Widgets.CollapsibleMultiselectMenuViewController=e.Class.subclass({className:"CollapsibleMultiselectMenuViewController",superclass:o,memberVariables:[{name:"_menuButton",destroy:true},{name:"_menu",destroy:true},{name:"_collapseItem",destroy:false},{name:"_expandItem",destroy:false},{name:"_items",destroy:false},{name:"_headerSeparator",destroy:false},{name:"_footerSeparator",destroy:false},{name:"_collapsed",destroy:false},{name:"_buttonPrefix",destroy:false}],_initialize:function(){o.prototype._initialize.call(this);this._items={};this._collapsed=false},create:function(e){var i=this;var r=e.menuOptions||{};if(r.bodyMaxHeight===undefined){r=t.extend(r,{bodyMaxHeight:150})}this._menu=n.Widgets.Menu.create(r);this._buttonPrefixHTML=e.buttonPrefixHTML||"";this._menuButton=n.Widgets.Buttons.ButtonFactory.createMenuButton(t.extend(e.buttonOptions,{menu:this._menu}));var a=this._menu.createRadioGroup("header");this._menu.addItemToHeader(a);this._collapseItem={label:e.collapseItem.label,value:e.collapseItem.value};this._expandItem={label:e.expandItem.label};this._menu.addRadioItem(e.collapseItem.label,a,t.bind(this._collapseItemChanged,this),true);this._menu.addRadioItem(e.expandItem.label,a,t.bind(this._expandItemChanged,this),false);this._headerSeparator=this._menu.createSeparator();this._menu.addItemToHeader(this._headerSeparator);this._footerSeparator=this._menu.createSeparator();this._menu.addItemToFooter(this._footerSeparator);var o=this._menu.createItem(e.selectAllItem.label,t.bind(this._selectAllChosen,this));this._menu.addItemToFooter(o);var s=this._menu.createItem(e.selectNoneItem.label,t.bind(this._deselectAllChosen,this));this._menu.addItemToFooter(s);var l=e.items;for(var u=0;u<l.length;u++){var c=l[u];var d=this._menu.addCheckItem(c.label,t.bind(this._selectionChangedFunction(c.value),this),c.selected);this._items[c.value]={label:c.label,value:c.value,checkbox:d,selected:c.selected}}this._collapse();this._view.addSubView(this._menuButton);return this},_collapseItemChanged:function(e){if(e){this._collapse();this._menuButton.off();this._reportChange()}},_expandItemChanged:function(e){if(e){this._expand();this._reportChange()}},_selectionChangedFunction:function(e){var t=this;return function(n){t._items[e].selected=n;t._reportChange()}},_selectAllChosen:function(){this._selectAll();this._reportChange()},_selectAll:function(){for(var e in this._items){this._items[e].checkbox.setCheckboxState(true);this._items[e].selected=true}},_deselectAllChosen:function(){this._deselectAll();this._reportChange()},_deselectAll:function(){for(var e in this._items){this._items[e].checkbox.setCheckboxState(false);this._items[e].selected=false}},_collapse:function(){if(this._collapsed){return}this._collapsed=true;this._headerSeparator.hide();this._menu.hideBody();this._menu.hideFooter();this._refreshButtonText()},_expand:function(){if(!this._collapsed){return}this._selectAll();this._collapsed=false;this._headerSeparator.show();this._menu.showBody();this._menu.showFooter();this._refreshButtonText()},_refreshButtonText:function(){var e="";if(this._collapsed){e=this._collapseItem.label}else{var t=this._getSelections();if(t.length===1){e=this._items[t[0]].label}else{e=t.length?a.getString("number_selected",{number:t.length}):a.getString("none_selected")
}}this._menuButton.setHTML(this._buttonPrefixHTML+e)},_getSelections:function(){if(this._collapsed){return this._collapseItem.value}else{selectedValues=[];for(value in this._items){if(this._items[value].selected){selectedValues.push(value)}}}return selectedValues},_reportChange:function(){this._callDelegateFunction("multiselectMenuSelectionsChanged",{delegator:this,selections:this._getSelections()});if(this._menuButton){this._refreshButtonText()}}})})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Library,o=e.Locale,s=e._,l=e.Date;var u=e.Class.subclass({className:"ListViewViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_dataSource",destroy:false,set:true,get:true},{name:"_currentSection",destroy:true,defaultValue:0},{name:"_currentRow",destroy:true,defaultValue:0},{name:"_selectedSection",destroy:true,defaultValue:0},{name:"_selectedRow",destroy:true,defaultValue:0},{name:"_cursor",destroy:true},{name:"_rowSelectionLocked",destroy:true,defaultValue:false},{name:"_scrollableElement",destroy:false}],_initialize:function(t){if(t){this._scrollableElement=t.scrollableElement}e.UI.ViewController.prototype._initialize.call(this);this._cursor=new i.Modules.CursorController;this._cursor.addDelegate(this);var n=this;this._delayedUnblockMouseEvents=s.debounce(function(){if(!n._view){return}n._view.unblockMouseEvents()},500)},_setupView:function(){this._view=new i.Widgets.ListView.ListViewView({scrollableElement:this._scrollableElement})},keyPressed:function(e,t){this._cursor.keyPressed(e,t)},keydown:s.debounce(function(e,t){this._cursor.keydown(e,t)},10,true),setDataSource:function(e){this._dataSource=e;this._view.setDataSource(e);e.addDelegate(this);if(this._dataSource.getWrapperClass){this._view.getElement().addClass(this._dataSource.getWrapperClass())}},_highlightCurrentRow:function(){this._highlightRow(this._currentSection,this._currentRow)},_highlightRow:function(e,t){if(e===-1||t===-1){return}if(this._isNotHighlightable(e,t)){return}this._view.highlightRow(e,t)},_unhighlightCurrentRow:function(){this._unhighlightRow(this._currentSection,this._currentRow)},_unhighlightRow:function(e,t){this._view.unhighlightRow(e,t)},_selectRow:function(){this._selectedSection=this._currentSection;this._selectedRow=this._currentRow;this._view.selectRow(this._currentSection,this._currentRow)},_deselectRow:function(){this._view.deselectRow(this._selectedSection,this._selectedRow)},_selectNextRow:function(){if(this._rowSelectionLocked){return}this._unhighlightCurrentRow();this._moveToNextRow();this._highlightCurrentRow()},_selectPreviousRow:function(){if(this._rowSelectionLocked){return}this._unhighlightCurrentRow();this._moveToPreviousRow();this._highlightCurrentRow()},_moveToNextRow:function(e){if(this._rowSelectionLocked){return}e=e||1;if(e>100){return}this._currentRow++;if(this._currentRow>=this._dataSource.numberOfRowsForSection(this._currentSection)){this._currentRow=0;this._currentSection++;if(this._currentSection>=this._dataSource.numberOfSections()){this._currentSection=0}if(this._dataSource.numberOfRowsForSection(this._currentSection)===0){this._moveToNextRow(e+1);return}}this._notifyMovedHighlightedRow()},_moveToPreviousRow:function(e){if(this._rowSelectionLocked){return}e=e||1;if(e>100){return}this._currentRow--;if(this._currentRow<0){this._currentSection--;if(this._currentSection<0){this._currentSection=this._dataSource.numberOfSections()-1}if(this._dataSource.numberOfRowsForSection(this._currentSection)===0){this._moveToPreviousRow(e+1);return}this._currentRow=this._dataSource.numberOfRowsForSection(this._currentSection)-1}this._notifyMovedHighlightedRow()},_resetCursor:function(){this._currentRow=-1;this._currentSection=-1},getHighlightedRowData:function(){return this._getRowData()},_getRowData:function(e,t){e=s.isReal(e)?e:this._currentSection;t=s.isReal(t)?t:this._currentRow;return this._dataSource.infoForRow(e,t)},rowHovered:function(e,t){if(this._rowSelectionLocked||this._isNotHighlightable(e,t)){return}this._currentSection=e;this._currentRow=t;this._highlightCurrentRow();this._notifyRowFocused()},_isNotHighlightable:function(e,t){return this._getRowData(e,t).isNotHighlightable},rowUnhovered:function(e,t){if(this._rowSelectionLocked){return}this._unhighlightRow(e,t);this._callDelegateFunction("rowUnfocused",this._getRowData(e,t))},rowPressed:function(e,t){if(this._rowSelectionLocked){return}if(this._dataSource.rowsAreNotSelectable&&this._dataSource.rowsAreNotSelectable()){return}this._currentSection=e;this._currentRow=t;this._deselectRow();this._selectRow();this._notifyRowPressed()},rowMetaActionPressed:function(e,t){this._callDelegateFunction("rowMetaActionPressed",this._getRowData(e,t))},cursorDown:function(){var e=this;this._view.blockMouseEvents();this._delayedUnblockMouseEvents();this._selectNextRow();this._notifyRowFocused()},cursorEnter:function(){if(!this.isRowHighlighted()){this._notifyEmptyPressed();return}this._deselectRow();this._selectRow();this._notifyRowPressed()},cursorUp:function(){var e=this;this._view.blockMouseEvents();this._delayedUnblockMouseEvents();this._selectPreviousRow();this._notifyRowFocused()},cursorLeft:function(){this._callDelegateFunction("cursorLeft",this._getRowData())},cursorRight:function(e){this._callDelegateFunction("cursorRight",this._getRowData(),e)},dataChanged:function(){this._unhighlightCurrentRow();this._resetCursor();this._refresh();if(this._dataSource.numberOfSections()===0){return}this._highlightCurrentRow();this._notifyRowFocused()},_notifyRowFocused:function(){if(this._currentSection===-1||this._currentRow===-1){return}var e=this._getRowData();this._callDelegateFunction("rowFocused",e);this._eventStream.push({eventName:"rowFocused",rowData:e})},_notifyRowPressed:function(){if(this._currentSection===-1||this._currentRow===-1){return}var e=this._getRowData();this._callDelegateFunction("rowPressed",e);this._eventStream.push({eventName:"rowPressed",rowData:e})},_notifyMovedHighlightedRow:function(){if(this._currentSection===-1||this._currentRow===-1){return}var e=this._getRowData();this._callDelegateFunction("movedRow",e);this._eventStream.push({eventName:"movedRow",rowData:e})},_notifyEmptyPressed:function(){this._callDelegateFunction("emptyPressed");this._eventStream.push({eventName:"emptyPressed"})},select:function(){this._unhighlightCurrentRow();this.cursorEnter();this._highlightCurrentRow()},highlightPosition:function(e){this._unhighlightCurrentRow();this._currentSection=e.sectionIndex;this._currentRow=e.rowIndex;this._moveToNextRow();this._moveToPreviousRow();this._highlightCurrentRow()},selectPosition:function(e){this._unhighlightCurrentRow();this._deselectRow();this._currentSection=e.sectionIndex;this._currentRow=e.rowIndex;this._moveToNextRow();this._moveToPreviousRow();this._highlightCurrentRow();this._selectRow()},isRowHighlighted:function(){return this._currentSection>=0&&this._currentRow>=0},reset:function(){this._deselectRow();this._unhighlightCurrentRow()},lockRowSelection:function(){this._rowSelectionLocked=true;this._selectRow()},unlockRowSelection:function(){this._rowSelectionLocked=false;this._deselectRow()},refresh:function(){this._refresh()},_refresh:function(){this._view.hide();this._view.empty();var e=this._dataSource.numberOfSections();if(e===0){return}s.times(e,this._renderSection,this);if(!this._dataSource.dontHighlightOnDataChange||!this._dataSource.dontHighlightOnDataChange()){if(this._currentSection===-1){this._currentSection=0}if(this._currentRow===-1){this._currentRow=0}}this._view.show()},_renderSection:function(e){if(!this._dataSource.sectionShouldShow(e)){return}if(this._dataSource.isSectionSeparator&&this._dataSource.isSectionSeparator(e)){this._view.renderSeparator();return}if(this._dataSource.isSectionFreeForm&&this._dataSource.isSectionFreeForm(e)){this._view.addFreeFormSectionElement(this._dataSource.getSectionFreeFormElement(e));return}var t,n,i,r,a,o;if(this._dataSource.sectionTitle){t=this._dataSource.sectionTitle(e)}if(this._dataSource.sectionTitleClass){n=this._dataSource.sectionTitleClass(e)}if(this._dataSource.sectionIconClass){i=this._dataSource.sectionIconClass(e)}if(this._dataSource.sectionAfterTitleIconClass){o=this._dataSource.sectionAfterTitleIconClass(e)}if(this._dataSource.doesSectionToggle){r=this._dataSource.doesSectionToggle(e)}if(this._dataSource.sectionTitleExtraText){a=this._dataSource.sectionTitleExtraText(e)}this._view.addSection(e,t,n,i,r,a,o);this._renderSectionRows(e)},_renderSectionRows:function(e){var t=this._dataSource.numberOfRowsForSection(e);s.times(t,this._renderRow.bind(this,e))},_renderRow:function(e,t){var n=this._dataSource.infoForRow(e,t);var i=null;if(n.viewController){n.viewController.setListViewController(this);this._view.addViewRow(n.viewController.getView(),e,t,n)}else{this._view.renderBasicListRow(n,e,t)}if(n.isHighlighted&&this._currentSection===-1&&this._currentRow===-1){this._currentSection=e;this._currentRow=t}},getScrollPosition:function(){return this._view.getElement().scrollTop()},setScrollPosition:function(e){this._view.getElement().scrollTop(e)}});a.set("BentoBox.Widgets.ListView.ListViewViewController",u)})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=e.Class.subclass({className:"ListViewView",superclass:e.UI.View,_memberVariables:[{name:"_dataSource",destroy:false,set:true},{name:"_scrollOnHighlight",destroy:true,set:true,defaultValue:true},{name:"_listItemHoverElement",destroy:true},{name:"_rows",destroy:true,defaultValue:{}},{name:"_sections",destroy:true,defaultValue:{}},{name:"_rowTemplate",destroy:false},{name:"_sectionTemplate",destroy:false},{name:"_mouseEventsBlocked",destroy:true,set:true,defaultValue:false},{name:"_scrollableElement",destroy:false}],_initialize:function(n){e.UI.View.prototype._initialize.call(this);this._rowTemplate=r.get("listViewRow");this._sectionTemplate=r.get("listViewSection");this._listItemHoverElement=t('<div class="streak__listView_hoverItem"></div>');this._scrollableElement=n.scrollableElement},_setupElement:function(){this._element=r.getElement("listViewMain")},getEl:function(){return this.getElement()},hide:function(){this._element.fastHide()},show:function(){this._element.fastShow()},empty:function(){this._element.empty();this._rows={};this._sections={}},blockMouseEvents:function(){this._mouseEventsBlocked=true},unblockMouseEvents:function(){this._mouseEventsBlocked=false},addSection:function(e,n,i,r,a,s,l){var u=t(document.createElement("div"));u[0].setAttribute("class","streak__listViewSection");u[0].innerHTML=this._sectionTemplate({title:n});var c=u.find(".streak__listViewHeader");if(o.isReal(r)){var d=c.find(".streak__bbIcon");d.css("display","");d.addClass(r)}c.add(i);if(!o.isReal(i)&&!o.isReal(n)){c.remove()}if(a){c.find(".streak__openCloseExpando")[0].style.display="";this._addSectionHeaderOpenCloseEvents(c,u)}else{c.find(".streak__openCloseExpando")[0].style.display="none"}if(l){c.find(".streak__titleExtra").before('<span class="streak__bbIcon '+l+'"></span>')}if(s){c.find(".streak__titleExtra").text(s);c.find(".streak__titleExtra").show()}else{c.find(".streak__titleExtra").hide()}this._element.append(u);this._sections[e]=u},_addSectionHeaderOpenCloseEvents:function(e,t){var n=true;e[0].addEventListener("click",function(){n=!n;if(n){e.find(".streak__openCloseExpando").removeClass("Wo").addClass("Wq");t.find(".streak__listViewTable")[0].style.display=""}else{e.find(".streak__openCloseExpando").removeClass("Wq").addClass("Wo");t.find(".streak__listViewTable")[0].style.display="none"}})},addViewRow:function(e,n,i,r){var a=t(document.createElement("div"));a[0].setAttribute("class","streak__listViewRow");a.append(e.getElement());this._setupRowBindings(a,n,i,r);this._rows[""+n+"_"+i]=a;this._sections[n].find(".streak__listViewTable").append(a)},renderBasicListRow:function(e,n,i){var r=t(document.createElement("div"));r[0].setAttribute("class","streak__listViewRow  J-N J-LC-Jz");if(e.text){r[0].innerHTML=this._rowTemplate({text:e.text})}else if(e.html){r[0].innerHTML=this._rowTemplate({text:""});r.find("div").html(e.html)}if(e.displayClass){r.addClass(e.displayClass)}if(e.hasRightArrow){r.find(".streak__menuArrow").show();r.find(".streak__menuArrow").css("visibility","visible")}if(e.hasLeftArrow){r.find(".streak__menuArrowLeft").show();r.find(".streak__menuArrowLeft").css("visibility","visible")}this._setupRowBindings(r,n,i,e);this._rows[""+n+"_"+i]=r;this._sections[n].find(".streak__listViewTable").append(r);if(e.isSelected){this.selectRow(n,i)}},_setupRowBindings:function(e,t,n,i){var r=this;e.mouseenter(function(){if(r._mouseEventsBlocked){return}r._callDelegateFunction("rowHovered",t,n);if(r._doesHaveItemMetaClass(t,n)){r._addHoverItemElement(e,t,n)}});e.mouseleave(function(){if(r._mouseEventsBlocked){return}r._callDelegateFunction("rowUnhovered",t,n);if(r._doesHaveItemMetaClass(t,n)){r._listItemHoverElement.remove()}});e.click(function(e){r._callDelegateFunction("rowPressed",t,n);e.stopPropagation()});e.mousedown(function(e){if(i.isDisabled){e.preventDefault()}})},_doesHaveItemMetaClass:function(e,t){return this._dataSource.getItemMetaClass&&this._dataSource.getItemMetaClass(e,t)},_addHoverItemElement:function(e,t,n){var i=this;this._listItemHoverElement.addClass(this._dataSource.getItemMetaClass(t,n));e.append(this._listItemHoverElement);this._listItemHoverElement.off(".listView");this._listItemHoverElement.on("click.listView",function(e){i._callDelegateFunction("rowMetaActionPressed",t,n);e.stopPropagation()})},renderSeparator:function(){var e=document.createElement("div");e.setAttribute("class","J-Kh");e.setAttribute("role","separator");this._element.append(e)},addFreeFormSectionElement:function(e){this._element.append(e)},unhighlightRow:function(e,t){if(o.isNotReal(e)||o.isNotReal(t)){return}this._element.find(".streak__listViewRowHover").removeClass("streak__listViewRowHover");var n=this._rows[""+e+"_"+t];if(o.isReal(n)){n.removeClass("streak__listViewRowHover")}},highlightRow:function(e,t){if(o.isNotReal(e)||o.isNotReal(t)){return}var n=this._rows[""+e+"_"+t];if(o.isReal(n)){n.addClass("streak__listViewRowHover");if(!this._dataSource.dontScrollOnHighlight||!this._dataSource.dontScrollOnHighlight()){n.scrollintoview({duration:0,scroller:this._scrollableElement})}}},selectRow:function(e,t){if(o.isNotReal(e)||o.isNotReal(t)){return}var n=this._rows[""+e+"_"+t];if(o.isReal(n)){n.addClass("streak__listViewRowSelected")}},deselectRow:function(e,t){if(o.isNotReal(e)||o.isNotReal(t)){return}var n=this._rows[""+e+"_"+t];if(o.isReal(n)){n.removeClass("streak__listViewRowSelected")}}});e.Library.set("BentoBox.Widgets.ListView.ListViewView",l)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=e.UI.Delegator;var u=e.Class.subclass({superclass:l,_memberVariables:[{name:"_sections",destroy:true}],_initialize:function(){l.prototype._initialize.call(this);this._sections=[];return this},removeAllSections:function(){this._sections.length=0;this._callDelegateFunction("dataChanged")},addSection:function(e){this._sections.push(e);this._callDelegateFunction("dataChanged");return this._sections.length-1},numberOfSections:function(){return this._sections.length},numberOfRowsForSection:function(e){var t=this._sections[e];if(!t){return-1}var n=t.rows;if(n){return n.length}return 0},sectionShouldShow:function(e){return true},isSectionSeparator:function(e){return false},isSectionFreeForm:function(e){return false},getSectionFreeFormElement:function(e){return null},infoForRow:function(e,t){if(this._sections.length===0){return}return this._sections[e].rows[t]},sectionTitle:function(e){return this._sections[e].name},sectionTitleClass:function(e){},sectionIconClass:function(e){},doesSectionToggle:function(e){return this._sections[e].doesSectionToggle},sectionTitleExtraText:function(e){return this._sections[e].extraHeaderText}});e.Library.set("BentoBox.Widgets.ListView.ListViewBaseModel",u)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={templates:{},defaults:{list:null,model:null,property:null,fieldIndex:-1,autoSave:true,buttonColor:"normal",autoClose:false},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(e){if(!this.templates.button){this.templates.button=r.get("smartButtonMenuButton")}}};o.impl=function(e){var t=e;var r=false;t.trackingContext.widgetContext+="/smartButtonMenu";var o=a.Widgets.Button.create({trackingContext:t.trackingContext,color:t.buttonColor,isToggle:true,onFunc:function(e){s.focus()},offFunc:function(e){s.hide();o.el.focus()},isDropdown:true});t.span=o.el;t.extraHTML=o.innerEl[0].innerHTML;var s=a.Widgets.SmartDropdown.create(t);s.el.bind({menuClosed:function(){o.off()},itemSelected:function(){o.off()},innerTabPressed:function(){o.off();o.el.trigger("tabPressed")},innerShiftTabPressed:function(){o.off();o.el.trigger("shiftTabPressed")}});if(t.autoClose){o.el.bodyCloseAndStop({closeFunction:function(){o.off();o.el.blur()},body:i.elements.body,stop:s.el[0]})}s.getElement=function(){return s.el};s.setEnabled=function(e){if(e){s.el.removeClass("disabled");o.enable()}else{s.el.addClass("disabled");o.disable()}};var l=s.destroy;s.destroy=function(){if(n.isFunction(l)){l()}o.el.unbindBodyCloseAndStop();o.destroy()};return s};a.Widgets.SmartButtonMenu=o})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox;var r={defaults:{pipeline:null,box:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};r.impl=function(t){var n={};var r=t;r.trackingContext.widgetContext+="/stageButton";var a=i.Widgets.SmartButtonMenu.create({list:r.pipeline.getStagesAsListText(),model:r.box,property:"stageKey",overrideTab:true,autoClose:true,trackingContext:r.trackingContext});if(r.box){a.setEnabled(r.box.getIsEditable()&&i.Services.AccessManager.arePermissionsAllowed(r.pipeline,[{entityType:"Box",action:"UPDATE"},{entityType:"FieldBox",action:"UPDATE"}]))}var o=function(){a.renderMenu(r.pipeline.getStagesAsListText())};r.pipeline.watch("stageChange",o,n);var s=a.destroy;a.destroy=function(){if(s){s()}e.NotificationCenter.unsubscribe({observer:n})};return a};i.Widgets.StageButton=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"NewSpreadsheet",superclass:e.UI.View,_memberVariables:[{name:"_inputMap",destroy:false,defaultValue:{}},{name:"_createdInputs",destroy:true,defaultValue:[]},{name:"_currentInput",destroy:false},{name:"_tableModel",destroy:false},{name:"_cursorModel",destroy:false},{name:"_cursorDiv",destroy:true},{name:"_renderSettings",destroy:false},{name:"_groupRows",destroy:false},{name:"_currentStickyGroupRow",destroy:false,defaultValue:0},{name:"_boundCopyCellFunction",destroy:false}],render:function(){this._removeGlobalEventListeners();this._resetElement();this._resetRenderSettings();this._renderHead();this._generateWidthMap();this._renderGroupRows();this._generateGroupRowStats();this._setupClickBlurHandler();this._forceRedraw();this._setupOnscrollHandler();d.globals.activeSpreadsheet=this},redraw:function(){this._redraw()},resize:function(){this._element[0].style.height=this._element.parent()[0].offsetHeight+"px";this._element[0].style.width=this._element.parent()[0].offsetWidth+"px";this._forceRedraw()},focus:function(){this._cursorDiv.fastShow();this._redrawCursor();this._element.focus()},unfocus:function(){this._cursorDiv.fastHide();this._closeMenus();this._element.blur()},blur:function(){this._delegate.unfocusCursor();if(this._cursorDiv.isVisible()){this._cursorDiv.fastHide()}this._closeMenus();this._element.blur()},_initialize:function(t,n){e.Object.prototype._initialize.call(this);this._tableModel=t;this._cursorModel=n;this._setupElement();this._setupCursor();this._setupGeneralDOMEventBindings();this._setupKeyboardEventBindings();this._setupCopyAndPasteEventBindings();this._initializeColumnMenu();this._initializeRenderSettings()},_setupElement:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","spreadsheet scrollable");this._element[0].setAttribute("tabindex","-1");this._element[0].setAttribute("dir","ltr")},_setupCursor:function(){var e=this;this._cursorDiv=t(document.createElement("div"));this._cursorDiv[0].setAttribute("class","cursor");this._cursorDiv[0].oncontextmenu=function(){if(e._renderSettings.currentCoord[0]===0){if(e._renderSettings.currentCoord[1]>1){e._renderSettings.currentCell.customTrigger("showMenu");return false}}};this._cursorDiv.click(function(){e._tableModel.cursorSelect()})},_setupGeneralDOMEventBindings:function(){this._setupCellDelegateEvents();this._setupElementCustomEventBindings();this._setupGroupSummaryMenuEvents();this._setupEventPropagationStops()},_setupCellDelegateEvents:function(){var e={};var n=this;e["mousedown.bbCursor"]=function(e){e.stopPropagation();if(t(e.originalEvent.srcElement).parents(".bb_menu").length>0){return}var i=e.currentTarget;var r=n._extractCellPosition(i);n._closeMenus();var a=n._delegate.cursorSelect(r,e.shiftKey);if(!a){return}e.preventDefault();if(n._currentInput){return}if(n._delegate.isMenuOpen()){return}n._element.focus()};e["enterPressed.bbEvent"]=function(e){if(n._tableModel.canGoDownOnEnter(n._delegate.getCursorPosition())){n._delegate.updateCursorPosition("down",0)}else{n._delegate.unfocusCursor();n._delegate.focus()}n._element.focus()};e["escapePressed.bbEvent"]=function(e){n._delegate.unfocusCursor();n._delegate.focus()};e["tabPressed.bbEvent"]=function(e){n._delegate.updateCursorPosition("down",1);n._element.focus()};e["shiftTabPressed.bbEvent"]=function(e){n._delegate.updateCursorPosition("up",1);n._element.focus()};e["keypress.bbEvent"]=function(e){if(e.which===13){e.stopPropagation();e.preventDefault()}};this._element.on(e,".cell, .headCell")},_setupElementCustomEventBindings:function(){var e=this._element;var t=this;e.bind({upPressed:function(n){t._delegate.updateCursorPosition("up",0);e.focus()},rightPressed:function(n){t._delegate.updateCursorPosition("down",1);e.focus()},downPressed:function(n){t._delegate.updateCursorPosition("down",0);e.focus()},leftPressed:function(n){t._delegate.updateCursorPosition("up",1);e.focus()},mouseup:function(e){var n=e.originalEvent.srcElement;if(n===t._renderSettings.tbody[0]||n===t._renderSettings.overflowBody[0]||n===t._element[0]){t.blur()}}})},_setupGroupSummaryMenuEvents:function(){var e=this;this._element.on("mousedown",".streak__group_summary_link",function(n){if(t(n.originalEvent.srcElement).parents(".bb_menu").length>0){return}n.stopPropagation();var i=t(n.currentTarget);var r=i.closest(".cell");var a=e._extractCellPosition(r[0]);if(r.find(".bb_menu").length>0){e._closeMenus();return}if(!e._getPipelineIsEditable()){return}e._closeMenus();e._delegate.unfocusCursor();i=r.find(".streak__group_summary_link");i.append(d.globals.groupSummaryMenu.getElement());d.globals.groupSummaryMenu.setup(e._tableModel.getColumnData(a[1]),r)})},_setupEventPropagationStops:function(){this._element.bind("keydown",function(e){e.stopPropagation()});this._addKeyboardBindingToElement("escape/delete/del/backspace",function(e){})},_setupKeyboardEventBindings:function(){var e=this._element;var t=this;c.Keyboard.bindChordToElement(e,"tab",function(n){t._delegate.updateCursorPosition("down",1);e.focus()},true,true);c.Keyboard.bindChordToElement(e,"shift+tab",function(n){t._delegate.updateCursorPosition("up",1);e.focus()},true,true);this._addKeyboardBindingToElement("down",function(e){t._delegate.updateCursorPosition("down",0)});this._addKeyboardBindingToElement("up",function(e){t._delegate.updateCursorPosition("up",0)});this._addKeyboardBindingToElement("right",function(e){t._delegate.updateCursorPosition("down",1)});this._addKeyboardBindingToElement("left",function(e){t._delegate.updateCursorPosition("up",1)});this._addKeyboardBindingToElement("home",function(e){t._delegate.updateCursorToBeginning(1)});this._addKeyboardBindingToElement("end",function(e){t._delegate.updateCursorToEnd(1)});this._addKeyboardBindingToElement("ctrl+down/meta+down",function(){t._delegate.updateCursorToEnd(0)});this._addKeyboardBindingToElement("ctrl+up/meta+up",function(){t._delegate.updateCursorToBeginning(0)});this._addKeyboardBindingToElement("ctrl+right/meta+right",function(e){t._delegate.updateCursorToEnd(1)});this._addKeyboardBindingToElement("ctrl+left/meta+left",function(e){t._delegate.updateCursorToBeginning(1)});this._addKeyboardBindingToElement("ctrl+home/meta+home",function(e){t._delegate.updateCursorToBeginning(0);t._delegate.updateCursorToBeginning(1)});this._addKeyboardBindingToElement("ctrl+end/meta+end",function(e){t._delegate.updateCursorToEnd(0);t._delegate.updateCursorToEnd(1)});this._addKeyboardBindingToElement("space/=/enter",function(e){t._delegate.cursorSelect(null,e.shiftKey)});this._addKeyboardBindingToElement("[a-z]/[0-9]/shift+[a-z]/shift+[0-9]",this._setCharacterInCurrentCell.bind(this));c.Keyboard.bindChordToElement(e,"ctrl+b/meta+b",function(e){t._delegate.startNewBox()},true,true,false,null,true);c.Keyboard.bindChordToElement(e,"ctrl+d/meta+d",function(e){t._delegate.startDeleteBox()},true,true,false,null,true)},_addKeyboardBindingToElement:function(e,t){c.Keyboard.bindChordToElement(this._element,e,t,true,true,true)},_setCharacterInCurrentCell:function(e){this._delegate.cursorSelect();if(!this._currentInput){return}var t=String.fromCharCode(e.which);if(e.shiftKey){if(d.globals.numberMap[t]){t=d.globals.numberMap[t]}else{t=t.toUpperCase()}}else{t=t.toUpperCase();t=t.toLowerCase()}this._currentInput.set(t)},_setupCopyAndPasteEventBindings:function(){this._boundCopyCellFunction=this._copyCell.bind(this);window.addEventListener("copy",this._boundCopyCellFunction);this._element[0].addEventListener("paste",this._handlePaste.bind(this))},_copyCell:function(e){if(this._currentInput){return}if(!this._cursorDiv.isVisible()){return}var n=t(e.srcElement);if(n.parents(this._element).length===0){return}var i=e.clipboardData?e.clipboardData:window.clipboardData;if(!i||!i.setData){return}i.setData("text",this._tableModel.getTextValue(this._tableModel.getCursorPosition()));e.preventDefault()},_handlePaste:function(e){if(t(e.target).is("input, [contenteditable=true]")){return}if(this._currentInput){return}var i=e.clipboardData.getData("text/plain");if(!n.isReal(i)){return}this._delegate.cursorSelect();if(this._currentInput){this._currentInput.set("")}},_initializeColumnMenu:function(){d.globals.columnMenu.setItemChosenCallback(this._closeMenus.bind(this));d.globals.groupSummaryMenu.setItemChosenCallback(this._closeMenus.bind(this))},_initializeRenderSettings:function(){this._renderSettings={contentRows:[],orderedContentRows:[],groupRows:[],groupRowNameWidth:0,totalWidth:0,widthMap:[],columnStartingPosition:[],visibleColumnRange:{start:0,end:-1},previousVisibleColumnRange:null,visibleColumns:0,currentCell:null,currentCoord:null,cursorAtTop:false,highlightCell:null,headCollapse:null,headCheckbox:null,headCheckboxInput:null,currentInputBoundingBox:{top:null,left:null,right:null,bottom:null}}},widthChange:function(e){this._generateWidthMap();for(var t=0;t<this._renderSettings.contentRows.length;t++){var n=this._renderSettings.contentRows[t];var i=n.DOMRow.children();var r=i.length;for(var a=0;a<r;a++){i[a].style.width=this._renderSettings.widthMap[a]+"px";i[a].style.left=this._renderSettings.columnStartingPosition[a-2]+"px"}}for(var o=0;o<this._groupRows.length;o++){var s=this._groupRows[o];var i=s.DOMRow.children();var r=i.length;for(var a=0;a<r;a++){i[a].style.width=this._renderSettings.widthMap[a]+"px";i[a].style.left=this._renderSettings.columnStartingPosition[a-2]+"px"}}this._renderSettings.tbody[0].style.width=d.globals.widthConstants.table+this._renderSettings.groupRowNameWidth+1+"px";this._redrawCursor()},redrawTable:function(){this._forceRedraw()},redrawContentRows:function(){this.redrawHeaderRow();this._redraw(true)},redrawHeaderRow:function(){this.redrawRow(0)},redrawGroupRows:function(){this._redrawGroupRows()},redrawRow:function(e){if(e===0){for(var t=0;t<this._tableModel.getNumberOfVisibleColumnsForRow([0,0]);t++){this._updateHeadCell([0,t])}return}if(this._tableModel.isGroup([e,0])){var n=this._tableModel.getGroupIndex(e);this._redrawGroupRow(this._groupRows[n],e);return}var i=this._tableModel.getRowHash(e);var r=this._getRowsForHash(i);for(var a=0;a<r.length;a++){this._renderContentRow(r[a],r[a].rowIndex,true)}},redrawCell:function(e){if(e[0]===0){this._updateHeadCell(e)}else{if(this._isCellChangeInGroupRow(e)){this._cellChangeInGroupRow(e);return}var t=this._tableModel.getRowHash(e[0]);var n=this._getRowsForHash(t);for(var i=0;i<n.length;i++){var r=n[i];if(r.DOMRow[0].style.display==="none"){continue}var a=r.DOMRow.children()[e[1]];if(this._tableModel.getActionType(e)==="CHECKBOX"){if(e[1]>1){this._renderContentCheckboxCell(a,[r.rowIndex,e[1]])}else{this._renderCheckboxCell(a,a.querySelectorAll("div")[0],[r.rowIndex,e[1]])}}else{var o=this._renderCell(a,[r.rowIndex,e[1]]);if(o){o.focus()}}}}},_isCellChangeInGroupRow:function(e){if(!this._renderSettings){return}return this._renderSettings.groupRowIndexes.indexOf(e[0])>-1},_cellChangeInGroupRow:function(e){var t=this._renderSettings.groupRowIndexes.indexOf(e[0]);var n=this._groupRows[t];var i=this._renderSettings.groupRowIndexes[t];if(e[1]===0){this._renderCell(n.firstChild,[i,0]," cellExpando",true);return}if(e[1]===1){this._renderCheckboxCell(n.checkboxHolder,n.checkboxInput,[i,1]);return}var r=this._renderCell(n.cells[e[1]-2],e,"groupCell"+(e[1]===2?" streak__nameGroupCell":""),true);if(r){r.focus()}},_handleCursorChange:function(e,t,n,i,r){this._saveCellChanges();if(n){this._cursorDiv.fastShow("block");this._renderCursor(e,t,i,r)}else{this._cursorDiv.fastHide()}},setScrollPosition:function(e){this._renderSettings.overflowBody[0].scrollTop=e.scrollTop;this._renderSettings.overflowBody[0].scrollLeft=e.scrollLeft},hideCursor:function(){this._saveCellChanges();this._cursorDiv.fastHide()},showCursor:function(e,t){this._saveCellChanges();this._cursorDiv.fastShow("block");this._renderCursor(e,t.noHorizontalScroll,t.toTop,t.noScroll)},scrollCursorToTop:function(){this._renderCursor(this._delegate.getCursorPosition(),true,true,false)},_renderCursor:function(e,t,n,i){var r=-2;var a={};if(e[0]===0){this._cursorDiv[0].style.top=Math.max(d.globals.contentRowHeight*(e[0]-1)-2,-1)+"px";this._cursorDiv[0].style.zIndex=3;a.top=0;this._renderSettings.cursorAtTop=true;this._cursorDiv[0].style.pointerEvents="none"}else{this._renderSettings.cursorAtTop=false;var o=this._getRowTopPosition(e[0]);o+=d.globals.contentRowHeight;o-=this._renderSettings.top;this._cursorDiv[0].style.top=o+"px";if(this._renderSettings.top>0){this._cursorDiv[0].style.zIndex=1}a.top=this._getRowTopPosition(e[0]-2);this._cursorDiv[0].style.pointerEvents=""}var s=this._tableModel.isGroup(e);if(s){this._cursorDiv[0].style.height=this._getGroupRowHeight()-2+"px"}else{this._cursorDiv[0].style.height=d.globals.contentRowHeight-2+"px"}if(e[1]===0){this._cursorDiv[0].style.width=d.globals.widthConstants.col1+"px"}else if(e[1]===1){r+=d.globals.widthConstants.col1;this._cursorDiv[0].style.width=d.globals.widthConstants.col2+"px"}else{r+=d.globals.widthConstants.col1+d.globals.widthConstants.col2;if(s){this._cursorDiv[0].style.width=this._renderSettings.groupRowNameWidth+"px"}else{for(var l=2;l<e[1];l++){r+=this._renderSettings.widthMap[l]+d.globals.columnPadding}this._cursorDiv[0].style.width=this._renderSettings.widthMap[e[1]]+d.globals.columnPadding+"px"}}this._cursorDiv[0].style.left=r-this._renderSettings.left+"px";if(!i){a.bottom=a.top+d.globals.contentRowHeight+100;a.left=parseInt(this._cursorDiv[0].style.left,10)-80;a.right=a.left+parseInt(this._cursorDiv[0].style.width,10)+95;this._renderSettings.tbody.scrollintoview({duration:0,direction:t?"y":"both",toTop:n,rectangle:a,scroller:this._renderSettings.overflowtBody})
}this._renderSettings.currentCoord=e},_resetElement:function(){this._element.find(".thead").detach();this._element[0].innerHTML='<div class="thead bb_tr"></div><div class="spreadsheetContainer"><div class="overflowtBody"><div class="tbody"></div></div></div>';this._element.append(this._cursorDiv)},_resetRenderSettings:function(){this._renderSettings.contentRows=[];this._renderSettings.spreadsheetContainer=this._element.find(".spreadsheetContainer");this._renderSettings.overflowBody=this._element.find(".overflowtBody");this._renderSettings.tbody=this._element.find(".tbody");this._renderSettings.thead=this._element.find(".thead");this._renderSettings.left=0;this._renderSettings.top=0;this._renderSettings.highlightCell=null;this._renderSettings.currentCoord=[0,0];this._renderSettings.currentColumnCutoff=-1},_renderHead:function(){var e,n=0;var i=false;var r=this._element.find("div.thead");r[0].innerHTML='<div class="bb_th first-child cell cellExpando" tabindex="-1"></div><div class="bb_th firstHidden second-child cell" tabindex="-1" role="checkbox"><div class="oZ-jc T-Jo J-J5-Ji"><div class="T-Jo-auh"></div></div></div>';var a=this._element.find(".thead .firstHidden");var o=r.children();this._renderSettings.headCollapse=o[0];this._renderSettings.headCheckbox=o[1];this._renderSettings.headCheckboxInput=t(o[1]).find("[role=checkbox] div")[0];for(e=2,n=0;e<this._tableModel.getTotalColumnCount()+2;e++){if(this._tableModel.isColumnNotPresent(e)){continue}if(this._tableModel.isColumnVisible(e)){var s=this._renderHeadCell(n,e);r[0].appendChild(s[0]);a=s;i=false;n++}else{if(!i){this._renderHeadHiddenCell(a,e)}}}this._renderSettings.visibleColumns=n;r.append("<br />");var l=this;if(this._getPipelineIsEditable()){r.find(".headCell").columnReorder({body:this._renderSettings.tbody,doneReorder:function(e,t,n){l._tableModel.columnReorder(e,t,n);c.Tracker.trackStreakActive(d.globals.trackingContext,{eventName:"ColumnOrderChanged"})}})}this._redrawHead()},_renderHeadCell:function(e,n){var i=this;var r=e+2;var a=t(document.createElement("div"));var o=t(document.createElement("div"));o.addClass("name");a[0].setAttribute("class","bb_th headCell");a[0].setAttribute("tabindex","-1");a[0].setAttribute("cellPosition","0,"+r);if(this._tableModel.isColumnRenameable(n)){a.addClass("th_editable")}var s=this._tableModel.getColumnWidth(n);a.css({minWidth:s,width:s,maxWidth:s});if(this._getPipelineIsEditable()){a.colResizable({onResize:function(e){i._tableModel.setColumnWidth(n,e)},doneResize:function(){i._tableModel.saveColumnWidth(n)}})}o.append(i._tableModel.getHTMLValue([0,r]));o[0].setAttribute("data-tooltip",i._tableModel.getTextValue([0,r]));var l=t('<div class="settings"><div class="afM"></div></div>');var u=l.find(".afM");u.easyHoverClass("afN");function h(e){if(l.find(".bb_menu").length>0){if(l.find(".bb_menu").is(":FastVisible")){i._closeMenus()}}else{i._closeMenus();l.append(d.globals.columnMenu.menu.el);d.globals.columnMenu.setColumnData(i._tableModel.getColumnData(r),i._getPipeline(),a)}}u.on("mousedown",function(e){i._delegate.unfocusCursor();h();c.Tracker.trackStreakActive(d.globals.trackingContext,{eventName:"ColumnMenuArrowClick"});e.stopPropagation();e.preventDefault();i._delegate.setIsMenuOpen(true)});a.customBind("showMenu",function(){h(true)});a[0].oncontextmenu=function(){c.Tracker.trackStreakActive(d.globals.trackingContext,{eventName:"ColumnRightClick"});h(true);return false};a.append(o);if(this._getPipelineIsEditable()){a.append(l)}return a},_getPipelineIsEditable:function(){var e=this._getPipeline();return e.getIsEditable()&&c.Services.AccessManager.isAccessAllowed(e,"Pipeline","UPDATE")},_getPipeline:function(){return this._tableModel.getPipeline()},_renderHeadHiddenCell:function(e,n){var i=t(document.createElement("div"));i[0].innerHTML='<div class="streak__hiddenContainer"></div><div class="streak__hiddenContainerTwo"><div class="left"></div><div class="right"></div></div>';i.addClass("hiddenCell");e.append(i);var r=this;i.mousedown(function(e){r._tableModel.action([0,n]);e.stopPropagation()})},_generateWidthMap:function(){this._renderSettings.widthMap=[];this._renderSettings.groupRowNameWidth=0;this._renderSettings.columnStartingPosition.length=0;var e=d.globals.widthConstants.col1+d.globals.widthConstants.col2;for(var t=2,i=0;t<this._tableModel.getTotalColumnCount()+2;t++){if(this._tableModel.isColumnNotPresent(t)){continue}if(this._tableModel.isColumnVisible(t)){this._renderSettings.columnStartingPosition.push(e);var r=i+2;var a=this._tableModel.getColumnWidth(t);this._renderSettings.widthMap[r]=a;this._renderSettings.groupRowNameWidth+=this._renderSettings.widthMap[r]+d.globals.columnPadding;i+=1;e+=a+d.globals.columnPadding}}this._renderSettings.visibleColumnRange.start=0;this._renderSettings.visibleColumnRange.end=this._renderSettings.widthMap.length;this._renderSettings.totalWidth=n.reduce(this._renderSettings.widthMap,function(e,t){return e+t+d.globals.columnPadding},d.globals.widthConstants.col1+d.globals.widthConstants.col2)},_renderGroupRows:function(){var e=this._tableModel.getNumberOfGroupRows();this._groupRows=[];for(var t=0;t<e;t++){var n=this._renderGroupRow(t);var i={DOMRow:n,cells:n.findReturnRaw(".groupCell"),firstChild:n.findReturnRaw(".first-child")[0],checkboxHolder:n.findReturnRaw("[role=checkbox]")[0],checkboxInput:n.findReturnRaw("[role=checkbox] div")[0]};this._groupRows.push(i);this._renderSettings.tbody.append(i.DOMRow)}},_renderGroupRow:function(e){var n=document.createElement("div");n.setAttribute("class","bb_row bb_tr group bb_hbox");var i=d.globals.templates.groupRow;for(var r=2;r<this._renderSettings.visibleColumns+2;r++){i+=['<div class="cell groupCell" tabindex="-1" style="width:'+this._renderSettings.widthMap[r]+"px; left:"+this._renderSettings.columnStartingPosition[r-2]+'px;">',"</div>"].join("")}n.innerHTML=i;n=t(n);n[0].style.display="block";var a=this._tableModel.getGroupRowColor(e);n[0].style.backgroundColor=a.backgroundColor;n[0].style.color=a.textColor;return n},_generateGroupRowStats:function(){this._renderSettings.groupRowIndexes=this._tableModel.getGroupRowIndexes()},_setupOnscrollHandler:function(){var e=this;var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame;e._renderSettings.overflowBody[0].onscroll=function(n){t(function(){e._renderSettings.left=e._renderSettings.overflowBody[0].scrollLeft;e._renderSettings.top=e._renderSettings.overflowBody[0].scrollTop;e._renderSettings.bottom=e._renderSettings.top+e._renderSettings.offsetHeight;e._repositionGroupRows();e._redraw();e._delegate.registerScrollPosition({scrollTop:e._renderSettings.top,scrollLeft:e._renderSettings.left})});n.stopPropagation();n.stopImmediatePropagation()}},_removeOnscrollHandler:function(){if(this._renderSettings.overflowBody&&this._renderSettings.overflowBody.length>0){this._renderSettings.overflowBody[0].onscroll=null}},_setupClickBlurHandler:function(){var e=this;this._renderSettings.overflowBody.bodyCloseAndStop({body:r.elements.body,stop:null,useCapture:true,closeFunction:function(n){if(!e._element.isVisible()){return}var i=t(n.target);if(i.is(".bb_menu, .streak__spreadsheetStopper, .streak__helpModal")){return}var r=i.parents();if(r.filter(".bb_menu, .streak__spreadsheetStopper, .streak__helpModal").length>0){return}if(r.filter(e._element).length===0){e.blur()}}})},_forceRedraw:function(){if(!this._element.isVisible()){return}this._setupViewport();this._redrawHead();this._redrawGroupRows();this._redraw(true)},_setupViewport:function(){if(!this._renderSettings||!this._renderSettings.tbody){return}this._renderSettings.overflowBodyWidth=this._renderSettings.overflowBody.width();this._renderSettings.offsetHeight=this._element[0].offsetHeight;this._renderSettings.tbody[0].style.width=d.globals.widthConstants.table+this._renderSettings.groupRowNameWidth-d.globals.columnPadding+"px";this._renderSettings.tbody[0].style.height=(this._tableModel.getLastRowNumber()-this._tableModel.getNumberOfGroupRows())*d.globals.contentRowHeight+this._tableModel.getNumberOfGroupRows()*d.globals.groupRowHeight+d.globals.paddingBottom+"px";this._element[0].style.height=this._element.parent()[0].offsetHeight+"px";this._element[0].style.width=this._element.parent()[0].offsetWidth+"px"},_throttledSetupViewport:n.throttle(function(){this._setupViewport()},1e3),_redraw:function(e){if(!this._renderSettings||!this._renderSettings.tbody){return}this._throttledSetupViewport();var t=d.globals.contentRowHeight;var i=this._renderSettings.offsetHeight;var r=this._renderSettings.top;var a=this._renderSettings.left;var o=this._renderSettings.overflowBodyWidth;var s=Math.floor((r+this._currentStickyGroupRow*(d.globals.contentRowHeight-this._getGroupRowHeight()))/t);var l=this._tableModel.getLastRowNumber();var u=d.globals.viewportBuffer;var c=Math.floor(i/t)+u;this._ensure(c);var h=Math.max(s-Math.ceil(u/2),0);var f=Math.min(l,h+c);h=Math.max(0,f-c);var p=this._renderSettings.contentRows;this._renderSettings.orderedContentRows.length=0;var m=a-20;var _=a+o+20;this._renderSettings.previousVisibleColumnRange=n.clone(this._renderSettings.visibleColumnRange);this._renderSettings.visibleColumnRange.start=0;for(var g=0;g<this._renderSettings.columnStartingPosition.length;g++){var v=this._renderSettings.columnStartingPosition[g];if(v<m){this._renderSettings.visibleColumnRange.start=g}if(_>v){this._renderSettings.visibleColumnRange.end=g}}for(var y=h;y<h+p.length;y++){var w=p[y%p.length];if(y<l){this._renderContentRow(w,y+1,e);this._renderSettings.orderedContentRows.push(w)}else{w.DOMRow[0].style.display="none"}}this._renderSettings.thead[0].style.left=-1*a+"px";this._redrawCursor();this._redrawHead();if(this._currentInput&&this._renderSettings.currentInputBoundingBox.top>this._renderSettings.top&&this._renderSettings.currentInputBoundingBox.bottom<this._renderSettings.bottom&&this._renderSettings.currentInputBoundingBox.left>this._renderSettings.left&&this._renderSettings.currentInputBoundingBox.right<this._renderSettings.totalWidth){this._currentInput.focus(true)}},_ensure:function(e){var n=d.globals.templates.contentRow;for(var i=2;i<this._renderSettings.visibleColumns+2;i++){n+='<div class="cell contentCell" tabindex="-1" style="width:'+this._renderSettings.widthMap[i]+"px; left:"+this._renderSettings.columnStartingPosition[i-2]+'px;"></div>'}while(this._renderSettings.contentRows.length<e){var r=document.createElement("div");r.setAttribute("class","contentRow bb_row");r.style.width=this._renderSettings.totalWidth+"px";r.innerHTML=n;r=t(r);r.fastHide();var a={DOMRow:r,cells:r.findReturnRaw(".contentCell"),firstChild:r.findReturnRaw(".first-child")[0],checkboxHolder:r.findReturnRaw("[role=checkbox]")[0],checkboxInput:r.findReturnRaw("[role=checkbox] div")[0]};this._renderSettings.contentRows.unshift(a);this._renderSettings.tbody.prepend(a.DOMRow)}},_redrawHead:function(){this._renderCell(this._renderSettings.headCollapse,[0,0]," bb_th first-child cellExpando");this._renderCheckboxCell(this._renderSettings.headCheckbox,this._renderSettings.headCheckboxInput,[0,1]);this._updateCellClass(this._renderSettings.headCheckbox,[0,1]," bb_th ")},_updateHeadCell:function(e){if(e[1]<2){this._redrawHead();return}var n=this._tableModel.getState(e);var i=t(this._renderSettings.thead.children()[e[1]]);if(!i||i.length===0){return}switch(n){case"DEFAULT":case"HIGHLIGHT":i.find(".name").html(this._tableModel.getHTMLValue(e));i.children().fastShow("block");if(n==="HIGHLIGHT"){this._renderSettings.currentCell=i}break;case"EDIT":var r=this._tableModel.getData(e);if(r.model){i.children().fastHide();r.parent=i;this._currentInput=this._getInput(r.type);this._currentInput.setup(r);i.append(this._currentInput.getElement());this._currentInput.focus();this._renderSettings.currentCell=i}break}this._updateHeadCellClass(i[0],e,n)},_updateHeadCellClass:function(e,t,n){var i=this._getExtraClassesForCell(t);if(t[1]>1){i+=" bb_th headCell "}if(n==="EDIT"){var r=this._tableModel.getData(t);i+=" bigEdit selected ";if(r.model){i+=" active "}}e.setAttribute("class",i)},_redrawCursor:function(){if(this._cursorDiv[0].style.display!=="none"){this._renderCursor(this._delegate.getCursorPosition(),false,false,true)}},_redrawGroupRows:function(){this._repositionGroupRows();for(var e=0;e<this._groupRows.length;e++){this._redrawGroupRow(this._groupRows[e],this._renderSettings.groupRowIndexes[e])}},_repositionGroupRows:function(){var e;var t=[];for(var i=0;i<this._groupRows.length;i++){var r=this._groupRows[i];var a=this._renderSettings.groupRowIndexes[i];var o=this._getRowTopPosition(a);t.push({groupRow:r,groupRowIndex:a,topPosition:o});if(o<this._renderSettings.top){if(e!=null){this._groupRows[e].DOMRow[0].style.display="none"}e=i}else if(o>this._renderSettings.bottom){this._groupRows[i].DOMRow[0].style.display="none"}else{this._groupRows[i].DOMRow[0].style.display="block"}var s=r.DOMRow[0].style.top;if(o+"px"!==s){r.DOMRow[0].style.top=o+"px"}var l=r.DOMRow[0].style.zIndex;if(l!=="0"||l!==""){r.DOMRow[0].style.zIndex=""}}this._currentStickyGroupRow=e||0;if(n.isNotReal(e)){return}this._groupRows[e].DOMRow[0].style.display="block";var u=this._renderSettings.top;if(e<this._groupRows.length-1){var c=t[e+1].topPosition;u=Math.min(this._renderSettings.top,c-this._getGroupRowHeight())}var d=t[e].groupRow.DOMRow[0];d.style.top=u+"px";var l=d.style.zIndex;if(!l||l==="0"){d.style.zIndex=2}},_redrawGroupRow:function(e,t){this._renderCell(e.firstChild,[t,0]," cellExpando",true);this._renderCheckboxCell(e.checkboxHolder,e.checkboxInput,[t,1]);for(var n=0;n<e.cells.length;n++){this._renderCell(e.cells[n],[t,n+2]," groupCell"+(n===0?" streak__nameGroupCell":""),true)}},_renderContentRow:function(e,i,r){var a,o,s=e.DOMRow,l=this._tableModel.getRowHash(i),u=e.cells;s[0].style.display="block";s[0].style.top=this._getRowTopPosition(i)+"px";if(this._renderSettings.groupRowIndexes.indexOf(i)>-1){s[0].style.display="none"}else if(e.hash===l&&!r){s[0].style.display="block";for(a=0;a<u.length;a++){if(!n.isReal(u[a])){continue}if(a>=this._renderSettings.visibleColumnRange.start&&a<=this._renderSettings.visibleColumnRange.end){u[a].style.display="block";this._updateCellClass(u[a],[i,a+2])}else{u[a].style.display="none"}}}else{this._renderCell(e.firstChild,[i,0]);this._renderCheckboxCell(e.checkboxHolder,e.checkboxInput,[i,1]);if(u.length>0){for(a=0;a<u.length;a++){if(!n.isReal(u[a])){continue}var c=[i,a+2];if(this._tableModel.getActionType(c)==="CHECKBOX"){this._renderContentCheckboxCell(u[a],c)}else{this._renderCell(u[a],[i,a+2])}if(a>=this._renderSettings.visibleColumnRange.start&&a<=this._renderSettings.visibleColumnRange.end){u[a].style.display="block"}else{u[a].style.display="none"}}}e.hash=l;e.rowIndex=i;var d=s.children();t(d[d.length-1]).addClass("last-child");s[0].setAttribute("rowIndex",i)}},_renderCheckboxCell:function(e,n,i){e.setAttribute("cellPosition",i[0]+","+i[1]);if(this._tableModel.getActionType(i)==="CHECKBOX"){n.style.display="inline-block";if(this._tableModel.isChecked(i)){t(n).addClass("T-Jo-Jp")}else{t(n).removeClass("T-Jo-Jp")}}else{n.style.display="none"}this._updateCellClass(e,i)},_renderContentCheckboxCell:function(e,t){if(!e){return}e.setAttribute("cellPosition",t[0]+","+t[1]);var n="cell contentCell";var i=e.innerHTML;var r=this._tableModel.getHTMLValue(t);if(i!==r){e.innerHTML=r}n+=" "+this._getExtraClassesForCell(t);e.setAttribute("class",n)},_renderCell:function(e,i,r,a){if(!e){return}e.setAttribute("cellPosition",i[0]+","+i[1]);var o=e.getAttribute("class").indexOf("bigEdit")>-1;var s=e;if(!s){s=e}this._updateCellClass(e,i,r,a);var l,u;var c=this._tableModel.getState(i);switch(c){case"DEFAULT":u=s.innerHTML;l=this._tableModel.getHTMLValue(i);if(u!==l){s.innerHTML=l}break;case"HIGHLIGHT":u=s.innerHTML;l=this._tableModel.getHTMLValue(i);if(u!==l){s.innerHTML=l}this._renderSettings.currentCell=e;break;case"EDIT":var h=t(e);if(o){return}var f=this._tableModel.getData(i);f.parent=h;f.cursor=this._cursorModel;this._currentInput=this._getInput(f.type);this._currentInput.setup(f);if(n.isUndefined(this._currentInput)){h.removeClass("active")}else{h.empty();h.append(this._currentInput.getElement());this._renderSettings.currentCell=e;this._renderSettings.currentInputBoundingBox.top=d.globals.contentRowHeight*(i[0]-1);this._renderSettings.currentInputBoundingBox.bottom=this._renderSettings.currentInputBoundingBox.top+d.globals.contentRowHeight;this._renderSettings.currentInputBoundingBox.left=this._renderSettings.columnStartingPosition[i[1]-2];this._renderSettings.currentInputBoundingBox.right=this._renderSettings.currentInputBoundingBox.left+this._renderSettings.widthMap[i[1]];if(a){e.style.minWidth=this._renderSettings.groupRowNameWidth+"px";this._renderSettings.currentInputBoundingBox.right=this._renderSettings.currentInputBoundingBox.left+this._renderSettings.groupRowNameWidth}this._currentInput.focus()}break}if(c==="EDIT"){return this._currentInput}if(a&&i[1]===2&&e.style.minWidth){e.style.minWidth=""}},_updateCellClass:function(e,t,n,i){if(!e){return}var r="cell";if(t[1]===0){r+=" first-child"}else if(t[1]===1){r+=" second-child checkbox"}else if(i){r+=" groupCell";if(this._tableModel.doesColumnHaveSummaryType(t[1])){r+=" streak__groupSummaryColumnValue"}}else{r+=" contentCell"}if(n){r+=" "+n}var a=e.getAttribute("class").indexOf("bigEdit")>-1;var o,s;var l=this._tableModel.getState(t);switch(l){case"DEFAULT":break;case"HIGHLIGHT":r+=" selected";break;case"EDIT":if(a){return}r+=" active bigEdit selected";break}r+=" "+this._getExtraClassesForCell(t);var u=e.getAttribute("class");if(u!==r){e.setAttribute("class",r)}},_getInput:function(e){if(!this._inputMap[e]){var t=this._createInput(e);this._inputMap[e]=t;this._createdInputs.push(t)}return this._inputMap[e]},_createInput:function(e){var t=d.globals.inputOptions;switch(e){case"TEXT":return c.Widgets.SpreadsheetTextbox.create(t);break;case"TEXT_INPUT":return c.Widgets.SpreadsheetTextarea.create(t);break;case"SIMPLE_DROPDOWN":return c.Widgets.SpreadsheetSmartDropdown.create(t);break;case"DATE":return new c.Widgets.SpreadsheetSmartTextCalendarViewController(t);break;case"PERSON":return c.Widgets.SpreadsheetPeoplePicker.create(t);break;case"ASSIGNED_TO":return c.Widgets.SpreadsheetAssignedTo.create(t);break;case"LINKED_BOXES":return new c.Widgets.SpreadsheetLinkedBoxesViewController(t);break;case"FORMULA":return new c.Widgets.SpreadsheetFormulaViewController(t);break;case"DROPDOWN":return new c.Widgets.SpreadsheetSmartTextDropdownViewController(t);break;case"TAG":return new c.Widgets.SpreadsheetSmartTagsViewController(t);break}},_getRowTopPosition:function(e){var t=0;for(var n=0;n<this._renderSettings.groupRowIndexes.length;n++){var i=this._renderSettings.groupRowIndexes[n];if(i<e){t++}else{break}}var r=e-t-1;return r*d.globals.contentRowHeight+t*this._getGroupRowHeight()},_getRowsForHash:function(e){var t=[];for(var n=0;n<this._renderSettings.contentRows.length;n++){if(this._renderSettings.contentRows[n].hash===e){t.push(this._renderSettings.contentRows[n])}}return t},_getExtraClassesForCell:function(e){var t=this._cursorModel.getClassesPrettyString(e);if(n.isDefined(t)&&t.length>0){return t}return""},_extractCellPosition:function(e){var t=e.getAttribute("cellPosition");var n;if(t&&t.length>0){var i=t.split(",");n=[parseInt(i[0],10),parseInt(i[1],10)]}return n},_saveCellChanges:function(){if(!this._currentInput){return}var e=this._currentInput;this._currentInput=null;if(e.preDetach){e.preDetach()}e.getElement().detach();e.updateValue();if(e.done){e.done()}},_getGroupRowHeight:function(){return d.globals.groupRowHeight},_closeMenus:function(){d.globals.columnMenu.close();d.globals.columnMenu.menu.el.detach();d.globals.groupSummaryMenu.close();this._delegate.setIsMenuOpen(false)},_removeGlobalEventListeners:function(){window.removeEventListener("copy",this._boundCopyCellFunction);if(this._renderSettings&&this._renderSettings.overflowBody){this._renderSettings.overflowBody.unbindBodyCloseAndStop()}},destroy:function(){this._saveCellChanges();this._removeOnscrollHandler();this._removeGlobalEventListeners();if(this._element){this._element.remove()}e.Object.prototype.destroy.call(this);d.globals.activeSpreadsheet=false;d.globals.columnMenu.setItemChosenCallback(null);d.globals.groupSummaryMenu.setItemChosenCallback(null)}});d.globals={};function h(){f();p();m();_();g();v();y()}function f(){d.globals.templates={};d.globals.templates.groupRow=o.get("spreadsheetGroup")();d.globals.templates.contentRow=o.get("spreadsheetRow")()}function p(){d.globals.trackingContext={widgetContext:"pipelineView/spreadsheet",eventName:"SpreadsheetCellEdit"};d.globals.inputOptions={trackingContext:d.globals.trackingContext}}function m(){d.globals.columnMenu=c.Widgets.ColumnMenu;d.globals.groupSummaryMenu=new c.Widgets.NewSpreadsheet.GroupSummaryMenuViewController}function _(){c.Keyboard.addChordHelpItem("<Ctrl>+b",c.Locale.getString("keyboard_create_new_box"));c.Keyboard.addChordHelpItem("<Ctrl>+d",c.Locale.getString("keyboard_delete_selected_boxes"))}function g(){t(window).resize(function(){if(d.globals.activeSpreadsheet&&d.globals.activeSpreadsheet.getElement()&&d.globals.activeSpreadsheet.getElement().isVisible()){d.globals.activeSpreadsheet.resize()}})}function v(){d.globals.numberMap={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"}}function y(){d.globals.columnPadding=5;d.globals.contentRowHeight=23;d.globals.paddingBottom=100;d.globals.viewportBuffer=4;d.globals.widthConstants={col1:36,col2:41,table:82};d.globals.groupRowHeight=35}e.DependencyManager.addFunction({functionKey:"newSpreadsheetInitialized",functionReference:h,dependentFunctionKeys:["columnMenuInitialized","keyboardInitialized","htmlLoaded","localeLoaded"]});i.set("BentoBox.Widgets.NewSpreadsheet",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.BentoBox,a=e.Gmail,o=r.Locale;var s,l;s=l={menu:null,linkedBoxPipelineMenu:null,columnData:null,pipeline:null,parentElement:null,filterValueChanged:false,itemChosenCallback:null,menuItems:{},trackingContext:{widgetContext:"pipelineView/spreadsheet",widget:"columnMenu"},init:function(e){s.setup();if(e){e()}},setColumnData:function(e,t,n){s.columnData=e;s.pipeline=t;s.parentElement=n;s.toggleItems()},setup:function(){var e=r.Widgets.Menu.create({css:{position:"fixed",overflow:"visible",minWidth:"200px"}});this._addSortOptions(e);e.addSeparator();this._addFilterOptions(e);this._addGroupByOption(e);this._addDateGroupByOption(e);e.addSeparator();this._addMoveOptions(e);e.addSeparator();this._addInsertColumnOptions(e);this._addSummaryOptions(e);this._addHideOption(e);this._addDeleteOption(e);this._addRemoveOption(e);e.el.on("click",function(e){e.stopPropagation();e.preventDefault()});s.menu=e},setItemChosenCallback:function(e){s.itemChosenCallback=e;s.summarySubmenu.setItemChosenCallback(e)},callItemChosenCallback:function(){if(s.itemChosenCallback){s.itemChosenCallback()}},_addSortOptions:function(e){var t=function(e,t){var n="ASC";if(!e){n="DESC"}if(t){s.columnData.changeSort(n);n+="_ON"}else{s.columnData.changeSort("NONE");n+="_OFF"}s.track("sortColumn",{type:n});s.callItemChosenCallback()};s.menuItems.sortTextASC=e.addCheckItem(o.getString("sort_asc"),function(e,n){t(true,e)});s.menuItems.sortTextDESC=e.addCheckItem(o.getString("sort_desc"),function(e,n){t(false,e)});s.menuItems.sortDateASC=e.addCheckItem(o.getString("sort_date_asc"),function(e,n){t(true,e)});s.menuItems.sortDateDESC=e.addCheckItem(o.getString("sort_date_desc"),function(e,n){t(false,e)});s.menuItems.sortNumberASC=e.addCheckItem(o.getString("sort_number_asc"),function(e,n){t(true,e)});s.menuItems.sortNumberDESC=e.addCheckItem(o.getString("sort_number_desc"),function(e,n){t(false,e)})},_addFilterOptions:function(e){s.menuItems.filterSection=t(document.createElement("div"));s.menuItems.filterSection.addClass("streak__filterInputSection J-N");s.menuItems.filterSection[0].innerHTML='<div class="streak__filterInputTitle"></div>';s.menuItems.filterInput=t('<input type="text" placeholder="'+r.Locale.getString("filter_text_placeholder")+'"></input>');s.menuItems.filterSection.append(s.menuItems.filterInput);s.menuItems.filterInput[0].oninput=function(){s.filterValueChanged=true};s.menuItems.filterInput.on("keydown",function(e){if(e.which===13){if(s.menuItems.filterInput.val().length>0){s.close()}else{s.columnData.clearFilter()}}});e.addSection(s.menuItems.filterSection);s.menuItems.filterAdvanced=e.addItem(r.Locale.getString("column_advanced_filters"),function(){s.columnData.setAdvancedFilter();s.callItemChosenCallback()})},_addGroupByOption:function(e){s.menuItems.groupBySeparator=e.addSeparator();s.menuItems.groupBy=e.addCheckItem(o.getString("column_group_by"),function(e,t){if(e){s.columnData.setGroupBy()}else{s.columnData.unGroupBy()}s.callItemChosenCallback()})},_addDateGroupByOption:function(e){var t=r.Widgets.Menu.create({css:{"overflow-y":"auto","overflow-x":"hidden"}});var n=function(e,t){if(t){s.columnData.setGroupBy(e)}else{s.columnData.unGroupBy()}s.callItemChosenCallback()};s.menuItems.dateGroupByDay=t.addCheckItem(r.Locale.getString("group_by_date_granularity_day"),function(e){n("DAY",e)});s.menuItems.dateGroupByWeek=t.addCheckItem(r.Locale.getString("group_by_date_granularity_week"),function(e){n("WEEK",e)});s.menuItems.dateGroupByMonth=t.addCheckItem(r.Locale.getString("group_by_date_granularity_month"),function(e){n("MONTH",e)});s.menuItems.dateGroupByQuarter=t.addCheckItem(r.Locale.getString("group_by_date_granularity_quarter"),function(e){n("QUARTER",e)});s.menuItems.dateGroupByYear=t.addCheckItem(r.Locale.getString("group_by_date_granularity_year"),function(e){n("YEAR",e)});s.menuItems.dateGroupBy=e.addSubMenu(o.getString("column_group_by"),t,{itemType:"checkItem",itemCallback:function(e){if(e){n("MONTH",e)}else{s.columnData.unGroupBy();s.callItemChosenCallback()}}})},_addMoveOptions:function(e){s.menuItems.moveLeft=e.addItem(o.getString("fields_move_left"),function(t){e.el.trigger("moveLeft");s.columnData.moveLeft();s.track("moveColumn",{type:"left"});s.callItemChosenCallback()});s.menuItems.moveRight=e.addItem(o.getString("fields_move_right"),function(t){e.el.trigger("moveRight");s.columnData.moveRight();s.track("moveColumn",{type:"right"});s.callItemChosenCallback()})},_addInsertColumnOptions:function(e){var t=r.Widgets.Menu.create({css:{overflow:"visible"}});this._addInsertCustomColumnOptions(t);t.addSeparator();this._addInsertSystemColumnOptions(t);t.addSeparator();this._addLinkedBoxesColumnOptions(t);e.addSubMenu(r.Locale.getString("fields_button_text"),t)},_addInsertCustomColumnOptions:function(e){var t=r.Models.BoxField.getCustomColumnTypes();n.each(t,function(t){e.addItem(t.name,function(){s.menu.el.hide();s.columnData.addCustomColumn(t.type);s.track("addColumn",{type:t.type});s.callItemChosenCallback()})})},_addInsertSystemColumnOptions:function(e){var t=r.Widgets.Menu.create({css:{"overflow-y":"auto","overflow-x":"hidden"}});var i=null;n.chain(r.Models.Pipeline.getExtraSystemProperties()).sortBy(function(e){return e.group+" "+e.title}).each(function(e){if(i!==e.group){if(i!==null){t.addSeparator()}i=e.group}t.addItem(e.title,function(){s.columnData.addSystemColumn(e);s.callItemChosenCallback()})});e.addSubMenu(r.Locale.getString("system_columns"),t)},_addLinkedBoxesColumnOptions:function(e){s._linkedBoxPipelineMenu=r.Widgets.Menu.create({css:{"overflow-y":"auto","overflow-x":"hidden"}});e.addSubMenu(r.Locale.getString("linked_boxes_columns"),s._linkedBoxPipelineMenu)},_setupLinkedBoxesColumnOptions:function(){s._linkedBoxPipelineMenu.empty();s._linkedBoxPipelineMenu.addItem(r.Locale.getString("all_linked_boxes"),function(){s.columnData.addSystemColumn(r.Models.Pipeline.getLinkedBoxSystemColumn());s.callItemChosenCallback()});var e=r.UI.getSortedPipelines();if(e.length>1){s._linkedBoxPipelineMenu.addSeparator()}n.each(e,function(e){s._linkedBoxPipelineMenu.addItem(r.Locale.getString("linked_boxes_title",{pipeline:e.displayName()}),function(){s.columnData.addSystemColumn(r.Models.Pipeline.getLinkedBoxSystemColumn(e));s.callItemChosenCallback()})})},_addSummaryOptions:function(e){s.summarySubmenu=new r.Widgets.NewSpreadsheet.GroupSummaryMenuViewController;s.summarySubmenuEntry=e.addSubMenu(r.Locale.getString("summarize_column"),s.summarySubmenu.getMenu())},_addHideOption:function(e){e.addItem(o.getString("hide"),function(e){s.columnData.hide();s.track("hideColumn");s.callItemChosenCallback()})},_addDeleteOption:function(e){s.menuItems.deleteItem=e.addItem(o.getString("delete"),function(e){s.track("DeleteColumnAttempt");r.Widgets.Modal.confirmDelete(s.columnData.getName(),function(){var e=s.columnData.fieldKey;if(!e){s.columnData.remove();return}var n=r.UI.getFieldValues(s.pipeline,e);if(n.length===0){s.columnData.remove();s.track("DeleteColumn");return}var i=r.Locale.getString("confirm_2_text");var a=r.Widgets.Modal.create({title:r.Locale.getString("confirm_delete_title",{item:s.columnData.getName()}),confirmFunc:function(){t.modal.close();s.columnData.remove();s.track("DeleteColumn");s.callItemChosenCallback()},confirmText:r.Locale.getString("delete"),inner:'<div class="superConfirm">'+i+"</div>",doneButtonColor:"red"});a.show(true);return true},null,function(){s.track("DeleteColumnCancelled")})})},_addRemoveOption:function(e){s.menuItems.removeItem=e.addItem(o.getString("remove"),function(e){s.track("removeSystemColumn");s.columnData.remove();s.callItemChosenCallback()})},close:function(){if(s.filterValueChanged){s.filterValueChanged=false;s.columnData.setContainsFilter(s.menuItems.filterInput.val());s.callItemChosenCallback()}},toggleItems:function(){s.menu.reset();s.menu.el.show();s.filterValueChanged=false;var e=true;if(n.isReal(s.columnData.property)){e=r.Models.Pipeline.isPropertyFilterable(s.columnData.property)}if(e){s.menuItems.filterSection.show();s.menuItems.filterAdvanced.show();if(s.columnData.canFilterByContains()){s.menuItems.filterInput.val("");s.menuItems.filterInput.prop("disabled",false);if(s.columnData.isAdvancedFiltered()){s.menuItems.filterInput.val("part of advanced filter");s.menuItems.filterInput.prop("disabled",true)}else if(s.columnData.getContainsFilter()){s.menuItems.filterInput.val(s.columnData.getContainsFilter())}}else{s.menuItems.filterSection.hide()}}else{s.menuItems.filterSection.hide();s.menuItems.filterAdvanced.hide()}s.menuItems.groupBySeparator.show();if(s.columnData.isDateColumn()){s.menuItems.groupBy.hide();s.menuItems.dateGroupBy.show();s.menuItems.dateGroupBy.find("> div > .text").text(r.Locale.getString("column_group_by",{column:s.columnData.getName()}));s.menuItems.dateGroupBy.setCheckboxState(s.columnData.isGroupedBy());s.menuItems.dateGroupByDay.setCheckboxState(false);s.menuItems.dateGroupByWeek.setCheckboxState(false);s.menuItems.dateGroupByMonth.setCheckboxState(false);s.menuItems.dateGroupByQuarter.setCheckboxState(false);s.menuItems.dateGroupByYear.setCheckboxState(false);if(s.columnData.isGroupedBy()){switch(s.columnData.getGranularity()){case"DAY":s.menuItems.dateGroupByDay.setCheckboxState(true);break;case"WEEK":s.menuItems.dateGroupByWeek.setCheckboxState(true);break;case"MONTH":s.menuItems.dateGroupByMonth.setCheckboxState(true);break;case"QUARTER":s.menuItems.dateGroupByQuarter.setCheckboxState(true);break;case"YEAR":s.menuItems.dateGroupByYear.setCheckboxState(true);break}}}else{s.menuItems.dateGroupBy.hide();s.menuItems.groupBy.show();s.menuItems.groupBy.find(".text").text(r.Locale.getString("column_group_by",{column:s.columnData.getName()}));if(n.isReal(s.columnData.property)){if(r.Models.Pipeline.isPropertyGroupable(s.columnData.property)){s.menuItems.groupBy.setCheckboxState(s.columnData.isGroupedBy())}else{s.menuItems.groupBySeparator.hide();s.menuItems.groupBy.hide()}}else{s.menuItems.groupBy.setCheckboxState(s.columnData.isGroupedBy())}}var t;if(s.columnData.property){t=r.Models.Pipeline.getPropertySortType(s.columnData.property)}else if(s.columnData.fieldKey){t=s.pipeline.getField(s.columnData.fieldKey).get("type")}s.menuItems.sortTextASC.hide();
s.menuItems.sortTextDESC.hide();s.menuItems.sortDateASC.hide();s.menuItems.sortDateDESC.hide();s.menuItems.sortNumberASC.hide();s.menuItems.sortNumberDESC.hide();var i,a;switch(t){case"NUMBER":i=s.menuItems.sortNumberASC;a=s.menuItems.sortNumberDESC;break;case"DATE":i=s.menuItems.sortDateASC;a=s.menuItems.sortDateDESC;break;default:i=s.menuItems.sortTextASC;a=s.menuItems.sortTextDESC}i.show();a.show();i.setCheckboxState(s.columnData.sort==="ASC");a.setCheckboxState(s.columnData.sort==="DESC");s.columnData.isFirst?s.menuItems.moveLeft.hide():s.menuItems.moveLeft.show();s.columnData.isLast?s.menuItems.moveRight.hide():s.menuItems.moveRight.show();s._setupLinkedBoxesColumnOptions();if(s.columnData.isSummarizable){s.summarySubmenu.setup(s.columnData);s.summarySubmenuEntry.show()}else{s.summarySubmenuEntry.hide()}if(s.columnData.isRemovable){s.menuItems.removeItem.show()}else{s.menuItems.removeItem.hide()}if(s.columnData.isDeletable){s.menuItems.deleteItem.show()}else{s.menuItems.deleteItem.hide()}s.menu.setIsLast(s.columnData.isLast);s.menu.el.css({left:s.parentElement.offset().left-s.menu.el.outerWidth()+s.parentElement.outerWidth(),top:s.parentElement.offset().top+s.parentElement.outerHeight()});s.menu.el.containByScreen(s.parentElement,{isRightAligned:true})},track:function(e,t){r.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}};e.DependencyManager.addFunction({functionKey:"columnMenuInitialized",functionToCall:l.init,functionContext:l,dependentFunctionKeys:["menuInitialized","enabledFeaturesControllerInitialized"]});r.Widgets.ColumnMenu=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox,r=e.Gmail,a=i.ColumnSummary,o=e.Locale;var s=e.UI.ViewController;var l=e.Class.subclass({className:"GroupSummaryMenuViewController",superclass:s,memberVariables:[{name:"_menu",destroy:true},{name:"_itemChosenCallback",destroy:false,set:true},{name:"_column",destroy:false},{name:"_cell",destroy:false}],_initialize:function(){s.prototype._initialize.call(this);this._menu=i.Widgets.Menu.create({css:{position:"fixed",overflow:"visible",minWidth:"200px"}})},_setupView:function(){},getMenu:function(){return this._menu},getElement:function(){return this._menu.getElement()},close:function(){this._menu.getElement().detach();if(this._cell){this._cell.removeClass("menuOpen")}this._column=null;this._cell=null},setup:function(e,t){this._column=e;this._cell=t;if(this._cell){this._cell.addClass("menuOpen")}this._configureMenu()},_configureMenu:function(){var e=this,t=this._column;this._menu.empty();if(!t.summaryFunctions||t.summaryFunctions.length===0){this._menu.addItem("Error: no summary functions for column");i.logError("No summary functions for column");return}["none","|"].concat(t.summaryFunctions).forEach(function(n){if(n==="|"){e._menu.addSeparator();return}var r=n=="none"?null:n;var o=a.getLocalizedName(n).escapeHTML();var s=e._menu.addCheckItem(o,function(){if(r!==null&&!i.isFeatureEnabled("formulaFields")&&i.Services.PipelineSummaryLimiter.isLocked()){i.Services.PipelineSummaryLimiter.showGateway();return}t.setSummaryFunction(r);i.Services.PipelineSummaryLimiter.incrementUsage();if(e._itemChosenCallback){e._itemChosenCallback()}});s.setCheckboxState(r==t.chosenSummaryFunction)});if(this._cell){var n=this._menu.getElement();var r=n.parent();n.css({left:r.offset().left-n.outerWidth()+r.outerWidth(),top:r.offset().top+r.outerHeight()});n.containByScreen(r)}}});i.Widgets.NewSpreadsheet.GroupSummaryMenuViewController=l})(Streak);(function(e){var t=e.jQuery,n=e.BentoBox;t.fn.spreadsheetArrow=function(e){e=e||[];return this.each(function(){var i=this;var r=t(this);var a=false;i.setArrowMode=function(e){a=e};n.Keyboard.bindChordToElement(r,"tab",function(e){r.trigger("onblur");r.trigger("tabPressed")},true,true);n.Keyboard.bindChordToElement(r,"shift+tab",function(e){r.trigger("onblur");r.trigger("shiftTabPressed")},true,true);n.Keyboard.bindChordToElement(r,"up",function(t){if(a&&e.indexOf("up")===-1){r.trigger("upPressed");r.trigger("onblur")}});n.Keyboard.bindChordToElement(r,"down",function(t){if(a&&e.indexOf("down")===-1){r.trigger("downPressed");r.trigger("onblur")}});n.Keyboard.bindChordToElement(r,"right",function(t){var n=r.val();if(r.is("div")){n=r[0].innerHTML}if(r.caret().start===n.length){t.preventDefault();t.stopPropagation()}if(a&&e.indexOf("right")===-1){if(r.caret().start===n.length){r.trigger("rightPressed");r.trigger("onblur")}}});n.Keyboard.bindChordToElement(r,"left",function(t){if(r.caret().start===0){t.preventDefault();t.stopPropagation()}if(a&&e.indexOf("left")===-1){if(r.caret().start===0){r.trigger("leftPressed");r.trigger("onblur")}}})})}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.jwerty,s=e.BentoBox;var l={templates:{},create:function(){return new this.impl}};l.impl=function(){return s.Widgets.PeoplePicker.create({jsonified:false,delayedBind:true,onlyValidEmailAddress:true,neverShowRead:true,isRightAligned:false})};s.Widgets.SpreadsheetAssignedTo=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.jwerty,s=e.BentoBox;var l={templates:{},create:function(e){return new this.impl(e)}};l.impl=function(e){e.neverShowRead=true;e.isRightAligned=false;return s.Widgets.PeoplePicker.create(e)};s.Widgets.SpreadsheetPeoplePicker=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Date,a=e.Gmail,o=e.HTML,s=e.BentoBox;var l={templates:{},create:function(e){return new this.impl(e)}};l.impl=function(r){var o=null,l=null,c=null,d=null,h=false,f=null,p=null,m=s.Widgets.Menu.create({maxHeight:"250px"}),_=null,g=null,v=null,y=null,w=t.noop,b=r;m.el.on("click.smartDropdown",function(e){d.select();e.preventDefault();e.stopPropagation()});var C=function(){if(o){o.remove()}o=t(document.createElement("div"));l=t(document.createElement("div"));c=t(document.createElement("input"));o[0].setAttribute("class","dropdownWrapper");l[0].setAttribute("class","dropdown smartInput");l[0].setAttribute("tabindex","-1");m.getElement().addClass("streak__spreadsheetDropdownMenu");B()},S=function(){if(v){return _.get(v)}},T=function(t){if(t!=p){if(v){var n=[];for(var i=0;i<g.length;i++){var r=t.value?t.value:t;g[i].set(v,r)}var a=e.Model.saveAll(g,null,true);u(a);s.Tracker.trackStreakActive(b.trackingContext,{property:v,widget:"SpreadsheetSmartDropdown",numberOfBoxes:g.length})}}},x=function(){var e=y.findIndex(function(e){return(e.value?e.value:e)===S()});p=y[e];o.text(p.text?p.text:p);o.append(l);E(e)},k=function(){h=false;c.val("");x();saveValue=p;l.focus()},M=function(e){c.val(e);D();h=true},L=function(e){C();_=e.model;g=e.models;v=e.property;y=e.list;w=e.updateCallback},B=function(){o.off("bbCursorDeselect");o.on("bbCursorDeselect",function(e){e.preventDefault();e.stopPropagation()});o.off(".smartDropdown");o.on("click.smartDropdown",function(e){l.trigger("escapePressed")});s.Keyboard.bindChordToElement(l,"[a-z]/shift+[a-z]/backspace",function(e){clearTimeout(f);if(i.is("backspace",e)){c.val(c.val().first(c.val().length-1))}else{c.val(c.val()+String.fromCharCode(e.which))}D();f=setTimeout(function(){c.val("")},1e3)},true,true);s.Keyboard.bindChordToElement(l,"up/down/home/end",function(e){c.val("")},true,true);s.Keyboard.bindChordToElement(l,"right",function(e){if(h){l.trigger("rightPressed");d.select()}});s.Keyboard.bindChordToElement(l,"left",function(e){if(h){l.trigger("leftPressed");d.select()}});s.Keyboard.bindChordToElement(l,"escape",function(e){l.trigger("escapePressed")},true,true,true);s.Keyboard.bindChordToElement(l,"tab",function(e){l.trigger("tabPressed")},true,true,true);s.Keyboard.bindChordToElement(l,"shift+tab",function(e){l.trigger("shiftTabPressed")},true,true,true);d=s.Cursor.create({selectedClass:"J-N-JT",selectFunc:function(e,t){T(e.data("itemValue"));l.trigger("escapePressed")},highlightOnHover:true,rollOver:true,input:l,noScroll:true})},E=function(e){m.empty();n.each(y,function(e){var t=e.text?e.text:e;var i=m.addItem(n.escape(t),function(){});i.data("itemValue",e)});d.setup(m.el.find(".menuItem"));d.setPosition([e]);var t=o;a.elements.body.append(m.getElement());m.getElement()[0].style.position="fixed";m.el.containByScreen(o)},D=function(){var e=c.val().toLowerCase();t.each(y,function(t,n){var i=n.text?n.text:n;if(i.toLowerCase().startsWith(e)){d.setPosition([t]);return}})};return{el:o,getElement:function(){return o},focus:k,set:M,setup:L,updateValue:function(){m.getElement().detach()},destroy:function(){if(o){o.remove()}}}};function u(e){s.ButterBarManager.showProgress({initial:"saving",progressSuccess:"stage_change_boxes_status_update",progressError:function(e,t){t.box=n.escape(e.operation.getModel().displayName());return s.Locale.getString("stage_change_boxes_error_update",t)},completeSuccess:undefined,completeError:"stage_change_boxes_error",operationProgressId:e})}s.Widgets.SpreadsheetSmartDropdown=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={templates:{},create:function(e){return new this.impl(e)}};s.impl=function(e){var n=null,i=null,r=null,a=null,s=false,l=null,u=null,c=[],d=e;var h=function(){if(n){n.remove()}n=t(document.createElement("div"));n[0].innerHTML='<div contentEditable="true" class="edit"></div>';n[0].setAttribute("class","smartInput spreadsheetTextarea");n[0].setAttribute("tabindex","-1");i=n.find(".edit");b()},f=function(){return l.get(u)||""},p=function(){var e=f();if(e!==a){r=a;l.set(u,a);l.save();o.Tracker.trackStreakActive(d.trackingContext,{property:u,widget:"spreadsheetTextarea"})}},m=function(){if(i.is(":focus")){return}i.setPlainText(f());i[0].setAutoCompleteList(c);i.focus();g()},_=function(){r=f();a=r;m();i[0].setArrowMode(false)},g=function(){setTimeout(function(){i.caret().goToEnd()},1)},v=function(e){r=f();_();i.setPlainText(e);i[0].setArrowMode(true);i.trigger("input")},y=function(e){h();l=e.model;u=e.property;c=e.existingList},w=function(){i.trigger("preDetach")},b=function(){i.bind("escapePressed",function(e){a=f();i.setPlainText(a)});i.bind("enterPressed",function(e){a=i.plainText()});o.Keyboard.bindChordToElement(i,"meta+enter/ctrl+enter",function(e){e.stopPropagation()},true,false,false,"keypress");i.delayedSave({saveFunction:function(){a=i.plainText()},delay:1});i.on("autoCompleteSet",function(e){a=i.plainText()});i.autoComplete("plainText");i.spreadsheetArrow()};return{el:n,getElement:function(){return n},focus:_,set:v,setup:y,updateValue:p,preDetach:w,destroy:function(){if(n){n.remove()}}}};o.Widgets.SpreadsheetTextarea=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.BentoBox;var o=function(e){this.el=t(document.createElement("input"));this.property=null;this.model=null;this.td=null;this.currentValue=null;this.options=e;this.arrowMode=false;this.validator=null;this.callOnEmptyFunction=null;this.setupElement();this.setupBindings()};o.create=function(e){return new o(e)};n.extend(o.prototype,{setupElement:function(){this.el[0].setAttribute("type","text");this.el[0].setAttribute("class","smartInput textboxNoborder");this.el[0].setAttribute("tabindex","-1")},setupBindings:function(){var e=this;a.Keyboard.bindChordToElement(e.el,"escape",function(t){e.el.val(e.currentValue);e.el.trigger("escapePressed")},true,true,true,"keydown",true);a.Keyboard.bindChordToElement(e.el,"enter",function(t){e.el.trigger("enterPressed")},true,true,true,"keydown",true);a.Keyboard.bindChordToElement(e.el,"up",function(t){if(e.arrowMode){e.el.trigger("upPressed")}});a.Keyboard.bindChordToElement(e.el,"down",function(t){if(e.arrowMode){e.el.trigger("downPressed")}});a.Keyboard.bindChordToElement(e.el,"right",function(t){if(e.el.caret().start===e.el.val().length){t.preventDefault();t.stopPropagation()}if(e.arrowMode){if(e.el.caret().start===e.el.val().length){e.el.trigger("rightPressed")}}});a.Keyboard.bindChordToElement(e.el,"left",function(t){if(e.el.caret().start===0){t.preventDefault();t.stopPropagation()}if(e.arrowMode){if(e.el.caret().start===0){e.el.trigger("leftPressed")}}})},setup:function(e){this.options=e;this.model=e.model;this.property=e.property;this.validator=e.validator;this.callOnEmptyFunction=e.callOnEmptyFunction;this.el.val(this.getValue())},getValue:function(){return this.model.get(this.property)},updateValue:function(){var e=this.el.val().trim();try{if(!e&&!this.currentValue){if(this.callOnEmptyFunction){this.callOnEmptyFunction()}return}}catch(t){return}if(!e){return}if(e===this.currentValue){return}this.currentValue=e;this.model.set(this.property,e.trim());this.model.save();this.track()},focus:function(){this.currentValue=this.getValue();this.el.show();this.el.focus();this.el.caret().goToEnd();this.arrowMode=false},set:function(e){this.el.val(e);this.focus();this.arrowMode=true},getElement:function(){return this.el},track:function(){a.Tracker.trackStreakActive({property:this.property,widget:"spreadsheetTextbox"})},destroy:function(){this.el.remove()}});a.Widgets.SpreadsheetTextbox=o})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e._,a=e.BentoBox;var o=function(e,t){a.Tracker.trackStreakActive(t,{eventName:e})};a.Widgets.FollowerButton={templates:{},defaults:{width:"50px",box:null,hideUnfollow:false,followEventCallback:t.noop,unfollowEventCallback:t.noop,displayValue:"block"},create:function(e){this._init();var t={};r.extend(t,this.defaults,e);return new a.Widgets.FollowerButton.impl(t)},_init:function(e){if(!this.templates.mainView){this.templates.mainView=i.get("followerButton")}}};a.Widgets.FollowerButton.impl=function(n){var i={};var s=n.box;var l=t(a.Widgets.FollowerButton.templates.mainView());n.trackingContext.widgetContext+="/followerButton";var u=a.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:a.Locale.getString("follow_box"),color:"green",onFunction:function(){o("followBox",n.trackingContext);var e=a.getUser().get("userKey");var t=s.get("followerKeys");if(!r.isArray(t)){t=[]}if(t.indexOf(e)<0){t.push(e);s.set("followerKeys",t);s.save();n.followEventCallback()}d()}});var c=a.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:a.Locale.getString("unfollow_box"),color:"default",onFunction:function(){o("unfollowBox",n.trackingContext);var e=a.getUser().get("userKey");var t=s.get("followerKeys");if(t.indexOf(e)>-1){t.removeVal(e);s.set("followerKeys",t);s.save();n.unfollowEventCallback()}d()}});if(!a.Services.AccessManager.isAccessAllowed(n.box.getPipeline(),"Box","UPDATE")){u.disable();c.disable()}var d=function(){if(h()){u.getElement().hide();if(!n.hideUnfollow){c.getElement().fastShow(n.displayValue)}}else{c.getElement().hide();u.getElement().fastShow(n.displayValue)}};var h=function(){return s.get("followerKeys").indexOf(a.getUser().get("userKey"))>-1};u.getElement().hide();c.getElement().hide();d();s.watch("set",d,i,"followerKeys");u.getElement().addClass("followerButton");c.getElement().addClass("followerButton");l.append(u.getElement());l.append(c.getElement());i.el=l;i.getActiveButton=function(){if(h()){return c.getElement()}else{return u.getElement()}};i.destroy=function(){e.NotificationCenter.unsubscribe({observer:i});u.destroy();c.destroy();l.remove()};i.getElement=function(){return i.el};return i}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"NewFollowerListViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_box",destroy:false},{name:"_followerButton",destroy:true},{name:"_newPeopleListViewController",destroy:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._view.addClass("streak__newFollowerList");this._box=t;this._setupFollowerButton();this._setNewPeopleListViewController();this._bindToBox();this._render()},_setupFollowerButton:function(){this._followerButton=c.Widgets.FollowerButton.create({box:this._box,displayValue:"inline-block",trackingContext:{widgetContext:"newFollowerListViewController"}});this._view.addSubView(this._followerButton)},_setNewPeopleListViewController:function(){this._newPeopleListViewController=new c.Widgets.NewPeopleListViewController(2);this._view.addSubView(this._newPeopleListViewController.getView())},_bindToBox:function(){this._box.watch("set",this._render.bind(this),this,"followerKeys")},_render:function(){if(this._box.get("followerKeys").length===0){this._newPeopleListViewController.renderList([]);return}var e=this;c.Contacts.getContactsFromUserKeys(this._box.get("followerKeys"),function(t){if(!e._newPeopleListViewController){return}e._newPeopleListViewController.renderList(t)})},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.UI.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.NewFollowerListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PostCommentViewController",superclass:e.Object,_memberVariables:[{name:"_box",destroy:false},{name:"_element",destroy:true,get:true},{name:"_commentTextarea",destroy:true},{name:"_postButton",destroy:true},{name:"_feedListViewController",destroy:false}],_initialize:function(t,n){e.Object.prototype._initialize.call(this);this._box=t;this._feedListViewController=n;this._setupElement();this._setupPostButton();this._setupEnabler();if(!c.Services.AccessManager.isAccessAllowed(t.getPipeline(),"Comment","CREATE")){this._postButton.disable();this._commentTextarea.addClass("streak__disabled")}},_setupElement:function(){this._element=o.getElement("postComment");this._commentTextarea=this._element.find(".postCommentField");var e=c.getUser();if(e){var n=e.get("googleProfilePhotoUrl");if(n){this._element.find(".comment_userface").html(t("<img/>").attr("src",n))}}},_setupPostButton:function(){this._postButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:c.Locale.getString("post_comment"),color:"green",onFunction:this._postComment.bind(this)});this._postButton.addClass("postCommentButton");this._commentTextarea.easyTab({next:this._postButton.getElement()});this._postButton.getElement().easyTab({prev:this._commentTextarea});this._element.find(".buttonWidget").append(this._postButton.getElement())},_setupEnabler:function(){this._setEnabled(this._box.getPipeline().getCollaborationStatus()!="LOCKDOWN")},_setEnabled:function(e){if(e){this._element.removeClass("disabled");this._commentTextarea.attr("contenteditable",true);this._postButton.enable()}else{this._element.addClass("disabled");this._commentTextarea.removeAttr("contenteditable");this._postButton.disable()}},_postComment:function(){var e=this._commentTextarea.plainText();if(!e){return}this._postButton.disable();this._addSaveCommentOperation(e);c.Tracker.track("post comment")},_addSaveCommentOperation:function(t){var n=new c.Widgets.SaveCommentOperation({boxKey:this._box.key(),commentText:t});var i=e.Operations.OperationQueue.Singleton.addOperation(n);c.ButterBarManager.showSaving({operationProgressId:i});l.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationIsComplete:true,operationProgressId:i},observer:this,unsubscribeImmediately:true,functionToCall:this._handleSaveCommentOperationFinished})},_handleSaveCommentOperationFinished:function(e){this._postButton.enable();if(e.operationHasErrors){c.ButterBarManager.showError(c.Locale.getString("error_comment"),{time:5e3})}else{this._commentTextarea.text("");this._feedListViewController.newCommentPosted()}}});i.set("BentoBox.Widgets.PostCommentViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SaveCommentOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_boxKey",destroy:false},{name:"_commentText",destroy:false}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);this._boxKey=t.boxKey;this._commentText=t.commentText;this._tags=this._getTags();this._dependentOnTags=this._tags;this._limiterTagsAndTypes=this._getLimiterTagsAndTypes()},_getTags:function(){return["box_newComment_boxKey_"+this._boxKey]},_getLimiterTagsAndTypes:function(){return c.Data.getBox(this._boxKey).getRequestLimiterTagsAndTypes("UPDATE")},getMethod:function(){return"PUT"},getParams:function(){return{url:"boxes/"+this._boxKey+"/comments",message:this._commentText}}});i.set("BentoBox.Widgets.SaveCommentOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=s.View;var h=e.Class.subclass({className:"ReminderEditView",superclass:d,_memberVariables:[{name:"_createButtonElement",destroy:true},{name:"_editButtonElement",destroy:true},{name:"_deleteButtonElement",destroy:true},{name:"_createButton",destroy:false},{name:"_editButton",destroy:false},{name:"_input",destroy:true},{name:"_date",destroy:true},{name:"_formValid",destroy:false,defaultValue:false}],_initialize:function(){d.prototype._initialize.call(this);this._createButtonElement=this._element.find(".streak__reminderViewMenu_createButton");this._editButtonElement=this._element.find(".streak__reminderViewMenu_editButton");this._deleteButtonElement=this._element.find(".streak__reminderViewMenu_deleteButton");this._setupInputBox();this._setupSuggestedTimeLinks();this._setupCheckbox();this._setupMessage();this._setupTabOrder()},setMessage:function(e){this._element.find(".notesEnter").val(e)},setIncludeFollowers:function(e){this._element.find(".includeFollowers")[0].checked=e},setCreateButton:function(e){this._createButton=e;this._createButtonElement.html(e.getElement());this._setupTabOrder()},setDeleteButton:function(e){this._deleteButtonElement.html(e.getElement());this._setupTabOrder()},setEditButton:function(e){this._editButton=e;this._editButtonElement.html(e.getElement());this._setupTabOrder()},showEditButton:function(e){this._editButtonElement.toggle(e)},showCreateButton:function(e){this._createButtonElement.toggle(e)},showDeleteButton:function(e){this._deleteButtonElement.toggle(e)},focus:function(){this._input.focus()},setDate:function(e){this._date=e;var t=!!e;this._enableSaveButtonElements(t);this._input.toggleClass("valid",t);this._callDelegateFunction("dateChanged",e)},setKnownValidDate:function(e){this._input.val(e.customFormat("longDateTime"));this._element.find(".scheduledDate").text(e.customFormat("shortWithWeekday"));this._input.addClass("valid")},getDateText:function(){return this._input.val().trim()},setSendLaterText:function(e){this._element.find(".scheduledDate").text(e)},_setupInputBox:function(){var t=this;this._input=this._element.find(".dateInput");this._input.keyup(function(n){if(e.jwerty.is("escape",n)){t._callDelegateFunction("escapePressed");return}if(e.jwerty.is("enter",n)){t._callDelegateFunction("enterPressed");return}t._callDelegateFunction("dateTextChanged")})},_messageChanged:function(){var e=this._element.find(".notesEnter").val();this._callDelegateFunction("messageChanged",e)},_remindFollowersChanged:function(){var e=this._element.find(".includeFollowers")[0].checked===true;this._callDelegateFunction("remindFollowersChanged",e)},_setupElement:function(){this._element=o.getElement("reminderListMenu")},_setupTabOrder:function(){t.tabChain(n.compact([this._input,this._element.find(".notesEnter"),this._element.find(".includeFollowers"),this._createButtonElement,this._editButtonElement]))},_setupSuggestedTimeLinks:function(){var e=this;this._element.find("a.streak__suggestedTime").click(function(n){n.preventDefault();e._suggestedTimeLinkClicked(t(this).attr("title"))})},_suggestedTimeLinkClicked:function(e){var t=a.ccreate(e);this._input.val(t.customFormat("longDateTime"));this._callDelegateFunction("dateTextChanged");c.Tracker.track("suggestedTimeClick",{text:e})},_setupCheckbox:function(){this._element.find(".includeFollowers").on("change",this._remindFollowersChanged.bind(this));var t="remindFollowers"+e.guid();this._element.find(".includeFollowers").prop("id",t);this._element.find(".checkbox label").prop("for",t)},_setupMessage:function(){this._element.find(".notesEnter").on("change",this._messageChanged.bind(this))},_enableSaveButtonElements:function(e){this._createButton.toggleDisabled(!e);this._editButton.toggleDisabled(!e)}});i.set("BentoBox.Widgets.ReminderEditView",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=s.ViewController;var h=e.Class.subclass({className:"ReminderEditViewController",superclass:d,_memberVariables:[{name:"_reminder",destroy:false},{name:"_isCreate",destroy:false},{name:"_options",destroy:false}],_initialize:function(e){if(e.reminder===undefined)throw new Error("'reminder' is a required parameter to ReminderEditViewController");this._reminder=e.reminder;if(e.isCreate===undefined)throw new Error("'isCreate' is a required parameter to ReminderEditViewController");this._isCreate=e.isCreate;this._options=n.defaults(e,{showDelete:false,showCreate:this._isCreate,showEdit:!this._isCreate});d.prototype._initialize.call(this);this._view.setDelegate(this);this._setupCreateButton();this._setupDeleteButton();this._setupEditButton();this._initializeViewWithReminder()},enterPressed:function(){if(!this._isReminderValid()){return}if(this._isCreate){c.Tracker.track("contents.reminder.create");c.Tracker.track("contents.reminder.create.enter");this._callDelegateFunction("create")}else{c.Tracker.track("contents.reminder.edit");c.Tracker.track("contents.reminder.edit.enter");this._callDelegateFunction("edit")}},escapePressed:function(){c.Tracker.track("contents.reminder.escape");this._closeModal()},dateChanged:function(e){this._reminder.set("remindDate",e&&e.getTime())},messageChanged:function(e){this._reminder.set("message",e)},remindFollowersChanged:function(e){this._reminder.set("remindFollowers",e)},dateTextChanged:function(){var e=this._view.getDateText();if(e===""){this._view.setSendLaterText(c.Locale.getString("send_later_enter_date"));this._view.setDate(null);return}var t=this._parseDate(e);if(t===null||!t.isValid()){this._view.setSendLaterText(c.Locale.getString("send_later_invalid_date"));this._view.setDate(null);return}var n=new a;if(t.isBefore(n)){this._view.setSendLaterText(c.Locale.getString("send_later_future_date"));this._view.setDate(null)}else{this._view.setSendLaterText(t.customFormat("shortWithWeekday"));this._view.setDate(t)}},_parseDate:function(e){if(!e)return null;var t=a.ccreate(e);if(t&&t.isValid())return t;return null},_isReminderValid:function(){return this._reminder.get("remindDate")},_assertReminderValid:function(){var e=this._isReminderValid();if(!e)c.logError("enter pressed but reminder date was invalid",{date:this._reminder.get("remindDate")});return e},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.ReminderEditView")},_setupEditButton:function(){var e=this;var t=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:c.Locale.getString("reminder_save"),onFunction:function(){if(!e._assertReminderValid()){return}c.Tracker.track("contents.reminder.edit");c.Tracker.track("contents.reminder.edit.button");e._callDelegateFunction("edit")}});this._view.setEditButton(t);this._view.showEditButton(this._options.showEdit)},_setupCreateButton:function(){var e=this;var t=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:c.Locale.getString("create"),onFunction:function(){if(!e._assertReminderValid()){return}c.Tracker.track("contents.reminder.create");c.Tracker.track("contents.reminder.create.button");e._callDelegateFunction("create")}});t.disable();this._view.setCreateButton(t);this._view.showCreateButton(this._options.showCreate)},_setupDeleteButton:function(){var e=this;var t=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:c.Locale.getString("reminder_cancel"),onFunction:function(){c.Tracker.track("contents.reminder.delete");c.Tracker.track("contents.reminder.delete.button");e._callDelegateFunction("delete")}});this._view.setDeleteButton(t);this._view.showDeleteButton(this._options.showDelete)},_initializeViewWithReminder:function(){if(this._reminder.get("remindDate")){var e=a.ccreate(this._reminder.get("remindDate"));this._view.setKnownValidDate(e)}this._view.setMessage(this._reminder.get("message"));this._view.setIncludeFollowers(this._reminder.get("remindFollowers"))}});i.set("BentoBox.Widgets.ReminderEditViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=s.Delegator;var h=e.Class.subclass({className:"ReminderMenuViewController",superclass:d,_memberVariables:[{name:"_boxKey",destroy:true},{name:"_reminder",destroy:false},{name:"_reminderPatch",destroy:true},{name:"_viewController",destroy:true}],_initialize:function(e){e=e||{};d.prototype._initialize.call(this);this._reminder=e.reminder;this._boxKey=e.boxKey},getViewControllerForMenu:function(){this._setupReminderEditViewController();return this},closeModal:function(){this._callDelegateFunction("close",this);this._nullifyMemberVariable("_viewController",true)},edit:function(){this._reminderPatch.commit();this._nullifyMemberVariable("_reminderPatch",true);this._reminder.save();this.closeModal()},create:function(){this._reminder.save();c.Data.getReminderCollection(this._boxKey).add(this._reminder);this.closeModal()},"delete":function(){this._reminder.del();this.closeModal()},getView:function(){return this._viewController.getView()},onShow:function(){this.getView().focus()},_setupReminderEditViewController:function(){var e=!!this._reminder;if(e){this._reminderPatch=this._reminder.createPatch();this._viewController=i.getInstance("BentoBox.Widgets.ReminderEditViewController",{reminder:this._reminderPatch,isCreate:false,showDelete:false})}else{this._reminder=c.Models.Reminder.create({boxKey:this._boxKey,message:"",remindFollowers:false});this._viewController=i.getInstance("BentoBox.Widgets.ReminderEditViewController",{reminder:this._reminder,isCreate:true,showDelete:false})}this._viewController.setDelegate(this)}});i.set("BentoBox.Widgets.ReminderMenuViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Date,a=e.Gmail,o=e.APIRequester,s=e.Model,l=e.BentoBox;var u=null;var c=function(e,t){l.Tracker.trackStreakActive(u,t,{eventName:e})};ReminderList={templates:{},defaults:{box:null,pipeline:null,showTitle:true,useLinkButtonForNewReminder:false},create:function(e){this._init();var t={};n.extend(t,this.defaults,e);return new l.Widgets.ReminderList.impl(t)},_init:function(){if(!this.templates.main){this.templates.main=i.get("reminderList");this.templates.menu=i.get("reminderListMenu");this.templates.reminder=i.get("reminderItem")}}};ReminderList.impl=function(i){var a={};var o=i.box,s=i.pipeline;i.trackingContext.widgetContext+="/reminderList";u=i.trackingContext;var d=t(document.createElement("div"));d.addClass("reminderList section");d[0].innerHTML=ReminderList.templates.main();if(!i.showTitle){d.find(".title").hide()}var h=d.find(".reminderInnerList");var f=[];var p=""+r.now();var m=l.Data.getReminderCollection(o.key());var _=d.find(".reminderCreate");var g=function(){y();L();m.refresh(v);k()},v=function(){if(f===null){return}h.empty();if(m.length===0){w();return}var e=n.sortBy(m,function(e){return-1*e.get("remindDate")});for(var t=0;t<e.length;t++){h.append(b(e[t]))}},y=function(){h.empty();var e=t(document.createElement("tr"));e.addClass("asd ja empty");e[0].innerHTML=l.Locale.getString("loading");h.append(e)},w=function(){h.empty();var e=t(document.createElement("tr"));e.addClass("asd ja empty");e[0].innerHTML=l.Locale.getString("no_reminders");h.append(e)},b=function(e){var n=t(ReminderList.templates.reminder());e.watch("delete",function(){n.remove();if(h.find(".reminderItem").length===0){w()
}},a);e.watch("save",function(){var i=t(ReminderList.templates.reminder());C(e,i);n.after(i);n.remove();n=i},a);C(e,n);return n},C=function(e,t){if(e.get("message")){t.find(".notes").show();t.find(".notes").text(e.get("message"));t.find(".notes").attr("title",e.get("message"))}else{t.find(".notes").hide()}if(e.get("remindDate")){var n=r.ccreate(e.get("remindDate"));var a=t.find(".date");a.html(n.customFormat("shortWithWeekday"));if(n.isBefore(r.now())){t.addClass("passed")}t.find(".y2").show();if(!e.get("message")){a.detach();t.find(".innerDetails").append(a);t.find(".dateSecond").hide()}}if(e.get("remindFollowers")){t.find(".followerText").html(l.Locale.getString("remind_followers"))}else{t.find(".followerText").html(l.Locale.getString("reminders_reminding")+" "+e.get("creatorName"))}var o=l.Widgets.ButtonMenu.create({menuInner:ReminderList.templates.menu(),closeOnSelect:false,customButton:t.find(".innerDetails"),hoverClass:"active",justMenu:true,css:{width:"220px"},fixedPosition:true,rightAligned:true,trackingContext:i.trackingContext});o.setEnabled(l.Services.AccessManager.arePermissionsAllowed(s,[{entityType:"Box",action:"UPDATE"},{entityType:"Reminder",action:"UPDATE"}]));S(o,e);t.find(".innerDetails").append(o.menu)};var S=function(n,a,o){var s=n.menu;var u=!a.key();var d=s.find(".dateInput");if(a.get("remindDate")){var h=r.ccreate(a.get("remindDate"));d.val(h.customFormat("longDateTime"));n.menu.find(".scheduledDate").text(h.customFormat("shortWithWeekday"));d.addClass("valid")}d.keyup(function(t){if(e.jwerty.is("escape",t)){n.off();return}var i=d.val().trim();var o;d.removeClass("valid");a.set("remindDate",null);if(i===""){o=l.Locale.getString("send_later_enter_date")}else{var s=r.ccreate(i);if(!s.isValid()){s=r.ccreate(i,l.Locale.getCurrent());if(!s.isValid()){o=l.Locale.getString("send_later_invalid_date")}}else{if(s.isBefore(new r)){o=l.Locale.getString("send_later_future_date")}else{d.addClass("valid");g.el.prop("disabled",false);o=s.customFormat("shortWithWeekday");a.set("remindDate",s.getTime());if(t.which===13){g.on()}}}}n.menu.find(".scheduledDate").text(o)});s.find("a").click(function(e){e.preventDefault();var i=r.ccreate(t(this).attr("title"));d.val(i.customFormat("longDateTime"));n.menu.find(".scheduledDate").text(i.customFormat("shortWithWeekday"));a.set("remindDate",i.getTime());d.addClass("valid");c("suggestedTimeClick")});s.find(".notesEnter").val(a.get("message"));if(a.get("remindFollowers")){s.find(".includeFollowers")[0].checked=true}var p="remindFollowers"+r.ccreate().getTime()*Math.random();s.find(".includeFollowers").prop("id",p);s.find(".checkbox label").prop("for",p);if(!o){var _=l.Widgets.Button.create({name:l.Locale.getString("reminder_cancel"),isToggle:false,hasButtonToRight:true,onFunc:function(){_.el.trigger("delete");n.off();a.del();c("deleteReminder",{messageLength:a.get("message").length,remindFollowers:a.get("remindFollowers")})},trackingContext:i.trackingContext});_.el.css({"float":"left"});s.find(".buttons").append(_.el)}var g=l.Widgets.Button.create({name:l.Locale.getString(u?"create":"save"),isToggle:false,onFunc:function(){if(a.get("remindDate")){a.set("message",s.find(".notesEnter").val());a.set("remindFollowers",s.find(".includeFollowers")[0].checked===true);n.off();var e="editReminder";if(o){e="newReminder"}c(e,{messageLength:a.get("message").length,remindFollowers:a.get("remindFollowers")});if(o){a.save(function(){m.add(a);v()});L();k()}else{a.save()}}},color:"red",trackingContext:i.trackingContext});g.el.addClass("bbLast");s.find(".buttons").append(g.el);t.tabChain([d,s.find(".notesEnter"),s.find(".includeFollowers"),g.el]);n.updateOptions({postOnFunc:function(){d.focus()}});f.push(n);f.push(g);return s};var T=null;var x=null;var k=function(){x=l.Models.Reminder.create({boxKey:o.key(),pipelineKey:s.key(),message:""});_.empty();var e={color:"blue",menuInner:ReminderList.templates.menu(),closeOnSelect:false,css:{width:"220px"},rightAligned:true,trackingContext:i.trackingContext,fixedPosition:true};if(i.useLinkButtonForNewReminder){e.customButton=l.Widgets.LinkButton.create({text:"+ "+l.Locale.getString("new_reminder")}).getElement();e.justMenu=true}else{e.buttonInner=l.Locale.getString("reminder_new")}if(!o.getIsEditable()||!l.Services.AccessManager.arePermissionsAllowed(s,[{entityType:"Box",action:"UPDATE"},{entityType:"Reminder",action:"CREATE"}])){return}T=l.Widgets.ButtonMenu.create(e);S(T,x,true);x.watch("create",M,a);if(i.useLinkButtonForNewReminder){_.empty();_.append(T.getButtonElement());_.append(T.menu)}else{T.button.el.addClass("center");_.append(T.el)}};var M=function(){g();c("newReminder",{messageLength:x.get("message").length,remindFollowers:x.get("remindFollowers")})};g();o.watch("reminderRefresh",g,a);function L(){if(!f){return}n.each(f,function(e){if(e&&n.isFunction(e.destroy)){e.destroy()}})}a.el=d;a.getFocusElement=function(){return _.find(".bbButton").first()};a.getNewReminderButtonElement=function(){return _};a.refresh=g;a.destroy=function(){L();f=null;e.NotificationCenter.unsubscribe({observer:a})};return a};l.Widgets.ReminderList=ReminderList})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o=function(n){a.Widgets.Widget.call(this,n);this.pipelines=n.pipelines;this.modal=t(r.get("shareStreakModal")({modal_description:this.options.modalDescription}));this.potentialPeople=[];this.acl=[];this.suggestionsFoundObj=e.Eventer.create();this.setupUI();this.prepareData();this.saved=false};o.prototype=Object.create(a.Widgets.Widget.prototype);n.extend(o.prototype,{setupUI:function(){var e=this;this.personPicker=a.Widgets.PersonPicker.create({selectFunc:function(t){var i=e.renderACLRow(t,true);i.scrollintoview({duration:0});e.personPicker.setExcluded(n.pluck(e.potentialPeople,"personObject").concat({email:a.getUser().get("email")}))},allowName:false});this.personPicker.setExcluded([{email:a.getUser().get("email")}]);this.personPicker.el.addClass("bb_boxflex1 bb_vbox");this.modal.find(".sharingEnter").append(this.personPicker.el);var i=a.Widgets.Button.create({color:"red",name:a.Locale.getString("add"),onFunc:function(){e.personPicker.el.find("input").trigger("bbSelect")}});this.modal.find(".sharingEnter").append(i.el);var r={title:this.options.title,confirmText:this.options.confirmText,inner:this.modal,confirmFunc:this.saveList.bind(this),cancelFunc:this.cancelFunction.bind(this),width:"500px"};var o=t.extend({},r,this.options.modalOptions);this.shareModal=a.Widgets.Modal.create(o)},prepareData:function(){var e=this;a.Contacts[this.options.contactRequestFunction](50).then(function(t){t=t||[];if(t.length===0){e.modal.find(".sharingList").html(a.Locale.getString("share_no_contacts"))}else{e.modal.find(".sharingList").empty();n(t).chain().filter(function(e){return e.email!==a.getUser().get("email")&&e.fullName!==e.email}).each(function(t){e.renderACLRow(t,false)})}e.suggestionsFoundObj.trigger("ready")})},renderACLRow:function(e,n){var o=r.get("shareStreakItem",true);var s=t(a.Contacts.suggestionTemplate({image:e.imageUrl,name:e.fullName||e.email,tag:e.fullName?e.email:"&nbsp;"})).children().unwrap();o.find(".aclRowContent").append(s);var l=i.widgets.getCheckbox("",n);o.find(".selectionCheckbox").append(l);o.find(".remove").click(function(t){o.remove();acl.removeVal(e);pp.setExcluded(acl);t.preventDefault()});s.click(function(e){l.click()});if(n){this.modal.find(".sharingList").prepend(o)}else{this.modal.find(".sharingList").append(o)}l.bind("change",function(){o.toggleClass("bbChecked",l.isChecked())});o.toggleClass("bbChecked",l.isChecked());this.potentialPeople.push({row:o,personObject:e,checkbox:l});return o},saveList:function(){var e=this;for(var t=0;t<this.potentialPeople.length;t++){if(this.potentialPeople[t].checkbox.isChecked()){this.acl.push(this.potentialPeople[t].personObject)}}if(this.options.onPresave){if(this.options.onPresave(this.acl)){return}}if(this.acl.length===0){return}if(this.options.pipelines&&this.options.pipelines.length>0){this.executeSaveList()}},setPipelines:function(e){this.options.pipelines=e;this.executeSaveList()},executeSaveList:function(){var e=this;var t=n.onceAfter(this.options.pipelines.length,function(){e.options.onSave()});n.each(this.options.pipelines,function(n){n.set("aclEntries",e.acl);n.save(t)})},cancelFunction:function(){if(this.options.cancelFunction){this.options.cancelFunction()}},show:function(e){var t=this;if(e){this.setOptions(e)}t.shareModal.show();this.suggestionsFoundObj.ready(function(){var e=t.shareModal.getOkButton().el;t.personPicker.setTab(e,e);e.easyTab({next:t.personPicker.el,prev:t.personPicker.el})})},close:function(){this.shareModal.close()},defaults:{pipelines:[],onPresave:t.noop,onSave:t.noop,modalOptions:{}}});o.create=function(e){return new o(e)};a.Widgets.ShareStreak=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s;var l=function(e,t){o.Tracker.trackStreakActive(s,t,{eventName:e})};var u={defaults:{searchController:null},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(){if(!this.templates){this.templates={};this.templates.searchDiv=r.get("searchBox")}}};u.impl=function(e){var n=e.searchController;var i=t(document.createElement("div"));var r=0;i[0].innerHTML=u.templates.searchDiv();var a=this;a.o=e;var s=i.find("input");i.find(".bbPrevButton").click(function(e){n.selectPrevious();s.focus()});i.find(".bbNextButton").click(function(e){n.selectNext();s.focus()});i.find(".bbCloseButton").click(function(e){i.removeClass("showDown");i.addClass("hideUp");n.hideSearch()});var l=i.find(".searchInputContainer");s.focus(function(e){t(l).addClass("searchInputSelected")});s.blur(function(e){t(l).removeClass("searchInputSelected")});o.Keyboard.bindChordToEl({el:s,chord:"enter",noDefault:true,cb:function(e){n.selectNext();s.focus()}});o.Keyboard.bindChordToEl({el:s,chord:"shift+enter",noDefault:true,cb:function(e){n.selectPrevious();s.focus()}});o.Keyboard.bindChordToEl({el:s,chord:"escape",noDefault:true,cb:function(e){i.removeClass("showDown");i.addClass("hideUp");n.hideSearch()}});s.delayedSave({delay:300,dontPropagate:true,saveFunction:function(e){var t=s.val();n.searchTriggered(t);s.focus()}});function c(){var e=n.getResultState();i.find(".searchResultsPosition").html(e.selectedIndex);i.find(".searchResultsCount").html(e.total)}function d(){i.removeClass("showDown");i.addClass("hideUp");i.remove()}return{el:i,getElement:function(){return i},show:function(){i.show();i.find(".pipelineSearchInput").select();i.find(".pipelineSearchInput").focus();i.addClass("showDown");var e=s.val();n.searchTriggered(e);s.focus()},hide:function(){i.removeClass("showDown");i.addClass("hideUp")},findNext:function(){n.selectNext();s.focus()},searchResultsChanged:function(){c()},destroy:function(){d()}}};o.Widgets.SearchBox=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._elements=[]};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{addElement:function(e){this._elements.push(e);this._resetTabs()},addElements:function(e){n.mutate("union",this._elements,e);this._resetTabs()},removeElement:function(e){this._elements.removeVal(e);this._resetTabs()},addView:function(e){this._elements.push(e.getElement());this._resetTabs()},removeView:function(e){this._elements.removeVal(e.getElement());this._resetTabs()},destroy:function(){this._unbind();this._elements.length=0},_resetTabs:function(){this._unbind();t.tabChain(this._elements,50,"tabFocusController")},_unbind:function(){for(var e=0;e<this._elements.length;e++){if(this._elements[e]){this._elements[e].off(".tabFocusController")}}}});s.Widgets.TabFocusController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={templates:{},defaults:{gmailThread:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};var l=function(e,t){o.Tracker.trackStreakActive(t,{eventName:e})};s.impl=function(n){var i={},a=n,s=n.gmailThread,u=t(document.createElement("span"));var c=null;var d=null;var h=null;function f(e){switch(s.get("taskStatus")){case"NOT_A_TASK":case"":p();break;case"NOT_DONE_TASK":m(false);break;case"DONE_TASK":m(true);break}return null}function p(){if(!_()){return}if(!h){h=t(document.createElement("span"));h[0].innerHTML='[<a href="#">'+o.Locale.getString("make_task")+"</a>]";h.find("a").captureClick(function(e){s.set("taskStatus","NOT_DONE_TASK");s.save();e.preventDefault();l("markAsTask")})}if(c){c.detach()}if(d){d.getElement().detach()}u.append(h)}function m(e){if(c&&d){d.setIsChecked(s.get("taskStatus")==="DONE_TASK")}else{c=r.widgets.getLabelActionTag({backgroundColor:"rgb(254, 173, 71)",textColor:"rgb(0, 0, 0)",labelText:o.Locale.getString("task"),labelHelpText:o.Locale.getString("task_help"),xHelpText:o.Locale.getString("untask_help"),xCallback:_()?function(){s.set("taskStatus","NOT_A_TASK");s.save();l("markNotTask")}:t.noop});d=new o.Widgets.GmailCheckboxView(o.Locale.getString("task_done"));d.setIsChecked(e);d.whenChanged(function(e){s.set("taskStatus",e?"DONE_TASK":"NOT_DONE_TASK");s.save();l("threadTaskStatusChanged",{isChecked:e})});d.setEnabled(_())}if(h){h.detach()}if(c.parents().length===0||c.parent()[0]!==u[0]){u.append(c)}var n=d.getElement();if(n.parents().length===0||n.parent()[0]!==u[0]){u.append(n)}c.reset()}function _(){var e=o.Data.getPipeline(s.get("pipelineKey"));if(!e){var t=o.Data.getBox(s.get("boxKey"));if(!t){return true}e=t.getPipeline()}return o.Services.AccessManager.isAccessAllowed(e,"GmailThread","UPDATE")}u.addClass("threadTask");u.click(function(e){e.preventDefault();e.stopPropagation()});u.data("threadTask",i);s.watch("set",f,i,"taskStatus");f(true);i.el=u;i.destroy=function(){u.remove();e.NotificationCenter.unsubscribe({observer:i})};i.getElement=function(){return u};return i};o.Widgets.ThreadTask=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){this._active=true;this._instances=[];i.GmailComposeManager.registerModule(this)};n.extend(l.prototype,{getViewController:function(){var e=this._createNewInstanceType();this._instances.push(e);e.addDelegate(this);return e},destroy:function(e){this._instances.removeVal(e)}});s.Modules.ComposeMasterControllerBase=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=e.Class.subclass({superclass:e.UI.ViewController,_memberVariables:[{name:"_composeWindowViewController",destroy:false}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);return this},allModificationsInitialized:function(){},shouldProcessModification:function(){return true},aboutToProcessModification:function(){},getModificationType:function(){},getModificationArea:function(){},getModificationPlacement:function(){},getModificationPriority:function(){},getModificationElement:function(){},shouldModifyTabOrder:function(){return true},initialize:function(e){throw new Error("must override")},justAdded:function(){},getListenerType:function(){},getCharacterSequenceListener:function(){},draftSaved:function(){},aboutToSend:function(){},emailSent:function(){},sentEmailThreadMetaDataFound:function(e){},discarded:function(){}});s.Modules.ComposeViewControllerBase=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxAndGmailThreadCreator",superclass:e.Operations.OperationStatusChangeHandler,_memberVariables:[],_initialize:function(){e.Operations.OperationStatusChangeHandler.prototype._initialize.call(this)},createBoxAndGmailThreads:function(e,t,n){var i=c.Models.Box.create({name:e,pipelineKey:t,stageKey:c.Data.getPipeline(t).getStages()[0].key()});c.Data.getPipelineBoxes(t).add(i);var r=this;i.save(function(){if(n.length===1){r.createGmailThread(i.key(),n[0]);l.postNotification({eventName:"boxAndGmailThreadCreated",sender:r,hexGmailThreadId:n[0].hexGmailThreadId})}else{r.createGmailThreads(i.key(),n)}});return i},createGmailThreads:function(t,n){if(n.length===1){this.createGmailThread(t,n[0]);return}var i=new c.Modules.BoxesMenu.MultipleGmailThreadCreationOperation({boxKey:t,threadMetaDataList:n});var r=this;return e.Operations.OperationQueue.Singleton.addOperation(i,r)},_operationSucceeded:function(t){e.Operations.CollectionOperationManager.Singleton.updateCollectionWithResponse(c.Data.getAllGmailThreads(),t.getResponse(),true)},_operationFailed:function(e){},createGmailThread:function(e,t){var n=c.Models.GmailThread.create({boxKey:e,hexGmailThreadId:t.hexGmailThreadId});c.Data.getAllGmailThreads().add(n);n.save();l.postNotification({eventName:"gmailThreadCreated",sender:self,hexGmailThreadId:t.hexGmailThreadId})},deleteGmailThreads:function(e){for(var t=0;t<e.length;t++){var n=c.Services.Threads.ThreadStorer.getGmailThread(e[t]);if(!n){return}n.del()}},getNumberOfThreadsBeingSaved:function(t){var n=[];for(var i=0;i<t.length;i++){n.push("gmailThread_create_hexGmailThreadId_"+t[i]);n.push("gmailThread_delete_hexGmailThreadId_"+t[i])}var r=e.Operations.OperationQueue.Singleton.queryOperationQueue({notStates:[e.Operations.Operation.STATES.SUCCEEDED,e.Operations.Operation.STATES.FAILED],containsTags:n});return r.length}});i.set("BentoBox.Modules.BoxesMenu.BoxAndGmailThreadCreator",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._view=new s.Modules.BoxesMenu.BoxesMenuView;this._boxesMenuModel=new s.Modules.BoxesMenu.BoxesMenuModel;this._boxDetailsVC=new s.Widgets.BoxesDetailsVC;this._listViewVC=new s.Widgets.ListView.ListViewViewController({scrollableElement:this._view.getListSectionElement()});this._searchbox=new s.Widgets.SearchSimpleVC;this._searchbox.setSupressTab(true);this._keyboardCaptureWidget=new s.Widgets.KeyboardCaptureWidget;this._stateViewController=new s.Modules.BoxesMenu.BoxesMenuStateController(this._boxesMenuModel);this._doneCallback=null;this._setupDelegates();this._setupView();this._setupCreatePipelineButton()};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{_setupDelegates:function(){this._boxesMenuModel.addDelegate(this);this._boxesMenuModel.addDelegate(this._stateViewController);this._listViewVC.setDataSource(this._boxesMenuModel);this._listViewVC.addDelegate(this);this._listViewVC.addDelegate(this._stateViewController);this._searchbox.addDelegate(this._stateViewController);this._searchbox.addDelegate(this._listViewVC);this._keyboardCaptureWidget.addDelegate(this._listViewVC)},_setupView:function(){this._searchbox.setPlaceholder(s.Locale.getString("search_all_boxes"));this._view.setSearchArea(this._searchbox.getView().getEl());this._view.setListSection(this._listViewVC.getView().getEl());this._view.setRightPane(this._boxDetailsVC.getView().getEl());this._view.setKeyboardCapture(this._keyboardCaptureWidget.getElement())},getElement:function(){return this._view.getEl()},use:function(e){this._view.hideRightPane();this._boxesMenuModel.reset();this._searchbox.reset();this._doneCallback=e.doneCallback;this._boxesMenuModel.setDontAssociate(e.dontAssociate);var t=e.threadMetaDataList;if(!t){var n=e.hexGmailThreadIdList;if(!n){n=i.getActiveHexGmailThreadIdList(s.Services.Threads.HexGmailThreadIdExtractor)}t=s.Services.Threads.ThreadStorer.getThreadMetaDataList(n)}this._stateViewController.setThreads(t);if(e.box){this._stateViewController.setBox(e.box)}this._boxesMenuModel.setContext(e.context)},focus:function(){this._searchbox.focus()},stateChanged:function(){var e=this._boxesMenuModel.getState();this._view.hideCreatePipeline();this._view.showListSection();switch(e){case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.SEARCH_STATE:this._view.showSearchArea();this._searchbox.focus();break;case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.REMOVE_STATE:case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.CHOOSE_PIPELINE_STATE:case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.THREADS_BEING_SAVED_STATE:case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.NO_PREVIEWED_ROW_STATE:this._view.hideSearchArea();this._keyboardCaptureWidget.focus();break;case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.NO_PIPELINES_STATE:this._view.hideSearchArea();this._view.hideListSection();this._view.showCreatePipeline();break;case s.Modules.BoxesMenu.BoxesMenuStateController.prototype.DONE_STATE:if(this._doneCallback){this._doneCallback(this._boxesMenuModel.getBox())}break}},rowFocused:function(e){if(!e){this._view.hideRightPane();return}if(!e.data||!e.data.box){this._view.hideRightPane();return}this._boxDetailsVC.setModel(e.data.box);this._view.showRightPane()},setThreads:function(e){this._stateViewController.setThreads(e)},_setupCreatePipelineButton:function(){var e=this;var t=s.Widgets.NewPipelineModal.create({title:s.Locale.getString("left_link_make_new"),pipelineSavedCallback:function(e){i.inboxSDK.Router.goto(e.link())}});this._createPipelineButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:s.Locale.getString("create_new_pipeline"),onFunction:function(){t.show();e._boxesMenuModel.setState(s.Modules.BoxesMenu.BoxesMenuStateController.prototype.DONE_STATE)}});this._view.setCreatePipelineButton(this._createPipelineButton)},destroy:function(){this._view.destroy();this._boxDetailsVC.destroy();this._listViewVC.destroy();this._searchbox.destroy();this._stateViewController.destroy()}});e.DependencyManager.addFunction({functionKey:"boxesMenuViewControllerInitialized",functionReference:function(){e.Library.set("BentoBox.Modules.BoxesMenu.BoxesMenuViewController",new l)},dependentFunctionKeys:["htmlLoaded","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(){i.Widgets.ListView.ListViewBaseModel.call(this);this._state="default";this._query=null;this._threads=null;this._boxName="";this._box=null;this._storedSections=null;this._dontAssociate=null;this._context=null;this._disabled=false};l.prototype=Object.create(i.Widgets.ListView.ListViewBaseModel.prototype);o.extend(l.prototype,{reset:function(){this.removeAllSections();this.setThreads(null);this.setBoxName(null);this.setBox(null);this.setQuery(null);this._disabled=false},setThreads:function(e){this._threads=e},getThreads:function(){return this._threads},setBoxName:function(e){this._boxName=e},getBoxName:function(){return this._boxName},setBox:function(e){this._box=e},getBox:function(){return this._box},setState:function(e){this._state=e;this._callDelegateFunction("stateChanged")},getState:function(){return this._state},setQuery:function(e){this._query=e},getQuery:function(){return this._query},setDontAssociate:function(e){this._dontAssociate=e},getDontAssociate:function(){return this._dontAssociate},setContext:function(e){this._context=e},getContext:function(){return this._context},disable:function(){this._disabled=true}});o.extend(l.prototype,{archiveSections:function(){this._storedSections=this._sections},restoreSections:function(){if(o.isReal(this._storedSections)){this.removeAllSections();this._sections=this._storedSections;this._callDelegateFunction("dataChanged")}},removeAllSections:function(){this._sections.length=0;this._callDelegateFunction("dataChanged")},addSection:function(e){this._sections.push(e);this._callDelegateFunction("dataChanged")},numberOfSections:function(){return this._sections.length},numberOfRowsForSection:function(e){return this._sections[e].rows.length},infoForRow:function(e,t){return this._sections[e].rows[t]},sectionTitle:function(e){return this._sections[e].name},sectionTitleClass:function(e){var t="streak__listViewHeader2";if(this._sections[e].titleClass){t+=" "+this._sections[e].titleClass}return t},sectionIconClass:function(e){return this._sections[e].sectionIconClass},rowsAreNotSelectable:function(){return this._disabled}});i.Modules.BoxesMenu.BoxesMenuModel=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._el=t(r.get("bm_main_container")());this._listContainer=this._el.find(".streak_bm_container");this._searchAreaEl=this._el.find(".streak__bm_searcharea");this._searchAreaContentEl=this._el.find(".streak__bm_searcharea_content");this._rightPane=this._el.find(".streak__bm_right_pane")};o.extend(l.prototype,{hideSearchArea:function(){this._searchAreaEl.hide()},showSearchArea:function(){this._searchAreaEl.show()},setKeyboardCapture:function(e){this._el.append(e)},getEl:function(){return this._el},getElement:function(){return this._el},setSearchArea:function(e){this._searchAreaContentEl.html(e)},setListSection:function(e){this._el.find(".streak__bm_top_section").html(e)},getListSectionElement:function(){return this._el.find(".streak__bm_top_section")},setRightPane:function(e){this._rightPane.empty();this._rightPane.append(e)},showRightPane:function(){this._rightPane.show();this._listContainer.addClass("streak_bm_container_withRightPane")},hideRightPane:function(){this._listContainer.removeClass("streak_bm_container_withRightPane");this._rightPane.hide()},hideCreatePipeline:function(){this._el.find(".streak__bm_noPipelines").hide()},showCreatePipeline:function(){this._el.find(".streak__bm_noPipelines").show()},setCreatePipelineButton:function(e){this._el.find(".streak__bm_noPipelines").append(e.getElement())},hideListSection:function(){this._el.find(".streak__bm_top_section").hide()},showListSection:function(){this._el.find(".streak__bm_top_section").show()}});i.Modules.BoxesMenu.BoxesMenuView=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(t){e.ViewControllerBase.call(this);this._boxesMenuModel=t;this._threadsBeingSavedStateController=new i.Modules.BoxesMenu.ThreadsBeingSavedStateController(t);this._removeStateController=new i.Modules.BoxesMenu.RemoveStateController(t);this._emptyQueryStateController=new i.Modules.BoxesMenu.SearchEmptyStateContrller(this._boxesMenuModel);this._searchQueryStateController=new i.Modules.BoxesMenu.SearchQueryStateController(this._boxesMenuModel);this._pipelineStateController=new i.Modules.BoxesMenu.PipelineStateController(t);this._boxAddRemoveController=new i.Modules.BoxesMenu.BoxesMenuAddRemoveController(t);this._noPreviewedRowStateController=new i.Modules.BoxesMenu.NoPreviewedRowStateController(t)};l.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(l.prototype,{SEARCH_STATE:"SEARCH",REMOVE_STATE:"REMOVE",CHOOSE_PIPELINE_STATE:"CHOOSE_PIPELINE_STATE",DONE_STATE:"DONE",THREADS_BEING_SAVED_STATE:"THREADS_BEING_SAVED_STATE",NO_PREVIEWED_ROW_STATE:"NO_PREVIEWED_ROW_STATE",NO_PIPELINES_STATE:"NO_PIPELINES_STATE",setThreads:function(e){this._boxesMenuModel.setThreads(e);this._determineStateFromThreads()},setBox:function(e){this._boxesMenuModel.setBox(e);this._boxesMenuModel.setState(this.REMOVE_STATE)},rowPressed:function(e){switch(e.type){case"go_back_from_pipeline":this._goBackFromPipeline();i.Tracker.track("boxes menu go back from pipeline");break;case"existing_box":this._boxAddRemoveController.associateBoxWithThreads(e.data.box);this._boxesMenuModel.setState(this.DONE_STATE);i.Tracker.track("boxes menu choose existing box");break;case"new_box_name":this._newBoxNameChosen(e.data.boxName);i.Tracker.track("boxes menu choose new box name");break;case"pipeline":this._boxAddRemoveController.createNewBoxInPipelineAndAssociateThreads(e.data.pipeline);this._boxesMenuModel.setState(this.DONE_STATE);i.Tracker.track("boxes menu choose pipeline");break;case"remove_box":this._boxAddRemoveController.removeThreadsFromBox();this._boxesMenuModel.setState(this.DONE_STATE);i.Tracker.track("boxes menu remove box");break}},_determineStateFromThreads:function(){var e=this._boxesMenuModel.getThreads();var t=o.chain(e).compact().pluck("hexGmailThreadId").value();var n=i.Services.Threads.ThreadStorer.getBoxKeyList(t);var r=o.any(n,function(e){return e&&i.Data.getBox(e)});if(r){this._boxesMenuModel.setState(this.REMOVE_STATE);return}if(o.isEmpty(this._getValidPipelinesForNewEmailThread())){this._boxesMenuModel.setState(this.NO_PIPELINES_STATE);return}if(o.isEmpty(e)){this._boxesMenuModel.setState(this.NO_PREVIEWED_ROW_STATE);return}var a=i.Modules.BoxesMenu.BoxAndGmailThreadCreator.getNumberOfThreadsBeingSaved(t)>0;if(a){this._boxesMenuModel.setState(this.THREADS_BEING_SAVED_STATE);return}this._boxesMenuModel.setState(this.SEARCH_STATE)},stateChanged:function(){var e=this._boxesMenuModel.getState();this._boxesMenuModel.removeAllSections();switch(e){case this.REMOVE_STATE:this._removeStateController.use();break;case this.CHOOSE_PIPELINE_STATE:this._pipelineStateController.use();break;case this.SEARCH_STATE:this.queryChange("");break;case this.THREADS_BEING_SAVED_STATE:this._threadsBeingSavedStateController.use();break;case this.NO_PREVIEWED_ROW_STATE:this._noPreviewedRowStateController.use();break}},queryChange:function(e){this._boxesMenuModel.removeAllSections();this._boxesMenuModel.setQuery(e);if(e===""){this._emptyQueryStateController.use()}else{this._searchQueryStateController.use()}},cursorLeft:function(e){if(this._boxesMenuModel.getState()===this.CHOOSE_PIPELINE_STATE){this._goBackFromPipeline()}},cursorRight:function(e,t){if(t&&e&&e.hasRightArrow){this.rowPressed(e)}},_goBackFromPipeline:function(){this._boxesMenuModel.restoreSections();this._boxesMenuModel.setState(this.SEARCH_STATE)},_newBoxNameChosen:function(e){this._boxesMenuModel.setBoxName(e);var t=this._getValidPipelinesForNewBoxAndEmailThread();if(t.length===0){this._boxesMenuModel.setState(this.NO_PIPELINES_STATE)}else if(t.length===1){this._boxAddRemoveController.createNewBoxInPipelineAndAssociateThreads(t[0])}else{this._boxesMenuModel.setState(this.CHOOSE_PIPELINE_STATE)}},_getValidPipelinesForNewEmailThread:function(){return o.filter(i.Data.getAllPipelines(),function(e){return i.Services.AccessManager.arePermissionsAllowed(e,[{entityType:"Box",action:"UPDATE"},{entityType:"GmailThread",action:"CREATE"}])})},_getValidPipelinesForNewBoxAndEmailThread:function(){return o.filter(this._getValidPipelinesForNewEmailThread(),function(e){return i.Services.AccessManager.isAccessAllowed(e,"Box","CREATE")})}});i.Modules.BoxesMenu.BoxesMenuStateController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{associateBoxWithThreads:function(e){var t=this._boxesMenuModel.getThreads();if(!this._boxesMenuModel.getDontAssociate()){i.Modules.BoxesMenu.BoxAndGmailThreadCreator.createGmailThreads(e.key(),t)}this._updateBoxesMenuModelAndTrack(e,t)},createNewBoxInPipelineAndAssociateThreads:function(e){var t=this;var n=this._boxesMenuModel.getBoxName();var r=this._boxesMenuModel.getThreads();var a;if(this._boxesMenuModel.getDontAssociate()){a=i.Models.Box.create({name:n,pipelineKey:e.key(),stageKey:e.getStages()[0].key()});i.Data.getPipelineBoxes(e.key()).add(a)}else{i.Modules.BoxesMenu.BoxAndGmailThreadCreator.createBoxAndGmailThreads(n,e.key(),r)}this._updateBoxesMenuModelAndTrack(a,r)},removeThreadsFromBox:function(){var e=this._boxesMenuModel.getThreads();if(!this._boxesMenuModel.getDontAssociate()){i.Modules.BoxesMenu.BoxAndGmailThreadCreator.deleteGmailThreads(o.pluck(e,"hexGmailThreadId"))}this._boxesMenuModel.setBox(null);this._boxesMenuModel.setState(i.Modules.BoxesMenu.BoxesMenuStateController.prototype.DONE_STATE);i.Tracker.track("removeThreadFromBox",{threadCount:e.length,context:this._boxesMenuModel.getContext()})},_updateBoxesMenuModelAndTrack:function(e,t){this._boxesMenuModel.setBox(e);this._boxesMenuModel.setState(i.Modules.BoxesMenu.BoxesMenuStateController.prototype.DONE_STATE);
i.Tracker.track("addThreadsToBox",{threadCount:t.length,context:this._boxesMenuModel.getContext()})}});i.Modules.BoxesMenu.BoxesMenuAddRemoveController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MultipleGmailThreadCreationOperation",superclass:e.Operations.AjaxRequestOperation,_memberVariables:[{name:"_boxKey",destroy:true},{name:"_threadMetaDataList",destroy:false}],_initialize:function(t){e.Operations.AjaxRequestOperation.prototype._initialize.call(this,t);this._boxKey=t.boxKey;this._threadMetaDataList=t.threadMetaDataList;this._tags=this._getTags();this._dependentOnTags=this._tags},_getTags:function(){var e=[];for(var t=0;t<this._threadMetaDataList.length;t++){var n=this._threadMetaDataList[t].hexGmailThreadId;e=e.concat(["gmailThread_create_boxKey_"+this._boxKey,"gmailThreadCollection_boxKey_"+this._boxKey,"gmailThread_create_hexGmailThreadId_"+n,"gmailThread_hexGmailThreadId_"+n])}return e},getMethod:function(){return"PUT"},getParams:function(){return{url:"boxes/"+this._boxKey+"/threads",json:JSON.stringify(this._threadMetaDataList)}}});i.set("BentoBox.Modules.BoxesMenu.MultipleGmailThreadCreationOperation",d)})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{use:function(){this._loadGoBackButton();this._loadPipelines()},_loadGoBackButton:function(){this._boxesMenuModel.addSection({rows:[{text:a.getString("go_back_from_pipeline"),type:"go_back_from_pipeline",hasLeftArrow:true}]})},_loadPipelines:function(){var e=o.chain(i.UI.getSortedVisiblePipelines()).filter(function(e){return i.Services.AccessManager.arePermissionsAllowed(e,[{entityType:"Pipeline",action:"UPDATE"},{entityType:"Box",action:"CREATE"}])}).map(function(e){return{text:e.displayName(),type:"pipeline",data:{pipeline:e}}}).value();this._boxesMenuModel.addSection({name:a.getString("select_a_pipeline_for_a_new_box"),rows:e})}});i.Modules.BoxesMenu.PipelineStateController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{use:function(){var e=this._extractBoxesFromThreads();var t=o.any(e,function(e){return!i.Services.AccessManager.arePermissionsAllowed(e.getPipeline(),[{entityType:"Pipeline",action:"UPDATE"},{entityType:"Box",action:"DELETE"}])});if(t){this._showInvalidRemove();return}if(e.length===0){return}if(e.length===1){this._removeSingleBox(e[0]);return}this._removeMultipleBoxes()},_extractBoxesFromThreads:function(){var e=this._boxesMenuModel.getBox();if(e){return[e]}return o.chain(this._boxesMenuModel.getThreads()).map(function(e){return i.Services.Threads.ThreadStorer.getBoxKey(e.hexGmailThreadId)}).filter(function(e){return e&&i.Data.getBox(e)}).map(function(e){return i.Data.getBox(e)}).compact().value()},_showInvalidRemove:function(){this._boxesMenuModel.disable();this._boxesMenuModel.addSection({rows:[{html:a.getString("cant_remove_boxes")}]})},_removeSingleBox:function(e){this._boxesMenuModel.addSection({rows:[{html:a.getString("remove_box",{box:"<strong>"+e.displayNameHTML()+"</strong>"}),type:"remove_box"}]})},_removeMultipleBoxes:function(){this._boxesMenuModel.addSection({rows:[{text:a.getString("remove_all_boxes"),type:"remove_box"}]})}});i.Modules.BoxesMenu.RemoveStateController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{LIMIT_ENTRIES:3,use:function(){this._loadExisting();this._loadSuggestedNames()},_loadExisting:function(){var e=this._getExistingBoxesAsRows();if(o.isReal(e)&&e.length>0){this._boxesMenuModel.addSection({name:a.getString("suggested_existing_boxes"),sectionIconClass:"streak__boxAddIcon",rows:e})}},_getExistingBoxesAsRows:function(){var e=i.Modules.BoxSuggestionsController.getBoxSuggestions(this._boxesMenuModel.getThreads());e=e.slice(0,self.LIMIT_ENTRIES);var t=o.map(e,function(e){return{html:i.UI.getBoxListDisplayHTML(e.box),displayClass:"streak__boxListRow",type:"existing_box",data:{box:e.box}}});return t},_loadSuggestedNames:function(){var e=i.Services.SuggestedBoxNames.getSuggestions(this._boxesMenuModel.getThreads());e=e.slice(0,self.LIMIT_ENTRIES);if(!e||e.length===0){return}var t=i.Data.getAllPipelines().length>1;var n=o.map(e,function(e){return{text:e,type:"new_box_name",data:{boxName:e},hasRightArrow:t}});this._boxesMenuModel.addSection({name:a.getString("suggested_names_for_box"),sectionIconClass:"streak__boxCreateIcon",rows:n})}});i.Modules.BoxesMenu.SearchEmptyStateContrller=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{LIMIT_ENTRIES:3,use:function(){this._loadExistingSection();this._loadQuerySection()},_loadQuerySection:function(){var e=i.Data.getAllPipelines().length>1;this._boxesMenuModel.addSection({name:a.getString("create_new_box_named"),sectionIconClass:"streak__boxCreateIcon",rows:[{text:this._boxesMenuModel.getQuery(),type:"new_box_name",data:{boxName:this._boxesMenuModel.getQuery()},hasRightArrow:e}]})},_loadExistingSection:function(){var e=i.Services.BoxSearcher.searchNameByQuery(this._boxesMenuModel.getQuery());if(!e||e.length===0){return}var t=o.map(e,function(e){return{html:i.UI.getBoxListDisplayHTML(e),displayClass:"streak__boxListRow",type:"existing_box",data:{box:e}}});this._boxesMenuModel.addSection({name:a.getString("or_add_it_to_an_existing_box"),sectionIconClass:"streak__boxAddIcon",rows:t})}});i.Modules.BoxesMenu.SearchQueryStateController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{use:function(){var e=this._boxesMenuModel.getThreads();var t=o.pluck(e,"hexGmailThreadId");var n=i.Modules.BoxesMenu.BoxAndGmailThreadCreator.getNumberOfThreadsBeingSaved(t);this._boxesMenuModel.addSection({name:n+" out of "+e.length+" threads are currently being synced please wait for them to finish",titleClass:"streak__boxesMenu_syncingMessage",rows:[]})}});i.Modules.BoxesMenu.ThreadsBeingSavedStateController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e.HTML,a=e.Locale,o=e._,s=e.Date;var l=function(e){this._boxesMenuModel=e};o.extend(l.prototype,{use:function(){this._boxesMenuModel.addSection({name:"No row is currently selected or previewed in inbox.",titleClass:"streak__boxesMenu_syncingMessage",rows:[]})}});i.Modules.BoxesMenu.NoPreviewedRowStateController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o=ListRowBoxesButton={_isActive:false,_isTornDown:false,_buttons:[],init:function(e){if(a.Data.streakSettings.settingIsEnabled("streak_it_title")){i.InboxManipulator.addDataSource(o)}if(e){e()}},teardown:function(){this._isTornDown=true},reup:function(){this._isTornDown=false},setIsActive:function(e){this._isActive=true;i.InboxManipulator.refreshAll();if(e){e()}},getGlobalManipulation:function(){if(i.isDrafts()){return}return{type:"CSS_CHANGE",columnName:"STAR",cssRule:"width: 52px"}},getTableManipulation:function(){if(i.isDrafts()){return}return{type:"COLUMN_WIDTH",columnName:"STAR",width:52}},getRowManipulation:function(e,t){if(i.isDrafts()){return}if(this._isTornDown){return}if(i.isVerticalSplitPreviewPane()){return}if(!e){return}var n=new ListRowBoxesButton.ListRowBoxesButtonInboxRowManipulation(e,t);if(this._isActive){n.setActive()}return n}};function s(e,t){a.Tracker.trackStreakActive(t,{widgetContext:"addToBoxesButton",eventName:e})}e.DependencyManager.addFunction({functionKey:"listRowBoxesButtonInitialized",functionToCall:ListRowBoxesButton.init,functionContext:ListRowBoxesButton,dependentFunctionKeys:["inboxManipulatorInitialized","data.streakSettings.initialized","htmlLoaded","boxesMenuViewControllerInitialized"]});e.DependencyManager.addFunction({functionKey:"listRowBoxesButton.setIsActive",functionToCall:ListRowBoxesButton.setIsActive,functionContext:ListRowBoxesButton,dependentFunctionKeys:["data.pipelines.initialized","data.boxes.initialized"]});a.Modules.ListRowBoxesButton=ListRowBoxesButton})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(e,t){i.InboxManipulator.InboxRowManipulationBase.call(this);this._hexGmailThreadId=e;this._threadDOMRow=t;this._element=null;this._menuButton=null;this._htmlID=null;this._menuOpen=false;this._setupUIElements()};l.prototype=Object.create(i.InboxManipulator.InboxRowManipulationBase.prototype);n.extend(l.prototype,{_setupUIElements:function(){this._element=t(document.createElement("div"));this._element[0].setAttribute("class","addBoxesButtonIndicator");this._setupMenuButton();this.update();this._htmlID=this._threadDOMRow.rowNode.attr("id")},_setupMenuButton:function(){var e=this;this._menuButton=s.Widgets.Buttons.ButtonFactory.createMenuButton({type:"Icon",iconClass:"__streak_It_Indicator",menu:s.Modules.BoxesMenu.BoxesMenuViewController,preOnFunction:function(){s.Modules.BoxesMenu.BoxesMenuViewController.getElement().removeClass("streak__sdk_menu streak__sdk_composeMenu");e._threadDOMRow.rowNode.attr("id","");e._element.addClass("__streak_It_Indicator_hover");e._menuOpen=true},postOnFunction:function(){e._element.css("z-index",2);s.Modules.BoxesMenu.BoxesMenuViewController.use({hexGmailThreadIdList:[e._hexGmailThreadId],doneCallback:function(){e._threadDOMRow.rowNode.attr("id",e._htmlID);e._menuButton.off()},context:"listRowBoxesButton"})},postOffFunction:function(){e._element.css("z-index","");e._menuOpen=false;e._threadDOMRow.rowNode.attr("id",e._htmlID);e._element.removeClass("__streak_It_Indicator_hover")}});this._element.append(this._menuButton.getElement())},update:function(){var e=s.Services.Threads.ThreadStorer.getBoxKey(this._hexGmailThreadId);if(!e){this._menuButton.removeClass("__streak_selected_streakit");return}var t=s.Data.getBox(e);if(!t){this._menuButton.removeClass("__streak_selected_streakit");return}this._menuButton.addClass("__streak_selected_streakit")},setActive:function(){var e=this;this._element.mousedown(function(t){e._threadDOMRow.rowNode.attr("id","");e._element.addClass("__streak_It_Indicator_hover")});this._element.on("mouseup mouseout",function(t){if(e._menuOpen){return}e._threadDOMRow.rowNode.attr("id",e._htmlID);e._element.removeClass("__streak_It_Indicator_hover")})},getElement:function(){return this._element},getColumnName:function(){return"STAR"},getManipulationType:function(){return"APPEND_ELEMENT"}});s.Modules.ListRowBoxesButton.ListRowBoxesButtonInboxRowManipulation=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailComposeManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){var e=new s.Modules.ComposeBoxesButtonViewController;var t=new s.Modules.ComposeTaskThreadViewController;e.addDelegate(t);return[e,t,new s.Modules.ComposeBoxSidebarViewController]}});o.addFunction({functionKey:"composeBoxesMasterControllerInitialized",functionToCall:function(e){s.Modules.ComposeBoxesButtonMasterController=new l;if(e){e()}},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","data.boxes.initialized","data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){l.Modules.ComposeViewControllerBase.call(this);this._buttonOptions=null;this._buttonOptionStream=new i.Bus;this._menuDropdown=null;this._box=null};u.prototype=Object.create(l.Modules.ComposeViewControllerBase.prototype);n.extend(u.prototype,{initialize:function(e){this._composeWindowViewController=e;this._setupMenuButton()},activeModulesChanged:function(e){this._buttonOptions.enabled=true;this._buttonOptions.iconClass="boxIconOnNewCompose";if(e.indexOf("sendLater")>-1||e.indexOf("mailMerge")>-1){this._buttonOptions.enabled=false}if(e.indexOf("threadBox")>-1){this._buttonOptions.iconClass+=" streak__boxOnComposeActive"}this._buttonOptionStream.push(this._buttonOptions)},aboutToSend:function(){this._box=this._composeWindowViewController.getModuleStorageValue("threadBox")},sentEmailThreadMetaDataFound:function(e){if(!this._box){this._callDelegateFunction("boxesButtonDestroyed");return}l.Modules.BoxesMenu.BoxAndGmailThreadCreator.createGmailThread(this._box.key(),e);l.Tracker.track("addThreadsToBox",{threadCount:1,context:"composeBoxesButton"});this._callDelegateFunction("gmailThreadCreated",e.hexGmailThreadId)},destroy:function(){l.Modules.BoxesMenu.BoxesMenuViewController.getElement().removeClass("streak__sdk_menu streak__sdk_composeMenu");this._composeWindowViewController=null;this._buttonOptionStream.end()}});n.extend(u.prototype,{_setupMenuButton:function(){var e=this;this._composeWindowViewController.getComposeView().addButton(this._buttonOptionStream);this._buttonOptions={type:"MODIFIER",iconClass:"boxIconOnNewCompose",tooltip:l.Locale.getString("add_to_box"),hasDropdown:true,orderHint:1,onClick:function(t){l.Tracker.track("boxes menu open",{method:"compose"});e._prepareBoxesMenu();l.Modules.BoxesMenu.BoxesMenuViewController.getElement().addClass("streak__sdk_menu streak__sdk_composeMenu");t.dropdown.el.appendChild(l.Modules.BoxesMenu.BoxesMenuViewController.getElement()[0]);e._menuDropdown=t.dropdown;l.Modules.BoxesMenu.BoxesMenuViewController.focus()}};this._buttonOptionStream.push(this._buttonOptions)},_prepareBoxesMenu:function(){var e=this;l.Modules.BoxesMenu.BoxesMenuViewController.use({dontAssociate:true,threadMetaDataList:[this._composeWindowViewController.getThreadMetaData()],box:this._composeWindowViewController.getModuleStorageValue("threadBox"),doneCallback:function(t){if(e._menuDropdown){e._menuDropdown.close()}if(t){if(t.isSavedOnServer()){e._composeWindowViewController.setModuleStorageValue("threadBox",t);e._composeWindowViewController.setModuleActive("threadBox");e._composeWindowViewController.notify("threadAddedToBox",t);l.Tracker.track("addBoxToCompose",{context:"composeBoxesButton"})}else{t.save(function(){e._composeWindowViewController.setModuleStorageValue("threadBox",t);e._composeWindowViewController.setModuleActive("threadBox");e._composeWindowViewController.notify("threadAddedToBox",t);l.Tracker.track("addBoxToCompose",{context:"composeBoxesButton"})});l.Tracker.track("createNewBoxOnCompose",{context:"composeBoxesButton"})}e._buttonOptions.tooltip=l.Locale.getString("compose_button_tooltip",{box:t.displayName()});e._buttonOptionStream.push(e._buttonOptions)}else{e._composeWindowViewController.setModuleStorageValue("threadBox",null);e._composeWindowViewController.setModuleInactive("threadBox");e._composeWindowViewController.notify("threadRemovedFromBox");e._buttonOptions.tooltip=l.Locale.getString("add_to_box");e._buttonOptionStream.push(e._buttonOptions);l.Tracker.track("removeBoxFromCompose")}},context:"composeBoxesButton"})}});l.Modules.ComposeBoxesButtonViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._sidebar=null;this._box=null;this._modificationParameters=null};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){return this._box!==null},aboutToProcessModification:function(){if(this._box){this._renderSidebar();return}if(this._sidebar){this._sidebar.destroy();this._sidebar=null}},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"INTERNAL_SIDEBAR"},getModificationPlacement:function(){return"RIGHT"},getModificationElement:function(){if(this._sidebar){return this._sidebar.getElement()}},getFirstTabFocusElement:function(){return this._sidebar.getFirstFocusable()},getLastTabFocusElement:function(){return this._sidebar.getLastFocusable()},threadAddedToBox:function(e){this._box=e;this._composeWindowViewController.reloadModification(this);s.Tracker.track("box added to compose")},threadRemovedFromBox:function(){this._box=null;this._composeWindowViewController.reloadModification(this);s.Tracker.track("box removed from compose")},destroy:function(){this._composeWindowViewController=null;this._callDelegateFunction("destroy",this);if(this._sidebar){this._sidebar.destroy();this._sidebar=null}},_renderSidebar:function(){var e=this;this._sidebar=s.Modules.ConversationSidebar.BoxSidebar.create({box:this._box,keyboardTabs:true,blur:function(){e._composeWindowViewController.getEditor().focus()}});this._sidebar.getElement().addClass("boxOnNewCompose")}});s.Modules.ComposeBoxSidebarViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._box=null;this._modificationParameters=null;this._taskThreadModel=null;this._threadTaskWidget=null};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){return this._box!==null},aboutToProcessModification:function(){if(this._box){this._renderThreadTask();return}this._removeThreadTask()},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"BOTTOM"},getModificationElement:function(){if(this._threadTaskWidget){return this._threadTaskWidget.getElement()}},threadAddedToBox:function(e){this._box=e;this._composeWindowViewController.reloadModification(this)},threadRemovedFromBox:function(){this._box=null;this._composeWindowViewController.reloadModification(this)},boxesButtonDestroyed:function(){this._destroy()},_destroy:function(){this._composeWindowViewController=null;this._callDelegateFunction("destroy",this);if(this._threadTaskWidget){this._threadTaskWidget.destroy()}},_removeThreadTask:function(){if(!this._threadTaskWidget){return}this._threadTaskWidget.destroy();this._threadTaskWidget=null;this._taskThreadModel=null},_renderThreadTask:function(){if(!this._taskThreadModel){this._taskThreadModel=s.Models.GmailThread.create({pipelineKey:this._box.get("pipelineKey")});this._taskThreadModel.save=t.noop}this._threadTaskWidget=s.Widgets.ThreadTask.create({gmailThread:this._taskThreadModel})},gmailThreadCreated:function(e){var t=s.Services.Threads.ThreadStorer.getGmailThread(e);if(!t){return}t.set("taskStatus",this._taskThreadModel.get("taskStatus"));t.save();this._destroy()}});s.Modules.ComposeTaskThreadViewController=l})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s=e.Class.subclass({className:"BoxesButton",superclass:e.Object,memberVariables:[{name:"_button",destroy:true}],_initialize:function(){var t=this;e.Object.prototype._initialize.call(this);this._button=o.Widgets.Buttons.ButtonFactory.createMenuButton({type:"GmailIconArrow",iconClass:"boxIcon",text:o.Locale.getString("boxes_button_boxes"),isFixedPosition:true,isRightAligned:true,menu:o.Modules.BoxesMenu.BoxesMenuViewController,preOnFunction:function(){o.Modules.BoxesMenu.BoxesMenuViewController.getElement().removeClass("streak__sdk_menu streak__sdk_composeMenu")},postOnFunction:function(){o.Modules.BoxesMenu.BoxesMenuViewController.use({doneCallback:function(){t._button.off()},context:"boxesButton"})}});this._button.addClass("streak__boxesButton");o.Keyboard.bindChord("w,a",function(){if(t._button.getElement().is(":visible")){setTimeout(function(){t._button.on()},10)}},o.Locale.getString("keyboard_boxes_button_description"))},getElement:function(){return this._button.getElement()}});e.DependencyManager.addFunction({functionKey:"boxesButtonInitialized",functionToCall:function(e){var t=new s;o.Services.ToolbarManager.registerButton({element:t.getElement(),showFor:"threadSelection",placement:"moveGroup",orderHint:2});if(e){e()}},dependentFunctionKeys:["data.boxes.initialized","data.pipelines.initialized","threadsInitialized","boxesMenuViewControllerInitialized","localeLoaded","gmailLoaded","userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{Locale:e.Locale,fileName:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(i){var r=this;r.o=i;r.html={};r.fetchHTML=function(t){var n=this;return new e.Request("GET",e.server,t,{isAnonymous:true,responseType:"text"}).getPromise()};r.loadHTML=function(e){var n=this;if(!n.o.fileName){if(e){e()}return}n.fetchHTML(n.o.fileName).then(function(i){var r=t(i);r.each(function(e){var i=t(r[e]).attr("id");if(i&&i.length>0){var a=r[e];n.html[i]=a.innerHTML.unescapeHTML()}});e()})};r.substituteHTML=function(e){var t=this;return e.replace(/<%\*([\s\S]+?)%>/g,function(e,n){return t.getHelper(n.trim())})},r.getClone=function(){var t=e.$.extend(true,{},r.html);return e.$.extend(true,{},r,{html:t})};r.setMode=function(t){var n=this;t="__"+t;var i=[];e._.each(n.html,function(e,r){var a=r.indexOf(t);if(a>0){var o=r.substring(0,a);i.push({baseKey:o,value:n.html[r]})}});var r=i.length;for(var a=0;a<r;a++){var o=i[a];n.html[o.baseKey]=o.value}};r.getHelper=function(e){return r.html[e]},r.get=function(e){var t="";var i=this.substituteHTML(this.html[e]);for(var a=0;a<100;a++){var t=this.substituteHTML(i);if(i===t){break}else{i=t}}return n.template(r.o.Locale.localize(t))};return r};a.Modules.OverridableHTML=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u=e.Class.subclass({className:"BoxSidebarMasterController",superclass:e.Object,_memberVariables:[{name:"_boxSidebarViewController",destroy:true},{name:"_relatedBoxesViewController",destroy:true},{name:"_sidebarInjector",destroy:true},{name:"_box",destroy:false},{name:"_sidebarOptions",destroy:false}],_initialize:function(t){e.Object.prototype._initialize.call(this);this._sidebarOptions={title:l.Locale.getString("box_tab_title"),iconClass:"streak__sidebar_darkBoxIcon",orderHint:1,el:document.createElement("div")};this._sidebarInjector=new l.Controllers.SidebarInjector(t,{notificationCenterEventName:"threadStorerDataChanged",notificationCenterFilterValueType:"boxKey",checkState:this._checkBoxState.bind(this),destroy:this.destroy.bind(this)});var n=this;e.NotificationCenter.subscribe({eventName:"gmailThreadCreated",functionToCall:this._handleGmailThreadCreated,observer:this})},_checkBoxState:function(e){var t=l.Services.Threads.ThreadStorer.getBoxKey(e);var n;if(t){n=l.Data.getBox(t)}var i=l.Services.Threads.ThreadStorer.getThreadMetaData(e);var r;if(i){r=l.Services.BoxSearcher.getBoxesWithOverlappingEmailAddresses(i.emailAddresses)}else{r=[]}if(r.length>10){if(r.length/l.Data.getAllBoxes().length>.1){r.length=0}}this._loadBoxSidebar(n,r,e)},_loadBoxSidebar:function(e,t,n){if(this._box&&e&&e.key()===this._box.key()){return}if(!e){if(!t||t.length===0){this._removeEverything()}else{this._removeBoxSidebar();this._createRelatedSidebar(t)}}else{this._removeBoxSidebar();this._removeRelatedBoxesSidebar();this._createBoxSidebar(e,t,n)}this._box=e},_removeEverything:function(){this._removeBoxSidebar();this._removeRelatedBoxesSidebar();this._sidebarInjector.removeSidebar()},_removeBoxSidebar:function(){if(this._boxSidebarViewController){this._boxSidebarViewController.destroy();this._boxSidebarViewController=null}},_removeRelatedBoxesSidebar:function(){if(this._relatedBoxesViewController){this._relatedBoxesViewController.destroy();this._relatedBoxesViewController=null}},_createBoxSidebar:function(e,t,n){this._boxSidebarViewController=l.Modules.ConversationSidebar.BoxSidebar.create({box:e,hexGmailThreadId:n,keyboardTabs:true,clearIDAttributeOfMainElement:false});if(t&&t.length>0){this._relatedBoxesViewController=new l.Modules.BoxSidebarRelatedBoxesViewController(t,e);this._boxSidebarViewController.setRelatedBoxesView(this._relatedBoxesViewController.getView())}this._sidebarOptions.el.appendChild(this._boxSidebarViewController.getElement()[0]);this._sidebarInjector.addSidebar(this._sidebarOptions)},_createRelatedSidebar:function(e){this._relatedBoxesViewController=new l.Modules.RelatedBoxesViewController(e);this._sidebarOptions.el.appendChild(this._relatedBoxesViewController.getView().getElement()[0]);this._sidebarInjector.addSidebar(this._sidebarOptions)},_handleGmailThreadCreated:function(e){if(this._boxSidebarViewController&&this._boxSidebarViewController.hexGmailThreadId===e.hexGmailThreadId){this._boxSidebarViewController.getFirstFocusable().focus()}}});e.DependencyManager.addFunction({functionKey:"boxSidebarMasterControllerInitialized",functionReference:function(){a.inboxSDK.Conversations.registerThreadViewHandler(function(e){new u(e)})},dependentFunctionKeys:["gmailLoaded"]});l.Controllers.BoxSidebarMasterController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u=e.Class.subclass({className:"ReminderSidebarController",superclass:e.Object,_memberVariables:[{name:"_sidebarInjector",destroy:true},{name:"_sidebarOptions",destroy:false},{name:"_boxSidebarViewController",destroy:true},{name:"_boxKey",destroy:false}],_initialize:function(e){this._sidebarOptions={title:l.Locale.getString("reminder_box_tab_title"),iconClass:"streak__sidebar_reminderIcon",el:document.createElement("div"),orderHint:2};this._sidebarInjector=new l.Controllers.SidebarInjector(e,{notificationCenterEventName:"threadStorerDataChanged",notificationCenterFilterValueType:"reminderBoxKey",checkState:this._handleReminderBoxKeySet.bind(this),destroy:this.destroy.bind(this)})},_handleReminderBoxKeySet:function(e,t){var n;if(t){n=t.value}else{n=l.Services.Threads.ThreadStorer.getReminderBoxKey(e)}this._loadBoxSidebar(n)},_loadBoxSidebar:function(e){if(e===this._boxKey){return}this._boxKey=e;var t;if(e){t=l.Data.getBox(e)}if(!t){this._removeSidebar()}else{if(this._boxSidebarViewController){this._boxSidebarViewController.destroy()}this._boxSidebarViewController=l.Modules.ConversationSidebar.BoxSidebar.create({box:t,keyboardTabs:true,clearIDAttributeOfMainElement:false});this._sidebarOptions.el.appendChild(this._boxSidebarViewController.getElement()[0]);this._sidebarInjector.addSidebar(this._sidebarOptions)}},_removeSidebar:function(){if(this._boxSidebarViewController){this._boxSidebarViewController.destroy();this._boxSidebarViewController=null}this._sidebarInjector.removeSidebar()}});e.DependencyManager.addFunction({functionKey:"remindersSidebarControllerInitialized",functionReference:function(){a.inboxSDK.Conversations.registerThreadViewHandler(function(e){new u(e)})},dependentFunctionKeys:["gmailLoaded"]})})(Streak);Streak.BentoBox.Modules.ConversationSidebar={};(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Library,o=e.BentoBox.Locale,s=e.BentoBox;var l=s.Modules.ConversationSidebar;var u={widgetContext:"ConversationSidebar.BoxSidebar"};var c=function(e,t){s.Tracker.trackStreakActive(u,t,{eventName:e})};l.BoxSidebar={defaults:{box:null,keyboardTabs:true,blur:function(){if(document.activeElement){document.activeElement.blur()}},trackingContext:null,clearIDAttributeOfMainElement:true},create:function(e){var t={};n.extend(t,l.BoxSidebar.defaults,e);return new l.BoxSidebar.impl(t)}};l.BoxSidebar.impl=function(t){if(!t.box||!t.box.getPipeline){return}l.templates={};l.templates.normal=e.HTML.get("ConversationSidebar");l.templates.field=e.HTML.get("ConversationSidebarField");this.options=t;this.box=this.options.box;this.pipeline=this.box.getPipeline();this.hexGmailThreadId=t.hexGmailThreadId;this.el=null;this.stages=null;this.notesArea=null;this.assignedTo=null;this.reminderSection=null;this.reminderList=null;this.followerSection=null;this.linkedBoxesSection=null;this.followers=null;this.columnOrder=null;this.columnVisibility=null;this._simpleBoxesMenu=null;this._linkedBoxesInner=null;this.uniq=Date.now()+"."+Math.random();this.inputs=[];this.tabFocusController=new s.Widgets.TabFocusController;this.setup()};n.extend(l.BoxSidebar.impl.prototype,{getElement:function(){return this.el},setup:function(){this.el=t(l.templates.normal({boxName:this.box.displayNameText(),pipelineName:this.pipeline.displayNameText()}));if(this.options.clearIDAttributeOfMainElement){this.el.attr("id","")}this.columnOrder=s.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(this.pipeline).data;this.columnVisibility=s.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.load(this.pipeline).data;this.renderHeading();this.renderStages();this.renderAssignedTo();this.renderFields();this.renderReminders();this.renderEmailFilters();this.renderEmailFilterSuggestions();this.renderFollowers();this.renderLinkedBoxes();this.bindEvents();this.setupTabArray()},destroy:function(){this.tabFocusController.destroy();for(var t=0;t<this.inputs.length;t++){if(this.inputs[t]&&this.inputs[t].destroy){this.inputs[t].destroy()}}e.NotificationCenter.unsubscribe({observer:this});this.followers.destroy();this.reminderList.destroy();this._emailFilter.destroy();this.el.remove()},renderHeading:function(){var e=this;this.el.find(".boxLink").click(function(t){c("boxLinkClicked");t.preventDefault();i.inboxSDK.Router.goto(e.box.link())});this.el.find(".pipelineLink").click(function(t){c("pipelineLinkClicked",{source:"sidebar"});t.preventDefault();i.inboxSDK.Router.goto(e.pipeline.link())});this.notesArea=s.Widgets.SmartTextarea.create({model:this.box,property:"notes",borderOnHover:false,trackingContext:n.clone(u)});this.notesArea.setEnabled(s.Services.AccessManager.isAccessAllowed(this.pipeline,"Box","UPDATE"));this.el.find(".boxNotes").append(this.notesArea.el);this.inputs.push(this.notesArea)},renderStages:function(){this.stages=s.Widgets.StageButton.create({pipeline:this.pipeline,box:this.box,trackingContext:n.clone(u)});this.el.find(".stageButton").append(this.stages.el);this.inputs.push(this.stages)},renderAssignedTo:function(){var e=this.el.find(".assignedTo");this.el.find(".assignedTo *").trigger("unbind");e.empty();e.hide();var i=this.pipeline.getSystemColumnByProperty("assignedToSharingEntries");if(n.isNotReal(i)){return}assignedTo=s.Widgets.SidebarAssignedTo.create({box:this.box,pipeline:this.pipeline,border:"never",persist:true,imgHeight:23,imgWidth:23,includeNames:true,delayedBind:true});assignedTo.setEnabled(this._permissionToEditFields());var r=t(l.templates.field({name:s.Locale.getString("assignedTo")}));r.find(".fieldValue").append(assignedTo.el);this.inputs.push(assignedTo);e.append(r);e.show();this.assignedTo=assignedTo},renderFields:function(){var e=s.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(this.pipeline);this.el.find(".boxFields *").trigger("unbind");this.el.find(".boxFields").empty();for(var t=0;t<this.columnOrder.length;t++){var n=this.columnOrder[t];if(e[n].field){var i=this.renderField(e[n].field.key());this.el.find(".boxFields").append(i)}}},renderField:function(e){var n=this.pipeline.getField(e);var i=t(l.templates.field({name:n.displayNameText()}));var r=s.Models.BoxField.getSidebarInputWidget(this.box,n,i.find(".fieldValue"),{widgetContext:"boxSidebar"});if(!r){return}r.setEnabled(this._permissionToEditFields());var a=r.getElement?r.getElement():r.el;i.find(".fieldValue").append(a);this.inputs.push(r);n.watch("set",function(){if(i.is(":inBody")){i.find(".fieldName").text(n.displayName())}else{return true}},this,"name");return i},renderReminders:function(){var e=this;var t=s.Locale.getString("reminders_title");if(this.box.get("reminderKeys")&&this.box.get("reminderKeys").length>0){t+=" ("+this.box.get("reminderKeys").length+")"
}this.reminderList=s.Widgets.ReminderList.create({box:this.box,pipeline:this.pipeline,showTitle:false,useLinkButtonForNewReminder:true,trackingContext:n.clone(u)});this.reminderSection=s.Widgets.CollapseSection.create({title:t,bodyEl:this.reminderList.el,startOpen:false,localToggleStateKey:"boxSidebar/remindersSection"});this.el.find(".reminders").empty().append(this.reminderSection.el);this.inputs.push(this.reminderList);var i=this.reminderList.getNewReminderButtonElement();i.addClass("reminderList");this.reminderSection.addToRightOfTitle(i)},updateReminderTitle:function(){title=s.Locale.getString("reminders_title");var e=s.Data.getReminderCollection(this.box.key()).length;if(e>0){title+=" ("+e+")"}this.reminderSection.updateTitle(title)},renderFollowers:function(){this.followers=s.Widgets.FollowerButton.create({box:this.box,trackingContext:n.clone(u)});this.el.find(".boxFollowers").append(this.followers.el);this.inputs.push(this.followers)},renderEmailFilters:function(){if(!this._emailFilter){this._emailFilter=new s.Modules.EmailFilters.EmailFilterViewController({boxKey:this.box.key(),useLinkButtonForNewFilter:true,showTitle:false});if(this._emailFilterCollection){this._emailFilter.setEmailFilters(this._emailFilterCollection)}if(this._emailFilterBlacklistCollection){this._emailFilter.setEmailFilterBlacklists(this._emailFilterBlacklistCollection)}}if(!this._emailFiltersSection){this._emailFiltersSection=s.Widgets.CollapseSection.create({title:s.Locale.getString("email_filters"),bodyEl:this._emailFilter.getElement(),startOpen:true,localToggleStateKey:"boxSidebar/emailFiltersSection"});var e=this._emailFilter.getNewEmailFilterButtonElement();this._emailFiltersSection.addToRightOfTitle(e)}if(!this._emailFilterCollection){this._updateEmailFilterCollection()}this.el.find(".streak__emailFiltersOuter").html(this._emailFiltersSection.el)},_updateEmailFilterCollection:function(){this._emailFilterCollection=s.Data.getEmailFilterCollection(this.box.key());this._emailFilter.setEmailFilters(this._emailFilterCollection);this._emailFilterCollection.refresh();this._emailFilterCollection.watch("collectionChange",this._emailFilterCollectionUpdated.bind(this),this);this._emailFilterCollectionUpdated()},_updateEmailFilterBlacklistCollection:function(){this._emailFilterBlacklistCollection=s.Data.getEmailFilterBlacklistCollection(this.box.key());this._emailFilterBlacklistCollection.refresh();this._emailFilter.setEmailFilterBlacklists(this._emailFilterBlacklistCollection);this._emailFilterBlacklistCollection.watch("collectionChange",this._emailFilterBlacklistCollectionUpdated.bind(this),this);this._emailFilterBlacklistCollectionUpdated()},_emailFilterCollectionUpdated:function(){if(this._emailFilterCollection&&this._emailFilterBlacklistCollection){this.updateEmailFilterSuggestions()}},_emailFilterBlacklistCollectionUpdated:function(){if(this._emailFilterCollection&&this._emailFilterBlacklistCollection){this.updateEmailFilterSuggestions()}},renderEmailFilterSuggestions:function(){if(!this._emailFilterBlacklistCollection){this._updateEmailFilterBlacklistCollection()}var t=this;e.NotificationCenter.subscribe({eventName:"boxAndGmailThreadCreated",filterParameters:{hexGmailThreadId:this.hexGmailThreadId},functionToCall:function(){t._boxCreated=true;t.updateEmailFilterSuggestions()},observer:this})},createEmailFilter:function(e){var t=a.get("BentoBox.Services.EmailFilterLimiter");if(t.isLocked()){t.showGateway()}else{var n=s.Models.EmailFilter.create({type:"EMAIL_ADDRESS_FILTER",value:e,boxKey:this.box.key()});n.save();this._emailFilterCollection.add(n);t.incrementUsage()}},createDomainFilter:function(e){var t=a.get("BentoBox.Services.EmailFilterLimiter");if(t.isLocked()){t.showGateway()}else{var n=s.Models.EmailFilter.create({type:"DOMAIN_FILTER",value:e,boxKey:this.box.key()});n.save();this._emailFilterCollection.add(n);t.incrementUsage()}},blacklistEmailAddress:function(e){var t=s.Models.EmailFilterBlacklist.create({blacklistEmail:e});t.save();this._emailFilterBlacklistCollection.add(t)},getEmailAddressesInGmailThread:function(){var e=s.Services.Threads.ThreadStorer.getThreadMetaData(this.hexGmailThreadId);if(e){return e.emailAddresses}else{return[]}},shouldShowEmailSuggestions:function(){if(!this._boxCreated){return false}if(this._suggestionsHidden){return false}var e=this._shouldShowEmailSuggestionsIfBoxCreated();this._suggestionsHidden=!e;return e},setRelatedBoxesView:function(e){this.el.find(".relatedBoxes").show();this.el.find(".relatedBoxes").append(e.getElement())},_shouldShowEmailSuggestionsIfBoxCreated:function(){var e=this.getEmailAddressesInGmailThread();var t=this._emailFilterCollection,i=this._emailFilterBlacklistCollection;if(n.some(e,function(e){return n.some(t,function(t){return t.matches(e)})})){return false}var r=n.filter(e,function(e){return!n.some(i,function(t){return t.matches(e)})});r.removeVal(s.getUser().getEmail());if(r.length==0){this._emailFilterSuggestedEmail=null;this._emailFilterSuggestedDomain=null;return false}else{this._emailFilterSuggestedEmail=r[0];this._emailFilterSuggestedDomain=r[0].split("@")[1];return true}},updateEmailFilterSuggestions:function(){var e=this.shouldShowEmailSuggestions();if(e&&!this._emailFilterSuggestions){this._setupEmailFilterSuggestions()}else if(e&&this._emailFilterSuggestions&&this._emailFilterSuggestions.is(":hidden")){this._emailFilterSuggestions.show()}else if(!e&&this._emailFilterSuggestions&&this._emailFilterSuggestions.is(":visible")){this._emailFilterSuggestions.hide()}},_setupEmailFilterSuggestions:function(){this._emailFilterSuggestions=t(r.getElement("emailFilterSuggestions"));var e=s.Locale.getString("email_suggestion_one_email",{email:this._emailFilterSuggestedEmail});this._emailFilterSuggestions.find(".streak_emailFilter_email").html(e);var n=s.Locale.getString("email_suggestion_one_domain",{domain:this._emailFilterSuggestedDomain});this._emailFilterSuggestions.find(".streak_emailFilter_domain").html(n);var i=this;this._dontShowButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:s.Locale.getString("email_suggestion_dont_show_again"),onFunction:function(){i._dontShowClickedInSuggestions()}});this._dontShowButton.addClass("dontShowButton");this._createFilterSuggestionButton=s.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:s.Locale.getString("email_suggestion_create_filter"),color:"blue",css:{"margin-right":"0px"},onFunction:function(){i._createFilterClickedInSuggestions()}});this._createFilterSuggestionButton.addClass("createFilter");this._emailFilterSuggestions.find(".streak__emailFilterSuggestions_dont_show").html(this._dontShowButton.getElement());this._emailFilterSuggestions.find(".streak__emailFilterSuggestions_create_filter").html(this._createFilterSuggestionButton.getElement());this.el.find(".emailFilterSuggestions").html(this._emailFilterSuggestions)},_createFilterClickedInSuggestions:function(){var e=this._emailFilterSuggestions.find("input:radio:checked[name=emailFilterSuggestion]").val();if(e==="email"){this.createEmailFilter(this._emailFilterSuggestedEmail)}else if(e==="domain"){this.createDomainFilter(this._emailFilterSuggestedDomain)}this._emailFilterSuggestions.hide()},_dontShowClickedInSuggestions:function(){this.blacklistEmailAddress(this._emailFilterSuggestedEmail);this._emailFilterSuggestions.hide()},renderLinkedBoxes:function(){if(!this.linkedBoxesSection){this._setupLinkedBoxesSection()}var e=s.Locale.getString("linked_boxes");var t=this.box.get("linkedBoxKeys")?this.box.get("linkedBoxKeys").length:0;if(t>0){e+=" ("+t+")"}this.linkedBoxesSection.updateTitle(e);this._renderLinkedBoxes()},_setupLinkedBoxesSection:function(){this._linkedBoxesInner=t(document.createElement("div"));this._linkedBoxesInner.addClass("streak__linkedBoxes");this._linkedBoxesList=t(document.createElement("div"));this._linkedBoxesList.addClass("streak__linkedBoxes_list");this._linkedBoxesInner.append(this._linkedBoxesList);var n=this;this._simpleBoxesMenu=e.Library.getInstance("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuViewController");this._simpleBoxesMenu.addDelegate({boxChosen:function(e){n.box.addLinkedBox(e);n.el.find(".linkedBoxes").scrollintoview()},emptyPressed:function(){n.options.blur()}});this._simpleBoxesMenu.setEnabled(s.Services.AccessManager.isAccessAllowed(this.pipeline,"Box","UPDATE"));this.inputs.push(this._simpleBoxesMenu);this._linkedBoxesInner.append(this._simpleBoxesMenu.getView().getElement());this.linkedBoxesSection=s.Widgets.CollapseSection.create({title:s.Locale.getString("linked_boxes"),bodyEl:this._linkedBoxesInner,startOpen:false,localToggleStateKey:"boxSidebar/linkedBoxesSection"});this.el.find(".linkedBoxes").append(this.linkedBoxesSection.el)},_renderLinkedBoxes:function(){var e=this.box.get("linkedBoxKeys");var t;var i=0;this._linkedBoxesList.empty();var r=this;n.chain(e).map(function(e){var t=s.Data.getBox(e);if(t){return t}i+=1}).compact().sortBy(function(e){return e.get("lastUpdatedTimestamp")}).sortBy(function(e){return e.displayName()}).sortBy(function(e){var t=e.getPipeline().get("stageOrder");return t.indexOf(e.get("stageKey"))}).groupBy(function(e){return e.getPipeline().key()}).tap(function(e){t=e}).keys().map(function(e){return s.Data.getPipeline(e)}).sortBy(function(e){return e.displayName()}).each(function(e){r._renderLinkedBoxSection(e,t[e.key()])});this._simpleBoxesMenu.setExcludedBoxKeys(e.concat([this.box.key()]))},_renderLinkedBoxSection:function(e,n){var i=t(r.get("boxSidebarLinkedBoxes")({pipelineName:e.displayNameText()}));var a=i.find("ul");for(var o=0;o<n.length;o++){var s=this._renderLinkedBox(n[o],e.getColor());a.append(s)}this._linkedBoxesList.append(i)},_renderLinkedBox:function(e,n){var a=t(r.get("boxSidebarLinkedBox")({boxName:e.displayNameText()}));a.on("click",function(t){i.inboxSDK.Router.goto(e.link())});var o=this;var l=a.find(".ar9");l.click(function(t){var n=o.box.get("linkedBoxKeys")||[];n.removeVal(e.key());o.box.set("linkedBoxKeys",n);o.box.save();n=e.get("linkedBoxKeys")||[];n.removeVal(o.box.key());e.set("linkedBoxKeys",n);e.save();t.stopPropagation()});if(!s.Services.AccessManager.isAccessAllowed(this.box.getPipeline(),"Box","UPDATE")){l.remove()}return a},bindEvents:function(){var e=this;var t=this;this.pipeline.watch("set",function(){if(e.el&&e.el.find(".pipelineLink").length>0){e.el.find(".pipelineLink").text(e.pipeline.displayName())}else{return true}},t,"name");this.box.watch("set",function(){if(e.el&&e.el.find(".boxLink").length>0){e.el.find(".boxLink").text(e.box.displayName())}else{return true}},t,"name");this.pipeline.watch("set",function(){e.renderFields();e.setupTabArray()},t,"fields");s.Data.getReminderCollection(this.box.key()).watch("collectionChange",function(){e.updateReminderTitle()},t);this.box.watch("set",function(){e.renderLinkedBoxes()},t,"linkedBoxKeys");s.Keyboard.bindChordToEl({el:this.el,chord:"escape",noDefault:true,noBubble:true,cb:function(){e.options.blur()}});this.el.bind("blurred",function(t){e.options.blur()})},setupTabArray:function(){if(!this.options.keyboardTabs){return}this.tabArray=[];this.tabArray.push(this.stages.el.find(".bbButton"));this.tabArray.push(this.notesArea.el);if(this.assignedTo){this.tabArray.push(this.assignedTo.el)}var e=this.el.find(".boxFields .smartInput");for(var n=0;n<e.length;n++){this.tabArray.push(t(e[n]))}this.tabArray.push(this.reminderList.getFocusElement());if(this.linkedBoxesSection){this.tabArray.push(this._simpleBoxesMenu.getFocusElement())}this.tabArray.push(null);this.tabFocusController.addElements(this.tabArray)},_permissionToEditFields:function(){return s.Services.AccessManager.arePermissionsAllowed(this.pipeline,[{entityType:"Box",action:"UPDATE"},{entityType:"FieldBox",action:"UPDATE"}])},getFirstFocusable:function(){return this.stages.el.find(".bbButton")},getLastFocusable:function(){return this.tabArray.last(2).first()}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u={_threadTask:null,_currentGmailThread:null,init:function(){this._reset();e.NotificationCenter.subscribe({eventName:"threadStorerDataChanged",observer:this,filterParameters:{valueType:"gmailThread"},functionToCall:this._handleGmailThreadSet});a.observe("viewChanged",this._handleViewChanged.bind(this));a.observe("conversationThreadLoadedEvent",this._handleConversationLoaded.bind(this),null)},_reset:function(){if(this._threadTask){this._threadTask.destroy()}this._threadTask=null;this._currentGmailThread=null},_handleViewChanged:function(){if(!a.isConversation()){this._reset()}},_handleConversationLoaded:function(){var e=a.getActiveHexGmailThreadIdList(l.Services.Threads.HexGmailThreadIdExtractor);if(e.length===0){return}var t=l.Services.Threads.ThreadStorer.getGmailThread(e[0]);if(t){this._loadThreadTask(t)}else{this._reset()}},_handleGmailThreadSet:function(e){if(!a.isConversationVisible()){return}var t=a.getActiveHexGmailThreadIdList(l.Services.Threads.HexGmailThreadIdExtractor);if(t.length===0){return}if(e.hexGmailThreadId!==t[0]){return}if(e.value){var n=e.value;if(n){this._loadThreadTask(n);return}}this._reset()},_loadThreadTask:function(e){if(this._currentGmailThread&&e&&e.key()===this._currentGmailThread.key()){return}this._reset();this._currentGmailThread=e;this._threadTask=l.Widgets.ThreadTask.create({gmailThread:e,trackingContext:{widgetContext:"conversationTaskThreadController"}});a.getConversationSubjectHeader().append(this._threadTask.el)}};e.DependencyManager.addFunction({functionKey:"conversationTaskThreadMasterControllerInitialized",functionReference:u.init,functionContext:u});l.Controllers.ConversationTaskThreadMasterController=u})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.HTML,a=e.BentoBox,o=e.UI;var s=o.View;var l=e.Class.subclass({className:"ThingsView",superclass:s,_memberVariables:[{name:"_things",destroy:false,defaultValue:[]},{name:"_isLoading",destroy:false,defaultValue:true},{name:"_isEmpty",destroy:false,defaultValue:true},{name:"_openDropdown",destroy:true}],_initialize:function(){s.prototype._initialize.call(this);this._list=this._element.find(".streak_things_list");this._loading=this._element.find(".streak_things_loading")},_setupElement:function(){this._element=r.getElement("things_section")},setAddButton:function(e){this._element.find(".streak_things_add_btn").html(e)},setFilterButton:function(e){this._element.find(".streak_things_type_filter").html(e)},setSortButtons:function(e){var t=this._element.find(".streak_things_sort_buttons").empty();n.each(e,function(e,n){if(n!=0){t.append(" | ")}t.append(e.getElement())})},setThings:function(e,t,n){this._things=e;this._isLoading=t;this._isEmpty=n;this._renderThings()},makeDropdown:function(e,n){if(this._openDropdown){this._openDropdown.destroy();delete this._openDropdown}var i=(e.getView?e.getView():e).getElement();var r=e.destroy?e.destroy.bind(e):t.noop;var a=t(n).offset();var o=this.getElement().offset();var s=a.top+t(n).height();var l=a.left+t(n).width();var u=o.left+this.getElement().outerWidth();var c=t("<div/>").addClass("streak__dropdown").css({position:"absolute",top:s-o.top,right:u-l}).html(i).appendTo(this.getElement());var d=this._openDropdown={destroy:function(){c.unbindBodyCloseAndStop();c.remove();r()}};c.bodyCloseAndStop({body:document.body,stop:c,closeFunction:d.destroy.bind(d)});if(e.addDelegate){e.addDelegate({close:d.destroy.bind(d)})}if(e.onShow){e.onShow()}},_renderThings:function(){this._list.empty();var i=this;if(!this._isLoading&&!this._things.length){this._things=[{title:a.Locale.getString(this._isEmpty?"no_contents":"no_contents_match"),type:"NONE",extraCssClasses:["empty_entry"],typeName:a.Locale.getString("placeholder")}]}n.each(this._things,function(r,o){var s=t("<li/>").addClass("streak__thing_item").addClass("streak__thing_type_"+r.type.replace(/\s/g,"_"));n.each(r.extraCssClasses,function(e){s.addClass("streak__thing_extra_"+e.replace(/\s/g,"_"))});var l;if(r.linkFn){l=t("<a/>").attr("href",r.linkHref||"#").click(function(e){e.preventDefault();r.linkFn.call(r)})}else if(r.linkHref){l=t("<a/>").attr("href",r.linkHref)}else{l=t("<span/>")}var u=t("<span/>").attr("title",r.typeName).addClass("streak__thing_icon");if(r.iconURL){u.css({"background-image":"url("+r.iconURL.replace(/["'\\()]/g,"\\$&")+")","background-size":"16px"})}l.addClass("streak__thing_main").appendTo(s).append(u," ");var c=t("<span/>").addClass("streak__thing_title").appendTo(l);if(r.titleHTML){c.html(r.titleHTML)}else{c.addClass("streak__thing_title_text").text(r.title)}if(r.detail||r.detailHTML){var d=t("<span/>").addClass("streak__thing_detail");if(r.detailHTML){d.html(r.detailHTML)}else{d.text(r.detail)}l.append(" ",d)}var h=t("<span/>").addClass("streak__thing_right").appendTo(s);var f=t("<span/>").addClass("streak__thing_actions").appendTo(h);n.each(r.actions,function(e){var n=t(e.disabled?"<span/>":"<a/>").addClass("streak_thing_action").text(e.title).attr("href","#").click(function(t){t.preventDefault();if(!e.disabled){var n=e.fn.call(r);if(e.dropdown){i.makeDropdown(n,this)}}});if(e.disabled){n.addClass("streak__disabled").attr("title",a.Locale.getString("no_permission_for_action"))}f.append(" ",t("<span/>").addClass("streak__thing_right_item").append(n))});if(r.date){h.append(" ",t("<span/>").addClass("streak__thing_right_item").addClass("streak__thing_date").text(new e.Date(r.date).getGmailFormatted()))}i._list.append(s)});this._loading.toggle(this._isLoading)},hide:function(){this._element.hide()}});i.set("BentoBox.Modules.BoxView.ThingsView",l)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Gmail,r=e.Library,a=e.Locale,o=e.UI,s=e.BentoBox,l=e.Utils,u=s.Tracker;var c=o.ViewController;var d=e.Class.subclass({className:"ThingsViewController",superclass:c,_memberVariables:[{name:"_providers",destroy:true,defaultValue:[]},{name:"_thingTypes",destroy:false,defaultValue:{}},{name:"_thingsByType",destroy:false,defaultValue:{}},{name:"_rememberedThingPositions",destroy:false},{name:"_addButtonMenu",destroy:true},{name:"_addMenu",destroy:true},{name:"_filterMenu",destroy:true},{name:"_filterButtonMenu",destroy:true},{name:"_sortButtons",destroy:true},{name:"_filterAllMenuItem",destroy:false}],_initialize:function(e){c.prototype._initialize.call(this);var t=this;this._addMenu=s.Widgets.Menu.create();this._addButtonMenu=s.Widgets.ButtonMenu.create({menu:this._addMenu.getElement(),buttonInner:s.Locale.getString("add_to_box"),showButtonArrow:false,rightAligned:true,dynamicPosition:true,color:"red"});this._view.setAddButton(this._addButtonMenu.getElement());this._filterMenu=s.Widgets.Menu.create();this._filterButtonMenu=s.Widgets.ButtonMenu.create({buttonInner:n.escape(s.Locale.getString("view_filter")),menu:this._filterMenu.getElement(),dynamicPosition:true,closeOnSelect:false});this._view.setFilterButton(this._filterButtonMenu.getElement());this._sortButtons={type:s.Widgets.LinkButton.create({text:n.escape(s.Locale.getString("fields_button_modal_type")),clickFunction:this._setSortMode.bind(this,"type")}),date:s.Widgets.LinkButton.create({text:n.escape(s.Locale.getString("column_type_date")),clickFunction:this._setSortMode.bind(this,"date")})};this._view.setSortButtons([this._sortButtons["type"],this._sortButtons["date"]]);this._setSortMode("type");n.each(d._providerClasses,function(n){var i=new n(e);t._providers.push(i);t._defineType(i);i.addDelegate({setThings:t._setThingsForType.bind(t,i.getType())});i.run(e)})},_setupView:function(){this._view=r.getInstance("BentoBox.Modules.BoxView.ThingsView")},_defineType:function(e){var t={type:e.getType(),name:e.getName(),orderHint:e.getOrderHint(),adder:e.adder?e.adder.bind(e):null,adderIsDropdown:e.getAdderIsDropdown()};if(n.has(this._thingTypes,t.type)){throw new Error("Things type "+t.type+" was already defined")}if(typeof t.name!="string"){throw new Error("Type must have a name set")}t.shouldDisplayItems=true;this._thingTypes[t.type]=t;this._loadFilterSettings();this._setupFiltersMenu();this._setupAddersMenu();n.defer(this._render.bind(this))},_setupAddersMenu:function(){this._addMenu.empty();var e=this;n.each(n.sortBy(n.filter(this._thingTypes,function(e){return!!e.adder}),"orderHint"),function(t){e._addMenu.addItem(t.name,function(n){var i=t.adder();if(t.adderIsDropdown){e._view.makeDropdown(i,e._addButtonMenu.getElement())}})})},_setupFiltersMenu:function(){this._filterMenu.empty();var e=this;var t=n.every(this._thingTypes,function(e){return e.shouldDisplayItems===true});this._filterAllMenuItem=this._filterMenu.addCheckItem(n.escape(s.Locale.getString("feed_all_updates")),this._setAllFilter.bind(this),t);this._filterMenu.addSeparator();n.each(n.sortBy(this._thingTypes,"orderHint"),function(t){t._filterMenuItem=e._filterMenu.addCheckItem(n.escape(t.name),e._setTypeFilter.bind(e,t.type),t.shouldDisplayItems)})},_setAllFilter:function(e){n.each(this._thingTypes,function(t){t.shouldDisplayItems=e;t._filterMenuItem.setCheckboxState(e)});delete this._rememberedThingPositions;this._saveFilterSettings();this._render()},_setTypeFilter:function(e,t){this._thingTypes[e].shouldDisplayItems=t;var i=n.every(this._thingTypes,function(e){return e.shouldDisplayItems===t});this._filterAllMenuItem.setCheckboxState(i?t:null);delete this._rememberedThingPositions;this._saveFilterSettings();this._render()},_setThingsForType:function(e,t){if(!this._thingTypes){return}if(!n.has(this._thingTypes,e)){throw new Error("Tried to set things with unknown type "+e)}if(!n.isArray(t)){throw new Error("Things must be an array")}t=n.clone(t);var i=this;n.each(t,function(t){if(t.type==null){t.type=e}else if(t.type!==e){throw new Error("Thing with type "+t.type+" was expected to be type "+e)}t.typeName=i._thingTypes[e].name;if(t.title==null&&t.titleHTML==null){throw new Error("Thing is missing title")}if(t.key==null){throw new Error("Thing is missing key")}t.key+="";if(!n.isArray(t.actions)){throw new Error("Thing is missing actions")}});this._thingsByType[e]=t;n.defer(this._render.bind(this))},_setSortMode:function(e){this._setupSorting(e);n.defer(this._render.bind(this));n.each(n.without(n.toArray(this._sortButtons),this._sortButtons[e]),function(e){e.getElement().removeClass("selected")});this._sortButtons[e].getElement().addClass("selected")},_setupSorting:function(e){var t=this;delete this._rememberedThingPositions;var n=l.makeComparisonByFn(function(e){return t._thingTypes[e.type].orderHint});var i=l.reverseComparisonFn(l.makeComparisonByFn(function(e){return e.orderHint||e.date}));var r=l.makeComparisonByFn("title");var a=l.makeComparisonByFn("key");var o;if(e=="type"){o=[n,i,r,a]}else{o=[i,r,n,a]}this._thingCompare=l.combineComparisonFns(o)},_render:n.throttle(function(){if(!this._view){return}var e=this;var t=n.keys(this._thingTypes).length!==n.keys(this._thingsByType).length;var i=Array.prototype.concat.apply([],n.values(this._thingsByType));var r=i.length==0;var a=n.filter(i,function(t){return e._thingTypes[t.type].shouldDisplayItems});if(t){delete this._rememberedThingPositions}else{var o=[];n.each(this._rememberedThingPositions,function(e){for(var t=0;t<a.length;t++){if(a[t].key===e){o.push(a[t]);a.splice(t,1);break}}})}a.sort(this._thingCompare);if(o){a=o.concat(a);this._rememberedThingPositions=n.compact(n.pluck(a,"key"))}this._view.setThings(a,t,r)},100),setEnabled:function(e){this._addButtonMenu.setEnabled(e)},_saveFilterSettings:function(){var e={};n.each(this._thingTypes,function(t,n){e[n]=t.shouldDisplayItems});s.LocalSettings.set("boxView/thingsViewController/filterSettings",e)},_loadFilterSettings:function(){if(!this._thingTypes){return}var e=s.LocalSettings.get("boxView/thingsViewController/filterSettings");if(!e){return}n.each(this._thingTypes,function(t,i){var r=e[i];if(n.isReal(r)){t.shouldDisplayItems=r}})},destroy:function(){c.prototype.destroy.apply(this,arguments)}});d._providerClasses=[];d.registerProviderClass=function(e){this._providerClasses.push(e)};r.set("BentoBox.Modules.BoxView.ThingsViewController",d)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Gmail,r=e.Library,a=e.Locale,o=e.NotificationCenter,s=e.UI,l=e.BentoBox;var u=s.Delegator;var c=e.Class.subclass({className:"CollectionThingProviderBase",superclass:u,_memberVariables:[{name:"_box",destroy:false},{name:"_collection",destroy:false},{name:"_thingsHandle",destroy:false}],getType:function(){throw new Error("Not implemented")},getName:function(){throw new Error("Not implemented")},getOrderHint:function(){throw new Error("Not implemented")},adder:null,getAdderIsDropdown:function(){return false},_getCollection:function(){throw new Error("Not implemented")},_collectionFilter:function(e){return true},_createThing:function(e){throw new Error("Not implemented")},run:function(e){this._box=e;this._collection=this._getCollection();var t=n.throttle(this._updateThings.bind(this),100);this._collection.watch("change",t,this);this._updateThings();this._collection.refresh(t)},_updateThings:function(){if(!this._box||!this._collection.getHasLoaded()){return}var e=this;var t=n.filter(this._collection,this._collectionFilter.bind(this));this._callDelegateFunction("setThings",n.map(t,this._createThing.bind(this)))},destroy:function(){o.unsubscribe({observer:this});u.prototype.destroy.apply(this,arguments)}});r.set("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase",c)})(Streak);(function(e){"use strict";var t=e._,n=e.Library,i=e.Locale,r=e.Gmail,a=e.BentoBox;var o=n.get("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase");var s=e.Class.subclass({className:"EmailThingProvider",superclass:o,_memberVariables:[],_getCollection:function(){return a.Data.getGmailThreadCollectionForBox(this._box.key())},getType:function(){return"EMAIL"},getName:function(){return a.Locale.getString("email")},getOrderHint:function(){return 1},_collectionFilter:function(e){var t=e.get("taskStatus");return!(t=="NOT_DONE_TASK"||t=="DONE_TASK")},_createThing:function(e){var t=this;var n=e.get("lastEmailTimestamp")||e.get("lastUpdatedTimestamp");var i=n?new Date(n):null;var o=this._box.getPipeline();var s={title:e.get("subject"),key:e.key(),detail:(e.get("names")||["Unknown"]).join(", "),date:i,linkHref:"#"+e.link(),linkFn:function(){if(a.isFeatureEnabled("alwaysUnified")){r.inboxSDK.Router.goto(e.link());return}if(e.get("isRequestingUserOwner")){a.UI.goToThread(e.get("threadGmailId"))}else if(e.get("doesRequestingUserHaveThread")){a.UI.goToThread(e.get("requestingUserThreadGmailId"))}else{r.inboxSDK.Router.goto(e.link())}a.Tracker.trackStreakActive({eventName:"emailLinkClicked"})},actions:[{title:a.Locale.getString("make_task"),fn:function(){e.set("taskStatus","NOT_DONE_TASK");e.save()},disabled:!a.Services.AccessManager.isAccessAllowed(o,"GmailThread","UPDATE")},{title:a.Locale.getString("remove_from_box"),fn:function(){e.del()},disabled:!a.Services.AccessManager.isAccessAllowed(o,"GmailThread","DELETE")}]};return s}});n.set("BentoBox.Modules.BoxView.ThingProviders.EmailThingProvider",s);n.get("BentoBox.Modules.BoxView.ThingsViewController").registerProviderClass(s)})(Streak);(function(e){"use strict";var t=e._,n=e.Library,i=e.BentoBox;var r=n.get("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase");var a=e.Class.subclass({className:"ReminderThingProvider",superclass:r,_memberVariables:[],_getCollection:function(){return i.Data.getReminderCollection(this._box.key())},getType:function(){return"REMINDER"},getName:function(){return i.Locale.getString("reminder")},getOrderHint:function(){return 4},_createThing:function(r){var a=[];if(r.get("status")==="REMINDED"){a.push("passed")}var o=t.compact([r.get("message"),new e.Date(r.get("remindDate")).customFormat("shortWithWeekday"),r.get("remindFollowers")?i.Locale.getString("remind_followers"):null]);if(o.length===0)throw new Error("Reminder._createThing is missing all data");var s=o[0];var l=o.slice(1).join(" - ");var u=this._box.getPipeline();var c={title:s,key:r.key(),detail:l,orderHint:r.get("remindDate"),date:null,extraCssClasses:a,actions:[{title:i.Locale.getString("edit_button"),fn:function(){i.Tracker.track("contents.reminder.edit",{reminder:r.key()});var e=n.getInstance("BentoBox.Widgets.ReminderMenuViewController",{reminder:r});return e.getViewControllerForMenu()},dropdown:true,disabled:!i.Services.AccessManager.isAccessAllowed(u,"Reminder","UPDATE")},{title:i.Locale.getString("remove_from_box"),fn:function(){i.Tracker.track("contents.reminder.delete",{reminder:r.key()});r.del()},disabled:!i.Services.AccessManager.isAccessAllowed(u,"Reminder","DELETE")}]};return c},getAdderIsDropdown:function(){return true},adder:function(){i.Tracker.track("contents.reminder.add",{boxKey:this._box.key()});var e=n.getInstance("BentoBox.Widgets.ReminderMenuViewController",{boxKey:this._box.key()});return e.getViewControllerForMenu()}});n.set("BentoBox.Modules.BoxView.ThingProviders.ReminderThingProvider",a);n.get("BentoBox.Modules.BoxView.ThingsViewController").registerProviderClass(a)})(Streak);(function(e){"use strict";var t=e._,n=e.Library,i=e.Locale,r=e.BentoBox;var a=n.get("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase");var o=e.Class.subclass({className:"TaskThingProvider",superclass:a,_memberVariables:[],_getCollection:function(){return r.Data.getGmailThreadCollectionForBox(this._box.key())},getType:function(){return"TASK"},getName:function(){return r.Locale.getString("task")},getOrderHint:function(){return 2},_collectionFilter:function(e){var t=e.get("taskStatus");return t=="NOT_DONE_TASK"||t=="DONE_TASK"},_createThing:function(e){var n=this;var i=Math.max(e.get("lastUpdatedTimestamp")||null,e.get("lastEmailTimestamp")||null);var a=i?new Date(i):null;var o=[];var s=this._box.getPipeline();var l=[{title:r.Locale.getString("make_email"),fn:function(){e.set("taskStatus","NOT_A_TASK");e.save()}}];if(e.get("taskStatus")=="DONE_TASK"){o.push("task_done");l.unshift({title:r.Locale.getString("mark_incomplete"),fn:function(){e.set("taskStatus","NOT_DONE_TASK");e.save()}})}else{l.unshift({title:r.Locale.getString("mark_complete"),fn:function(){e.set("taskStatus","DONE_TASK");e.save()}})}t.each(l,function(e){e.disabled=!r.Services.AccessManager.isAccessAllowed(s,"GmailThread","UPDATE")});var u={title:e.get("subject"),key:e.key(),detail:(e.get("names")||["Unknown"]).join(", "),date:a,linkHref:"#"+e.link(),linkFn:function(){if(e.get("isRequestingUserOwner")){r.UI.goToThread(e.get("threadGmailId"))}else if(e.get("doesRequestingUserHaveThread")){r.UI.goToThread(e.get("requestingUserThreadGmailId"))}else{Gmail.inboxSDK.Router.goto(e.link())}},extraCssClasses:o,actions:l};return u}});n.set("BentoBox.Modules.BoxView.ThingProviders.TaskThingProvider",o);n.get("BentoBox.Modules.BoxView.ThingsViewController").registerProviderClass(o)})(Streak);(function(e){"use strict";var t=e._,n=e.Library,i=e.Locale,r=e.BentoBox;var a=n.get("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase");var o=e.Class.subclass({className:"EmailFilterThingProvider",superclass:a,_memberVariables:[{name:"_emailFilterListViewController",destroy:true}],_getCollection:function(){if(!this._emailFilterListViewController){this._emailFilterListViewController=new r.Modules.EmailFilters.EmailFilterViewController({boxKey:this._box.key(),useLinkButtonForNewFilter:false,fetchInfoFromServer:true,suggestionsFromThread:false,modalFromButton:false,trackingContext:{widgetContext:"boxView"}});this._emailFilterListViewController.addDelegate(this)}return this._emailFilterListViewController.getEmailFilters()},getType:function(){return"EMAIL_FILTER"},getName:function(){return r.Locale.getString("email_filter")},getOrderHint:function(){return 10},_createThing:function(e){var t=this;var n=this._box.getPipeline();var i={titleHTML:e.filterDisplayHtml(),key:e.key(),actions:[{title:r.Locale.getString("remove"),fn:function(){r.Tracker.track("things.emailFilter.delete.clicked");t._emailFilterListViewController.removeFilter(e)},disabled:!r.Services.AccessManager.isAccessAllowed(n,"Box","UPDATE")}]};return i
},getAdderIsDropdown:function(){return true},adder:function(){r.Tracker.track("things.emailFilter.add.clicked");return this._emailFilterListViewController.showCreateFilterDialog()}});n.set("BentoBox.Modules.BoxView.ThingProviders.EmailFilterThingProvider",o);n.get("BentoBox.Modules.BoxView.ThingsViewController").registerProviderClass(o)})(Streak);(function(e){"use strict";var t=e._,n=e.Library,i=e.Locale,r=e.BentoBox;function a(e){if(e){if(e.match(/^audio\//)){return"sound"}else if(e.match(/^image\//)){return"image"}else if(e.match(/^application\/(msword|vnd\.openxmlformats-officedocument\.wordprocessingml\.document)/)){return"doc"}else if(e.match(/^application\/vnd\.(ms-excel|openxmlformats-officedocument\.spreadsheetml\.sheet)/)){return"xls"}else if(e.match(/^application\/vnd\.(ms-powerpoint|openxmlformats-officedocument\.presentationml)/)){return"ppt"}else if(e.match(/^application\/pdf/)){return"pdf"}}return null}var o=n.get("BentoBox.Modules.BoxView.ThingProviders.CollectionThingProviderBase");var s=e.Class.subclass({className:"FileThingProvider",superclass:o,_memberVariables:[{name:"_addDriveFileButton",destroy:true}],_getCollection:function(){return r.Data.getFileGroup(this._box.key())},getType:function(){return"FILE"},getName:function(){return r.Locale.getString("file")},getOrderHint:function(){return 3},_createThing:function(n){var i=this;var o=n.get("lastUpdatedTimestamp")||n.get("creationTimestamp");var s=o?new Date(o):null;var l=n.get("size")||n.get("size")===0?e.Utils.fileSizeFormat(+n.get("size")):null;var u=t.compact([a(n.get("mimeType"))]);var c=[];var d=this._box.getPipeline();if(n.get("fileType")==="DRIVE"){c.push({title:r.Locale.getString("remove_file"),fn:function(){n.del()},disabled:!r.Services.AccessManager.isAccessAllowed(d,"File","DELETE")})}var h={title:n.displayName(),key:n.key(),detail:l,extraCssClasses:u,iconURL:n.get("driveIconUrl")||null,date:s,linkHref:n.link(),actions:c};return h},adder:function(){if(!this._addDriveFileButton){this._addDriveFileButton=r.Widgets.DrivePickerButton.create({box:this._box,_fileCollection:this._collection})}this._addDriveFileButton.el.click()}});n.set("BentoBox.Modules.BoxView.ThingProviders.FileThingProvider",s);n.get("BentoBox.Modules.BoxView.ThingsViewController").registerProviderClass(s)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.HTML,a=e.BentoBox,o=e.UI;var s=e.Object;var l="apJ",u="apK";var c=e.Class.subclass({className:"ShowHideFeedButton",superclass:s,_memberVariables:[{name:"_toggleCallback",destroy:false},{name:"_trackingContext",destroy:false},{name:"_button",destroy:true}],_initialize:function(e){this._toggleCallback=e.toggleCallback;this._trackingContext=e.trackingContext;s.prototype._initialize.call(this);this._button=a.Widgets.Buttons.ButtonFactory.createToggleButton({type:"GmailTextIcon",iconClass:"apH apJ bbIcon",text:a.Locale.getString("newsfeed"),hasButtonToRight:false,tooltip:a.Locale.getString("toggle_newsfeed"),noDeactivation:true,isOn:e.startEnabled,onFunction:this._toggleFeed.bind(this,true),offFunction:this._toggleFeed.bind(this,false)});this._button.addClass("apF showHideFeedButton");if(e.css){this._button.getElement().css(e.css)}},getElement:function(){return this._button.getElement()},on:function(){this._button.on()},off:function(){this._button.off()},_styleButton:function(e){if(e){this._button.changeIconClass("apJ apH bbIcon")}else{this._button.changeIconClass("apK apH bbIcon")}},_toggleFeed:function(e){this._styleButton(e);this._toggleCallback(e)}});i.set("BentoBox.Modules.BoxView.ShowHideFeedButton",c)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxViewMasterController",superclass:e.Object,_memberVariables:[{name:"_activeBoxViewViewController",destroy:true},{name:"_activeBox",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);c.Keyboard.bindChord("w,tab",this._keyboardChordTriggered.bind(this));r.inboxSDK.Router.handleCustomRoute("box/:key",this._handleBoxView.bind(this))},_keyboardChordTriggered:function(){var e=this;setTimeout(function(){if(e._activeBoxViewViewController){e._activeBoxViewViewController.getFocusArea().focus()}},10)},_handleBoxView:function(e){var t=e.getParams().key;var n=c.Data.getBox(t);if(!n){c.logError("Box does not exist \nid:"+t);c.ButterBarManager.showError(c.Locale.getString("box_not_exist"));r.inboxSDK.Router.goto(r.inboxSDK.Router.NativeRouteIDs.INBOX);return}var i=n.getPipeline();if(!i){c.logError("Pipeline does not exist \nid:"+r.getConversationId());c.ButterBarManager.showError(c.Locale.getString("pipeline_not_exist"));r.inboxSDK.Router.goto(r.inboxSDK.Router.NativeRouteIDs.INBOX);return}return this._createBoxView(n,e)},teardown:function(){if(this._activeBoxViewViewController){this._activeBoxViewViewController.destroy();this._activeBoxViewViewController=null;this._activeBox=null}},_createBoxView:function(e,t){this._activeBoxViewViewController=new c.Modules.BoxViewViewController(e);var n=this._activeBoxViewViewController.render();t.getElement().appendChild(this._activeBoxViewViewController.getElement()[0]);var i=this;t.on("destroy",function(){i._activeBoxViewViewController.destroy();i._activeBoxViewViewController=null});return n}});e.DependencyManager.addFunction({functionKey:"boxviewMasterControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.BoxViewMasterController",new d)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Date,a=e.HTML,o=e.Gmail,s=e.NotificationCenter,l=e.BentoBox;var u=e.Class.subclass({className:"BoxViewViewController",superclass:e.Object,_memberVariables:[{name:"_element",destroy:true,get:true},{name:"_box",destroy:false},{name:"_pipeline",destroy:false},{name:"_tabFocusElements",destroy:false},{name:"_fieldInputs",destroy:true,defaultValue:[]},{name:"_columnOrder",destroy:false},{name:"_columnVisibility",destroy:false},{name:"_columns",destroy:false},{name:"_backButton",destroy:true},{name:"_pipelineLink",destroy:true},{name:"_nameTextbox",destroy:true},{name:"_actionButtonMenu",destroy:true},{name:"_actionMenu",destroy:true},{name:"_movePipelinesMenu",destroy:false},{name:"_newFollowerListViewController",destroy:true},{name:"_stageButton",destroy:true},{name:"_notesTextarea",destroy:true},{name:"_assignedToInput",destroy:true},{name:"_feedListViewController",destroy:true},{name:"_feedToggleButton",destroy:true},{name:"_thingsViewController",destroy:true},{name:"_emailPeopleList",destroy:true},{name:"_pipelineLockdownWarning",destroy:true},{name:"_linkedBoxesMenu",destroy:true},{name:"_gmailThreadCollection",destroy:false}],_initialize:function(t){e.Object.prototype._initialize.call(this);this._box=t;this._pipeline=t.getPipeline()},render:function(){this._setupElement();this._setupColumnData();this._setupTopBar();this._renderNotes();this._renderStageButton();this._renderAssignedTo();this._renderFeedList();this._renderBoxFields();this._renderEmailPeopleList();this._setupThings();this._setupContactsWatcher();this._setupLinkedBoxes();this._setupWarning();this._bindToEvents();var t=this;return new e.Promise(function(e,n){t._box.refresh(e)})},getFocusArea:function(){return this._nameTextbox},_setupElement:function(){this._element=t(a.get("boxView")({pipelineName:this._pipeline.displayName()}))},_setupColumnData:function(){this._columnOrder=l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(this._pipeline).data;this._columnVisibility=l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.load(this._pipeline).data;this._columns=l.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(this._pipeline)},_setupTopBar:function(){this._setupBackButton();this._setupPipelineLink();this._setupBoxName();this._setupActionMenu();this._renderFollowers()},_setupBackButton:function(){var e=t(document.createElement("div"));e[0].setAttribute("class","streak__boxView_backButtonContainer");this._backButton=l.Widgets.Buttons.ButtonFactory.createButton({type:"GmailIcon",iconClass:"ar6",onFunction:function(e){l.Tracker.track("backButtonPressed");history.back()}});e.append(this._backButton.getElement());this._element.find(".bb_top_bar").append(e)},_setupPipelineLink:function(){var e=this;this._pipelineLink=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:this._pipeline.displayName(),color:"blue",onFunction:function(){l.Tracker.track("pipelineLinkClicked",{source:"box view"});o.inboxSDK.Router.goto(e._pipeline.link())}});this._pipelineLink.addClass("pipelineLink");this._element.find(".bb_top_bar").append(this._pipelineLink.getElement());this._element.find(".bb_top_bar").append(" &raquo; ")},_updatePipelineLink:function(){this._pipelineLink.setText(this._pipeline.displayNameText())},_setupBoxName:function(){this._nameTextbox=l.Widgets.SmartTextbox.create({model:this._box,property:"name",autoGrow:true});this._nameTextbox.setEnabled(this._permissionToEditBoxes());this._element.find(".bb_top_bar").append(this._nameTextbox.getElement())},_setupActionMenu:function(){this._actionMenu=l.Widgets.Menu.create({css:{overflow:"visible"}});var e=this._permissionToEditBoxes();var n=l.Services.AccessManager.isAccessAllowed(this._pipeline,"Box","DELETE");if(e){this._actionMenu.addItem(l.Locale.getString("rename"),this._handleRenameBox.bind(this))}if(n){this._actionMenu.addItem(l.Locale.getString("delete"),this._handleDeleteBox.bind(this))}if(e){this._addMovePipelineActions()}this._actionButtonMenu=l.Widgets.Buttons.ButtonFactory.createMenuButton({type:"Icon",iconClass:"G-asx",menu:this._actionMenu,isFixedPosition:true});var i=t(document.createElement("div"));i[0].setAttribute("class","streak__boxView_actionMenuContainer");i.append(this._actionButtonMenu.getElement());this._element.find(".bb_top_bar").append(i);if(!e&&!n){i.css("visibility","hidden")}},_handleRenameBox:function(){l.Tracker.track("renameBox");this._nameTextbox.focus();this._actionButtonMenu.off()},_handleDeleteBox:function(){l.Tracker.track("deleteBoxClicked");this._actionButtonMenu.off();var e=this;l.Widgets.Modal.confirmDelete(this._box.displayName(),function(){l.Tracker.track("deleteBox");o.inboxSDK.Router.goto(e._box.getPipeline().link());e._box.del()})},_addMovePipelineActions:function(){if(l.Data.getAllPipelines().length<2){return}this._movePipelinesMenu=l.Widgets.Menu.create({css:{width:"200px"}});this._addPipelinesToMovePipelinesMenu();this._actionMenu.addSubMenu(l.Locale.getString("move_box"),this._movePipelinesMenu)},_addPipelinesToMovePipelinesMenu:function(){var e=this;n.each(l.UI.getSortedPipelines(),function(t){if(t.key()===e._pipeline.key()){return}e._movePipelinesMenu.addItem(t.displayName(),function(){e._actionButtonMenu.off();l.MoveBoxHelper.moveBox(e._box,t)})})},_updateMovePipelinesMenu:function(){this._movePipelinesMenu.empty();this._addPipelinesToMovePipelinesMenu()},_renderFollowers:function(){this._newFollowerListViewController=new l.Widgets.NewFollowerListViewController(this._box);this._element.find(".bb_top_bar").append(this._newFollowerListViewController.getView().getElement())},_renderNotes:function(){this._notesTextarea=l.Widgets.SmartTextarea.create({model:this._box,property:"notes",border:"alwaysHover",placeholder:l.Locale.getString("box_view_add_notes"),trackingContext:{widgetContext:"boxView"}});this._notesTextarea.setEnabled(this._permissionToEditFields());this._notesTextarea.placeholderEl.addClass("d8");this._element.find(".boxNotes").append(this._notesTextarea.getElement());this._element.find(".boxNotesWrap").superEasyHoverClass("RV")},_renderStageButton:function(){var e=this._element.find(".bb_stages");this._stageButton=l.Widgets.StageButton.create({pipeline:this._pipeline,box:this._box,trackingContext:{widgetContext:"boxView"}});var t=this._getFieldContainer(l.Locale.getString("stage"),this._stageButton.getElement());e.append(t)},_updateStageButton:function(){this._stageButton.destroy();this._element.find(".bb_stages").empty();this._renderStageButton()},_renderAssignedTo:function(){var e=this._element.find(".bbAssignedTo");e.hide();var t=this._pipeline.getSystemColumnByProperty("assignedToSharingEntries");if(n.isNotReal(t)){return}this._assignedToInput=l.Widgets.SidebarAssignedTo.create({box:this._box,pipeline:this._pipeline,border:"hover",persist:true,imgHeight:20,imgWidth:20,includeNames:true,delayedBind:true,trackingContext:{widgetContext:"boxView"}});this._assignedToInput.setEnabled(this._permissionToEditFields());var i=this._getFieldContainer(l.Locale.getString("assignedTo"),this._assignedToInput.getElement());e.append(i);e.show()},_renderFeedList:function(){var e=this;var t=this._element.find(".streak__box_sidebar");this._feedListViewController=new l.Widgets.FeedListViewController({model:this._box,usePostWidget:true,closeCallback:function(){e._feedToggleButton.off()}});this._feedToggleButton=i.getInstance("BentoBox.Modules.BoxView.ShowHideFeedButton",{toggleCallback:function(n){l.LocalSettings.set("boxView/hideFeed",!n);if(n){t.show();e._feedListViewController.reconfigureSize()}else{t.hide()}}});this._element.find(".streak__boxView_actionMenuContainer").after(this._feedToggleButton.getElement());t.html(this._feedListViewController.getElement());this._feedListViewController.reconfigureSize();if(l.LocalSettings.get("boxView/hideFeed")){this._feedToggleButton.off()}else{this._feedToggleButton.on()}},_renderBoxFields:function(){this._element.find(".bb_fields *").trigger("unbind");this._element.find(".bb_fields").empty();this._tabFocusElements=[];this._tabFocusElements.push(this._stageButton.getElement().find(".bbButton"));this._tabFocusElements.push(this._notesTextarea.getElement());if(this._assignedToInput){this._tabFocusElements.push(this._assignedToInput.getElement())}n.each(this._columnOrder,function(e){if(this._columns[e].field){var t=this._renderBoxField(this._columns[e].field.key());this._element.find(".bb_fields").append(t);this._tabFocusElements.push(t.find(".smartInput"))}}.bind(this));this._tabFocusElements.push(null);t.tabChain(this._tabFocusElements)},_renderBoxField:function(e){var t=this._pipeline.getField(e);var n=this._getFieldContainer(t.displayName());var i=l.Models.BoxField.getBoxViewInputWidget(this._box,t,n.find(".fieldValue"),{widgetContext:"boxView"});i.setEnabled(this._permissionToEditFields());this._fieldInputs.push(i);var r=i.getElement?i.getElement():i.el;n.find(".fieldValue").append(r);return n},_getFieldContainer:function(e,n){var i=t(a.get("boxViewField")({name:e}));if(n){i.find(".fieldValue").append(n)}i.superEasyHoverClass("RV");return i},_updateBoxFields:function(){for(var e=0;e<this._fieldInputs.length;e++){this._fieldInputs[e].destroy()}this._fieldInputs=[];this._renderBoxFields()},_renderEmailPeopleList:function(){this._emailPeopleList=new l.Widgets.People({trackingContext:{widgetContext:"boxView"}});this._element.find("#streak_email_ppl .streak_email_ppl_list").append(this._emailPeopleList.getElement());this._element.find("#streak_email_ppl .streak__emailAllButton").html(this._emailPeopleList.createEmailAllButton().getElement())},_setupContactsWatcher:function(){this._gmailThreadCollection=l.Data.getGmailThreadCollectionForBox(this._box.key());var e=this;this._gmailThreadCollection.watch("collectionChange",function(){e._updateEmailContacts()},this);this._gmailThreadCollection.watch("collectionRefreshed",function(t){if(t.didCollectionChange){e._updateEmailContacts()}},this);this._updateEmailContacts();this._gmailThreadCollection.refresh()},_setupThings:function(){this._thingsViewController=e.Library.getInstance("BentoBox.Modules.BoxView.ThingsViewController",this._box);this._element.find("section.streak_things").replaceWith(this._thingsViewController.getView().getElement());this._thingsViewController.setEnabled(this._box.getIsEditable()&&this._permissionToEditBoxes())},_updateEmailContacts:function(){var e=[];for(var t=0;t<this._gmailThreadCollection.length;t++){for(var i=0;i<this._gmailThreadCollection[t].get("emailAddresses").length;i++){e.push({email:this._gmailThreadCollection[t].get("emailAddresses")[i],fullName:this._gmailThreadCollection[t].get("names")[i]})}}e=n.uniq(e,false,function(e){return e.email});e=n.sortBy(e,function(e){return e.fullName});if(e.length===0){this._element.find("#streak_email_ppl").hide();return}this._element.find("#streak_email_ppl").show();this._emailPeopleList.updateDisplay(e)},_setupLinkedBoxes:function(){this._renderLinkedBoxesMenu();this._renderLinkedBoxes();this._box.watch("set",this._renderLinkedBoxes,this,"linkedBoxKeys")},_renderLinkedBoxesMenu:function(){this._linkedBoxesMenu=e.Library.getInstance("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuViewController");this._linkedBoxesMenu.setEnabled(this._box.getIsEditable()&&this._permissionToEditBoxes());this._element.find(".bb_linked_boxes_search").html(this._linkedBoxesMenu.getView().getElement());var t=this;this._linkedBoxesMenu.addDelegate({boxChosen:function(e){t._box.addLinkedBox(e)}})},_renderLinkedBoxes:function(){var e=this._box.get("linkedBoxKeys")||[];var t;var i;var r=0;this._element.find(".streak__boxView_linkedBoxes").empty();var a=this;var o=n.map(this._box.getPipeline().getStages(),function(e){return e.key()});n.chain(e).map(function(e){var t=l.Data.getBox(e);if(t){return t}r+=1}).tap(function(e){i=e}).compact().sortBy(function(e){return e.get("lastUpdatedTimestamp")}).sortBy(function(e){return e.displayName()}).sortBy(function(e){return o.indexOf(e.get("stageKey"))}).groupBy(function(e){return e.getPipeline().key()}).tap(function(e){t=e}).keys().map(function(e){return l.Data.getPipeline(e)}).sortBy(function(e){return e.displayName()}).each(function(e){a._renderLinkedBoxSection(e,t[e.key()])});this._linkedBoxesMenu.setExcludedBoxKeys(e.concat([this._box.key()]));this._element.find(".streak__boxView_linkedBoxes_wrapper").show();this._element.find(".streak__boxView_linkedBoxes_empty").hide();this._element.find(".streak__boxView_linkedBoxes").show()},_renderLinkedBoxSection:function(e,n){var i=t(a.get("boxViewConnectedBoxSection")({pipelineName:e.displayName()}));var r=i.find("tbody");var o=l.UI.getStageColors(e);for(var s=0;s<n.length;s++){var u=this._renderLinkedBox(n[s],o[n[s].get("stageKey")]);r.append(u)}this._element.find(".streak__boxView_linkedBoxes").append(i)},_renderLinkedBox:function(e,n){var i=a.get("boxViewConnectedBoxRow")({boxNameHTML:e.displayName(),groupcolor:n.backgroundColor,textcolor:n.textColor,boxStageNameHTML:e.getStageName(),boxDetails:l.Services.BoxDisplayText.getDetailsText(e),boxDate:r.create(e.get("lastUpdatedTimestamp")).getGmailFormatted()});i=t(i);i.on("click",function(){o.inboxSDK.Router.goto(e.link())});var s=this._box;var u=i.find(".streak__boxView_removeLinkedBox");u.on("click",function(t){s.removeLinkedBox(e);t.stopPropagation()});if(!this._permissionToEditBoxes()){u.remove()}return i},_permissionToEditBoxes:function(){return l.Services.AccessManager.isAccessAllowed(this._pipeline,"Box","UPDATE")},_permissionToEditFields:function(){return l.Services.AccessManager.isAccessAllowed(this._pipeline,"FieldBox","UPDATE")},_setupWarning:function(){this._pipelineLockdownWarning=new l.Widgets.PipelineLockdownWarningViewController(this._pipeline);this._element.find(".streak__pipeline_lockdown_warning").html(this._pipelineLockdownWarning.getView().getElement())},_bindToEvents:function(){var e=this;this._box.watch("set",this._handlePipelineChanged,this,"pipelineKey");this._pipeline.watch("set",this._updatePipelineLink,this,"name")},_handlePipelineChanged:function(e){var t=e.newValue;this._pipeline=l.Data.getPipeline(t);this._setupColumnData();this._updatePipelineLink();this._updateMovePipelinesMenu();this._updateStageButton();this._updateBoxFields()},destroy:function(){e.Object.prototype.destroy.call(this);s.unsubscribe({observer:this})}});i.set("BentoBox.Modules.BoxViewViewController",u)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox,r=e.Gmail,a=e.HTML,o=e.Utils;var s={initialized:false,init:function(e){var t=this;if(!t.initialized){r.observe("newChatMessage",t.processChatMessage.bind(t));t.initialized=true}if(e){e()}},processChatMessage:function(e){if(e&&e.length>0){var n=e.find("[title]");if(n.length>0&&n[0].title==="streak@mailfoogae.appspotchat.com"){var i=e.find("b");for(var r=0;r<i.length;r++){var a=t(i[r]).text();var o=this.getBox(a);if(o){this.linkify(t(i[r]),o.link())}}}var s=e.find('a[href*="mail.google.com"]');for(var l=0;l<s.length;l++){var u=t(s[l]);if(this.isBentoboxInternalLink(u)){this.relink(u)}}}},getBox:function(e){var t=n.filter(i.Data.getAllBoxes(),function(t){return t.displayName()===e});if(t.length===1){return t[0]}},linkify:function(e,n){var r=t(e);var a=r.parent();if(!a.is("a")){a=t(document.createElement("a"));a[0].setAttribute("href","#");r.before(a);r.detach();a.append(r);a.click(function(e){i.UI.setURL(n);e.preventDefault();e.stopPropagation()})}},relink:function(e){if(e.is("a")){var t=e.attr("href");var n=t.split("#")[1];if(n){e.click(function(e){i.UI.setURL(n);e.preventDefault();e.stopPropagation()})}}},isBentoboxInternalLink:function(e){var t=e.attr("href");var n=t.split("#")[0];var a=t.split("#")[1];if(n.indexOf("mail.google.com")==-1||!a){return false}return i.UI.isBentoBoxView(r.getStoredView(a.split("/")))}};e.DependencyManager.addFunction({functionKey:"chatLinkerInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["gmailLoaded","data.pipelines.initialized","data.boxes.initialized"]});i.Modules.ChatLinker=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Eventer,r=e.Model,a=e.Locale,o=e.Gmail,s=e.HTML,l=e.Date,u=e.BentoBox;var c=function(){e.ViewControllerBase.call(this);this._extractionSettings=null;this._boxes=null;this._pipeline=null;this._emailAddresses=null;this._emailAddressToBoxListMap={};this._emailAddressToRowListMap={};this._templateSubject=null;this._templateBody=null;this._csvFields=null;this._entryDetailModels=[];this._currentlyPreviewedEntryIndex=null;this._isPixelTrackingOn=false;this._usedSnippets=[];this._mailMergeId=null;this._setupStartingExtractionSettings()};c.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(c.prototype,{getExtractionSettingValue:function(e,t){return this._extractionSettings[e][t]},updateExtractionSettingValue:function(e,t,n,i){this._extractionSettings[e][t]=n;if(!i){u.LocalSettings.set("mailMerge/extractionSettings/"+e+"/"+t,n)}},updateExtractionColumnSettings:function(e){this._extractionSettings.columnSettings=e},setPipeline:function(e){this._pipeline=e},setCSVFields:function(e){this._csvFields=e},clearChosenEmails:function(){for(var e=0;e<this._entryDetailModels.length;e++){this._entryDetailModels[e].destroy()}this._entryDetailModels.length=0},getPipeline:function(){return this._pipeline},setBoxes:function(e){this._boxes=e},getBoxes:function(){return this._boxes},setEmailAddresses:function(e){this._emailAddresses=e},setEmailAddressToBoxListMap:function(e){this._emailAddressToBoxListMap=e},setEmailAddressToRowListMap:function(e){this._emailAddressToRowListMap=e},getNumberOfBoxesSelected:function(){if(this.isUsingCSVFile()){return 0}if(this._entryDetailModels.length===0){if(!this._boxes){return 0}return this._boxes.length}var e=[];for(var t=0;t<this._entryDetailModels.length;t++){if(this._entryDetailModels[t].isIncludedInMailMerge()){e.push(this._entryDetailModels[t].getBoxes())}}return n.chain(e).flatten().uniq().value().length},getNumberOfEmailsExtracted:function(){if(this._entryDetailModels.length===0){if(!this._emailAddresses){return 0}return this._emailAddresses.length}return n.filter(this._entryDetailModels,function(e){return e.isIncludedInMailMerge()}).length},getExtractionSettings:function(){return this._extractionSettings},getEntryDetailModel:function(e){if(this._entryDetailModels[e]){return this._entryDetailModels[e]}var t=this._emailAddresses[e];var n=new u.Modules.MailMergeEntryDetailModel;n.setEntryIndex(e);n.setEmail(t);n.setBoxes(this._emailAddressToBoxListMap[t]);n.setOtherFieldObjects(this._emailAddressToRowListMap[t]);n.setParentModel(this);this._entryDetailModels[e]=n;return n},setTemplateSubject:function(e,t){if(this.isAnEntryBeingPreviewed()){return}if(this.isEntryDetailBeingEdited()){this.getCurrentlyEditedEntryDetail().setOverwrittenEmailTemplateSubject(e);this.getCurrentlyEditedEntryDetail().setOverwrittenEmailTemplateBody(t);return}this._templateSubject=e;this._findReferencedFields();this._updateEntryDetailModels()},setTemplateBody:function(e,t){if(this.isAnEntryBeingPreviewed()){return}if(this.isEntryDetailBeingEdited()){this.getCurrentlyEditedEntryDetail().setOverwrittenEmailTemplateBody(e);this.getCurrentlyEditedEntryDetail().setOverwrittenEmailTemplateSubject(t);return}this._templateBody=e;this._findReferencedFields();this._updateEntryDetailModels()},isEntryDetailBeingEdited:function(){return!!this.getCurrentlyEditedEntryDetail()},getFieldList:function(){if(this._pipeline){return n.map(u.UI.getPipelineColumnList(this._pipeline,this._pipeline.getActiveSystemColumns()),function(e){return e.name})}if(this._csvFields){return this._csvFields}},getCurrentlyEditedEntryDetail:function(){var e=n.filter(this._entryDetailModels,function(e){return e.isCurrentlyEditing()});if(e.length>0){return e[0]}},getCurrentSubject:function(){if(this.isEntryDetailBeingEdited()){return this.getCurrentlyEditedEntryDetail().getTemplateSubject()}if(n.isReal(this._currentlyPreviewedEntryIndex)){return this._entryDetailModels[this._currentlyPreviewedEntryIndex].getTemplateSubject()}return this.getTemplateSubject()},getCurrentBody:function(){if(this.isEntryDetailBeingEdited()){return this.getCurrentlyEditedEntryDetail().getTemplateBody()}if(n.isReal(this._currentlyPreviewedEntryIndex)){return this._entryDetailModels[this._currentlyPreviewedEntryIndex].getTemplateBody()}return this.getTemplateBody()},getTemplateSubject:function(){return this._templateSubject},getTemplateBody:function(){return this._templateBody},getEntryDetailModels:function(){return this._entryDetailModels},getReferencedFields:function(){return this._referencedFields},getReverseColumnLookupTable:function(){return this._reverseColumnLookupTable},setPreviewedEntryIndex:function(e){this._callDelegateFunction("previewedEntryAboutToChange");this._currentlyPreviewedEntryIndex=e;this._callDelegateFunction("previewedEntryChanged")},entryRestored:function(){this._callDelegateFunction("previewedEntryChanged")},markEmailSent:function(e){this._entryDetailModels[e].setNotIncludedInMailMerge()},editingEntryIndexAboutToModify:function(){},editingEntryIndexModified:function(){this._callDelegateFunction("editedEntryChanged")},currentlyEditingEntryDetailChanged:function(){this._callDelegateFunction("editedEntryChanged")},isAnEntryBeingPreviewed:function(){return!this.isEntryDetailBeingEdited()&&n.isReal(this._currentlyPreviewedEntryIndex)},isPixelTracked:function(){return this._isPixelTrackingOn},setPixelTrackingStatus:function(e){this._isPixelTrackingOn=e},includedEmailsModified:function(){this._callDelegateFunction("includedEmailsModified")},snippetAdded:function(e){this._usedSnippets.push(e)},getSnippetKeyList:function(){return n.map(this._usedSnippets,function(e){return e.key()})},getMailMergeId:function(){if(!this._mailMergeId){this._mailMergeId=e.guid()}return this._mailMergeId},isUsingCSVFile:function(){return!!this._csvFields},getErrors:function(){if(!this._entryDetailModels||this._entryDetailModels.length===0){return["NO_EMAIL_ADDRESSES"]}return n.chain(this._entryDetailModels).filter(function(e){return e.isIncludedInMailMerge()}).map(function(e){return e.getErrors()}).compact().flatten().value()},_findReferencedFields:function(){this._referencedFields=u.Services.TemplateProcessor.findReferencedFields(this._pipeline,this._templateSubject,this._templateBody)},_updateEntryDetailModels:function(){for(var e=0;e<this._entryDetailModels.length;e++){this._entryDetailModels[e].update()}},_setupStartingExtractionSettings:function(){this._loadDefaultExtractionSettings();this._loadSavedExtractionSettings()},_loadDefaultExtractionSettings:function(){this._extractionSettings={extractEmailsFrom:{threads:true,assignedTo:false,columns:true},ignoreEmails:{myself:true,org:u.Constants.EMAIL_BLACK_LIST.indexOf(u.getUser().getDomain().toLowerCase())===-1}}},_loadSavedExtractionSettings:function(){var e=u.LocalSettings.get("mailMerge/extractionSettings");if(!e){return}this._updateWithSavedExtractionSetting("extractEmailsFrom","threads",e);this._updateWithSavedExtractionSetting("extractEmailsFrom","assignedTo",e);this._updateWithSavedExtractionSetting("extractEmailsFrom","columns",e);this._updateWithSavedExtractionSetting("ignoreEmails","myself",e);this._updateWithSavedExtractionSetting("ignoreEmails","org",e)},_updateWithSavedExtractionSetting:function(e,t,i){var r;if(i[e]){if(n.isReal(i[e][t])){r=i[e][t]}}if(n.isReal(r)){this._extractionSettings[e][t]=r}}});u.Modules.MailMergeModel=c})(Streak);(function(e){var t=e.Library,n=e.jQuery,i=e.Gmail,r=e.Locale,a=e.BentoBox,o=e.HTML,s=e._;var l=e.Class.subclass({superclass:t.get("BentoBox.Modules.ComposeViewControllerBase"),_memberVariables:[{name:"_stateManager",destroy:true},{name:"_mailMergeBoxChooserViewController",destroy:true},{name:"_mailMergeModel",destroy:true},{name:"_mailMergeSenderViewController",destroy:true},{name:"_clearAttachmentsModal",destroy:true}],_initialize:function(){a.Modules.ComposeViewControllerBase.prototype._initialize.call(this);this._setupStateManager();this._setupMailMergeModel()},initialize:function(e){this._composeWindowController=e},shouldProcessModification:function(){return false},getListenerType:function(){return null},canStartMailMerge:function(){return this._stateManager.canStartMailMerge()},isChoosingPipelineOrImportCSV:function(){return this._stateManager.isChoosingPipelineOrImportCSV()},startLinkClicked:function(){this._stateManager.startLinkClicked()},pipelineChosen:function(e){this._mailMergeModel.setPipeline(e);this._mailMergeModel.clearChosenEmails();this._stateManager.pipelineChosen()},boxesChosen:function(){this._stateManager.boxesChosen()},loadEditTemplateState:function(){i.unhideComposeLayer();if(!this._composeWindowController){i.GmailComposeWindowRequester.requestNewComposeWindow()}this._destroyBoxChooser()},mailMergeStateChanged:function(){this._callDelegateFunction("mailMergeStateChanged")},isWaitingForCompose:function(){return!this._composeWindowController&&this._stateManager.isEditTemplate()},shouldShowSidebar:function(){return this._stateManager.shouldShowSidebar()},cancel:function(){this._stateManager.cancel();a.Modules.MailMergeMasterController.mailMergeCancelled(this);this._destroyBoxChooser();if(this._composeWindowController){this._composeWindowController.setModuleInactive("mailMerge");this._composeWindowController.notify("mailMergeCancelled")}},doneCancelling:function(){if(this._composeWindowController){this._composeWindowController.unhide()}i.unhideComposeLayer()},setPreviewedEntryIndex:function(e){this._mailMergeModel.setPreviewedEntryIndex(e)},getMailMergeModel:function(){return this._mailMergeModel},shouldNotSend:function(){return this.shouldShowSidebar()},sendCancelled:function(){if(!this._stateManager.isMailMergeActive()){return}if(this._mailMergeModel.getErrors().length>0){this._showErrorModal();return}this._stateManager.startSending()},_showErrorModal:function(){var e=s.uniq(this._mailMergeModel.getErrors());var t=n(document.createElement("div"));t[0].innerHTML=o.getString("mailMergeErrors");var i=n(document.createElement("ul"));for(var r=0;r<e.length;r++){i.append("<li>"+a.Locale.getString("mail_merge_"+e[r].toLowerCase())+"</li>")}t.append(i);var l=a.Widgets.Modal.create({title:a.Locale.getString("mail_merge_blocking_errors_title"),inner:t,showCancel:false,confirmText:a.Locale.getString("ok")});l.show()},startSending:function(){this._composeWindowController.hide();this._mailMergeSenderViewController=t.getInstance("BentoBox.Modules.MailMergeSenderViewController");
this._mailMergeSenderViewController.setDataSource(this.getMailMergeModel());this._mailMergeSenderViewController.setDelegate(this);this._mailMergeSenderViewController.startSending()},finishedSending:function(){this._composeWindowController.unhide();this._composeWindowController.discard()},allModificationsInitialized:function(){if(this.shouldShowSidebar()){this._composeWindowController.setModuleActive("mailMerge");this._composeWindowController.notify("mailMergeActive")}},activeModulesChanged:function(e){this._stateManager.unblocked();if(e.indexOf("sendLater")>-1){this._stateManager.blocked()}if(e.indexOf("threadBox")>-1){this._stateManager.blocked()}if(e.indexOf("bumpLater")>-1){this._stateManager.blocked()}},snippetAdded:function(e){this._mailMergeModel.snippetAdded(e)},pixelTrackingOn:function(){this._mailMergeModel.setPixelTrackingStatus(true)},pixelTrackingOff:function(){this._mailMergeModel.setPixelTrackingStatus(false)},includedEmailsModified:function(){this._callDelegateFunction("includedEmailsModified")},newAttachmentAdded:function(){if(!this._stateManager.isMailMergeActive()){return}if(this._clearAttachmentsModal){return}this._showClearAttachmentsModal()},_showClearAttachmentsModal:function(){var e=this;this._clearAttachmentsModal=a.Widgets.Modal.confirm(a.Locale.getString("mm_attachment_found_title"),a.Locale.getString("mm_attachment_found_message"),function(){e._composeWindowController.clearAttachments();a.Tracker.track("mail merge attachments cleared");e._clearAttachmentsModal=null},function(){e.cancel();e._clearAttachmentsModal=null})},_setupStateManager:function(){this._stateManager=new a.Modules.MailMergeStateManager;this._stateManager.setMailMergeController(this)},_setupMailMergeModel:function(){this._mailMergeModel=new a.Modules.MailMergeModel;this._mailMergeModel.addDelegate(this)}});s.extend(l.prototype,{loadBoxChooser:function(){if(!this._areWeInPipeline()){this._loadPipelineViewAndCreateBoxChooser()}else{this._createBoxChooser()}},_areWeInPipeline:function(){return i.getConversationId()===this._mailMergeModel.getPipeline().key()},_loadPipelineViewAndCreateBoxChooser:function(){i.inboxSDK.Router.goto(this._mailMergeModel.getPipeline().link());e.Utils.waitFor(function(){return n(".spreadsheetContainer .tbody").length>0}).then(this._createBoxChooser.bind(this))},_createBoxChooser:function(){i.hideComposeLayer();this._mailMergeBoxChooserViewController=new a.Modules.MailMergeBoxChooserViewController;this._mailMergeBoxChooserViewController.setMailMergeController(this);this._mailMergeBoxChooserViewController.setDataSource(this._mailMergeModel)},_destroyBoxChooser:function(){if(!this._mailMergeBoxChooserViewController){return}this._mailMergeBoxChooserViewController.destroy();this._mailMergeBoxChooserViewController=null},updateExtractionSettingValue:function(e,t,n){this._mailMergeModel.updateExtractionSettingValue(e,t,n);this._updateEmailExtractionFromBoxes()},setExtractionColumnSettings:function(e){this._mailMergeModel.updateExtractionColumnSettings(e)},updateExtractionColumnSettings:function(e){this._mailMergeModel.updateExtractionColumnSettings(e);this._updateEmailExtractionFromBoxes()},updateBoxesChosen:function(e){this._mailMergeModel.setBoxes(e);this._updateEmailExtractionFromBoxes()},_updateEmailExtractionFromBoxes:function(){var e=this._mailMergeModel.getExtractionSettings();var t=this._mailMergeModel.getBoxes();var n=a.Services.EmailAddressExtractor.extractEmailAddressesFromBoxes(e,t);this._mailMergeModel.setEmailAddresses(n.emailAddresses);this._mailMergeModel.setEmailAddressToBoxListMap(n.emailAddressToBoxListMap);if(this._mailMergeBoxChooserViewController){this._mailMergeBoxChooserViewController.statsChanged()}},updateCSVRows:function(e){var t=s.keys(e[0]);this._mailMergeModel.setCSVFields(t);var n=a.Services.EmailAddressExtractor.extractEmailAddressesFromCSVRows(e);this._mailMergeModel.setEmailAddresses(n.emailAddresses);this._mailMergeModel.setEmailAddressToRowListMap(n.emailAddressToRowListMap);this._stateManager.csvUploaded()}});s.extend(l.prototype,{getNumberOfEmailsExtracted:function(){return this._mailMergeModel.getNumberOfEmailsExtracted()},getEntryDetailModel:function(e){return this._mailMergeModel.getEntryDetailModel(e)}});a.Modules.MailMergeController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox,r=e._;var a=function(){n.GmailComposeManager.registerModifierModule(this);this._pipelineStartedMailMergeController=null};r.extend(a.prototype,{GMAIL_MAX_EMAILS_OUT:50,APPS_MAX_EMAILS_OUT:200,DELAY_BETWEEN_EMAILS:5*1e3,_mailMergeModel:null,getViewControllers:function(){var t;if(this._pipelineStartedMailMergeController&&this._pipelineStartedMailMergeController.isWaitingForCompose()){t=this._pipelineStartedMailMergeController;this._pipelineStartedMailMergeController=null}else{t=new i.Modules.MailMergeController}var n=new i.Modules.MailMergeComposeStartLinkViewController;n.setDataSource(t);var r=new i.Modules.MailMergePipelineChooserCSVImporterViewController;r.setDelegate(t);r.setDataSource(t.getMailMergeModel());var a=new i.Modules.MailMergeSidebarViewController;a.setDataSource(t);a.setDelegate(t);var o=new i.Modules.MailMergeContentManagerViewController;o.setDataSource(t.getMailMergeModel());o.setDelegate(t);var s=new i.Modules.MailMergeInsertTagViewController;s.setDataSource(t.getMailMergeModel());s.setDelegate(t);var l=e.Library.getInstance("BentoBox.Modules.MailMergeSendStatsViewController");l.setDataSource(t.getMailMergeModel());l.setDelegate(t);t.addDelegate(n);t.addDelegate(r);t.addDelegate(s);t.addDelegate(o);t.addDelegate(a);t.addDelegate(l);return[n,r,a,o,s,l,t]},startMailMergeFromPipelineView:function(e,t){this._pipelineStartedMailMergeController=new i.Modules.MailMergeController;this._pipelineStartedMailMergeController.pipelineChosen(e);this._pipelineStartedMailMergeController.updateBoxesChosen(t)},mailMergeCancelled:function(e){if(this._pipelineStartedMailMergeController===e){this._pipelineStartedMailMergeController=null}}});e.DependencyManager.addFunction({functionKey:"mailMergeMasterControllerInitialized",functionToCall:function(e){i.Modules.MailMergeMasterController=new a;if(e){e()}},dependentFunctionKeys:["data.pipelines.initialized","data.boxes.initialized","gmailLoaded","htmlLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=e.Class.subclass({superclass:l.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_element",destroy:true},{name:"_dataSource",destroy:false,set:true}],_initialize:function(){l.Modules.ComposeViewControllerBase.prototype._initialize.call(this);return this},initialize:function(e){this._composeWindowViewController=e;this._generateLink()},shouldProcessModification:function(){return this._dataSource.canStartMailMerge()},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"EXTRA_RECIPIENTS"},getModificationElement:function(){return this._element},_generateLink:function(){var e=this;this._element=i.get("mm_main_button",true);this._element.on("click",function(t){e._startLinkClicked();l.Tracker.track("mail merge started",{method:"to area link"})})},_startLinkClicked:function(){if(this._composeWindowViewController.hasAttachments()){this._askToClearAttachments();return}this._composeWindowViewController.setModuleActive("mailMerge");this._composeWindowViewController.notify("mailMergeActive");this._dataSource.startLinkClicked()},_askToClearAttachments:function(){var e=this;l.Widgets.Modal.confirm(l.Locale.getString("mm_attachment_found_title"),l.Locale.getString("mm_attachment_found_message"),function(){e._composeWindowViewController.clearAttachments();e._waitForAttachmentsToClearAndNotify();l.Tracker.track("mail merge attachments cleared")})},_waitForAttachmentsToClearAndNotify:function(){var e=this;setTimeout(function(){e._composeWindowViewController.setModuleActive("mailMerge");e._composeWindowViewController.notify("mailMergeActive");e._dataSource.startLinkClicked()},200)},mailMergeStateChanged:function(){this._composeWindowViewController.reloadModification(this)}});l.Modules.MailMergeComposeStartLinkViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._mailMergeController=null;this._stateMachine=null;this._setupStateMachine()};n.extend(u.prototype,{_setupStateMachine:function(){var t=this;this._stateMachine=new e.StateMachine.create({initial:"start",events:[{name:"startLinkClicked",from:["start"],to:"choosePipelineImportCSV"},{name:"blocked",from:["start"],to:"currentlyBlocked"},{name:"unblocked",from:["currentlyBlocked"],to:"start"},{name:"pipelineChosen",from:["choosePipelineImportCSV","editTemplate","start"],to:"chooseBoxes"},{name:"boxesChosen",from:["chooseBoxes"],to:"editTemplate"},{name:"csvUploaded",from:["choosePipelineImportCSV"],to:"editTemplate"},{name:"startSending",from:["editTemplate"],to:"sendingEmails"},{name:"cancel",from:["chooseBoxes","editTemplate","choosePipelineImportCSV"],to:"start"},{name:"cancel",from:["sendingEmails"],to:"editTemplate"}],callbacks:{onchangestate:function(){if(t._mailMergeController){t._mailMergeController.mailMergeStateChanged()}},oneditTemplate:function(){t._mailMergeController.loadEditTemplateState()},onchooseBoxes:function(){t._mailMergeController.loadBoxChooser()},onsendingEmails:function(){t._mailMergeController.startSending()},onaftercancel:function(){t._mailMergeController.doneCancelling()}}})},setMailMergeController:function(e){this._mailMergeController=e},startLinkClicked:function(){this._stateMachine.startLinkClicked()},blocked:function(){this._stateMachine.blocked()},unblocked:function(){this._stateMachine.unblocked()},boxesChosen:function(){this._stateMachine.boxesChosen()},pipelineChosen:function(){this._stateMachine.pipelineChosen()},csvUploaded:function(){this._stateMachine.csvUploaded()},startSending:function(){this._stateMachine.startSending()},cancel:function(){this._stateMachine.cancel()},canStartMailMerge:function(){return this._stateMachine.is("start")},isChoosingPipelineOrImportCSV:function(){return this._stateMachine.is("choosePipelineImportCSV")},isSendingEmails:function(){return this._stateMachine.is("sendingEmails")},shouldShowSidebar:function(){return this._stateMachine.is("editTemplate")},isEditTemplate:function(){return this._stateMachine.is("editTemplate")},isMailMergeActive:function(){return!this._stateMachine.is("start")&&!this._stateMachine.is("currentlyBlocked")},destroy:function(){this._stateMachine=null}});l.Modules.MailMergeStateManager=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){e.ViewControllerBase.call(this);this._element=null;this._setupUIElements()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{_setupUIElements:function(){this._element=a.get("MM_ButtonArea",true);this._element.find(".streak__mailMerge_chooseOr").hide();this._element.find(".streak__mailMerge_selectedNotice").hide();this._element.find(".streak__mailMerge_chooseBoxes").hide()},getElement:function(){return this._element},setPipelineChooser:function(e){e.getElement().css({display:"inline-block"});this._element.find(".streak__mailMerge_pipelineChooser").prepend(e.getElement());this._element.find(".streak__mailMerge_chooseOr").show()},setChooseBoxesLink:function(e){this._element.find(".streak__mailMerge_chooseBoxes").append(e.getElement());e.getElement().addClass("__streak_MM_chooseBoxes")},setImportCSVButton:function(e){this._element.find(".streak__mailMerge_csvInput").append(e.getElement())},setImportCSVFileInput:function(e){this._element.find(".streak__mailMerge_csvInput").append(e);e.hide()},showChooseBoxesLink:function(){this._element.find(".streak__mailMerge_chooseBoxes").show()},showSelectedNotice:function(){this._element.find(".streak__mailMerge_selectedNotice").show()},hideCSVImport:function(){this._element.find(".streak__mailMerge_csvInput").hide();this._element.find(".streak__mailMerge_chooseOr").hide()},setCancelLink:function(e){this._element.find(".streak__mailMerge_chooser_cancel").html(e.getElement())},destroy:function(){this._element.remove();e.ViewControllerBase.prototype.destroy.call(this)}});l.Modules.MailMergePipelineChooserCSVImporterView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=e.Class.subclass({superclass:l.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_pipelineChooser",destroy:true},{name:"_importCSVButton",destroy:true},{name:"_importCSVFileInput",destroy:true},{name:"_cancelLink",destroy:true},{name:"_currentPipeline",destroy:false},{name:"_dataSource",destroy:false,set:true}],_initialize:function(){l.Modules.ComposeViewControllerBase.prototype._initialize.call(this);return this},initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){return this._delegate.isChoosingPipelineOrImportCSV()},aboutToProcessModification:function(){if(!this._view){this._setupTheView()}},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"RECIPIENTS_OVERLAY"},getModificationHeight:function(){return"65px"},getModificationElement:function(){if(!this._view){return null}return this._view.getElement()},mailMergeStateChanged:function(){this._composeWindowViewController.reloadModification(this)},_setupView:function(){},_setupTheView:function(){this._view=new l.Modules.MailMergePipelineChooserCSVImporterView;this._setupInputs()},_setupInputs:function(){if(l.Data.getAllPipelines().length>0){this._setupPipelineChooser();this._setupChooseBoxesLink()}this._setupCSVImport();this._setupCancelLink()},_setupPipelineChooser:function(){var e=this;this._pipelineChooser=l.Widgets.ButtonCustomDropdown.create({unselectedDisplayText:l.Locale.getString("mm_choose_pipeline"),list:n.map(l.Data.getAllPipelines(),function(e){return{name:e.displayName(),value:e}}),trackingContext:{widgetContext:"mm_pipelineChooser"},changeFunc:function(t){e._pipelineChosen(t.value)}});this._pipelineChooser.deselect();this._view.setPipelineChooser(this._pipelineChooser)},_pipelineChosen:function(e){this._currentPipeline=e;this._view.hideCSVImport();this._view.showChooseBoxesLink();this._view.showSelectedNotice()},_setupChooseBoxesLink:function(){var e=this;this._chooseBoxesLink=l.Widgets.LinkButton.create({text:l.Locale.getString("mm_choose_boxes_2"),clickFunction:function(){e._delegate.pipelineChosen(e._currentPipeline);l.Tracker.track("mail merge pipeline chosen")}});this._view.setChooseBoxesLink(this._chooseBoxesLink)},_setupCSVImport:function(){var e=this;this._importCSVFileInput=t('<input type="file" accept="text/csv, text/txt">');this._importCSVFileInput[0].addEventListener("change",this._csvUploaded.bind(this),false);this._view.setImportCSVFileInput(this._importCSVFileInput);this._importCSVButton=l.Widgets.LinkButton.create({text:l.Locale.getString("mm_upload_csv"),clickFunction:function(t){e._importCSVFileInput.simulateRawClick();l.Tracker.track("mail merge csv file window open")}});this._view.setImportCSVButton(this._importCSVButton)},_csvUploaded:function(e){var t=this;e.stopPropagation();e.preventDefault();var n=e.target.files||e.dataTransfer.files;var i=n[0];var r=new FileReader;r.onload=function(){t._processCSVData(r.result);l.Tracker.track("mail merge csv file uploaded")};r.onerror=function(){t._showCSVError()};r.readAsText(i,"UTF-8")},_processCSVData:function(t){var n=null;try{n=e.csvParser.parse(t)}catch(i){this._showCSVError();return}this._delegate.updateCSVRows(n)},_showCSVError:function(){l.Widgets.Modal.create({title:l.Locale.getString("mm_error_csv_title"),inner:l.Locale.getString("mm_error_csv_message"),confirmText:l.Locale.getString("ok"),showCancel:false}).show();l.Tracker.track("mail merge import CSV error")},_setupCancelLink:function(){var e=this;this._cancelLink=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:l.Locale.getString("cancel"),onFunction:function(){e._delegate.cancel();l.Tracker.track("mail merge cancelled",{stage:"pipeline chooser"})}});this._view.setCancelLink(this._cancelLink)},destroy:function(){this._composeWindowViewController=null;if(this._view){this._view.destroy()}if(this._pipelineChooser){this._pipelineChooser.destroy()}if(this._importCSVButton){this._importCSVButton.destroy()}}});l.Modules.MailMergePipelineChooserCSVImporterViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){e.ViewControllerBase.call(this);this._yellowBar=null;this._innerYellowBar=null;this._clickBlockOverlay=null;this._setupYellowBar();this._setupClickBlockOverlay()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{_setupYellowBar:function(){var e=this;this._setupInnerYellowBar();this._yellowBar=l.Widgets.Tour.Bar.create({html:this._innerYellowBar,rightButtonText:l.Locale.getString("continue_with_mail_merge"),showLink:true,customClasses:"__streak_MM_Chooser",cancelFunc:function(){e._callDelegateFunction("cancelClicked")},showLeftButton:false,rightButtonFunction:function(){e._callDelegateFunction("continueClicked")}});this._yellowBar.show()},_setupInnerYellowBar:function(){this._innerYellowBar=a.get("mailMergeBarHTML",true)},_setupClickBlockOverlay:function(){var e=this;this._clickBlockOverlay=l.Widgets.Tour.Highlight.create({targetElement:t(".pv_container"),backgroundOpacity:0,clickCallback:function(){e._callDelegateFunction("cancelClicked")}});this._clickBlockOverlay.show()},setExtractionSettingsMenuButton:function(e){this._innerYellowBar.find(".__streak_MM_extractingFrom .__streak_buttonPosition").prepend(e.getElement())},setBoxesSelectedCount:function(e){this._innerYellowBar.find(".__streak_MM_boxesExtracted").html(e)},setEmailsExtractedCount:function(e){this._innerYellowBar.find(".__streak_MM_emaislExtracted").html(e)},showExtractionLineSettings:function(){this._innerYellowBar.find(".__streak_MM_extractingFrom").show()},hideExtractionLineSettings:function(){this._innerYellowBar.find(".__streak_MM_extractingFrom").hide()},showSelectBoxesNotice:function(){this._innerYellowBar.find(".__streak_MM_extractingInstructions").show()},hideSelectBoxesNotice:function(){this._innerYellowBar.find(".__streak_MM_extractingInstructions").hide()},destroy:function(){this._yellowBar.destroy();this._clickBlockOverlay.destroy();e.ViewControllerBase.prototype.destroy.call(this)}});l.Modules.MailMergeBoxChooserView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){e.ViewControllerBase.call(this);this._mailMergeController=null;this._dataSource=null;this._view=null;this._extractionSettingsMenu=null;this._extractionSettingsMenuButton=null;this._setupTheView()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{setMailMergeController:function(e){this._mailMergeController=e},setDataSource:function(e){this._dataSource=e;this._setupExtractionSettingsMenu();this._setupExtractionSettingsMenuButton();this._setupNotificationBindings();this.statsChanged()},_setupView:function(){},_setupTheView:function(){this._view=new l.Modules.MailMergeBoxChooserView;this._view.addDelegate(this)},_setupExtractionSettingsMenu:function(){this._extractionSettingsMenu=l.Widgets.Menu.create({css:{overflow:"visible"}});this._extractionSettingsMenu.addItem(l.Locale.getString("mm_extrac_emails_from"));this._addExtractionSetting("extractEmailsFrom","threads");if(l.isFeatureEnabled("mailMergeColumnSelector")){this._addThreadsExtractionSetting()}else{this._addExtractionSetting("extractEmailsFrom","columns")}this._addExtractionSetting("extractEmailsFrom","assignedTo");this._extractionSettingsMenu.addSeparator();this._extractionSettingsMenu.addItem(l.Locale.getString("mm_ignore_emails_from"));this._addExtractionSetting("ignoreEmails","myself");this._addExtractionSetting("ignoreEmails","org")},_addThreadsExtractionSetting:function(){var e=this;var t=this._dataSource.getExtractionSettingValue("extractEmailsFrom","columns");var n=this._getExtractionSettingName("extractEmailsFrom","columns");var i=this._dataSource.getPipeline().getFields();var r={};var a=[];var o=l.Widgets.Menu.create();a.push(this._addColumnExtractionSetting(l.Locale.getString("name"),"name",o,r,t));a.push(this._addColumnExtractionSetting(l.Locale.getString("notes"),"notes",o,r,t));for(var s=0;s<i.length;s++){a.push(this._addColumnExtractionSetting(i[s].displayName(),i[s].key(),o,r,t))}this._extractionSettingsMenu.addSubMenu(n,o,{itemType:"checkItem",isChecked:t,itemCallback:function(t){e._mailMergeController.updateExtractionSettingValue("extractEmailsFrom","columns",t);e._updateExtractionSettingsMenuButton();l.Tracker.track("mail merge extract setting changed",{settingName:n,settingValue:t});for(var i=0;i<a.length;i++){a[i].setEnabled(t)}}});this._mailMergeController.setExtractionColumnSettings(r)},_addColumnExtractionSetting:function(e,t,n,i,r){var a=this;var o=n.addCheckItem(e,function(e){i[t]=e;a._mailMergeController.updateExtractionColumnSettings(i)},r);i[t]=r;return o},_addExtractionSetting:function(e,t){var n=this;var i=this._dataSource.getExtractionSettingValue(e,t);var r=this._getExtractionSettingName(e,t);var a=this._extractionSettingsMenu.addCheckItem(r,function(){i=!i;a.setCheckboxState(i);n._mailMergeController.updateExtractionSettingValue(e,t,i);n._updateExtractionSettingsMenuButton();l.Tracker.track("mail merge extract setting changed",{settingName:r,settingValue:i})},i)},_getExtractionSettingName:function(e,t){return l.Locale.getString(c[e][t],{org:l.getUser().getDomain().capitalize()})},_setupExtractionSettingsMenuButton:function(){this._extractionSettingsMenuButton=l.Widgets.Buttons.ButtonFactory.createMenuButton({type:"Text",text:this._getExtractionSettingsMenuButtonText(),isFixedPosition:true,menu:this._extractionSettingsMenu,preOnFunction:function(){l.Tracker.track("mail merge extract settings menu open")}});this._view.setExtractionSettingsMenuButton(this._extractionSettingsMenuButton)},_updateExtractionSettingsMenuButton:function(){this._extractionSettingsMenuButton.setText(this._getExtractionSettingsMenuButtonText())},_getExtractionSettingsMenuButtonText:function(){var e=[];if(this._dataSource.getExtractionSettingValue("extractEmailsFrom","threads")){e.push(this._getExtractionSettingName("extractEmailsFrom","threads"))}if(this._dataSource.getExtractionSettingValue("extractEmailsFrom","columns")){e.push(this._getExtractionSettingName("extractEmailsFrom","columns"))}if(this._dataSource.getExtractionSettingValue("extractEmailsFrom","assignedTo")){e.push(this._getExtractionSettingName("extractEmailsFrom","assignedTo"))}if(e.length===0){return l.Locale.getString("mm_none")}else{return e.join(", ")}},_setupNotificationBindings:function(){o.subscribe({eventName:"pipeline.selectedBoxesChanged",functionToCall:this._selectedBoxesChanged,observer:this,filterParameters:{pipelineKey:this._dataSource.getPipeline().key()}});o.postNotification({eventName:"disableBoxLoading",pipelineKey:this._dataSource.getPipeline(),sender:this});this._mailMergeController.updateBoxesChosen(l.Modules.PipelineViewMasterController.getSelectedBoxes())},_selectedBoxesChanged:function(e){var t=e.selectedBoxes;this._mailMergeController.updateBoxesChosen(t)},statsChanged:function(){var e=this._dataSource.getNumberOfBoxesSelected();var t=this._dataSource.getNumberOfEmailsExtracted();this._view.setBoxesSelectedCount(e);this._view.setEmailsExtractedCount(t);if(e>0){this._view.showExtractionLineSettings();this._view.hideSelectBoxesNotice()}else{this._view.showSelectBoxesNotice();this._view.hideExtractionLineSettings()}},continueClicked:function(){this._mailMergeController.boxesChosen()},cancelClicked:function(){var e=this;l.Widgets.Modal.create({title:l.Locale.getString("mail_merge"),confirmText:l.Locale.getString("continue_with_mail_merge"),inner:l.Locale.getString("middle_of_mm_warning"),showCancel:true,cancelText:l.Locale.getString("exit_mail_merge"),cancelFunc:function(){e._mailMergeController.cancel();l.Tracker.track("mail merge cancelled",{stage:"pipeline box choosing"})},confirmFunc:function(){t.modal.close()}}).show()},destroy:function(){this._view.destroy();this._extractionSettingsMenu.destroy();this._extractionSettingsMenuButton.destroy();o.unsubscribe({observer:this});o.postNotification({eventName:"enableBoxLoading",pipelineKey:this._dataSource.getPipeline(),sender:this})}});var c={extractEmailsFrom:{threads:"mm_email_threads",assignedTo:"mm_assigned_to",columns:"mm_pipeline_cols"},ignoreEmails:{myself:"mm_me",org:"mm_anyone_at"}};l.Modules.MailMergeBoxChooserViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._listViewController=null;this._dataSource=null;this._delegate=null;this._mailMergeEntryDetailViewControllers=[]};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{setDataSource:function(e){this._dataSource=e},setDelegate:function(e){this._delegate=e},initialize:function(e){this._composeWindowViewController=e},aboutToProcessModification:function(){this._destroyEntryDetails();this._setupElement()},shouldProcessModification:function(){return this._dataSource.shouldShowSidebar()},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"EXTERNAL_SIDEBAR"},getModificationElement:function(){if(this._listViewController&&this._listViewController.getView()){return this._listViewController.getView().getElement()}},getModificationTitle:function(){return s.Locale.getString("mm_extracted_emails")},mailMergeStateChanged:function(){this._composeWindowViewController.reloadModification(this)},_setupElement:function(){if(!this._listViewController){this._listViewController=new s.Widgets.ListView.ListViewViewController;this._listViewController.setDataSource(this);this._listViewController.addDelegate(this)}var e=this._dataSource.getNumberOfEmailsExtracted();for(var t=0;t<e;t++){var n=new s.Modules.MailMergeEntryDetailViewController(t);n.setDataSource(this._dataSource.getEntryDetailModel(t));this._mailMergeEntryDetailViewControllers.push(n)}this._listViewController.dataChanged()},numberOfSections:function(){return 1},sectionShouldShow:function(){return true},numberOfRowsForSection:function(){return this._mailMergeEntryDetailViewControllers.length},infoForRow:function(e,t){return{viewController:this._mailMergeEntryDetailViewControllers[t]}},dontScrollOnHighlight:function(){return true},rowFocused:function(e){this._dataSource.setPreviewedEntryIndex(e.viewController.getEntryIndex())},rowUnfocused:function(e){this._dataSource.setPreviewedEntryIndex(null)},getWrapperClass:function(){return"streak__mailMerge_sidebar"},rowsAreNotSelectable:function(){return true},dontHighlightOnDataChange:function(){return true},destroy:function(){if(this._listViewController){this._listViewController.destroy()}this._composeWindowViewController=null;this._destroyEntryDetails()},_destroyEntryDetails:function(){if(!this._mailMergeEntryDetailViewControllers){return}for(var e=0;e<this._mailMergeEntryDetailViewControllers.length;e++){this._mailMergeEntryDetailViewControllers[e].destroy()}this._mailMergeEntryDetailViewControllers.length=0}});s.Modules.MailMergeSidebarViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._dataSource=null;this._delegate=null;this._subjectDebounceTimeout=null;this._bodyDebounceTimeout=null;this._updatedCompose=false};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e},setDataSource:function(e){this._dataSource=e;this._dataSource.addDelegate(this)},setDelegate:function(e){this._delegate=e},subjectChanged:function(e){if(this._dataSource.isAnEntryBeingPreviewed()){return}if(this._dataSource.isEntryDetailBeingEdited()&&this._updatedCompose){return}clearTimeout(this._subjectDebounceTimeout);var t=this;this._subjectDebounceTimeout=setTimeout(function(){t._dataSource.setTemplateSubject(e,t._composeWindowViewController.getComposeBodyHTML())},100)},emailBodyChanged:function(e,t){if(this._dataSource.isAnEntryBeingPreviewed()){return}if(this._dataSource.isEntryDetailBeingEdited()){if(t&&t.fromDraftSaving){return}if(this._updatedCompose){return}}clearTimeout(this._bodyDebounceTimeout);var n=this;this._bodyDebounceTimeout=setTimeout(function(){if(!n._composeWindowViewController){return}n._dataSource.setTemplateBody(e,n._composeWindowViewController.getSubject())},100)},previewedEntryAboutToChange:function(){this._dataSource.setTemplateSubject(this._composeWindowViewController.getSubject());this._dataSource.setTemplateBody(this._composeWindowViewController.getComposeBodyHTML())},previewedEntryChanged:function(){this._updateComposeWithRelevantContent()},editedEntryChanged:function(){this._updateComposeWithRelevantContent()},_updateComposeWithRelevantContent:function(){var e=this._dataSource.getCurrentSubject();var t=this._dataSource.getCurrentBody();this._updatedCompose=true;this._composeWindowViewController.setSubject(e);this._composeWindowViewController.setEmailBody(t);if(this._dataSource.isAnEntryBeingPreviewed()){this._composeWindowViewController.disableEditing()}else{this._composeWindowViewController.enableEditing()}this._updatedCompose=false},destroy:function(){this._composeWindowViewController.enableEditing();this._composeWindowViewController=null}});s.Modules.MailMergeContentManagerViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=e.Class.subclass({superclass:e.UI.Delegator,_memberVariables:[{name:"_parentModel",destroy:false,set:true},{name:"_entryIndex",destroy:true,get:true,set:true},{name:"_boxes",destroy:false,get:true},{name:"_selectedBox",destroy:false,get:true},{name:"_contact",destroy:true,get:true},{name:"_email",destroy:true,get:true},{name:"_otherFieldsModel",destroy:true,get:true},{name:"_overwrittenEmailTemplateSubject",destroy:false,get:true,set:true},{name:"_overwrittenEmailTemplateBody",destroy:false,get:true,set:true},{name:"_missingEmailFields",destroy:true,get:true},{name:"_missingBoxFields",destroy:true,get:true},{name:"_missingOtherFields",destroy:true,get:true},{name:"_isIncludedInMailMerge",destroy:true,set:true},{name:"_isCurrentlySelected",destroy:true,set:true,get:true},{name:"_isCurrentlyEditing",destroy:true,get:true},{name:"_isRefreshingContact",destroy:true,get:true,set:true}],_initialize:function(){e.UI.Delegator.prototype._initialize.call(this);this._missingEmailFields=[];this._missingBoxFields=[];this._missingOtherFields=[];this._isIncludedInMailMerge=true;this._isCurrentlySelected=false;this._isCurrentlyEditing=false;this._isRefreshingContact=true;return this},setEmail:function(e){this._email=e;this._setupContact()},_setupContact:function(){this._isRefreshingContact=true;var t=this;var n=l.Contacts.getLatestContactInformation(this._email,function(e){if(e){t._contact.setWrappedObject(e)}t._isRefreshingContact=false;t._delegate.refresh();t._bindEventsToContactModel()});this._contact=new e.Model(n)},setBoxes:function(e){this._boxes=e;if(!this._boxes){return}if(this._boxes.length===1){this.setSelectedBox(this._boxes[0])}},setOtherFieldObjects:function(t){if(!this._otherFieldsModel){this._otherFieldsModel=new e.Model({});this._bindToOtherFieldsModel()}if(!t){return}for(var n=0;n<t.length;n++){this._otherFieldsModel.setWrappedObject(t[n])}},doneRefreshingContact:function(){this._isRefreshingContact=false;
this._delegate.refresh()},setSelectedBox:function(e){this._selectedBox=e;this._bindToBox();if(this._delegate){this._delegate.refresh()}},needsSelectedBox:function(){return this._selectedBox===null&&this._boxes&&this._boxes.length>1},isIncludedInMailMerge:function(){return this._isIncludedInMailMerge},setNotIncludedInMailMerge:function(){this._isIncludedInMailMerge=false;if(this._isCurrentlyEditing){this.setIsCurrentlyEditing(false)}else{this._delegate.refresh()}this._parentModel.includedEmailsModified()},isCurrentlyEditing:function(){return this._isCurrentlyEditing},setIsCurrentlyEditing:function(e){this._isCurrentlyEditing=e;this._delegate.refresh();this._parentModel.editingEntryIndexModified()},isRefreshingContact:function(){return this._isRefreshingContact},isFromCSV:function(){return false},getErrors:function(){var e=[];if(this._boxes&&this._boxes.length>0&&!this._selectedBox){e.push("NO_BOX_CHOSEN")}if(this.doesHaveMissingEmailFields()){e.push("MISSING_EMAIL_FIELDS")}if(this.doesHaveMissingBoxFields()){e.push("MISSING_BOX_FIELDS")}if(this.doesHaveMissingOtherFields()){e.push("MISSING_CSV_FIELDS")}return e},getMissingEmailFieldsErrorMessage:function(){var e=this.getMissingEmailFields();return l.Locale.getString("mm_email_info_missing",{info:e.join(", ")})},getMissingBoxFieldsErrorMessage:function(){var e=this.getMissingBoxFields();return l.Locale.getString("mm_following_fields_missing",{fields:e.join(", ")})},getMissingOtherFieldsErrorMessage:function(){var e=this.getMissingOtherFields();return l.Locale.getString("mm_following_fields_missing",{fields:e.join(", ")})},getMoreThanOneRowOrBoxMessage:function(){return l.Locale.getString(this.isFromCSV()?"mm_more_than_one_row":"mm_more_than_one_box")},getTemplateSubject:function(){if(this.isUsingCustomTemplate()){return this._overwrittenEmailTemplateSubject}if(this.needsSelectedBox()){return this.getMoreThanOneRowOrBoxMessage()}return l.Services.TemplateProcessor.getCompiledString(this._selectedBox,this._contact.getLatestObject(),this._getOtherFieldsObject(),this._parentModel.getTemplateSubject(),true)},getTemplateBody:function(){if(this.isUsingCustomTemplate()){return this._overwrittenEmailTemplateBody}if(this.needsSelectedBox()){return this.getMoreThanOneRowOrBoxMessage()}return l.Services.TemplateProcessor.getCompiledString(this._selectedBox,this._contact.getLatestObject(),this._getOtherFieldsObject(),this._parentModel.getTemplateBody())},isUsingCustomTemplate:function(){return n.isReal(this._overwrittenEmailTemplateBody)||n.isReal(this._overwrittenEmailTemplateSubject)},restore:function(){this._overwrittenEmailTemplateSubject=null;this._overwrittenEmailTemplateBody=null;this._delegate.refresh();this._parentModel.entryRestored()},update:function(){this._updateFields();this._delegate.refresh()},doesHaveMissingEmailFields:function(){return!this.isUsingCustomTemplate()&&this._missingEmailFields.length>0},doesHaveMissingBoxFields:function(){return!this.isUsingCustomTemplate()&&this._missingBoxFields.length>0},doesHaveMissingOtherFields:function(){return!this.isUsingCustomTemplate()&&this._missingOtherFields.length>0},getReferencedFields:function(){return this._parentModel.getReferencedFields()},isAbleToSetAsEditing:function(){return!this._parentModel.isEntryDetailBeingEdited()},_updateFields:function(){this._missingEmailFields.length=0;this._missingBoxFields.length=0;this._missingOtherFields.length=0;if(this.isUsingCustomTemplate()){return}this._checkReferencedEmailFields();this._checkReferencedBoxFields();this._checkReferencedOtherFields()},_checkReferencedEmailFields:function(){var e=this._parentModel.getReferencedFields();if(!e.email){return}for(var t in e.email){if(!this._contact.get(t)){this._missingEmailFields.push(t)}}},_checkReferencedBoxFields:function(){if(!this._selectedBox){return}var e=this._parentModel.getReferencedFields();if(!this._selectedBox||!e.box){return}for(var t in e.box){var n=e.box[t];this._checkReferencedBoxField(n)}},_checkReferencedBoxField:function(e){var t;if(e.columnType==="field"){t=this._selectedBox.getFieldDisplayTextValue(e.value.fieldKey)}else{t=this._selectedBox.getDisplayTextValue(e.value.property)}if(!t){this._missingBoxFields.push(e.name)}},_checkReferencedOtherFields:function(){if(!this._otherFieldsModel){return}var e=this._parentModel.getReferencedFields();if(!e.other){return}for(var t in e.other){if(!this._otherFieldsModel.get(t)){this._missingOtherFields.push(t)}}},_bindEventsToContactModel:function(){var e=this;this._contact.watch("change",function(){if(e.isCurrentlyEditing()){e._parentModel.currentlyEditingEntryDetailChanged();e._updateFields();e._delegate.refreshErrorsAndWarnings()}},this)},_bindToBox:function(){var e=this;if(!this._selectedBox){return}this._selectedBox.watch("change",function(){if(e.isCurrentlyEditing()){e._parentModel.currentlyEditingEntryDetailChanged();e._updateFields();e._delegate.refreshErrorsAndWarnings()}},this)},_bindToOtherFieldsModel:function(){var e=this;if(!this._otherFieldsModel){return}this._otherFieldsModel.watch("change",function(){if(e.isCurrentlyEditing()){e._parentModel.currentlyEditingEntryDetailChanged();e._updateFields();e._delegate.refreshErrorsAndWarnings()}},this)},_getOtherFieldsObject:function(){if(!this._otherFieldsModel){return null}return this._otherFieldsModel.getLatestObject()},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.UI.Delegator.prototype.destroy.call(this)}});l.Modules.MailMergeEntryDetailModel=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._delegate=null;this._element=null;this._errorsAndWarningsContainer=null;this._setup()};n.extend(u.prototype,{setDelegate:function(e){this._delegate=e},getElement:function(){return this._element},hide:function(){this._element.hide()},setEntryTitle:function(e){var t=e.get("fullName");var n=e.get("email");var i=t;if(i){i+=" &#60;"+n+"&#62;"}else{i=n}this._element.find(".__streak_MMContactName")[0].innerHTML=i},showBoxName:function(){this._element.find(".streak__mailMerge_boxName").show()},hideBoxName:function(){this._element.find(".streak__mailMerge_boxName").hide()},setBoxName:function(e){this._element.find(".streak__mailMerge_boxName")[0].innerHTML=e},hideFieldDetails:function(){this._element.find(".streak__boxDetailsMM").hide()},showFieldDetails:function(){this._element.find(".streak__boxDetailsMM").show()},clearFieldDetails:function(){this._element.find(".streak__boxDetailsMM").empty()},addInputField:function(e,n){var i=t(a.get("mm_box_detail_entry")({name:e}));i.find(".fieldValue").append(n.getElement());this._element.find(".streak__boxDetailsMM").append(i)},setRemoveLink:function(e){this._element.find(".streak__mailMerge_li_removeLink").append(e.getElement())},setEditLink:function(e){this._element.find(".streak__mailMerge_li_editLink").append(e.getElement())},hideEditLink:function(){this._element.find(".streak__mailMerge_li_editLink")[0].style.display="none"},showEditLink:function(){this._element.find(".streak__mailMerge_li_editLink")[0].style.display=""},setDoneLink:function(e){this._element.find(".streak__mailMerge_li_doneLink").append(e.getElement())},hideDoneLink:function(){this._element.find(".streak__mailMerge_li_doneLink")[0].style.display="none"},showDoneLink:function(){this._element.find(".streak__mailMerge_li_doneLink")[0].style.display=""},clearErrorsAndWarnings:function(){this._errorsAndWarningsContainer.empty()},showErrorsAndWarnings:function(){this._errorsAndWarningsContainer.show()},hideErrorsAndWarnings:function(){this._errorsAndWarningsContainer.hide()},addErrorMessage:function(e){var n=t(a.get("mm_error_div")({msg:e}));this._errorsAndWarningsContainer.append(n)},addWarningMessage:function(e){var n=t(a.get("mm_warning_div")({msg:e}));this._errorsAndWarningsContainer.append(n)},showRestore:function(e){var n=t(a.get("mm_warning_div")({msg:l.Locale.getString("mm_email_modified")}));n.append(e.getElement());this._errorsAndWarningsContainer.append(n)},showMoreThanOneBoxError:function(e,n){var i=t(a.get("mm_more_than_one_box")({moreBoxMessage:n}));i.append(e.getElement());this._errorsAndWarningsContainer.append(i)},destroy:function(){this._element.remove()}});n.extend(u.prototype,{_setup:function(){this._element=a.get("mm_EmailLI",true);this._errorsAndWarningsContainer=this._element.find("._streak_liErrorsAndWarnings")}});l.Modules.MailMergeEntryDetailView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(t){e.ViewControllerBase.call(this);this._view=null;this._dataSource=null;this._listViewController=null;this._entryIndex=t;this._removeLink=null;this._doneLink=null;this._editLink=null;this._errorsAndWarningsVisible=false;this._inputs=[];this._setupTheView()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{getView:function(){return this._view},setDataSource:function(e){this._dataSource=e;this._dataSource.setDelegate(this);this.refresh()},setListViewController:function(e){this._listViewController=e},_setupView:function(){},_setupTheView:function(){this._view=new l.Modules.MailMergeEntryDetailView;this._view.setDelegate(this);this._setupActionLinks()},_setupActionLinks:function(){this._setupRemoveLink();this._setupEditLink();this._setupDoneLink()},_setupRemoveLink:function(){var e=this;this._removeLink=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:l.Locale.getString("mm_remove"),onFunction:function(){e._dataSource.setNotIncludedInMailMerge();l.Tracker.track("mail merge entry removed")}});this._view.setRemoveLink(this._removeLink)},_setupEditLink:function(){var e=this;this._editLink=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:l.Locale.getString("edit").capitalize(),onFunction:function(){if(!e._dataSource.isAbleToSetAsEditing()){return}e._dataSource.setIsCurrentlyEditing(true);e._listViewController.lockRowSelection();l.Tracker.track("mail merge entry editing")}});this._view.setEditLink(this._editLink)},_setupDoneLink:function(){var e=this;this._doneLink=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:l.Locale.getString("done").capitalize(),onFunction:function(){e._dataSource.setIsCurrentlyEditing(false);e._listViewController.unlockRowSelection();l.Tracker.track("mail merge entry done editing")},useEventBubbling:true});this._view.setDoneLink(this._doneLink)},refresh:function(){this._clearInputs();if(!this._dataSource.isIncludedInMailMerge()){this._view.hide();return}this._view.setEntryTitle(this._dataSource.getContact());this._view.clearFieldDetails();this._view.hideFieldDetails();if(this._dataSource.isCurrentlyEditing()){this._renderFieldDetails()}this._refreshActionLinks();this._refreshErrorsAndWarningsSection();if(this._dataSource.getSelectedBox()&&!this._errorsAndWarningsVisible){this._view.showBoxName();this._view.setBoxName("Box: "+this._dataSource.getSelectedBox().displayName())}else{this._view.hideBoxName()}},refreshErrorsAndWarnings:function(){this._refreshErrorsAndWarningsSection()},_refreshActionLinks:function(){this._view.hideEditLink();this._view.hideDoneLink();if(this._dataSource.isCurrentlyEditing()){this._view.showDoneLink();return}if(!this._dataSource.needsSelectedBox()){this._view.showEditLink()}},_refreshErrorsAndWarningsSection:function(){this._view.clearErrorsAndWarnings();this._view.hideErrorsAndWarnings();this._renderAnyErrors()},_renderAnyErrors:function(){var e=false;if(this._dataSource.isRefreshingContact()){e=true;this._showRefreshingContactNotice()}if(this._dataSource.isUsingCustomTemplate()){e=true;this._setupRestoreButton()}if(this._dataSource.doesHaveMissingEmailFields()){e=true;this._showMissingEmailFieldErrors()}if(this._dataSource.doesHaveMissingBoxFields()){e=true;this._showMissingBoxFieldErrors()}if(this._dataSource.doesHaveMissingOtherFields()){e=true;this._showMissingOtherFieldErrors()}if(this._dataSource.needsSelectedBox()){e=true;this._setupBoxPicker()}if(e){this._view.showErrorsAndWarnings()}this._errorsAndWarningsVisible=e},_showRefreshingContactNotice:function(){this._view.addWarningMessage(l.Locale.getString("mm_getting_contact_info"))},_setupRestoreButton:function(){var e=this;var t=l.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:l.Locale.getString("mm_restore"),onFunction:function(){e._dataSource.restore();l.Tracker.track("mail merge entry restored")}});this._view.showRestore(t)},_showMissingEmailFieldErrors:function(){this._view.addErrorMessage(this._dataSource.getMissingEmailFieldsErrorMessage())},_showMissingBoxFieldErrors:function(){this._view.addErrorMessage(this._dataSource.getMissingBoxFieldsErrorMessage())},_showMissingOtherFieldErrors:function(){this._view.addErrorMessage(this._dataSource.getMissingOtherFieldsErrorMessage())},_setupBoxPicker:function(){var e=this;var t=this._dataSource.getBoxes();var i=l.Widgets.Menu.create();n.each(t,function(t){i.addItem(t.displayName(),function(){e._dataSource.setSelectedBox(t);r.off();l.Tracker.track("mail merge selected box chosen")})});var r=l.Widgets.Buttons.ButtonFactory.createMenuButton({type:"GmailArrow",menu:i,isFixedPosition:true,text:l.Locale.getString(this._dataSource.isFromCSV()?"mm_choose_a_row":"mm_choose_a_box")});this._view.showMoreThanOneBoxError(r,this._dataSource.getMoreThanOneRowOrBoxMessage())},_renderFieldDetails:function(){var e=this._dataSource.getReferencedFields();if(!e){return}this._renderEmailFields(e.email);this._renderBoxFields(e.box);this._renderOtherFields(e.other)},_renderEmailFields:function(e){for(var t in e){this._renderEmailField(t)}},_renderEmailField:function(e){var t=l.Widgets.SidebarTextarea.create({model:this._dataSource.getContact(),property:e,autoSave:false,useAutocomplete:false,border:"hover"});this._view.addInputField(l.Locale.getString("mm_"+e),t);this._inputs.push(t);this._view.showFieldDetails()},_renderOtherFields:function(e){for(var t in e){this._renderOtherField(t)}},_renderOtherField:function(e){var t=l.Widgets.SidebarTextarea.create({model:this._dataSource.getOtherFieldsModel(),property:e,autoSave:false,border:"hover"});this._view.addInputField(l.Locale.getString(e),t);this._inputs.push(t);this._view.showFieldDetails()},_renderBoxFields:function(e){for(var t in e){this._renderBoxField(e[t])}},_renderBoxField:function(e){var t;if(e.columnType==="property"){t=this._getBoxPropertyInput(e.value.property)}else{t=this._getBoxFieldInput(e.value.fieldKey)}this._view.addInputField(e.name,t);this._inputs.push(t);this._view.showFieldDetails()},_getBoxPropertyInput:function(e){switch(e){case"name":return this._getBoxNameInput();case"assignedToSharingEntries":return this._getBoxAssignedToInput();case"notes":return this._getNotesInput();case"stageKey":return this._getStageInput();default:return this._getGenericBoxPropertyInput()}},_getBoxNameInput:function(){return l.Widgets.SmartTextbox.create({model:this._dataSource.getSelectedBox(),property:"name",border:"gmailHover",autoGrow:false,allowEmpty:false})},_getBoxAssignedToInput:function(){return l.Widgets.SidebarAssignedTo.create({box:this._dataSource.getSelectedBox(),pipeline:this._dataSource.getSelectedBox().getPipeline(),border:"hover",includeNames:true})},_getNotesInput:function(){return l.Widgets.SidebarTextarea.create({model:this._dataSource.getSelectedBox(),property:"notes",border:"hover"})},_getStageInput:function(){return l.Widgets.StageButton.create({pipeline:this._dataSource.getSelectedBox().getPipeline(),box:this._dataSource.getSelectedBox(),trackingContext:{widgetContext:"mailMergeSidebar"}})},_getGenericBoxPropertyInput:function(e){return l.Widgets.SidebarTextarea.create({model:this._dataSource.getSelectedBox(),property:e,border:"gmailHover"})},_getBoxFieldInput:function(e){return l.Models.BoxField.getMailMergeInputWidget(this._dataSource.getSelectedBox(),e)},getEntryIndex:function(){return this._entryIndex},destroy:function(){this._clearInputs();this._view.destroy();this._removeLink.destroy();this._editLink.destroy();this._doneLink.destroy()},_clearInputs:function(){for(var e=0;e<this._inputs.length;e++){this._inputs[e].destroy()}this._inputs.length=0}});l.Modules.MailMergeEntryDetailViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){e.ViewControllerBase.call(this);this._element=null;this._setupElement()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{_setupElement:function(){this._element=a.get("mm_customize_each_email",true)},getElement:function(){return this._element},setInsertTagMenuButton:function(e){this._element.append(e.getElement())},destroy:function(){this._element.remove()}});l.Modules.MailMergeInsertTagView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._dataSource=null;this._delegate=null;this._view=null;this._tagListViewController=null;this._tagListViewControllerDataSource=null;this._tagMenuButton=null};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e},setDataSource:function(e){this._dataSource=e},setDelegate:function(e){this._delegate=e},aboutToProcessModification:function(){this._setup()},shouldProcessModification:function(){return this._delegate.shouldShowSidebar()},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"BOTTOM"},getModificationElement:function(){if(this._view){return this._view.getElement()}},mailMergeStateChanged:function(){this._composeWindowViewController.reloadModification(this)},_setup:function(){this._view=new s.Modules.MailMergeInsertTagView;this._setupTagMenu();this._setupTagMenuButton()},_setupTagMenu:function(){this._setupTagListViewDataSource();this._tagListViewController=new s.Widgets.ListView.ListViewViewController;this._tagListViewController.setDataSource(this);this._tagListViewController.addDelegate(this);this._tagListViewController.dataChanged()},_setupTagListViewDataSource:function(){this._tagListViewControllerDataSource=[{sectionTitle:s.Locale.getString("mm_from_email_addr"),rows:[{text:s.Locale.getString("mm_fullName"),tag:"email_fullName"},{text:s.Locale.getString("mm_givenName"),tag:"email_givenName"},{text:s.Locale.getString("mm_familyName"),tag:"email_familyName"},{text:s.Locale.getString("mm_email"),tag:"email_email"}]},{sectionTitle:s.Locale.getString("mm_more_fields"),rows:[]}];var e=this._dataSource.getFieldList();for(var t=0;t<e.length;t++){var n=e[t];this._tagListViewControllerDataSource[1].rows.push({text:n,tag:"field_"+n})}},getWrapperClass:function(){return"J-M uEPqDe bb_menu streak__mailMerge_insertTag"},numberOfSections:function(){return 2},numberOfRowsForSection:function(e){return this._tagListViewControllerDataSource[e].rows.length},sectionShouldShow:function(){return true},sectionTitle:function(e){return this._tagListViewControllerDataSource[e].sectionTitle},infoForRow:function(e,t){return this._tagListViewControllerDataSource[e].rows[t]},rowPressed:function(e){var t="{{"+e.tag+"}}";var n=t;var i=t;if(this._dataSource.isEntryDetailBeingEdited()){var r=this._dataSource.getCurrentlyEditedEntryDetail();n=s.Services.TemplateProcessor.getCompiledString(r.getSelectedBox(),r.getContact(),t,true);i=s.Services.TemplateProcessor.getCompiledString(r.getSelectedBox(),r.getContact(),t)}this._composeWindowViewController.addTextAtCurrentCursorPosition(i,n);this._tagMenuButton.off();s.Tracker.track("mail merge tag inserted")},_setupTagMenuButton:function(){var e=this;this._tagMenuButton=s.Widgets.Buttons.ButtonFactory.createMenuButton({type:"Text",color:"lightblue",text:s.Locale.getString("mm_insert_tmpl"),isFixedPosition:true,isBottomAligned:true,isRightAligned:true,menu:this._tagListViewController.getView(),preOnFunction:function(){e._tagListViewController.reset();s.Tracker.track("mail merge tag menu open")}});this._view.setInsertTagMenuButton(this._tagMenuButton)},destroy:function(){if(this._view){this._view.destroy()}if(this._tagListViewController){this._tagListViewController.destroy()}if(this._tagMenuButton){this._tagMenuButton.destroy()}this._composeWindowViewController=null}});s.Modules.MailMergeInsertTagViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MailMergeSendStatsViewController",superclass:c.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_dataSource",destroy:false,set:true},{name:"_delegate",destroy:false,set:true},{name:"_pipelineButton",destroy:true}],_initialize:function(){c.Modules.ComposeViewControllerBase.prototype._initialize.call(this);return this},_setupView:function(){},initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){return this._delegate.shouldShowSidebar()},aboutToProcessModification:function(){if(!this._view){this._setupTheView()}},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"RECIPIENTS_OVERLAY"},getModificationHeight:function(){return"65px"},getModificationElement:function(){if(!this._view){return null}return this._view.getElement()},mailMergeStateChanged:function(){this._composeWindowViewController.reloadModification(this)},includedEmailsModified:function(){this._renderStats()},_setupTheView:function(){this._view=i.getInstance("BentoBox.Modules.MailMergeSendStatsView");this._renderStats();if(this._dataSource.isUsingCSVFile()){this._view.hideBoxNotice();return}this._setupPipelineButton();this._setupChooseBoxesLink()},_renderStats:function(){this._view.setStats(this._dataSource.getNumberOfEmailsExtracted(),this._dataSource.getNumberOfBoxesSelected())},_setupPipelineButton:function(){this._pipelineButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"GmailArrow",text:this._dataSource.getPipeline().displayName()});this._pipelineButton.disable();this._view.setPipelineButton(this._pipelineButton)},_setupChooseBoxesLink:function(){var e=this;this._chooseBoxesLink=c.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:c.Locale.getString("mm_choose_boxes_2"),onFunction:function(){e._delegate.pipelineChosen(e._dataSource.getPipeline());c.Tracker.track("mail merge choose boxes",{stage:"edit template"})}});this._view.setChooseBoxesLink(this._chooseBoxesLink)}});i.set("BentoBox.Modules.MailMergeSendStatsViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._setupElement();return this},_setupElement:function(){this._element=o.get("mailMergeSendStatsView",true)},setStats:function(e,t){this._element.find(".streak__mailMerge_emailAddressesStat")[0].innerHTML=c.Locale.getString("mailMerge_emailAddress_stats",{number:e});this._element.find(".streak__mailMerge_selectedNotice")[0].innerHTML=c.Locale.getString("mailMerge_box_stats",{number:t,pluralize:[t]})},hideBoxNotice:function(){this._element.find(".streak__mailMerge_selectedNotice").hide()},setPipelineButton:function(e){this._element.find(".streak__mailMerge_pipelineButton").append(e.getElement())},setChooseBoxesLink:function(e){this._element.find(".streak__mailMerge_chooseBoxes").append(e.getElement())}});i.set("BentoBox.Modules.MailMergeSendStatsView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=5*1e3;var h=d+10*1e3;var f=e.Class.subclass({superclass:c.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_dataSource",destroy:false,set:true}],_initialize:function(){c.Modules.ComposeViewControllerBase.prototype._initialize.call(this);return this},startSending:function(){var e=this;this._setupTheView();var t=this._generateEmailPackages();c.MailHelper.sendMultipleEmails({emailPackages:t,delayBetweenEmails:d,startSendingCallback:function(t){e._emailsStartedToSend(t)},sendingEmail:function(t){e._sendingEmail(t)},emailSentCallback:function(t,n,i){e._emailSent(t,n,i)},finishedSendingCallback:function(){e._delegate.finishedSending()}});var n=this._dataSource.isUsingCSVFile()?"csv":"boxes";c.Tracker.track("mail merge sending emails",{count:t.length,method:n})},cancelClicked:function(){this._view.hide();this._delegate.cancel();c.MailHelper.cancelSending();c.Tracker.track("mail merge cancelled",{stage:"sending"})},_setupTheView:function(){this._view=i.getInstance("BentoBox.Modules.MailMergeSenderView");this._view.setDelegate(this)},_emailsStartedToSend:function(e){this._view.show();this._view.updateNumberOfEmailsSentAndLeft(0,e)},_sendingEmail:function(e){this._view.updateSendingTo(c.Locale.getString("mail_merge_sending_to",{address:e.toAddresses[0]}))},_emailSent:function(e,t,n){this._dataSource.markEmailSent(e);this._renderStats(e,t)},_renderStats:function(e,t){var n=e+1;this._view.updateNumberOfEmailsSentAndLeft(n,n+t);this._view.updateTimeLeft(t*h)},_generateEmailPackages:function(){var e=this;var t=this._dataSource.getEntryDetailModels();return n.chain(t).filter(function(e){return e.isIncludedInMailMerge()}).map(function(t){return e._generateEmailPackage(t)}).value()},_generateEmailPackage:function(e){var t;if(e.getSelectedBox()){t=e.getSelectedBox().key()}var n={toAddresses:[e.getContact().get("email")],boxKey:t,body:e.getTemplateBody(),subject:e.getTemplateSubject(),snippetKeyList:this._dataSource.getSnippetKeyList(),mailMergeId:this._dataSource.getMailMergeId()};if(this._dataSource.isPixelTracked()){n.pixelTrackingGuid=c.PixelTrackingHTMLGenerator.getGuid();n.body+=c.PixelTrackingHTMLGenerator.getTrackingHTML(n.pixelTrackingGuid);n.isPixelTracked=true}return n},destroy:function(){c.Modules.ComposeViewControllerBase.prototype.destroy.call(this)}});i.set("BentoBox.Modules.MailMergeSenderViewController",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[{name:"_innerElement",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._setupElement();return this},_setupElement:function(){this._innerElement=o.get("mm_ENDING",true);var e=this;this._element=c.Widgets.Tour.Bar.create({html:this._innerElement,showRightButton:false,showLeftButton:false,showLink:true,cancelFunc:function(){e._delegate.cancelClicked()}})},updateNumberOfEmailsSentAndLeft:function(e,t){this._innerElement.find(".__streakMMRemainder")[0].innerHTML=c.Locale.getString("mailMerge_emailsLeft",{number:e,total:t,pluralize:[e,t]})},updateTimeLeft:function(e){var t=parseInt(e/1e3);var n=parseInt(t/60);t=t-n*60;var i=null;if(n>0){i=c.Locale.getString("mm_minutes",{minutes:n,seconds:t,pluralize:[n,t]})}else{i=c.Locale.getString("mm_just_seconds",{seconds:t,pluralize:[t]})}this._innerElement.find(".__streakMMTimeLeft")[0].innerHTML=i},updateSendingTo:function(e){this._innerElement.find(".streak__mailMerge_sendingTo")[0].innerHTML=e},show:function(){this._element.show()},hide:function(){this._element.hide()}});i.set("BentoBox.Modules.MailMergeSenderView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HeadsUpMenu",superclass:e.Object,_memberVariables:[{name:"_menu",destroy:true},{name:"_menuItems",destroy:false,defaultValue:{}},{name:"_currentHeadsUpSetting",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._menu=c.Widgets.Menu.create();this._addSizeChoices();this._menu.addSeparator();this._addVisibilityToggle()},setup:function(e){this._currentHeadsUpSetting=e;this._menu.reset();this._menuItems.sizes[""+(e.maxVisible||5)].select();this._menuItems.hideEmpty.setCheckboxState(e.hideEmpty)},getElement:function(){return this._menu.getElement()},_addSizeChoices:function(){var e=this._menu.addRadioGroup("headsup_show_up_to",c.Locale.getString("headsup_show_up_to"));this._menuItems.sizes={};this._menuItems.sizes["5"]=this._menu.addRadioItem(c.Locale.getString("headsup_number_boxes",{number:5}),e,this._sizeChanged(5),false);this._menuItems.sizes["10"]=this._menu.addRadioItem(c.Locale.getString("headsup_number_boxes",{number:10}),e,this._sizeChanged(10),false);this._menuItems.sizes["25"]=this._menu.addRadioItem(c.Locale.getString("headsup_number_boxes",{number:25}),e,this._sizeChanged(25),false);this._menuItems.sizes["50"]=this._menu.addRadioItem(c.Locale.getString("headsup_number_boxes",{number:50}),e,this._sizeChanged(50),false)},_sizeChanged:function(e){var t=this;return function(){t._currentHeadsUpSetting.maxVisible=e;t._saveUpdatedSettings();l.postNotification({sender:t,eventName:"headsUpMaxVisibleChanged",viewKey:t._currentHeadsUpSetting.viewKey})}},_addVisibilityToggle:function(){var e=this;this._menuItems.hideEmpty=this._menu.addCheckItem(c.Locale.getString("hide_section_empty"),function(t){e._currentHeadsUpSetting.hideEmpty=t;e._saveUpdatedSettings();l.postNotification({sender:e,eventName:"hideOnEmptyChanged",hideEmpty:t,viewKey:e._currentHeadsUpSetting.viewKey})})},_saveUpdatedSettings:function(){var e=this._currentHeadsUpSetting.viewKey;var t=c.getUser().getHeadsUpSections();var i=t.find(function(t){return t.viewKey===e});n.extend(i,this._currentHeadsUpSetting);c.getUser().saveHeadsUpSections(t)}});e.DependencyManager.addFunction({functionKey:"headsUpMenuInitialized",functionReference:function(){i.set("BentoBox.Modules.HeadsUpMenu",new d)},dependentFunctionKeys:["menuInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"HeadsUpMasterController",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);a.inboxSDK.Router.handleListRoute(a.inboxSDK.Router.NativeRouteIDs.INBOX,this._handleInbox.bind(this))},addSection:function(e,t){var n=d.getUser().getHeadsUpSections();var i={viewKey:e,pipelineKey:t,isVisible:true};n.push(i);d.getUser().saveHeadsUpSections(n);u.postNotification({sender:this,eventName:"headsUpSectionAdded",headsUpSetting:i})},removeSection:function(e){var t=d.getUser().getHeadsUpSections();var n=t.find(function(t){return t.viewKey===e});if(n){t.removeVal(n);d.getUser().saveHeadsUpSections(t);u.postNotification({sender:this,eventName:"headsUpSectionRemoved",viewKey:e})}},_handleInbox:function(e){var t=d.getUser().getHeadsUpSections();t.forEach(this._setupHeadsUpSection.bind(this,e));u.getNotificationStream().takeUntil(i.fromBinder(function(t){e.on("destroy",t);return function(){}})).filter(function(e){return e.eventName==="headsUpSectionAdded"}).map(".headsUpSetting").onValue(this,"_setupHeadsUpSection",e)},_setupHeadsUpSection:function(e,t){var n=new d.Modules.HeadsUpSectionController(e,t);e.on("destroy",function(){n.destroy()})}});e.DependencyManager.addFunction({functionKey:"headsUpInitialized",functionReference:function(){r.set("BentoBox.Modules.HeadsUpMasterController",new h)},dependentFunctionKeys:["gmailLoaded","data.pipelines.initialized","data.boxes.initialized","htmlLoaded"]})})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"HeadsUpSectionController",superclass:e.Object,_memberVariables:[{name:"_listRouteView",destroy:false},{name:"_headsUpSetting",destroy:false},{name:"_pipeline",destroy:false},{name:"_savedView",destroy:false},{name:"_headsUpBoxesDataController",destroy:true},{name:"_transformedDataStream",destroy:false},{name:"_collapsibleSectionView",destroy:true},{name:"_stopbus",destroy:true},{name:"_stopper",destroy:false},{name:"_pipelineNameChangedStream",destroy:false},{name:"_maxVisibleChangedStream",destroy:false}],_initialize:function(t,n){e.Object.prototype._initialize.call(this);
this._listRouteView=t;this._headsUpSetting=n;this._pipeline=d.Data.getPipeline(n.pipelineKey);if(!this._pipeline){return}this._savedView=this._pipeline.getSavedView(n.viewKey);if(!this._savedView){return}this._stopbus=new i.Bus;this._stopper=this._stopbus.filter(false).mapEnd();this._headsUpBoxesDataController=new d.Modules.HeadsUpBoxesDataController(n.pipelineKey);this._headsUpBoxesDataController.runDataTransforms(this._getTransformSettings());this._transformedDataStream=this._setupTransformedDataStream();this._pipelineNameChangedStream=this._setupPipelineNameChangedStream();this._maxVisibleChangedStream=this._setupMaxVisibleChangedStream();this._handleVisibilityChanges();if(this._getNumberOfBoxes(this._headsUpBoxesDataController.getTransformedData())>0||!this._headsUpSetting.hideEmpty){this._setupCollapsibleSection()}this._detectHeadsUpRemove()},_setupTransformedDataStream:function(){var e=this;var t=this._headsUpBoxesDataController;var n=this._savedView.viewKey;return t.getEventStream().merge(e._pipeline.getEventStream().filter(function(e){return e.eventName==="savedViewChanged"&&e.viewKey===n}).map(1)).map(function(){t.runDataTransforms(e._getTransformSettings());return t.getTransformedData()}).takeUntil(this._stopper)},_getTransformSettings:function(){return{groupByTransform:d.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.convertSettings(this._savedView.settings.groupBySettings),sortTransform:d.Modules.PipelineView.ViewSettings.SortSettings.convertSettings(this._savedView.settings.sortSettings),filterTransform:d.Modules.PipelineView.ViewSettings.FilterSettings.convertSettings(this._savedView.settings.filterSettings)}},_setupPipelineNameChangedStream:function(){var e=this._savedView.viewKey;var t=this._pipeline;return t.getEventStream().filter(function(e){return e.eventName==="change"&&e.property==="name"}).takeUntil(this._stopper)},_setupMaxVisibleChangedStream:function(){var e=this._savedView.viewKey;return u.getNotificationStream().filter(function(t){return t.viewKey===e&&t.eventName==="headsUpMaxVisibleChanged"}).takeUntil(this._stopper)},_handleVisibilityChanges:function(){var e=this._savedView.viewKey;var t=this;u.getNotificationStream().filter(function(t){return t.viewKey===e&&t.eventName==="hideOnEmptyChanged"}).map(".hideEmpty").doAction(function(e){t._headsUpSetting.hideEmpty=e}).takeUntil(this._stopper).onValue(function(){var e=t._headsUpSetting.hideEmpty;var n=t._headsUpBoxesDataController.getTransformedData();if(e&&t._collapsibleSectionView&&t._getNumberOfBoxes(n)===0){t._collapsibleSectionView.remove();t._collapsibleSectionView=null}else if(!e&&!t._collapsibleSectionView){t._setupCollapsibleSection()}})},_setupCollapsibleSection:function(){var e=i.mergeAll(this._transformedDataStream,this._pipelineNameChangedStream,this._maxVisibleChangedStream);var t=this._listRouteView.addCollapsibleSection(e.takeUntil(this._stopper).startWith(1).map(this,"_getDescriptor"));this._collapsibleSectionView=t;var n=this;e.takeWhile(function(){return n._collapsibleSectionView===t}).startWith(1).takeUntil(this._stopper).map(function(){return n._getTableRows()}).onValue(function(e){t.setTableRows(e)});t.setCollapsed(!this._headsUpSetting.isVisible);t.on("collapsed",function(){n._headsUpSetting.isVisible=false;n._saveUpdatedSettings()});t.on("expanded",function(){n._headsUpSetting.isVisible=true;n._saveUpdatedSettings()})},_getDescriptor:function(){var e=this._headsUpBoxesDataController.getTransformedData();var t=this._getNumberOfBoxes(e);var n="";if(t>0){n="1–"+Math.min(parseInt(this._headsUpSetting.maxVisible||5,10),t)+" of "+t}var i=this;return{title:this._savedView.name,subtitle:this._pipeline.displayName(),summaryText:n,hasDropdown:true,onSummaryClick:function(){a.inboxSDK.Router.goto(i._pipeline.link(i._savedView.viewKey))},onDropdownClick:function(e){d.Modules.HeadsUpMenu.setup(i._headsUpSetting);e.dropdown.el.appendChild(d.Modules.HeadsUpMenu.getElement()[0])}}},_getNumberOfBoxes:function(e){return n.chain(e.lists).values().pluck("list").flatten(true).value().length},_getTableRows:function(){var e=this._headsUpBoxesDataController.getTransformedData();var t=this._headsUpSetting;return n.chain(e.groups).map(function(i){return n.first(e.lists[i].list,parseInt(t.maxVisible||5,10)).map(function(e){return{box:e,group:i}})}).flatten().first(parseInt(t.maxVisible||5,10)).map(function(t){var n=t.box;var i=t.group;return{labels:[{title:e.lists[i].displayName(),backgroundColor:e.lists[i].color.backgroundColor,foregroundColor:e.lists[i].color.textColor}],title:n.displayName(),iconClass:"streak__boxSearchResultIcon",body:d.Services.BoxDisplayText.getDetailsText(n),shortDetailText:n.getPipeline().displayName(),routeID:"box/:key",routeParams:{key:n.key()},onClick:function(){d.Tracker.track("boxLinkClicked",{source:"heads up result"})}}}).value()},_detectHeadsUpRemove:function(){var e=this._savedView.viewKey;u.getNotificationStream().takeUntil(this._stopper).filter(function(t){return t.eventName==="headsUpSectionRemoved"&&t.viewKey===e}).onValue(this,"destroy")},_saveUpdatedSettings:function(){var e=this._savedView.viewKey;var t=d.getUser().getHeadsUpSections();var i=t.find(function(t){return t.viewKey===e});n.extend(i,this._headsUpSetting);d.getUser().saveHeadsUpSections(t)}});r.set("BentoBox.Modules.HeadsUpSectionController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"HeadsUpBoxesDataController",superclass:e.UI.Delegator,_memberVariables:[{name:"_pipeline",destroy:false},{name:"_transformedData",destroy:false,get:true,defaultValue:{}}],runDataTransforms:function(e){this._runDataTransforms(e)},_initialize:function(t){e.UI.Delegator.prototype._initialize.call(this);this._pipeline=d.Data.getPipeline(t);this._bindToModelChanges();this._eventStream=new i.Bus},_runDataTransforms:function(e){d.Data.getPipelineBoxes(this._pipeline.key()).sortByParameter("lastUpdatedTimestamp");this._initializedTransformedData();this._applyTransforms(e)},_initializedTransformedData:function(){this._transformedData.columns={};this._transformedData.columnOrder=[];this._transformedData.lists={novalue:{isEditable:false,groupModel:null,list:(d.Data.getPipelineBoxes(this._pipeline.key())||[]).slice(0),color:null,isOpen:true}};this._transformedData.groups=["novalue"]},_applyTransforms:function(e){var t=n.flatten(n.values(d.Modules.PipelineTransformRegister.getNamedTransforms()));if(!t){return}var i=this._pipeline;var r=this._transformedData;n.chain(t).sortBy(function(e){if(!e.priority){return 100}return e.priority}).each(function(t){var n;if(e){n=e[t.transformName]}t(i,r,null,n)})},_bindToModelChanges:function(){this._bindToBoxCollectionChanges();this._bindToPipelineChanges()},_bindToBoxCollectionChanges:function(){var e=d.Data.getPipelineBoxes(this._pipeline.key());var t=this;e.watch("change",this._boxChanged,this);e.watch("collectionChange",this._boxCollectionChanged,this);e.watch("collectionRefreshed",function(e){if(e.didCollectionChange){this._boxCollectionChanged()}},this)},_boxChanged:function(e){if(e.transactionId){return}var t=e.model;var n=e.property;var i=e.previousValue;var r=e.property;if(n==="pipelineKey"){return}if(!t||!t.key||!t.key()){return}this._eventStream.push({eventName:"boxDataChanged",headsUpBoxesDataController:this})},_boxCollectionChanged:function(e){if(e.transactionId){return}this._eventStream.push({eventName:"boxDataChanged",headsUpBoxesDataController:this})},_bindToPipelineChanges:function(){this._pipeline.watch("calculationComplete",function(){this._eventStream.push({eventName:"boxDataChanged",headsUpBoxesDataController:this})},this)}});r.set("BentoBox.Modules.HeadsUpBoxesDataController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"NavMenuController",superclass:e.Object,_memberVariables:[{name:"_pipelineToNavItemMap",destroy:false,defaultValue:{}},{name:"_savedViewToNavItemMap",destroy:false,defaultValue:{}},{name:"_pipelinesNavItem",destroy:true},{name:"_hiddenPipelinesNavItem",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);e.DependencyManager.addFunction({functionKey:"navMenu.pipelineNavItemInitialized",functionReference:this._createPipelinesNavItem,functionContext:this,dependentFunctionKeys:["userLoggedIn","userSettingsInitialized"]});e.DependencyManager.addFunction({functionKey:"navMenu.pipelinesLoaded",functionReference:this._setupPipelines,functionContext:this,dependentFunctionKeys:["data.pipelines.initialized","navMenu.pipelineNavItemInitialized"]});this._bindToDataEvents()},teardown:function(){},reup:function(){},open:function(){this._pipelinesNavItem.setCollapsed(false)},_createPipelinesNavItem:function(){var e=this;this._pipelinesNavItem=a.inboxSDK.NavMenu.addNavItem({name:d.Locale.getString("pipelines"),iconClass:"bentoBoxIndicator",orderHint:2,accessory:{type:"CREATE",onClick:function(){d.Widgets.NewPipelineModal.show({title:d.FirstRun.getStage()===1?d.Locale.getString("left_link_setup_first"):d.Locale.getString("left_link_make_new"),pipelineSavedCallback:function(e){a.inboxSDK.Router.goto(e.link())}})}}});this._pipelinesNavItem.on("expanded",function(){d.Data.getAllPipelines().refresh()})},_setupPipelines:function(){d.Data.getAllPipelines().forEach(this._setupPipeline.bind(this))},_bindToDataEvents:function(){var e=d.Data.getAllPipelines().getEventStream().filter(function(e){return e.eventName==="add"}).map(".model");e.filter(function(e){return!!e.key()}).onValue(this,"_setupPipeline");e.filter(function(e){return!e.key()}).flatMap(function(e){return e.getEventStream().filter(function(e){return e.eventName==="keyChanged"}).take(1).map(e)}).onValue(this,"_setupPipeline");d.Data.getAllPipelines().getEventStream().filter(function(e){return e.eventName==="remove"}).map(".model").onValue(this,"_pipelineRemoved")},_pipelineAdded:function(e){var t=e.model;var n=d.UserSettings.get("leftLink/pipelineSort");n.unshift(t.key());d.UserSettings.set("leftLink/pipelineSort",n);this._setupPipeline(t)},_setupPipeline:function(e){var t=f(e);var n=this._getPipelineHolder(e).addNavItem(e.getEventStream().filter(function(e){return e.eventName==="set"&&e.property==="name"||e.eventName==="uiSettingChanged"||e.eventName==="navMenuOrderChanged"}).map(t).startWith(t()).delay(1));n.setCollapsed(d.LocalSettings.get("leftLink/savedViewCollapseState/"+e.key())===false);n.on("collapsed",function(){d.LocalSettings.set("leftLink/savedViewCollapseState/"+e.key(),false)});n.on("expanded",function(){d.LocalSettings.set("leftLink/savedViewCollapseState/"+e.key(),true)});this._setupSavedViews(e,n);this._pipelineToNavItemMap[e.key()]=n;var i=e.getEventStream().filter(function(e){return e.eventName==="hiddenSettingChanged"}).map(".model");i.take(1).onValue(this,"_pipelineRemoved");i.take(1).delay(1).onValue(this,"_setupPipeline")},_pipelineRemoved:function(e){this._pipelineToNavItemMap[e.key()].remove();this._pipelineToNavItemMap[e.key()]=null;var t=e.getSavedViews();var i=this._savedViewToNavItemMap;t.forEach(function(e){i[e.viewKey].remove();i[e.viewKey]=null});if(this._hiddenPipelinesNavItem&&!n.any(d.Data.getAllPipelines(),function(e){return e.isHidden()})){this._hiddenPipelinesNavItem.remove();this._hiddenPipelinesNavItem=null}},_setupSavedViews:function(e,t){var n=e.getEventStream().filter(function(e){return e.eventName==="hiddenSettingChanged"});e.getEventStream().filter(function(e){return e.eventName==="savedViewAdded"}).map(".savedView").takeUntil(n).merge(i.fromArray(e.getSavedViews())).onValue(this,"_setupSavedView",e,t);e.getEventStream().filter(function(e){return e.eventName==="savedViewRemoved"}).map(".savedView").takeUntil(n).onValue(this,"_savedViewRemoved")},_savedViewAdded:function(e,t,n){var i=n.savedView;this._setupSavedView(e,t,i)},_setupSavedView:function(e,t,n){var i=p(e,n);var r=t.addNavItem(e.getEventStream().filter(function(e){return e.eventName==="savedViewChanged"&&e.viewKey===n.viewKey}).map(i).startWith(i()).delay(1));this._savedViewToNavItemMap[n.viewKey]=r},_savedViewRemoved:function(e){this._savedViewToNavItemMap[e.viewKey].remove();this._savedViewToNavItemMap[e.viewKey]=null},_getPipelineHolder:function(e){if(e.isHidden()){return this._getHiddenPipelinesHolder()}else{return this._pipelinesNavItem}},_getHiddenPipelinesHolder:function(){if(!this._hiddenPipelinesNavItem){this._hiddenPipelinesNavItem=this._pipelinesNavItem.addNavItem({name:d.Locale.getString("left_link_hidden_pipelines")});this._hiddenPipelinesNavItem.setCollapsed(true)}return this._hiddenPipelinesNavItem}});function f(e){return function(){var t=d.UI.getSortedPipelineKeys().indexOf(e.key());var n=e.isDefaultColor()?{}:e.getColor();return{name:e.displayNameText(),orderHint:t,routeID:"pipeline/:key",routeParams:{key:e.key()},onClick:function(){d.Modules.PipelineView.SavedViewsController.clearLastViewKey(e)},accessory:{type:"DROPDOWN_BUTTON",buttonBackgroundColor:n.backgroundColor,buttonForegroundColor:n.textColor,onClick:function(t){d.Modules.PipelineMenu.setCurrentPipeline(e);t.dropdown.el.appendChild(d.Modules.PipelineMenu.getElement()[0])}}}}}function p(e,t){return function(){var i=n.chain(e.getSavedViews()).sortBy(function(e){return e.name}).pluck("viewKey").value();return{name:t.name,routeID:"pipeline/:key/:viewKey",routeParams:{key:e.key(),viewKey:t.viewKey},orderHint:t.isUnsaved?-2:i.indexOf(t.viewKey),accessory:{type:"DROPDOWN_BUTTON",onClick:function(n){d.Modules.SavedViewsMenu.setCurrentPipelineAndSavedView(e,t);n.dropdown.el.appendChild(d.Modules.SavedViewsMenu.getElement()[0])}}}}}e.DependencyManager.addFunction({functionKey:"navMenuInitialized",functionReference:function(){r.set("BentoBox.Modules.NavMenuController",new h)},dependentFunctionKeys:["gmailLoaded","htmlLoaded","leftLink.pipelineMenuInitialized","leftLink.savedViewsMenuInitialized","newPipelineModalInitialized","pipelineViewInitialized"]})})(Streak);(function(e){var t=e._,n=e.Library,i=e.DependencyManager,r=e.BentoBox,a=e.Locale;var o=2;var s=e.Class.subclass({superclass:e.BentoBox.Services.FeatureLimiter,_memberVariables:[],_initialize:function(){e.BentoBox.Services.FeatureLimiter.prototype._initialize.call(this)},_getFeatureKey:function(){return"linkedBoxes"},_getGatewayTitle:function(){return a.getString("linked_boxes_gateway_title")},_getGatewayBodyText:function(){return a.getString("linked_boxes_gateway_text")},_getLimit:function(){return o}});i.addFunction({functionKey:"LinkedBoxesLimiterInitialized",functionReference:function(e){n.set("BentoBox.Services.LinkedBoxesLimiter",new s)},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.APIRequester,a=e.Locale,o=e.BentoBox;var s={init:function(e){this._isTornDown=false;i.InboxManipulator.addDataSource(this);o.Data.getAllPipelines().watch("colorChanged",function(){i.InboxManipulator.refreshAll()},this);if(e){e()}},teardown:function(){this._isTornDown=true},reup:function(){this._isTornDown=false},getRowManipulation:function(e){if(this._isTornDown){return}var t=o.Services.Threads.ThreadStorer.getBoxKey(e);if(!t){return}var n=o.Data.getBox(t);if(n&&n.getPipeline&&n.getPipeline()){return new LabelIndicatorRowManipulation(n)}}};LabelIndicatorRowManipulation=function(e){i.InboxManipulator.InboxRowManipulationBase.call(this);this._box=e;this._pipeline=e.getPipeline();this._element=null;this._setupElement()};LabelIndicatorRowManipulation.prototype=Object.create(i.InboxManipulator.InboxRowManipulationBase.prototype);n.extend(LabelIndicatorRowManipulation.prototype,{_setupElement:function(){this._element=[];this._addBoxTag();this._addStageTag();this._addPipelineTag()},_addPipelineTag:function(){if(!this._isSettingValuePresent("default")&&!this._isSettingValuePresent("pipeline")){return}var e=this._pipeline.getColor();var t=this._getLabelTag(this._pipeline.displayNameText(),e,"streak__pipeline_bentoBoxRow");this._element.push(t)},_addStageTag:function(){if(!this._isSettingValuePresent("stage")){return}var e=this._getLabelTag(this._box.getStage().displayNameText(),this._getStageColor(),"streak__stage_bentoBoxRow");this._element.push(e)},_getStageColor:function(){var e=o.UI.getStageColors(this._pipeline)[this._box.get("stageKey")];if(!e){return this._getDefaultOrangeColor()}return e},_addBoxTag:function(){if(!this._isSettingValuePresent("box")){return}var e=this._getLabelTag(this._box.displayNameText(),this._getBoxColor(),"streak__box_bentoBoxRow");this._element.push(e)},_getBoxColor:function(){return this._getDefaultOrangeColor()},_getDefaultOrangeColor:function(){return{backgroundColor:"rgb(255, 173, 71)",textColor:"rgb(0, 0, 0)"}},_getLabelTag:function(e,n,r){var a=i.widgets.getLabelTag(e,n.backgroundColor,n.textColor);a.addClass("bentoBoxRowIndicator "+r);a.find(".at").prepend(t("<div/>").addClass("maskedIcon").css("background-color",n.textColor));a[0].setAttribute("data-tooltip",e);return a},_isSettingValuePresent:function(e){var t=o.Data.streakSettings.getSetting("list_indicator_setting_name");if(!t){return false}var n=t.selectedValues;if(!n){return false}return n.indexOf(e)>-1},getManipulationType:function(){return"PREPEND_ELEMENT"},getColumnName:function(){return"LABELS"},getElement:function(){return this._element}});e.DependencyManager.addFunction({functionKey:"labelIndicatorsInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["inboxManipulatorInitialized","data.pipelines.initialized"]});o.Modules.LabelIndicators=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.APIRequester,a=e.Locale,o=e.BentoBox;var s=PixelTrackerIndicators={init:function(e){if(!o.Services.PixelTrackingLimiter.isTrackingEnabled()){if(e){e()}return}i.InboxManipulator.addDataSource(s);this._isTornDown=false;if(e){e()}},teardown:function(){this._isTornDown=true},reup:function(){this._isTornDown=false},getRowManipulation:function(e,t){if(o.Modules.PixelTrackerUtils.isRecentViewsResultsPage()){return}if(this._isTornDown){return}var n=o.Services.Threads.ThreadStorer.getTrackedThread(e);if(!n){return}return new PixelTrackerIndicatorRowManipulation(n,t)}};PixelTrackerIndicatorRowManipulation=function(e,t){i.InboxManipulator.InboxRowManipulationBase.call(this);this._listTrackedThread=e;this._threadDOMRow=t;this._element=null;this._setupElement()};PixelTrackerIndicatorRowManipulation.prototype=Object.create(i.InboxManipulator.InboxRowManipulationBase.prototype);n.extend(PixelTrackerIndicatorRowManipulation.prototype,{_setupElement:function(){if(!this._threadDOMRow||!this._threadDOMRow.starHolder){return}var e=t("<span class='as ar streak__pt_eye_indicator'>   </span>");if(this._listTrackedThread.totalViews>0){e.addClass("streak__pt_eye_indicator_viewed");if(this._isLastViewDateRecent(this._listTrackedThread.newestViewDate)){e.addClass("streak__pt_eye_indicator_viewedRecently")}}else{e.removeClass("streak__pt_eye_indicator_viewed")}if(this._threadDOMRow.type==="vertical"){e.addClass("streak__pt_eye_indicator_verticalPreviewPane");this._threadDOMRow.starHolder.addClass("streak__pt_eye_holder")}else if(this._doesRowHaveAttachment()){e.addClass("streak__pt_eye_indicator_withAttachment")}e[0].setAttribute("data-tooltip",this._getViewCountString(this._listTrackedThread.totalViews));if(this._threadDOMRow.attachmentsContainer){this._threadDOMRow.attachmentsContainer.addClass("streak__pt_eye_indicator_present")}this._element=e},_isLastViewDateRecent:function(t){var n=e.Date.create(t);if(n){if(n.minutesAgo()<2){return true}}return false},_doesRowHaveAttachment:function(){return this._threadDOMRow.attachmentsContainer.find("img").length>0},_getViewCountString:function(e){return o.Locale.getString("pixel_track_view_count_tooltip",{number:e,pluralize:[e]})},getManipulationType:function(){return"PREPEND_ELEMENT"},getColumnName:function(){var e="ATTACHMENTS";if(this._threadDOMRow.type==="vertical"){e="STAR"}return e},getElement:function(){return this._element}});e.DependencyManager.addFunction({functionKey:"pixelTrackerIndicatorsInitialized",functionToCall:PixelTrackerIndicators.init,functionContext:PixelTrackerIndicators,dependentFunctionKeys:["inboxManipulatorInitialized","threadsInitialized","htmlLoaded","userLoggedIn","pixelTrackingLimiterInitialized"]});o.Modules.PixelTrackerIndicators=PixelTrackerIndicators})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox;var r={initialized:false,isPrevStreakView:false,init:function(t){var i=this;i.isPrevStreakView=e.BentoBox.UI.isBentoBoxView();if(!i.initialized){n.observe("viewChanged",function(){if(i.isPrevStreakView){if(n.isGmailView()&&n.isConversation()){i.render()}}else{}i.isPrevStreakView=e.BentoBox.UI.isBentoBoxView()})}i.initialized=true;if(t){t()}},render:function(){if(n.getCurrentMainContainer().find("[gh=tm] .fake").length===0){var e=n.getCurrentMainContainer().find("[gh=tm] [role=button]:first").parent();var r=t(t(document.createElement("div")).append(e.clone(false)).remove().html());r.addClass("fake");r.find("[role=button]").removeAttr("act");e.after(r);e.hide();r.click(function(e){i.UI.setURL(i.UI.fullViewHistory.last(2).first())})}}};e.DependencyManager.addFunction({functionKey:"newBackButtonInitialized",functionToCall:r.init,functionContext:r,dependentFunctionKeys:["gmailLoaded"]});i.Modules.NewBackButton=r})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={initialized:false,statistics:{},init:function(e){var t=this;if(!t.initialized){t.setUpMemoryReporting();t.setupGmailPerformanceReporting();t.initialized=true}if(e){e()}},getTime:function(){var e=(new a).getTime();return e},sendPipelineRenderTime:function(t,n){try{var i=e.BentoBox.Data.getPipelineBoxes(t.key());this.recordStat("pipelineLoadedTime",n,{numberOfBoxes:i.length})}catch(r){}},setUpMemoryReporting:function(){if(!(window.performance&&window.performance.memory&&window.performance.memory.usedJSHeapSize)){return}var e=this;n.repeatEvery(function(){e.recordStat("memoryUsage",window.performance.memory.usedJSHeapSize*1,{numberOfBoxes:o.Data.getAllBoxes().length,numberOfPipelines:o.Data.getAllPipelines().length})},1e3*60)},setupGmailPerformanceReporting:function(){var e=this;var t;window.addEventListener("hashchange",function(){var e=location.hash.substring(1);var n=e.split("/");if(n.length===2&&n[0]==="inbox"){t=a.create()}else{t=null}});i.observe("conversationThreadLoadedEvent",function(){if(!t){return}var n=a.create();e.recordStat("gmailConversationLoadedTime",n.millisecondsSince(t))})},teardown:function(){try{window.clearInterval(this.intervalID)}catch(e){}},recordStat:function(e,t,i){if(!this.statistics[e]){this.statistics[e]=[]}var r=this.statistics[e];r.push(t);if(r.length>30){var a=n.reduce(r,function(e,t){return e+t},0);var s=Math.round(a/r.length);var l=n.extend({},{eventName:e,value:s},i);o.Tracker.trackStreakPerformance(l);r.length=0}}};e.DependencyManager.addFunction({functionKey:"performanceModuleInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["data.pipelines.initialized","data.boxes.initialized","gmailLoaded"]});o.Modules.PerformanceModule=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.get("pipelineView",true)},setToolbarView:function(e){this._element.find(".toolbar").append(e.getElement())},setTitleView:function(e){this._element.find(".info").append(e.getElement())},setWarningView:function(e){this._element.find(".streak__pipeline_lockdown_warning").html(e.getElement())},setSpreadsheetView:function(e){this._element.find(".table").append(e.getElement())},setGroupBarView:function(e){this._element.find(".groups").append(e.getElement())},setSavedViewsStatusBarView:function(e){this._element.find(".streak__savedViewsStatusBar").html(e.getElement())},setSavedViewsEditAreaView:function(e){this._element.find(".streak__savedViewsEditArea").html(e.getElement())},setPipelineSummaryView:function(e){this._element.find(".bb_wh_right .bb_pipeline_total").html(e.getElement())},setFeedView:function(e){this._element.find(".feed_sidebar_inner").html(e.getElement())},setSearchBoxElement:function(e){r.getCurrentMainContainer().append(e)}});i.set("BentoBox.Modules.PipelineView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_pipeline",destroy:false},{name:"_pipelineToolbar",destroy:true},{name:"_titleViewController",destroy:true},{name:"_pipelineSummaryViewController",destroy:true},{name:"_lockdownWarningViewController",destroy:true},{name:"_savedViewsController",destroy:true},{name:"_pipelineSpreadsheetViewController",destroy:true},{name:"_groupBar",destroy:true},{name:"_savedViewsStatusBar",destroy:true},{name:"_savedViewsEditArea",destroy:true},{name:"_feedlistViewController",destroy:true},{name:"_searchBox",destroy:true},{name:"_isSearchBoxAttached",destroy:false,defaultValue:false}],_initialize:function(t){this._pipeline=t;e.UI.ViewController.prototype._initialize.call(this);this._setupTitleViewController();this._setupLockdownWarningViewController();this._setupSavedViewsController();this._setupPipelineSpreadsheetViewController();this._setupGroupBar();this._setupSavedViewsEditArea();this._setupSavedViewsStatusBar();this._setupPipelineSummaryViewController();this._setupNewsfeed();this._setupPipelineToolbar();this._setupSearchBox();this._bindToEvents()},updateSavedViewSettings:function(e){this._savedViewsController.processParams(e)},render:function(){this._pipelineSpreadsheetViewController.runDataTransforms();this._savedViewsEditArea.firstRender();this._savedViewsStatusBar.updateDisplay()},showSearchBox:function(){if(!this._isSearchBoxAttached){this._isSearchBoxAttached=true;this._view.getElement().append(this._searchBox.getElement());t(this._searchBox.getElement()).addClass("searchBox")}this._searchBox.show()},findNextSearchBox:function(){this._searchBox.findNext()},hideSearchBox:function(){this._searchBox.hide()},getCheckedBoxes:function(){return this._pipelineSpreadsheetViewController.getCheckedBoxes()},_setupView:function(){this._view=new c.Modules.PipelineView},_setupTitleViewController:function(){this._titleViewController=c.Widgets.SmartTextbox.create({model:this._pipeline,property:"name",autoGrow:true,trackingContext:{widgetContext:"pipelineView"}});this._titleViewController.setEnabled(c.Services.AccessManager.isAccessAllowed(this._pipeline,"Pipeline","UPDATE"));this._view.setTitleView(this._titleViewController)},_setupLockdownWarningViewController:function(){this._lockdownWarningViewController=new c.Widgets.PipelineLockdownWarningViewController(this._pipeline);this._view.setWarningView(this._lockdownWarningViewController.getView())},_setupSavedViewsController:function(){this._savedViewsController=c.Modules.PipelineView.SavedViewsController.create({pipeline:this._pipeline,trackingContext:{widgetContext:"pipelineView"}})},_setupPipelineSpreadsheetViewController:function(){this._pipelineSpreadsheetViewController=new c.Modules.PipelineSpreadsheetViewController(this._pipeline.key(),this._savedViewsController);this._view.setSpreadsheetView(this._pipelineSpreadsheetViewController.getView())},_setupGroupBar:function(){this._groupBar=c.Modules.PipelineView.GroupBar.create({pipeline:this._pipeline,pipelineSpreadsheetViewController:this._pipelineSpreadsheetViewController,groupJumper:this._pipelineSpreadsheetViewController,trackingContext:{widgetContext:"pipelineView"}});this._pipelineSpreadsheetViewController.addDelegate(this._groupBar);this._view.setGroupBarView(this._groupBar)},_setupSavedViewsEditArea:function(){this._savedViewsEditArea=c.Modules.PipelineView.SavedViewsEditArea.create({pipeline:this._pipeline,savedViewsController:this._savedViewsController,trackingContext:{widgetContext:"pipelineView"}});this._view.setSavedViewsEditAreaView(this._savedViewsEditArea)},_setupSavedViewsStatusBar:function(){this._savedViewsStatusBar=c.Modules.PipelineView.SavedViewsStatusBar.create({pipeline:this._pipeline,savedViewsController:this._savedViewsController,savedViewsEditArea:this._savedViewsEditArea,trackingContext:{widgetContext:"pipelineView"}});this._view.setSavedViewsStatusBarView(this._savedViewsStatusBar)},_setupPipelineSummaryViewController:function(){this._pipelineSummaryViewController=new c.Modules.PipelineView.PipelineSummaryViewController(this._savedViewsController,this._pipelineSpreadsheetViewController);this._view.setPipelineSummaryView(this._pipelineSummaryViewController.getView());this._pipelineSpreadsheetViewController.addDelegate(this._pipelineSummaryViewController)},_setupNewsfeed:function(){if(!c.Services.AccessManager.isAccessAllowed(this._pipeline,"NewsfeedEntryPIPELINE","GET")){return}var e=this;this._feedlistViewController=new c.Widgets.FeedListViewController({model:this._pipeline,closeCallback:function(){e._pipelineToolbar.showFeed.off()},trackingContext:{widgetContext:"pipelineView"}});this._view.setFeedView(this._feedlistViewController)},_setupPipelineToolbar:function(){this._pipelineToolbar=c.Modules.PipelineView.PipelineToolbar.create({pipeline:this._pipeline,pipelineSpreadsheetViewController:this._pipelineSpreadsheetViewController,feed:this._feedlistViewController,groupbar:this._groupBar,savedViewsController:this._savedViewsController,containerElement:this._view.getElement(),trackingContext:{widgetContext:"pipelineView"}});this._pipelineSpreadsheetViewController.addDelegate(this._pipelineToolbar);this._view.setToolbarView(this._pipelineToolbar)},_setupSearchBox:function(){this._searchBox=c.Widgets.SearchBox.create({searchController:this._pipelineSpreadsheetViewController.getPipelineSearchController(),trackingContext:{widgetContext:"pipelineView"}});this._pipelineSpreadsheetViewController.getPipelineSearchController().addDelegate(this._searchBox)},_bindToEvents:function(){var e=this;c.Data.getPipelineBoxes(this._pipeline.key()).watch("collectionChange",function(){e._feedlistViewController.refresh()},this);c.Data.getPipelineBoxes(this._pipeline.key()).watch("change",function(t){if(t.transactionId){return}e._feedlistViewController.refresh()},this)},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.UI.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Modules.PipelineViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineViewMasterController",superclass:e.Object,_memberVariables:[{name:"_activePipelineViewController",destroy:true},{name:"_activePipeline",destroy:false},{name:"_cachedPipelineViewController",destroy:true},{name:"_cachedPipeline",destroy:false},{name:"_clearCacheTimeout",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);this._setupKeyboardShortcuts();this._bindToRemoveEvent();r.inboxSDK.Router.handleCustomRoute(["pipeline/:key","pipeline/:key/:viewKey"],this._handlePipelineView.bind(this))},_setupKeyboardShortcuts:function(){var e=this;c.Keyboard.bindChord("meta+f/ctrl+f",function(t){if(e._activePipelineViewController){e._activePipelineViewController.showSearchBox();t.preventDefault();t.stopPropagation()}});c.Keyboard.bindChord("meta+g/ctrl+g",function(t){if(e._activePipelineViewController){e._activePipelineViewController.showSearchBox();e._activePipelineViewController.findNextSearchBox();t.preventDefault();t.stopPropagation()}})},_bindToRemoveEvent:function(){var e=this;c.Data.getAllPipelines().watch("remove",function(t){if(t.model===e._activePipeline){e._clear()
}},this)},_handlePipelineView:function(t){var n=t.getParams().key;var i=e.BentoBox.Modules.PerformanceModule.getTime();this._activePipeline=c.Data.getPipeline(n);if(!this._activePipeline){this._clear();c.logError("Pipeline does not exist \nid: "+n);c.ButterBarManager.showError(c.Locale.getString("pipeline_not_exist"));r.inboxSDK.Router.goto(r.inboxSDK.Router.NativeRouteIDs.INBOX);return}if(this._cachedPipelineViewController&&this._cachedPipeline&&this._cachedPipeline.key()===n){this._useCache(i,t);return}this._activePipelineViewController=new c.Modules.PipelineViewController(this._activePipeline);this._activePipelineViewController.updateSavedViewSettings(t.getParams().viewKey);t.getElement().appendChild(this._activePipelineViewController.getView().getElement()[0]);this._bindToUnload(t);c.Data.getPipelineBoxes(n).refresh();this._activePipeline.refresh();this._activePipelineViewController.render();r.getSearchInput().val("pipeline:"+this._activePipeline.displayName());e.BentoBox.trigger("pipeLoaded");this._endPerformanceTime(i)},_useCache:function(e,t){this._activePipelineViewController=this._cachedPipelineViewController;this._activePipeline=this._cachedPipeline;this._cachedPipelineViewController=null;this._cachedPipeline=null;t.getElement().appendChild(this._activePipelineViewController.getView().getElement()[0]);this._activePipelineViewController.updateSavedViewSettings(t.getParams().viewKey);this._endPerformanceTime(e);this._bindToUnload(t)},_bindToUnload:function(e){var t=this;e.on("destroy",function(){t._cachePipelineViewController(t._activePipelineViewController,t._activePipeline);t._activePipelineViewController=null;t._activePipeline=null})},_cachePipelineViewController:function(e,t){if(this._cachedPipelineViewController){this._cachedPipelineViewController.destroy()}this._cachedPipelineViewController=e;this._cachedPipeline=t;this._setupCacheClearTimeout()},_setupCacheClearTimeout:function(){clearTimeout(this._clearCacheTimeout);var e=this;this._clearCacheTimeout=setTimeout(function(){e._cachedPipeline=null;if(e._cachedPipelineViewController){e._cachedPipelineViewController.destroy()}e._cachedPipelineViewController=null},1e3)},_clear:function(){if(this._activePipeline&&this._activePipelineViewController){this._activePipelineViewController.destroy();this._activePipelineViewController=null;this._activePipeline=null}},_endPerformanceTime:function(t){var n=e.BentoBox.Modules.PerformanceModule.getTime();e.BentoBox.Modules.PerformanceModule.sendPipelineRenderTime(this._activePipeline,n-t)},getSelectedBoxes:function(){return this._activePipelineViewController.getCheckedBoxes()},teardown:function(){this._clear()}});e.DependencyManager.addFunction({functionKey:"pipelineViewInitialized",functionReference:function(){i.set("BentoBox.Modules.PipelineViewMasterController",new d)},dependentFunctionKeys:["keyboardInitialized","htmlLoaded","localeLoaded","data.pipelines.initialized","accessManagerInitialized","gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s={PREFIX:"spreadsheetSettings/pipeline/"};var l={_getKey:function(e,t){return s.PREFIX+t.key()+"/"+e},setSharedSetting:function(e,t,n,i){n.setUISettings(this._getKey(e,n),t,null,i)},getSharedSetting:function(e,t){return t.getUISettingsByPath(this._getKey(e,t))},setPrivateSetting:function(e,t,n,i){a.UserSettings.set(this._getKey(e,n),JSON.stringify(t));if(!i){a.UserSettings.save()}},getPrivateSetting:function(e,t){var n=a.UserSettings.get(this._getKey(e,t));if(n){try{return JSON.parse(n)}catch(i){}}return null}};function u(e){if(!a.UserSettings.get("spreadsheetSettingsConverted")){var t=[];n.each(a.Data.getAllPipelines(),function(e){if(!a.Services.AccessManager.isAccessAllowed(e,"Pipeline","UPDATE")){return}try{var i=e.key().replace(/\_/gi,"/")+"/pipeline/spreadsheet/";var r=a.UserSettings.get(i+"column/settings");if(r){try{r=JSON.parse(r)}catch(o){r=null}}var s=e.getUISettingsByPath("groupbar/stageKey");var u=l.getSharedSetting("columnWidth",e);if(!u&&r){u=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnWidthSettings.create(e);n.each(r.columns,function(e){var t=c(e);if(n.isReal(e.width)){u.data[t]=e.width}});a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnWidthSettings.save(u,e,true)}var f=l.getSharedSetting("columnOrder",e);if(!f&&r){f=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.create(e);f.data=n.map(r.columns,c);a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.save(f,e,true)}var p=l.getSharedSetting("groupColors",e);if(!p&&s){p=a.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings.create(e);p.data=s.colors;a.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings.save(p,e,true)}var m=l.getPrivateSetting("columnVisibility",e);if(!m&&r){m=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.create(e);n.each(r.columns,function(e){m.data[c(e)]=e.isVisible});a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.save(m,e,true)}e.setUISettings("groupbar",null,null,true);var _=e.getSavedViews();n.each(_,function(t){if(t.settings.sortSettings){return}var n=a.Modules.PipelineView.ViewSettings.SortSettings.create(e);n.data=d(t.settings.columnSettings);var i=a.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.create(e);i.data=h(t.settings.groupSettings);var r={filterSettings:t.settings.filterSettings,sortSettings:n,groupBySettings:i};t.settings=r;e.updateSavedView(t,true)});t.push(n.bind(e.save,e));a.UserSettings.set(e.key(),null)}catch(o){a.logError("can't convert settings",o)}});a.UserSettings.set("spreadsheetSettingsConverted",true);a.UserSettings.save();n.chainedCallbacks(t)}if(e){e()}}function c(e){var t;if(e.systemColumnUnique){t="property|"+e.systemColumnUnique}else if(e.property){t="property|"+e.property}else if(e.fieldKey){t="field|"+e.fieldKey}return t}function d(e){return n(e.columns).chain().filter(function(e){return e.sortOrder>0}).sortBy("sortOrder").reverse().map(function(e){return{columnKey:c(e),sort:e.sort}}).value()}function h(e,t){if(e.property){return"property|"+e.property}else if(e.fieldKey){return"field|"+e.fieldKey}else{return"property|stageKey"}}e.DependencyManager.addFunction({functionKey:"convertSettings",functionToCall:u,dependentFunctionKeys:["gmailLoaded","localeLoaded","data.pipelines.initialized","userSettingsInitialized","accessManagerInitialized"]});a.Modules.PipelineView.ViewSettingsUtility=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox,r=e.Gmail,a=i.ColumnSummary,o=e.Locale;var s=e.UI.ViewController;var l=e.Class.subclass({className:"PipelineSummaryMenuViewController",superclass:s,memberVariables:[{name:"_savedViewsController",destroy:false},{name:"_dataSource",destroy:false},{name:"_menu",destroy:true}],_initialize:function(e,t){s.prototype._initialize.call(this);this._savedViewsController=e;this._dataSource=t;this._menu=i.Widgets.Menu.create({css:{position:"fixed",minWidth:"200px"}});this.hide()},_setupView:function(){},getMenu:function(){return this._menu},getElement:function(){return this._menu.getElement()},show:function(){this._configureMenu();this.getElement().show()},hide:function(){this.getElement().hide()},_setSummaryFunction:function(e){if(!i.isFeatureEnabled("formulaFields")&&i.Services.PipelineSummaryLimiter.isLocked()){i.Services.PipelineSummaryLimiter.showGateway();return}var t=i.Modules.PipelineView.ViewSettings.PipelineSummarySettings.load(this._savedViewsController.pipeline,this._savedViewsController);t.data.summaryFunction=e;this._updateSettings(t);i.Services.PipelineSummaryLimiter.incrementUsage()},_setColumn:function(e){if(!i.isFeatureEnabled("formulaFields")&&i.Services.PipelineSummaryLimiter.isLocked()){i.Services.PipelineSummaryLimiter.showGateway();return}var t=i.Modules.PipelineView.ViewSettings.PipelineSummarySettings.load(this._savedViewsController.pipeline,this._savedViewsController);t.data.columnKey=e;if(!n.has(this._dataSource.getTransformedData().columns[e].summaryFunctions,t.data.summaryFunction)){t.data.summaryFunction=this._dataSource.getTransformedData().columns[e].summaryFunctions[0]||"count"}this._updateSettings(t)},_updateSettings:function(e){this._savedViewsController.setSummarySettings(e);this._configureMenu()},_configureMenu:function(){var e=this;var t=i.Modules.PipelineView.ViewSettings.PipelineSummarySettings.load(this._savedViewsController.pipeline,this._savedViewsController);this._menu.empty();var r=this._dataSource.getTransformedData().columns[t.data.columnKey];var o=r.summaryFunctions;if(t.data.columnKey==="property|name"){o=["count"]}this._menu.addHeaderItem("Functions");o.forEach(function(n){if(n==="|"){e._menu.addSeparator();return}var i=n;var r=a.getLocalizedName(n).escapeHTML();var o=e._menu.addCheckItem(r,e._setSummaryFunction.bind(e,i));o.setCheckboxState(i==t.data.summaryFunction)});this._menu.addSeparator();this._menu.addHeaderItem("Columns");var s=this._dataSource.getTransformedData().columnOrder;n.each(s,function(n){if(n==="property|name"||e._dataSource.getTransformedData().columns[n].isSummarizable){var i=e._dataSource.getTransformedData().columns[n].getName();var r=e._menu.addCheckItem(i.escapeHTML(),e._setColumn.bind(e,n));r.setCheckboxState(t.data.columnKey===n)}});var l=this._menu.getElement();var u=l.parent();l.css({left:u.offset().left-l.outerWidth()+u.outerWidth(),top:u.offset().top+u.outerHeight()});l.containByScreen(u,{isRightAligned:true})}});i.Widgets.NewSpreadsheet.PipelineSummaryMenuViewController=l})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"PipelineSummaryView",superclass:r,_memberVariables:[{name:"_valueEl",destroy:true},{name:"_labelEl",destroy:true},{name:"_buttonEl",destroy:true}],_initialize:function(){r.prototype._initialize.call(this);this._valueEl=this._element.find(".streak__pipeline_summary_value");this._labelEl=this._element.find(".streak__pipeline_summary_label");this._buttonEl=this._element.find(".streak__pipeline_summary_button")},_setupElement:function(){this._element=n.getElement("streak__pipeline_summary")},setValue:function(e){this._valueEl.text(e)},setLabel:function(e){this._labelEl.text(e)},click:function(e){this._buttonEl.click(e)},append:function(e){this._element.append(e)}});t.set("BentoBox.Modules.PipelineView.PipelineSummaryView",a)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Library,a=e.NotificationCenter,o=e.Stripe,s=e.BentoBox,l=e.UI,u=s.Models.Pipeline,c=s.Widgets.NewSpreadsheet.PipelineSummaryMenuViewController;var d=l.ViewController;function h(e,t){var i=t.columns[e];var r=n.flatten(n.map(t.lists,function(e){return e.list}),true);return n.map(r,function(e){if(i.property){return e.get(i.property)}else{return e.getFieldValue(i.getField().key())}})}function f(e,t,n,i){var r=h(t,n);var a=s.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(i);var o=a[t];return s.ColumnSummary.Functions[e](r,o.type,i,o.fieldKey)}var p=e.Class.subclass({className:"PipelineSummaryViewController",superclass:d,_memberVariables:[{name:"_savedViewsController",destroy:false},{name:"_dataSource",destroy:false},{name:"_menu",destroy:true}],_initialize:function(e,t){d.prototype._initialize.call(this);this._savedViewsController=e;this._dataSource=t;this._view.click(this.toggleMenu.bind(this));this.update=n.throttle(this._syncUpdate.bind(this),100)},newBoxAdded:function(){this.update()},transformedDataChanged:function(){this.update()},_syncUpdate:function(){if(!this._view||!this._savedViewsController){return}var e=s.Modules.PipelineView.ViewSettings.PipelineSummarySettings.load(this._savedViewsController.pipeline,this._savedViewsController);if(e.data&&e.data.columnKey&&e.data.summaryFunction){this._view.setValue(f(e.data.summaryFunction,e.data.columnKey,this._dataSource.getTransformedData(),this._savedViewsController.pipeline));this._view.setLabel(s.ColumnSummary.getLocalizedName(e.data.summaryFunction))}else{this._view.setValue("-");this._view.setLabel("Unconfigured");s.logError("no pipeline summary configuration")}},toggleMenu:function(){if(this._menu){this.closeMenu()}else{this.showMenu()}},showMenu:function(){if(this._menu){return}this._menu=new c(this._savedViewsController,this._dataSource);this._view.append(this._menu.getElement());this._menu.show();var e=this;this._menu.getElement().bodyCloseAndStop({closeFunction:function(){e.closeMenu()},body:i.elements.body,stop:this._view.getElement()});s.Tracker.track("pipeline summary menu shown")},closeMenu:function(){if(!this._menu){return}this._menu.getElement().unbindBodyCloseAndStop();this._menu.hide();this._menu.destroy();delete this._menu},_setupView:function(){this._view=r.getInstance("BentoBox.Modules.PipelineView.PipelineSummaryView")},destroy:function(){if(this._menu){this._menu.getElement().unbindBodyCloseAndStop()}e.UI.ViewController.prototype.destroy.call(this)}});r.set("BentoBox.Modules.PipelineView.PipelineSummaryViewController",p)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.Template,d=e.BentoBox;var h=e.Class.subclass({className:"MessageView",superclass:e.UI.View,_memberVariables:[{name:"_options",destroy:false}],_initialize:function(t){this._options=t;e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t(c.underscore("modules/threadView/email")(this._options))},setBodyHTML:function(e){this._element.find(".streak__email_body").html(e);this._addQuoteCollapsing()},_addQuoteCollapsing:function(){function e(){if(a.length>3){t("<div/>").addClass("streak__collapsible").html(a.join("\n")).appendTo(r)}else{r.append(a.join("\n"))}a=[]}var i=this._element.find(".streak__email_body");var r=i.find(".streak__text_email");var a=[];if(r.length){var o=r.html().split("\n");r.empty();n.each(o,function(t,n){if(t.match(/^&gt;/)){a.push(t)}else{e();r.append(t+"\n")}});e()}else{var s=i.find("blockquote").not(i.find("blockquote blockquote, div.streak__collapsible blockquote"));s.each(function(){var e=t(this);if(e.next().length&&e.text().length<300&&n.filter(e.text().split("\n"),function(e){return e.trim()}).length<=5){return}e.wrap(t("<div/>").addClass("streak__collapsible"))})}i.find(".streak__collapsible").each(function(){var e=t(this);var n=t("<button/>").addClass("streak__collapse_toggle");var i;function r(t){i=t;var r=i?d.Locale.getString("hide_collapsed"):d.Locale.getString("show_collapsed");n.attr({"data-tooltip":r,"aria-label":r}).toggleClass("shown",i);e.toggle(i)}r(false);var a=t("<div/>").addClass("streak__collapse_toggle_container").append(n).insertBefore(e);n.click(function(e){r(!i)}).mousedown(function(e){e.preventDefault()})})}});i.set("BentoBox.Modules.MessageView",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.Template,d=e.BentoBox;var h=e.Class.subclass({className:"MessageViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_threadKey",destroy:false},{name:"_messageObject",destroy:false},{name:"_messageOptions",destroy:false}],_initialize:function(t,n){this._messageObject=t;this._threadKey=n;this._messageOptions=this._processMessageObject(t);e.UI.ViewController.prototype._initialize.call(this);this._view.setBodyHTML(this._messageOptions.bodyHTML)},_setupView:function(){this._view=new d.Modules.MessageView(this._messageOptions)},_processMessageObject:function(e){var t=this._getHeaderValueFromMessage(e,"To");var i=this._parseEmailAddressesFromHeaderValue(t);var r=this._getHeaderValueFromMessage(e,"Cc");var o=r&&this._parseEmailAddressesFromHeaderValue(r);var s=this._getHtmlBody(e);if(!s){if(!(e.payload&&e.payload.body&&e.payload.body.size===0)){d.logError("no email message body found")}s=n.escape(d.Locale.getString("no_message_body"))}var l=n.map(i,function(e){return c.underscore("modules/threadView/emailName")(e).trim()}).join(", ");if(o&&o.length){l+=", cc "+n.map(o,function(e){return c.underscore("modules/threadView/emailName")(e).trim()}).join(", ")}var u=new a(this._getHeaderValueFromMessage(e,"Date"));var h=this._parseEmailAddressesFromHeaderValue(this._getHeaderValueFromMessage(e,"From"));return{imageSrc:d.Contacts.getGravatarURL(h[0].email),name:h[0].name,email:h[0].email,datetime:u.toString(),gmailDate:u.getGmailFormatted(),emailListHTML:l,bodyHTML:s}},_getHeaderValueFromMessage:function(e,t){var i=n.find(e.payload.headers,function(e){return e.name.toLowerCase()==t.toLowerCase()});return i?i.value:null},_parseEmailAddressesFromHeaderValue:function(e){if(!e){d.logError("couldn't parse header for email addresses",null);return[]}var t=[];var n=/("(?:[^\\"]|\\.)*")|([^<>\s",;:]+)|<([^>]+@[^>]+)>|(,)/g;var i,r=[],a;function o(){if(!a){for(var e=0;e<r.length;e++){if(r[e].indexOf("@")>-1){a=r[e];r.splice(e,1);break}}}var n=r.join(" ");if(!n.trim()){n=a}if(a){t.push({name:n,email:a})}r=[];a=undefined}while(i=n.exec(e)){var s=i[1];var l=i[2];var u=i[3];var c=i[4];if(c!==undefined){o()}else if(l){r.push(l)}else if(s){r.push(s.slice(1,-1).replace(/\\/g,""))}else if(u){a=u}}o();return t},_getHtmlBody:function(t){var i=this;var r=t.payload;var a=this._getBodyPart(r);if(!a){return null}else if(a.type=="text/html"){var o=a.body.replace(/<img\b([^<>]*)(\/?>)/gi,function(n,r,a){try{var o=e.Utils.parseTagAttributes(r);var s=o.src&&o.src.match(/^cid:(.*)/);if(s){var l=s[1];o.src=e.server+"/api/v1/threads/"+encodeURIComponent(i._threadKey)+"/users/"+encodeURIComponent(t._ownerKey)+"/messages/"+encodeURIComponent(t.id)+"/attachments/"+encodeURIComponent(l)+"?email="+encodeURIComponent(e.userEmail);return"<img "+e.Utils.writeTagAttributes(o)+a}}catch(u){console.error("failed to parse email image tag",u)}return n});return this._sanitizeHTML(o)}else{return'<pre class="streak__text_email">'+n.escape(a.body)+"</pre>"}},_getBodyPart:function(t){if(t.mimeType=="text/plain"||t.mimeType=="text/html"){return{type:t.mimeType,body:e.B64.decode(t.body.data)}}else if(t.mimeType.indexOf("multipart/alternative")>-1){var i=n.find(t.parts,function(e){return e.mimeType=="text/html"});if(i){return this._getBodyPart(i)}var r=n.find(t.parts,function(e){return e.mimeType=="text/plain"});if(r){return this._getBodyPart(r)}}else if(t.mimeType.indexOf("multipart/related")>-1||t.mimeType.indexOf("multipart/mixed")>-1){for(var a=0;a<t.parts.length;a++){var o=this._getBodyPart(t.parts[a]);if(o){return o}}}return null},_sanitizeHTML:function(t){return e.caja.html_sanitize(t,function n(e){return e},function i(e){return null})}});i.set("BentoBox.Modules.MessageViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.Template,d=e.BentoBox;var h=e.Class.subclass({className:"ThreadView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t(c.underscore("modules/threadView/threadView")())},showLoading:function(){this._element.find(".loadingThreads").show();this._element.find(".threadViewThreads").hide()},showThread:function(){this._element.find(".loadingThreads").hide();this._element.find(".threadViewThreads").fadeIn()},setSubjectText:function(e){this._element.find(".subject").text(e)},setBoxSidebarView:function(e){this._element.find(".boxInfo").append(e.getElement())},appendMessageView:function(e){this._element.find(".emails").append(e.getElement())},showErrorMessage:function(e){this._element.find(".loadingThreads").hide();this._element.find(".streak__threadView_error").show();this._element.find(".streak__threadView_error").text(e)},addHTMLToErrorMessage:function(e){this._element.find(".streak__threadView_error").append(e)}});i.set("BentoBox.Modules.ThreadView",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.APIRequester,d=e.Template,h=e.BentoBox;var f=e.Class.subclass({className:"ThreadViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_threadKey",destroy:false},{name:"_boxSidebar",destroy:true},{name:"_messageViewControllers",destroy:true,defaultValue:[]}],_initialize:function(t){this._threadKey=t;e.UI.ViewController.prototype._initialize.call(this);this._view.showLoading();h.Data.getGmailThread(t,this._processThread.bind(this))},_setupView:function(){this._view=new h.Modules.ThreadView},_processThread:function(e){var t=h.Data.getBox(e.get("boxKey"));this._renderBoxSidebar(t);var n=this;c.get("threads/"+e.key()+"/unifiedcontents").getPromise().then(this._renderUnifiedContents.bind(this),this._renderErrorMessage.bind(this)).catch(function(e){h.logError("Error rendering thread",e);n._renderErrorMessage({message:"Error rendering thread"})})},_renderBoxSidebar:function(e){if(!e){return}this._boxSidebar=h.Modules.ConversationSidebar.BoxSidebar.create({box:e,keyboardTabs:true});this._view.setBoxSidebarView(this._boxSidebar);this._boxSidebar.getElement().addClass("loaded")},_renderUnifiedContents:function(e){var t=this._dedupeUnifiedThreads(e.threads);this._view.showThread();if(t.messages&&t.messages.length>0){this._view.setSubjectText(this._getSubjectOfThread(t))}var i=this;n.each(t.messages,function(e){try{i._renderMessage(t,e)}catch(n){var r="Problem rendering email";r+="\nemail json: "+JSON.stringify(e);h.logError(r,n)}});h.trigger("threadViewLoaded")},_dedupeUnifiedThreads:function(e){n.each(e,function(e){if(!e.thread){e.thread={messages:[e.message]}}n.each(e.thread.messages,function(t){t._ownerKey=e.userKey})});var t=n.clone(e[0].thread);t.messages=n.flatten(n.pluck(n.pluck(e,"thread"),"messages"),true);t.messages=n.sortBy(t.messages,this._getMessageDate.bind(this));t.messages=n.uniq(t.messages,true,this._getMessageId.bind(this));return t},_getSubjectOfThread:function(e){return this._getHeaderValueFromMessage(e.messages[0],"subject")},_getMessageDate:function(e){var t=this._getHeaderValueFromMessage(e,"Date");if(t){return new a(t).getTime()}},_getMessageId:function(e){return this._getHeaderValueFromMessage(e,"Message-ID")},_getHeaderValueFromMessage:function(e,t){var i=n.find(e.payload.headers,function(e){return e.name.toLowerCase()==t.toLowerCase()});return i?i.value:null},_renderMessage:function(e,t){var n=new h.Modules.MessageViewController(t,this._threadKey);this._messageViewControllers.push(n);this._view.appendMessageView(n.getView())},_renderErrorMessage:function(e){var t=e.response;var i=t&&t.errors;var r=i&&i[0];var a=r&&r.details||e&&e.message;this._view.showErrorMessage(a);var o=n.compact(n.pluck(i,"userEmail"));if(o.length){this._view.addHTMLToErrorMessage(d.underscore("modules/threadView/credentialsError")({emails:o}))}h.trigger("threadViewLoaded")}});i.set("BentoBox.Modules.ThreadViewController",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"ThreadViewMasterController",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);r.inboxSDK.Router.handleCustomRoute("thread/:key",this._handleThreadView.bind(this))},_handleThreadView:function(e){var t=e.getParams().key;var n=new c.Modules.ThreadViewController(t);e.getElement().appendChild(n.getView().getElement()[0]);e.on("destroy",function(){n.destroy()})}});e.DependencyManager.addFunction({functionKey:"threadViewMasterControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.ThreadViewMasterController",new d)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s={init:function(){o.Services.MoreMenuManager.registerButton({text:o.Locale.getString("view_unified_thread"),orderHint:2,extraCSSClasses:["unifiedMenuItem"],showFor:this._showFor.bind(this),fn:this._onclick.bind(this)})},getThread:function(){var e=r.getActiveHexGmailThreadIdList(o.Services.Threads.HexGmailThreadIdExtractor)[0];if(!e){return null}var t=o.Services.Threads.ThreadStorer.getBoxKey(e);if(!t){return null}var i=o.Data.getBox(t);if(!i){return null}return n.find(i.getThreads(),function(t){return t.get("requestingUserThreadGmailId")===e})},_showFor:function(e){if(!r.isPreviewPaneConversation()&&e!="conversation"){return false}return!!this.getThread()},_onclick:function(){r.inboxSDK.Router.goto(this.getThread.link())}};e.DependencyManager.addFunction({functionKey:"UnifiedMoreMenuOptionInitialized",functionReference:s.init,functionContext:s,dependentFunctionKeys:["enabledFeaturesControllerInitialized","moreMenuManagerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"SearchResultsViewController",superclass:e.Object,_memberVariables:[{name:"_collapsibleSectionView",destroy:false},{name:"_searchTerm",destroy:false}],_initialize:function(t,n){e.Object.prototype._initialize.call(this);this._collapsibleSectionView=t;this._searchTerm=n;if(d.LocalSettings.get("searchResultsOpenState")!==false){this._doSearch()}else{this._collapsibleSectionView.once("expanded",this._doSearch.bind(this))}},_doSearch:function(){var t=this;e.APIRequester.get("search",{query:this._searchTerm,limit:10}).getEventStream().filter(function(){return!!t._searchTerm}).map(".results").onValue(this,"_renderResults")},_renderResults:function(e){this._collapsibleSectionView.setTableRows(n.chain(e||[]).filter(function(e){return!!e.boxKey}).pluck("boxKey").map(function(e){return d.Data.getBox(e)}).compact().map(function(e){return{title:e.displayName(),iconClass:"streak__boxSearchResultIcon",body:d.Services.BoxDisplayText.getDetailsText(e),shortDetailText:e.getPipeline().displayName(),routeID:"box/:key",routeParams:{key:e.key()},onClick:function(){d.Tracker.track("boxLinkClicked",{source:"search result"})}}}).value())}});r.set("BentoBox.Modules.SearchResultsViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SearchResultsMasterController",superclass:e.Object,_memberVariables:[{name:"_unsubscribe",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._unsubscribe=r.inboxSDK.Router.handleListRoute(r.inboxSDK.Router.NativeListRouteIDs.SEARCH,this._handleSearchView.bind(this))},_handleSearchView:function(e){var t=e.addCollapsibleSection({title:c.Locale.getString("streak_search_results")});t.setCollapsed(c.LocalSettings.get("searchResultsOpenState")===false);var n=new c.Modules.SearchResultsViewController(t,e.getParams().query);e.on("destroy",function(){n.destroy()});t.on("expanded",function(){c.LocalSettings.set("searchResultsOpenState",true)});t.on("collapsed",function(){c.LocalSettings.set("searchResultsOpenState",false)})}});e.DependencyManager.addFunction({functionKey:"searchResultsMasterControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.SearchResultsMasterController",new d)},dependentFunctionKeys:["gmailLoaded","userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={widgetContext:"searchOverride"};var s=function(e,t){a.Tracker.trackStreakActive(o,t,{eventName:e})};var l={templates:{},menu:null,initialized:false,override:false,showingPipelines:false,currentItemList:[],CONST:{PIPELINE:"pipeline",BOX:"box"},init:function(e){var t=this;if(!t.initialized){t.initActions();t.initialized=true}if(e){e()}},initActions:function(){var e=this;var t=i.getSearchInput().val();i.getSearchInput().keyup(function(n){if(t!==i.getSearchInput().val()){t=i.getSearchInput().val();e.startRender()}});i.getSearchInput().blur(function(){setTimeout(function(){if(e.menu){e.menu.el.hide()}if(e.cursor){e.cursor.pause()}},250)});a.Keyboard.bindChordToEl({el:i.getSearchInput(),chord:"enter",cb:function(t){var n=i.getSearchInput().val();if(!n.startsWith(e.CONST.PIPELINE+":")&&!n.startsWith(e.CONST.BOX+":")){return}if(e.menu&&e.menu.el.isVisible()){return}t.preventDefault();t.stopImmediatePropagation()},useCapture:true});a.Keyboard.bindChord("w,p",function(t){i.getSearchInput().val(e.CONST.PIPELINE+":");e.startRender();i.getSearchAutoComplete().show();i.getSearchInput().focus()},a.Locale.getString("keyboard_go_to_pipeline"));a.Keyboard.bindChord("w,b",function(t){i.getSearchInput().val(e.CONST.BOX+":");e.startRender();i.getSearchAutoComplete().show();i.getSearchInput().focus()},a.Locale.getString("keyboard_go_to_box"));a.Keyboard.bindChordToElement(i.getSearchInput(),"escape",function(){i.getSearchAutoComplete().hide();i.getSearchInput().blur()},true,true);a.Keyboard.bindChordToElement(i.getSearchInput(),"right",function(t){if(e.override&&e.showingPipelines){setTimeout(function(){i.getSearchAutoComplete().hide()},100);if(i.getSearchInput().caret().start===i.getSearchInput().val().length){var n=e.cursor.getPosition();if(n<e.currentItemList.length){setTimeout(function(){i.getSearchInput().val(e.CONST.PIPELINE+":"+e.currentItemList[n].displayName()+" "+e.CONST.BOX+":")},50)}}}});e.cursor=a.Cursor.create({selectedClass:"J-N-JT",highlightOnHover:true,selectFunc:function(e){e.click()},rollOver:true,input:i.getSearchInput().parent(),aggressiveInputCapture:true})},startRender:function(){var e=this;var t=i.getSearchInput().val();e.cursor.resume();i.getSearchAutoComplete().css({visibility:"visible"});e.showingPipelines=false;e.currentItemList.length=0;if(t.startsWith(e.CONST.PIPELINE+":")){if(t.indexOf(e.CONST.BOX+":")>-1){var n=t.split(e.CONST.BOX+":");var r=n[0];var o=n[1];r=r.replace(e.CONST.PIPELINE+":","").trim().toLowerCase();var s=[];var l=a.Data.getAllPipelines();for(var u=0;u<l.length;u++){if(l[u].displayName().toLowerCase().indexOf(r)>-1){s=s.concat(a.Data.getPipelineBoxes(l[u].key()))}}e.renderItems(o,s,"name","box")}else{e.renderItems(t.replace(e.CONST.PIPELINE+":",""),a.Data.getAllPipelines(),"name","pipeline");e.showingPipelines=true}}else if(t.startsWith(e.CONST.BOX+":")){e.renderItems(t.replace(e.CONST.BOX+":",""),a.Data.getAllBoxes(),"name","box")}else{if(e.cursor){e.cursor.pause()}if(e.menu){e.menu.el.hide()}i.getSearchInput().next().show()}},renderItems:function(e,t,r,o){var s=this;s.override=false;i.getSearchAutoComplete().css({visibility:"hidden"});i.getSearchInput().next().hide();if(s.menu){s.menu.el.remove()}s.menu=a.Widgets.Menu.create({css:{position:"absolute",zIndex:"1000",width:i.getSearchContainer().width(),top:i.getSearchContainer().height()}});s.menu.el.addClass("searchMenu");var l=n.filter(t,function(t){return t.get(r).toLowerCase().indexOf(e.toLowerCase())>-1});if(l.length>0){s.override=true;l.sortBy(function(t){return-1*t.get(r).intersectionLength(e)}).first(10).each(function(t){var n=0;if(o==="pipeline"){n=a.Data.getPipelineBoxes(t.key()).length}s.renderItem(t.get(r),t.link(),e,o,n);s.currentItemList.push(t)});s.cursor.setup(s.menu.el.find(".menuItem"));i.getSearchContainer().append(s.menu.el)}},renderItem:function(e,t,n,r,o){e=e.escapeHTML();var l=e.toLowerCase();var u=n.toLowerCase();var c=l.indexOf(u);var d=e.first(c);d+='<b class="Jd-JU">'+n+"</b>";d+=e.substring(c+n.length);if(o){d+=" ("+o+")"}if(r){d+='<span class="U6"> - '+r+"<span>"}this.menu.addItem(d,function(){s("searchResultClicked");i.getSearchInput().blur();a.UI.setURL(t)})}};e.DependencyManager.addFunction({functionKey:"searchOverrideInitialized",functionToCall:l.init,functionContext:l,dependentFunctionKeys:["gmailLoaded","userLoggedIn","data.pipelines.initialized","data.boxes.initialized","keyboardInitialized","localeLoaded"]});a.Modules.SearchOverride=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Locale,a=e.Gmail,o=e.Date,s=e.NotificationCenter,l=e.DependencyManager,u=e.BentoBox;var c=function(){this._currentSendLaterController=null;
this._sendLaterDate=null;this._menu=null;this._scheduledDateElement=null;this._dateInput=null;this._scheduledSendButton=null;this._cancelButton=null;this._setupUIComponents()};n.extend(c.prototype,{setSendLaterController:function(e){this._currentSendLaterController=e;this._resetUIElements();if(this._currentSendLaterController.hasScheduledDate()){this._dateInput.val(this._currentSendLaterController.getScheduledDate().customFormat("long"));this._menuInner.find(".sendLaterButton").append(this._cancelButton.getElement());this._scheduledSendButton.setText(u.Locale.getString("send_later_update_time"))}this._processDateInput()},getElement:function(){return this._menu.getElement()},nowShowing:function(){d("openSendLaterMenu");this._dateInput.focus()},_setupUIComponents:function(){this._setupMenuElements();this._setupDateInput();this._setupConvenentTimeLinks();this._setupScheduleSendLaterButton();this._setupCancelButton();this._setupTabOrder()},_setupMenuElements:function(){this._menu=u.Widgets.Menu.create();this._menu.getElement().removeClass("J-M");this._menu.getElement().addClass("streak__sdk_menu");this._menuInner=i.get("sendLaterMenu",true);this._menu.addSection(this._menuInner);this._dateInput=this._menuInner.find(".date");this._scheduledDateElement=this._menuInner.find(".scheduledDate")},_setupDateInput:function(){var e=this;this._dateInput.keyup(function(t){e._processDateInput()})},_processDateInput:function(){this._scheduledSendButton.disable();this._sendLaterDate=null;var e=this._dateInput.val().trim();if(e.isBlank()){this._scheduledDateElement.text(u.Locale.getString("send_later_enter_date"));return}var t=o.create(e);if(!t.isValid()){this._scheduledDateElement.text(u.Locale.getString("send_later_invalid_date"));return}if(t.isBefore(o.now())){this._scheduledDateElement.text(u.Locale.getString("send_later_future_date"));return}this._sendLaterDate=t;this._scheduledDateElement.text(t.customFormat("longWithTimezone"));this._scheduledSendButton.enable()},_setupConvenentTimeLinks:function(){var e=this;this._menuInner.find("a").click(function(t){d("suggestedTimeClick");t.preventDefault();e._dateInput.val(this.title);e._processDateInput()})},_setupScheduleSendLaterButton:function(){var e=this;this._scheduledSendButton=u.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:u.Locale.getString("send_later_schedule"),onFunction:function(){e._scheduleSendLaterClicked()}});this._menuInner.find(".sendLaterButton").append(this._scheduledSendButton.getElement())},_scheduleSendLaterClicked:function(){d("createSendLaterAttempt");var e=this._currentSendLaterController.getErrorMessage();if(e){u.ButterBarManager.showError(e,{time:5e3});d("createSendLaterFail",{reason:e,userFailure:"true"});return}d("send later scheduled");this._currentSendLaterController.setScheduledDate(this._sendLaterDate)},_setupCancelButton:function(){var e=this;this._cancelButton=u.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:u.Locale.getString("cancel_send_later"),onFunction:function(){d("cancelSendLater");e._currentSendLaterController.cancelSendLater()}})},_setupTabOrder:function(){t.tabChain([this._scheduledSendButton.getElement(),this._dateInput])},_resetUIElements:function(){this._dateInput.val("");this._cancelButton.getElement().detach();this._scheduledSendButton.setText(u.Locale.getString("send_later_schedule"))}});var d=function(e,t){u.Tracker.trackStreakActive(t,{eventName:e})};u.Modules.SendLater={};l.addFunction({functionKey:"sendLaterMenuInitialized",functionToCall:function(e){u.Modules.SendLater.SendLaterMenu=new c;if(e){e()}},dependentFunctionKeys:["htmlLoaded","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailComposeManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){return[new s.Modules.SendLater.SendLaterButtonViewController,new s.Modules.SendLater.SendLaterNoticeViewController]}});o.addFunction({functionKey:"sendLaterMasterControllerInitialized",functionToCall:function(e){s.Modules.SendLater.SendLaterButtonMasterController=new l;if(e){e()}},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","data.sendLaters.initialized","sendLaterMenuInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){l.Modules.ComposeViewControllerBase.call(this);this._buttonOptions=null;this._buttonOptionStream=new i.Bus;this._menuDropdown=null;this._sendLaterModel=null};u.prototype=Object.create(l.Modules.ComposeViewControllerBase.prototype);n.extend(u.prototype,{initialize:function(e){this._composeWindowViewController=e;this._setupSendLaterModel();this._setupButton();setTimeout(this._checkAndNotifyStatus.bind(this),1)},activeModulesChanged:function(e){this._buttonOptions.enabled=true;this._buttonOptions.tooltip=l.Locale.getString("send_later");if(e.indexOf("threadBox")>-1){this._buttonOptions.enabled=false;this._buttonOptions.tooltip=l.Locale.getString("send_later_disabled_threadBox")}if(e.indexOf("pixelTracking")>-1){this._buttonOptions.enabled=false;this._buttonOptions.tooltip=l.Locale.getString("send_later_disabled_pixel_tracking")}if(e.indexOf("bumpLater")>-1){this._buttonOptions.enabled=false;this._buttonOptions.tooltip=l.Locale.getString("send_later_disabled_bump_later")}if(e.indexOf("mailMerge")>-1){this._buttonOptions.enabled=false}this._buttonOptionStream.push(this._buttonOptions)},hasScheduledDate:function(){return this._sendLaterModel&&this._sendLaterModel.get("sendDate")},getScheduledDate:function(){return a.create(this._sendLaterModel.get("sendDate"))},getErrorMessage:function(){if(this._composeWindowViewController.getToContacts().length===0){return l.Locale.getString("send_later_need_address")}if(this._composeWindowViewController.getSubject().length===0){return l.Locale.getString("send_later_need_subject")}},setScheduledDate:function(e){if(this._menuDropdown){this._menuDropdown.close()}if(!this._sendLaterModel){this._sendLaterModel=l.Data.newSendLater()}this._sendLaterModel.set("sendDate",e.getTime());this._sendLaterModel.set("subject",this._composeWindowViewController.getSubject());if(this._composeWindowViewController.getDraftId()){this._sendLaterModel.set("gmailDraftId",this._composeWindowViewController.getDraftId());this._sendLaterModel.save()}this._triggerDraftSave();this._composeWindowViewController.close();this._showScheduledMessage()},cancelSendLater:function(){if(this._menuDropdown){this._menuDropdown.close()}if(this._sendLaterModel){this._sendLaterModel.del()}this._sendLaterModel=null;this._updateDisplay();this._composeWindowViewController.setModuleInactive("sendLater");this._composeWindowViewController.notify("sendLaterCancelled");document.body.focus()},shouldNotSend:function(){return this._isSendLaterScheduled()},sendCancelled:function(){this._showBlockModal()},shouldNotDiscard:function(){return this._isSendLaterScheduled()},discardCancelled:function(){this._showBlockModal()},draftSaved:function(){if(this._isSendLaterScheduled()){this._sendLaterModel.set("gmailDraftId",this._composeWindowViewController.getDraftId());this._sendLaterModel.save()}},emailSent:function(){if(this._isSendLaterScheduled()){this._sendLaterModel.set("status","SENT_EARLY_BY_USER");this._sendLaterModel.save()}},discarded:function(){if(this._isSendLaterScheduled()){this._sendLaterModel.del()}},destroy:function(){this._composeWindowViewController=null;this._callDelegateFunction("destroy",this)}});n.extend(u.prototype,{_setupButton:function(){var e=this;this._buttonOptions={buttonColor:"blue",iconClass:"sendLaterClock",hasDropdown:true,tooltip:l.Locale.getString("send_later"),type:"SEND_ACTION",onClick:function(t){l.Modules.SendLater.SendLaterMenu.setSendLaterController(e);t.dropdown.el.appendChild(l.Modules.SendLater.SendLaterMenu.getElement()[0]);l.Modules.SendLater.SendLaterMenu.nowShowing();l.Tracker.track("send later menu open");e._menuDropdown=t.dropdown}};this._composeWindowViewController.getComposeView().addButton(this._buttonOptionStream);this._buttonOptionStream.push(this._buttonOptions)},_setupSendLaterModel:function(){var e=this._composeWindowViewController.getDraftId();if(e){this._sendLaterModel=l.Services.Threads.ThreadStorer.getSendLater(e)}},_checkAndNotifyStatus:function(){if(this._isSendLaterScheduled()){this._composeWindowViewController.setModuleActive("sendLater");this._composeWindowViewController.notify("sendLaterScheduled",this._sendLaterModel)}this._updateDisplay()},_showBlockModal:function(){if(!this._isSendLaterScheduled()){return}l.Widgets.Modal.simpleConfirm(l.Locale.getString("send_later_block_title"),l.Locale.getString("send_later_block_message"))},_showScheduledMessage:function(){var e=t(document.createElement("span"));e.html(l.Locale.getString("send_later_scheduled"));e.find("a").click(function(e){e.preventDefault();e.stopPropagation();r.setURL(r.Constants.Drafts)});e.find("a").prop("href","#");l.ButterBarManager.showMessage({message:e,priority:201})},_updateDisplay:function(){if(this._isSendLaterScheduled()){this._updateScheduledDisplay()}else{this._updateUnscheduledDisplay()}},_updateScheduledDisplay:function(){this._buttonOptions.iconClass="sendLaterClock scheduled";this._buttonOptionStream.push(this._buttonOptions)},_updateUnscheduledDisplay:function(){this._buttonOptions.iconClass="sendLaterClock";this._buttonOptionStream.push(this._buttonOptions)},_isSendLaterScheduled:function(){return this._sendLaterModel&&this._sendLaterModel.isScheduled()},_triggerDraftSave:function(){this._composeWindowViewController.minimize();this._composeWindowViewController.restore()}});l.Modules.SendLater.SendLaterButtonViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._element=null;this._sendLaterModel=null;this._modificationParameters=null};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e;this._generateSendLaterNoticeElement()},shouldProcessModification:function(){return this._sendLaterModel!==null},aboutToProcessModification:function(){this._element.find(".sendLaterBottomMessage").html(this._getSendLaterNoticeMessage())},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"BOTTOM"},shouldModificationAdjustHeight:function(){return true},getModificationElement:function(){return this._element},destroy:function(){this._element.remove();this._composeWindowViewController=null},sendLaterScheduled:function(e,t){this._sendLaterModel=e;if(t){this._element.find("a").remove()}this._composeWindowViewController.reloadModification(this)},sendLaterCancelled:function(){if(!this._sendLaterModel){return}this._sendLaterModel=null;this._composeWindowViewController.reloadModification(this)},_generateSendLaterNoticeElement:function(){var e=this;this._element=t(document.createElement("div"));this._element.addClass("aDh sendLaterBottom");this._element[0].innerHTML='<div class="gD sendLaterBottomInner"><span class="exclamation"></span><div class="sendLaterBottomMessage"></div>'+'<a href="#" class="sendLaterCloseDraft">'+s.Locale.getString("send_later_close_draft")+"</a>"+"</div>";this._element.find("a").click(function(t){e._composeWindowViewController.close();s.Tracker.track("send later close draft")})},_getSendLaterNoticeMessage:function(){return'<span class="sendLaterMessageLabel">'+s.Locale.getString("send_later_list_scheduled")+":</span> "+r.create(this._sendLaterModel.get("sendDate")).customFormat("shortWithWeekday")}});s.Modules.SendLater.SendLaterNoticeViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailReplyManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){return[new s.Modules.SendLater.SendLaterButtonReplyViewController,new s.Modules.SendLater.SendLaterNoticeViewController]}});o.addFunction({functionKey:"sendLaterReplyMasterControllerInitialized",functionToCall:function(e){s.Modules.SendLater.SendLaterButtonReplyMasterController=new l;if(e){e()}},dependentFunctionKeys:["gmailReplyAreaMasterControllerInitialized","data.sendLaters.initialized","sendLaterMenuInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:c.Modules.SendLater.SendLaterButtonViewController,_initialize:function(){c.Modules.SendLater.SendLaterButtonViewController.prototype._initialize.call(this)},_setupSendLaterModel:function(){var e=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);if(!e||e.length===0){return}this._sendLaterModel=c.Services.Threads.ThreadStorer.getSendLater(e[0]);if(this._sendLaterModel){var t=this._sendLaterModel.get("status");switch(t){case"SENT":case"ERROR_ON_SEND":case"SENT_EARLY_BY_USER":this._sendLaterModel=null;break}}if(!this._sendLaterModel){this._sendLaterModel=c.Data.newSendLater();this._sendLaterModel.set("gmailDraftId",e[0])}var n=this;this._sendLaterModel.watch("save",function(){n._updateDisplay();if(n._isSendLaterScheduled()){n._composeWindowViewController.setModuleActive("sendLater");n._composeWindowViewController.notify("sendLaterScheduled",n._sendLaterModel,true)}},this);this._sendLaterModel.watch("delete",function(){n._setupSendLaterModel();n._updateDisplay();n._composeWindowViewController.setModuleInactive("sendLater");n._composeWindowViewController.notify("sendLaterCancelled")},this);this._sendLaterModel.watch("set",function(){n._setupSendLaterModel();n._updateDisplay();if(n._isSendLaterScheduled()){n._composeWindowViewController.setModuleActive("sendLater");n._composeWindowViewController.notify("sendLaterScheduled",n._sendLaterModel,true)}else{n._composeWindowViewController.setModuleInactive("sendLater");n._composeWindowViewController.notify("sendLaterCancelled")}},this,"status");this._sendLaterModel.incrementNumberOfReplies()},setScheduledDate:function(e){if(!this._sendLaterModel){this._setupSendLaterModel()}this._sendLaterModel.set("sendDate",e.getTime());this._sendLaterModel.set("subject",this._composeWindowViewController.getSubject());this._sendLaterModel.set("sendLaterType","REPLY");var t=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);this._sendLaterModel.set("gmailDraftId",t[0]);this._sendLaterModel.save();this._updateDisplay();this._composeWindowViewController.setModuleActive("sendLater");this._composeWindowViewController.notify("sendLaterScheduled",this._sendLaterModel,true);c.Tracker.track("send later reply scheduled")},cancelSendLater:function(){var e=this._sendLaterModel;this._sendLaterModel=null;if(e){e.del()}this._updateDisplay();c.Tracker.track("send later reply cancelled")},aboutToSend:function(){if(this._sendLaterModel){this._sendLaterModel.decrementNumberOfReplies()}},aboutToDiscard:function(){if(this._sendLaterModel){this._sendLaterModel.decrementNumberOfReplies()}},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});c.Modules.SendLater.SendLaterButtonViewController.prototype.destroy.call(this)}});i.set("BentoBox.Modules.SendLater.SendLaterButtonReplyViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SendLaterRefreshManager",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);this._bindToEvents()},_bindToEvents:function(){var e=this;r.observe("viewChanged",function(){e._handleViewChanged()});r.observe("conversationThreadLoadedEvent",function(){e._handleConversationLoaded()})},_handleViewChanged:function(){if(r.isDrafts()){c.Data.getAllSendLaters().refresh()}},_handleConversationLoaded:function(){var e=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);if(!e||e.length===0){return}var t=e[0];var n=c.Data.getAllSendLaters().getSendLaterForHexGmailThreadId(t);if(n&&n.isSavedOnServer()){n.refresh()}}});i.set("BentoBox.Modules.SendLaterRefreshManager",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=r.GmailThreadListViewProvider;var h=e.Class.subclass({className:"SendLaterListThreadListViewProvider",superclass:d,_memberVariables:[],_initialize:function(){d.prototype._initialize.call(this)},getRelevantRequestParameters:function(){return{search:"drafts",view:"tl"}},isCustomList:function(){return false},start:function(e){},getCrapFormatThreads:function(t,n){var i=this;return new e.RSVP.Promise(function(e,t){e(i._getThreadsWithHexGmailThreadIdsAdded(n))})},_getThreadsWithHexGmailThreadIdsAdded:function(e){var t=r.ThreadResponseProcessor.extractThreads(e);if(!t){return}for(var n=0;n<t.length;n++){var i=t[n];i[15]="streakthreadid "+i[0]}return t}});i.set("BentoBox.Modules.SendLaterListThreadListViewProvider",h);r.GmailThreadListViewRegister.registerProvider(h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SendLaterListInboxRowManipulation",superclass:r.InboxManipulator.InboxRowManipulationBase,_memberVariables:[{name:"_sendLater",destroy:false,set:true},{name:"_hexGmailThreadId",destroy:false,set:true},{name:"_element",destroy:true},{name:"_originalDate",destroy:false}],_initialize:function(){r.InboxManipulator.InboxRowManipulationBase.prototype._initialize.call(this)},setThreadDOMRow:function(e){this._threadDOMRow=e;this._originalDate=e.date.html()},getManipulationType:function(){return"REPLACE_CONTENT"},getColumnName:function(){return"DATE"},getElement:function(){if(this._element){return this._element}var e;if(this._sendLater.get("status")==="ERROR_ON_SEND"){e='<span class="bbSendLater errorSendLater">'+c.Locale.getString("send_later_list_error")+"</span>"}else if(this._sendLater.get("status")==="SENT"){e='<span class="bbSendLater sendLaterSent">'+c.Locale.getString("send_later_sent")+"</span>"}else if(this._sendLater.get("sendDate")){e='<span class="bbSendLater sendLater">'+c.Locale.getString("send_later_list_scheduled")+": "+a.create(this._sendLater.get("sendDate")).customFormat("shortFormat")+"</span>"}this._element=t(e);this._element[0].setAttribute("title","streakthreadid "+this._hexGmailThreadId);return this._element}});i.set("BentoBox.Modules.SendLaterListInboxRowManipulation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SendLaterListInboxRowManipulationSource",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getTableManipulation:function(){if(!r.isDrafts()){return}return{type:"COLUMN_WIDTH",columnName:"DATE",width:200}},getRowManipulation:function(e,t){if(!r.isDrafts()){return}var n=c.Services.Threads.ThreadStorer.getSendLater(e);if(!n){return}if(!n.get("sendDate")){return}var a=i.getInstance("BentoBox.Modules.SendLaterListInboxRowManipulation");a.setSendLater(n);a.setHexGmailThreadId(e);return a}});e.DependencyManager.addFunction({functionKey:"sendLaterListInboxRowManipulationSourceInitialized",functionReference:function(){var e=new d;i.set("BentoBox.Modules.SendLaterListInboxRowManipulationSource",e);r.InboxManipulator.addDataSource(e)},dependentFunctionKeys:["inboxManipulatorInitialized","threadsInitialized","htmlLoaded","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SendLaterListDiscardWatcher",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);r.observe("viewChanged",this._handleViewChanged.bind(this))},_handleViewChanged:function(){if(!r.isDrafts()){return}this._bindToDiscardButton()},_bindToDiscardButton:function(){var e=r.getDiscardDraftsButton();e.unbind(".streakEvents");e.bind("click.streakEvents",this._handleDiscardButtonClicked.bind(this))},_handleDiscardButtonClicked:function(){var e=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);if(!e||e.length===0){return}for(var t=0;t<e.length;t++){var n=c.Services.Threads.ThreadStorer.getSendLater(e[t]);if(n){n.del()}}}});e.DependencyManager.addFunction({functionKey:"sendLaterListDiscardWatcher",functionReference:function(){i.set("BentoBox.Modules.SendLaterListDiscardWatcher",new d)},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Date,a=e.Gmail,o=e.APIRequester,s=e.HTML,l=e.Eventer,u=e.BentoBox;var c={nonPopupVariations:["BasicModal","Modal_var1","Modal_var2","Modal_var3"],newUserVariations:["Modal_var3"],popupVariations:["SideBySide","OauthFirst"],defaultAccounts:[]};var d,h;d=h={trackingContext:{widgetContext:"signinPrompt"},initLoggedOut:function(e){if(this.isDismissedForever()){if(e){e()}return}this.initVariation(function(){d.trackingContext.promptVariation=d.promptVariation;d.track("startPrompt");d["start"+d.promptVariation]();if(e){e()}})},initVariation:function(t){var i;if(e.debugTrackUser&&e.debugTrackUser.isUserFirstCall){i=c.newUserVariations}else{i=c.nonPopupVariations.concat(c.popupVariations)}if(c.defaultAccounts.indexOf(u.userEmail)>-1){d.promptVariation="Default";t()}else{d.promptVariation=n.shuffle(i)[n.random(0,i.length-1)];if(c.popupVariations.indexOf(d.promptVariation)>-1){this.arePopupsDisabled(function(e){if(e){i=c.nonPopupVariations;d.promptVariation=n.shuffle(i)[n.random(0,i.length-1)]}t()})}else{t()}}},arePopupsDisabled:function(e){var t=window.open("about:blank","test popup","height="+2+",width="+2+",left="+-2+",top="+-2+",toolbar=0,resizable=0,menubar=0,location=0,status=0,scrollbars=0");if(!t){e(true);return}setTimeout(function(){try{if(n.isReal(t.outerHeight)&&t.outerHeight===0){e(true)}else{e(false)}}finally{t.close()}},50)},startSideBySide:function(){var e=t(window).width();var n=850;var i=Math.max(e-n,0);var r=i/2;var a=s.get("signinPromptOverlay",true);var o=u.Widgets.Tour.Overlay.create({infoHTML:a,infoCss:{top:"100px",left:"auto",right:r+"px",fontSize:"120%",width:"380px"},opacity:.8,showRightButton:false,showLeftButton:false});var l=a.find("#signinPromptDismissForever");l.on("click",function(e){d.track("dismissForeverClicked");e.preventDefault();d.dismissForever();o.destroy();if(d.openWindow&&d.openWindow.close){d.openWindow.close()}});o.show();this.openOauth(r,150,550,430,function(){o.destroy()})},startOauthFirst:function(){d.openOauth(null,null,null,null,null,function(){d.track("signinPromptPostModalShow");var e=s.get("signinPromptModal",true);var t=u.Widgets.Modal.create({inner:e,showCancel:true,showConfirm:false,escClose:false,close:false,showTitle:false,width:"500px",cancelText:"Not Now",cancelFunc:function(){t.close();d.track("signingPromptPostModalCancel")}});t.show();var n=e.find("#signinPromptButton");var i=u.Widgets.Button.create({name:"Login Now",color:"blue",onFunc:function(){d.track("signinPromptPostModalLogin");t.close();d.openOauth()}});i.el.css({margin:"50px auto 50px auto",display:"block",width:"200px",height:"40px",fontSize:"20px",paddingTop:"13px"});n.append(i.el);e.find("#signinPromptHelp").html("Streak needs access to function. We don't make any changes to your account and you can remove Streak at any time.");var r=e.find("#signinPromptDismissForever");r.on("click",function(e){e.preventDefault();d.dismissForever();if(t){t.close()}if(d.openWindow&&d.openWindow.close){d.openWindow.close()}})})},callShowModal2:function(){this.startModal2("_var1",{},inner)},startModalVideo:function(n,i){defaults={promptButtonText:"Login Now",showCancel:false,showDismiss:false,mainImage:"videoPlayer.png",close:false};options={};t.extend(options,defaults,i);d.track("signinPrompt"+n+"Show");inner=e.$("<div></div>");var r=t('<iframe width="560" height="315" src="http://www.youtube.com/embed/VsCCCshi-V0?autoplay=1" frameborder="0" allowfullscreen></iframe>');var a=options.mainImage;var o=e.server+e.combinedPath+"images/"+a;var s=t("<div class='streak_container_modal_why_use_img'><img src='"+o+"'></img></div>").appendTo(inner);s.append("<div class='streak_signin_show'>Let us show you how to use Streak in under 2 minutes! Here's an example of how a sales person may use Streak - but you can use it to manage any process. </div>");s.click(function(e){d.track("videoSigningClicked");t(s.children()).hide();r.appendTo(s)});inner.append("<div id='signinPromptButton'></div>");var l=u.Widgets.Modal.create({inner:inner,showCancel:options.showCancel,showConfirm:false,escClose:options.close,close:options.close,title:u.Locale.getString("why_streak_goodbye_stress"),width:"560px",cancelText:options.cancelText,cancelFunc:function(){l.close();d.track("signinPrompt"+n+"Cancel")}});l.show();var c=inner.find("#signinPromptButton");var h=u.Widgets.Button.create({name:options.promptButtonText,color:"blue",onFunc:function(){d.track("signinPrompt"+n+"Login");l.close();d.openOauth()}});h.el.css({margin:"50px auto 0px auto",display:"block",width:"200px",height:"40px",fontSize:"20px",paddingTop:"10px"});c.append(h.el)},startModal2:function(n,i,r){defaults={promptButtonText:"Login Now",showCancel:false,showDismiss:false,mainImage:"ver1StreakModalSignin.png",close:false};options={};t.extend(options,defaults,i);d.track("signinPrompt"+n+"Show");r=e.$("<div></div>");var a=t("<div class='streak_container_modal_why_use'></div>").appendTo(r);var o=t("<div class='streak_bulletContainer'> </div>").appendTo(a);var s=e.server+e.combinedPath+"images/bulletPointImage.png";var l=t("<img src='"+s+"'></img>");var c=t("<div class='bulletStreakModal'>"+u.Locale.getString("why_streak_bullet_01_01")+"</div>");o.append(l);o.append(c);var h=t("<div class='streak_bulletContainer'> </div>").appendTo(a);var f=t("<img src='"+s+"'></img>");var p=t("<div class='bulletStreakModal'>"+u.Locale.getString("why_streak_bullet_01_02")+"</div>");h.append(f);h.append(p);var m=t("<div class='streak_bulletContainer'> </div>").appendTo(a);var _=t("<img src='"+s+"'></img>");var g=t("<div class='bulletStreakModal'>"+u.Locale.getString("why_streak_bullet_01_03")+"</div>");m.append(_);m.append(g);var v=t("<div class='streak_bulletContainer'> </div>").appendTo(a);var y=t("<img src='"+s+"'></img>");var w=t("<div class='bulletStreakModal'>"+u.Locale.getString("why_streak_bullet_01_04")+"</div>");v.append(y);v.append(w);var b=options.mainImage;var C=e.server+e.combinedPath+"images/"+b;var S=t("<div class='streak_container_modal_why_use_imgNormal'><img src='"+C+"'></img></div>").appendTo(r);r.append("<div id='signinPromptButton'></div>");var T=u.Widgets.Modal.create({inner:r,showCancel:options.showCancel,showConfirm:false,escClose:options.close,close:options.close,title:u.Locale.getString("why_streak_goodbye_stress"),width:"600px",cancelText:options.cancelText,cancelFunc:function(){T.close();d.track("signinPrompt"+n+"Cancel")}});T.show();var x=r.find("#signinPromptButton");var k=u.Widgets.Button.create({name:options.promptButtonText,color:"blue",onFunc:function(){d.track("signinPrompt"+n+"Login");T.close();d.openOauth()}});k.el.css({margin:"50px auto 0px auto",display:"block",width:"200px",height:"40px",fontSize:"20px",paddingTop:"10px"});x.append(k.el)},startModal:function(e,n){defaults={promptButtonText:"Continue with Streak",cancelText:"Not Now",showCancel:true,showDismiss:true,close:false};options={};t.extend(options,defaults,n);d.track("signinPrompt"+e+"Show");var i;if(options.showDismiss){i=s.get("signinPromptModal",true)}else{i=s.get("signinPromptModal",true);i.find("#signinPromptDismissForever").remove()}var r=u.Widgets.Modal.create({inner:i,showCancel:options.showCancel,showConfirm:false,escClose:options.close,close:options.close,showTitle:false,width:"500px",cancelText:options.cancelText,cancelFunc:function(){r.close();d.track("signinPrompt"+e+"Cancel")}});r.show();var a=i.find("#signinPromptButton");var o=u.Widgets.Button.create({name:options.promptButtonText,color:"blue",onFunc:function(){d.track("signinPrompt"+e+"Login");r.close();d.openOauth()}});o.el.css({margin:"50px auto 50px auto",display:"block",width:"200px",height:"40px",fontSize:"20px",paddingTop:"10px"});a.append(o.el);if(options.showDismiss){var l=i.find("#signinPromptDismissForever");l.on("click",function(e){e.preventDefault();d.dismissForever();if(r){r.close()}if(d.openWindow&&d.openWindow.close){d.openWindow.close()}})}},startBasicModal:function(){d.startModal("Modal",{})},startModal_var1:function(){d.startModal("Modal_var1",{showCancel:false})},startModal_var2:function(){d.startModal("Modal_var2",{showCancel:false,promptButtonText:"Continue with Streak"})},startModal_var3:function(){d.startModal("Modal_var3",{showCancel:false,promptButtonText:"Continue"})},startModal_var4_new:function(){d.startModal2("Modal_var4_new",{promptButtonText:"Continue with Streak",mainImage:"ver1StreakModalSignin.png"})},startModal_var5_new:function(){d.startModal2("Modal_var5_new",{promptButtonText:"Continue with Streak",mainImage:"samplePipeline.png"})},startModal_var6_new:function(){d.startModalVideo("Modal_var6_new",{promptButtonText:"Continue with Streak"})},startDefault:function(){u.Modules.TopNav.openMenu()},openOauth:function(t,r,a,o,l,c){d.track("showOauth");var h=s.get("loadingOauth");if(n.isNotReal(a)){a=550}if(n.isNotReal(o)){o=560}if(n.isReal(t)){t=(window.screenX||window.screenLeft||0)+(t||0)}else{t=window.screenX+(window.outerWidth/2-o/2)}if(n.isReal(r)){r=(window.screenY||window.screenTop||0)+(r||0)}else{r=window.screenY+(window.outerHeight/2-a/2)}var f=e.originalEmail||u.userEmail;var p=h({streakServer:e.server,oauthEmail:f});i.fromEventTarget(window,"message").filter(function(t){return t.origin===e.server&&t.data&&t.data.oauthComplete}).take(1).onValue(function(){u.Modules.TopNav.showLoading();if(l){l()}d.checkUserAuth(0,c)});d.openWindow=window.open("about:blank","Streak Authorization","height="+a+",width="+o+",left="+t+",top="+r+",toolbar=0,resizable=0,menubar=0,location=0,status=0,scrollbars=0");d.openWindow.document.write(p);d.openWindow.document.close()},checkUserAuth:function(e,t){o.get("users/me").getPromise().then(function(n){if(n){d.track("signinPromptComplete");u.UserStateController.userLoggedIn(n);return}if(e<5){setTimeout(function(){d.checkUserAuth(e+1,t)},500)}else{d.track("signinPromptDenied");u.Modules.TopNav.showExclamation();if(t){t()}}},function(){u.logError("error user signing in");u.trigger("error_load");u.isError=true;u.Modules.TopNav.showExclamation()})},isDismissedForever:function(){return u.LocalSettings.get("topNav/loggedOutDismissed")},dismissForever:function(){u.LocalSettings.set("topNav/loggedOutDismissed",true)},track:function(t){var n=e.originalEmail||u.userEmail;u.Tracker.trackStreakActive(this.trackingContext,{eventName:t,oauthEmail:n})}};e.DependencyManager.addFunction({functionKey:"signinPromptInitialized",functionToCall:h.initLoggedOut,functionContext:h,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","userLoggedOut"]});u.Modules.SigninPrompt=h})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._menu=null;this._searchView=null;this._snippetListView=null;this._addSnippetMenuItem=null;this._manageSnippetMenuItem=null;this._emptySnippetSection=null;this._searchListSeparator=null;this._setupUIComponents()};l.prototype=Object.create(e.ViewControllerBase.prototype);
n.extend(l.prototype,{getElement:function(){return this._menu.getElement()},addSearchView:function(e){this._searchView=e;this._searchListSeparator=this._menu.addSeparator(true);this._menu.addSection(e.getElement(),true)},addSnippetListView:function(e){this._snippetListView=e;this._menu.addSection(this._snippetListView.getElement(),true)},showEmptyMessage:function(){this._searchView.getElement().hide();this._snippetListView.getEl().hide();this._searchListSeparator.hide();this._emptySnippetSection.show();this._manageSnippetMenuItem.hide()},showList:function(){this._searchView.getElement().show();this._snippetListView.getEl().show();this._searchListSeparator.show();this._emptySnippetSection.hide();this._manageSnippetMenuItem.show()},reset:function(){this._menu.reset()},destroy:function(){this._menu.destroy()}});n.extend(l.prototype,{_setupUIComponents:function(){this._menu=s.Widgets.Menu.create({maxHeight:370});this._menu.getElement().addClass("snippetsMenuView streak__sdk_menu");this._menu.getElement().removeClass("J-M");this._setupEmptySnippetSection();this._menu.addSeparator();this._setupAddSnippetItem();this._setupManageSnippetItem()},_setupEmptySnippetSection:function(){this._emptySnippetSection=t(document.createElement("div"));this._emptySnippetSection.addClass("streak__snippetsMenu_emptySection");this._emptySnippetSection[0].innerHTML=s.Locale.getString("snippets_empty");this._menu.addSection(this._emptySnippetSection)},_setupAddSnippetItem:function(){var e=this;this._addSnippetMenuItem=this._menu.addItem(s.Locale.getString("create_snippet"),function(){e._callDelegateFunction("createSnippet")});this._addSnippetMenuItem.addClass("streak__createSnippet")},_setupManageSnippetItem:function(){var e=this;this._manageSnippetMenuItem=this._menu.addItem(s.Locale.getString("manage_snippets"),function(){e._callDelegateFunction("manageSnippets")});this._manageSnippetMenuItem.addClass("streak__manageSnippet")}});s.Modules.Snippets={};s.Modules.Snippets.SnippetsMenuView=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._searchViewController=null;this._listViewController=null;this._snippetsSearchController=null;this._snippetsMenuModel=null;this._view=null;this._snippetSelectedCallback=null;this._manageOpenCallback=null;this._dataSource=null;this._setupViewControllers();this._setupTheView();this._setupDelegates()};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{use:function(e){this._view.reset();this._searchViewController.clearQuery();this._snippetSelectedCallback=e.snippetSelectedCallback;this._manageOpenCallback=e.manageOpenCallback;this._doesUserHaveSnippetsAndModifyDisplayAppropriately()},getElement:function(){return this._view.getElement()},setDataSource:function(e){this._dataSource=e;this._listViewController.reset()},destroy:function(){e.ViewControllerBase.prototype.destroy.call(this);this._searchViewController.destroy();this._listViewController.destroy();this._view.destroy()}});n.extend(l.prototype,{createSnippet:function(){if(this._manageOpenCallback){this._manageOpenCallback()}s.Modules.Snippets.SnippetsManageViewController.use();if(!this._dataSource){return}var e=this._dataSource.getSubject();var t=this._dataSource.getBody();s.Modules.Snippets.SnippetsManageViewController.addNewSnippet({subject:e,snippetText:t});s.Tracker.track("create snippets open")},manageSnippets:function(){if(this._manageOpenCallback){this._manageOpenCallback()}s.Modules.Snippets.SnippetsManageViewController.use();s.Tracker.track("manage snippets open")},rowPressed:function(e){if(e&&this._snippetSelectedCallback){this._snippetSelectedCallback(e.data)}}});n.extend(l.prototype,{_setupViewControllers:function(){this._searchViewController=new s.Widgets.SearchSimpleVC({placeholder:s.Locale.getString("search_all_snippets")});this._snippetsMenuModel=new s.Widgets.ListView.ListViewBaseModel;this._listViewController=new s.Widgets.ListView.ListViewViewController;this._snippetsSearchController=new s.Modules.Snippets.SnippetsSearchController},_setupDelegates:function(){this._listViewController.setDataSource(this._snippetsMenuModel);this._snippetsSearchController.setDataSource(this._snippetsMenuModel);this._snippetsMenuModel.addDelegate(this);this._searchViewController.addDelegate(this._listViewController);this._searchViewController.addDelegate(this._snippetsSearchController);this._listViewController.addDelegate(this);this._view.addDelegate(this)},_setupTheView:function(){this._view=new s.Modules.Snippets.SnippetsMenuView;this._view.addSnippetListView(this._listViewController.getView());this._view.addSearchView(this._searchViewController.getView())}});n.extend(l.prototype,{_doesUserHaveSnippetsAndModifyDisplayAppropriately:function(){if(s.Data.getAllSnippets().length>0){this._view.showList();this._searchViewController.focus()}else{this._view.showEmptyMessage()}}});e.DependencyManager.addFunction({functionKey:"snippetsMenuViewControllerInitialized",functionToCall:function(e){s.Modules.Snippets.SnippetsMenuViewController=new l;if(e){e()}},dependentFunctionKeys:["data.snippets.initialized","localeLoaded","htmlLoaded","data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){e.ViewControllerBase.call(this);this._snippetListModel=null;this._query=null;this._delayedRenderTimeout=null;this._snippetSectionRowMap={};this._bindToSnippetCollectionChanges()};l.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(l.prototype,{PERSONAL_SNIPPET_KEY:"snippets_personal",_bindToSnippetCollectionChanges:function(){var e=this;var t=n.debounce(function(){e._querySnippets(e._query)},300);s.Data.getAllSnippets().watch("collectionChange",function(){t()},this);s.Data.getAllSnippets().watch("collectionRefreshed",function(e){if(e.didCollectionChange){t()}},this);var i=n.debounce(function(){e._updateResults()},300);s.Data.getAllSnippets().watch("change",function(e){if(e.newValue&&e.previousValue){if(e.newValue===e.previousValue){return}}i()},this)},_updateResults:function(){var e=this;clearTimeout(this._delayedRenderTimeout);this._delayedRenderTimeout=setTimeout(function(){e._querySnippets(e._query)},100)},setDataSource:function(e){this._snippetsListModel=e;this._querySnippets("")},queryChange:function(e){this._querySnippets(e)},destroy:function(){this._snippetsListModel=null;e.NotificationCenter.unsubscribe({observer:this})},_querySnippets:function(e){this._query=e;var t=this;this._snippetsListModel.removeAllSections();var i=n.chain(s.Data.getAllSnippets()).filter(function(t){if(!e){return true}return t.displayName().toLowerCase().indexOf(e.toLowerCase())>-1}).sortBy(function(e){return e.displayName()}).groupBy(function(e){return e.get("pipelineKey")||t.PERSONAL_SNIPPET_KEY}).value();this._addSnippetSections(i);this._callDelegateFunction("snippetsRendered")},_addSnippetSections:function(e){this._snippetSectionRowMap={};var t=[];for(var i in e){if(i!==this.PERSONAL_SNIPPET_KEY){t.push(s.Data.getPipeline(i))}}t=n.sortBy(t,function(e){return e.displayName()});if(e[this.PERSONAL_SNIPPET_KEY]){this._addSnippetSection(s.Locale.getString(this.PERSONAL_SNIPPET_KEY),e[this.PERSONAL_SNIPPET_KEY])}for(var r=0;r<t.length;r++){this._addSnippetSection(t[r].displayName(),e[t[r].key()])}},_addSnippetSection:function(e,t){var i=n.map(t,this._convertSnippetToListRow);var r=this._snippetsListModel.addSection({name:e,rows:i,doesSectionToggle:true,extraHeaderText:"("+t.length+")"});for(var a=0;a<t.length;a++){this._snippetSectionRowMap[t[a].getId()]={sectionIndex:r,rowIndex:a}}},_convertSnippetToListRow:function(e){var t=e.displayNameHTML();if(e.get("snippetKeyShortcut")){t+='<span class="shortHint">('+n.escape(e.get("snippetKeyShortcut"))+")</span>"}return{html:t,data:e}},getSnippetListPosition:function(e){return this._snippetSectionRowMap[e.getId()]}});s.Modules.Snippets.SnippetsSearchController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailComposeManager.registerModifierModule(this);i.GmailReplyManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){return[new s.Modules.Snippets.SnippetsShortcutListenerViewController,new s.Modules.Snippets.SnippetsAutoCompleteMenuViewController,new s.Modules.Snippets.SnippetsButtonComposeViewController]}});o.addFunction({functionKey:"snippetsComposeMasterControllerInitialized",functionToCall:function(e){s.Modules.Snippets.SnippetsComposeMasterController=new l;if(e){e()}},dependentFunctionKeys:["gmailReplyAreaMasterControllerInitialized","gmailComposeWindowMasterControllerInitialized","snippetsMenuViewControllerInitialized","data.streakSettings.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this)};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e;this._setupMenuButton()},getSubject:function(){if(this._composeWindowViewController.isReply&&this._composeWindowViewController.isReply()){return""}return this._composeWindowViewController.getSubject()},getBody:function(){return this._composeWindowViewController.getComposeBodyHTML()},destroy:function(){this._composeWindowViewController=null;this._callDelegateFunction("destroy",this);e.ViewControllerBase.prototype.destroy.call(this)}});n.extend(l.prototype,{_setupMenuButton:function(){var e=this;this._composeWindowViewController.getComposeView().addButton({iconClass:"snippetIcon streak__snippetButton",tooltip:s.Locale.getString("snippets_tooltip"),hasDropdown:true,type:"MODIFIER",orderHint:3,onClick:function(t){s.Tracker.track("snippets menu open");t.dropdown.el.appendChild(s.Modules.Snippets.SnippetsMenuViewController.getElement()[0]);e._prepareMenu()}})},_prepareMenu:function(){var e=this;s.Modules.Snippets.SnippetsMenuViewController.use({snippetSelectedCallback:function(t){e._snippetSelected(t)},manageOpenCallback:function(){}});s.Modules.Snippets.SnippetsMenuViewController.setDataSource(this)},_snippetSelected:function(e){this._composeWindowViewController.addTextAtCurrentCursorPosition(e.getText());if(e.get("subject")){this._composeWindowViewController.setSubject(e.get("subject"))}this._composeWindowViewController.notify("snippetAdded",e);s.Tracker.track("snippet inserted",{method:"snippet menu"})}});s.Modules.Snippets.SnippetsButtonComposeViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Modules.ComposeViewControllerBase.call(this);this._characterSequenceModel=null};l.prototype=Object.create(s.Modules.ComposeViewControllerBase.prototype);n.extend(l.prototype,{initialize:function(e){this._composeWindowViewController=e;this._setupCharacterSequenceModel()},getListenerType:function(){return"CHARACTER_SEQUENCE"},getCharacterSequenceListener:function(){return this._characterSequenceModel},destroy:function(){this._characterSequenceModel.destroy();this._composeWindowViewController=null;this._callDelegateFunction("destroy",this);e.ViewControllerBase.prototype.destroy.call(this)},_setupCharacterSequenceModel:function(){this._characterSequenceModel=new s.Modules.Snippets.SnippetsCharacterSequenceModel;this._characterSequenceModel.addDelegate(this)},exactMatchFound:function(e){var t=this._getSnippetWithSequence(e);if(!t){return}if(t.get("subject")){this._composeWindowViewController.setSubject(t.get("subject"))}this._composeWindowViewController.replaceLastNCharacters(e.length-1,t.getText());this._composeWindowViewController.notify("snippetAdded",t);s.Tracker.track("snippet inserted",{method:"shortcut entered"})},_getSnippetWithSequence:function(e){var t=s.Data.getAllSnippets();for(var n=0;n<t.length;n++){if(t[n].get("snippetKeyShortcut")===e){return t[n]}}}});s.Modules.Snippets.SnippetsShortcutListenerViewController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){s.Controllers.CharacterSequenceController.CharacterSequenceBaseDataSource.call(this);this._sequences=[];this._setupSnippetBindings();this._setupSequences()};l.prototype=Object.create(s.Controllers.CharacterSequenceController.CharacterSequenceBaseDataSource.prototype);n.extend(l.prototype,{getSequences:function(){return this._sequences},onMatchShouldSuppress:function(){return true},destroy:function(){s.Controllers.CharacterSequenceController.CharacterSequenceBaseDataSource.prototype.destroy.call(this);e.NotificationCenter.unsubscribe({observer:this})},_setupSnippetBindings:function(){var e=this;s.Data.getAllSnippets().watch("collectionChange",function(){e._setupSequences()},this);s.Data.getAllSnippets().watch("change",function(t){if(!t.model){return}if(t.property==="snippetKeyShortcut"){e._setupSequences()}},this)},_setupSequences:function(){this._sequences.length=0;var e=n.chain(s.Data.getAllSnippets()).map(function(e){return e.get("snippetKeyShortcut")}).compact().value();n.mutate("union",this._sequences,e);this._callDelegateFunction("sequencesChanged")}});s.Modules.Snippets.SnippetsCharacterSequenceModel=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._element=null;this._rightPane=null;this._setupUIElements()};n.extend(u.prototype,{getElement:function(){return this._element},setListView:function(e){this._element.find(".streak_bm_container").append(e.getElement())},setRightPaneHTML:function(e){this._rightPane[0].innerHTML=e},_setupUIElements:function(){this._element=i.get("snippetsAutoCompleteMenu",true);this._rightPane=this._element.find(".streak__bm_right_pane")}});n.extend(u.prototype,{destroy:function(){this._element.remove()}});l.Modules.Snippets.SnippetsAutoCompleteMenuView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.jwerty,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){l.Modules.ComposeViewControllerBase.call(this);this._view=null;this._listViewModel=null;this._listViewController=null;this._lastSeenSequence=null;this._menuActive=false;this._dontShow=false;this._characterSequenceModel=null};u.prototype=Object.create(l.Modules.ComposeViewControllerBase.prototype);n.extend(u.prototype,{initialize:function(e){this._composeWindowViewController=e;this._setupViewControllers();this._setupDelegates();this._setupTheView()},getListenerType:function(){return"CHARACTER_SEQUENCE"},getCharacterSequenceListener:function(){return this._characterSequenceModel},composeKeydown:function(e){if(!this._isAutoCompleteEnabled()){return}if(!this._menuActive){return}if(a.is("up/down/enter",e)){this._callDelegateFunction("keydown",e);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(a.is("enter",e)){this._callDelegateFunction("keyPressed",e.which);this._closeMenu()}return}},escapePressed:function(e){if(!this._isAutoCompleteEnabled()){return}if(!this._menuActive){return}this._dontShow=true;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();this._closeMenu()},partialMatchFound:function(e){if(!this._isAutoCompleteEnabled()){return}if(this._dontShow){return}this._lastSeenSequence=e;this._findSnippetsAndAddToList(e);this._openMenu()},noMatchFound:function(){this._lastSeenSequence=null;this._dontShow=false;this._closeMenu()},rowFocused:function(e){if(!e){return}this._view.setRightPaneHTML(e.snippet.getText())},rowPressed:function(e){if(!e){return}this._closeMenu();this._injectSnippet(e.snippet)},destroy:function(){this._listViewModel.destroy();this._listViewController.destroy();this._view.destroy();this._characterSequenceModel.destroy();this._callDelegateFunction("destroy",this);l.Modules.ComposeViewControllerBase.prototype.destroy.call(this)}});n.extend(u.prototype,{_openMenu:function(){this._composeWindowViewController.addElementAtCursorPosition(this._view.getElement());this._menuActive=true},_closeMenu:function(){this._view.getElement().detach();this._menuActive=false},_isAutoCompleteEnabled:function(){return l.Data.streakSettings.settingIsEnabled("settings_snippet_autocomplete")},_findSnippetsAndAddToList:function(e){var t=l.Data.getAllSnippets();var i=n.filter(t,function(t){return t.get("snippetKeyShortcut").indexOf(e)===0});this._addSnippetsToList(i)},_addSnippetsToList:function(e){this._listViewModel.removeAllSections();var t=n.map(e,function(e){return{text:e.displayName()+" ("+e.get("snippetKeyShortcut")+")",snippet:e}});this._listViewModel.addSection({rows:t})},_injectSnippet:function(e){if(e.get("subject")){this._composeWindowViewController.setSubject(e.get("subject"))}this._composeWindowViewController.replaceLastNCharacters(this._lastSeenSequence.length,e.getText());this._composeWindowViewController.notify("snippetAdded",e);l.Tracker.track("snippet inserted",{method:"autocomplete"})}});n.extend(u.prototype,{_setupViewControllers:function(){this._listViewModel=new l.Widgets.ListView.ListViewBaseModel;this._listViewController=new l.Widgets.ListView.ListViewViewController;this._characterSequenceModel=new l.Modules.Snippets.SnippetsCharacterSequenceModel},_setupDelegates:function(){this._listViewController.setDataSource(this._listViewModel);this._listViewController.addDelegate(this);this.addDelegate(this._listViewController);this._characterSequenceModel.addDelegate(this)},_setupView:function(){},_setupTheView:function(){this._view=new l.Modules.Snippets.SnippetsAutoCompleteMenuView;this._view.setListView(this._listViewController.getView())}});l.Modules.Snippets.SnippetsAutoCompleteMenuViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){l.Widgets.ListView.ListViewBaseModel.call(this)};u.prototype=Object.create(l.Widgets.ListView.ListViewBaseModel.prototype);n.extend(u.prototype,{getItemMetaClass:function(e,t){var n=this.infoForRow(e,t);if(!n.data){return}if(!this._canDeleteSnippet(n.data)){return}return"ar9"},_canDeleteSnippet:function(e){return e.get("userKey")===l.getUser().key()}});l.Modules.Snippets.SnippetsManageListModel=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){e.ViewControllerBase.call(this);this._modal=null;this._modalInner=null;this._searchContainer=null;this._listContainer=null;this._editorContainer=null;this._addNewSnippetLinkContainer=null;this._errorMessage=null;this._setupUIElements();this._setupEventBindings()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{_setupUIElements:function(){this._modalInner=i.get("snippetsManageView",true);this._searchContainer=this._modalInner.find(".streak__snippetManageView_searchContainer");this._listContainer=this._modalInner.find(".streak__snippetManageView_listContainer");this._noSnippetListContainer=this._modalInner.find(".streak__snippetManageView_noSnippetListContainer");this._noSnippetMainViewContainer=this._modalInner.find(".streak__snippetManageView_noSnippetsMainView");this._noSnippetSelectedMainViewContainer=this._modalInner.find(".streak__snippetManageView_noSnippetsSelected");this._editorContainer=this._modalInner.find(".streak__snippetManageView_editorContainer");this._addNewSnippetLinkContainer=this._modalInner.find(".streak__snippetManageView_addNewSnippetLinkContainer");this._errorMessage=this._modalInner.find(".streak__snippetManageView_errorMessage");this._modal=l.Widgets.Modal.create({title:l.Locale.getString("manage_snippets"),inner:this._modalInner,showConfirm:true,showCancel:false,confirmText:l.Locale.getString("modal_done"),width:"800px"})},_setupEventBindings:function(){var e=this;var t=l.Widgets.LinkButton.create({text:l.Locale.getString("create_new_snippet"),clickFunction:function(){e._callDelegateFunction("addNewSnippet");l.Tracker.track("create new snippet",{method:"list link"})}});this._addNewSnippetLinkContainer.append(t.getElement());var n=this._modalInner.find(".streak__snippetManageView_noSnippet a");n.attr("href","#");n.on("click",function(t){t.preventDefault();e._callDelegateFunction("addNewSnippet");l.Tracker.track("create new snippet",{method:"manage body link"})})},show:function(){this._modal.show()},close:function(){this._modal.close()},setSearchView:function(e){this._searchContainer.prepend(e.getElement())},setListView:function(e){this._listContainer.append(e.getElement())},setEditorView:function(e){this._editorContainer.append(e.getElement())},setErrorMessage:function(e){this._errorMessage[0].innerHTML=e},showNoSnippetMainView:function(){this._noSnippetMainViewContainer.show();this._noSnippetSelectedMainViewContainer.hide();this._editorContainer.hide()},showNoSnippetSelectedMainView:function(){this._noSnippetMainViewContainer.hide();this._noSnippetSelectedMainViewContainer.show();this._editorContainer.hide()},showEditorView:function(){this._noSnippetMainViewContainer.hide();this._noSnippetSelectedMainViewContainer.hide();this._editorContainer.show()},showNoSnippetList:function(){this._noSnippetListContainer.show();this._listContainer.hide()},showSnippetList:function(){this._noSnippetListContainer.hide();this._listContainer.show()}});e.DependencyManager.addFunction({functionKey:"snippetsManageViewInitialized",functionToCall:function(e){l.Modules.Snippets.SnippetsManageView=new u;if(e){e()}},dependentFunctionKeys:["data.snippets.initialized","localeLoaded","htmlLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){this._snippetsSearchController=null;this._searchViewController=null;this._listViewController=null;this._snippetEditorViewController=null;this._snippetsMenuModel=null;this._view=null;this._snippet=null;this._setupViewControllers();this._setupView();this._setupDelegates()};n.extend(l.prototype,{_setupViewControllers:function(){this._searchViewController=new s.Widgets.SearchSimpleVC({placeholder:s.Locale.getString("search_all_snippets")});this._snippetsMenuModel=new s.Modules.Snippets.SnippetsManageListModel;this._listViewController=new s.Widgets.ListView.ListViewViewController;this._snippetEditorViewController=s.Modules.Snippets.SnippetEditorViewController;this._snippetsSearchController=new s.Modules.Snippets.SnippetsSearchController},_setupDelegates:function(){this._listViewController.setDataSource(this._snippetsMenuModel);this._snippetsSearchController.setDataSource(this._snippetsMenuModel);this._snippetsMenuModel.addDelegate(this);this._searchViewController.addDelegate(this._listViewController);this._searchViewController.addDelegate(this._snippetsSearchController);this._snippetsSearchController.addDelegate(this);this._listViewController.addDelegate(this);this._view.addDelegate(this)},_setupView:function(){this._view=s.Modules.Snippets.SnippetsManageView;this._view.setListView(this._listViewController.getView());this._view.setSearchView(this._searchViewController.getView());this._view.setEditorView(this._snippetEditorViewController.getView())}});n.extend(l.prototype,{rowPressed:function(e){if(!e){return}this._snippetEditorViewController.setSnippet(e.data);this._snippet=e.data;this._view.showEditorView();this._snippetEditorViewController.focus();s.Tracker.track("select snippet for editing")},rowMetaActionPressed:function(e){if(!e){return}var t=this;s.Widgets.Modal.confirmDelete(e.data.displayName(),function(){t._deleteSnippet(e.data);s.Tracker.track("delete snippet")})},_deleteSnippet:function(e){if(e===this._snippet){this._snippet=null}e.del();if(this._isNoMoreSnippets()){this._delayedClose()}},_isNoMoreSnippets:function(){return s.Data.getAllSnippets().length===0},_delayedClose:function(){var e=this;setTimeout(function(){e._view.close()},10)},addNewSnippet:function(e){var t=s.Models.Snippet.create({snippetName:"New Snippet "+s.Data.getAllSnippets().length});s.Data.getAllSnippets().add(t);if(e){t.set("snippetText",e.snippetText);t.set("subject",e.subject)}else{t.set("snippetText"," ")}t.save();this._snippet=t;var n=this;setTimeout(function(){var e=n._snippetsSearchController.getSnippetListPosition(t);if(e!=null){n._listViewController.selectPosition(e);n._snippetEditorViewController.focusAndSelect()}},500);this._snippetEditorViewController.setSnippet(t)},use:function(){this._snippet=null;this._searchViewController.clearQuery();this._view.show();this._searchViewController.focus();this.snippetsRendered()},useForNewSnippet:function(e){this._searchViewController.clearQuery();this.addNewSnippet(e);this._view.show()},snippetsRendered:function(){if(s.Data.getAllSnippets().length===0){this._view.showNoSnippetList();this._view.showNoSnippetMainView();return}this._view.showSnippetList();if(!this._snippet){this._listViewController.reset();this._view.showNoSnippetSelectedMainView();return}this._view.showEditorView();var e=this._snippetsSearchController.getSnippetListPosition(this._snippet);if(!e){return}this._listViewController.selectPosition(e)}});e.DependencyManager.addFunction({functionKey:"snippetsManageViewControllerInitialized",functionToCall:function(e){s.Modules.Snippets.SnippetsManageViewController=new l;if(e){return e()}},dependentFunctionKeys:["snippetsManageViewInitialized","snippetEditorViewControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.HTML,r=e.Gmail,a=e.Date,o=e.NotificationCenter,s=e.DependencyManager,l=e.BentoBox;var u=function(){this._element=null;this._focusElement=null;this._setupUIElements()};n.extend(u.prototype,{_setupUIElements:function(){this._element=i.get("snippetEditorView",true)},getElement:function(){return this._element},focus:function(){if(this._focusElement.focus){this._focusElement.focus()}},focusAndSelect:function(){if(this._focusElement.focusAndSelect){this._focusElement.focusAndSelect()}},setNameInput:function(e){this._element.find(".streak__snippetEditorView_nameInput").append(e.getElement());this._focusElement=e},setShortcutInput:function(e){this._element.find(".streak__snippetEditorView_shortcutInput").append(e.getElement())},setPipelineInput:function(e){this._element.find(".streak__snippetEditorView_pipelineInput").append(e.getElement())},setSubjectInput:function(e){this._element.find(".streak__snippetEditorView_subjectInput").append(e.getElement())},setBodyInput:function(e){this._element.find(".streak__snippetEditorView_bodyInput").append(e.getElement())},destroy:function(){this._element.remove()}});l.Modules.Snippets.SnippetEditorView=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){this._snippet=null;this._view=null;this._nameInput=null;this._shortcutInput=null;this._pipelineInput=null;this._bodyInput=null;this._subjectInput=null;this._tabController=null;this._setupTheView();this._setupInputs()};n.extend(l.prototype,{_setupView:function(){},_setupTheView:function(){this._view=new s.Modules.Snippets.SnippetEditorView},_setupInputs:function(){this._setupTabController();this._setupNameInput();this._setupShortcutInput();this._setupPipelineInput();this._setupSubjectInput();this._setupBodyInput()},_setupTabController:function(){this._tabController=new s.Widgets.TabFocusController},_setupNameInput:function(){this._nameInput=s.Widgets.SidebarTextarea.create({border:"alwaysGmail",isValueValidFunction:function(e){if(!e){return false}var t=s.Data.getAllSnippets();for(var n=0;n<t.length;n++){if(t[n].get("snippetName")===e){return false}}return true}});this._view.setNameInput(this._nameInput);this._tabController.addView(this._nameInput)},_setupShortcutInput:function(){this._shortcutInput=s.Widgets.SidebarTextarea.create({border:"alwaysGmail",isValueValidFunction:function(e){if(!e){return true}var t=s.Data.getAllSnippets();for(var n=0;n<t.length;n++){if(t[n].get("snippetKeyShortcut")===e){return false}}return true}});this._view.setShortcutInput(this._shortcutInput);this._tabController.addView(this._shortcutInput)},_setupPipelineInput:function(){var e=this;this._pipelineInput=s.Widgets.CustomDropdown.create({border:"alwaysGmail",changeFunc:function(t){e._snippet.set("pipelineKey",t.value);e._snippet.set("partOfPipeline",!!t.value);e._snippet.save()}});this._view.setPipelineInput(this._pipelineInput);this._tabController.addView(this._pipelineInput)},_setupSubjectInput:function(){this._subjectInput=s.Widgets.SidebarTextarea.create({border:"alwaysGmail"});this._view.setSubjectInput(this._subjectInput);this._tabController.addView(this._subjectInput)},_setupBodyInput:function(){this._bodyInput=s.Widgets.SmartTextarea.create({useRawHTML:true,placeholder:s.Locale.getString("snippet_enter_text")});this._view.setBodyInput(this._bodyInput);this._tabController.addView(this._bodyInput)},setSnippet:function(e){this._snippet=e;this._nameInput.setModelAndProperty(e,"snippetName");this._shortcutInput.setModelAndProperty(e,"snippetKeyShortcut");this._bodyInput.setModelAndProperty(e,"snippetText");this._subjectInput.setModelAndProperty(e,"subject");this._setupPipelineDropdown()},_setupPipelineDropdown:function(){var e=[{name:s.Locale.getString("snippets_no_pipelines"),value:null}];if(s.Data.getAllPipelines().length>0){for(var t=0;t<s.Data.getAllPipelines().length;t++){e.push({name:s.Data.getAllPipelines()[t].displayName(),value:s.Data.getAllPipelines()[t].key()})}}this._pipelineInput.setMenuList(e);this._pipelineInput.setSelected(this._snippet.get("pipelineKey"))},focus:function(){this._view.focus()},focusAndSelect:function(){this._view.focusAndSelect()},getView:function(){return this._view},destroy:function(){this._view.destroy();this._nameInput.destroy();this._shortcutInput.destroy();this._pipelineInput.destroy();this._bodyInput.destroy();this._subjectInput.destroy()}});e.DependencyManager.addFunction({functionKey:"snippetEditorViewControllerInitialized",functionToCall:function(e){s.Modules.Snippets.SnippetEditorViewController=new l;if(e){e()}},dependentFunctionKeys:["htmlLoaded","localeLoaded","data.snippets.initialized","data.pipelines.initialized"]})})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Template,r=e.Date,a=e.Gmail,o=e.BentoBox;var s={init:function(){var n=this;n.trackingContext={widgetContext:"streakSettigns"};n.templates={};n.templates.button=i.underscore("modules/streakSettingsView/button");n.templates.section=i.underscore("modules/streakSettingsView/section");n.templates.setting=i.underscore("modules/streakSettingsView/setting");n.templates.settingParentButton=i.underscore("modules/streakSettingsView/parentButton");n.templates.subsettingTitle=i.underscore("modules/streakSettingsView/subsettingTitle");n.templates.comboButton=i.underscore("modules/streakSettingsView/comboButton");n.templates.subtitle=i.underscore("modules/streakSettingsView/subtitle");n._streakMenuButton=t(n.templates.button());n._streakMenuButton.click(function(t){t.preventDefault();e.BentoBox.UI.setURL("settingsStreak")});n._fromSettings=false;a.observe("viewChanged",n._viewChanged.bind(n))},initApp:function(){this._usingStreakApp=true},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})},getFirstSettingsPage:function(){var t=this;return e.BentoBox.Data.streakSettings.getPages()[0]},isSelected:function(e,t){var i=false;n.each(e,function(e){if(e===t){i=true}});return i},constructToggle:function(e,i,r,a){var s=this;var l;if(i.length===2&&n(i).contains("enabled")){var u=function(i,r){if(i==="enabled"){n.each(a,function(e){e.button.enable();t(e.el).removeClass("streakDisabled")})}else{n.each(a,function(e){e.button.disable();t(e.el).addClass("streakDisabled")})}if(!r&&e){e([i])}};l=o.Widgets.RadioList.create({changeCallback:u});for(var c=0;c<i.length;c++){l.addOption(o.Locale.getString(i[c]),i[c])
}l.setSelected(r[0]);if(n(r).contains("enabled")){u("enabled",true)}else{u("disabled",true)}l.el.addClass("rS")}else{throw new Error("Unsupported toggle")}return l},constructComboDropDown:function(i,r,a,s,l){var u=this;var c=e.BentoBox.Widgets.Menu.create();var d=s;var h=t(u.templates.comboButton({text:e.Locale.getString(l.displayName)}));var f=h.find(".streakSettingsComboButtonText");var p=o.Widgets.ButtonMenu.create({menu:c.el,closeOnSelect:false,customButton:h,onFunc:function(e){u.track("openedComoboDropDown",n.extend({},r,{settingKey:l.key}));if(e){e.stopPropagation()}},offFunc:function(e){u.track("closedComoboDropDown",n.extend({},r,{settingKey:l.key}));if(e){e.stopPropagation()}}});if(s.length===0){s=["None"]}function m(t){if(t.length>0){f.text(n.map(t,function(t){return e.Locale.getString(t)}).join(", "))}else{f.text(e.Locale.getString("none"))}}var _=[];c.addItem(e.Locale.getString("none"),function(r,a){if(r){d=[];if(i){i(d)}n.each(_,function(n){n.setCheckboxState(false);t(f).text(e.Locale.getString("none"))})}else{}});c.addSeparator();n.each(a,function(t){var r=t;var a=n.indexOf(s,r)>=0;var o=c.addCheckItem(e.Locale.getString(t),function(e,t){if(e){d.push(r)}else{d=n.without(d,r)}m(d);if(i){i(d)}if(d.indexOf("desktopNotification")>-1){u._checkDesktopNotificationPermission()}},a);_.push(o)});m(s);return p},getWidget:function(e,t,n){var i=this;var r=t.selectedValues;if(r.length>0&&r[0]==="default"){r=t.defaultValues}var a=function(n){o.Data.streakSettings.setSelectedValues(e.pageKey,e.sectionKey,t.key,n)};switch(t.widgetType){case"enabled_disabled":return i.constructToggle(a,t.possibleValues,r,n);case"combo_dropdown":return i.constructComboDropDown(a,e,t.possibleValues,r,t);default:throw new Error("Unsupported widgetType "+t.widgetType)}},renderSubSetting:function(n,i,r){var a=this;var s=t(a.templates.subsettingTitle({subsettingTitle:e.Locale.getString(i.displayName)}));if(i.subtitle){s.append(a.templates.subtitle({text:o.Locale.getString(i.subtitle)}))}var l=a.getWidget(n,i);r.find(".streakSettingsSubsettingList").append(s);r.find(".streakSettingsSubsettingWidgets").append(l.el);return l},renderSetting:function(i,r){var a=this;var s;var l=t(a.templates.setting({settingTitle:e.Locale.getString(r.displayName)}));if(r.subtitle){l.find(".streakSettingsSettingTitle").append(a.templates.subtitle({text:o.Locale.getString(r.subtitle)}))}var u=[];if(n.isReal(r.subsettings)&&r.subsettings.length>0){for(var c=0;c<r.subsettings.length;c++){try{u.push(a.renderSubSetting(i,r.subsettings[c],l))}catch(d){o.logError("error rendering subsetting",d)}}}else{l.find(".streakSettingChildSetting").remove()}if(n.isReal(r.subsettings)&&r.subsettings.length>0){s=a.getWidget(i,r,u)}else{s=a.getWidget(i,r)}l.find(".streakSettingsSettingWidget").append(s.el);return l},renderSettingsSection:function(i,r){var a=this;var s=t(a.templates.section({sectionTitle:e.Locale.getString(i.displayName)}));n.each(i.settings,function(e){try{s.find(".streakSettingsSectionBody").append(a.renderSetting(r,e))}catch(t){o.logError("error rendering setting",t)}});return s},_loadStreakPlatformSettings:function(){var e=this;var n=t(this.templates.section({sectionTitle:"Streak Platform"}));var i=[{name:"Use Streak CRM & Tools",key:"activeApps/streak"},{name:"Use DocSend",key:"activeApps/docsend"}];i.forEach(function(i){var r=t(e.templates.setting({settingTitle:i.name}));n.find(".streakSettingsSectionBody").append(r);function a(e){o.LocalSettings.set(i.key,e[0]=="enabled");o.ButterBarManager.showMessage("Saved. Refresh to apply the changes.")}var s=e.constructToggle(a,["enabled","disabled"],[o.LocalSettings.get(i.key)?"enabled":"disabled"]);r.find(".streakSettingsSettingWidget").append(s.el)});return n},_loadStreakAppSettings:function(){var e=this;var i=t("<div/>");var r=e.getFirstSettingsPage();var a=r.key;n.each(r.sections,function(t){var n={pageKey:a,sectionKey:t.key};i.append(e.renderSettingsSection(t,n))});return i},_renderStreakSettings:function(){var e=this;a.Settings.getContentBodyBlockContainer().find(".streakSettings").remove();e._streakSettingsContainer=t("<div/>").addClass("streakSettings r4 r7").append(e._loadStreakPlatformSettings());if(this._usingStreakApp){e._streakSettingsContainer.append(e._loadStreakAppSettings())}a.Settings.getContentBodyBlockContainer().append(e._streakSettingsContainer)},_viewChanged:function(){var t=this;if(a.view==="settings"){return e.Utils.waitFor(function(){return a.view!="settings"||e.Gmail.Settings.getEndingMenuMarker().length>0},60*1e3,50).then(function(){if(a.view=="settings"){t._updateGmailSettingsPage()}})}else if(a.view==="settingsStreak"){if(e.Gmail.getCurrentMainContainer().find(".streakSettingsButton").length===0){o.UI.setURL("settings",null,true).then(function(){if(a.view=="settings"){o.UI.setURL("settingsStreak",null,true)}})}else{this._renderStreakSettingsPage()}}},_updateGmailSettingsPage:function(){var t=this;a.Settings.getContentBodyBlockContainer().find(".streakSettings").remove();if(e.Gmail.getCurrentMainContainer().find(".streakSettingsButton").length===0){e.Gmail.Settings.getEndingMenuMarker().before(t._streakMenuButton)}t._streakMenuButton.removeClass("fZ").addClass("f1");a.Settings.getContentBodyBlock().show()},_renderStreakSettingsPage:function(){var n=this;n._renderStreakSettings();n._streakMenuButton.find("a").focus();if(this._usingStreakApp){var i=o.Data.streakSettings.getLatestObject();o.Data.streakSettings.refresh(function(){var t=o.Data.streakSettings.getLatestObject();if(!e.Utils.isDeepEquals(i,t)){n._renderStreakSettings()}})}a.Settings.getSettingTabs().off(".streak");a.Settings.getSettingTabs().on("click.streak",function(i){if(a.view==="settingsStreak"){var r;try{r=e.$(i.target).attr("href").split("/").last();e.$(i.target.parentElement).removeClass("f1").addClass("fZ")}catch(o){r=null;var s=t(i.target).find("a");if(s.attr("href")){r=e.$(s).attr("href").split("/").last();e.$(i.target).removeClass("f1").addClass("fZ")}else{throw o}}e.BentoBox.UI.setURL("settings/"+r)}n._streakMenuButton.removeClass("f1").addClass("fZ")});a.Settings.getSettingTabs().removeClass("fZ").addClass("f1");n._streakMenuButton.removeClass("f1").addClass("fZ");e.Gmail.Settings.getContentBodyBlock().hide();n._streakSettingsContainer.show()},_checkDesktopNotificationPermission:function(){if(typeof window.Notification!=="undefined"){var t=window.Notification.permission;if(t==="default"){window.Notification.requestPermission()}else if(t==="denied"){var n="https://support.google.com/chrome/answer/3220216?hl=en";if(e.isSafari){n="http://support.apple.com/kb/PH11949"}var i=o.Widgets.Modal.create({title:o.Locale.getString("enable_browser_notifications_title"),inner:o.Locale.getString("enable_browser_notifications_body"),showCancel:false,confirmText:o.Locale.getString("ok"),confirmFunc:function(){}});i.getEl().find(".inner a")[0].setAttribute("href",n);i.show()}}}};e.DependencyManager.addFunction({functionKey:"streakSettingsViewInitialized",functionReference:s.init,functionContext:s,dependentFunctionKeys:["gmailLoaded","localSettingsInitialized"]});e.DependencyManager.addFunction({functionKey:"streakAppSettingsViewInitialized",functionReference:s.initApp,functionContext:s,dependentFunctionKeys:["streakSettingsViewInitialized","data.streakSettings.initialized"]});o.Modules.StreakSettingsView=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=i.get("Operations.AjaxRequestOperation");var h=e.Class.subclass({className:"ThreadBreakerOperation",superclass:d,_memberVariables:[{name:"_subthreadGroupings",destroy:false},{name:"_threadId",destroy:false}],_initialize:function(e){e=n.pick(e||{},["threadId","subthreadGroupings"]);this._initializeData(e);var t={subthreadGroupings:this._subthreadGroupings};d.prototype._initialize.call(this,{url:"email/threads/"+this._threadId+"/split",method:"POST",params:{json:JSON.stringify(t)},tags:["threadBreaker"],dependentTags:[]})},_initializeData:function(e){this._threadId=e.threadId;this._subthreadGroupings=e.subthreadGroupings;var t=function(e){return e.messageIds&&e.messageIds.length>0};var i=n.every(this._subthreadGroupings,t);if(!i){throw new Error("All of the subthreadGroupings must contain at least one thread")}var r=n.chain(this._subthreadGroupings).pluck("messageIds").flatten().countBy().max().value()>1;if(r){throw new Error("Each message can only appear in one subthreadGrouping.")}},getError:function(){return new Error(this.getResponse().error)}});i.set("BentoBox.Modules.ThreadBreaker.ThreadBreakerOperation",h)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.HTML,s=e.Utils,l=e.BentoBox,u=e.UI;var c=u.Delegator;var d=e.Class.subclass({className:"ThreadBreakerController",superclass:c,memberVariables:[{name:"_activateButton",destroy:true},{name:"_cancelButton",destroy:true},{name:"_options",destroy:false},{name:"_isBreaking",destroy:false,defaultValue:false},{name:"_gmailEventKey",destroy:false}],_initialize:function(e){c.prototype._initialize.call(this);this._gmailEventKey=r.observe("viewChanged",this._viewChanged.bind(this));this._options=n.extend({},e)},destroy:function(){r.unobserve("viewChanged",this._gmailEventKey);this._cleanupPage();this._callDelegateFunction("disconnect");c.prototype.destroy.call(this)},_viewChanged:function(e){l.Tracker.track("threadbreaker.abandoned");this.destroy()},start:function(){l.Tracker.track("threadbreaker.start");this._setupPage().catch(function(e){l.logError("error with thread breaker start",e);l.ButterBarManager.showError(l.Locale.getString("error_unknown"),{messageKey:"threadbreaker"})})},activate:function(){var e=this;if(this._isBreaking){l.ButterBarManager.showError(l.Locale.getString("thread_breaker_already_running"),{messageKey:"threadbreaker"});return}this._isBreaking=true;l.Tracker.track("threadbreaker.activate",{numberOfMessagesToBreak:this._getSelectedMessages().length});this._doBreaking().then(function(t){if(t){l.Tracker.track("threadbreaker.activate.success",{numberOfMessagesToBreak:e._getSelectedMessages().length});e.destroy()}else{l.Tracker.track("threadbreaker.activate.aborted",{numberOfMessagesToBreak:e._getSelectedMessages().length});e._isBreaking=false}},function(t){e._isBreaking=false;l.logError("error breaking thread",t);l.Tracker.track("threadbreaker.activate.error",{numberOfMessagesToBreak:e._getSelectedMessages().length});l.ButterBarManager.showError(l.Locale.getString("thread_breaker_error_unknown"),{messageKey:"threadbreaker"})})},cancel:function(){l.Tracker.track("threadbreaker.cancel");this.destroy()},_setupPage:function(){var t=this;e.Gmail.getCurrentMainContainer().addClass("threadBreakerMain");this._addThreadBreakerHeading();return r.expandAllEmailsInThread().then(function(){return r.collapseAllEmailsInThread()}).then(function(){t._setupCheckboxes()})},_addThreadBreakerHeading:function(){var e=o.getElement("threadBreakerHeading");t(".if > .nH").first().after(e);this._activateButton=l.Widgets.Button.create({nameText:l.Locale.getString("thread_breaker_activate"),color:"blue",onFunc:this.activate.bind(this)});this._cancelButton=l.Widgets.LinkButton.create({text:l.Locale.getString("cancel"),clickFunction:this.cancel.bind(this)});e.find(".threadBreakerBreak").html(this._activateButton.getElement());e.find(".threadBreakerCancel").html(this._cancelButton.getElement());this._refreshStatus()},_setupCheckboxes:function(){var e=this;t(".Bk").each(function(){var i=t(this).parent();var a=[];i.find(".aju").each(function(){var n=r.widgets.getCheckbox().click(function(e){e.stopPropagation()}).change(function(t){var r=n.prop("checked");l.Tracker.track("threadbreaker.toggleMessage."+r);a.forEach(function(e){e.setChecked(r)});i.attr("data-threadbreaker-selected",r);e._refreshStatus()});a.push(n);var o=t("<div/>").addClass("threadBreakerCheckboxContainer").append(n).insertBefore(this)});var o=r.getMessageIdFromElement(i);if(n.contains(e._options.messageIDs,o)){a[0].setChecked(true).change()}})},_getSelectedMessages:function(){var e=[];t("[data-threadbreaker-selected=true]").each(function(){e.push(r.getMessageIdFromElement(this))});return e},_refreshStatus:function(){var e=this._getSelectedMessages().length;t(".threadBreakerStatus").text(l.Locale.getString("messages_selected",{number:e}))},_doBreaking:function(){var t=this;return new e.RSVP.Promise(function(n,a){var o=t._getSelectedMessages();if(o.length==0){l.ButterBarManager.showError(l.Locale.getString("no_messages_selected"),{messageKey:"threadbreaker"});n(false);return}var s=r.getActiveHexGmailThreadIdList(l.Services.Threads.HexGmailThreadIdExtractor)[0];if(!s){a(new Error("Could not determine open thread"));return}var u=i.getInstance("BentoBox.Modules.ThreadBreaker.ThreadBreakerSubjectPromptViewController",{defaultSubject:r.getConversationSubjectHeader().find("h2").text(),numberOfMessagesToBreak:o.length});u.showPromise().then(function(t){if(t==null){n(false);return}if(!t.trim().length){l.ButterBarManager.showError(l.Locale.getString("thread_breaker_need_new_subject"),{messageKey:"threadbreaker"});n(false);return}var i=new l.Modules.ThreadBreaker.ThreadBreakerOperation({threadId:s,subthreadGroupings:[{subject:t,messageIds:o}]});var u=e.Operations.OperationQueue.Singleton.addOperation(i);l.ButterBarManager.showSaving({message:l.Locale.getString("thread_breaker_running"),operationProgressId:u,messageKey:"threadbreaker"});var c=document.location.href;var d=function(e){if(e.operationHasErrors){if(e.operation&&e.operation.getError){var t=e.operation.getError();if(t&&t.message){l.ButterBarManager.showError(t.message,{messageKey:"threadbreaker"});n(false)}else{a(new Error("Unknown error with thread breaker operation"))}}else{a(new Error("Unknown error with thread breaker operation"))}}else{if(document.location.href==c){r.gotoCurrentThreadFolder()}setTimeout(r.triggerListRefresh.bind(r),600);n(true)}};e.NotificationCenter.subscribe({observer:{},filterParameters:{operationIsComplete:true,operationProgressId:u},unsubscribeImmediately:true,functionToCall:d})}).catch(a)})},_cleanupPage:function(){t(".threadBreakerCheckboxContainer, .threadBreakerHeading").remove();t("[data-threadbreaker-selected]").removeAttr("data-threadbreaker-selected");t(".threadBreakerMain").removeClass("threadBreakerMain")}});i.set("BentoBox.Modules.ThreadBreaker.ThreadBreakerController",d)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.HTML,s=e.Utils,l=e.BentoBox,u=e.UI;var c={_breaker:null,start:function(e){if(this._breaker){l.ButterBarManager.showError(l.Locale.getString("thread_breaker_already_running"),{messageKey:"threadbreaker"});return}this._breaker=new l.Modules.ThreadBreaker.ThreadBreakerController(e);this._breaker.addDelegate({disconnect:this._breakerDisconnect.bind(this,this._breaker)});this._breaker.start()},_breakerDisconnect:function(e){if(this._breaker===e){this._breaker=null}}};i.set("BentoBox.Modules.ThreadBreaker.ThreadBreakerMasterController",c)})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s={init:function(){o.Services.EmailOptionManager.registerButton({text:o.Locale.getString("split_this_from_thread"),extraCSSClasses:["threadBreakerMenuItem"],showFor:this._showFor.bind(this),fn:this._onclick.bind(this)})},_showFor:function(e){var n=t(".Bk:visible");return n.length>1},_onclick:function(e){o.Tracker.track("threadbreaker.start.emailMenu");o.Modules.ThreadBreaker.ThreadBreakerMasterController.start({messageIDs:[e]})}};e.DependencyManager.addFunction({functionKey:"threadBreakerEmailMenuOptionInitialized",functionReference:s.init,functionContext:s,dependentFunctionKeys:["enabledFeaturesControllerInitialized","emailOptionManagerInitialized","htmlLoaded"]})})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s={init:function(){i.get("BentoBox.Services.MoreMenuManager").registerButton({text:o.Locale.getString("split_thread"),orderHint:1,extraCSSClasses:["threadBreakerMenuItem"],showFor:this._showFor.bind(this),enableFor:this._enableFor.bind(this),fn:this._onclick.bind(this)})},_showFor:function(e){if(r.isPreviewPaneConversation()){var n=t(".Bk:visible");return n.length>0}return e=="conversation"},_enableFor:function(e){var n=t(".Bk:visible");return n.length>1},_onclick:function(){o.Tracker.track("threadbreaker.start.moreMenu");o.Modules.ThreadBreaker.ThreadBreakerMasterController.start()}};e.DependencyManager.addFunction({functionKey:"threadBreakerMoreMenuOptionInitialized",functionReference:s.init,functionContext:s,dependentFunctionKeys:["enabledFeaturesControllerInitialized","moreMenuManagerInitialized","htmlLoaded"]})})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=s.View;var h=e.Class.subclass({className:"ThreadBreakerSubjectPromptView",superclass:d,_memberVariables:[{name:"_subjectElement",destroy:true},{name:"_subjectTextbox",destroy:true}],_initialize:function(e){e=e||{};d.prototype._initialize.call(this);this._subjectElement=this._element.find(".streak__textbox")},setTextbox:function(e){this._subjectTextbox=e;this._subjectElement.html(e.getElement())},setSubject:function(e){this._subjectTextbox.setText(e)},focus:function(){this._subjectElement.focus()},_setupElement:function(){this._element=t(o.getElement("threadBreakerSubjectPrompt"))}});i.set("BentoBox.Modules.ThreadBreaker.ThreadBreakerSubjectPromptView",h)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.jwerty,d=e.BentoBox;var h=s.ViewController;var f=e.Class.subclass({className:"ThreadBreakerSubjectPromptViewController",superclass:h,_memberVariables:[{name:"_modal",destroy:true},{name:"_subject",destroy:true},{name:"_subjectTextbox",destroy:true},{name:"_defaultSubject",destroy:true},{name:"_okButton",destroy:false}],_initialize:function(e){e=e||{};h.prototype._initialize.call(this);this._defaultSubject="";if(typeof e.defaultSubject!=="undefined"){this._defaultSubject=e.defaultSubject}this._setupTextbox();if(this._defaultSubject){this._view.setSubject(this._defaultSubject);this._subject=this._defaultSubject}},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.ThreadBreaker.ThreadBreakerSubjectPromptView")},subjectChange:function(e){this._subject=e;this._updateEnabled()},enterPressed:function(){this._modal.confirm()},_setupTextbox:function(){var e=this;if(!this._subjectTextbox){this._subjectTextbox=i.getInstance("BentoBox.Widgets.GmailTextareaViewController",{plainTextOnly:true,multiline:false});this._subjectTextbox.addDelegate({input:function(){e.subjectChange(e._subjectTextbox.getText())},keydown:function(t){if(c.is("enter",t)){t.preventDefault();e.enterPressed()}}})}this._view.setTextbox(this._subjectTextbox.getView())},_updateEnabled:function(){if(!this._okButton)return;if(this._confirmShouldBeEnabled()){this._okButton.enable()}else{this._okButton.disable()}},_confirmShouldBeEnabled:function(){return this._subject},showPromise:function(){var t=this;return new e.RSVP.Promise(function(e,n){t._modal=d.Widgets.Modal.create({title:d.Locale.getString("thread_breaker_enter_new_subject"),confirmText:d.Locale.getString("ok"),cancelFunc:function(){d.Tracker.track("threadbreaker.subject.cancel");e(null)},confirmFunc:function(){d.Tracker.track("threadbreaker.subject.confirm");e(t._subject)},inner:t.getView().getElement()});t._modal.show();t._okButton=t._modal.getOkButton();t._updateEnabled();setTimeout(t._subjectTextbox.focus.bind(t._subjectTextbox),100)})}});i.set("BentoBox.Modules.ThreadBreaker.ThreadBreakerSubjectPromptViewController",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.Library,o=e.APIRequester,s=e.HTML,l=e.RSVP,u=e.Eventer,c=e.BentoBox;var d=u.create({el:null,elements:{},templates:{},halted:false,rightLinksEmpty:false,loggedOut:true,_isMessage:false,trackingContext:{widgetContext:"topNav"},PAYWALL_ICON:{ACCOUNT:1,UPGRADE:2,NONE:3},_noBlackBarGmailMenuOpenClass:null,init:function(){this.el=s.getElement("topNavNoBlackBarLink");this.templates.loadingOauth=s.get("loadingOauth");this._appendToNoBlackBar();this._getNoBlackBarGmailMenuOpenClass();this.el.find(".bbClientVersion").html("client Version: "+e.clientVersion);this.el.find(".bbExtVersion").html("ext Version: "+e.extVersion);this.parse();this.initFunctionality();this.trigger("ready")},_appendToNoBlackBar:function(){r.getGooglePlusNameContainer().prepend(this.el);if(this.el.parent().is(".gb_yb")){this.el.parent().addClass("streak__topNav_margin2")}if(this.el.parent().is(".gb_zc.gb_Pc.gb_f")){this.el.parent().addClass("notGooglePlus")}},_getNoBlackBarGmailMenuOpenClass:function(){this._noBlackBarGmailMenuOpenClass="streak__topNav_menuOpen"},parse:function(){this.elements.mainLink=t(this.el[0]);this.elements.mainLink.span=this.elements.mainLink.find("span");this.elements.mainLink.exclamation=this.elements.mainLink.find("#bentoBoxNotLoggedIn");this.elements.mainLink.loading=this.elements.mainLink.find("#bentoBoxLoggingIn");this.elements.mainLink.icon=this.elements.mainLink.find("#bentoBoxLoggedIn");this.elements.menu=this.el.find("#workflowMenu");this.elements.menu.statusText=this.elements.menu.find("#streak__topNav_statusText");this.elements.menu.refreshButton=this.elements.menu.find("#streak__topNav_refresh a");this.elements.menu.signInButton=this.elements.menu.find("#streak__topNav_signIn a")},initFunctionality:function(){this.setupMenuToggling();this.setupSignInButton();this.setupRefreshButton();this.setupHelpButton();this.setupShareButton();this.setupReleaseNotesButton();this.setupLanguageButton();this.setupDeveloperZoneLink();this.resizeSearch();var t=this;c.bind("logged_out",function(){t.halted=false;t.initLoggedOut()});e.NotificationCenter.subscribe({eventName:"reauthorized",functionToCall:this.showAuthorized,observer:this})},initNoCRM:function(){this.showLoaded()},showLoaded:function(){this.elements.mainLink.exclamation.hide();this.elements.mainLink.loading.hide();this.elements.mainLink.icon.show()},showAuthorized:function(){this.showLoaded();this.elements.menu.find(".developerZone").show();this.showMainMenuItems()},setupMenuToggling:function(){var e=this;e.elements.menu.on("click",function(e){e.stopPropagation()});e.elements.mainLink.click(function(n){if(e.isMenuOpen()){e.closeMenu()}else{e.track("TopNavOpened");e.openMenu()}if(!t(n.target).is("a[target]")){n.preventDefault()}}).bodyCloseAndStop({closeFunction:function(){e.closeMenu()},stop:e.elements.mainLink[0],body:r.elements.body,useCapture:true})},setupSignInButton:function(){var e=this;e.elements.menu.signInButton.click(function(t){e.closeMenu();e.startOauth();t.stopPropagation()})},setupRefreshButton:function(){this.elements.menu.refreshButton.click(function(e){location.reload()})},setupHelpButton:function(){var e=this;this.elements.menu.find("#streak__topNav_menuItems_help").trackable("show help clicked",this.trackingContext).click(function(t){c.Modules.Help.HelpLoader.getHelpViewController().show(true);e.closeMenu()})},setupShareButton:function(){var e=this;e.elements.menu.find("#streak__topNav_menuItems_share").trackable("promoteLinkClicked",e.trackingContext).click(function(t){e.closeMenu();c.Modules.Promote.render(true);t.preventDefault();t.stopPropagation()})},setupReleaseNotesButton:function(){var e=this;this.elements.menu.find("#streak__topNav_menuItems_updates").trackable("releaseNotesClicked",e.trackingContext).click(function(t){e.closeMenu();window.open("http://blog.streak.com/search/release%20notes/")})},setupUpgradeButton:function(){var e=this;this.elements.menu.find("#streak__topNav_menuItems_upgrade").trackable("upgrade topnav clicked",this.trackingContext).click(function(){r.inboxSDK.Router.goto("upgrade");e.closeMenu()})},setupAccountButton:function(){var e=this;this.elements.menu.find("#streak__topNav_menuItems_account").trackable("account topnav clicked",this.trackingContext).click(function(){r.inboxSDK.Router.goto("account");e.closeMenu()})},setupLanguageButton:function(){var e=this;if(c.Locale.getGmail()==="en"){e.elements.menu.find(".languageChoice").hide()}else{var t="";var n=c.Locale.getCurrent();var i=c.Locale.getGmail();if(n==="en"){t=c.Locale.convertLocaleCodeToName(i)}else{t=c.Locale.convertLocaleCodeToName("en")}t=c.Locale.getString("top_nav_switch_language",{language:t});e.elements.menu.find(".languageChoice").show();e.elements.menu.find(".languageChoice")[0].innerHTML=t;e.elements.menu.find(".languageChoice").trackable("languageChoiceChanged",e.trackingContext).click(function(e){if(n==="en"){c.Locale.setCurrent(i)}else{c.Locale.setCurrent("en")}e.preventDefault();e.stopPropagation();location.reload()})}},setupDeveloperZoneLink:function(){this.elements.menu.find(".developerZone a").trackable("developerZoneLinkClicked",this.trackingContext).click(function(e){e.preventDefault();c.Modules.DeveloperZone.show()})},initSettingsLink:function(){var e=this;this.elements.menu.find(".settingsShortcut a").trackable("navSettingsShortcutClicked",this.trackingContext).click(function(t){t.preventDefault();c.UI.setURL("settingsStreak");e.closeMenu()}).parent().show()},resizeSearch:function(){var e=this;if(!c.Services.RapportiveStatusController.isEnabled()){t(window).resize(e.setIdealSearchWidth);e.setIdealSearchWidth()}},initLoggedOut:function(){if(this.halted||this.rightLinksEmpty){return}this.loggedOut=true;this.showExclamation();this.showLoggedOut()},initLoggedIn:function(){if(this.halted){return}this.loggedOut=false;this._isMessage=false;this.showAuthorized()},initExperimentsLoaded:function(){this.setupUpgradeButton();this.setupAccountButton();this.setupInitialUpgradeOrAccount();c.Data.getParticipatingPlans().watch("collectionChange",this._setTopNavIconToShow,this);c.Data.getBillingPlanInstances().watch("collectionChange",this._setTopNavIconToShow,this);c.Data.getParticipatingPlans().refresh();c.Data.getBillingPlanInstances().refresh()},setupInitialUpgradeOrAccount:function(){var e=a.get("BentoBox.Modules.Paywall.PaywallModelInstance");var t=d.PAYWALL_ICON.NONE;if(e){t=e.topNavIconToShow()}this._setTopNavIconToShow(t)},gotLoggedOut:function(){this.showExclamation();this.showLoggedOut();this.openMenu()},setIdealSearchWidth:function(){var e=r.$("#gbu").width()+150;var t=r.$("#gbqfw").width();var n=t-e;var i=150;var a=Math.max(i,n);r.$("#gbqf").width(a)},destroy:function(){if(this.el){this.el.remove()}},haltExecution:function(){this.halted=true},showExclamation:function(){this.elements.mainLink.exclamation.css({display:"inline-block"});this.elements.mainLink.loading.hide();this.elements.mainLink.icon.hide()},isMenuOpen:function(){return this.elements.menu.is(":FastVisible(noCompute)")},openMenu:function(){this.elements.menu.show();this.elements.mainLink.addClass(this._noBlackBarGmailMenuOpenClass)},closeMenu:function(){this.elements.menu.hide();this.elements.mainLink.removeClass("gbto "+this._noBlackBarGmailMenuOpenClass)},showLoading:function(){this.elements.mainLink.exclamation.hide();this.elements.mainLink.loading.show()},startOauth:function(){var e=this;e.closeMenu();c.Modules.SigninPrompt.openOauth()},versionCheck:function(){o.get("versions/suggested").getPromise().then(function(t){if(this.isVersionLarger(t.suggestedExtVersion,e.extVersion)){this.showExtensionUpdateAvailable()}else if(this.isVersionLarger(t.suggestedClientVersion,e.clientVersion)){this.showClientUpdateAvailable()}}.bind(this))},isVersionLarger:function(e,t){var n=e.split(".");var i=t.split(".");var r=false;for(var a=0;a<n.length;a++){if(a>=i.length){r=true;break}var o=parseInt(n[a],10);var s=parseInt(i[a],10);if(o>s){r=true;break}else if(o<s){break}}return r},showMainMenuItems:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_menuItems");this.setStatusClass("ok");this.setStatusHTML(c.Locale.getString("top_nav_signed_in"))},showExtensionUpdateAvailable:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_extension");this.setStatusClass("warning");this.setStatusHTML(c.Locale.getString("top_nav_client_update_available"));this.addExtensionUpdateHelpTour();this.el.find("#bentoBoxNewUpdate").show()},showExtensionUpdateNeeded:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_extension");this.setStatusClass("error");this.setStatusHTML(c.Locale.getString("top_nav_client_update_needed"));this.addExtensionUpdateHelpTour();this.el.find("#bentoBoxNewUpdate").show()},addExtensionUpdateHelpTour:function(){var e=this.elements.menu.find("#streak__topNav_extension a");e[0].setAttribute("href","streakhelp://Streak tells me I need to update the extension, what do I do?")},showClientUpdateAvailable:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_refresh");this.setStatusClass("warning");this.setStatusHTML(c.Locale.getString("top_nav_client_update_available"));this.el.find("#bentoBoxNewUpdate").show()},showClientUpdateNeeded:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_refresh");this.setStatusClass("error");this.setStatusHTML(c.Locale.getString("top_nav_client_update_needed"));this.el.find("#bentoBoxNewUpdate").show()},showLoggedOut:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_signIn");this.setStatusClass("error");this.setStatusHTML(c.Locale.getString("top_nav_signed_out"))},showThirdPartyCookiesDisabled:function(){this.hideOtherMenuSectionsAndShow("#streak__topNav_thirdParty");if(e.isSafari){t("#streak__topNav_thirdParty a")[0].setAttribute("href","streakhelp://Streak says I have 3rd party cookies disabled, now what safari?")}this.setStatusClass("error");this.setStatusHTML("Third party cookies disabled");this.showExclamation();this.openMenu()},hideOtherMenuSectionsAndShow:function(e){this.elements.menu.find("#workflowMenuDefaultInner > div").hide();this.elements.menu.find(e).show()},setStatusClass:function(e){this.el[0].setAttribute("class","streak__topNav_status_"+e)},setStatusHTML:function(e){this.elements.menu.statusText.html(e)},_setTopNavIconToShow:function(){var e=this._getBillingIconToShow();if(e===d.PAYWALL_ICON.ACCOUNT){this.showAccountMenuItem();this.hideUpgradeMenuItem()}else if(e===d.PAYWALL_ICON.UPGRADE){this.hideAccountMenuItem();this.showUpgradeMenuItem()}else if(e===d.PAYWALL_ICON.NONE){this.hideAccountMenuItem();this.hideUpgradeMenuItem()}else{throw new Error("Invalid icon choice in topNav:_setTopNavIconToShow")}},_getBillingIconToShow:function(){var e=n.filter(c.Data.getBillingPlanInstances(),function(e){return e.isActive()});var t=c.Data.getParticipatingPlans().length>0||e.length>0;if(t){return c.Modules.TopNav.PAYWALL_ICON.ACCOUNT}else{return c.Modules.TopNav.PAYWALL_ICON.UPGRADE}},showAccountMenuItem:function(){this.elements.menu.find("#streak__topNav_menuItems_account").show()},hideAccountMenuItem:function(){this.elements.menu.find("#streak__topNav_menuItems_account").hide()},showUpgradeMenuItem:function(){this.elements.menu.find("#streak__topNav_menuItems_upgrade").show()},hideUpgradeMenuItem:function(){this.elements.menu.find("#streak__topNav_menuItems_upgrade").hide()},track:function(e){c.Tracker.trackStreakActive(this.trackingContext,{eventName:e})}});e.DependencyManager.addFunction({functionKey:"topNavInitialized",functionReference:d.init,functionContext:d,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded"]});e.DependencyManager.addFunction({functionKey:"topNav.initLoggedOut",functionReference:d.initLoggedOut,functionContext:d,dependentFunctionKeys:["topNavInitialized","gmailLoaded","htmlLoaded","localeLoaded","userLoggedOut"]});e.DependencyManager.addFunction({functionKey:"topNav.initLoggedIn",functionReference:d.initLoggedIn,functionContext:d,dependentFunctionKeys:["topNavInitialized","gmailLoaded","htmlLoaded","userLoggedIn"]});e.DependencyManager.addFunction({functionKey:"topNav.initNoCRM",functionReference:d.initNoCRM,functionContext:d,dependentFunctionKeys:["topNavInitialized","noCRM"]});
e.DependencyManager.addFunction({functionKey:"topNav.initSettingsLink",functionReference:d.initSettingsLink,functionContext:d,dependentFunctionKeys:["topNavInitialized","streakSettingsViewInitialized"]});e.DependencyManager.addFunction({functionKey:"topNav.experimentsLoaded",functionReference:d.initExperimentsLoaded,functionContext:d,dependentFunctionKeys:["enabledFeaturesControllerInitialized","topNav.initLoggedIn"]});c.Modules.TopNav=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.APIRequester,s=e.BentoBox;var l={widgetContext:"topNav/developerZone"};var u=function(e,t){s.Tracker.trackStreakActive(l,t,{eventName:e})};var c={initialized:false,show:function(){if(!this.apiModal){this.APIKeys=s.Models.APIKey.createCollection();this.apiModal=s.Widgets.Modal.create({title:s.Locale.getString("streak_developer_resources"),inner:a.get("apiModal",true),showCancel:false,persist:false,width:"475px",trackingContext:{widgetContext:"topNav/developerZone"}});this.addModalFunctionality()}this.apiModal.show();this.showLoading();this.reset()},showLoading:function(){this.apiModal.getEl().find(".loadingKeys").show();this.apiModal.getEl().find(".apiInfo").hide()},hideLoading:function(){this.apiModal.getEl().find(".loadingKeys").hide();this.apiModal.getEl().find(".apiInfo").show()},reset:function(){var e=this;this.APIKeys.refresh(function(){e.renderAPIKeys()})},addModalFunctionality:function(){var e=this.apiModal.getEl();e.find(".createOne").on("click.developerZone",function(){u("createAPIKeyClicked");this.createKey()}.bind(this));e.find("#apiDocsLink a").on("click.developerZone",function(e){u("apiDocsLinkClicked")}).addClass("action").attr("href","//www.streak.com/api").attr("target","_blank")},renderAPIKeys:function(){if(this.APIKeys&&this.APIKeys.length>0){this.apiModal.getEl().find(".createOne").hide();var e=this.apiModal.getEl().find("#apiKeyList");e.empty();for(var t=0;t<this.APIKeys.length;t++){e.append(this.renderAPIKey(this.APIKeys[t]))}e.show()}else{this.apiModal.getEl().find("#apiKeyList").hide();this.apiModal.getEl().find(".createOne").show()}this.hideLoading()},renderAPIKey:function(n){var o=a.get("apiRow");var l=i.create(n.get("creationTimestamp"));var c=t(o({apiKey:n.get("apiKey"),creationTimeLong:l.customFormat("longWithTimezone"),issued:s.Locale.getString("api_key_issued",{time:l.customFormat("shortDate")})}));c.addClass("apiKey");var d=c.find(".bbHighlight");d.selectAllOnClick();var h=t(e.createEl("div"));h.addClass("bbAction");h.append(r.widgets.getDeleteIcon());h.append(e.createEl("span",s.Locale.getString("delete")));h.click(function(e){u("deleteAPIKey");this.deleteKey(n)}.bind(this));c.find(".streak__apiKey_delete").append(h);return c},deleteKey:function(e){var t=this;s.Widgets.Modal.confirmDelete("API Key",function(){e.del();t.renderAPIKeys()}.bind(this),s.Locale.getString("api_key_delete_extra"))},createKey:function(){this.showLoading();var e=s.Models.APIKey.create({});var t=this;e.save(function(){t.APIKeys.add(e);t.renderAPIKeys()},function(){s.ButterBarManager.showError("Generating API key failed",{time:5e3})})}};s.Modules.DeveloperZone=c})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.StateMachine,o=e.BentoBox;var s={COLORS_OLD:["#AC725E","#D06B64","#F83A22","#FA573C","#FF7537","#FFAD46","#FAD165","#FBE983","#B3DC6C","#7BD148","#16A765","#42D692","#92E1C0","#9FE1E7","#9FC6E7","#4986E7"],COLORS:["#FA573C","#FFAD46","#B3DC6C","#16A765","#9FC6E7","#4986E7","#7BD148","#F83A22","#AC725E","#92E1C0","#42D692","#D06B64","#FAD165","#FF7537","#9FE1E7"],templates:{},defaults:{groupJumper:null},widgetTrackingContext:{widget:"Groupbar"},dnd:{dragThreshold:4,sm:null,proxy:null,drag:null,mouseOffset:{x:0,y:0},mousePosition:{x:0,y:0},bar:null,groups:[],widthMap:[]},init:function(e){var t=this;this.templates={};this.templates.group=r.get("groupbarGroup");this.templates.groupbar=r.get("groupbar");this.templates.add=r.get("groupbarAdd");this.setupDragAndDrop();if(e){e()}},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)},setupDragAndDrop:function(){this.setupDragProxy();this.setupStateMachine();this.setupEventBindings()},setupDragProxy:function(){var e=this;e.dnd.proxy=t(e.templates.group({number:0,width:0,name:"&nbsp;"}));e.dnd.proxy.addClass("proxy");e.dnd.proxy.css({color:"transparent",backgroundColor:"#eee",borderColor:"#eee",height:"81px",verticalAlign:"top"})},setupStateMachine:function(){var e=this;e.dnd.sm=new a.create({initial:"start",events:[{name:"mousedown",from:["start"],to:"possibleDrag"},{name:"mouseup",from:["possibleDrag","start"],to:"start"},{name:"dragStart",from:["possibleDrag"],to:"drag"},{name:"mouseup",from:["drag"],to:"drop"},{name:"reset",from:["possibleDrag","drag","drop","start"],to:"start"}],callbacks:{onstart:function(t,n,r){if(n==="drag"&&e.dnd.bar){e.dnd.bar.render()}e.dnd.drag=null;e.dnd.bar=null;e.dnd.widthMap=[];e.dnd.proxy.detach();i.elements.body.css({"-webkit-user-select":""})},ondrag:function(t,n,r){e.dnd.drag.trigger("bbDragStart");i.elements.body.css({"-webkit-user-select":"none"});i.elements.body[0].style.cursor="url(https://mail.google.com/mail/u/0/images/2/closedhand.cur), default !important";var a=e.dnd.drag.width()+3;e.dnd.drag[0].style.width=a+"px";e.dnd.drag[0].style.zIndex=100;e.dnd.proxy.css({maxWidth:a,minWidth:a});e.dnd.proxy.data("group",e.dnd.drag.data("group"));e.dnd.drag[0].style.display="none";e.dnd.drag.before(e.dnd.proxy);var o=e.dnd.drag.offset().left;e.dnd.drag[0].style.position="fixed";e.dnd.drag.offset({left:o});e.dnd.drag[0].style.display="inline-block"},ondrop:function(t,n,i){e.dnd.bar.reorder(e.dnd.groups);o.Tracker.trackStreakActive({eventName:"StageReorder"},e.widgetTrackingContext)}}})},setupEventBindings:function(){var e=this;i.elements.body.mousemove(function(t){if(e.dnd.sm.is("possibleDrag")){var n=Math.abs(t.clientX-e.dnd.mousePosition.x)+Math.abs(t.clientY-e.dnd.mousePosition.y);if(document.activeElement.type!=="text"&&n>e.dnd.dragThreshold){e.dnd.sm.dragStart()}}else if(e.dnd.sm.is("drag")&&e.dnd.drag){e.renderDrag(t.clientX)}});i.elements.body.mouseup(function(e){s.dnd.sm.mouseup()});o.Keyboard.bindChord("escape",function(t){e.dnd.sm.reset()})},setupWidthMap:function(){var e=this;var n=e.dnd.bar.el.children().children(".groupBarGroup");e.dnd.widthMap=[];for(var i=0;i<n.length;i++){var r=t(n[i]);if(r.hasClass("dragged")){continue}var a=r.offset();var o=r.width();e.dnd.widthMap.push({left:a.left,right:a.left+o,el:r})}},renderDrag:function(e){this.setupWidthMap();this.dnd.groups=[];var t=this.dnd.widthMap[0];var i=0;var r=0;for(var a=0;a<this.dnd.widthMap.length;a++){var o=this.dnd.widthMap[a];this.dnd.groups.push(o.el.data("group"));if(o.left<=e){i=a;t=o}if(o.el.hasClass("proxy")){r=a}}if(this.dnd.dragGroup!==t.el.data("group")){if(t&&!t.el.hasClass("proxy")){if(i<r){t.el.before(this.dnd.proxy)}else if(i===r){}else{t.el.after(this.dnd.proxy)}}}this.dnd.dragGroup=t.el.data("group");var s=this.dnd.widthMap[0].left;var l=n.last(this.dnd.widthMap).right-this.dnd.drag.width();var u=Math.min(l,e-this.dnd.mouseOffset.x);u=Math.max(s,u);this.dnd.drag.offset({left:u+3})}};s.impl=function(r){var a={};var l=r,u=l.pipeline,c=l.pipelineSpreadsheetViewController,d=c.getTransformedData(),h=t(s.templates.groupbar()),f=h.find("ul"),p=t(s.templates.add()),m=false,_=[];var g=false;l.trackingContext.widgetContext+="/groupBar";var v=function(e){s.dnd.sm.reset();g=false;if(p.find("input").isVisible()&&!p.find("input").prop("disabled")){g=true;return}p.detach();f.empty();f.detach();_=e||d.groups;t.each(_,function(e,t){var n=d.lists[t]&&d.lists[t].list?d.lists[t].list.length:0;var i=y(t,d.lists[t].displayNameHTML(),n,e);f.append(i)});if(d.groupMeta.canEdit){h.addClass("streak__groupBar_editable")}else{h.removeClass("streak__groupBar_editable")}if(d.groupMeta.isStage){h.addClass("streak__groupBar_arrows")}else{h.removeClass("streak__groupBar_arrows")}h.append(f);b()},y=function(e,r,h,f,p){var g=t(s.templates.group({number:h,name:r}));g.data("group",e);var v=d.lists[e].color;g.css({backgroundColor:v.backgroundColor,color:v.textColor,border:"none 0 "+v.backgroundColor});g[0].style["-webkit-box-flex"]=Math.log(Math.max(h,2));g.find("a").click(function(e){e.preventDefault();if(l.groupJumper&&l.groupJumper.jumpToGroup){l.groupJumper.jumpToGroup(g.data("group"))}});if(d.groupMeta.canEdit){var y=o.Widgets.Menu.create({css:{position:"fixed"},trackingContext:n.clone(l.trackingContext)});g[0].onselectstart=function(e){e.preventDefault();return false};g.easyHoverClass("hover");var w,b;g.bind({mousedown:function(e){if(m){return}s.dnd.sm.mousedown();s.dnd.drag=g;s.dnd.bar=a;s.dnd.mouseOffset={x:e.offsetX,y:e.offsetY};s.dnd.mousePosition={x:e.clientX,y:e.clientY}},mouseup:function(e){},bbDragStart:function(e){g[0].title="";g.addClass("dragged")},bbDragEnd:function(t){g[0].title=e;g.removeClass("dragged")}});var C=u.getStage(e);var S=g.find("input");y.addItem(o.Locale.getString("groupbar_rename_stage"),function(){o.Tracker.trackStreakActive({eventName:"StageRenameStart"},s.widgetTrackingContext,l.trackingContext);g.find("a").hide();S.val(C.displayName());S.show();S.focus()});var T=function(){o.Tracker.trackStreakActive({eventName:"StageRenameAttempt"},s.widgetTrackingContext,l.trackingContext);var t=S.val().trim();if(t.length===0){o.Tracker.trackStreakActive({eventName:"EmptyStageRename"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("empty_stage_name"),{time:5e3});return}var n=u.getStageByName(t);if(n&&n.key()===e){o.Tracker.trackStreakActive({eventName:"StageRenameSame"},s.widgetTrackingContext,l.trackingContext);S.hide();g.find("a").show();return}if(u.getStageNamesText().indexOf(t)>-1){o.Tracker.trackStreakActive({eventName:"AddStageFailed",reason:"duplicate stage name",userFailure:"true"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("same_stage_name"),{time:5e3});return}o.Tracker.trackStreakActive({eventName:"StageRename"},s.widgetTrackingContext,l.trackingContext);S.hide();g.find("a").show();C.set("name",t);C.save()};o.Keyboard.bindChordToElement(S,"enter",function(){T()},true,true);S.blur(function(){T()});if(C){C.watch("set",function(){g.find(".name").text(C.displayName())},a,"name")}y.addItem(o.Locale.getString("groupbar_delete_stage"),function(){o.Tracker.trackStreakActive({eventName:"DeleteStageAttempt"},s.widgetTrackingContext,l.trackingContext);if(_&&_.length>0){if(_.length===1){o.Tracker.trackStreakActive({eventName:"DeleteStageFailedOneStage",userFailure:"true"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("one_stage"),{time:5e3});return}var e=false;var t=o.Data.getPipelineBoxes(u.key());for(var n=0;n<t.length;n++){if(t[n].get("stageKey")===C.key()){e=true;break}}if(e){o.Tracker.trackStreakActive({eventName:"DeleteStageFailedBecauseBoxes",userFailure:"true"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("stage_empty"),{time:5e3});return}o.Widgets.Modal.confirmDelete(C.displayName(),function(){o.Tracker.trackStreakActive({eventName:"DeleteStage"},s.widgetTrackingContext,l.trackingContext);C.del();c.runDataTransforms()},null,function(){o.Tracker.trackStreakActive({eventName:"DeleteStageCancel"},s.widgetTrackingContext,l.trackingContext)})}});y.addSeparator();var x=o.Widgets.ColorPicker.create({label:o.Locale.getString("groupbar_change_color"),previewText:r,colorChosenFunc:function(t){d.lists[e].changeColor(t);g[0].style.backgroundColor=t.backgroundColor;g[0].style.color=t.textColor;d.lists[e].color=t;c.redraw();o.Tracker.trackStreakActive({eventName:"GroupColorChanged"},s.widgetTrackingContext,l.trackingContext)},color:v,trackingContext:l.trackingContext});y.addSection(x.el);var k=o.Widgets.ButtonMenu.create({customButton:i.widgets.getSettingsIcon(),menu:y.el,fixedPosition:true,rightAligned:f===0?false:true,css:{overflow:"visible"},onFunc:function(e){x.showMenu()}});g.find(".settings").append(k.el)}return g},w=function(e){var t=0;for(t=0;t<e.length;t++){if(_!==e[t]){break}}if(t===e.length){v();return}u.setStageOrder(e);u.save();c.runDataTransforms()},b=function(){if(d.groupMeta.canEdit){C();f.append(p)}},C=function(){p.find("a").show();p.find("input").hide();p.removeClass("inputOpen");p.css({backgroundColor:"whiteSmoke"})};var S=function(e){o.Tracker.trackStreakActive({eventName:"AddStageAttempted"},s.widgetTrackingContext,l.trackingContext);p.name=p.find("input").val().trim();if(!p.name||p.name.trim().length===0){o.Tracker.trackStreakActive({eventName:"AddStageFailed",reason:"noText",userFailure:"true"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("empty_stage_name"),{time:5e3});return}if(u.getStageNamesText().indexOf(p.name)>-1){o.Tracker.trackStreakActive({eventName:"AddStageFailed",reason:"duplicate stage name",userFailure:"true"},s.widgetTrackingContext,l.trackingContext);o.ButterBarManager.showError(o.Locale.getString("same_stage_name"),{time:5e3});return}o.Tracker.trackStreakActive({eventName:"AddStage"},s.widgetTrackingContext,l.trackingContext);p.find("input").prop("disabled",true);m=true;u.addStage(p.name,function(){m=false;p.find("input").prop("disabled",false);C();c.runDataTransforms()});if(e){e.preventDefault();e.stopPropagation()}if(g){v()}};p.click(function(e){if(m){return}p.addClass("inputOpen");p.find("a").hide();p.find("input").show().focus().val("");p.color=d.groupMeta.nextColor;p.css({backgroundColor:p.color});e.preventDefault();o.Tracker.trackStreakActive({eventName:"AddStageStarted"},s.widgetTrackingContext,l.trackingContext)});o.Keyboard.bindChordToElement(p.find("input"),"enter",function(e){S(e)},true,true);o.Keyboard.bindChordToElement(p.find("input"),"escape",function(e){C()},true,true);p.find("input").blur(function(e){if(m){return}var t=p.find("input").val().trim();if(!t){C();if(g){v()}return}S()});a.newBoxAdded=v;a.transformedDataChanged=v;a.el=h;a.render=v;a.reorder=w;a.getElement=function(){return h};a.destroy=function(){f.remove();e.NotificationCenter.unsubscribe({observer:a})};return a};e.DependencyManager.addFunction({functionKey:"pipelineView.groupBarInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["keyboardInitialized","htmlLoaded","localeLoaded"]});o.Modules.PipelineView.GroupBar=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{pipeline:null,color:"blue",isButton:true,isDark:false,iconAfter:false},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};var s;var l=function(e,t){a.Tracker.trackStreakActive(s,t,{eventName:e})};o.impl=function(n){var i={};var r=n;r.trackingContext.widgetContext+="/fullScreenSpreadsheetButton";s=r.trackingContext;i.pipeline=r.pipeline;i._inFullMode=false;i.options=r;i._button;var o={hasButtonToLeft:true,isToggle:false,tooltip:a.Locale.getString("fullscreen_button_text"),iconClassName:"bbFullscreenIcon",onFunc:function(n){i._button.toggleRoundLeft();var a=t(".inboxsdk__custom_view_element");if(i._inFullMode){l("exitFullScreen");a.removeClass("holderFullScreen");t(".inboxsdk__custom_view").append(a);i._inFullMode=false;i._button.changeIconByClass("bbFullscreenExitIcon","bbFullscreenIcon")}else{l("enterFullScreen");a.addClass("holderFullScreen");e.Gmail.elements.body.append(a);i._inFullMode=true;i._button.changeIconByClass("bbFullscreenIcon","bbFullscreenExitIcon")}r.pipelineSpreadsheetViewController.redraw()}};var u=a.Widgets.Button.create(o);if(r.iconAfter){var c=u.el.find("span").detach();u.el.prepend(c)}i._button=u;return{button:u,destroy:function(){try{i._exitFullMode(true)}catch(e){}}}};a.Modules.PipelineView.FullScreenSpreadsheetButton=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.APIRequester,o=e.BentoBox;var s={defaults:{pipeline:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};var l;var u=function(e,t){o.Tracker.trackStreakActive(l,t,{eventName:e})};s.impl=function(r){var h=r;var f=h.pipeline;var p=h.pipelineSpreadsheetViewController;var m=null;var _=o.Widgets.Menu.create();h.trackingContext.widgetContext+="/moreButton";l=h.trackingContext;var g=_.addItem(o.Locale.getString("mail_merge_start"),function(e){u("mm_mailMergeButtonPipelineClicked");o.Modules.MailMergeMasterController.startMailMergeFromPipelineView(f,p.getCheckedBoxes())});g.addClass("mailMergePipelineButton");_.addSeparator();var v=_.addItem(o.Locale.getString("import_csv"),function(e){u("importCSV");if(m){m.destroy()}m=new s.PipelineCSVImportViewController;m.setPipeline(f);m.setDoneCallback(function(){o.ButterBarManager.showMessage(o.Locale.getString("import_complete"),{messageKey:"importComplete"});o.Data.getPipelineBoxes(f.key()).refresh(function(){o.ButterBarManager.hideMessage("importComplete");if(m){m.destroy()}m=null;p.runDataTransforms()})});m.start()});var y=_.addItem(o.Locale.getString("export_to_csv"),function(n){u("exportToCSV");S.getElement().trigger("export");if(!e.FileStore.isEnabled()){o.ButterBarManager.showError("Unfortunately export does not work in Safari. You must use Chrome to export",{time:1e4});return}o.ButterBarManager.showMessage(o.Locale.getString("creating_csv"),{messageKey:"createExport"});var r="";var a=p.getPipelineTableModel();for(var s=0;s<a.getNumberOfRowsIncludingCollapsed();s++){if(a.isGroupRowIncludingCollapsed([s,0])){continue}var l=[];for(var c=0;c<a.getTotalColumnCount();c++){l.push('"'+a.getTextValueIncludingHiddenColumns([s,c]).replace(/\"/g,'""')+'"')}r+=l.join(",");r+="\n"}var h=f.displayName()+"-"+e.Date.create().customFormat("shortFormat")+".csv";var m=d()+"/"+h;e.FileStore.store(m,r,function(e){var n=t('<a href="'+e.toURL()+'" download="'+h+'"> </a>');n[0].addEventListener("click",function(e){e.stopImmediatePropagation();e.stopPropagation()},true);i.elements.body.append(n);n.simulateRawClick();n.remove();i.hideNotice()})});var w=_.addItem(o.Locale.getString("export_feed"),function(t){u("exportFeed");var n=o.ButterBarManager.showLoading();a.get("pipelines/"+f.key()+"/newsfeed/export/type").getPromise().then(function(t){if(t.NEWSFEED_EXPORT_TYPE=="DIRECT_DOWNLOAD"){n.destroy();e.BentoBox.ButterBarManager.showMessage(o.Locale.getString("creating_csv"));var r="api/v1/pipelines/"+f.key()+"/newsfeed/export";var s=document.createElement("iframe");s.setAttribute("height",0);s.setAttribute("width",0);s.setAttribute("frameborder",0);s.setAttribute("src",o.UI.getResourceURL(r));e.CSPBypass.appendChild(s,i.elements.body[0])}else{return a.put("pipelines/"+f.key()+"/newsfeed/export/full").getPromise().then(function(e){n.destroy();o.ButterBarManager.showMessage(o.Locale.getString("newsfeed_export_email"))})}}).catch(function(e){o.logError("export error",e);n.destroy();o.ButterBarManager.showError("Error from server")})});var b={};b.separator=_.addSeparator();b.pipelineMenu=o.Widgets.Menu.create();b.item=_.addSubMenu(o.Locale.getString("move_box"),b.pipelineMenu);var C=function(){b.pipelineMenu.empty();if(o.Data.getAllPipelines().length>1){b.separator.show();b.item.show();n.each(o.UI.getSortedPipelines(),function(e){if(e.key()!==f.key()){b.pipelineMenu.addItem(e.displayName(),function(){c(f,e,p.getCheckedBoxes())})}})}else{b.separator.hide();b.item.hide()}};C();_.el.addClass("moreButtonMenu");var S=o.Widgets.Buttons.ButtonFactory.createMenuButton({type:"GmailArrow",text:o.Locale.getString("more_button_text"),menu:_,isRightAligned:true,isFixedPosition:true,menuClickTriggersOff:true});o.Data.getAllPipelines().watch("change",C,S);S.off();S.getElement().addClass("streak__pipelineMoreButton");var T=o.Services.AccessManager.isAccessAllowed;if(!f.getIsEditable()||!T(f,"Pipeline","UPDATE")){v.setEnabled(false);b.item.setEnabled(false)}v.setEnabled(T(f,"ImportJob","CREATE"));w.setEnabled(T(f,"BigNewsfeedExporterTask","GET"));var x=S.destroy.bind(S);S.destroy=function(){x();if(m){m.destroy()}f=null;p=null;_.destroy();_=null;e.NotificationCenter.unsubscribe({observer:S})};return S};function c(t,n,i){u("moveBoxesStarted",{numberOfBoxes:i?i.length:0});if(!i||i.length===0){e.BentoBox.ButterBarManager.showError(o.Locale.getString("one_box_selected"));u("moveBoxesFailed",{userFailure:true});return}o.MoveBoxHelper.moveBoxes(t,n,i)}function d(){return"pipelineExports"}e.DependencyManager.addFunction({functionKey:"emptyPipelineExportsDirectory",functionReference:function(){try{e.FileStore.remove(d())}catch(t){}},dependentFunctionKeys:["fileStoreLoaded"]});o.Modules.PipelineView.MoreButton=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineCSVImportView",superclass:s.View,_memberVariables:[{name:"_modal",destroy:true}],_initialize:function(){s.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.getElement("importModal")},_showModal:function(e){if(!this._element.is(":FastVisible(noCompute)")){t.modal.close()}e.title=c.Locale.getString("import_boxes_title");e.inner=this._element;e.persist=true;e.width="600px";this._modal=c.Widgets.Modal.create(e);this._modal.show(true)},_hideSections:function(){this._element.find(".explanation").css({visibility:"hidden"});this._element.find(".importModal > div").hide()},_showSection:function(e){this._element.find(".importModal ."+e).show()},renderLoading:function(){this._showModal({showConfirm:false,cancelText:c.Locale.getString("modal_cancel")});this._hideSections();this._showSection("loading");this._element.find(".explanation").css({visibility:"visible"});this._element.find(".explanation").show()},renderUpload:function(e){var n=this;this._showModal({title:c.Locale.getString("import_csv"),showConfirm:false,cancelText:c.Locale.getString("modal_cancel")});this._element.find(".explanation").css({visibility:"visible"});var i=this._element.find(".iframeWrapper");i.empty();var r=document.createElement("iframe");r.src=e;i.append(r);var a=0;r.onload=function(){a+=1;if(a==1){n._hideSections();n._showSection("upload");n._element.find(".explanation").css({visibility:"visible"});n._element.find(".explanation").show()}if(a>1){t(r).remove();n._callDelegateFunction("uploadComplete")}}},renderVerifying:function(){var e=this;this._showModal({cancelFunc:function(){e._callDelegateFunction("cancelImport");return true}});this._hideSections();this._showSection("verifying")},renderVerified:function(e,t){var i=this;this._showModal({showCancel:true,showConfirm:true,confirmText:c.Locale.getString("import_verify_start"),confirmFunc:function(){i._callDelegateFunction("startProcessing");return true},cancelText:c.Locale.getString("import_verify_cancel"),cancelFunc:function(){i._callDelegateFunction("cancelImport");return true}});this._hideSections();this._element.find(".explanation").hide();this._showSection("verified");i._element.find(".matched").empty();this._element.find(".verifiedText")[0].innerHTML=c.Locale.getString("import_records_found",{number:t,pluralize:[t]});n.each(e,function(e){i._element.find(".matched").append("<li>"+e+"</li>")})},renderProcessing:function(){var e=this;this._showModal({showConfirm:false,showCancel:true,cancelText:c.Locale.getString("import_background"),cancelFunc:function(){e._callDelegateFunction("processInBackground")}});this._hideSections();this._element.find(".explanation").hide();this._showSection("processing")},updateLoadPercentage:function(e){this._element.find(".processing .percent")[0].innerHTML="("+e+"%)";this._element.find(".processing .loaderBar div").width(e+"%")},renderDone:function(){this._hideSections();this._element.find(".explanation").hide();this._showSection("done")},renderError:function(e){var t=this;this._showModal({showConfirm:true,showCancel:true,confirmText:c.Locale.getString("import_try_again"),confirmFunc:function(){t._callDelegateFunction("tryImportAgain")},cancelText:c.Locale.getString("import_close"),cancelFunc:function(){t._callDelegateFunction("cancelImport")}});this._hideSections();this._element.find(".explanation").hide();this._showSection("error");if(e){this._element.find(".importErrorDescription")[0].innerHTML=e}else{var n=this._element.find(".importErrorDescription");n[0].innerHTML=c.Locale.getString("import_error_message_1")+"<br />"+c.Locale.getString("import_error_message_2");n.find("a").attr("href","mailto:support@streak.com")}}});i.set("BentoBox.Modules.PipelineView.MoreButton.PipelineCSVImportView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineCSVImportViewController",superclass:s.ViewController,_memberVariables:[{name:"_pipeline",destroy:false,set:true},{name:"_doneCallback",destroy:true,set:true},{name:"_importJobCollection",destroy:true},{name:"_currentImportJob",destroy:true},{name:"_poller",destroy:true}],_initialize:function(){s.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=new c.Modules.PipelineView.MoreButton.PipelineCSVImportView},setPipeline:function(e){this._pipeline=e;this._importJobCollection=c.Models.ImportJob.createCollection(e.key())},start:function(){this._stopPolling();this._importJobCollection.refresh(this._handleCollectionRefreshed.bind(this));this._view.renderLoading();c.Tracker.track("import starting")},_handleCollectionRefreshed:function(){this._extractImportJob();if(this._currentImportJob){this._currentImportJobUpdated();return}this._setupNewImportJob()},_extractImportJob:function(){for(var e=0;e<this._importJobCollection.length;e++){if(this._importJobCollection[e]){switch(this._importJobCollection[e].get("status")){case"UPLOADED":case"VERIFIED":case"PROCESSING":this._currentImportJob=this._importJobCollection[e];return;break}}}return},_setupNewImportJob:function(){this._currentImportJob=c.Models.ImportJob.create({pipelineKey:this._pipeline.key()});this._currentImportJob.save(this._currentImportJobUpdated.bind(this),this._creatingImportJobFailed.bind(this))},_creatingImportJobFailed:function(){this._view.renderError("Problem starting import job")},_currentImportJobUpdated:function(){switch(this._currentImportJob.get("status")){case"NOT_STARTED":this._renderUpload();break;case"UPLOADED":this._renderVerifying();break;case"VERIFIED":this._showVerified();break;case"PROCESSING":this.startProcessing();break;case"CLEANED_UP":this.destroy();break;default:this._renderError()}},_renderUpload:function(){var e=this._currentImportJob.get("uploadUrl");var t=this._extractDomain(e);e=t+"/importUpload#"+e;this._view.renderUpload(e)},_extractDomain:function(e){var t=document.createElement("a");t.href=e;return t.origin},uploadComplete:function(){this._currentImportJob.refresh(this._currentImportJobUpdated.bind(this));c.Tracker.track("import upload complete")},_renderVerifying:function(){this._view.renderVerifying();var e=this;this._startPolling("UPLOADED","VERIFIED",null,function(){e._showVerified()})},_showVerified:function(){this._view.renderVerified(this._currentImportJob.get("verifiedFields"),this._currentImportJob.get("recordsTotal"));c.Tracker.track("import verified")},startProcessing:function(){this._currentImportJob.set("status","PROCESSING");this._currentImportJob.save();this._view.renderProcessing();var e=this;this._startPolling("PROCESSING","DONE",function(){var t=(e._currentImportJob.get("percentageComplete")*100).round();e._view.updateLoadPercentage(t)},function(){e._stopPolling();e._view.renderDone();e._doneCallback();c.Tracker.track("import complete")})},processInBackground:function(){this.destroy()},_startPolling:function(e,t,i,r){if(this._poller){this._poller.stop();this._poller=null}var a=this;this._poller=n.repeatEvery(function(){a._refreshAndCheckAgainstStatus(e,t,i,r)},1e3)},_refreshAndCheckAgainstStatus:function(e,t,n,i){var r=this;this._currentImportJob.refresh(function(){r._checkAgainstStatus(e,t,n,i)},function(){r._renderError()})},_checkAgainstStatus:function(e,t,n,i){if(!this._currentImportJob){return}switch(this._currentImportJob.get("status")){case e:if(n){n()}break;case t:this._stopPolling();if(i){i()}break;case"INVALID_FILE":case"ERROR_IMPORTING":this._renderError();break;case"CLEANED_UP":this.start();break;default:this._renderError();break}},_renderError:function(){this._stopPolling();this._view.renderError(this._currentImportJob.get("errorMessage"))},_stopPolling:function(){if(this._poller){this._poller.stop()}this._poller=null},tryImportAgain:function(){this._currentImportJob.set("status","CANCELLED_BY_USER");this._currentImportJob.save();this._currentImportJob=null;this.start()},cancelImport:function(){this._stopPolling();c.ButterBarManager.showMessage(c.Locale.getString("import_cancel"),{time:5e3});this._currentImportJob.set("status","CANCELLED_BY_USER");this._currentImportJob.save();this.destroy();c.Tracker.track("import canceled")}});i.set("BentoBox.Modules.PipelineView.MoreButton.PipelineCSVImportViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox,s=e.BentoBox.Models.Pipeline;var l=e.Class.subclass({className:"PipelineSpreadsheetViewController",superclass:e.UI.Delegator,_memberVariables:[{name:"_tableModel",destroy:false,set:true},{name:"_cursorModel",destroy:false,set:true},{name:"_pipeline",destroy:false},{name:"_resultSet",destroy:true,defaultValue:[]},{name:"_visibleResultSet",destroy:true,defaultValue:[]},{name:"_selectedIndex",destroy:true,defaultValue:-1},{name:"_searchTerm",destroy:true}],_initialize:function(t){e.UI.Delegator.prototype._initialize.call(this);this._pipeline=t},reset:function(){this._reset()},_reset:function(){this._resultSet=[];this._visibleResultSet=[];this._selectedIndex=-1;this._searchTerm=null;this._cursorModel.removeClassForAllCoordinates("searchResultsHighlightPipeline");this._callDelegateFunction("searchResultsChanged");this._delegate.redrawContentRows()},searchTriggered:function(e){this._searchTerm=e;this._cursorModel.removeClassForAllCoordinates("searchResultsHighlightPipeline");this.updateResultSet(this._searchTerm);if(this._resultSet.length>0){this._cursorModel.addClassToCoordinates("searchResultsHighlightPipeline",this._visibleResultSet);this.updateSelectedIndex();this._moveCursor()}else{this._reset()}},updateResultSet:function(e){this._resultSet=[];this._visibleResultSet=[];if(n.isNotReal(e)||e.length<2){return}e=e.toUpperCase();var t=this._tableModel.getNumberOfRowsIncludingCollapsed()+1;var i=0;var r=true;for(var a=0;a<t;a++){if(a>0){if(this._tableModel.isGroupRowIncludingCollapsed([a,0])){r=this._tableModel.isGroupIncludingCollapsedOpen(a);i++}else if(r){i++}}var o=this._tableModel.getLastColumnForCurrentRow([a,0])+1;for(var s=0;s<o;s++){var l=[a,s];var u=this._tableModel.getSearchValue(l);if(!u){continue}u=u.toString().toUpperCase();if(u.indexOf(e)>-1){this._resultSet.push(l);if(r){this._visibleResultSet.push([i,s])}}}}},updateSelectedIndex:function(){var e=this._cursorModel.getPosition()||[0,0];var t=this._tableModel.translateCoordToIncludingCollapsed(e);this._selectedIndex=0;for(var n=0;n<this._resultSet.length;n++){var i=this._cellIsGreaterThanOrEqualTo(this._resultSet[n],t);if(i){this._selectedIndex=n;break}}},getResultState:function(){return{selectedIndex:this._selectedIndex+1,total:this._resultSet.length}},hideSearch:function(){this._reset();this._delegate.focus()},_moveCursor:function(){var e=this._resultSet[this._selectedIndex];if(this._tableModel.isRowInCollapsedSection(e[0])){this._tableModel.openClosestGroupIncludedCollapsed(e[0]);this._delegate.runDataTransforms();this.searchTriggered(this._searchTerm);this.selectNext();return}var t=this._tableModel.translateCoordToVisibleCoord(e);this._cursorModel.setPosition(t);this._callDelegateFunction("searchResultsChanged");this._delegate.redrawContentRows()},_cellIsGreaterThanOrEqualTo:function(e,t){if(e[0]>t[0]){return true}if(e[0]<t[0]){return false}return e[1]>=t[1]},selectPrevious:function(){if(this._resultSet.length===0){this._reset();
return}this._selectedIndex--;if(this._selectedIndex<0){this._selectedIndex=this._resultSet.length-1}this._moveCursor()},selectNext:function(){if(this._resultSet.length===0){this._reset();return}this._selectedIndex++;if(this._selectedIndex>=this._resultSet.length){this._selectedIndex=0}this._moveCursor()},updateCursorPosition:function(e){this._cursorModel.setPosition(e)}});o.Modules.PipelineSearchController=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineTransformRegister",superclass:e.Object,_memberVariables:[{name:"_transforms",destroy:true,get:true,defaultValue:[]},{name:"_namedTransforms",destroy:true,get:true,defaultValue:{}}],_initialize:function(){e.Object.prototype._initialize.call(this)},register:function(e,t,i){e.priority=t;e.transformName=i;this._transforms.push(e);if(n.isReal(i)){this._registerNamedTransform(e,i)}},_registerNamedTransform:function(e,t){if(n.isNotReal(this._namedTransforms[t])){this._namedTransforms[t]=[]}this._namedTransforms[t].push(e)}});i.set("BentoBox.Modules.PipelineTransformRegister",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={};var h={};var f=e.Class.subclass({className:"PipelineSpreadsheetViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_pipeline",destroy:false},{name:"_savedViewsController",destroy:false},{name:"_transformedData",destroy:false,get:true,defaultValue:{}},{name:"_pipelineTableModel",destroy:true,get:true},{name:"_cursorModel",destroy:true},{name:"_pipelineNewBox",destroy:true},{name:"_pipelineSearchController",destroy:true,get:true},{name:"_currentState",destroy:false},{name:"_unbindFunctions",destroy:true,defaultValue:[]}],cellChange:function(e){this._view.redrawCell(e)},rowChange:function(e){this._view.redrawRow(e)},runDataTransforms:function(){this._runDataTransforms()},redraw:function(){if(this._isRenderBlocked()){return}this._view.redrawTable()},redrawContentRows:function(){this._view.redrawContentRows()},widthChange:function(e){this._view.widthChange(e)},newBoxAdded:function(){this._callDelegateFunction("newBoxAdded")},focus:function(){this._view.focus()},resize:function(){this._view.resize()},getCheckedBoxes:function(){return this._pipelineTableModel.getCheckedBoxes()},getCursorPosition:function(){return this._cursorModel.getPosition()},updateCursorPosition:function(e,t){this._cursorModel.updatePosition(e,t);this._view.redrawContentRows();this._view.redrawGroupRows();this._view.focus()},updateCursorToEnd:function(e){this._cursorModel.moveToEnd(e);this._view.redrawContentRows();this._view.redrawGroupRows();this._view.focus()},updateCursorToBeginning:function(e){this._cursorModel.moveToBeginning(e);this._view.redrawContentRows();this._view.redrawGroupRows();this._view.focus()},unfocusCursor:function(){this._cursorModel.unfocus();h[this._getCursorPositionKey()]=null;this._view.hideCursor();this._view.redrawContentRows();this._view.redrawGroupRows()},cursorSelect:function(e,t){var n=null;if(t&&e){n=this._cursorModel.getPosition();if(this._pipelineTableModel.getActionType(n)!=="CHECKBOX"){n=null}}if(!e){e=this._cursorModel.getPosition()}if(n){if(this._pipelineTableModel.getActionType(e)==="CHECKBOX"){this._pipelineTableModel.checkMultipleBoxes(n,e)}}if(this._pipelineTableModel.getState(e)!=="EDIT"){this._cursorModel.setPosition(e);this._cursorModel.select();this._view.redrawGroupRows();this._view.redrawContentRows();return true}this._view.redrawContentRows();this._view.redrawGroupRows();return false},jumpToGroup:function(e){var t=this._pipelineTableModel.getGroupRowIndex(e);var n=this;if(t>-1){setTimeout(function(){n._cursorModel.setPosition([t,2]);n._view.scrollCursorToTop();n._view.focus()},1)}},registerScrollPosition:function(e){d[this._getCursorPositionKey()]=e},setIsMenuOpen:function(e){this._currentState.isMenuOpen=e},isMenuOpen:function(){return this._currentState.isMenuOpen},startNewBox:function(){if(c.Services.AccessManager.isAccessAllowed(this._pipeline,"Box","CREATE")){this._pipelineNewBox.startNewBox()}},startDeleteBox:function(){this._callDelegateFunction("startDeleteBox")},_initialize:function(t,n){this._pipeline=c.Data.getPipeline(t);this._savedViewsController=n;this._currentState={hash:null,state:null,isMenuOpen:false};this._setupTableModel();this._setupCursorModel();this._setupPipelineNewBox();this._setupSearchController();e.UI.ViewController.prototype._initialize.call(this);this._bindToModelChanges()},_setupView:function(){this._view=new c.Widgets.NewSpreadsheet(this._pipelineTableModel,this._cursorModel)},_setupTableModel:function(){this._pipelineTableModel=new c.Modules.PipelineTableModel(this._pipeline);this._pipelineTableModel.setDelegate(this)},_setupCursorModel:function(){var e=this;this._cursorModel=c.VirtualCursorModel.create({highlightFunc:function(t){e._updateCurrentState(t,"HIGHLIGHT")},unhighlightFunc:function(t){e._updateCurrentState(t,"DEFAULT")},selectFunc:function(t){var n=e._pipelineTableModel.getActionType(t);switch(n){case"INSTANT":case"CHECKBOX":e._pipelineTableModel.action(t);break;case"EDIT":e._updateCurrentState(t,"EDIT");break}}})},_setupPipelineNewBox:function(){this._pipelineNewBox=new c.Modules.PipelineNewBox(this._pipeline,this._pipelineTableModel,this._cursorModel,this._savedViewsController);this._pipelineNewBox.setDelegate(this)},_setupSearchController:function(){this._pipelineSearchController=new c.Modules.PipelineSearchController(this._pipeline);this._pipelineSearchController.setDelegate(this);this._pipelineSearchController.setTableModel(this._pipelineTableModel);this._pipelineSearchController.setCursorModel(this._cursorModel)},_runDataTransforms:function(){if(this._isRenderBlocked()){return}c.Data.getPipelineBoxes(this._pipeline.key()).sortByParameter("lastUpdatedTimestamp");this._initializedTransformedData();this._applyTransforms();this._pipelineTableModel.setTransformedData(this._transformedData);this._cursorModel.setup(this._pipelineTableModel);this._pipelineNewBox.setTransformedData(this._transformedData);this._view.render();if(n.isReal(h[this._getCursorPositionKey()])){this._cursorModel.setPosition(h[this._getCursorPositionKey()])}if(n.isReal(d[this._getCursorPositionKey()])){this._view.setScrollPosition(d[this._getCursorPositionKey()])}this._callDelegateFunction("transformedDataChanged")},_initializedTransformedData:function(){this._transformedData.columns={};this._transformedData.columnOrder=[];this._transformedData.lists={novalue:{isEditable:false,groupModel:null,list:(c.Data.getPipelineBoxes(this._pipeline.key())||[]).slice(0),color:null,isOpen:true}};this._transformedData.groups=["novalue"]},_applyTransforms:function(){var e=c.Modules.PipelineTransformRegister.getTransforms();if(!e){return}var t=this._pipeline;var i=this._transformedData;var r=this._savedViewsController;n.chain(e).sortBy(function(e){return e.priority||100}).each(function(e){e(t,i,r)})},_updateCurrentState:function(e,t){if(t==="EDIT"&&this._pipelineTableModel.isGroup(e)&&e[1]!==2){e[1]=2;this._cursorModel.setPosition(e)}this._pipelineTableModel.updateState(e,t);switch(t){case"DEFAULT":this._view.hideCursor();break;case"HIGHLIGHT":this._currentState.hash=this._pipelineTableModel.getRowHash(e[0]);h[this._getCursorPositionKey()]=e;this._view.showCursor(e,{noHorizontalScroll:this._pipelineTableModel.isGroup(e),noScroll:e[0]===0});break;case"EDIT":this._currentState.hash=this._pipelineTableModel.getRowHash(e[0]);h[this._getCursorPositionKey()]=e;this._view.hideCursor();break}this._currentState.state=t;this._updateRowAndColumnMarker(e,t)},_getCursorPositionKey:function(){var e=this._pipeline.key();if(this._savedViewsController&&this._savedViewsController.activeView){e+="_"+this._savedViewsController.activeView.viewKey}return e},_updateRowAndColumnMarker:function(e,t){var n=0,i;var r=this._pipelineTableModel.getNumberOfVisibleColumnsForRow([0,0]);var a=this._cursorModel.getRawPosition();for(n=0;n<r;n++){if(n!==e[1]){this._cursorModel.removeCoordinateClass([0,n],"bbActiveColumn")}}switch(t){case"DEFAULT":i=this._pipelineTableModel.getNumberOfVisibleColumnsForRow(e);for(n=0;n<i;n++){this._cursorModel.removeCoordinateClass([e[0],n],"bbActiveRow")}this._cursorModel.removeCoordinateClass([0,e[1]],"bbActiveColumn");break;case"HIGHLIGHT":case"EDIT":if(!this._pipelineTableModel.isGroup(e)){i=this._pipelineTableModel.getNumberOfVisibleColumnsForRow(e);for(n=0;n<i;n++){this._cursorModel.addCoordinateClass([e[0],n],"bbActiveRow");if(n!==e[1]){}}}this._cursorModel.addCoordinateClass([0,a[1]],"bbActiveColumn");break}},_bindToModelChanges:function(){this._bindToBoxCollectionChanges();this._bindToPipelineChanges();this._bindToSavedViewsControllerChanges()},_bindToBoxCollectionChanges:function(){var e=c.Data.getPipelineBoxes(this._pipeline.key());var t=this;e.watch("change",this._boxChanged,this);e.watch("requestsCompleted",this._boxRequestsCompleted,this);e.watch("remove",this._throttledRunDataTransforms,this);e.watch("add",function(e){if(!e.model.isNewBox){this._throttledRunDataTransforms()}},this);e.watch("collectionRefreshed",function(e){if(e.didCollectionChange){this._throttledRunDataTransforms()}},this);e.watch("collectionBatchUpdated",function(){t._pipelineTableModel.updateGroupColumns();t._view.redrawGroupRows();t._view.redrawContentRows()},this)},_boxChanged:function(e){var t=e.model;var n=e.property;var i=e.previousValue;var r=e.property;if(n==="pipelineKey"){return}if(!t||!t.key||!t.key()){return}if(e.transactionId){return}var a="property|stageKey";var o=this._savedViewsController.getGroupBySettings();if(o&&o.data){a=o.data}var s=null;var l=null;var u=false;if(n==="fieldKey"){if(a.indexOf("field|")>-1){l=a.split("|")[1];var c=t.getFieldValue(l);if(c!==i){u=true}}}else if(a.indexOf("property|")>-1){s=this._pipeline.getSystemColumn(a.split("|")[1]).property;if(s===n){if(t.get(s)!==i){u=true}}}if(u){this._throttledRunDataTransforms()}else{var d=this._pipelineTableModel.getBoxRowIndex(t,s,l);if(d>-1){this._view.redrawRow(d)}this._pipelineTableModel.updateGroupColumn(t)}},_boxRequestsCompleted:function(e){var t=e.model;var n="property|stageKey";var i=this._savedViewsController.getGroupBySettings();if(i&&i.data){n=i.data}var r=null;var a=null;var o=false;if(n.indexOf("field|")>-1){a=n.split("|")[1]}else if(n.indexOf("property|")>-1){r=this._pipeline.getSystemColumn(n.split("|")[1]).property}var s=this._pipelineTableModel.getBoxRowIndex(t,r,a);this._view.redrawRow(s);this._pipelineTableModel.updateGroupColumn(t)},_boxCollectionChanged:function(e){this._throttledRunDataTransforms()},_bindToPipelineChanges:function(){e.NotificationCenter.subscribe({eventName:"change",observer:this,filterParameters:{parentModel:this._pipeline},functionToCall:function(){this._view.redrawTable()}})},_bindToSavedViewsControllerChanges:function(){var e=this;this._unbindFunctions.push(this._savedViewsController.bind("transformSettingsChanged",function(){e._throttledRunDataTransforms()}));this._unbindFunctions.push(this._savedViewsController.bind("widthChange",function(){e._view.widthChange()}));this._unbindFunctions.push(this._savedViewsController.bind("selectColumnHeader",function(t){var n=e._pipelineTableModel.getColumnIndex(t);if(n===-1){return}e._cursorModel.setPosition([0,n+2]);e._cursorModel.select()}));this._unbindFunctions.push(this._savedViewsController.bind("savedViewsEditAreaChanged",function(){e._view.resize()}))},_isRenderBlocked:function(){return this._currentState.state==="EDIT"||this._currentState.isMenuOpen},_throttledRunDataTransforms:n.debounce(function(){this._runDataTransforms()},50),destroy:function(){l.unsubscribe({observer:this});e.UI.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Modules.PipelineSpreadsheetViewController",f)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineTableModel",superclass:e.UI.Delegator,_memberVariables:[{name:"_transformedData",destroy:false},{name:"_numRows",destroy:false},{name:"_numColumns",destroy:false},{name:"_groupRows",destroy:false,defaultValue:[]},{name:"_groupRowsIncludingCollapsed",destroy:false,defaultValue:[]},{name:"_numRowsIncludingCollapsed",destroy:false},{name:"_highlightCellCoord",destroy:false},{name:"_editCellCoord",destroy:false},{name:"_checkedRows",destroy:false,defaultValue:[]},{name:"_pipeline",destroy:false,get:true,set:true},{name:"_visibleColumns",destroy:false,defaultValue:[]},{name:"_areBoxClicksEnabled",destroy:false,defaultValue:true}],_initialize:function(t){e.UI.Delegator.prototype._initialize.call(this);this._pipeline=t},setTransformedData:function(e){this._transformedData=e;this._reset()},reset:function(){this._reset()},_reset:function(){this._numRows=1;this._numRowsIncludingCollapsed=1;this._numColumns=2;this._groupRows.length=0;this._groupRowsIncludingCollapsed.length=0;this._highlightCellCoord=[0,0];this._editCellCoord=null;this._checkedRows.length=0;this._visibleColumns.length=0;for(var e=0;e<this._transformedData.groups.length;e++){this._groupRows.push(this._numRows);this._numRows+=1;this._groupRowsIncludingCollapsed.push(this._numRowsIncludingCollapsed);this._numRowsIncludingCollapsed+=1;var t=this._transformedData.lists[this._transformedData.groups[e]];if(t.isOpen){this._numRows+=t.list.length}this._numRowsIncludingCollapsed+=t.list.length}for(e=0;e<this._transformedData.columnOrder.length;e++){var n=this._transformedData.columns[this._transformedData.columnOrder[e]];if(n.isVisible&&!n.notPresent){this._visibleColumns.push(n);this._numColumns+=1}}},getTotalColumnCount:function(){return this._transformedData.columnOrder.length},getVisibleColumnCount:function(){return this._visibleColumns.length},getRowCount:function(){return this._numRows},getNumberOfNonHeaderRows:function(){return this.getLastRowNumber()},getLastRowNumber:function(){return this._numRows-1},getLastColumnForCurrentRow:function(e){return this._numColumns-1},getNumberOfVisibleColumnsForRow:function(e){return this._visibleColumns.length+2},getRowOfNextGroup:function(e){var t=this._transformedData.groups.indexOf(e);if(t===this._transformedData.groups.length-1){return-1}return this._groupRows[t+1]},getCheckedBoxes:function(){var e=[];for(var t=0;t<this._checkedRows.length;t++){var n=this._checkedRows[t];if(n>0){if(!this._isGroupRow(n)){e.push(this._getBox(n))}}}return e},checkMultipleBoxes:function(e,t){var i=t[0]-e[0];var r=1;if(i<0){r=-1}var a=new Array(Math.abs(i));var o=0;for(var s=e[0]+r;r*s<r*t[0];s=s+r){var l=[s,e[1]];if(!this.isChecked(l)&&!this._isGroupRow(s)){a[o]=s}o++}var u=n.union(this._checkedRows,a);this._checkedRows.length=0;for(var c=0;c<u.length;c++){this._checkedRows.push(u[c])}for(var c=0;c<this._checkedRows.length;c++){this._delegate.cellChange([this._checkedRows[c],e[1]])}this.notifySelectedBoxesChanged()},notifySelectedBoxesChanged:function(){e.NotificationCenter.postNotification({eventName:"pipeline.selectedBoxesChanged",pipelineKey:this._pipeline.key(),selectedBoxes:this.getCheckedBoxes(),sender:this})},getNumberOfBoxes:function(){if(!this._transformedData||!this._transformedData.lists){return 0}return n(this._transformedData.lists).values().map(function(e){return e.list}).flatten().length},getRowHash:function(e){if(e===0){return"columnHeaders"}else if(this._isGroupRow(e)){return this._getGroupID(e)}else{var t=this._getBox(e);if(t){return t.getId()}else{return null}}},isGroup:function(e){return this._isGroupRow(e[0])},isGroupRowIncludingCollapsed:function(e){return this._isGroupRowIncludingCollapsed(e[0])},isGroupIncludingCollapsedOpen:function(e){var t=this._getClosestGroupIDIncludingCollapsed(e);return this._transformedData.lists[t].isOpen},getGroupIndex:function(e){return this._groupRows.indexOf(e)},getGroupRowIndex:function(e){var t=this._transformedData.groups.indexOf(e);if(t>-1){return this._groupRows[t]}return t},getGroupID:function(e){return this._getClosestGroupID(e)},getGroupIDIncludingCollapsed:function(e){return this._getClosestGroupIDIncludingCollapsed(e)},translateCoordToIncludingCollapsed:function(e){if(e[0]===0){return e}var t=e[0];var n=this._getClosestGroupID(t);var i=this._groupRowsIncludingCollapsed[this._transformedData.groups.indexOf(n)];var r=this.getGroupRowIndex(n);var a=i-r;var o=t+a;return[o,e[1]]},translateCoordToVisibleCoord:function(e){if(e[0]===0){return e}var t=e[0];var n=this._getClosestGroupIDIncludingCollapsed(t);var i=this._groupRowsIncludingCollapsed[this._transformedData.groups.indexOf(n)];var r=this.getGroupRowIndex(n);var a=r-i;var o=t+a;return[o,e[1]]},getBoxRowIndex:function(e,t,n,i){if(!this._transformedData){return-1}var r,a,o,s;var l=i;if(!l){if(t){l=e.get(t)}else if(n){l=e.getFieldValue(n)}}if(l&&this._transformedData.lists[l]){o=this._transformedData.lists[l];if(o.isOpen){s=this.getGroupRowIndex(l)+1;for(r=0;r<o.list.length;r++){if(o.list[r].key()===e.key()){return s+r}}}}else{for(r=0;r<this._transformedData.groups.length;r++){l=this._transformedData.groups[r];o=this._transformedData.lists[l];if(o.isOpen){s=this.getGroupRowIndex(l)+1;for(a=0;a<o.list.length;a++){if(o.list[a]&&o.list[a].key()===e.key()){return s+a}}}}}return-1},getBox:function(e){return this._getBox(e[0])},isCoordTheCurrentEditCell:function(e){return this._isCoordsEqual(this._editCellCoord,e)},getContainingGroupID:function(e){return this._getClosestGroupID(e[0])},getColumnIndex:function(e){for(var t=0;t<this._visibleColumns.length;t++){if(this._visibleColumns[t].columnKey===e){return t}}return-1},getColumnSummaryType:function(e){var t=this.getGroupColumnData(e).column;if(!t){return false}return t.chosenSummaryFunction||t.isSummarizable},doesColumnHaveSummaryType:function(e){var t=this._visibleColumns[e-2];if(!t){return false}return!!t.chosenSummaryFunction},getNumberOfGroupRows:function(){return this._groupRows.length},getGroupRowIndexes:function(){return this._groupRows},areGroupRowsFat:function(){return this._transformedData.groupMeta.areGroupRowsFat},getGroupRowColor:function(e){var t=this._groupRows[e];var n=this._getGroupID(t);return this._transformedData.lists[n].color},getCollaborationStatus:function(){return this._pipeline.getCollaborationStatus()},getNumberOfRowsIncludingCollapsed:function(){return this._numRowsIncludingCollapsed},isRowInCollapsedSection:function(e){if(e===0){return false}var t=this._getClosestGroupIDIncludingCollapsed(e);return!this._transformedData.lists[t].isOpen},openClosestGroupIncludedCollapsed:function(e){var t=this._getClosestGroupIDIncludingCollapsed(e);this._transformedData.lists[t].toggleOpen()},canGoDownOnEnter:function(e){if(e[0]===0){return true}if(this._isGroupRow(e[0])){return true}if(this._isGroupRow(e[0]+1)){return false}return true},getActionType:function(e){if(e[0]===0){return this._getColumnActionType(e)}else if(this._isGroupRow(e[0])){return this._getGroupActionType(e)}else{return this._getBoxActionType(e)}},getState:function(e){if(this._isCoordsEqual(this._highlightCellCoord,e)){return"HIGHLIGHT"}else if(this._isCoordsEqual(this._editCellCoord,e)){return"EDIT"}else{return"DEFAULT"}},updateState:function(e,t){switch(t){case"DEFAULT":if(this._isCoordsEqual(this._highlightCellCoord,e)){this._highlightCellCoord=null}else if(this._isCoordsEqual(this._editCellCoord,e)){this._editCellCoord=null}break;case"HIGHLIGHT":this._highlightCellCoord=e;if(this._isCoordsEqual(this._editCellCoord,e)){this._editCellCoord=null}break;case"EDIT":this._highlightCellCoord=null;this._editCellCoord=e;break}},getHTMLValue:function(e){var t="";if(e[0]===0){t=this._getColumnHTMLValue(e)}else if(this._isGroupRow(e[0])){t=this._getGroupHTMLValue(e)}else if(this._isBoxRow(e[0])){t=this._getBoxHTMLValue(e)}return t},getSearchValue:function(e){var t="";if(e[0]===0){t=this._getColumnSearchValue(e)}else if(this._isGroupRowIncludingCollapsed(e[0])){t=this._getGroupSearchValue(e)}else if(this._isBoxRowIncludingCollapsed(e[0])){t=this._getBoxSearchValue(e)}return t},getTextValue:function(e){var t="";if(e[0]===0){t=this._getColumnTextValue(e)}else if(this._isGroupRow(e[0])){t=this._getGroupTextValue(e)}else if(this._isBoxRow(e[0])){t=this._getBoxTextValue(e)}return t},getTextValueIncludingHiddenColumns:function(e){var t="";if(e[0]===0){t=this._getColumnTextValueIncludingHiddenColumns(e)}else if(this._isGroupRowIncludingCollapsed(e[0])){t=this._getGroupTextValueIncludingHiddenColumns(e)}else if(this._isBoxRowIncludingCollapsed(e[0])){t=this._getBoxTextValueIncludingHiddenColumns(e)}return t},getData:function(e){var t="";if(e[0]===0){t=this._getColumnData(e)}else if(this._isGroupRow(e[0])){t=this._getGroupData(e)}else if(this._isBoxRow(e[0])){t=this._getBoxData(e)}return t},action:function(e){var t="";if(e[0]===0){t=this._columnAction(e)}else if(this._isGroupRow(e[0])){t=this._groupAction(e)}else if(this._isBoxRow(e[0])){t=this._boxAction(e)}return t},shouldNotScrollX:function(e){return this._isGroupRow(e[0])&&e[1]===2},isChecked:function(e){if(e[1]===1){return this._checkedRows.indexOf(e[0])>-1}var t=this._getVisibleColumn(e[1]-2);if(!t.fieldKey){return false}var n=this._getBox(e[0]);if(!n){return false}return n.getFieldValue(t.fieldKey)},getGroupColumnData:function(e){return{group:this._getGroup(e[0]),column:this._visibleColumns[e[1]-2]}},getColumnData:function(e){var t=this._visibleColumns[e-2];return t},isColumnRenameable:function(e){return this._getColumn(e-2).isRenameable},isColumnVisible:function(e){var t=this._getColumn(e-2);return t.isVisible&&!t.notPresent},isColumnNotPresent:function(e){return this._getColumn(e-2).notPresent},isColumnNew:function(e){return this._getColumn(e-2).highlight},getColumnWidth:function(e){return this._getColumn(e-2).width||150},setColumnWidth:function(e,t){this._getColumn(e-2).setWidth(t);this._delegate.widthChange(e)},saveColumnWidth:function(e){this._getColumn(e-2).saveWidth()},columnReorder:function(e,t,n){this._visibleColumns[e].setNewIndex(t,n)},isGroupColumnEditable:function(e){if(e[1]<2){return false}return this._transformedData.groupMeta.canEdit},isColumnSummarizable:function(e){var t=this._visibleColumns[e[1]-2];return t.isSummarizable},updateGroupColumn:function(e){var t=this.getBoxRowIndex(e);if(t>-1){var n=this._getClosestGroupID(t);this._transformedData.lists[n].updateSummaryValues();this._delegate.rowChange(this.getGroupRowIndex(n))}},updateGroupColumns:function(){for(var e=0;e<this._transformedData.groups.length;e++){this._transformedData.lists[this._transformedData.groups[e]].updateSummaryValues()}},_getColumnActionType:function(e){if(e[1]===0){return"INSTANT"}else if(e[1]===1){return"CHECKBOX"}else if(this._visibleColumns[e[1]-2].isRenameable){return"EDIT"}return"NONE"},_getColumnHTMLValue:function(e){if(e[1]===0){return'<div class="bbHand Wp '+(!this._areAllGroupsClosed()?"Wq":"Wo")+'"></div>'}if(e[1]===1){return""}var t=this._visibleColumns[e[1]-2];if(!t||!t.getName){this._delegate.runDataTransforms();return""}return n.escape(t.getName())},_getColumnSearchValue:function(e){if(e[1]<2){return""}var t=this._visibleColumns[e[1]-2];return t.getName()},_getColumnTextValue:function(e){return this._visibleColumns[e[1]-2].getName()},_getColumnTextValueIncludingHiddenColumns:function(e){return this._transformedData.columns[this._transformedData.columnOrder[e[1]]].getName()},_getColumnData:function(e){var t=this._visibleColumns[e[1]-2];return{model:t.getField(),type:"TEXT",property:"name"}},_columnAction:function(e){if(e[1]===0){var t=this._areAllGroupsClosed();var n=null;for(var i in this._transformedData.lists){n=i;this._transformedData.lists[i].toggleOpen(t,true)}this._transformedData.lists[n].toggleOpen(t);this._delegate.runDataTransforms();return}if(e[1]===1){var r=!this.isChecked(e);var a=1;var o=this.getLastRowNumber()+1;this._checkedRows.length=0;if(r){for(var s=0;s<o;s++){this._checkedRows[s]=s}}this._delegate.redraw();this.notifySelectedBoxesChanged();return}var l=this._getColumn(e[1]-2);if(!l.isVisible){l.show();this._delegate.runDataTransforms()}},_getGroupActionType:function(e){if(e[1]===0){return"INSTANT"}else if(e[1]===1){return"CHECKBOX"}else{if(this._transformedData.groupMeta.canEdit&&e[1]===2){return"EDIT"}else{return"NONE"}}},_getGroupHTMLValue:function(e){var t=this._getGroupID(e[0]);if(n.isNotReal(this._transformedData.lists[t])){return""}if(e[1]===0){return'<span class="pre-child" style="background-color:'+this._transformedData.lists[t].color.backgroundColor+';">&nbsp;</span><div class="bbHand Wp '+(this._transformedData.lists[t].isOpen?"Wq":"Wo")+'"></div>'}else if(e[1]===2){return this._transformedData.lists[t].displayName()}else if(e[1]>2){var i=this._visibleColumns[e[1]-2];return this._transformedData.lists[t].getHTMLValue(i.columnKey)}},_getGroupSearchValue:function(e){if(e[1]===2){var t=this._getClosestGroupIDIncludingCollapsed(e[0]);return this._transformedData.lists[t].displayName()}else{return undefined}},_getGroupTextValue:function(e){return this.group.getSearchValue(e)},_getGroupTextValueIncludingHiddenColumns:function(e){return this.group.getSearchValue(e)},_getGroupData:function(e){return{model:this._transformedData.lists[this._getGroupID(e[0])].groupModel,type:"TEXT",property:"name",validator:this._transformedData.lists[this._getGroupID(e[0])].isPotentialValueValid,trackingContext:{isStage:true}}},_groupAction:function(e){var t=this._getGroupID(e[0]);var i;if(e[1]===0){this._transformedData.lists[t].toggleOpen();this._delegate.runDataTransforms()}else if(e[1]===1){var r=!this.isChecked(e);if(this._transformedData.lists[t].isOpen){var a=this._groupRows.indexOf(e[0]);var o=e[0]+1;var s=-1;if(a===this._groupRows.length-1){s=this._groupRows[a]+this._transformedData.lists[t].list.length+1}else{s=this._groupRows[a+1]}var l=s-o;var u=new Array(l+1);u[0]=e[0];for(i=0;i<l;i++){u[i+1]=o+i}if(r){this._checkedRows=n.chain(this._checkedRows).union(u).compact().value()}else{for(i=0;i<u.length;i++){this._checkedRows.removeVal(u[i])}}}this._delegate.redraw();this.notifySelectedBoxesChanged()}},_getBoxActionType:function(e){if(e[1]===0){return"INSTANT"}else if(e[1]===1){return"CHECKBOX"}else if(e[1]>1){var t=this._getVisibleColumn(e[1]-2);if(t.isEditable){return"EDIT"}else if(t.isCheckbox){return"CHECKBOX"}else{return"NONE"}}},_getBoxHTMLValue:function(e){var t=this._getBox(e[0]);if(!t){throw new Error("box.getHTMLValue called on a non-box coordinate")}var n=this._getClosestGroupID(e[0]);if(e[1]===0){return'<span class="pre-child" style="background-color:'+(t.isSavedOnServer()?this._transformedData.lists[n].color.backgroundColor:"#ccc")+';">&nbsp;</span>'+'<span class="link" role="link">&nbsp;</span>'}else if(e[1]===1){}else{var i=e[1]-2;var r=this._getVisibleColumn(i);if(!r){this._delegate.runDataTransforms();return""}if(r.fieldKey){return c.Models.BoxField.getHTMLValue(t,r.fieldKey)}else if(r.property){return t.getProcessedHTMLValue(r.property)}}},_getBoxSearchValue:function(e){var t=this._getBoxIncludingCollapsed(e[0]);if(!t){return""}if(e[1]>1){var n=e[1]-2;var i=this._getVisibleColumn(n);if(i.fieldKey){return t.getFieldSearchValue(i.fieldKey)}else if(i.property){return t.getSearchValue(i.property)}}return""},_getBoxTextValue:function(e){var t=this._getBox(e[0]);if(!t){return""}if(e[1]>1){var n=e[1]-2;var i=this._visibleColumns[n];if(i.fieldKey){return t.getFieldTextValue(i.fieldKey)}else if(i.property){return t.getTextValue(i.property)}}return""},_getBoxTextValueIncludingHiddenColumns:function(e){var t=this._getBoxIncludingCollapsed(e[0]);if(!t){return""}var n=this._transformedData.columns[this._transformedData.columnOrder[e[1]]];if(n.fieldKey){return t.getFieldTextValue(n.fieldKey)}else if(n.property){return t.getTextValue(n.property)}},_getBoxData:function(e){var t=this._getBox(e[0]);var n=this._getVisibleColumn(e[1]-2);if(!n){this._delegate.runDataTransforms();return null}var i={};if(n.fieldKey){i=c.Models.BoxField.getSpreadsheetInputOptions(t,n.fieldKey,e,this,this._delegate)}else if(n.property){i.model=t;i.property=n.property;i.type=c.Models.Pipeline.getPropertyType(n.property);if(n.property==="stageKey"){i.list=this._pipeline.getStagesAsListText();if(this.isChecked([e[0],1])){i.models=this.getCheckedBoxes()}else{i.models=[t]}}else if(n.property==="assignedToSharingEntries"){i.type="ASSIGNED_TO";i.existingList=this._pipeline.getAllAssignedToValues()}else if(n.property.indexOf("linkedBoxes")>-1){i.type="LINKED_BOXES"}else if(n.property==="name"&&!t.isSavedOnServer()){i.validator=this._isEmptyBoxName;i.callOnEmptyFunction=this._delegate.runDataTransforms}}else{i=null}return i},_boxAction:function(e){var t=this._getBox(e[0]);if(e[1]===0){if(t.isSavedOnServer()){if(this._areBoxClicksEnabled){r.inboxSDK.Router.goto(t.link())}}return}if(e[1]===1){if(this.isChecked(e)){this._checkedRows.removeVal(e[0])}else{this._checkedRows.push(e[0])}this.notifySelectedBoxesChanged();this._delegate.cellChange(e);return}var n=this._getVisibleColumn(e[1]-2);if(!n.fieldKey){return}var i=this.isChecked(e);var a=t.getFieldModel(n.fieldKey);a.set("value",!i);a.save()},disableBoxClicks:function(){this._areBoxClicksEnabled=false},enableBoxClicks:function(){this._areBoxClicksEnabled=true},_isCoordsEqual:function(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]},_isGroupRow:function(e){return this._groupRows.indexOf(e)>-1},_isGroupRowIncludingCollapsed:function(e){return this._groupRowsIncludingCollapsed.indexOf(e)>-1},_getGroupID:function(e){var t=this._groupRows.indexOf(e);return this._transformedData.groups[t]},_getClosestGroupID:function(e){for(var t=0;t<this._groupRows.length;t++){if(e===this._groupRows[t]){return this._transformedData.groups[t]}else if(e<this._groupRows[t]){return this._transformedData.groups[t-1]}}return n.last(this._transformedData.groups)},_isBoxRow:function(e){var t=this._getBox(e);return!!t},_isBoxRowIncludingCollapsed:function(e){if(e===0){return false}if(this._isGroupRowIncludingCollapsed(e)){return false}var t=this._getBoxIncludingCollapsed(e);return!!t},_getBox:function(e){var t=this._getClosestGroupID(e);var i=-1;for(var r=0;r<this._groupRows.length;r++){if(e<this._groupRows[r]){i=this._groupRows[r-1];break}}if(i===-1){i=n.last(this._groupRows)}var a=e-i-1;var o=this._transformedData.lists[t];if(o){return o.list[a]}return null},_getBoxIncludingCollapsed:function(e){var t=this._getClosestGroupIDIncludingCollapsed(e);var i=-1;for(var r=0;r<this._groupRowsIncludingCollapsed.length;r++){if(e<this._groupRowsIncludingCollapsed[r]){i=this._groupRowsIncludingCollapsed[r-1];break}}if(i===-1){i=n.last(this._groupRowsIncludingCollapsed)}var a=e-i-1;return this._transformedData.lists[t].list[a]},_getClosestGroupIDIncludingCollapsed:function(e){for(var t=0;t<this._groupRowsIncludingCollapsed.length;t++){if(e===this._groupRowsIncludingCollapsed[t]){return this._transformedData.groups[t]}else if(e<this._groupRowsIncludingCollapsed[t]){return this._transformedData.groups[t-1]}}return n.last(this._transformedData.groups)},_getVisibleColumn:function(e){for(var t=0,n=0;t<this._transformedData.columnOrder.length;t++){if(this._transformedData.columns[this._transformedData.columnOrder[t]].isVisible&&!this._transformedData.columns[this._transformedData.columnOrder[t]].notPresent){if(n===e){return this._transformedData.columns[this._transformedData.columnOrder[t]]}n+=1}}},_areAllGroupsClosed:function(){return this._transformedData.areAllGroupsClosed},_areAllGroupsOpen:function(){return this._transformedData.areAllGroupsOpen},_getColumn:function(e){return this._transformedData.columns[this._transformedData.columnOrder[e]]},_getGroup:function(e){return this._transformedData.lists[this._getGroupID(e)]},_isEmptyBoxName:function(e,t){if(t.trim().length>0){return true}c.ButterBarManager.showError(c.Locale.getString("empty_box_name"),{time:5e3})}});i.set("BentoBox.Modules.PipelineTableModel",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;
var d=e.Class.subclass({className:"PipelineNewBox",superclass:e.UI.Delegator,_memberVariables:[{name:"_cursor",destroy:false,set:true},{name:"_pipeline",destroy:false,set:true},{name:"_tableModel",destroy:false,set:true},{name:"_savedViewsController",destroy:false,set:true},{name:"_transformedData",destroy:false,set:true},{name:"_emptyBox",destroy:false},{name:"_emptyBoxGroupID",destroy:false},{name:"_newBoxPosition",destroy:false}],_initialize:function(t,n,i,r){e.UI.Delegator.prototype._initialize.call(this);this._pipeline=t;this._tableModel=n;this._cursor=i;this._savedViewsController=r},startNewBox:function(){this._reset();this._ensureNameColumnIsVisible();this._ensureContainingGroupIsOpen();this._createEmptyBoxModel();this._updateTable();this._bindToEmptyBoxCreation();this._overwriteFieldModelSaves()},_reset:function(){if(this._emptyBoxGroupID||this._emptyBox){var e=this._transformedData.lists[this._emptyBoxGroupID];if(e&&e.list){e.list.removeVal(this._emptyBox)}this._emptyBox=null;this._emptyBoxGroupID=null;this._cursor.setPosition(this._cursor.getPosition())}},_ensureNameColumnIsVisible:function(){var e=c.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.load(this._pipeline);var t=c.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(this._pipeline).data;var i;for(var r=0;r<t.length;r++){i=e.data[t[r]];if(n.isNotReal(i)){i=true}if(t[r]==="property|name"){break}}if(!i){e.data["property|name"]=true;c.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.save(e,this._pipeline);this._delegate.runDataTransforms()}},_ensureContainingGroupIsOpen:function(){var e=c.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings.load(this._pipeline);var t=c.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(this._pipeline).data;var i=-1;var r=0;for(var a=0;a<t.length;a++){var o=e.data[t[a]];if(n.isNotReal(o)){o=true}if(o){i=r;r+=1}if(t[a]==="property|name"){break}}this._newBoxPosition=this._cursor.getPosition();if(this._newBoxPosition[0]===0){this._newBoxPosition[0]=2}else{this._newBoxPosition[0]+=1}this._newBoxPosition[1]=i+2;this._emptyBoxGroupID=this._tableModel.getContainingGroupID([this._newBoxPosition[0]-1,0]);if(!this._transformedData.lists[this._emptyBoxGroupID].isOpen){this._transformedData.lists[this._emptyBoxGroupID].toggleOpen();this._delegate.runDataTransforms();this._ensureContainingGroupIsOpen()}},_createEmptyBoxModel:function(){this._emptyBox=c.Models.Box.create({name:null,notes:null,pipelineKey:this._pipeline.key()});this._emptyBox.set("stageKey",this._pipeline.getStages()[0].key());this._setDefaultValueFromContainingGroup();this._emptyBox.isNewBox=true},_setDefaultValueFromContainingGroup:function(e,t){var i=this._savedViewsController.getGroupBySettings();t=t||this._emptyBoxGroupID;if(!this._emptyBoxGroupID||this._emptyBoxGroupID==="no_value"){return}e=e||this._emptyBox;if(n.contains(i.data,"stageKey")){e.set("stageKey",t)}else if(n.contains(i.data,"field")){var r=i.data.split("|")[1];e.getFieldModel(r).set("value",t)}else{var a=i.data.split("|")[1];if(!c.Models.Pipeline.isPropertyEditable(a)){return}e.set(a,t)}},_updateTable:function(){var e=this._tableModel.getGroupRowIndex(this._emptyBoxGroupID);var t=this._newBoxPosition[0]-e-1;this._transformedData.lists[this._emptyBoxGroupID].list.splice(t,0,this._emptyBox);this._tableModel.reset();this._delegate.redraw();this._delegate.cursorSelect(this._newBoxPosition)},_bindToEmptyBoxCreation:function(){var t=this._emptyBox;var n=t.save;var i=c.Data.getPipelineBoxes(t.getPipeline().key());var r=this;t.save=function(){var a=t.get("name");if(!a){t.set("name",c.Locale.getString("unnamed_box_name"))}var o=n.call(t);t.save=n;i.startTransaction();i.add(t);i.endTransaction(true);c.Data.getAllBoxes().add(t);if(r._emptyBox===t){r._emptyBox=null}r._delegate.newBoxAdded();e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",observer:this,filterParameters:{operationProgressId:o,operationIsComplete:true},functionToCall:function(e){delete t.isNewBox;r._delegate.redraw()},unsubscribeImmediately:true});r._setDefaultValueFromContainingGroup(t);r._waitForBoxSaveAndSaveDefaultValueFromGroup(o,t,r._savedViewsController.getGroupBySettings())}},_overwriteFieldModelSaves:function(){var e=this._emptyBox;var t=e.getFieldModels();n.each(t,function(t){var n=t.save;t.save=function(i,r,a){if(e.isNewBox){e.save()}t.save=n;t.save()}})},_waitForBoxSaveAndSaveDefaultValueFromGroup:function(t,i,r){var a=this._emptyBoxGroupID;if(!a||a==="no_value"){return}e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",observer:this,filterParameters:{operationProgressId:t,operationIsComplete:true},functionToCall:function(e){if(n.contains(r.data,"field")){var t=r.data.split("|")[1];i.getFieldModel(t).save()}else{i.save()}},unsubscribeImmediately:true})}});i.set("BentoBox.Modules.PipelineNewBox",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o,s;o=s={defaults:{newBoxFunc:t.noop,deleteBoxFunc:t.noop,pipeline:null},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n)},_init:function(){if(!this.templates){this.templates={};this.templates.pipelineToolbar=r.get("pipelineToolbar");this.templates.backButton=r.get("pipelineToolbarBackButton");this.templates.deleteBoxButton=r.get("deleteBoxButton");this.templates.addBoxButton=r.get("addBoxButton")}}};var l;var u=function(e,t){a.Tracker.trackStreakActive(l,t,{eventName:e})};s.impl=function(r){var o=r,d=o.pipeline,h=o.feed,f=o.savedViewsController;var p=o.pipelineSpreadsheetViewController;o.trackingContext.widgetContext+="/pipelineToolbar";l=o.trackingContext;var m=t(s.templates.pipelineToolbar()),_=a.Widgets.Button.createGroup(),g=a.Widgets.Button.createGroup(),v=a.Widgets.Button.createGroup(),y=a.Widgets.Button.createGroup(),w=a.Widgets.Button.createGroup(),b=a.Widgets.Button.create({isToggle:false,name:s.templates.backButton(),onFunc:function(){u("backButtonPressed");m.trigger("back");history.back()}}),C=a.Widgets.Button.create({isToggle:false,isRefresh:true,onFunc:function(){a.ButterBarManager.showLoading(a.Locale.getString("notice_loading"),{messageKey:"loadingPipeline"});u("refreshPipelineButtonPressed");d.refresh(function(){var t=a.Data.getPipelineBoxes(d.key()).refresh();e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",filterParameters:{operationProgressId:t,operationIsComplete:true},unsubscribeImmediately:true,functionToCall:function(){p.runDataTransforms();a.ButterBarManager.hideMessage("loadingPipeline")},observer:m})})},trackingContext:n.clone(o.trackingContext)}),S=a.Widgets.Buttons.ButtonFactory.createButton({type:"GmailTextIcon",iconClass:"bbPlus bbIcon newBoxButton",text:a.Locale.getString("new_box"),hasButtonToRight:true,onFunction:function(e){u("newBoxButtonPressed");p.startNewBox();if(e){e.stopPropagation()}}}),T=a.Widgets.Buttons.ButtonFactory.createButton({type:"GmailTextIcon",iconClass:"bbIcon ar9 deleteBoxButton",text:a.Locale.getString("delete_box"),hasButtonToLeft:true,onFunction:function(){var t=p.getCheckedBoxes();u("deleteBoxesAttempted");if(t&&t.length>0){u("deleteBoxesAsked",{boxCount:t.length});a.Widgets.Modal.confirmDelete(t.length+" "+a.Locale.getString(t.length==1?"box":"boxes"),function(){if(t){if(t.length===1){t[0].del()}else if(t.length>1){var n=e.Model.deleteAll(t);c(n)}u("deleteBoxesConfirmed")}},null,function(){u("deleteBoxesCancelled")})}else{u("deleteBoxesFailed",{userFalure:true});a.ButterBarManager.showError(a.Locale.getString("one_box_selected"),{time:5e3})}}}),x=a.Widgets.Buttons.ButtonFactory.createButton({type:"GmailTextIcon",text:a.Locale.getString("reports"),iconClass:"bbIcon streak__reportsIcon",hasButtonToRight:false,onFunction:function(e){u("reportsButtonPressed");i.inboxSDK.Router.goto("pipelinereports/:key",d.key());if(e){e.stopPropagation()}}}),k={pipeline:o.pipeline,pipelineToolBar:m,pipelineSpreadsheetViewController:p},M=a.Modules.PipelineView.SavedViewsButton.create(n.extend(k,{savedViewsController:f,trackingContext:n.clone(o.trackingContext)})),L=a.Modules.PipelineView.MoreButton.create(n.extend(k,{trackingContext:n.clone(o.trackingContext)})),B=a.Modules.PipelineView.ShareButton.create(n.extend(k,{trackingContext:n.clone(o.trackingContext)})),E=a.Modules.PipelineView.ShowHideGroupbarButton.create(n.extend(k,{trackingContext:n.clone(o.trackingContext),hasButtonToRight:true,containerElement:o.containerElement,toggleCallback:function(){p.resize()}})),D=a.Modules.PipelineView.ShowHideFeedButton.create(t.extend({feed:o.feed,isFeedAccessAllowed:a.Services.AccessManager.isAccessAllowed(d,"NewsfeedEntryPIPELINE","GET"),containerElement:o.containerElement,css:{"float":"right",marginRight:"0px"}},k,{trackingContext:n.clone(o.trackingContext)}));k.buttonGroup=[];k.buttonGroup.push(E.el);k.buttonGroup.push(D.getElement());k.buttonGroup.push(B.el);k.buttonGroup.push(L.getElement());k.buttonGroup.push(b.el);var V=a.Modules.PipelineView.FullScreenSpreadsheetButton.create(n.extend(k,{trackingContext:n.clone(o.trackingContext)}));t(S.getElement()).addClass("streak__newBoxOuterButton");t(T.getElement()).addClass("streak__deleteBoxOuterButton");if(!d.getIsEditable()||!a.Services.AccessManager.isAccessAllowed(d,"Pipeline","UPDATE")){S.disable();T.disable()}if(!a.Services.AccessManager.isAccessAllowed(d,"Box","CREATE")){S.disable()}if(!a.Services.AccessManager.isAccessAllowed(d,"Box","DELETE")){T.disable()}if(!a.Services.AccessManager.isAccessAllowed(d,"Report","GET")){x.disable()}if(!a.Services.AccessManager.isAccessAllowed(d,"NewsfeedEntryPIPELINE","GET")){D.disable()}_.el.append(b.el);g.el.append(C.el);v.el.append(S.getElement());y.el.append(T.getElement());w.el.append(M.getElement());w.el.append(x.getElement());w.el.append(L.getElement());m.append(_.el);m.append(g.el);m.append(v.el);m.append(y.el);m.append(w.el);m.append(B.el);m.append(D.getElement());V.button.el.css({"float":"right"});m.append(V.button.el);E.el.css({"float":"right"});m.append(E.el);return{el:m,showFeed:D,getElement:function(){return m},startDeleteBox:function(){T.on()},destroy:function(){e.NotificationCenter.unsubscribe({observer:m});if(!B){return}B.destroy();B=null;V.destroy();V=null;m.remove();m=null;L.destroy();L=null;M.destroy();M=null;b.destroy();b=null;C.destroy();C=null;S.destroy();S=null;T.destroy();T=null;x.destroy();x=null;E.destroy();E=null;D.destroy();D=null;p=null}}};function c(e){a.ButterBarManager.showProgress({initial:"deleting",progressSuccess:"deleted_boxes_status_update",progressError:function(e,t){t.box=n.escape(e.operation.getModel().displayName());return a.Locale.getString("deleted_boxes_error_update",t)},completeSuccess:false,completeError:"deleted_boxes_error",operationProgressId:e})}a.Modules.PipelineView.PipelineToolbar=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={currentVersion:1};var l={load:function(e,t){var n;if(t){n=t.getSortSettings()}if(!n){n=this.create(e)}else{n=this.validateSettings(n,e)}return n},create:function(e){return{data:[],version:s.currentVersion}},validateSettings:function(e,t,n){var i=false;if(e.version!==s.currentVersion){e=this.convertSettings(e,t)}var r=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(t);var a=[];for(var l=0;l<e.data.length;l++){var u=e.data[l].columnKey;var c=u.split("|");if(c.length!==2){continue}if(c[0]==="property"||r[u]){a.push(e.data[l])}else{i=true}}e.data=a;return e},convertSettings:function(e,t){return e}};if(!o.Modules.PipelineView.ViewSettings){o.Modules.PipelineView.ViewSettings={}}o.Modules.PipelineView.ViewSettings.SortSettings=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={currentVersion:3};var l={load:function(e,t){var n;if(t){n=t.getFilterSettings()}if(!n){n=this.create(e)}else{n=this.validateSettings(n,e)}return n},create:function(e){return{filters:["AND",["AND"]],version:s.currentVersion}},validateSettings:function(e,t,i){var r=false;if(e.version!==s.currentVersion){e=this.convertSettings(e,t);r=true}var a=n.map(t.getFields(),function(e){return e.key()});if(n.isReal(e.property)&&e.property==="stageKey"){var o=t.getStage(e.value);if(!n.isReal(o)){r=true}}else{for(var u=1;u<e.filters.length;u++){var c=e.filters[u];for(var d=1;d<c.length;d++){var h=c[d];if(n.isReal(h.fieldKey)&&a.indexOf(h.fieldKey)===-1){r=true;break}}if(r){break}}}if(r){var f=l.create(t);e.filters=f.filters}return e},convertSettings:function(e,t){if(e.version===3){return e}else if(e.version===2&&n.isArray(e.filters)&&e.filters.length>0){var i=l.create(t);i.filters.remove(1);for(var r=0;r<e.filters.length;r++){var a=["AND"];a.push({property:e.filters[r].property,fieldKey:e.filters[r].fieldKey,comparisonOperation:e.filters[r].op,value:null,specificValue:e.filters[r].value});i.filters.push(a)}return i}else{return l.create(t)}}};o.Modules.PipelineView.ViewSettings.FilterSettings=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s={getColumns:function(e){var t=0,n;var i=[];var r=e.getActiveSystemColumns();var a=e.getFields();for(t=0;t<r.length;t++){i.push({columnKey:"property|"+(r[t].uniqueKey||r[t].property),systemColumn:r[t],type:r[t].filterAndGroupType,property:r[t].property})}for(t=0;t<a.length;t++){n="field|"+a[t].key();i.push({columnKey:n,field:a[t],type:a[t].get("type")})}return i},getColumnMap:function(e){var t=this.getColumns(e);var n={};for(var i=0;i<t.length;i++){n[t[i].columnKey]=t[i]}return n},isColumnKeyValid:function(e,t){if(e.indexOf("property")>-1){return true}var n=this.getColumns(t);for(var i=0;i<n.length;i++){if(n[i].columnKey===e){return true}}return false},getColumn:function(e,t){var n=this.getColumns(t);for(var i=0;i<n.length;i++){if(n[i].columnKey===e){return n[i]}}}};e.Library.set("BentoBox.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities",s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettingsUtility;var l={CURRENT_VERSION:1};var u={load:function(e){var t=s.getSharedSetting("columnOrder",e);if(!t){t=this.create(e)}t=this.validate(t,e);return t},save:function(e,t,n){s.setSharedSetting("columnOrder",e,t,n)},create:function(e){var t=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumns(e);var n={data:[],version:1};for(var i=0;i<t.length;i++){n.data.push(t[i].columnKey)}return n},validate:function(e,t){if(e.version!==l.CURRENT_VERSION){e=this.convert(e)}var n=this.create(t).data;var i={};var r=[];for(var a=0;a<n.length;a++){i[n[a]]=true}for(var a=0;a<e.data.length;a++){if(i[e.data[a]]){delete i[e.data[a]]}else{r.push(e.data[a])}}for(var a=0;a<r.length;a++){e.data.removeVal(r[a])}for(var o in i){e.data.push(o)}return e},convert:function(e){return e},addNewColumn:function(e,t,n,i){var r=e.data.indexOf(i);e.data.splice(r+1,0,n);this.save(e,t);return r+1},copyColumnOrder:function(e,t){var n=u.load(e);var i=[];for(var r=0;r<n.data.length;r++){var a=n.data[r];var o=a.split("|");if(o[0]==="field"){var s=o[1];var l=e.getField(s);if(!l){continue}var c=t.getFieldByName(l.displayNameText());i.push("field|"+c.key())}else{var d=o[1];var h=e.getSystemColumn(d);if(!h){continue}var f=t.getSystemColumn(h.property);if(!f){continue}i.push("property|"+(f.uniqueKey||f.property))}}var p=u.create(t);p.data=i;u.save(p,t)}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.ColumnSettings){a.Modules.PipelineView.ViewSettings.ColumnSettings={}}a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=a.Modules.PipelineView.ViewSettingsUtility;var s={CURRENT_VERSION:1};var l={load:function(e){var t=o.getSharedSetting("columnSummary",e);if(!t){t=this.create(e)}else if(t.version!==s.CURRENT_VERSION){t=this.convert(t)}return t},save:function(e,t,n){o.setSharedSetting("columnSummary",e,t,n)},create:function(e){var t={data:{},version:1};return t},convert:function(e){return e}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.ColumnSettings){a.Modules.PipelineView.ViewSettings.ColumnSettings={}}a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSummarySettings=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettingsUtility;var l={CURRENT_VERSION:1};var u={load:function(e){var t=s.getSharedSetting("columnWidth",e);if(!t){t=this.create(e)}else if(t.version!==l.CURRENT_VERSION){t=this.convert(t)}return t},save:function(e,t,n){s.setSharedSetting("columnWidth",e,t,n)},create:function(e){var t={data:{},version:1};return t},convert:function(e){return e}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.ColumnSettings){a.Modules.PipelineView.ViewSettings.ColumnSettings={}}a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnWidthSettings=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettingsUtility;var l={CURRENT_VERSION:1};var u={load:function(e){var t=s.getPrivateSetting("columnVisibility",e);if(!t){t=this.create(e)}else if(t.version!==l.CURRENT_VERSION){t=this.convert(t)}return t},save:function(e,t,n){s.setPrivateSetting("columnVisibility",e,t,n)},create:function(e){var t={data:{},version:1};return t},convert:function(e){return e}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.ColumnSettings){a.Modules.PipelineView.ViewSettings.ColumnSettings={}}a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.BentoBox,r=i.Models.Pipeline;var a={currentVersion:1};var o={load:function(e,t){var n;if(t){n=t.getSummarySettings()}if(!n){n=this.create(e)}else{n=this.validateSettings(n,e)}return n},create:function(e){return{data:{columnKey:"property|name",summaryFunction:"count"},version:a.currentVersion}},validateSettings:function(e,t){if(e.version!==a.currentVersion){e=this.convertSettings(e,t)}var r=i.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(t);if(!e.data||!r[e.data.columnKey]||!n.has(i.ColumnSummary.Functions,e.data.summaryFunction)){e=this.create(t)}return e},convertSettings:function(e,t){return e}};if(!i.Modules.PipelineView.ViewSettings){i.Modules.PipelineView.ViewSettings={}}i.Modules.PipelineView.ViewSettings.PipelineSummarySettings=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={currentVersion:1.5};var l={load:function(e,t){var n;if(t){n=t.getGroupBySettings()}if(!n){n=this.create(e)}else{n=this.validateSettings(n,e)}return n},create:function(e){return{data:"property|stageKey",version:s.currentVersion}},validateSettings:function(e,t,n){if(e.version!==s.currentVersion){e=this.convertSettings(e,t)}if(!o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.isColumnKeyValid(e.data,t)){e=this.create(t)}return e},convertSettings:function(e,t){return e}};if(!o.Modules.PipelineView.ViewSettings){o.Modules.PipelineView.ViewSettings={}}if(!o.Modules.PipelineView.ViewSettings.GroupSettings){o.Modules.PipelineView.ViewSettings.GroupSettings={}}o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettingsUtility;var l={CURRENT_VERSION:1};var u={load:function(e){var t=s.getSharedSetting("groupColors",e);if(!t){t=this.create(e)}t=this.validate(t);return t},save:function(e,t,n){s.setSharedSetting("groupColors",e,t,n)},create:function(e){var t={data:{},version:1};return t},validate:function(e,t){if(e.version!==l.CURRENT_VERSION){e=this.convert(e)}return e},convert:function(e){return e}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.GroupSettings){a.Modules.PipelineView.ViewSettings.GroupSettings={}}a.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettingsUtility;var l={CURRENT_VERSION:1};var u={load:function(e){var t=s.getPrivateSetting("groupOpenClose",e);if(!t){t=this.create(e)}t=this.validate(t);return t},save:function(e,t,n){s.setPrivateSetting("groupOpenClose",e,t,n)},create:function(e){var t={data:{},version:1};return t},validate:function(e,t){if(e.version!==l.CURRENT_VERSION){e=this.convert(e)}return e},convert:function(e){return e}};if(!a.Modules.PipelineView.ViewSettings){a.Modules.PipelineView.ViewSettings={}}if(!a.Modules.PipelineView.ViewSettings.GroupSettings){a.Modules.PipelineView.ViewSettings.GroupSettings={}}a.Modules.PipelineView.ViewSettings.GroupSettings.GroupOpenCloseSettings=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s=function(e,t,i,r){var a=r||o.Modules.PipelineView.ViewSettings.FilterSettings.load(e,i);if(n.isEmpty(a.filters)){return}n.each(t.groups,function(e){t.lists[e].list=n.filter(t.lists[e].list,function(e){return l.checkBoxAgainstFilters(e,a.filters)})})};var l={checkBoxValueAgainstTextFilter:function(e,t){var i=e;var r=t.specificValue;if(n.isNumeric(e)&&n.isNumeric(r)&&t.comparisonOperation!=="contains"&&t.comparisonOperation!=="notContains"){i=parseFloat(e);r=parseFloat(r)}else{i=(i+"").toLowerCase();r=(r+"").toLowerCase()}switch(t.comparisonOperation){case"gt":return i>r;break;case"lt":return i<r;break;case"eq":return i===r;break;case"ne":return i!==r;break;case"contains":return i.indexOf(r)!==-1;break;case"notContains":return i.indexOf(r)===-1;break}},checkBoxValueAgainstDateFilter:function(e,t){var i=a.ccreate(e);var r=i.resetTime();var o=t.specificValue;var s=0;var l=null;if(n.isReal(t.value)&&n.isNotReal(t.specificValue)){o=t.value;var u=o.split(" ");if(u.length===1){o=a.ccreate(o);if(!n.isNumeric(t.value)){o.resetTime()}}else if(u.length===2){var c=u[0];l=u[1];if(c==="last"){s=-1}else if(c==="next"){s=1}o=a.create();switch(l){case"week":o.setWeekday(0);o.addWeeks(s);break;case"month":o.setDate(1);o.addMonths(s);break;case"year":o.setMonth(0);o.setDate(1);o.addYears(s);break}o.resetTime()}else if(u.length===3){var d=u[1];o=a.create();o.resetTime();s=-1;if(u[0]==="next"){s=1}o.addDays(s*d)}}else{o=a.ccreate(o)}switch(t.comparisonOperation){case"before":return i.isBefore(o);break;case"after":return i.isAfter(o);break;case"on":if(n.isReal(l)){var h=o.clone();switch(l){case"day":h.addDays(1);break;case"week":h.addWeeks(1);break;case"month":h.addMonths(1);break;case"year":h.addYears(1);break}return i.isBetweenBeginningInclusive(o,h)}return i.is(o);break}},checkBoxValueAgainstPeopleFilter:function(e,t){var i=e;var r=t.value||t.specificValue;if(n.isString(i)){i=JSON.parse(i)}if(!n.isArray(i)){return true}if(r==="me"){r={fullName:(o.getUser().get("googleProfileFullName")||"").toLowerCase(),email:o.getUser().get("email").toLowerCase()}}else if(r==="__specific"){r=t.specificValue}var a=function(){return n.any(i,function(e){if(n.isArray(r)){return n.any(r,s.bind(null,e))}else{return s(e,r)}})};var s=function(e,t){if(e==null||t==null){return true}if(e==="me"){return t.email===o.getUser().getEmail()}if(t==="me"){return e.email===o.getUser().getEmail()}if(n.isString(e.fullName)&&n.isString(t.fullName)){return e.fullName.toLowerCase()===t.fullName.toLowerCase()}if(n.isString(e.email)&&n.isString(t.email)){return e.email.toLowerCase()===t.email.toLowerCase()}};switch(t.comparisonOperation){case"includes":case"isAny":return a();break;case"doesNotInclude":case"isNotAny":return!a();break;case"isOnly":return i.length<2&&a();break;case"isExactly":if(!i){return false}var l=n.all(i,function(e){if(n.isArray(r)){return n.any(r,s.bind(null,e))}else{return s(e,r)}});if(!l){return false}if(!n.isArray(r)){return true}return n.all(r,function(e){return n.any(i,s.bind(null,e))});break;case"contains":return this._boxValueContainsPerson(i,r);break;case"notContains":return!this._boxValueContainsPerson(i,r);break}},_boxValueContainsPerson:function(e,t){return n.any(e,function(e){return!n.isEmpty(e.fullName)&&this._containsIgnoreCase(e.fullName,t)||!n.isEmpty(e.email)&&this._containsIgnoreCase(e.email,t)},this)},checkBoxValueAgainstStageFilter:function(e,t){var i=e.get("stageKey");var r=t.value;switch(t.comparisonOperation){case"isAny":return r.indexOf(i)!==-1;break;case"isNotAny":return r.indexOf(i)===-1;break}var a=e.getPipeline();var o=e.getPipeline().getStages();var s=e.getStage();var l=o.indexOf(s);var u;if(!n.isArray(t.value)){if(n.isReal(t.specificValue)){r=t.specificValue.toLowerCase()}else if(n.isReal(t.value)){r=t.value.toLowerCase()}u=o.indexOf(a.getStage(r))}switch(t.comparisonOperation){case"gt":return l>u;break;case"lt":return l<u;break;case"eq":return s.key()===r;break;case"ne":return s.key()!==r;break;case"contains":return s.displayName().toLowerCase().indexOf(r)!==-1;break;case"notContains":return s.displayName().toLowerCase().indexOf(r)===-1;break}},checkBoxValueAgainstDropdownFilter:function(e,t,n){var i=t.value||t.specificValue;switch(t.comparisonOperation){case"isAny":return i.indexOf(e)!==-1;break;case"isNotAny":return i.indexOf(e)===-1;break;case"eq":return e===i;break;case"ne":return e!==i;break;case"contains":return this._dropdownFieldContainsString(e,t,n);break;case"notContains":return!this._dropdownFieldContainsString(e,t,n);break}},_dropdownFieldContainsString:function(e,t,n){var i=t.value||t.specificValue;var r=n.getPipeline().getField(t.fieldKey);var a=r.getOption(e);return a&&a.name&&this._containsIgnoreCase(a.name,i)},checkBoxValueAgainstTagFilter:function(e,t,i){var r=e;var a=t.value||t.specificValue;switch(t.comparisonOperation){case"isAny":return n.isReal(r)&&s();break;case"isNotAny":return n.isNotReal(r)||!s();break;case"isExactly":if(!r){return false}if(r.length===0){return a===0}return n.all(r,function(e){return a.indexOf(e)!==-1});break;case"includes":return s();break;case"doesNotInclude":return!s();break;case"isOnly":return r&&r.length===1&&s();break;case"contains":var o=i.getFieldTextValue(t.fieldKey);return o.indexOf(a)!==-1;break;case"notContains":var o=i.getFieldTextValue(t.fieldKey);return o.indexOf(a)===-1;break}function s(){return n.any(r,function(e){if(a==null){return true}if(n.isArray(a)){return a.indexOf(e)!==-1}else{return a===e}})}},checkBoxAgainstFilter:function(e,t){var i;var r=t.columnType;if(n.isReal(t.property)){i=e.getFilterValue(t.property);r=r||o.Models.Pipeline.getPropertyFilterAndGroupType(t.property)}else if(n.isReal(t.fieldKey)){r=r||e.getPipeline().getField(t.fieldKey).get("type");i=e.getFieldFilterValue(t.fieldKey,r)}else{return true}if(t.comparisonOperation==="isSet"){return n.isReal(i)&&(!n.isString(i)&&!n.isArray(i)||!n.isEmpty(i))}else if(t.comparisonOperation==="notSet"){return!n.isReal(i)||(n.isString(i)||n.isArray(i))&&n.isEmpty(i)}else if(t.comparisonOperation==="isChecked"){if(n.isReal(i)){return i===true}}else if(t.comparisonOperation==="isUnchecked"){return!!i===false}else if(t.comparisonOperation==="isTrue"){return i===true}else if(t.comparisonOperation==="isFalse"){return i===false}else if(!this._isUseableValue(t.value)&&!this._isUseableValue(t.specificValue)){return true}if(!this._isUseableValue(i)&&r!=="TAG"){return false}if(n.isReal(t.property)&&t.property==="stageKey"){return this.checkBoxValueAgainstStageFilter(e,t)}switch(r){case"TEXT":case"TEXT_INPUT":case"NUMBER":case"BASIC_TEXT":return this.checkBoxValueAgainstTextFilter(i,t);break;case"DATE":return this.checkBoxValueAgainstDateFilter(i,t);break;case"PERSON":return this.checkBoxValueAgainstPeopleFilter(i,t);break;case"DROPDOWN":return this.checkBoxValueAgainstDropdownFilter(i,t,e);break;case"TAG":return this.checkBoxValueAgainstTagFilter(i,t,e);break}return true},checkBoxAgainstFilters:function(e,t){var i=this;if(n.isEmpty(t)){return true}else{if(n.isString(t[0])){var r=t[0];var a=n.rest(t);var s=[];n.each(a,function(t){if(n.isArray(t)){s.push(i.checkBoxAgainstFilters(e,t))}else if(n.isObject(t)){s.push(i.checkBoxAgainstFilter(e,t))}});if(r==="AND"){return n.all(s,n.identity)}else if(r==="OR"){return n.any(s,n.identity)}else if(r==="NONE"){return!n.any(s,n.identity)}}else if(n.isObject(t[0])){try{return i.checkBoxAgainstFilter(e,t[0])}catch(l){o.logError("Error in running filter",l)}return true}}},_isUseableValue:function(e){return n.isReal(e)&&e.length!==0},_containsIgnoreCase:function(e,t){return e.toLowerCase().indexOf(t.toLowerCase())!==-1}};o.Modules.PipelineTransformRegister.register(s,1,"filterTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s=function(e,t,i,r){var a=r||o.Modules.PipelineView.ViewSettings.SortSettings.load(e,i);var s=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);var u=[];for(var c=0;c<a.data.length;c++){var d=s[a.data[c].columnKey];if(!d){continue}var h={sort:a.data[c].sort};if(n.isReal(d.field)){h.fieldKey=d.field.key()}else if(n.isReal(d.systemColumn)){h.property=d.systemColumn.property}u.push(h)}for(var c=0;c<t.groups.length;c++){var f=t.groups[c];if(t.lists[f]&&t.lists[f].list){l(u,t.lists[f].list,e)}}};var l=function(e,t,i){var r={};t.sort(function(t,i){for(var a=0;a<e.length;a++){var o,s;var l=e[a];if(l.property){if(!r[l.property]){r[l.property]={}}if(r[l.property][t.getId()]){o=r[l.property][t.getId()]}else{o=t.getSortValue(l.property);r[l.property][t.getId()]=o}if(r[l.property][i.getId()]){s=r[l.property][i.getId()]}else{s=i.getSortValue(l.property);r[l.property][i.getId()]=s}}else if(l.fieldKey){if(!r[l.fieldKey]){r[l.fieldKey]={}}if(r[l.fieldKey][t.getId()]){o=r[l.fieldKey][t.getId()]}else{o=t.getFieldSortValue(l.fieldKey);r[l.fieldKey][t.getId()]=o}if(r[l.fieldKey][i.getId()]){s=r[l.fieldKey][i.getId()]}else{s=i.getFieldSortValue(l.fieldKey);r[l.fieldKey][i.getId()]=s}}if(o!==s){var u=0;if(n.isNumeric(o)&&n.isNumeric(s)){u=parseFloat(o)-parseFloat(s)}else if(n.isArray(o)&&n.isArray(s)){var c;for(c=0;c<o.length;c++){if(o[c]===s[c]){continue}else{break}}if(o.length===c){u=0}else{u=o[c]-s[c]}}else if(!o||o===""){u=1}else if(!s||s===""){u=-1}else if(n.isString(o)&&n.isString(s)){o=o.toLowerCase();s=s.toLowerCase();u=(o>s)-(o<s)}return l.sort==="DESC"?-1*u:u}}})};o.Modules.PipelineTransformRegister.register(s,2,"sortTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings;var l=function(e,t,i){var r=s.load(e);var o=r.data;var l=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);n.each(o,function(a,u){var c=l[a];t.columns[a]={};t.columns[a].moveLeft=function(){var n;for(n=u-1;n>-1;n--){if(t.columns[o[n]].isVisible){break}}if(u>0&&n>-1){o.removeVal(a);o.splice(n,0,a);s.save(r,e);i.trigger("transformSettingsChanged")}};t.columns[a].moveRight=function(){var n;for(n=u+1;n<o.length;n++){if(t.columns[o[n]].isVisible){break}}if(n>0&&n<o.length){o.removeVal(a);o.splice(n,0,a);s.save(r,e);i.trigger("transformSettingsChanged")}};t.columns[a].setNewIndex=function(n,i){var l;var c;for(l=0,c=0;l<o.length;l++){if(t.columns[o[l]].isVisible){if(c===n){break}c++}}if(i){l+=1}if(l!==u){if(l>u){l=l-1}o.removeVal(a);o.splice(Math.max(l,0),0,a);s.save(r,e)}};t.columns[a].isFirst=u===0;t.columns[a].isLast=u===o.length-1;if(n.isReal(c.systemColumn)){t.columns[a].property=c.systemColumn.property}else{t.columns[a].fieldKey=c.field.key()}});t.columnOrder=o};a.Modules.PipelineTransformRegister.register(l,1)
})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t,i){var r=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);var o=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.load(e);n.each(t.columns,function(n,s){var l=r[s];if(l.systemColumn){n.isRemovable=!l.systemColumn.isDefault}else{n.isDeletable=true}n.remove=function(t){if(n.isRemovable||n.isDeletable){if(l.systemColumn){e.removeSystemColumn(l.systemColumn)}else{e.removeField(l.field.key())}o.data.removeVal(s)}if(i){i.trigger("transformSettingsChanged")}a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.save(o,e)};n.addSystemColumn=function(t,n){var r="property|"+e.addSystemColumn(t);var l=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.addNewColumn(o,e,r,s);if(n){n(l)}if(i){i.trigger("transformSettingsChanged")}};n.addCustomColumn=function(n){var r=e.getFields().map(function(e){return e.displayName()});var l=t.columnOrder.length;var u="Column "+l;while(l<100){if(r.indexOf(u)===-1){break}l++;u="Column "+l}var c=a.Models.PipelineField.create({name:u,type:n,pipelineKey:e.key()},e);e.addField(c,function(){var t="field|"+c.key();var n=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnOrderSettings.addNewColumn(o,e,t,s);if(i){i.trigger("transformSettingsChanged");i.trigger("selectColumnHeader",t)}})};n.columnKey=s})};a.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t){var i=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);n.each(t.columns,function(t,r){var o=i[r];t.isEditable=true;t.isRenameable=true;if(o.systemColumn){t.isEditable=a.Models.Pipeline.isPropertyEditable(o.systemColumn.property);t.isRenameable=false}else if(o.field){var s=o.field.key();n.extend(t,a.Models.BoxField.getColumnEditStatusTransformOptions(e,s))}if(!a.Services.AccessManager.arePermissionsAllowed(e,[{entityType:"Pipeline",action:"UPDATE"},{entityType:"FieldPipeline",action:"UPDATE"}])){t.isRenameable=false}if(!e.getIsEditable()){t.isEditable=false;t.isRenameable=false}if(!a.Services.AccessManager.isAccessAllowed(e,"Box","UPDATE")){t.isEditable=false}})};a.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t,i){var r=a.Modules.PipelineView.ViewSettings.FilterSettings.load(e,i);var o=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);n.each(t.columns,function(e,t){var a=o[t];e.canFilterByContains=function(){return a.type==="TEXT"||a.type==="TEXT_INPUT"||a.type==="PERSON"||a.type==="STAGE"};e.clearFilter=function(){var e=l(a,r.filters);var t=null;if(e.length===1){var o=e[0];for(var s=1;s<filterSetting.filters.length;s++){var u=r.filters[s];var c=u.indexOf(o);if(c>-1){u.removeVal(o);t=u;break}}if(n.isArray(t)&&t.length===1){r.filters.removeVal(t);r.filters.push(["AND"]);i.setFilterSettings(r)}}};e.setContainsFilter=function(e){var t={comparisonOperation:"contains",value:null,specificValue:e};if(n.isReal(a.systemColumn)){t.property=a.systemColumn.property}else if(n.isReal(a.field)){t.fieldKey=a.field.key()}if(r.filters.length===2&&r.filters[1].length===1){r.filters[1].push(t)}else{var o=l(a,r.filters);if(o.length===1){o[0].comparisonOperation="contains";o[0].value=null;o[0].specificValue=e}else if(o.length===0){r.filters.push(["AND",t])}}i.setFilterSettings(r)};e.setAdvancedFilter=function(){var e={comparisonOperation:null,value:null,specificValue:null};if(n.isReal(a.systemColumn)){e.property=a.systemColumn.property}else if(n.isReal(a.field)){e.fieldKey=a.field.key()}if(r.filters.length===2&&r.filters[1].length===1){r.filters[1].push(e)}else{r.filters.push(["AND",e])}i.setFilterSettings(r);i.trigger("openSavedViewsEditArea")};e.isAdvancedFiltered=function(){var e=l(a,r.filters);if(e.length>1){return true}else if(e.length===1){return e[0].comparisonOperation!=="contains"}else{return false}};e.getContainsFilter=function(){var e=0;var t=l(a,r.filters);if(t.length>1){return null}else if(t.length===1&&t[0].comparisonOperation==="contains"){return t[0].specificValue}return null}})};var l=function(e,t){var i=[];var r={};if(n.isReal(e.systemColumn)){r.property=e.systemColumn.property}else if(n.isReal(e.field)){r.fieldKey=e.field.key()}for(var a=1;a<t.length;a++){var o=t[a];if(n.isArray(o)){for(var s=1;s<o.length;s++){var l=o[s];if(n.isObject(l)){if(l.property===r.property&&n.isReal(l.property)||l.fieldKey===r.fieldKey&&n.isReal(l.fieldKey)){i.push(l)}}}}}return i};a.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t,i){var r=a.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);var o=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);var s=null;if(r.data.indexOf("property")>-1){var l=e.getSystemColumn(r.data.split("|")[1]);if(l){s=l.property}}n.each(t.columns,function(t,n){var a=o[n];t.isGroupedBy=function(){if(n.indexOf("property")>-1){return s===e.getSystemColumn(n.split("|")[1]).property}else{return n===r.data}};t.isDateColumn=function(){return a.type==="DATE"};t.getGranularity=function(){return r.granularity};t.setGroupBy=function(e){r.data=n;r.granularity=e;i.setGroupBySettings(r)};t.unGroupBy=function(){r.data="property|stageKey";r.granularity=null;i.setGroupBySettings(r)}})};a.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t){var i=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);n.each(t.columns,function(e,t){var r=i[t];if(n.isReal(r.field)){e.isRenameable=true;e.getField=function(){return r.field}}e.getName=function(){if(n.isReal(r.field)){return r.field.displayNameText()}else if(n.isReal(r.systemColumn)){return o.getPropertyName(r.systemColumn.property)}}})};a.Modules.PipelineTransformRegister.register(s,9)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline;var s=function(e,t,i){var r=a.Modules.PipelineView.ViewSettings.SortSettings.load(e,i);var o=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);var s={};for(var l=0;l<r.data.length;l++){s[r.data[l].columnKey]=r.data[l]}n.each(t.columns,function(e,t){var a=o[t];var l=s[t];if(n.isReal(l)){e.sort=l.sort}e.changeSort=function(e){if(e==="NONE"){if(n.isReal(l)){r.data.removeVal(l)}}else{if(n.isReal(l)){l.sort=e}else{r.data.unshift({columnKey:t,sort:e})}}i.setSortSettings(r)};if(a.systemColumn){e.property=a.systemColumn.property}else if(a.field){e.fieldKey=a.field.key()}})};a.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSummarySettings;var s=a.Models.Pipeline;var l=function(e,t,i){var r=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(e);var s=o.load(e);n.each(t.columns,function(t,i){var l=r[i];var u=s.data[i];var c;if(l.systemColumn&&l.systemColumn.summaryType){c=l.systemColumn.summaryType}else if(l.type&&n.has(a.ColumnSummary.FieldTypesToListTypes,l.type)){c=a.ColumnSummary.FieldTypesToListTypes[l.type]}else{c="BASIC"}if(n.has(a.ColumnSummary.ListTypes,c)){t.summaryFunctions=a.ColumnSummary.ListTypes[c];if(u&&n.has(a.ColumnSummary.Functions,u.summaryFunction)){t.chosenSummaryFunction=u.summaryFunction}}else{t.summaryFunctions=[]}if(t.summaryFunctions.length!==0){t.isSummarizable=true;t.setSummaryFunction=function(t){s.data[i]={summaryFunction:t};o.save(s,e)}}t.columnKey=i})};a.Modules.PipelineTransformRegister.register(l,9)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnVisibilitySettings;var l=function(e,t,i){var r=s.load(e);var o=r.data;n.each(t.columns,function(l,u){if(n.isReal(o[u])){l.isVisible=o[u]}else{l.isVisible=true}if(l.property&&l.property.indexOf("linkedBoxes")>-1){var c=l.property.split(".");if(c.length>1){var d=c[1];var h=a.Data.getPipeline(d);l.notPresent=!h}}l.hide=function(){o[u]=false;s.save(r,e);i.trigger("transformSettingsChanged")};l.show=function(){var n=t.columnOrder.indexOf(u);for(var i=n;i>-1;i--){var a=t.columnOrder[i];if(t.columns[a].isVisible){break}else{o[a]=true}}for(i=n+1;i<t.columnOrder.length;i++){var a=t.columnOrder[i];if(t.columns[a].isVisible){break}else{o[a]=true}}s.save(r,e)}})};a.Modules.PipelineTransformRegister.register(l)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.BentoBox.Models.Pipeline,s=a.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnWidthSettings;var l=function(e,t,i){var r=s.load(e);var a=r.data;n.each(t.columns,function(t,n){t.width=Math.round(a[n]);t.setWidth=function(e){a[n]=e;t.width=e;i.trigger("widthChange")};t.saveWidth=function(){i.disableTriggerOnUISettingsSet();s.save(r,e);i.enableTriggerOnUISettingsSet()}})};a.Modules.PipelineTransformRegister.register(l)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s=function(e,t,i,r){var s=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);var u=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumn(s.data,e);if(!u){u={systemColumn:o.Models.Pipeline.getSystemProperty(s.data.split("|")[1])}}var c=n(t.lists).chain().values().pluck("list").flatten().groupByPlus(function(e){if(u.systemColumn){if(u.systemColumn.property==="stageKey"){return e.get("stageKey")}var t=e.getGroupByValue(u.systemColumn.property);if(u.systemColumn.type!=="DATE"){return t}return[l(t[0],s.granularity)]}else if(u.field){return o.Models.BoxField.getGroupByValue(e,u.field.key(),s.granularity)}}).value();t.lists={};t.groupMeta={canEdit:s.data==="property|stageKey"&&e.getIsEditable()&&o.Services.AccessManager.isAccessAllowed(e,"Stage","UPDATE"),isStage:s.data==="property|stageKey"};if(s.data==="property|stageKey"){var d=n.map(e.getStages(),function(e){return e.key()});for(var h=0;h<d.length;h++){t.lists[d[h]]={list:c[d[h]]||[]}}}else{for(var f in c){t.lists[f]={list:c[f]}}}if(u.systemColumn&&u.systemColumn.property==="stageKey"){t.groups=n.map(e.getStages(),function(e){return e.key()})}else{var p=u.type;if(!p){if(u.systemColumn){p=u.systemColumn.filterAndGroupType}}t.groups=n.keys(t.lists).sort(function(e,t){if(p==="DATE"){e=e==="no_value"?Infinity:a.ccreate(e).getTime();t=t==="no_value"?Infinity:a.ccreate(t).getTime()}var n=Number(e);var i=Number(t);if(!isNaN(n)&&!isNaN(i)){return n-i}return(""+e).localeCompare(t)})}};function l(t,n){return e.moment(t).startOf(n).toDate()}o.Modules.PipelineTransformRegister.register(s,1,"groupByTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={COLORS:["#FA573C","#FFAD46","#B3DC6C","#16A765","#9FC6E7","#4986E7","#7BD148","#F83A22","#AC725E","#92E1C0","#42D692","#D06B64","#FAD165","#FF7537","#9FE1E7"]};var l=function(e,t,i,r){var a=o.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings.load(e);var s=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);if(n.isNotReal(a.data[s.data])){a.data[s.data]={}}var l=a.data[s.data];var c=0;n.each(t.lists,function(t,i){if(n.isReal(l[i])){t.color=l[i]}else{t.color={backgroundColor:u(c,l),textColor:"white"}}t.changeColor=function(t){l[i]=t;o.Modules.PipelineView.ViewSettings.GroupSettings.GroupColorSettings.save(a,e)};c++});if(s.data==="property|stageKey"){t.groupMeta.nextColor=u(t.groups.length,l)}};var u=function(e,t){var i=n.pluck(n.values(t),"backgroundColor");var r=s.COLORS.length;var a=i.length;for(var o=e;o<100;o++){var l=s.COLORS[o%s.COLORS.length];var u=i.indexOf(l);if(u===-1){return l}if(Math.abs(e-u)>10){return l}}return s.COLORS[Number.random(0,s.COLORS.length-1)]};o.Modules.PipelineTransformRegister.register(l,11,"groupByTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox,s=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities;var l=o.Models.Pipeline;var u=function(e,t,i,r){var s=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);n.each(t.lists,function(t,i){t.displayName=l;t.displayNameHTML=l;t.displayNameText=r;t.getSearchValue=function(e){if(e==="property|name"){return l()}return t.getValue(e)};function r(){if(s.data==="property|stageKey"){var t=e.getStage(i);if(t){return t.displayNameText()}}else if(s.data.indexOf("property")>-1){var n=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumn(s.data,e);if(!n){n={systemColumn:o.Models.Pipeline.getSystemProperty(s.data.split("|")[1])}}var r=n.systemColumn.type;switch(r){case"DATE":var l=a.create(i);if(l.isValid()){return c(l,s.granularity)}break;default:return i}}else if(s.data.indexOf("field")>-1){var u=s.data.split("|")[1];return o.Models.BoxField.getGroupByDisplayTextValue(i,e,u,s.granularity)}return"No Value"}function l(){return n.escape(r())}})};function c(t,n){var i=e.moment(t);switch(n){case"DAY":case"WEEK":return t.prettyDate(true);break;case"MONTH":return i.format("MMMM YYYY");break;case"QUARTER":return"Q"+i.format("Q YYYY");break;case"YEAR":return i.format("YYYY");break}}o.Modules.PipelineTransformRegister.register(u,10,"groupByTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox,s=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities;var l=function(e,t,i,r){var a=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);n.each(t.lists,function(t,n){if(a.data==="property|stageKey"){t.groupModel=e.getStage(n)}t.isPotentialValueValid=function(t,n){if(a.data!=="property|stageKey"){return true}if(t.displayName()===n){return true}if(n.trim().length===0){o.ButterBarManager.showError(o.Locale.getString("empty_stage_name"),{time:5e3});return false}var i=e.getStageNamesText();if(i.indexOf(n)>-1){o.ButterBarManager.showError(o.Locale.getString("same_stage_name"),{time:5e3});return false}return true}})};o.Modules.PipelineTransformRegister.register(l,10,"groupByTransform")})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox,s=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities;var l=o.Models.Pipeline;var u=function(e,t,i,r){var a=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);var s=c(t,e);n.each(t.lists,function(i,r){i.getHTMLValue=function(e){var i=t.columns[e];if(i.isSummarizable){var a="";if(i.chosenSummaryFunction){a+='<span class="streak__group_summary_value">';var l=s[r][e];a+=n.escape(l);a+="</span>";a+='<span class="streak__group_summary_link summaryActive">';a+='<span class="streak__group_summary_label">';a+=n.escape(o.ColumnSummary.getLocalizedName(i.chosenSummaryFunction));a+="</span>";a+='<span class="streak__group_summary_button">▾<span>';a+="</span>"}else{a+='<span class="streak__group_summary_link">';a+='<span class="streak__group_summary_label">';a+=n.escape(o.Locale.getString("summary_heading"));a+="</span>";a+='<span class="streak__group_summary_button">▾<span>';a+="</span>"}return a}return""};i.updateSummaryValues=function(){d(r,s,t,e)}})};function c(e,t){var n={};for(var i in e.lists){d(i,n,e,t)}return n}function d(e,t,n,i){var r={};for(var a in n.columns){var o=n.columns[a];if(!o.isSummarizable){r[a]=""}else if(o.chosenSummaryFunction){r[a]=h(o.chosenSummaryFunction,n.lists[e],o,i)}}t[e]=r}function h(e,t,n,i){var r=f(t,n);var a=o.Modules.PipelineView.ViewSettings.ColumnSettings.ColumnSettingsUtilities.getColumnMap(i)[n.columnKey];return o.ColumnSummary.Functions[e](r,a.type,i,n.fieldKey)}function f(e,t){return n.map(e.list,function(e){if(t.property){return e.get(t.property)}else{return e.getFieldValue(t.getField().key())}})}o.Modules.PipelineTransformRegister.register(u,10)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s=function(e,t,i,r){var a=r||o.Modules.PipelineView.ViewSettings.GroupSettings.GroupOpenCloseSettings.load(e);var s=o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings.load(e,i);if(a.data.columnKey!==s.data){a.data.openStatus={}}a.data.columnKey=s.data;var l=true;var u=true;n.each(t.lists,function(t,i){if(n.isReal(a.data.openStatus[i])){t.isOpen=a.data.openStatus[i]}else{t.isOpen=true}l=l&&t.isOpen;u=u&&!t.isOpen;t.toggleOpen=function(t,r){if(n.isNotReal(t)){if(n.isReal(a.data.openStatus[i])){t=!a.data.openStatus[i]}else{t=false}}a.data.openStatus[i]=t;o.Modules.PipelineView.ViewSettings.GroupSettings.GroupOpenCloseSettings.save(a,e,r)}});t.areAllGroupsOpen=l;t.areAllGroupsClosed=u};o.Modules.PipelineTransformRegister.register(s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox,s=o.Modules.PipelineView.ViewSettings.FilterSettings,l=o.Modules.PipelineView.ViewSettings.SortSettings,u=o.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings;var c=false;var d={};var h={};function f(){if(!c){h.container=a.get("savedViewsEditArea")();h.filterSection=a.get("savedViewsFilterSection")();h.advancedSection=a.get("savedViewsAdvancedSection")();c=true}}var p=function(e){f();this.unbindFunctions=[];this.options=e;this.pipeline=e.pipeline;this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/savedViewsEditArea";this.containerElement=t(h.container);this.filterContainer=t(h.filterSection);this.advancedContainer=t(h.advancedSection);this.savedViewsController=e.savedViewsController;this.filterBar=null;this.sortByBar=null;this.groupByBar=null;this.filterCollapse=null;this.advancedCollapse=null;this.createSections();this.createButtons();this.setupBindings();this.containerElement.hide()};p.create=function(e){var n={};t.extend(n,d,e);return new p(n)};n.extend(p.prototype,{getElement:function(){return this.containerElement},createSections:function(){var e=this;this.filterBar=o.Modules.PipelineView.SavedViewsEditArea.FilterBar.create({pipeline:this.pipeline,trackingContext:n.clone(this.trackingContext)});this.filterContainer.find(".savedViewsFilters").append(this.filterBar.containerElement);this.filterCollapse=o.Widgets.CollapseSection.create({title:o.Locale.getString("saved_views_filters"),bodyEl:this.filterContainer,startOpen:true});this.containerElement.find(".savedViewsEditAreaInner").append(this.filterCollapse.el);this.sortByBar=o.Modules.PipelineView.SavedViewsEditArea.SortByBar.create({pipeline:this.pipeline,trackingContext:n.clone(this.trackingContext)});this.groupByBar=o.Modules.PipelineView.SavedViewsEditArea.GroupByBar.create({pipeline:this.pipeline,trackingContext:n.clone(this.trackingContext)});this.advancedContainer.find(".savedViewsSortBy").append(this.sortByBar.containerElement);this.advancedContainer.find(".savedViewsGroupBy").append(this.groupByBar.containerElement);this.advancedCollapse=o.Widgets.CollapseSection.create({title:o.Locale.getString("saved_views_advanced"),bodyEl:this.advancedContainer,startOpen:false});this.containerElement.find(".savedViewsEditAreaInner").append(this.advancedCollapse.el)},createButtons:function(){var e=this;this.buttons={};this.buttons.saveButton=o.Widgets.Button.create({name:o.Locale.getString("saved_views_apply_and_save"),color:"blue",tabIndex:0,onFunc:this.saveView.bind(this)});this.buttons.saveButton.el.addClass("streak__savedViewsSaveButton");if(!o.Services.AccessManager.isAccessAllowed(this.pipeline,"Pipeline","UPDATE")){this.buttons.saveButton.disable()}this.buttons.cancelButton=o.Widgets.Button.create({name:o.Locale.getString("cancel").capitalize(),tabIndex:0,onFunc:function(){e.updateDisplay();e.savedViewsController.trigger("closeSavedViewsEditArea")}});this.buttons.applyButton=o.Widgets.Button.create({name:o.Locale.getString("apply"),color:"blue",tabIndex:0,onFunc:this.applySettings.bind(this)});this.buttons.applyButton.el.addClass("streak__savedViewsApplyButton");var t=this.containerElement.find(".savedViewsActionButtons");t.append(this.buttons.saveButton.el);t.append(this.buttons.applyButton.el);t.append(this.buttons.cancelButton.el)},setupBindings:function(){var e=this;this.savedViewsController.bind("transformSettingsChanged",this.updateDisplay.bind(this));this.savedViewsController.bind("openSavedViewsEditArea",this.expandArea.bind(this));this.savedViewsController.bind("closeSavedViewsEditArea",this.collapseArea.bind(this));this.savedViewsController.bind("toggleSavedViewsEditArea",this.toggleArea.bind(this))},firstRender:function(){var e=this.savedViewsController.getCurrentSettingsState();this.firstLoaded=true;if(e.isDefaultSettingsActive){this.containerElement.hide()}else{this.containerElement.show();this.collapseArea()}},updateDisplay:function(){var e=this.savedViewsController.getCurrentSettingsState();var t=this.filterCollapse.isOpen();var n=this.advancedCollapse.isOpen();this.filterCollapse.toggle(true);this.advancedCollapse.toggle(true);this.filterBar.updateDisplay(JSON.deepClone(e.filterSettings.filters));this.sortByBar.updateDisplay(JSON.deepClone(e.listOfSortedColumns));this.groupByBar.updateDisplay(e.groupBySetting,e.groupByGranularity);this.filterCollapse.toggle(t);this.advancedCollapse.toggle(n);this.buttons.applyButton.el.hide();this.buttons.saveButton.el.hide();if(e.isASavedViewActive){this.buttons.saveButton.el.fastShow("inline-block")}else{this.buttons.applyButton.el.show()}},collapseArea:function(){this.containerElement.hide();this.savedViewsController.trigger("savedViewsEditAreaChanged")},expandArea:function(){this.containerElement.show();this.updateDisplay();this.savedViewsController.trigger("savedViewsEditAreaChanged")},toggleArea:function(){if(this.isAreaOpen()){this.collapseArea()}else{this.expandArea()}},isAreaOpen:function(){return this.containerElement.is(":FastVisible")},toggleContainer:function(){if(!this.firstLoaded){return}this.toggleArea()},openContainer:function(){if(!this.firstLoaded){return}if(!this.containerElement.is(":FastVisible")){this.expandArea()}},applySettings:function(){this.savedViewsController.trigger("closeSavedViewsEditArea");this.savedViewsController.applyViewSettings(this.getSettings())},saveView:function(){this.savedViewsController.trigger("closeSavedViewsEditArea");this.savedViewsController.updateActiveViewWithNewSettings(this.getSettings())},createNewView:function(){var e=this;e.track("createSavedViewAttempt");o.Widgets.Modal.textboxModal({title:o.Locale.getString("saved_view_create_modal_title"),placeholderText:o.Locale.getString("Set the name of the new view"),callback:function(t){e.track("createSavedViewSuccess");e.savedViewsController.saveSettingsAsView(t,e.getSettings())}})},clearSettings:function(){this.savedViewsController.setToDefaultView()},getSettings:function(){var e=l.create(this.pipeline);var t=s.create(this.pipeline);var i=u.create(this.pipeline);t.filters=this.filterBar.getStatus();e.data=this.sortByBar.getStatus();n.extend(i,this.groupByBar.getStatus());var r=this.savedViewsController.getSummarySettings();return{filterSettings:t,sortSettings:e,groupBySettings:i,summarySettings:r}},destroy:function(){this.unbindFunctions.forEach(function(e){e()});this.unbindFunctions=null;this.containerElement.remove();this.containerElement=null;this.filterContainer.remove();this.filterContainer=null;this.advancedContainer.remove();this.advancedContainer=null;this.filterBar.destroy();this.filterBar=null;this.filterCollapse.destroy();this.filterCollapse=null;this.sortByBar.destroy();this.sortByBar=null;this.groupByBar.destroy();this.groupByBar=null;this.advancedCollapse.destroy();this.advancedCollapse=null;this.options=null;this.pipeline=null},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}});o.Modules.PipelineView.SavedViewsEditArea=p})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s={};o.Modules.PipelineView.SavedViewsEditArea.FilterBar=function(e){var t=this;this.options=e;this.pipeline=e.pipeline;this.containerElement=a.get("filterBarContainer",true);this.filterGroupViews=[];this.filterBarContents=this.containerElement.find(".filterBarContents");this.filterGroupList=this.containerElement.find(".filterGroupList");this.filterBarConnectors=this.containerElement.find(".filterBarConnectors");this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/filterBar";this.settings=null;this.joiningOperator=null};o.Modules.PipelineView.SavedViewsEditArea.FilterBar.create=function(e){var n={};t.extend(n,s,e);return new o.Modules.PipelineView.SavedViewsEditArea.FilterBar(n)};n.extend(o.Modules.PipelineView.SavedViewsEditArea.FilterBar.prototype,{updateDisplay:function(e){this.settings=e||this.settings;this.filterGroupViews.length=0;this.filterGroupList.empty();this.containerElement.removeClass("multipleFilterGroups");this.joiningOperator=this.settings[0];for(var t=1;t<this.settings.length;t++){this.addFilterGroup(this.settings[t],t,t===this.settings.length-1)}this.addConnectors()},addFilterGroup:function(e,t,i){var r=this;var a=new o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatementGroup({pipeline:this.pipeline,trackingContext:n.clone(this.trackingContext),filters:e,removeCallback:function(){r.settings.remove(t);if(r.settings.length===1){r.settings.push(["AND"])}r.updateDisplay()},resizeCallback:function(){r.addConnectors()}});this.filterGroupViews.push(a);this.filterGroupList.append(a.containerElement)},addConnectors:function(){this.filterBarConnectors.empty();var e=this.filterGroupViews.length;var n=0,i=0;for(var r=0;r<e;r++){var a=t('<div class="streak__connectorHorizontal"></div>');var o=this.filterGroupViews[r].containerElement.position().top;o+=this.filterGroupViews[r].containerElement.outerHeight()/2;a.css("top",o+"px");this.filterBarConnectors.append(a);if(r===0){n=o}else if(r===e-1){i=o}}var s=t('<div class="streak__connectorVertical"></div>');s.css("top",n+"px");this.filterBarConnectors.append(s);if(e>1){this.containerElement.addClass("multipleFilterGroups");var l=this.addSwitchButtons(n+Math.round((i-n)/2)-14);l.css("top",+"px")}this.addPlusButton()},addSwitchButtons:function(e){var i=this;var r=t('<div class="filterGroupConnector"></div>');var a=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),list:[{name:"All",value:"AND"},{name:"Any",value:"OR"},{name:"None",value:"NONE"}],changeFunc:function(e){i.settings[0]=e.value;i.updateDisplay()}});a.setSelected(this.joiningOperator);r.append(a.el);var s=t('<div class="streak__connectorHorizontal"></div>');r.append(s);r.css("top",e);this.filterBarConnectors.append(r);return r},addPlusButton:function(){var e=this;var t=o.Widgets.Button.create({iconClassName:"bbPlus",onFunc:function(){e.settings.push(["AND"]);e.updateDisplay()}});t.el.css({bottom:"0",position:"absolute",marginRight:"0"});this.filterBarConnectors.append(t.el)},getNumberOfFilters:function(){return n(this.settings).chain().flatten().filter(function(e){return n.isObject(e)&&(n.isReal(e.property)||n.isReal(e.fieldKey))}).value().length},getStatus:function(){return this.settings},destroy:function(){this.options=null;this.pipeline=null;this.containerElement.remove();this.containerElement=null;this.filterGroupViews.forEach(function(e){e.destroy()});this.filterGroupViews=null;this.settings=null;this.joiningOperator=null},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s;var l=function(e,t){o.Tracker.trackStreakActive(s,t,{eventName:e})};o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatement=function(e){var i=this;this.column=null;this.columnType=null;this.operation=null;this.value=null;this.specificValue=null;this.pipeline=e.pipeline;this.options=e;this.filter=this.options.filter;if(n.isReal(this.filter)){this.column={};if(n.isReal(this.filter.fieldKey)){this.column.fieldKey=this.filter.fieldKey}else if(n.isReal(this.filter.property)){this.column.property=this.filter.property}this.columnType=this.filter.columnType;this.operation=this.filter.comparisonOperation;this.value=this.filter.value;this.specificValue=this.filter.specificValue}this.trackingContext=e.trackingContext.widgetContext+"/filterStatement";this.containerElement=a.get("filterStatement",true);this.columnDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(e.trackingContext),list:u(this.pipeline),unselectedDisplayText:o.Locale.getString("filter_choose_column"),maxHeight:300,changeFunc:function(e){i.column=e.value;i.operation=null;i.value=null;i.specificValue=null;i.updateStatement();i.updateDisplay()},comparisonFunction:function(e,t){return e.fieldKey===t.fieldKey&&n.isReal(e.fieldKey)||e.property===t.property&&n.isReal(e.property)}});this.containerElement.find(".filterColumnOptions").append(this.columnDropdown.el);this.operationsDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(e.trackingContext),unselectedDisplayText:o.Locale.getString("filter_choose_operation"),maxHeight:300,changeFunc:function(e){i.operation=e.value;i.value=null;i.specificValue=null;i.updateStatement();i.updateDisplay()}});this.containerElement.find(".filterOperationOptions").append(this.operationsDropdown.el);this.valuesDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(e.trackingContext),unselectedDisplayText:o.Locale.getString("filter_choose_value"),maxHeight:300,changeFunc:function(e){i.value=e.value;i.specificValue=null;i.updateStatement();i.updateDisplay()}});this.containerElement.find(".filterValueOptions").append(this.valuesDropdown.el);this.valuesMultiSelectMenuButton=o.Widgets.Buttons.ButtonFactory.createMultiSelectMenuButton({type:"GmailArrow",defaultText:o.Locale.getString("filter_choose_value")});this.valuesMultiSelectMenuButton.addClass("streak__valuesMultiSelect");this.valuesMultiSelectMenuButton.getEventStream().onValue(function(e){if(e.eventName!=="selectedValuesChanged"){return}i.value=e.value;i.updateStatement()});this.containerElement.find(".filterValueOptions").append(this.valuesMultiSelectMenuButton.getElement());this.specificValuePeopleDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(e.trackingContext),unselectedDisplayText:o.Locale.getString("filter_choose_specific"),maxHeight:300,changeFunc:function(e){i.specificValue=e.value;i.updateStatement()},comparisonFunction:function(e,t){if(!n.isReal(t)||!n.isReal(t.email)){return false}return e.email.toLowerCase()===t.email.toLowerCase()}});this.specificValueInput=t('<input type="text" />');this.specificValueInput[0].oninput=function(){i.updateStatement()};this.specificValueDateInput=t('<input type="text" class="streak__filterDateInput" />');this.specificValueDateInput.pickdate({animationDuration:0,body:r.elements.body,allowEmpty:false,appendTo:this.containerElement.find(".filterValueSpecific"),format:"m/d/Y",onSelect:function(e){i.specificValue=e.getTime();i.updateStatement()}});this.specificValueDateInput.on("blur",function(e){i.updateStatement()});this.specificValueDateInput.on("focus",function(e){t(this).trigger("onfocus")});this.containerElement.find(".filterValueSpecific").append(this.specificValueInput);this.containerElement.find(".filterValueSpecific").append(this.specificValuePeopleDropdown.el);this.containerElement.find(".filterValueSpecific").append(this.specificValueDateInput);this.removeStatementElement=this.containerElement.find(".filterRemoveStatement");this.removeStatementElement.click(function(e){i.removeStatement()});this.updateDisplay()};n.extend(o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatement.prototype,{updateDisplay:function(){this.resetDropdowns();
this.columnType=null;if(this.column.property){this.columnType=o.Models.Pipeline.getPropertyFilterAndGroupType(this.column.property)}else if(this.column.fieldKey){this.columnType=o.Models.BoxField.getFilterType(this.pipeline,this.column.fieldKey)}if(n.isNotReal(this.columnType)){this.columnDropdown.deselect()}else{this.columnDropdown.setSelected(this.column);var e=c(this.columnType,this.operation);if(d(this.operation,e)){this.operation=null;this.value=null}this.operationsDropdown.setMenuList(e);this.operationsDropdown.enable();if(n.isReal(this.operation)){this.operationsDropdown.setSelected(this.operation);if(m(this.operation)){this.valuesDropdown.el.hide();this.specificValueInput.hide()}else{if(this.columnType==="TEXT"||this.columnType==="TEXT_INPUT"||this.columnType==="BASIC_TEXT"||this.columnType==="NUMBER"||this.operation==="contains"||this.operation==="notContains"){this.valuesDropdown.el.hide();this.value="__specific";this.specificValueInput.show();this.specificValueInput.val(this.specificValue)}else if(this.operation==="isAny"||this.operation==="isNotAny"||this.operation==="isExactly"){this.valuesDropdown.el.hide();this.valuesMultiSelectMenuButton.getElement().show();this.valuesMultiSelectMenuButton.setItemList(h(this.columnType,this.operation,this.pipeline,this.column));this.valuesMultiSelectMenuButton.setCurrentlySelectedValues(this.value)}else{this.valuesDropdown.el.show();this.valuesDropdown.enable();var t=h(this.columnType,this.operation,this.pipeline,this.column);this.valuesDropdown.setMenuList(t);this.valuesDropdown.setSelected(this.value);if(this.value&&this.value.indexOf&&this.value.indexOf("__specific")>-1){switch(this.columnType){case"PERSON":var r=f(this.column,this.pipeline);this.specificValuePeopleDropdown.el.show();this.specificValuePeopleDropdown.setMenuList(r);this.specificValuePeopleDropdown.setSelected(this.specificValue);break;case"DATE":if(this.value==="__specific"){this.specificValueDateInput.show();var a=i.create(this.specificValue);if(a.isValid()){this.specificValueDateInput.val(a.prettyDate(true));this.specificValueDateInput.data("time",a.getTime())}else{tthis.specificValueDateInput.val("")}}else{this.specificValueInput.show();this.specificValueInput.val(this.specificValue)}break;default:this.specificValueInput.show();this.specificValueInput.val(this.specificValue);break}}else{this.specificValueInput.hide()}}}}else{this.operationsDropdown.deselect();this.operationsDropdown.el.show();if(p(e)){this.valuesDropdown.el.hide();this.specificValueInput.hide()}else{this.specificValueInput.hide();this.valuesDropdown.el.show();this.valuesDropdown.disable()}}}},removeStatement:function(){this.containerElement.remove();if(this.options.removeCallback){this.options.removeCallback()}},resetDropdowns:function(){this.columnDropdown.deselect();this.operationsDropdown.deselect();this.operationsDropdown.disable();this.valuesDropdown.deselect();this.valuesDropdown.el.show();this.valuesDropdown.disable();this.specificValueInput.hide();this.specificValueDateInput.hide();this.specificValuePeopleDropdown.el.hide();this.valuesMultiSelectMenuButton.getElement().hide()},updateStatement:function(){if(n.isReal(this.column)){this.filter.fieldKey=this.column.fieldKey;this.filter.property=this.column.property;this.filter.columnType=this.columnType;this.filter.comparisonOperation=this.operationsDropdown.getSelected().value;if(this.filter.comparisonOperation==="__unselected"){this.filter.comparisonOperation=null}this.filter.value=this.valuesDropdown.getSelected().value;if(this.filter.value==="__unselected"){this.filter.value=null}if(this.specificValueInput.isVisible()){this.filter.specificValue=this.specificValueInput.val()}else if(this.specificValueDateInput.isVisible()){var e=i.ccreate(this.specificValueDateInput.val());if(e.isValid()){this.filter.specificValue=e.getTime()}else{this.filter.specificValue=null}}else if(this.specificValuePeopleDropdown.el.isVisible()){this.filter.specificValue=this.specificValuePeopleDropdown.getSelected().value}else if(this.valuesMultiSelectMenuButton.getElement().isVisible()){this.filter.value=this.valuesMultiSelectMenuButton.getCurrentlySelectedValues()}else{this.filter.specificValue=null}}else{this.filter.property=null;this.filter.fieldKey=null}},destroy:function(){this.pipeline=null;this.options=null;this.filter=null;this.trackingContext=null;this.containerElement.remove();this.containerElement=null;this.columnDropdown.destroy();this.columnDropdown=null;this.operationsDropdown.destroy();this.operationsDropdown=null;this.valuesDropdown.destroy();this.valuesDropdown=null;this.valuesMultiSelectMenuButton.destroy();this.valuesMultiSelectMenuButton=null;this.specificValuePeopleDropdown.destroy();this.specificValuePeopleDropdown=null}});function u(e){var t;var i=n.map(e.getFields(),function(e){return{name:e.displayName(),value:{fieldKey:e.key()}}});var r=o.Models.Pipeline.getFilterableSystemProperties();var a=e.getActiveSystemColumns();r=n.differencePlus(r,a,function(e,t){return e.property===t.property});a=n.map(a,function(e){return{name:e.title,value:{property:e.property}}});r=n.map(r,function(e){return{name:e.title,value:{property:e.property}}});t=n.sortBy(i.concat(a),function(e){return e.name});t.push("__separator");t=t.concat(n.sortBy(r,function(e){return e.name}));return t}function c(e,t){return o.Models.BoxField.getFilterOperations(e,t)}function d(e,t){if(n.isNotReal(e)){return true}return!n.any(t,function(t){return t.value===e})}function h(e,t,i,r){if(n.isReal(r.property)&&r.property==="assignedToSharingEntries"){return o.Models.BoxField.getAssignedToFilterTextValues(i)}else if(n.isReal(r.property&&r.property==="stageKey")||n.isReal(r.fieldKey)){return o.Models.BoxField.getFilterTextValues(e,t,i,r.fieldKey)}}function f(e,t){if(n.isReal(e.property)&&e.property==="assignedToSharingEntries"){return t.getAllAssignedToValues()}else if(n.isReal(e.fieldKey)){return o.UI.getFieldValues(t,e.fieldKey)}}function p(e){for(var t=0;t<e.length;t++){if(!m(e[t].value)){return false}}return true}function m(e){return e==="isSet"||e==="notSet"||e==="isChecked"||e==="isUnchecked"}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatementGroup=function(e){var t=this;this.options=e;this.pipeline=this.options.pipeline;this.filterStatementViews=[];this.joiningOperator=null;this.filters=this.options.filters;this.joiningOperator=this.filters[0];this.trackingContext=e.trackingContext.widgetContext+"/filterStatementGroup";this.containerElement=a.get("filterGroup",true);this.statementListContainer=this.containerElement.find(".filterGroupStatementList");this.connectorsArea=this.containerElement.find(".filterGroupConnectors");this.containerElement.find(".filterRemoveGroup").on("click",function(t){if(e.removeCallback){e.removeCallback()}});this.addButton=null;this.switchButton=null;this.updateDisplay()};n.extend(o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatementGroup.prototype,{updateDisplay:function(){var e=this;this.statementListContainer.empty();this.connectorsArea.empty();this.filterStatementViews.forEach(function(e){e.destroy()});this.filterStatementViews.length=0;this.joiningOperator=this.filters[0];if(this.filters.length>1){for(var t=1;t<this.filters.length;t++){this.addStatement(this.filters[t],t)}}else{var n={};this.filters.push(n);this.addStatement(n,0,true)}this.addConnectors()},addStatement:function(e,t,i){var r=this;var a=new o.Modules.PipelineView.SavedViewsEditArea.FilterBar.FilterStatement({trackingContext:n.clone(this.trackingContext),pipeline:this.pipeline,filter:e,removeCallback:function(){r.removeStatement(t)}});this.statementListContainer.append(a.containerElement);this.filterStatementViews.push(a)},removeStatement:function(e){this.filters.remove(e);if(this.filters.length===1){if(this.options.removeCallback){this.options.removeCallback()}}else{this.updateDisplay();if(this.options.resizeCallback){this.options.resizeCallback()}}},addConnectors:function(){var e=this.filters.length-1;if(e>1){this.containerElement.addClass("multipleFilterStatements");for(var t=0;t<e;t++){this.connectorsArea.append('<div class="filterConnectorHorizontal"></div>')}this.connectorsArea.append('<div class="filterConnectorVertical"></div>');this.addSwitchButtons()}else{this.containerElement.removeClass("multipleFilterStatements")}this.addPlusButton(e>1)},addSwitchButtons:function(){var e=this;var i=t('<div class="filterGroupStatementConnector"></div>');var r=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),list:[{name:"All",value:"AND"},{name:"Any",value:"OR"},{name:"None",value:"NONE"}],changeFunc:function(t){e.filters[0]=t.value;e.updateDisplay()}});i.append(r.el);r.setSelected(this.joiningOperator);this.connectorsArea.append(i);this.switchButton=r},addPlusButton:function(e){var t=this;var n=o.Widgets.Button.create({iconClassName:"bbPlus",onFunc:function(){t.filters.push({});t.updateDisplay();if(t.options.resizeCallback){t.options.resizeCallback()}}});n.el.css({paddingLeft:"3px",paddingRight:"3px",position:"absolute",left:"17px",bottom:e?"-30px":"0"});this.connectorsArea.append(n.el);this.addButton=n},getFilterGroupState:function(){var e=[this.joiningOperator];for(var t=0;t<this.filterStatementViews.length;t++){var i=this.filterStatementViews[t].getStatement();if(n.isReal(i)){e.push(i)}}return e},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})},destroy:function(){this.options=null;this.pipeline=null;this.filterStatementViews.forEach(function(e){e.destroy()});this.filterStatementViews=null;this.filters=null;this.containerElement.remove();this.containerElement=null;if(this.addButton){this.addButton.destroy();this.addButton=null}if(this.switchButton){this.switchButton.destroy();this.switchButton=null}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=false;var l={};var u={};function c(){if(!s){u.container='<div class="groupByBarContainer"><span class="streak__statementConnectorText">'+o.Locale.getString("saved_views_group_by_connector")+"</span></div>";s=true}}o.Modules.PipelineView.SavedViewsEditArea.GroupByBar=function(e){c();var n=this;this.options=e;this.pipeline=e.pipeline;this.column=null;this.granularity=null;this.containerElement=t(u.container);this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/groupByBar";this.columnDropdown=null;this.dateGranularityDropdown=null;this.dateGroupByExplanation=null};o.Modules.PipelineView.SavedViewsEditArea.GroupByBar.create=function(e){var n={};t.extend(n,l,e);return new o.Modules.PipelineView.SavedViewsEditArea.GroupByBar(n)};n.extend(o.Modules.PipelineView.SavedViewsEditArea.GroupByBar.prototype,{updateDisplay:function(e,t){this.createDropdowns();this.columnDropdown.setSelected({columnKey:e});this.column=this.columnDropdown.getSelected().value;this.granularity=t;this.updateGroupByBar()},updateGroupByBar:function(){var e;if(this.column.property){e=o.Models.Pipeline.getPropertyFilterAndGroupType(this.column.property)}else if(this.column.fieldKey){e=this.pipeline.getField(this.column.fieldKey).get("type")}if(e!=="DATE"){this.dateGranularityDropdown.el.hide();this.dateGroupByExplanation.hide();this.granularity=null}else{this.dateGroupByExplanation.show();this.dateGranularityDropdown.el.show();this.granularity=this.granularity||"DAY";this.dateGranularityDropdown.setSelected(this.granularity)}},getStatus:function(){return{data:this.column.columnKey,granularity:this.granularity}},createDropdowns:function(){if(this.columnDropdown){return}var e=this;this.columnDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),unselectedDisplayText:o.Locale.getString("filter_choose_column"),list:d(this.pipeline),maxHeight:300,changeFunc:function(t){e.column=t.value;e.updateGroupByBar()},comparisonFunction:function(e,t){if(!e||!t){return false}return e.columnKey===t.columnKey}});this.containerElement.append(this.columnDropdown.el);this.dateGroupByExplanation=t("<span>"+o.Locale.getString("group_by_bar_date_explanation")+"</span>");this.containerElement.append(this.dateGroupByExplanation);this.dateGranularityDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),unselectedDisplayText:o.Locale.getString("group_by_date_granularity"),maxHeight:300,list:h(),changeFunc:function(t){e.granularity=t.value},comparisonFunction:function(e,t){if(!e&&!t){return true}return e===t}});this.containerElement.append(this.dateGranularityDropdown.el)},destroy:function(){if(this.columnDropdown){this.columnDropdown.destroy();this.columnDropdown=null}if(this.dateGranularityDropdown){this.dateGranularityDropdown.destroy();this.dateGranularityDropdown=null}if(this.containerElement){this.containerElement.remove();this.containerElement=null}}});function d(e){var t;var i=n.map(e.getFields(),function(e){return{name:e.displayName()||" ",columnType:"field",value:{fieldKey:e.key(),columnKey:"field|"+e.key()}}});var r=o.Models.Pipeline.getGroupableSystemProperties();var a=e.getActiveSystemColumns();r=n.differencePlus(r,a,function(e,t){return e.property===t.property});a=n.map(a,function(e){return{name:e.title,value:{property:e.property,columnKey:"property|"+(e.uniqueKey||e.property)}}});r=n.map(r,function(e){return{name:e.title,value:{property:e.property,columnKey:"property|"+(e.uniqueKey||e.property)}}});t=n.sortBy(i.concat(a),function(e){return e.name});t.push("__separator");t=t.concat(n.sortBy(r,function(e){return e.name}));return t}function h(){return[{name:o.Locale.getString("day"),value:"DAY"},{name:o.Locale.getString("week"),value:"WEEK"},{name:o.Locale.getString("month"),value:"MONTH"},{name:o.Locale.getString("quarter"),value:"QUARTER"},{name:o.Locale.getString("year"),value:"YEAR"}]}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=false;var l={};var u={};function c(){if(!s){u.container=a.get("sortByBarContainer")();s=true}}o.Modules.PipelineView.SavedViewsEditArea.SortByBar=function(e){c();this.options=e;this.pipeline=e.pipeline;this.containerElement=t(u.container);this.connectorsContainerElement=this.containerElement.find(".sortByBarConnectors");this.statementListContainerElement=this.containerElement.find(".sortByStatementList");this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/sortByBar";this.addButton=null;this.sortStatements=[]};o.Modules.PipelineView.SavedViewsEditArea.SortByBar.create=function(e){var n={};t.extend(n,l,e);return new o.Modules.PipelineView.SavedViewsEditArea.SortByBar(n)};n.extend(o.Modules.PipelineView.SavedViewsEditArea.SortByBar.prototype,{updateDisplay:function(e){this.sortStatements.forEach(function(e){e.destroy()});this.sortStatements.length=0;this.statementListContainerElement.empty();if(e.length>0){for(var t=0;t<e.length;t++){this.addSortStatement(e[t])}}else{this.addSortStatement({property:"creationTimestamp",sort:"ASC"})}this.addConnectors()},addSortStatement:function(e){var t=this;var i=o.Modules.PipelineView.SavedViewsEditArea.SortByStatement.create({pipeline:this.pipeline,trackingContext:n.clone(this.trackingContext),removeCallback:function(){t.sortStatements.removeVal(i);if(t.sortStatements.length===0){t.updateDisplay([])}else{t.addConnectors()}}});i.updateDisplay(e);this.sortStatements.push(i);this.statementListContainerElement.append(i.containerElement)},addConnectors:function(){this.connectorsContainerElement.empty();var e=0,n=0;var i=this.sortStatements.length;for(var r=0;r<i;r++){var a=t('<div class="streak__connectorHorizontal"></div>');var o=this.sortStatements[r].containerElement.position().top;o+=this.sortStatements[r].containerElement.outerHeight()/2;a.css("top",o+"px");this.connectorsContainerElement.append(a);if(r===0){e=o}else if(r===i-1){n=o}this.sortStatements[r].setIndex(r)}var s=t('<div class="streak__connectorVertical"></div>');s.css("top",e+"px");this.connectorsContainerElement.append(s);this.addPlusButton()},addPlusButton:function(){var e=this;var t=o.Widgets.Button.create({iconClassName:"bbPlus",onFunc:function(){e.addSortStatement({property:"creationTimestamp",sort:"ASC"});e.addConnectors()}});t.el.css({bottom:"0",position:"absolute",marginRight:"0"});this.connectorsContainerElement.append(t.el);this.addButton=t},getStatus:function(){return n(this.sortStatements).chain().map(function(e){return e.getStatus()}).filter(function(e){return n.isReal(e.columnKey)&&n.isReal(e.sort)}).value()},destroy:function(){this.sortStatements.forEach(function(e){e.destroy()});this.sortStatements=null;this.options=null;this.pipeline=null;this.containerElement.remove();this.containerElement=null;if(this.addButton){this.addButton.destroy();this.addButton=null}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=false;var l={};var u={};function c(){if(!s){u.container='<div class="savedViewsSortByStatement"><span class="streak__removeElement"></span></div>';s=true}}o.Modules.PipelineView.SavedViewsEditArea.SortByStatement=function(e){c();var i=this;this.options=e;this.pipeline=e.pipeline;this.containerElement=t(u.container);this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/sortByStatement";this.columnDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),unselectedDisplayText:o.Locale.getString("filter_choose_column"),maxHeight:300,changeFunc:function(e){i.directionDropdown.setMenuList(i.getSortDirectionList(e.value));i.directionDropdown.setSelected("ASC")},comparisonFunction:function(e,t){return e.columnKey===t.columnKey}});this.directionDropdown=o.Widgets.ButtonCustomDropdown.create({trackingContext:n.clone(this.trackingContext),changeFunc:function(e){}});this.containerElement.find(".streak__removeElement").on("click",function(t){i.containerElement.remove();e.removeCallback()});this.connectorText=t('<span class="streak__statementConnectorText"></span>');this.containerElement.prepend(this.directionDropdown.el);this.containerElement.prepend(this.columnDropdown.el);this.containerElement.prepend(this.connectorText)};o.Modules.PipelineView.SavedViewsEditArea.SortByStatement.create=function(e){var n={};t.extend(n,l,e);return new o.Modules.PipelineView.SavedViewsEditArea.SortByStatement(n)};n.extend(o.Modules.PipelineView.SavedViewsEditArea.SortByStatement.prototype,{updateDisplay:function(e){this.columnDropdown.setMenuList(this._getColumnList());this.columnDropdown.setSelected(e);this.directionDropdown.setMenuList(this.getSortDirectionList(e));this.directionDropdown.setSelected(e.sort)},_getColumnList:function(){var e=[{name:o.Locale.getString("columns_in_pipeline"),isHeader:true}];var t=n.map(this.pipeline.getFields(),function(e){return{name:e.displayName(),value:{fieldKey:e.key(),columnKey:"field|"+e.key()}}});var i=this.pipeline.getAllSystemColumns();var r=this.pipeline.getActiveSystemColumns();i=n.differencePlus(i,r,function(e,t){return e.property===t.property});r=n.map(r,function(e){return{name:e.title,value:{property:e.property,columnKey:"property|"+(e.uniqueKey||e.property)},extraText:e.isLinkedProperty?o.Locale.getString("linked_boxes").toLowerCase():null}});i=n.map(i,function(e){return{name:e.title,value:{property:e.property,columnKey:"property|"+(e.uniqueKey||e.property)},extraText:e.isLinkedProperty?o.Locale.getString("linked_boxes").toLowerCase():null}});var a=n.sortBy(t.concat(r),"name");e=e.concat(a);if(i.length>0){e.push({name:o.Locale.getString("other_columns"),isHeader:true});e=e.concat(n.sortBy(i,"name"))}return e},getSortDirectionList:function(e){var t;if(!e.fieldKey&&!e.property){var n=e.columnKey.split("|");var i=n[0];if(i==="property"){e.property=n[1]}else if(i==="fieldKey"){e.fieldKey=n[1]}}if(e.property){t=o.Models.Pipeline.getPropertySortType(e.property)}else if(e.fieldKey){t=this.pipeline.getField(e.fieldKey).get("type")}var r="sort_";switch(t){case"NUMBER":r="sort_number_";break;case"DATE":r="sort_date_";break}d[0].name=o.Locale.getString(r+"asc");d[1].name=o.Locale.getString(r+"desc");return d},setIndex:function(e){if(e===0){this.connectorText[0].innerHTML=o.Locale.getString("saved_views_sortby_first_connector")}else{this.connectorText[0].innerHTML=o.Locale.getString("saved_views_sortby_connector")}},getStatus:function(){return{columnKey:this.columnDropdown.getSelected().value.columnKey,sort:this.directionDropdown.getSelected().value}},destroy:function(){this.options=null;this.pipeline=null;this.containerElement.remove();this.containerElement=null;this.columnDropdown.destroy();this.columnDropdown=null;this.directionDropdown.destroy();this.directionDropdown=null}});var d=[{name:null,value:"ASC"},{name:null,value:"DESC"}]})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Eventer,r=e.Gmail,a=e.HTML,o=e.Date,s=e.BentoBox,l=s.Modules.PipelineView.ViewSettings.FilterSettings,u=s.Modules.PipelineView.ViewSettings.SortSettings,c=s.Modules.PipelineView.ViewSettings.GroupSettings.GroupBySettings,d=s.Modules.PipelineView.ViewSettings.PipelineSummarySettings;var h={pipeline:null};var f={};var p;SavedViewsController=function(e){i.call(this);this.pipeline=e.pipeline;this.uiSettingsTriggerEnabled=true;this.viewSettings={filterSettings:null,sortSettings:null,groupBySettings:null,summarySettings:null};this.activeView=null;this.setupBindings()};SavedViewsController.create=function(e){var t=n.extend({},h,e);return new SavedViewsController(t)};SavedViewsController.prototype=Object.create(e.Eventer.prototype);n.extend(SavedViewsController.prototype,{setupBindings:function(){var e=this;this.pipeline.watch("set",function(){if(e.uiSettingsTriggerEnabled){e.trigger("transformSettingsChanged")}},this,"uiSettings")},disableTriggerOnUISettingsSet:function(){this.uiSettingsTriggerEnabled=false},enableTriggerOnUISettingsSet:function(){this.uiSettingsTriggerEnabled=true},isASavedViewActive:function(){return n.isReal(this.activeView)&&!this.activeView.isUnsaved},getCurrentSettingsState:function(){var e=0,t=0;var i=this.viewSettings.filterSettings;var r=this.viewSettings.sortSettings;var a=this.viewSettings.groupBySettings;var o=this.viewSettings.summarySettings;if(this.activeView&&this.activeView.viewKey){this.activeView=this.pipeline.getSavedView(this.activeView.viewKey)}var s={uniqueFilteredColumns:0,numberOfFilterGroups:0,numberOfFilterStatements:0,listOfSortedColumns:[],groupBySetting:null,groupByGranularity:null,isASavedViewActive:this.isASavedViewActive(),activeView:this.activeView,isInHeadsUp:false,isDefaultSettingsActive:true};var l=[];for(e=1;e<i.filters.length;e++){s.numberOfFilterGroups+=1;var u=i.filters[e];for(t=1;t<u.length;t++){if(n.isReal(u[t].comparisonOperation)){s.numberOfFilterStatements+=1;if(n.isReal(u[t].property)){l.push(u[t].property)}else if(n.isReal(u[t].fieldKey)){l.push(u[t].fieldKey)}}}}s.uniqueFilteredColumns=n.unique(l).length;s.filterSettings=i;s.groupBySetting=a.data;s.groupByGranularity=a.granularity;s.listOfSortedColumns=r.data;if(o){s.summarySettings=o.data}if(s.isASavedViewActive){s.isInHeadsUp=this._isSavedViewInHeadsUp(s.activeView.viewKey)}s.isDefaultSettingsActive=s.uniqueFilteredColumns===0&&s.listOfSortedColumns.length===0&&s.groupBySetting==="property|stageKey"&&s.summarySettings.columnKey==="property|name"&&s.summarySettings.summaryFunction==="count"&&s.isASavedViewActive===false;return s},clearView:function(){if(this.activeView&&this.activeView.isUnsaved){this.pipeline.clearUnsavedView()}r.inboxSDK.Router.goto(this.pipeline.link("clear"))},setToDefaultView:function(){this.viewSettings.filterSettings=l.create(this.pipeline);this.viewSettings.sortSettings=u.create(this.pipeline);this.viewSettings.groupBySettings=c.create(this.pipeline);this.viewSettings.summarySettings=d.create(this.pipeline);if(!this.activeView){return}this.activeView=null;this.trigger("transformSettingsChanged")},addCurrentSettingsToSavedViews:function(e){var t=this.pipeline.addSavedView(e,this.viewSettings);this.pipeline.clearUnsavedView();r.inboxSDK.Router.goto(this.pipeline.link(t.viewKey))},saveSettingsAsView:function(e,t){var n=this.pipeline.addSavedView(e,t);r.inboxSDK.Router.goto(this.pipeline.link(n.viewKey))},getCreatedSavedViews:function(){return this.pipeline.getSavedViews()},getSystemSavedViews:function(){},activateSavedView:function(e){var t=this.pipeline.getSavedView(e);r.inboxSDK.Router.goto(this.pipeline.link(e))},updateSavedView:function(e){this.pipeline.updateSavedView(e);if(this.activeView&&this.activeView.viewKey===e.viewKey){this.activeView=e}this.trigger("changed")},updateActiveViewWithNewSettings:function(e){if(this.activeView){this.activeView.settings=e;this.pipeline.updateSavedView(this.activeView);this.viewSettings.filterSettings=this.activeView.settings.filterSettings;this.viewSettings.groupBySettings=this.activeView.settings.groupBySettings;this.viewSettings.sortSettings=this.activeView.settings.sortSettings;this.viewSettings.summarySettings=this.activeView.settings.summarySettings;this.trigger("transformSettingsChanged")}},deleteSavedView:function(e){var t=this.getCreatedSavedViews();var i=n.filter(t,function(t){return t.viewKey!==e});this.removeFromHeadsUp(e);this._save(i);if(n.isReal(this.activeView)){if(this.activeView.viewKey===e){r.inboxSDK.Router.goto(this.pipeline.link("clear"))}}},applyViewSettings:function(e){this.viewSettings.filterSettings=e.filterSettings;this.viewSettings.groupBySettings=e.groupBySettings;this.viewSettings.sortSettings=e.sortSettings;this.viewSettings.summarySettings=e.summarySettings;this.updateUnsavedView();this.trigger("changed");this.trigger("transformSettingsChanged")},setFilterSettings:function(e){this.viewSettings.filterSettings=e;this.updateUnsavedView();this.trigger("transformSettingsChanged")},getFilterSettings:function(){return this.viewSettings.filterSettings},setSortSettings:function(e){this.viewSettings.sortSettings=e;this.updateUnsavedView();this.trigger("transformSettingsChanged")},getSortSettings:function(){return this.viewSettings.sortSettings},setGroupBySettings:function(e){this.viewSettings.groupBySettings=e;this.updateUnsavedView();this.trigger("transformSettingsChanged")},getGroupBySettings:function(){return this.viewSettings.groupBySettings},setSummarySettings:function(e){this.viewSettings.summarySettings=e;this.updateUnsavedView();this.trigger("transformSettingsChanged")},getSummarySettings:function(){return this.viewSettings.summarySettings},updateUnsavedView:function(){if(!this.activeView){var e=this.pipeline.setUnsavedView(JSON.deepClone(this.viewSettings));r.inboxSDK.Router.goto(this.pipeline.link(e.viewKey))}else if(this.activeView.isUnsaved){this.activeView.settings=JSON.deepClone(this.viewSettings);this.pipeline.updateSavedView(this.activeView)}},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});i.prototype.destroy.call(this)},processParams:function(e){if(e){if(e==="clear"){SavedViewsController.clearLastViewKey(this.pipeline);this.setToDefaultView()}else{var t=this.pipeline.getSavedView(e);if(t){this.setViewSettings(e)}else{f[this.pipeline.key()]=null;this.setToDefaultView();r.inboxSDK.Router.goto(this.pipeline.link())}}}else{if(f[this.pipeline.key()]){this.setViewSettings(f[this.pipeline.key()]);r.inboxSDK.Router.goto(this.pipeline.link(f[this.pipeline.key()]))}else{this.setToDefaultView()}}},setViewSettings:function(e){var t=this.pipeline.getSavedView(e);if(!n.isReal(t)){return}this.viewSettings.filterSettings=t.settings.filterSettings;this.viewSettings.groupBySettings=t.settings.groupBySettings;this.viewSettings.sortSettings=t.settings.sortSettings;this.viewSettings.summarySettings=t.settings.summarySettings;this.activeView=t;this.trigger("transformSettingsChanged");f[this.pipeline.key()]=this.activeView.viewKey},removeFromHeadsUp:function(e){if(this._isSavedViewInHeadsUp(e)){s.Modules.HeadsUp.removeSection(e)}},_isSavedViewInHeadsUp:function(e){return SavedViewsController.externalIsInHeadsUp(e)},_save:function(e){this.pipeline.setUISettings("savedViews/list",e)}});SavedViewsController.externalIsInHeadsUp=function(e){var t=s.getUser().getHeadsUpSections();for(var n=0;n<t.length;n++){if(t[n].viewKey===e){return true}}return false};SavedViewsController.externalDeleteSavedView=function(e,t){var i=e.getSavedViews();var r=t.viewKey;var a=n.filter(i,function(e){return e.viewKey!==r});s.Modules.HeadsUpMasterController.removeSection(r);e.setUISettings("savedViews/list",a);e.postNotification({eventName:"savedViewRemoved",savedView:t,viewKey:t.viewKey})};SavedViewsController.clearLastViewKey=function(e){f[e.key()]=null};s.Modules.PipelineView.SavedViewsController=SavedViewsController})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.Date,o=e.BentoBox;var s={savedViewsController:null};var l=function(e){this.unbinders=[];this.menu=null;this.buttonMenu=null;this.savedViewsController=e.savedViewsController;this.createButton();this.unbinders.push(this.savedViewsController.bind("changed",this.updateMenu.bind(this)));this.unbinders.push(this.savedViewsController.bind("transformSettingsChanged",this.updateMenu.bind(this)));this.updateMenu()};l.create=function(e){var n={};t.extend(n,this.defaults,e);return new l(n)};n.extend(l.prototype,{createButton:function(){this.menu=o.Widgets.Menu.create();this.menu.getElement().addClass("streak__savedViewsButtonMenu_menu");var e=this;this.buttonMenu=o.Widgets.Buttons.ButtonFactory.createSplitMenuButton({type:"GmailSplitArrow",text:o.Locale.getString("filter_sort_group"),menu:this.menu,menuClickTriggersOff:true,isFixedPosition:true,isRightAligned:true,onFunction:function(){o.Tracker.track("toggleSavedViewsEditArea",{source:"savedViewsButton"});e.savedViewsController.trigger("toggleSavedViewsEditArea")}});this.buttonMenu.addClass("streak__savedViewsButtonMenu")},updateMenu:function(){var e=this;this.menu.empty();var t;if(e.savedViewsController.isASavedViewActive()){t=e.savedViewsController.getCurrentSettingsState()}var i=n.sortBy(this.savedViewsController.getCreatedSavedViews(),"name");n.each(i,function(n){e.menu.addCheckItem(n.name,function(){o.Tracker.track("activateSavedView");e.savedViewsController.activateSavedView(n.viewKey)},t&&t.isASavedViewActive&&t.activeView.viewKey===n.viewKey)});if(i.length>0){this.buttonMenu.enableMenu()}else{this.buttonMenu.disableMenu()}},getElement:function(){return this.buttonMenu.getElement()},destroy:function(){this.buttonMenu.destroy();this.menu.destroy();this.unbinders.forEach(function(e){e()});this.savedViewsController=null}});o.Modules.PipelineView.SavedViewsButton=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=false;var l={};var u={pipeline:null,savedViewsController:null};function c(){if(!s){l.container=a.get("statusBarContainer")();s=true}}var d=function(e){c();var n=this;this.savedViewsController=e.savedViewsController;this.pipeline=e.pipeline;this.trackingContext=e.trackingContext;this.trackingContext.widgetContext+="/savedViewsStatusBar";this.containerElement=t(l.container);this.messageElement=this.containerElement.find(".streak__statusBarMessage");this.linksElement=this.containerElement.find(".streak__statusBarLinks");this.viewLinks=this.containerElement.find(".streak__statusBarViewLinks");this.nonViewLinks=this.containerElement.find(".streak__statusBarNonViewLinks");this.toggleChevron=this.containerElement.find(".toggleChevron");this.savedViewsEditArea=e.savedViewsEditArea;this.unbinders=[];this.initFunctionality()};d.create=function(e){var n={};t.extend(n,u,e);return new d(n)};n.extend(d.prototype,{getElement:function(){return this.containerElement},updateDisplay:function(){var e=this.savedViewsController.getCurrentSettingsState();var t=!e.isDefaultSettingsActive;if(t){this.containerElement.show();if(e.isASavedViewActive){this.renderActiveViewMessage(e)}else{this.renderSettingsMessage(e)}this.updateOpenStatus()}else{this.containerElement.hide()}this.currentState=e},initFunctionality:function(){var e=this;this.containerElement.on("click",function(t){e.track("toggleSavedViewsEditArea");
e.savedViewsController.trigger("toggleSavedViewsEditArea")});this.containerElement.find(".streak__statusBarClearLink").on("click",function(t){e.savedViewsController.clearView();e.track("statusBarClear");e.savedViewsController.trigger("closeSavedViewsEditArea");t.stopPropagation()});this.containerElement.find(".streak__statusBarAdvancedFilters").on("click",function(t){e.savedViewsController.trigger("toggleSavedViewsEditArea");e.track("toggleFiltersArea");t.stopPropagation()});var t=this.containerElement.find(".streak__statusBarMakeView");if(o.Services.AccessManager.isAccessAllowed(this.pipeline,"Pipeline","UPDATE")){t.click(function(t){e.track("createSavedViewAttempt");o.Widgets.Modal.textboxModal({title:o.Locale.getString("saved_view_create_modal_title"),placeholderText:o.Locale.getString("Set the name of the new view"),callback:function(t){e.track("createSavedViewSuccess");e.savedViewsController.addCurrentSettingsToSavedViews(t)}});t.stopPropagation()})}else{t.addClass("streak__disabled");t.attr("data-tooltip","You don't have access to this.")}this.inboxCheckbox=r.widgets.getCheckbox(o.Locale.getString("saved_view_add_to_inbox"));this.viewLinks.append(this.inboxCheckbox);this.inboxCheckbox.on("change",function(t){if(e.inboxCheckbox.isChecked()){e.track("addSavedViewToInbox");o.Modules.HeadsUpMasterController.addSection(e.currentState.activeView.viewKey,e.pipeline.key())}else{e.track("removeSavedViewFromInbox");o.Modules.HeadsUpMasterController.removeSection(e.currentState.activeView.viewKey)}});this.unbinders.push(this.savedViewsController.bind("transformSettingsChanged",this.updateDisplay.bind(this)));this.unbinders.push(this.savedViewsController.bind("changed",this.updateDisplay.bind(this)));this.unbinders.push(this.savedViewsController.bind("savedViewsEditAreaChanged",this.updateOpenStatus.bind(this)))},renderActiveViewMessage:function(e){this.viewLinks.show();this.nonViewLinks.hide();this.inboxCheckbox.setChecked(e.isInHeadsUp);this.messageElement.html(this.getSettingsMessageHTML(e));this.containerElement.addClass("streak__savedViewActive")},renderSettingsMessage:function(e){this.viewLinks.hide();this.nonViewLinks.show();this.messageElement.html(this.getSettingsMessageHTML(e));this.containerElement.removeClass("streak__savedViewActive")},updateOpenStatus:function(){if(this.savedViewsEditArea.isAreaOpen()){this.toggleChevron.removeClass("downChevron")}else{this.toggleChevron.addClass("downChevron")}},getSettingsMessageHTML:function(e){var t=o.Locale.getString("unsaved_view");if(e.activeView){t=e.activeView.name}var i="<b>"+n.escape(t)+"</b> - ";var r=[];if(e.uniqueFilteredColumns>0){r.push(o.Locale.getString("status_view_filter_message",{number:e.uniqueFilteredColumns,pluralize:[e.uniqueFilteredColumns]}))}if(e.listOfSortedColumns.length>0){r.push(o.Locale.getString("status_view_sort_message",{number:e.listOfSortedColumns.length,pluralize:[e.listOfSortedColumns.length]}))}if(n.isReal(e.groupBySetting)){if(e.groupBySetting.indexOf("field|")===-1&&e.groupBySetting!=="property|stageKey"){var a=this.pipeline.getSystemColumn(e.groupBySetting.split("|")[1]);if(!a){a=o.Models.Pipeline.getSystemProperty(e.groupBySetting.split("|")[1])}r.push(o.Locale.getString("status_view_group_message",{column:a.title}))}if(e.groupBySetting.indexOf("field|")>-1){r.push(o.Locale.getString("status_view_group_message",{column:this.pipeline.getField(e.groupBySetting.split("|")[1]).displayNameText()}))}}if(n.isReal(e.summarySettings)&&(e.summarySettings.columnKey!=="property|name"||e.summarySettings.summaryFunction!=="count")){var s;if(e.summarySettings.columnKey.indexOf("field|")===0){s=this.pipeline.getField(e.summarySettings.columnKey.split("|")[1]).displayNameText()}else{s=this.pipeline.getSystemColumn(e.summarySettings.columnKey.split("|")[1]).title}r.push(o.Locale.getString("status_view_summary_message",{column:s,"function":o.ColumnSummary.getLocalizedName(e.summarySettings.summaryFunction)}))}return i+n.escape(r.join(", "))},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})},destroy:function(){for(var e=0;e<this.unbinders.length;e++){this.unbinders[e]()}}});o.Modules.PipelineView.SavedViewsStatusBar=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{pipeline:null,color:"blue",isButton:true,isDark:false,iconAfter:false},init:function(e){var t=this;this.templates={};this.templates.button=r.get("shareButtonButton");if(e){e()}},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(t){var i=t;var r=i.pipeline;var s=[];var l=[];var u;var c=function(){var e=n.clone(r.get("aclEntries"));var t=r.get("orgWide");var i=!t&&e.length===1;f.el.find(".bbSharedIcon").hide();if(i){f.el.find(".bbSharedPrivate").show()}else{f.el.find(t?".bbSharedGroup":".bbSharedPeople").show()}};var d={isToggle:false,onFunc:function(){if(u){u.destroy()}u=new a.Services.PipelineSharingSettings.PipelineSharingSettingsModalViewController(r);u.show()}};if(i.isButton){d.name=o.templates.button();d.color=i.color}else{var h=document.createElement("div");h.innerHTML=o.templates.button();if(i.isDark){h.setAttribute("class","dark")}d.customButton=h}var f=a.Widgets.Button.create(d);if(i.iconAfter){var p=f.el.find("span").detach();f.el.prepend(p)}f.setPipeline=function(e){i.pipeline=e;r=e;c()};if(r){r.watch("set",c,f,"orgWide");r.watch("set",c,f,"aclEntries");if(!a.Services.AccessManager.arePermissionsAllowed(r,[{entityType:"Pipeline",actions:["UPDATE","CHANGE_PERMISSIONS"]}])){f.disable()}c()}f.getElement().addClass("streak__shareButton");var m=f.destroy;f.destroy=function(){e.NotificationCenter.unsubscribe({observer:f});if(u){u.destroy()}m()};return f};e.DependencyManager.addFunction({functionKey:"pipelineView.shareButtonInitialized",functionToCall:o.init,functionContext:o,dependentFunctionKeys:["htmlLoaded","pipelineViewInitialized"]});a.Modules.PipelineView.ShareButton=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{pipeline:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(e){var t=e,n=t.pipeline,i=t.css,r=t.feed,o=t.isFeedAccessAllowed&&a.UserSettings.getSetting(n.key()+"/showFeed");var s=t.containerElement;if(typeof o==="undefined"||o===""){o=true}var l=t.toggleCallback;var u="apJ",c="apK",d=function(){p.changeIconClass("apH apJ bbIcon");s.find(".feed_sidebar").css("display","-webkit-box")},h=function(){p.changeIconClass("apH apK bbIcon");s.find(".feed_sidebar").hide()},f=function(){o=!o;a.UserSettings.setSetting(n.key()+"/showFeed",o);a.UserSettings.save()},p=a.Widgets.Buttons.ButtonFactory.createToggleButton({type:"GmailTextIcon",iconClass:"apH",hasButtonToRight:true,isOn:o,text:a.Locale.getString("newsfeed"),noDeactivation:true,onFunction:function(){d();f();l()},offFunction:function(){h();f();l()},trackingContext:t.trackingContext});p.addClass("apF showHideFeedButton");if(i){p.getElement().css(i)}p.changeIconClass("apH");if(o){d()}else{h()}return p};a.Modules.PipelineView.ShowHideFeedButton=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{pipeline:null},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(e){var n=e,i=n.pipeline;var r=a.UserSettings.getSetting(i.key()+"/showGroupbar");var o=n.containerElement;if(typeof r==="undefined"||r===""){r=true}var s=n.toggleCallback;n.trackingContext.widgetContext+="/showHideGroupbarButton";var l="apJ",u="apI",c=function(){m.removeClass(u).addClass(l);o.find(".groups").show()},d=function(){m.removeClass(l).addClass(u);o.find(".groups").hide()},h=function(){r=!r;a.UserSettings.setSetting(i.key()+"/showGroupbar",r);a.UserSettings.save()},f=a.Widgets.Button.create({hasButtonToRight:true,isToggle:true,enableDepressedState:false,isOn:r,tooltip:a.Locale.getString("groupbar"),onFunc:function(){c();h();s()},offFunc:function(){d();h();s()},trackingContext:n.trackingContext});f.el.addClass("apF showHideGroupbarButton");var p=t(document.createElement("div"));var m=t(document.createElement("div"));p.addClass("rotate180");m.addClass("apH T-I-J3 J-J5-Ji");p.append(m);f.el.prepend(p);if(r){c()}else{d()}return f};a.Modules.PipelineView.ShowHideGroupbarButton=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={boxesMin:10,init:function(e){if(this.shouldRender()){this.render()}if(e){e()}},shouldRender:function(){if(a.UserSettings.getSetting("promote/hasShown")){return false}return true},render:function(e){var i=t(r.get("promoteModal")());var o=n.filter(a.Data.getAllBoxes(),function(e){return e.get("creatorKey")===a.getUser().key()}).length;if(o<this.boxesMin&&!e){return}var s=n.filter(a.Data.getAllPipelines(),function(e){return e.get("creatorKey")===a.getUser().key()}).length;var l=n.filter(a.Data.getAllSnippets(),function(e){return e.get("userKey")===a.getUser().key()}).length;var u=a.Data.getAllSendLaters().length;i.find(".number.box strong").html(o);this.renderStat(i,o,"box","es");if(l+u+s===0){}else if(l+u===0&&o>0){i.find(".number.box").after(" "+a.Locale.getString("and")+" ")}else if(o>0){i.find(".number.box").after(", ")}this.renderStat(i,s,"pipeline");if(l>0&&u>0){i.find(".number.pipeline").after(", ")}else if(l>0||u>0){i.find(".number.pipeline").after(" "+a.Locale.getString("and")+" ")}if(l===0){i.find(".number.snippet").hide()}else{this.renderStat(i,l,"snippet");if(u>0){i.find(".number.snippet").after(" "+a.Locale.getString("and")+" ")}}this.renderStat(i,u,"sendlater");var c=a.Widgets.Modal.create({title:"",confirmText:e?a.Locale.getString("modal_done"):a.Locale.getString("dismiss_forever"),inner:i,confirmFunc:function(){a.UserSettings.setSetting("promote/hasShown",true);a.UserSettings.saveSettings()},showCancel:!e,cancelText:a.Locale.getString("not_now"),width:"800px",minHeight:"551px",showTitle:false});c.show();a.Services.GooglePlusOne.render();a.Tracker.track("promoteModal.show",{isForced:e});this.addTracking(i,e)},addTracking:function(e,t){e.find(".review a").click(function(e){a.Tracker.track("promoteModal.reviewClicked",{isForced:t})});e.find(".email a").click(function(e){a.Tracker.track("promoteModal.emailClicked",{isForced:t})})},renderStat:function(e,t,n,i){var r=e.find(".number."+n);r.find("strong").html(t);if(t>0){r.find("strong").after(" "+a.Locale.getString(n+(t>1?i?i:"s":"")).toLowerCase())}else{r.hide()}}};e.DependencyManager.addFunction({functionKey:"promoteInitialized",functionToCall:o.init,functionContext:o,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","userSettingsInitialized"]});a.Modules.Promote=o})(Streak);(function(e){var t=e.$,n=e._,i=e.BentoBox,r=e.Gmail,a=e.HTML,o=e.Library,s=e.Locale;var l=e.UI.Delegator;i.Modules.EmailFilters={};i.Modules.EmailFilters.EmailFilterViewController=e.Class.subclass({className:"EmailFilterViewController",superclass:l,memberVariables:[{name:"_boxKey",get:true,set:true,destroy:false,defaultValue:null},{name:"_contacts",get:true,set:true,destroy:false},{name:"_element",get:true,destroy:true},{name:"_gmailThreadCollection",destroy:false},{name:"_emailFilterBlacklists",destroy:false},{name:"_emailFilters",destroy:false},{name:"_emailFiltersInner",destroy:true},{name:"_trackingContext",destroy:true},{name:"_useLinkButtonForNewFilter",get:true,set:true,destroy:true,defaultValue:false},{name:"_fetchInfoFromServer",get:true,set:true,destroy:true,defaultValue:false},{name:"_showTitle",get:true,set:true,destroy:true,defaultValue:true},{name:"_suggestionsFromThread",get:true,set:true,destroy:true,defaultValue:true},{name:"_isButtonModal",destroy:false,defaultValue:true}],_initialize:function(e){l.prototype._initialize.call(this);if(!e.boxKey){throw new Error("boxKey is a mandatory argument to emailFilters._initialize")}this.setBoxKey(e.boxKey);if(e.useLinkButtonForNewFilter!==undefined){this._useLinkButtonForNewFilter=e.useLinkButtonForNewFilter}if(e.fetchInfoFromServer!==undefined){this._fetchInfoFromServer=e.fetchInfoFromServer}if(e.showTitle!==undefined){this._showTitle=e.showTitle}if(e.suggestionsFromThread!==undefined){this._suggestionsFromThread=e.suggestionsFromThread}if(e.trackingContext!==undefined){this._trackingContext=e.trackingContext}if(e.modalFromButton!==undefined){this._isButtonModal=e.modalFromButton}this._element=t(a.getElement("boxSidebarEmailFilters"));this._setupEmailFilterCreationModal();this._setupNewEmailFilterMenuButton();this._setupTitle();if(this._fetchInfoFromServer){this._setupCollections()}},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});l.prototype.destroy.call(this)},_setupCollections:function(){var e=this;var t=i.Data.getEmailFilterBlacklistCollection(this.getBoxKey());t.refresh(function(){e.setEmailFilterBlacklists(t)});var n=i.Data.getEmailFilterCollection(this.getBoxKey());e.setEmailFilters(n);n.refresh(function(){e.setEmailFilters(n)});if(!this._suggestionsFromThread){this._gmailThreadCollection=i.Data.getGmailThreadCollectionForBox(this._boxKey);this._gmailThreadCollection.watch("collectionChange",function(){e._updateContacts()},this);this._updateContacts()}},_setupTitle:function(){if(!this._showTitle){this._element.find(".streak__emailFilters_title").remove()}},setEmailFilters:function(t){e.NotificationCenter.unsubscribe({observer:this});this._emailFilterCollection=t;if(this._emailFilterCollection){var n=this;this._emailFilterCollection.watch("collectionChange",function(){n._emailFilterCollectionUpdated()},this)}this._emailFilterCollectionUpdated()},setEmailFilterBlacklists:function(e){this._emailFilterBlacklists=e;this.updateEmailFilterCreationModalSuggestions()},_emailFilterCollectionUpdated:function(){this.updateEmailFilters();this.updateEmailFilterCreationModalSuggestions()},updateEmailFilters:function(){if(!this._emailFiltersInner){this._emailFiltersInner=this._element.find(".streak__emailFiltersInner")}this._emailFiltersInner.empty();var e=this;if(!this._emailFilterCollection){return}if(this._emailFilterCollection.length>0){var r=t(document.createElement("ul"));n.each(this._emailFilterCollection,function(n){var o=t(a.get("boxSidebarEmailFilter")({content:n.filterDisplayHtml()}));var s=o.find(".ar9");s.click(function(){e.removeFilter(n)});var l=i.Data.getBox(e.getBoxKey());if(!i.Services.AccessManager.isAccessAllowed(l.getPipeline(),"Box","UPDATE")){s.remove()}r.append(o)});this._emailFiltersInner.append(r)}else{var o=t(document.createElement("div"));o.text(s.getString("email_suggestion_no_filters"));o.addClass("asd ja streak__emailFilters_empty");this._emailFiltersInner.html(o)}this._callDelegateFunction("updateEmailFilters")},getEmailFilters:function(){return this._emailFilterCollection},_setupNewEmailFilterMenuButton:function(){var e=this;var t=i.Widgets.Menu.create();t.addSection(e._emailFilterCreationModal);var r={text:s.getString("email_filters_new_filter"),color:"blue",isFixedPosition:true,isRightAligned:true,menu:t,postOnFunction:this._emailFilterCreationModalOn.bind(this)};if(this._useLinkButtonForNewFilter){this._newEmailFilterButton=i.Widgets.Buttons.ButtonFactory.createMenuButton(n.extend(r,{type:"Text",text:s.getString("link_create_new")}));this._newEmailFilterButton.getElement()[0].style.textDecoration="none"}else{this._newEmailFilterButton=i.Widgets.Buttons.ButtonFactory.createMenuButton(n.extend(r,{type:"Gmail"}))}var a=i.Data.getBox(this._boxKey);if(!a.getIsEditable()||!i.Services.AccessManager.isAccessAllowed(a.getPipeline(),"Box","UPDATE")){this._newEmailFilterButton.disable();if(this._useLinkButtonForNewFilter){this._newEmailFilterButton.getElement().hide()}}this._element.find(".streak__emailFilters_newFilter").html(this._newEmailFilterButton.getElement())},getNewEmailFilterButtonElement:function(){return this._newEmailFilterButton.getElement()},_setupEmailFilterCreationModalConfirmButton:function(){var e=this;if(!this._emailFilterCreationModalConfirmButton){this._emailFilterCreationModalConfirmButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:s.getString("email_suggestion_create_filter"),color:"blue",onFunction:function(){var t=e._emailFilterCreationModal;var n=t.find("input:radio:checked[name=emailFilterType]").val();if(n==="email"){var r=e._emailFilterCreationModalEmailTextbox.getText().trim();if(!r){i.ButterBarManager.showError(i.Locale.getString("email_filter_error_empty"));return}e.createEmailFilter(r)}else if(n==="domain"){var a=e._emailFilterCreationModalDomainTextbox.getText().trim();if(!a){i.ButterBarManager.showError(i.Locale.getString("email_filter_error_empty"));return}e.createDomainFilter(a)}if(e._isButtonModal){e._newEmailFilterButton.off()}else{e._callDelegateFunction("close",e)}}})}this._emailFilterCreationModal.find(".streak__filter_creator_confirm_button").html(this._emailFilterCreationModalConfirmButton.getElement())},_setupEmailFilterCreationModalXButton:function(){var e=this;if(!this._isButtonModal){return}if(!this._emailFilterCreationModalXButton){this._emailFilterCreationModalXButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"X",onFunction:function(){e._newEmailFilterButton.off()}})}this._emailFilterCreationModal.find(".streak__filter_creator_cancel_button").html(this._emailFilterCreationModalXButton.getElement())},_emailFilterCreationModalOn:function(){this._emailFilterCreationModalEmailTextbox.setHTML(null);this._emailFilterCreationModalDomainTextbox.setHTML(null);this._emailFilterCreationModal.find("input:radio[name=emailFilterType][value=email]").click()},_setupEmailFilterCreationModal:function(){if(!this._emailFilterCreationModal){this._emailFilterCreationModal=t(a.getElement("boxSidebarEmailFilterCreator"))}this._setupEmailFilterCreationModalConfirmButton();this._setupEmailFilterCreationModalXButton();if(!this._emailFilterCreationModalEmailTextbox){this._emailFilterCreationModalEmailTextbox=new i.Widgets.GmailTextareaViewController({plainTextOnly:true})}this._emailFilterCreationModal.find(".emailFilterEmail").html(this._emailFilterCreationModalEmailTextbox.getView().getElement());if(!this._emailFilterCreationModalDomainTextbox){this._emailFilterCreationModalDomainTextbox=new i.Widgets.GmailTextareaViewController({plainTextOnly:true})}this._emailFilterCreationModal.find(".emailFilterDomain").html(this._emailFilterCreationModalDomainTextbox.getView().getElement());this.updateEmailFilterCreationModalSuggestions()},_getContacts:function(){return n.chain(this._gmailThreadCollection).map(function(e){return n.map(e.get("emailAddresses"),function(t,n){return{email:t,fullName:e.get("names")[n]}})}).flatten(true).uniq(false,function(e){return e.email}).sortBy("fullName").value()},_updateContacts:function(){this._contacts=this._getContacts();this.updateEmailFilterCreationModalSuggestions()},updateEmailFilterCreationModalSuggestions:function(){var e=this;var r=this._emailFilterCreationModal.find(".emailFilterCreatorSuggestions");r.empty();var a=this.getEmailFilterSuggestions();if(a.length===0){this._emailFilterCreationModal.find(".streak__filter_creator_suggestions").hide();return}this._emailFilterCreationModal.find(".streak__filter_creator_suggestions").show();n.each(a,function(n){var a=i.Widgets.Buttons.ButtonFactory.createButton({type:"Text",html:n.html,color:"cornflowerblue",onFunction:function(){e._emailFilterCreationModal.find("input:radio[name=emailFilterType][value="+n.type+"]").click();if(n.type==="email"){e._emailFilterCreationModalEmailTextbox.setHTML(n.email);e._emailFilterCreationModalDomainTextbox.setHTML(null)}else{e._emailFilterCreationModalEmailTextbox.setHTML(null);e._emailFilterCreationModalDomainTextbox.setHTML(n.domain)}}});r.append(t(document.createElement("li")).html(a.getElement()))})},getEmailFilterSuggestions:function(){var e;if(this._suggestionsFromThread){e=this.getEmailAddressesInGmailThread()}else{e=n.pluck(this._contacts,"email")}e.removeVal(i.getUser().getEmail());var t=n.chain(e).map(function(e){return e.split("@")[1]}).uniq().value();var r=this._emailFilterCollection;if(r){e=n.reject(e,function(e){for(var t=0;t<r.length;t++){var n=r[t];if(n.get("type")==="EMAIL_ADDRESS_FILTER"&&n.get("value")===e){return true}}return false});t=n.reject(t,function(e){for(var t=0;t<r.length;t++){var n=r[t];if(n.get("type")==="DOMAIN_FILTER"&&n.get("value")===e){return true}}return false})}var a=this._emailFilterBlacklistCollection;if(a){e=n.reject(e,function(e){return n.some(a,function(t){return t.get("blacklistEmail")===e})})}var o=n.map(e,function(e){return{type:"email",email:e,html:s.getString("email_suggestion_creation_one_email",{email:n.escape(e)})}});var l=n.map(t,function(e){return{type:"domain",domain:e,html:s.getString("email_suggestion_creation_one_domain",{domain:n.escape(e)})}});return o.concat(l)},createEmailFilter:function(e){var t=o.get("BentoBox.Services.EmailFilterLimiter");if(t.isLocked()){t.showGateway()}else{var n=i.Models.EmailFilter.create({type:"EMAIL_ADDRESS_FILTER",value:e,boxKey:this._boxKey});n.save();this._emailFilterCollection.add(n);t.incrementUsage()}},createDomainFilter:function(e){var t=o.get("BentoBox.Services.EmailFilterLimiter");if(t.isLocked()){t.showGateway()}else{var n=i.Models.EmailFilter.create({type:"DOMAIN_FILTER",value:e,boxKey:this._boxKey});n.save();this._emailFilterCollection.add(n);t.incrementUsage()}},removeFilter:function(e){e.del()},showCreateFilterDialog:function(){var e=this;this._emailFilterCreationModalOn();return{getElement:function(){return e._emailFilterCreationModal},addDelegate:this.addDelegate.bind(this)}},getEmailAddressesInGmailThread:function(){var e=r.getActiveHexGmailThreadIdList(i.Services.Threads.HexGmailThreadIdExtractor);var t=i.Services.Threads.ThreadStorer.getThreadMetaData(e[0]);if(t){return n.uniq(t.emailAddresses)}else{return[]}}})})(Streak);(function(e){var t=e._,n=e.Library,i=e.DependencyManager,r=e.BentoBox,a=e.Locale;var o=2;var s=e.Class.subclass({superclass:e.BentoBox.Services.FeatureLimiter,_memberVariables:[],_initialize:function(){e.BentoBox.Services.FeatureLimiter.prototype._initialize.call(this)},_getFeatureKey:function(){return"emailFilters"},_getGatewayTitle:function(){return a.getString("email_filters_gateway_title")},_getGatewayBodyText:function(){return a.getString("email_filters_gateway_text")},_getLimit:function(){return o}});i.addFunction({functionKey:"EmailFilterLimiterInitialized",functionToCall:function(e){n.set("BentoBox.Services.EmailFilterLimiter",new s);if(e){e()}},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=e.Gmail;var s=function(e){i.call(this,e)};s.prototype=Object.create(i.prototype);t.extend(s.prototype,{keyName:"trackedLinkKey",entityType:"TrackedLink",createProperties:["guid","hexGmailThreadId","subject","names","emails","snippetKeyList","isMailMerge","rfcMessageId"],apiURLs:{create:"trackedlinks"},tagEntityName:"trackedLink",shouldShowSavingMessage:function(e){return false}});s.create=function(e){return new s(e)};s.createCollection=function(){var e=new r;e.init({modelKeyPropertyName:"TrackedLinkKey",requestTags:["trackedLinkCollection_noKey"],requestDependentOnTags:["trackedLinkCollection_noKey"],createModelFromRawJSON:s.create});return e};a.Models.TrackedLink=s})(Streak);(function(e){var t=e._,n=e.Date,i=e.Model,r=e.Collection,a=e.BentoBox,o=e.Gmail;var s=function(e){i.call(this,e)};s.prototype=Object.create(i.prototype);t.extend(s.prototype,{keyName:"apiKeyKey",entityType:"APIKey",createProperties:[],apiURLs:{create:"apikeys","delete":"apikeys/<%= apiKeyKey %>"},tagEntityName:"apiKey",getRequestTags:function(e){var t=i.prototype.getRequestTags.call(this,e);switch(e){case"CREATE":return t.concat(["apiKey_create_noKey","apiKeyCollection_noKey"]);break;case"DELETE":return t.concat(["apiKey_delete_noKey","apiKeyCollection_noKey"]);break}return t}});s.create=function(e){return new s(e)};s.createCollection=function(){var e=new r;e.init({modelKeyPropertyName:"apiKeyKey",apiURL:"apikeys",requestTags:["apiKeyCollection_noKey"],requestDependentOnTags:["apiKeyCollection_noKey"],refreshRequeueOperationTags:["apiKey_delete_noKey","apiKey_create_noKey"],createModelFromRawJSON:s.create});return e};a.Models.APIKey=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=200;var h=5;var f=e.Class.subclass({superclass:e.Object,_memberVariables:[{name:"_invitesSent",destroy:false},{name:"_shareModalSeen",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._shareModalSeen=false;this._getSentInvites();this._bindToSendEvents()},_getSentInvites:function(){e.APIRequester.get("apps/EmailTracking/invites").getPromise().then(this._processSentInvites.bind(this))},_processSentInvites:function(e){if(!e||!e.emailAddresses){this._invitesSent=false;return}if(e.emailAddresses.length>=h){this._invitesSent=true;return}this._invitesSent=false;return},_bindToSendEvents:function(){l.subscribe({eventName:"trackedEmailSent",functionToCall:this._trackedEmailSent,observer:this})},_trackedEmailSent:function(e){if(!e||!n.isNumber(e)){e=1}var t=c.LocalSettings.get("trackedEmails/currentCount");var i=a.create().getMonth();if(!t){c.LocalSettings.set("trackedEmails/currentCount",{count:e,month:i});return}if(!n.isNumber(t.count)){t.count=1}if(t.month!==i){c.LocalSettings.set("trackedEmails/currentCount/month",i);c.LocalSettings.set("trackedEmails/currentCount/count",e)}else{c.LocalSettings.set("trackedEmails/currentCount/count",t.count+e)}},_isUnderTheLimit:function(){var e=this._getTrackedEmailsSentThisMonth();return e<d},_getTrackedEmailsSentThisMonth:function(){var e=c.LocalSettings.get("trackedEmails/currentCount");var t=a.create().getMonth();if(!e){return 0}if(!n.isNumber(e.count)){e.count=1}if(e.month===t){return e.count}return 0},registerInvitesSent:function(t){e.APIRequester.post("apps/EmailTracking/invites",{emails:t});this._invitesSent=true},canTrackEmails:function(){if(this._invitesSent){return true}if(c.isFeatureEnabled("unlimitedPixelTracking")){return true}return this._isUnderTheLimit()},isTrackingEnabled:function(){return true},hasSentInvites:function(){return this._invitesSent},shouldShowShareModalOnOpen:function(){return!this._shareModalSeen},registerSeenShareModal:function(){this._shareModalSeen=true}});e.DependencyManager.addFunction({functionKey:"pixelTrackingLimiterInitialized",functionToCall:function(e){i.set("BentoBox.Services.PixelTrackingLimiter",new f);if(e){e()}},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={RECENT_VIEWS_URL_KEY:"label%3Aall+before%3A5000%2F01%2F01"};var h={isRecentViewsResultsPage:function(){var e=location.hash||"";return location.hash.indexOf("#search/label%3Aall+before%3A5000%2F01%2F01")>-1&&r.getMainList()&&(r.getMainList().find("[streakthreadid]").length>0||r.getMainList().find("[streakhiderow]").length>0)}};i.set("BentoBox.Modules.PixelTrackerUtils",h)})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.BentoBox.Data,r=e.HTML,a=e.Locale,o=e.BentoBox,s=e._,l=e.Gmail.GmailConversationGeometryModel.BLOCK_TYPES;var u=function(e,t){this._messageBlocks=e.getMessageBlocks();this._trackedLinks=t.links;this._processedMessageBlocks=[];this._updateBlockGeometry();this._matchMessageBlocks();this._processViewInformationForBlocks()};u.MATCH_TYPES={UNMATCHED:"UNMATCHED",MATCHED:"MATCHED"};s.extend(u.prototype,{_updateBlockGeometry:function(){var t=n.getCurrentMain().find("td.Bu").first().offset();var i=e.$("#streakSidebar .__streak_CS_body").offset();var r=0;if(t&&i){r=t.top-i.top}for(var a=0;a<this._messageBlocks.length;a++){var o=this._messageBlocks[a];o.sidebarGeometry={top:o.geometry.top+r,bottom:o.geometry.bottom+r,middle:o.geometry.middle+r}}},_matchMessageBlocks:function(){if(!this._messageBlocks){return}var e;var t=0;var n=-1;var i=[];var r=[];for(;t<this._messageBlocks.length;t++){i.length=0;var a=this._messageBlocks[t];var o=this._extractGuid(a);if(o){for(e=n+1;e<this._trackedLinks.length;e++){var l=this._trackedLinks[e];if(o===l.guid){if(r.length>0){this._processedMessageBlocks.push(this._groupMessageBlocks(r,s.clone(i)));r.length=0}a.trackedLink=l;a.matchType=u.MATCH_TYPES.MATCHED;this._processedMessageBlocks.push(a);n=e;break}else{i.push(l)}}if(e===this._trackedLinks.length){r.push(a)}}else{r.push(a)}}if(r.length>0){for(e=n+1;e<this._trackedLinks.length;e++){i.push(this._trackedLinks[e])}this._processedMessageBlocks.push(this._groupMessageBlocks(r,i))}},_getNextPotentialMatchBlockIndex:function(e){for(var t=e;t>-1;t--){var n=this._messageBlocks[t];if(n&&n.type===l.EXPANDED&&n.sender.email===o.getUser().getEmail()){return t}}return-1},_getNextTrackedLinkIndex:function(e,t){for(var n=e;n>-1;n--){var i=this._trackedLinks[n];if(i&&i.guid===t){return n}}return-1},_getUnmatchedBlocks:function(e,t){var n=[];for(var i=e-1;i>t;i--){var r=this._messageBlocks[i];if(r){n.push(r)}}return n.reverse()},_extractGuid:function(n){if(n.type===l.EXPANDED&&n.sender.email===o.getUser().getEmail()){var i=n.body;var r=i.find('> div > img[src*="'+e.server+'"]');r=t.merge(r,i.find("> div > div").first().find('img[src*="'+e.server+'"]'));var a=[];for(var s=0;s<r.length;s++){var u=r[s].src;var c=u.indexOf("guid=");if(c>-1){a.push(u.substring(c+5))}}a.sort().reverse();return a[0]}},_groupMessageBlocks:function(t,i){var r=n.getCurrentMain().find("td.Bu").first().offset();var a=e.$("#streakSidebar .__streak_CS_body").offset();var o=0;if(r&&a){o=r.top-a.top}var l=t[0];var c=s.last(t);var d={el:[],matchType:u.MATCH_TYPES.UNMATCHED,trackedLinks:i};var h={left:l.geometry.left,width:l.geometry.width,top:l.geometry.top,bottom:c.geometry.bottom,height:c.geometry.bottom-l.geometry.top};h.middle=(h.top+h.bottom)/2;d.geometry=h;d.sidebarGeometry={top:h.top+o,bottom:h.bottom+o,middle:h.middle+o};for(var f=0;f<t.length;f++){d.el=d.el.concat(t[f].el)}return d},_processViewInformationForBlocks:function(){for(var e=0;e<this._processedMessageBlocks.length;e++){this._processMessageBlockViews(this._processedMessageBlocks[e])}},_processMessageBlockViews:function(e){var t=[];var n={};var i=-1;var r;if(e.trackedLink){r=[e.trackedLink]}else if(e.trackedLinks){r=e.trackedLinks}for(var a=0;a<r.length;a++){t=t.concat(r[a].views)}for(var a=0;a<t.length;a++){var o=t[a];if(o.timestamp>i){i=o.timestamp}if(s.isNotReal(n[o.displayName])){n[o.displayName]={displayName:o.displayName,viewCount:1,mostRecentView:o.timestamp,requestInformation:o.requestInformation}}else{var l=n[o.displayName];if(l.mostRecentView<o.timestamp){l.mostRecentView=o.timestamp;l.requestInformation=o.requestInformation}l.viewCount+=1}}e.processedViews=s(n).chain().values(n).sortBy(function(e){return e.mostRecentView}).reverse().value();e.views=t;e.identifier=t.length+"_"+i},getMessageBlocks:function(){return this._processedMessageBlocks},fakefuxn:null});o.Modules.PixelTrackerDetailsModel=u})(Streak);(function(e){var t=e._,n=e.$,i=e.Gmail,r=e.Date,a=e.APIRequester,o=e.Model,s=e.Collection,l=e.BentoBox;var u=function(){var e=this};t.extend(u.prototype,{getViewsLimited:function(e,t){var n=this;var i=n._getViews(e);var r=n._mergeViewsByDisplayName(i);return r.splice(0,t)},_mergeViewsByDisplayName:function(e){var n=this;var i={};t.each(e,function(e){var n=e.displayName;if(!t.isReal(i[n])){i[n]=[]}i[n].push(e)});var r=[];t.each(i,function(e,t){var i=n._getLatestTimestamp(e);var a={displayName:t,device:i.device,timesViewed:e.length,lastSeen:i.timestamp};r.push(a)});r=t.sortBy(r,function(e){return e.lastSeen});return r},_getLatestTimestamp:function(e){var n=this;var i=t.sortBy(e,function(e){return e.timestamp});return i[0]},_getViews:function(e){var n=this;var i=[];t.each(e,function(e){i=i.concat(e.views)});return i},ffdsfs12342132jkdjksdkjdfsfs:null});l.Modules.PixelTrackerViewsHelper=u})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._,s=e.BentoBox.Modules.PixelTrackerDetailsModel.MATCH_TYPES;
var l=function(){this._delegates=[];this._templates={};this._templates.circle=i.get("pixelTrackerCircle");this._templates.line=i.get("pixelTrackerLine");this._container=t("<div></div>");this._messageBlocks=null;this._singleBlock=null;this._isInSingleMode=false};o.extend(l.prototype,{addDelegate:function(e){var t=this;t._delegates.push(e)},getElement:function(){var e=this;return e._container},destroy:function(){var e=this;e._container.remove()},refresh:function(e){var t=this;t._messageBlocks=e;t._setLeftPosition();t._container.height(o.last(e).sidebarGeometry.bottom);if(t._isInSingleMode){var n=o.find(e,function(e){return e.identifier===t._singleBlock.identifier});if(n){this._singleBlock=n;this._refreshDetailMode()}}else{t._container.empty();t._refreshCirclesAndLines()}},_setLeftPosition:function(){if(this._isMarginBetweenConversationAndSidebarWide()){this._container.parent().css("left","")}else{this._container.parent().css("left","-18px")}},_isMarginBetweenConversationAndSidebarWide:function(){var e=n.getCurrentMain().find("td.Bu").first().find("> .if").css("margin-right");try{if(parseInt(e,10)<20){return false}else{return true}}catch(t){return true}},renderDetailMode:function(e){this._isInSingleMode=true;this._singleBlock=e;this._refreshDetailMode()},_refreshDetailMode:function(){this._container.empty();this._renderCircle(this._singleBlock);this._renderVerticalLine(this._getTopMostPosition(),this._singleBlock.sidebarGeometry.middle);this._renderVerticalLine(this._singleBlock.sidebarGeometry.middle,this._getBottomMostPosition())},_getTopMostPosition:function(){var e=o.first(this._messageBlocks);if(e){return e.sidebarGeometry.top}return 0},_getBottomMostPosition:function(){var e=o.last(this._messageBlocks);if(e){return e.sidebarGeometry.bottom}return 0},renderListMode:function(){this._isInSingleMode=false;this._container.empty();this._refreshCirclesAndLines()},_refreshCirclesAndLines:function(){this._renderCircles();this._renderLines()},_renderCircles:function(){for(var e=0;e<this._messageBlocks.length;e++){this._renderCircle(this._messageBlocks[e])}},_renderCircle:function(e,n){var i=this;var r=n||e.sidebarGeometry.middle;var a=t(i._templates.circle());a.css({top:r+"px",left:0+"px"});if(e.matchType===s.UNMATCHED){if(e.trackedLinks&&e.trackedLinks.length>0){a.addClass("streak__pt_unmatchedCircle")}else{a=null}}if(a){a.click(function(){if(i._isInSingleMode){i._callZoomOutDelegates(e)}else{i._callZoomInDelegates(e)}});this._container.append(a);return a}},_renderLines:function(){var e=false;var t=0;for(var n=0;n<this._messageBlocks.length;n++){var i=this._messageBlocks[n];if(i.matchType===s.MATCHED){if(e){this._renderVerticalLine(t,i.sidebarGeometry.middle)}else{this._renderVerticalLine(i.sidebarGeometry.top,i.sidebarGeometry.middle)}if(n>0||n===this._messageBlocks.length-1){this._renderVerticalLine(i.sidebarGeometry.middle,i.sidebarGeometry.bottom);t=i.sidebarGeometry.bottom}else{t=i.sidebarGeometry.middle}e=true}else{if(e){this._renderVerticalLine(t,i.sidebarGeometry.top)}this._renderVerticalLine(i.sidebarGeometry.top,i.sidebarGeometry.bottom,true);this._renderHorizontalLine(i.sidebarGeometry.top);this._renderHorizontalLine(i.sidebarGeometry.bottom);e=false}}},_renderVerticalLine:function(e,n,i){var r=t(this._templates.line());r.css({top:e+"px",height:n-e+"px"});if(i){r.addClass("streak__pt_dashedBorder")}this._container.append(r);return r},_renderHorizontalLine:function(e){var n=t(this._templates.line());n.css({top:e+"px"});n.addClass("streak__pt_horizontalBorder");this._container.append(n)},_callZoomOutDelegates:function(e){var t=this;o.each(t._delegates,function(t){if(o.isReal(t.circleDidZoomOut)){t.circleDidZoomOut(e,true)}});u("pixel_track_show_overview",{source:"circleLine"})},_callZoomInDelegates:function(e){var t=this;o.each(t._delegates,function(t){if(o.isReal(t.circleDidZoomIn)){t.circleDidZoomIn(e,true)}});u("pixel_track_show_detail",{source:"circleLine"})}});var u=function(e,t){a.Tracker.trackStreakActive(t,{eventName:e})};a.Modules.PixelTrackerCircleLineView=l})(Streak);(function(e){var t=e._,n=e.$,i=e.Gmail,r=e.Date,a=e.APIRequester,o=e.Model,s=e.Collection,l=e.BentoBox;var u=function(){var e=this;e._delegates=[];e._view=new l.Modules.PixelTrackerCircleLineView;e._view.addDelegate(e)};t.extend(u.prototype,{addDelegate:function(e){var t=this;t._delegates.push(e)},_callDelegatesForCricleZoomOut:function(){var e=this;t.each(e._delegates,function(e){if(t.isReal(e.circleDidZoomOut)){e.circleDidZoomOut()}})},_callDelegatesForCricleZoomIn:function(e){var n=this;t.each(n._delegates,function(n){if(t.isReal(n.circleDidZoomIn)){n.circleDidZoomIn(e)}})},gmailThreadRowsChanged:function(e){var t=this;t._view.refresh(e)},lessDetailsLinkClick:function(){var e=this;e._view.renderListMode();l.Tracker.track("pixel tracking less details clicked")},moreDetailsLinkClick:function(e){var t=this;t._view.renderDetailMode(e);l.Tracker.track("pixel tracking more details clicked")},circleDidZoomOut:function(){var e=this;e._callDelegatesForCricleZoomOut();e.lessDetailsLinkClick();l.Tracker.track("pixel tracking circle zoom out")},circleDidZoomIn:function(e){if(!e.processedViews||e.processedViews.length===0){return}var t=this;t._callDelegatesForCricleZoomIn(e);t.moreDetailsLinkClick(e);l.Tracker.track("pixel tracking circle zoom in")},destroy:function(){var e=this;e._view.destroy()}});l.Modules.ConversationCircleLineViewController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Gmail,a=e.Locale,o=e.HTML,s=e.BentoBox.Data,l=e.BentoBox;var u=function(t){e.ViewControllerBase.call(this);this._view=new l.Modules.PixelTrackerSidebarView;this._circleSidebarController=null;this._infoSidebarController=null;this._trackedLinkMatchController=null;this._trackedThread=t;this._setupSubViewControllers()};u.prototype=Object.create(e.ViewControllerBase.prototype);n.extend(u.prototype,{getElement:function(){return this._view.getElement()},_setupSubViewControllers:function(){this._view.removeLoading();this._circleSidebarController=new l.Modules.ConversationCircleLineViewController;this._view.addCircleLineSubView(this._circleSidebarController._view);this._infoSidebarController=new l.Modules.TrackedLinkInformationViewController;this._view.addTrackedInfoView(this._infoSidebarController._view);this._trackedLinkMatchController=new l.Modules.TrackedLinkMatchController(this._trackedThread);this._trackedLinkMatchController.addDelegate(this._circleSidebarController);this._trackedLinkMatchController.addDelegate(this._infoSidebarController);this._infoSidebarController.addDelegate(this._circleSidebarController);this._circleSidebarController.addDelegate(this._infoSidebarController);l.Tracker.track("pixelTrackerSidebarShown")},matchLinksToMessages:function(){this._trackedLinkMatchController.matchLinksToMessages()},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});if(this._view){this._view.destroy()}if(this._circleSidebarController){this._circleSidebarController.destroy();this._circleSidebarController=null}if(this._infoSidebarController){this._infoSidebarController.destroy();this._infoSidebarController=null}if(this._trackedLinkMatchController){this._trackedLinkMatchController.destroy();this._trackedLinkMatchController=null}e.ViewControllerBase.prototype.destroy.call(this)}});l.Modules.PixelTrackerSidebarViewController=u})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var e=this;var n=t(i.get("pixelTrackerContainer")());e._container=n;e._circleContainer=n.find(".streak_circle_container");e._infoContainer=n.find(".streak_info_container");e._addSpaceToConversationHeader()};o.extend(s.prototype,{getElement:function(){var e=this;return e._container},removeLoading:function(){this._container.find(".pt_info_main_loading").remove()},addCircleLineSubView:function(e){var t=this;t._circleView=e;t._circleContainer.append(e.getElement())},destroy:function(){this._container.remove();this._container=null;this._circleContainer=null;this._infoContainer=null},addTrackedInfoView:function(e){var t=this;t._infoView=e;t._infoContainer.append(e.getElement())},_addSpaceToConversationHeader:function(){n.getConversationSubjectHeader().addClass("streak__pixelTrackConversationSubject")}});a.Modules.PixelTrackerSidebarView=s})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e.BentoBox.Data,s=e._;var l=function(e){this._trackedThread=e;this._unbindFunctions=[];this._delegates=[];this._conversationWatcher=new n.GmailConversationWatchController;this._conversationWatcher.addDelegate(this)};s.extend(l.prototype,{matchLinksToMessages:function(){this._conversationWatcher.processConversation()},gmailThreadRowsChanged:function(e){this._gmailMessagesModel=e;this._callDelegatesForGmailMessagesChange()},_callDelegatesForGmailMessagesChange:function(){if(!s.isReal(this._trackedThread)||!s.isReal(this._gmailMessagesModel)){return}var e=new a.Modules.PixelTrackerDetailsModel(this._gmailMessagesModel,this._trackedThread);var t=e.getMessageBlocks();for(var n=0;n<this._delegates.length;n++){var i=this._delegates[n];if(i.gmailThreadRowsChanged){i.gmailThreadRowsChanged(t)}}},addDelegate:function(e){var t=this;t._delegates.push(e)},destroy:function(){this._conversationWatcher.destroy();this._delegates.length=0;this._delegates=null}});a.Modules.TrackedLinkMatchController=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.Date,r=e.HTML,a=e.Locale,o=e.BentoBox,s=e._;var l=function(){var e=this;e._delegates=[];e._templates={};e._templates.entry=r.get("pt_overview_view_entry");e._templates.viewsHeader=r.get("pt_views");e._el=t(r.get("pt_detail_block")());e._blockContainer=e._el.find(".streak__pt_detail_container");e._mapContainer=e._el.find(".streak__pt_map_container");e._graphContainer=e._el.find(".streak__pt_graph_container");e._viewCountContainer=e._el.find(".streak__pt_view_count_container");e._barChartView=null;e._mapFrame=null;e._bindButtonEvent(e._el.find(".button"));e._setupIFrames()};s.extend(l.prototype,{_setupIFrames:function(){this._barChartView=e.Library.get("UI.ChartFactory").createChart({type:"columnChart",chartArea:{left:20,top:10,width:190,height:100},hAxis:{format:"EEE",gridlines:{color:"white"}},vAxis:{gridlines:{color:"white"}},legend:{position:"none"},width:190,height:125});this._mapFrame=new o.Widgets.IframeBridge({path:"mapiFrame",cssClass:"__streak_PT_mapiFrame"});this._graphContainer.append(this._barChartView.getElement());this._mapContainer.append(this._mapFrame.getFrameElement())},refresh:function(e){var n=this;n._blockContainer.empty();var i=n._getViewCount(e.processedViews);var r=n._getUniqueViewCount(e);var a=t(n._templates.viewsHeader({viewCount:i,uniqueViews:r}));var l=o.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:"?",onFunction:function(){o.Modules.Help.HelpLoader.getHelpViewController().startChapter("Email Tracking FAQ")}});a.append(l.getElement());n._viewCountContainer.empty();n._viewCountContainer.append(a);n._blockContainer.empty();n._renderGraph(e.views);n._renderMap(e.views);n._renderViewEntries(s.first(e.views,100))},getElement:function(){var e=this;return e._el},_getViewCount:function(e){var t=0;s.each(e,function(e){t+=e.viewCount});return t},_getUniqueViewCount:function(e){return e.processedViews.length},_renderGraph:function(t){var n=this._getViewPoints(t);for(var i=1;i<n.length;i++){n[i][0]=e.Date.create(n[i][0])}if(n.length===2){var r=n[1][0];n=n.concat([[e.Date.create(r).addDays(-1),0],[e.Date.create(r).addDays(1),0]])}this._barChartView.setData(n)},_getViewPoints:function(e){var t=this;var n={};s.each(e,function(e){var t=i.create(e.timestamp);t.resetTime();t=t.getTime();if(!s.isReal(n[t])){n[t]=0}n[t]++});var r=[];s.each(n,function(e,t){r.push([t,e])});r=s.sortBy(r,function(e){return e[0]});var a=[["Date","Views"]];return a.concat(r)},_renderMap:function(e){var t=this._getLatPoints(e);if(t&&t.length>0){this._mapFrame.sendMessage("loadMap",t);this._mapContainer.show()}else{this._mapContainer.hide()}},_getLatPoints:function(e){var t=this;return s.chain(e).filter(function(e){return e.requestInformation&&e.requestInformation.latLong&&(e.requestInformation.latLong.latitude!==0||e.requestInformation.latLong.longitude!==0)}).map(function(e){return{lat:e.requestInformation.latLong.latitude,lon:e.requestInformation.latLong.longitude}}).value()},_renderViewEntries:function(e){var t=this;e.reverse();for(var n=0;n<e.length;n++){var i=t._renderViewEntry(e[n]);t._blockContainer.append(i)}},_renderViewEntry:function(n){var i=this;var r=i._getDate(n);var a=e.moment(n.timestamp).fromNow();return t(i._templates.entry({name:n.displayName,dateTime:r,longDateTime:a,location:i._getLocation(n),iconClass:u.DEVICE_MAP[n.requestInformation.device],deviceName:o.Locale.getString(u.TRANSLATION_MAP[n.requestInformation.device])}))},_getDate:function(e){var t="<b>"+i.create(e.timestamp).customFormat("pixelTrack")+"</b>";return t},_getLocation:function(e){var t=e.requestInformation.city;var n=e.requestInformation.region;var i;if(t&&t!=="?"){i=t.capitalize(true);if(n){i+=", "+n.toUpperCase()}}else if(n&&n!=="?"){i=n.toUpperCase()}else{i=""}return i},_bindButtonEvent:function(e){var t=this;e.click(function(){t._callClickDelegates()})},_callClickDelegates:function(){var e=this;s.each(e._delegates,function(e){if(s.isReal(e.lessDetailsLinkClick)){e.lessDetailsLinkClick()}});c("pixel_track_show_overview",{source:"detailView"})},destroy:function(){this._mapFrame.destroy();this._blockContainer.remove()},addDelegate:function(e){var t=this;t._delegates.push(e)}});var u={DEVICE_MAP:{MAC:"streak__macIcon",WINDOWS_PC:"streak__windowsIcon",IPAD:"streak__ipadIcon",IPHONE:"streak__iphoneIcon",ANDROID_PHONE:"streak__androidPhoneIcon",ANDROID_TABLET:"streak__androidTabletIcon",OTHER:"streak__otherDeviceIcon",GMAIL_PROXY:"streak__gmailProxyIcon"},TRANSLATION_MAP:{MAC:"device_mac",WINDOWS_PC:"device_windows_pc",IPAD:"device_ipad",IPHONE:"device_iphone",ANDROID_PHONE:"device_android_phone",ANDROID_TABLET:"device_android_tablet",OTHER:"device_other",GMAIL_PROXY:"device_gmail_proxy"}};var c=function(e,t){o.Tracker.trackStreakActive(t,{eventName:e})};o.Modules.TrackedLinkDetailsView=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var e=this;e._delegates=[];e._view=new a.Modules.TrackedLinkDetailsView;e._view.addDelegate(e)};o.extend(s.prototype,{addDelegate:function(e){var t=this;t._delegates.push(e)},getView:function(){var e=this;return e._view},update:function(e){var t=this;t._view.refresh(e)},lessDetailsLinkClick:function(){var e=this;o.each(e._delegates,function(e){if(o.isReal(e.lessDetailsLinkClick)){e.lessDetailsLinkClick()}})},destroy:function(){this._view.destroy()}});a.Modules.TrackedLinkDetailsViewController=s})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.Date,r=e.HTML,a=e.Locale,o=e.BentoBox,s=e._;var l=function(){var e=this;e._templates={};e._templates.block=r.get("pt_overview_block");e._templates.emptyBlock=r.get("pt_overview_emptyBlock");e._templates.entry=r.get("pt_overview_view_entry");e._templates.viewsHeader=r.get("pt_views");e._el=t(r.get("pt_overview_block_container")());e._delegates=[]};s.extend(l.prototype,{_callDelegatesForClick:function(e){var t=this;s.each(t._delegates,function(t){if(s.isReal(t.moreDetailsLinkClick)){t.moreDetailsLinkClick(e)}})},addDelegate:function(e){var t=this;t._delegates.push(e)},getElement:function(){var e=this;return e._el},_getProcessedViewCount:function(e){var t=0;s.each(e,function(e){t+=e.viewCount});return t},_getViewCount:function(e){var t=this;var n=0;s.each(e,function(e){n+=t._getProcessedViewCount(e.processedViews)});return n},_getUniqueViewCount:function(e){var t=this;var n=0;s.each(e,function(e){n+=e.processedViews.length});return n},refresh:function(e){var n=this;n._el.empty();var i=n._getViewCount(e);var r=n._getUniqueViewCount(e);var a=t(n._templates.viewsHeader({viewCount:i,uniqueViews:r}));var l=o.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:"?",onFunction:function(){o.Modules.Help.HelpLoader.getHelpViewController().startChapter("Email Tracking FAQ")}});a.append(l.getElement());n._el.append(a);s.each(e,function(e){if(e.processedViews&&e.processedViews.length>0){n._renderBlock(e)}else if(s.isReal(e).trackedLinks&&e.trackedLinks.length>0||s.isReal(e.trackedLink)){n._renderEmptyBlock(e)}})},_renderEmptyBlock:function(e){var n=t(this._templates.emptyBlock());var i=e.sidebarGeometry.bottom-e.sidebarGeometry.top;n.css({top:e.sidebarGeometry.top+"px",height:i+"px"});this._el.append(n)},_renderBlock:function(e){var n=this;var i=t(n._templates.block());var r=e.sidebarGeometry.bottom-e.sidebarGeometry.top;i.css({top:e.sidebarGeometry.top+"px",height:r+"px"});var a=Math.max(Math.floor((r-20)/50),0);n._renderViewEntries(i.find(".streak__pt_viewEntries"),e.processedViews,a);i.find(".streak__pt_detailsLink").click(function(){n._callDelegatesForClick(e)});this._el.append(i)},_renderViewEntries:function(e,t,n){var i=this;for(var r=0;r<Math.min(t.length,n);r++){var a=i._renderViewEntry(t[r]);e.append(a)}},_renderViewEntry:function(e){var n=this;var r=n._getDate(e);var a=i.create(e.mostRecentView).customFormat("longDateTime");return t(n._templates.entry({name:e.displayName,dateTime:r,longDateTime:a,location:n._getLocation(e),iconClass:u.DEVICE_MAP[e.requestInformation.device],deviceName:o.Locale.getString(u.TRANSLATION_MAP[e.requestInformation.device])}))},_getDate:function(t){var n=e.moment(t.mostRecentView).fromNow();var i=a.getString("pt_viewed");var r=i+"<b>"+n+"</b>";return r},_getLocation:function(e){var t=e.requestInformation.city;var n=e.requestInformation.region;var i;if(t&&t!=="?"){i=t.capitalize(true);if(n){i+=", "+n.toUpperCase()}}else if(n&&n!=="?"){i=n.toUpperCase()}else{i=""}return i},refreshingTrackedThread:function(){this._el.find(".pt_views_refreshing").show()},destroy:function(){this._el.remove()}});var u={DEVICE_MAP:{MAC:"streak__macIcon",WINDOWS_PC:"streak__windowsIcon",IPAD:"streak__ipadIcon",IPHONE:"streak__iphoneIcon",ANDROID_PHONE:"streak__androidPhoneIcon",ANDROID_TABLET:"streak__androidTabletIcon",OTHER:"streak__otherDeviceIcon",GMAIL_PROXY:"streak__gmailProxyIcon"},TRANSLATION_MAP:{MAC:"device_mac",WINDOWS_PC:"device_windows_pc",IPAD:"device_ipad",IPHONE:"device_iphone",ANDROID_PHONE:"device_android_phone",ANDROID_TABLET:"device_android_tablet",OTHER:"device_other",GMAIL_PROXY:"device_gmail_proxy"}};o.Modules.TrackedLinkOverviewView=l})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var t=this;e.ViewControllerBase.call(this);t._view=new a.Modules.TrackedLinkOverviewView;t._view.addDelegate(t)};s.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(s.prototype,{getView:function(){var e=this;return e._view},destroy:function(){var e=this;if(o.isReal(e._view)){e._view.destroy()}},gmailThreadRowsChanged:function(e){this._view.refresh(e)},moreDetailsLinkClick:function(e){this._callDelegateFunction("moreDetailsLinkClick",e)},refreshingTrackedThread:function(){this._view.refreshingTrackedThread()},trackedThreadRefreshed:function(){this._view.trackedThreadRefreshed()}});a.Modules.TrackedLinkOverviewViewController=s})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var e=this;e._delegates=[];e._el=t(i.get("pt_info_main_container")());e._activeView=null;e._detailView=null;e._overviewView=null;e._isDetailView=false;e._messageBlocks=null};o.extend(s.prototype,{setOverviewView:function(e){var t=this;t._overviewView=e;e.getElement().smallHide();t._el.append(e.getElement())},setDetailView:function(e){var t=this;t._detailView=e;e.getElement().smallHide();t._el.append(e.getElement())},detailsDidShow:function(){var e=this;if(o.isReal(e._activeView)){e._activeView.getElement().smallHide()}e._activeView=e._detailView;e._activateNewActiveView();e._isDetailView=true;e._setDetailViewHeight()},overviewDidShow:function(){var e=this;if(o.isReal(e._activeView)){e._activeView.getElement().smallHide()}e._activeView=e._overviewView;e._activateNewActiveView();e._isDetailView=false;e._setOverviewHeight()},gmailThreadRowsChanged:function(e){this._messageBlocks=e;if(this._isDetailView){this._setDetailViewHeight()}else{this._setOverviewHeight()}},_setOverviewHeight:function(){if(!this._messageBlocks){return}var e=o.last(this._messageBlocks);this._el.height(e.geometry.bottom);this._el.removeClass("pt_info_main_container__detailView")},_setDetailViewHeight:function(){if(!this._messageBlocks){return}var e=o.last(this._messageBlocks);this._el.css("height","");this._el.addClass("pt_info_main_container__detailView")},_activateNewActiveView:function(){var e=this;e._activeView.getElement().smallShow()},getElement:function(){var e=this;return e._el},refresh:function(){var e=this;e._activeView.refresh()},destroy:function(){var e=this;if(o.isReal(e._view)&&o.isReal(e._view.remove)){e._el.remove()}}});var l=function(e,t){a.Tracker.trackStreakActive(t,{eventName:e})};a.Modules.TrackedLinkInformationView=s})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=function(){var n=this;e.ViewControllerBase.call(this);n._view=new a.Modules.TrackedLinkInformationView;n._overviewController=new a.Modules.TrackedLinkOverviewViewController;n._overviewController.addDelegate(n);n._view.setOverviewView(n._overviewController.getView());n._detailsController=new a.Modules.TrackedLinkDetailsViewController;n._detailsController.addDelegate(n);n._view.setDetailView(n._detailsController.getView());n._viewRefreshCallback=t.noop();n._view.overviewDidShow()};s.prototype=Object.create(e.ViewControllerBase.prototype);o.extend(s.prototype,{gmailThreadRowsChanged:function(e){var t=this;t._overviewController.gmailThreadRowsChanged(e);t._view.gmailThreadRowsChanged(e)},moreDetailsLinkClick:function(e){var t=this;t._detailsController.update(e);t._view.detailsDidShow();t._callDelegateFunction("moreDetailsLinkClick",e)},circleDidZoomIn:function(e){var t=this;t._detailsController.update(e);t._view.detailsDidShow()},circleDidZoomOut:function(){var e=this;e._view.overviewDidShow()},lessDetailsLinkClick:function(){var e=this;e._view.overviewDidShow();e._callDelegateFunction("lessDetailsLinkClick")},refreshingTrackedThread:function(){this._callDelegateFunction("refreshingTrackedThread")},destroy:function(){var e=this;this._overviewController.destroy();this._detailsController.destroy();this._view.destroy()}});a.Modules.TrackedLinkInformationViewController=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u=e.Class.subclass({className:"PixelTrackerSidebarMasterController",superclass:e.Object,_memberVariables:[{name:"_threadView",destroy:false},{name:"_sidebarInjector",destroy:true},{name:"_sidebarOptions",destroy:false},{name:"_trackedThreadSidebarViewController",destroy:true},{name:"_rapportiveSidebarViewController",destroy:true},{name:"_trackedThread",destroy:false}],_initialize:function(e){this._sidebarOptions={title:l.Locale.getString("pixel_track_sidebar_tab_title"),el:document.createElement("div"),orderHint:5};this._sidebarInjector=new l.Controllers.SidebarInjector(e,{notificationCenterEventName:"threadStorerDataChanged",notificationCenterFilterValueType:"trackedThread",checkState:this._handleTrackedThreadSet.bind(this),destroy:this.destroy.bind(this)});this._threadView=e},_handleTrackedThreadSet:function(e,t){var n;if(t){n=t.value}else{n=l.Services.Threads.ThreadStorer.getTrackedThread(e)}this._loadTrackedThreadSidebar(n)},_loadTrackedThreadSidebar:function(e){if(this._trackedThread===e){return}this._trackedThread=e;if(!e||!e.links){this._removeSidebars()}else{if(this._trackedThreadSidebarViewController){this._trackedThreadSidebarViewController.destroy();this._trackedThreadSidebarViewController=null}if(this._rapportiveSidebarViewController){this._rapportiveSidebarViewController.destroy();this._rapportiveSidebarViewController=null}this._trackedThreadSidebarViewController=new l.Modules.PixelTrackerSidebarViewController(e);this._sidebarOptions.iconClass=this._getTabIconClass(e);this._sidebarOptions.el.appendChild(this._trackedThreadSidebarViewController.getElement()[0]);this._sidebarInjector.addSidebar(this._sidebarOptions);this._trackedThreadSidebarViewController.matchLinksToMessages();if(l.Services.RapportiveStatusController.isEnabled()){this._rapportiveSidebarViewController=new l.Modules.RapportiveSidebarViewController(this._threadView)}}},_getTabIconClass:function(e){var t="streak__sidebar_openEyeIcon";if(e.totalViews){t+=" streak__sidebar_openEyeIconViewed"}return t},_removeSidebars:function(){if(this._trackedThreadSidebarViewController){this._trackedThreadSidebarViewController.destroy();this._trackedThreadSidebarViewController=null}if(this._rapportiveSidebarViewController){this._rapportiveSidebarViewController.destroy();this._rapportiveSidebarViewController=null}this._sidebarInjector.removeSidebar()}});e.DependencyManager.addFunction({functionKey:"pixelTrackerSidebarMasterControllerInitialized",functionReference:function(){a.inboxSDK.Conversations.registerThreadViewHandler(function(e){new u(e)})},dependentFunctionKeys:["gmailLoaded","chartsInitialized"]});l.Controllers.PixelTrackerSidebarMasterController=u})(Streak);(function(e){var t=e.jQuery,n=e.Bacon,i=e.Gmail,r=e.HTML,a=e.Locale,o=e.BentoBox,s=e._;var l=e.Class.subclass({superclass:o.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_usedSnippets",destroy:false},{name:"_isTrackedSend",destroy:true},{name:"_shareModal",destroy:true},{name:"_buttonOptions",destroy:false},{name:"_buttonOptionStream",destroy:false},{name:"_backupContacts",destroy:false}],_initialize:function(){o.Modules.ComposeViewControllerBase.prototype._initialize.call(this);this._usedSnippets=[];this._guid=null;this._isTrackedSend=false;this._shareModal=null;this._buttonOptionStream=new n.Bus},initialize:function(e){this._composeWindowViewController=e;this._setupTrackingToggleButton();setTimeout(this._checkAndNotifyStatus.bind(this),1);return this},_checkAndNotifyStatus:function(){this._isTrackedSend=this._shouldTrackByDefault()&&o.Services.PixelTrackingLimiter.isTrackingEnabled();if(this._shouldTrack()&&this._overLimit()){this._setCurrentTrackingStatusOff(o.Locale.getString("tracking_over_limit"));this._showShareModalOnOpen();return}if(this._shouldTrack()){this._setCurrentTrackingStatusOn()}else{this._setCurrentTrackingStatusOff()}},_overLimit:function(){return!o.Services.PixelTrackingLimiter.canTrackEmails()},turnOffTracking:function(){this._setCurrentTrackingStatusOff();this._composeWindowViewController.setModuleInactive("pixelTracking");this._composeWindowViewController.notify("pixelTrackingOff")},sendLaterScheduled:function(){this._buttonOptions.enabled=false;this._buttonOptionStream.push(this._buttonOptions);this._setCurrentTrackingStatusOff(o.Locale.getString("tracking_off_because_send_later"))},sendLaterCancelled:function(){this._buttonOptions.enabled=true;this._buttonOptionStream.push(this._buttonOptions)},_setupTrackingToggleButton:function(){var t=this;this._buttonOptions={iconClass:"streak__pixelTrackerIconOnCompose streak__pixelTrackerOnComposeButton",type:"MODIFIER",orderHint:2,onClick:function(){t._toggleTracking()}};this._composeWindowViewController.getComposeView().addButton(this._buttonOptionStream);this._buttonOptionStream.push(this._buttonOptions);e.NotificationCenter.subscribe({eventName:"defaultTrackingSettingChanged",functionToCall:this._notificationToggleTracking,observer:this})},_notificationToggleTracking:function(){if(this._shouldTrackByDefault()){this._setCurrentTrackingStatusOn()}else{this._setCurrentTrackingStatusOff()}},_toggleTracking:function(){if(!o.Services.PixelTrackingLimiter.canTrackEmails()){this._showShareModal();return}if(this._shouldTrack()){this._setTrackingOff();o.Tracker.track("pixel tracking toggled on")}else{this._setTrackingOn();o.Tracker.track("pixel tracking toggled off")}},_setTrackingOn:function(){u("pixel_track_disable");this._setCurrentTrackingStatusOn();this._composeWindowViewController.setModuleActive("pixelTracking");this._composeWindowViewController.notify("pixelTrackingOn")},_setTrackingOff:function(){u("pixel_track_enable");this._setCurrentTrackingStatusOff();this._composeWindowViewController.setModuleInactive("pixelTracking");this._composeWindowViewController.notify("pixelTrackingOff")},_setCurrentTrackingStatusOn:function(){this._isTrackedSend=true;this._buttonOptions.iconClass="streak__pixelTrackerIconOnCompose streak__pixelTrackerOnComposeButton";this._buttonOptions.tooltip=o.Locale.getString("pixel_track_current_on");this._buttonOptionStream.push(this._buttonOptions);if(this._composeWindowViewController){this._composeWindowViewController.setModuleActive("pixelTracking");this._composeWindowViewController.notify("pixelTrackingOn")}},_setCurrentTrackingStatusOff:function(e){this._isTrackedSend=false;this._buttonOptions.iconClass="streak__pixelTrackerIconOnCompose streak__pixelTrackerOnComposeButton streak__pixelTrackerIcon_unselected";this._buttonOptions.tooltip=e||o.Locale.getString("pixel_track_current_off");this._buttonOptionStream.push(this._buttonOptions);if(this._composeWindowViewController){this._composeWindowViewController.setModuleInactive("pixelTracking");this._composeWindowViewController.notify("pixelTrackingOff")}},_setSavedTrackingStatus:function(e){o.UserSettings.set("pixelTracker/shouldTrack",e);o.UserSettings.saveSettings()},_shouldTrackByDefault:function(){return o.Data.streakSettings.settingIsEnabled("tracking_default_on_setting")},_shouldTrack:function(){return this._isTrackedSend&&this._composeWindowViewController.getActiveModules().indexOf("sendLater")===-1},aboutToSend:function(){if(this._shouldTrack()){this._injectTrackingHTML();this._backupContacts=this._composeWindowViewController.getToContacts();e.NotificationCenter.subscribe({eventName:"rfcMessageIdForSentEmailFound",filterParameters:{composeid:this._composeWindowViewController.getComposeid()},observer:this,functionToCall:function(e){this._createTrackedLink(this._guid,e.threadMetaData,this._getUsedSnippetKeys())}})}},_showShareModalOnOpen:function(){if(o.Services.PixelTrackingLimiter.shouldShowShareModalOnOpen()){o.Modules.Help.HelpLoader.getHelpViewController().startChapter("Tracking limit reached")}},_showShareModal:function(){this._shareModal=e.Library.getInstance("BentoBox.Modules.PixelTrackingShareModalViewController");this._shareModal.show(function(){});o.Services.PixelTrackingLimiter.registerSeenShareModal()},_injectTrackingHTML:function(){this._guid=o.PixelTrackingHTMLGenerator.injectTrackingHTML(this._composeWindowViewController)},_createTrackedLink:function(t,n,i){var r=n.hexGmailThreadId;var a=n.rfcMessageId;var s=n.subject;var l=n.emailAddresses;var c=n.names;if(!l||!c||l.length===0||c.length===0){l=this._getBackupEmailAddresses();c=this._getBackupNames()}var d=new e.BentoBox.Models.TrackedLink({guid:t,hexGmailThreadId:r,subject:s,names:c,emails:l,snippetKeyList:i,isMailMerge:false,rfcMessageId:a});d.save();e.NotificationCenter.postNotification({eventName:"trackedEmailSent",sender:this});o.Modules.PixelTrackerConversationImageFixer.sendIgnoreImageRequest(t);u("pixel_track_email_sent")},snippetAdded:function(e){this._usedSnippets.push(e)},mailHelperSendingEmails:function(){this._isTrackedSend=false},_getUsedSnippetKeys:function(){return s.map(this._usedSnippets,function(e){return e.key()})},_getBackupEmailAddresses:function(){if(!this._backupContacts){return[]}return s.pluck(this._backupContacts,"emailAddress")},_getBackupNames:function(){if(!this._backupContacts){return[]}return s.pluck(this._backupContacts,"name")},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});o.Modules.ComposeViewControllerBase.prototype.destroy.call(this)}});var u=function(e,t){o.Tracker.trackStreakActive(t,{eventName:e})};o.Modules.PixelTrackerOnComposeViewController=l
})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailComposeManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){return[new s.Modules.PixelTrackerOnComposeViewController]}});o.addFunction({functionKey:"pixelTrackerOnComposeMasterControllerInitialized",functionToCall:function(e){if(!s.Modules.PixelTrackerOnComposeMasterController){s.Modules.PixelTrackerOnComposeMasterController=new l}if(e){e()}},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","gmailLoaded","userLoggedIn","pixelTrackingLimiterInitialized","data.streakSettings.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e.Gmail,i=e.HTML,r=e.Locale,a=e.BentoBox,o=e._;var s=e.Class.subclass({superclass:a.Modules.PixelTrackerOnComposeViewController,_memberVariables:[{name:"_threadId",destroy:false}],initialize:function(e){a.Modules.PixelTrackerOnComposeViewController.prototype.initialize.call(this,e)},_showShareModalOnOpen:function(){},aboutToSend:function(){if(!this._shouldTrack()){return}this._injectTrackingHTML();var e=this._getReplyThreadMetaData();var t=this._guid;var i=this._getUsedSnippetKeys();var r=this;n.RFCMessageIdExtractor.getRFCMessageIdForThread(e.hexGmailThreadId,function(n){if(!n){return}e.rfcMessageId=n;r._createTrackedLink(t,e,i)});a.Tracker.track("pixel tracking send tracked reply")},_getReplyThreadMetaData:function(){var e=n.getActiveHexGmailThreadIdList(a.Services.Threads.HexGmailThreadIdExtractor);if(!e||e.length===0){return}var t=this._composeWindowViewController.getThreadMetaData();t.hexGmailThreadId=e[0];return t}});a.Modules.PixelTrackerOnReplyViewController=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=function(){i.GmailReplyManager.registerModifierModule(this)};n.extend(l.prototype,{getViewControllers:function(){return[new s.Modules.PixelTrackerOnReplyViewController]}});o.addFunction({functionKey:"pixelTrackerOnReplyMasterControllerInitialized",functionToCall:function(e){if(!s.Modules.PixelTrackerOnReplyMasterController){s.Modules.PixelTrackerOnReplyMasterController=new l}if(e){e()}},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","gmailLoaded","userLoggedIn","pixelTrackingLimiterInitialized","data.streakSettings.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Date,a=e.Gmail,o=e.Locale,s=e.HTML,l=e.BentoBox.Data,u=e.BentoBox;var c={TRACKED_KEY:"ᐧ",URL_KEY:"%E1%90%A7",SEARCH_URL:'"ᐧ" from:me',SEARCH_REPLACEMENT:"has:tracking"};c.TRACKED_KEY_REGEX=new RegExp('"?'+c.TRACKED_KEY+'"?',"img");c.REPLACE_KEY_REGEX=new RegExp(c.SEARCH_REPLACEMENT,"img");var d={CONSTANTS:c,_sentMailLink:null,_searchLink:null,_expando:null,init:function(e){if(!u.Services.PixelTrackingLimiter.isTrackingEnabled()){if(e){e()}return}this._setupSearchLink();this._setupSearchButtonObserver();if(e){e()}},_setupSearchLink:function(){a.inboxSDK.NavMenu.SENT_MAIL.addNavItem({name:u.Locale.getString("pixel_track_left_link"),routeID:a.inboxSDK.Router.NativeRouteIDs.SEARCH,routeParams:{query:c.SEARCH_URL,page:1},orderHint:2})},_setupSearchButtonObserver:function(){a.GmailSearchBarContentReplacer.addManipulation({applyDisplayManipulation:function(e){return e.replace(c.TRACKED_KEY_REGEX,c.SEARCH_REPLACEMENT)},applyValueManipulation:function(e){return e.replace(c.REPLACE_KEY_REGEX,'"'+c.TRACKED_KEY+'"')}})}};e.DependencyManager.addFunction({functionKey:"pixelTrackerSearchInitialized",functionToCall:d.init,functionContext:d,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","userLoggedIn","pixelTrackingLimiterInitialized","userSettingsInitialized"]});u.Modules.PixelTrackerSearch=d;var h=function(e,t){u.Tracker.trackStreakActive(t,{eventName:e})}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.APIRequester,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=5*1e3;var f=e.Class.subclass({className:"PixelTrackerConversationImageFixer",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);e.DomWatcher.watchForNewSelector("[role=main] .h7 .Bk > div",this._handleConversationMessageLoaded.bind(this));e.DomWatcher.watchForNewSelector("[contenteditable=true]",this._handleEditorLoaded.bind(this));e.DomWatcher.watchForNewSelector("[contenteditable=true] > .gmail_extra",this._handleConversationMessageLoaded.bind(this));u.subscribe({eventName:"newReplyArea",functionToCall:this._newReplyArea,observer:this})},_handleEditorLoaded:function(e){this._handleConversationMessageLoaded(e);t(e).find('[hspace="streak-pt-mark"]').remove()},_handleConversationMessageLoaded:function(e){var n=t(e).find('[hspace="streak-pt-mark"]');for(var i=0;i<n.length;i++){this._processMarkerNode(n[i])}},_processMarkerNode:function(e){var n=t(e);var i=this._extractGuid(n);if(!i){return}this.sendIgnoreImageRequest(i)},_extractGuid:function(e){var t=e.find("img");if(!t||t.length===0){return null}return this._extractGuidFromURL(t[0].src)},_newReplyArea:function(t){var n=t.replyAreaController;var i=n.getHiddenDraftValue();if(i.indexOf("guid=")===-1){return}if(i.indexOf("<img")===-1){return}i=i.replace(/\<img/gim,"<fakeimage");var r=e.$(document.createElement("div"));r[0].innerHTML=i;var a=r.find("fakeimage");for(var o=0;o<a.length;o++){this._processFakeImage(a[o])}},_processFakeImage:function(e){var n=t(e);var i=this._extractGuidFromURL(n.attr("src"));if(!i){return}this.sendIgnoreImageRequest(i)},_extractGuidFromURL:function(e){if(!e){return}var t=e.split("#");var n=t[0];if(t.length>1){n=t[1]}if(n.indexOf("mailfoo")===-1&&n.indexOf("streak")===-1){return}if(n.indexOf("sender=")>-1){if(this._doesNotContainUserEmail(n)){return}}var i=e.indexOf("guid=");if(i===-1){return}return e.substring(i+5)},_doesNotContainUserEmail:function(e){var t=encodeURIComponent(d.getUser().getEmail());var n=d.PixelTrackingHTMLGenerator.getEncodedEmailAddress();return e.indexOf("sender="+t)===-1&&e.indexOf("sender="+d.getUser().getEmail())===-1&&e.indexOf("sender="+n)===-1},sendIgnoreImageRequest:function(e){var t=this;setTimeout(function(){l.put("trackedlinks/"+e+"/ignoredviews")},h)}});e.DependencyManager.addFunction({functionKey:"pixelTrackerConversationImageFixerInitialized",functionToCall:function(e){i.set("BentoBox.Modules.PixelTrackerConversationImageFixer",new f);if(e){e()}},dependentFunctionKeys:["gmailLoaded","userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{showLeft:true,showRight:true,cancelFunc:t.noop,leftButtonFunction:t.noop,rightButtonFunction:t.noop,leftButtonText:"Previous",rightButtonText:"Next",rightButtonHTML:null,leftButtonHTML:null,leftButtonColor:"blue",rightButtonColor:"blue",showRightButton:true,showLeftButton:true,hideLeftButton:true,html:"",customClasses:"",linkText:"Exit Tour",showLink:true},templates:{},create:function(e){this._init();var n={};t.extend(n,this.defaults,e);return new this.impl(n,this.defaults)},_init:function(){if(!this.templates.Bar){this.templates.Bar=r.get("TourBar")}}};o.impl=function(i,r){var s=[];var l=null;var u=this;u.options=i;u.defaults=r;var c=function(e){var n={};t.extend(n,u.defaults,e);u.options=n;d()};var d=function(){u._barHTML.children(".barContent").append(u.options.html);t(u._barHTML).addClass(u.options.customClasses);u._rButton.setOnFunc(u.options.rightButtonFunction);t(u._rButton.el).html(u.options.rightButtonText);var e=u.options.showRightButton?"visible":"hidden";t(u._rButton.el).css("visibility",e);u._lButton.setOnFunc(u.options.leftButtonFunction);t(u._lButton.el).html(u.options.leftButtonText);var n=u.options.showLeftButton?"visible":"hidden";t(u._lButton.el).css("visibility",n);if(u.options.hideLeftButton){t(u._lButton.el).hide()}};var h=function(){var n=o.templates.Bar({content:""});var i=t(n);i.append(u.options.html);u._barHTML=i;var r=a.Widgets.Button.create({name:u.options.leftButtonText,color:u.options.leftButtonColor,onFunc:u.options.leftButtonFunction});i.addClass(u.options.customClasses);i.children(".__streak_barLeftButton").append(t(r.el));if(!u.options.showLeftButton){t(r.el).css("visibility","hidden")}u._lButton=r;var c=a.Widgets.Button.create({name:u.options.rightButtonText,color:u.options.rightButtonColor,onFunc:function(){u.options.rightButtonFunction()}});i.children(".barRightButton").append(t(c.el));u._rButton=c;if(!u.options.showRightButton){c.el.css("visibility","hidden")}if(u.options.showLink){if(!u.options.showLeftButton&&!u.options.showRightButton){i.find(".__streak_barLeftButton").hide();i.find(".barRightButton").hide();i.find(".streakTourBarOr").hide()}var d=i.find(".streakTourBarExit");d.click(u.options.cancelFunc)}i.appendTo(e.Gmail.elements.body);s.push(i);l=i},f=function(){n.each(s,function(e){t(e).hide()})};unhide=function(){n.each(s,function(e){t(e).show()})};destroy=function(){n.each(s,function(e){t(e).remove()})};return{show:h,hide:f,unhide:unhide,destroy:destroy,reuse:c,getType:function(){return"BAR"}}};a.Widgets.Tour=a.Widgets.Tour||{};a.Widgets.Tour.Bar=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{targetElement:null,clickCallback:t.noop,buffer:5},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(i){var r={};var a=function(a,o,s){var l=r[o];if(!l){l=t("<div> </div>");l.addClass("tour_highlight");if(s){l.addClass("tour_highlight_border tour_highlight_border_"+s)}if(n.isReal(i.backgroundOpacity)){l.css({opacity:i.backgroundOpacity})}t(e.Gmail.elements.body).append(l)}l.unbind("click").click(function(){i.clickCallback()});l.css(a);r[o]=l};var o=function(e){a({left:0,width:Math.max(p.topLeft.x,0)+"px",top:0,height:Math.max(p.topLeft.y,0)+"px"},"topLeft")};var s=function(e){a({left:p.topLeft.x+"px",top:0,width:Math.max(p.width,0)+"px",height:Math.max(p.topLeft.y,0)+"px"},"top","bottom")};var l=function(e){a({left:p.bottomRight.x+"px",right:0,top:0,height:Math.max(p.topLeft.y,0)+"px"},"topRight")};var u=function(e){a({left:0,width:Math.max(p.topLeft.x,0)+"px",top:0,bottom:0},"left","right")};var c=function(e){a({left:p.bottomRight.x+"px",right:0,top:0,bottom:0},"right","left")};var d=function(){a({bottom:0,top:p.bottomRight.y+"px",left:0,width:Math.max(p.topLeft.x,0)+"px"},"bottomLeft")};var h=function(e){a({top:p.bottomRight.y+"px",left:p.topLeft.x+"px",width:Math.max(p.width,0)+"px",bottom:0},"bottom","top")};var f=function(){a({top:p.bottomRight.y+"px",left:p.bottomRight.x+"px",right:0,bottom:0},"bottomRight")};var p={topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};var m=null;var _=false;var g=function(){_=false;t(window).unbind("resize",v);t(window).bind("resize",v);m=n.repeatEvery(v,2e3)};var v=function(){var e=i.buffer;var n=t(i.targetElement||i.targetSelector);if(n.length===0||_){b();return}p.topLeft.x=n.offset().left-e;p.topLeft.y=n.offset().top-e;p.bottomRight.x=n.offset().left+n.outerWidth()+e;p.bottomRight.y=n.offset().top+n.outerHeight()+e;p.width=n.outerWidth()+2*e;p.height=n.outerHeight()+2*e;s();u();c();h()};var y=function(){for(var e in r){r[e].hide()}};var w=function(){for(var e in r){r[e].show()}};var b=function(){_=true;if(m){m.stop()}for(var e in r){r[e].remove()}r={};t(window).unbind("resize",v)};var C=function(e){n.extend(i,e)};return{show:g,hide:y,unhide:w,destroy:b,reuse:C,getType:function(){return"HIGHLIGHT"}}};a.Widgets.Tour=a.Widgets.Tour||{};a.Widgets.Tour.Highlight=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o=function(e){a.Widgets.Widget.call(this,e);for(var t in this.options){this.options[t]=a.UI.processString(this.options[t])}var e={inner:e.html,escClose:false,showCancel:e.showLeftButton,cancelText:e.leftButtonText,cancelButtonColor:e.leftButtonColor,showConfirm:e.showRightButton,confirmText:e.rightButtonText,close:false,force:true,overlayCss:{backgroundColor:"black"},opacity:65,dontStack:true};this.options=n.extend({},o.prototype.defaults,e,this.options);this._modal=a.Widgets.Modal.create(this.options)};o.prototype=Object.create(a.Widgets.Widget.prototype);n.extend(o.prototype,{show:function(){return this._modal.show()},destroy:function(){if(this._modal.getEl().is(":FastVisible")){t.modal.close()}},defaults:{showLink:false,linkText:"Exit",linkFunction:t.noop}});o.create=function(e){return new o(e)};a.Widgets.Tour=a.Widgets.Tour||{};a.Widgets.Tour.TourModal=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o={defaults:{tips:[],infoCss:{},infoTop:"50%",infoLeft:"50%",infoHTML:"",infoDescription:"",showRightButton:true,showLeftButton:true,leftButtonFunction:t.noop,rightButtonFunction:t.noop,leftButtonText:"Previous",rightButtonText:"Next",rightButtonHTML:null,leftButtonHTML:null,leftButtonColor:"blue",rightButtonColor:"blue",showInfo:true,overlayColor:"black",opacity:.65},create:function(e){var n={};t.extend(n,this.defaults,e);return new this.impl(n)}};o.impl=function(r){var o=[];var s=[];var l=this;var u;var c=function(e){var n={};t.extend(n,l.defaults,e);l.options=n;d()};var d=function(){_(s);h(l.options.tips)};var h=function(e){try{n.each(e,function(e){var t=m(e);o.push(t);s.push(t)})}catch(t){}};var f=function(){u=p(r.overlayColor,9997,r.opacity);o.push(u);if(r.showInfo){var n=t("<div> </div>");n.append(r.infoHTML);n.append('<div class="overlayButtons"></div>');n.css({position:"fixed",top:r.infoTop,left:r.infoLeft,zIndex:9998,color:"white"});n.css(r.infoCss);o.push(n);e.Gmail.elements.body.append(n);if(r.showLeftButton){var i=a.Widgets.Button.create({name:r.leftButtonText,color:r.leftButtonColor,onFunc:r.leftButtonFunction});t(n).children(".overlayButtons").append(t(i.el))}if(r.showRightButton){var s=a.Widgets.Button.create({name:r.rightButtonText,color:r.rightButtonColor,onFunc:function(){r.rightButtonFunction()}});t(n).children(".overlayButtons").append(t(s.el))}}h(r.tips)},p=function(n,i,r){var a=t(e.document.createElement("div"));a.addClass("tour-overlay");a.css("zIndex",i||9997);a.css("opacity",r||.5);a.css("background",n);e.Gmail.elements.body.append(a);o.push(a);return a},m=function(n){jqueryObj=t(n.targetElement);var r=n.zIndex||9999;var o=n.stickyRight;var s=jqueryObj.offset();var l=t(document.createElement("div"));l.addClass("bbOverlayTip");l.html(n.description);if(jqueryObj.length>0){var u=15;var c=0;var d=10;var h=s.top+u+jqueryObj.height();var f=s.left+c;var p=s.left-d+jqueryObj.width();p=t(i.elements.body).width()-p;if(o){l.css("right",p+"px")}else{l.css("left",f+"px")}l.css("position","fixed");l.css("color","white");l.css("zIndex",r);l.css("top",h+"px");var m=t(document.createElement("div"));m.css("width",jqueryObj.width()+"px");m.css("height","2px");m.css("position","fixed");m.css("background","white");m.css("zIndex",r||9999);m.css("top",h-u+"px");t(l).append(m);if(o){m.css("right",p+"px")}else{m.css("left",f+"px")}var _=t(document.createElement("div"));_.css("width","2px");_.css("height","14px");_.css("position","fixed");_.css("background","white");_.css("zIndex",r);_.css("top",h-u+"px");t(l).append(_);if(o){_.css("right",p+10+"px")}else{_.css("left",f+10+"px")}}if(n.buttons&&n.buttons.length>0){var g=t('<div class="overlayButtons"></div>');for(var v=0;v<n.buttons.length;v++){var y=a.Widgets.Button.create({name:n.buttons[v].name,color:n.buttons[v].color||"blue",onFunc:n.buttons[v]["function"]});g.append(y.el)}l.append(g)}t(e.Gmail.elements.body).append(l);return l};var _=function(e){n.each(e,function(e){t(e).remove()});e=[]};var g=function(){_(o)};return{show:f,reuse:c,destroy:g,getType:function(){return"OVERLAY"}}};a.Widgets.Tour=a.Widgets.Tour||{};a.Widgets.Tour.Overlay=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o=t;var s={create:function(e){return new this.impl(e)}};s.impl=function(e){var t=e;return l.createGuider(t)};var l=function(t){var n={};n.version="1.3.0";n._defaultSettings={attachTo:null,autoFocus:false,buttons:[{name:"Close"}],buttonCustomHTML:"",classString:null,closeOnEscape:false,description:"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",highlight:null,isHashable:true,offset:{top:null,left:null},onClose:null,onHide:null,onShow:null,overlay:false,position:0,shouldSkip:function(){},title:null,width:400,xButton:false,bottomLink:null};n._htmlSkeleton=["<div class='guider'>","  <div class='guiders_content'>","    <div class='guiders_title Kj-JD-K7'></div>","    <div class='guiders_close'></div>","    <p class='guiders_description'></p>","    <div class='guiders_buttons_container'>","    </div>","    <div class='guiders_link'>","    </div>","  </div>","  <div class='guiders_arrow'>","    <div class='guiders_arrow_inner'>","    </div>","  </div>","</div>"].join("");n._arrowSize=42;n._backButtonTitle="Back";n._buttonAttributes={href:"#"};n._buttonClassName="guiders_button";n._buttonClickEvent="click touch";n._buttonElement="<a></a>";n._closeButtonTitle="Close";n._currentGuiderID=null;n._fixedOrAbsolute="fixed";n._guiders=[];n._lastCreatedGuiderID=null;n._nextButtonTitle="Next";n._offsetNameMapping={topLeft:11,top:12,topRight:1,rightTop:2,right:3,rightBottom:4,bottomRight:5,bottom:6,bottomLeft:7,leftBottom:8,left:9,leftTop:10};n._windowHeight=0;var i=navigator.userAgent.match("MSIE (.)");n._isIE=i&&i.length>1;n._ieVersion=i&&i.length>1?Number(i[1]):-1;n._addButtons=function(e){var n=e.elem.find(".guiders_buttons_container");if(e.buttons===null||e.buttons.length===0){n.remove();return}e.buttons=e.buttons.reverse();for(var i=e.buttons.length-1;i>=0;i--){var r=e.buttons[i];var o=a.Widgets.Button.create({name:r.name,color:r.color||"blue",onFunc:r.onclick||r.function});n.append(t(o.el))}if(e.bottomLink&&e.bottomLink.visible){var s=t('<a href="#">'+e.bottomLink.text+"</a>");e.elem.find(".guiders_link").append(s);s.click(function(t){if(e.bottomLink["function"]){e.bottomLink["function"]()}t.preventDefault();t.stopPropagation()})}else{e.elem.find(".guiders_link").hide()}if(e.buttonCustomHTML!==""){var l=t(e.buttonCustomHTML);e.elem.find(".guiders_buttons_container").append(l)}if(e.buttons.length===0){n.remove()}};n._addXButton=function(e){var i=e.elem.find(".guiders_close");var r=t("<div></div>",{"class":"guiders_x_button",role:"button"});i.append(r);r.click(function(){n.hideAll();if(e.onClose){e.onClose(e,true)}})};n._attach=function(e){if(typeof e!=="object"){return}var i=t(e.attachTo);var r=e.elem.innerHeight();var a=e.elem.innerWidth();if(e.position===0||i.length===0){var o="fixed";if(n._isIE&&n._ieVersion<9){o="absolute"}e.elem.css("position",o);e.elem.css("top",(t(window).height()-r)/3+"px");e.elem.css("left",(t(window).width()-a)/2+"px");return}var s=i.offset();var l=s.top;var u=s.left;var c=t("body").outerHeight(true)-t("body").outerHeight(false);l-=c;if(n._offsetNameMapping[e.position]){e.position=n._offsetNameMapping[e.position]}var d=i.innerHeight();var h=i.innerWidth();var f=.9*n._arrowSize;var p={1:[-f-r,h-a],2:[0,f+h],3:[d/2-r/2,f+h],4:[d-r,f+h],5:[f+d,h-a],6:[f+d,h/2-a/2],7:[f+d,0],8:[d-r,-a-f],9:[d/2-r/2,-a-f],10:[0,-a-f],11:[-f-r,0],12:[-f-r,h/2-a/2]};var m=p[e.position];l+=m[0];u+=m[1];var _="absolute";if(i.css("position")==="fixed"&&n._fixedOrAbsolute==="fixed"){_="fixed";l-=t(window).scrollTop();u-=t(window).scrollLeft()}if(e.offset.top!==null){l+=e.offset.top}if(e.offset.left!==null){u+=e.offset.left}n._styleArrow(e);e.elem.css({position:_,top:l,left:u});return e};n._styleArrow=function(e){var i=e.position||0;if(!i){return}var r=t(e.elem.find(".guiders_arrow"));var a={1:"guiders_arrow_down",2:"guiders_arrow_left",3:"guiders_arrow_left",4:"guiders_arrow_left",5:"guiders_arrow_up",6:"guiders_arrow_up",7:"guiders_arrow_up",8:"guiders_arrow_right",9:"guiders_arrow_right",10:"guiders_arrow_right",11:"guiders_arrow_down",12:"guiders_arrow_down"};r.addClass(a[i]);var o=e.elem.innerHeight();var s=e.elem.innerWidth();var l=n._arrowSize/2;var u={1:["right",l],2:["top",l],3:["top",o/2-l-20],4:["bottom",l],5:["right",l],6:["left",s/2-l-20],7:["left",l],8:["bottom",l],9:["top",o/2-l-20],10:["top",l],11:["left",l],12:["left",s/2-l-20]};var i=u[e.position];r.css(i[0],i[1]+"px")};n._showIfHashed=function(e){var t="guider=";var i=window.location.hash.indexOf(t);if(i!==-1){var r=window.location.hash.substr(i+t.length);if(e.id.toLowerCase()===r.toLowerCase()){n.show(e.id)}}};n.reposition=function(){for(var e=0;e<n._guiders.length;e++){n._attach(n._guiders[e])}};n.createGuider=function(e){if(e===null||e===undefined){e={}}var i=t.extend({},n._defaultSettings,e);i.id=i.id||String(Math.floor(Math.random()*1e3));var r=t(n._htmlSkeleton);i.elem=r;if(typeof i.classString!=="undefined"&&i.classString!==null){i.elem.addClass(i.classString)}i.elem.css("width",i.width+"px");var a=r.find(".guiders_title");if(i.title){a.html(i.title)}else{a.hide()}r.find(".guiders_description").html(i.description);n._addButtons(i);if(i.xButton){n._addXButton(i)}else{i.elem.find(".guiders_close").hide()}r.hide();r.appendTo("body");r.attr("id",i.id);if(typeof i.attachTo!=="undefined"&&i!==null){n._attach(i)}n._guiders.push(i);i.show=function(){n.show(i);return i};i.destroy=function(){r.remove();n._guiders.removeVal(i)};return i};n.show=function(i){if(i.onShow){i.onShow(i)}n._attach(i);i.elem.fadeIn("fast").data("locked",false);var r=n._windowHeight=t(window).height();var a=t(window).scrollTop();var o=i.elem.offset();var s=i.elem.height();var l=a+r<o.top+s;var u=o.top<a;if(i.autoFocus&&(l||u)){setTimeout(n.scrollToCurrent,10)}t(i.elem).trigger("guiders.show");if(i.elem.position().left+i.elem.width()>e.$(window).width()){i.elem.css("left",e.$(window).width()-(i.elem.width()+10)+"px")}n.getType=function(){return"TOOLTIP"};return n};var r=undefined;t(window).resize(function(){if(typeof r!=="undefined"){clearTimeout(r)}r=setTimeout(function(){r=undefined;if(typeof n!=="undefined"){n.reposition()}},20)});return n}.call(this,o);a.Widgets.Tour=a.Widgets.Tour||{};a.Widgets.Tour.Tooltip=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"WaitForClick",superclass:e.Object,_memberVariables:[{name:"_boundElement",destroy:false},{name:"_boundFunction",destroy:false},{name:"_options",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this)},setup:function(e){this._options=e},show:function(){this._boundElement=t("body");this._boundFunction=this._elementClicked.bind(this);this._options.clickEvent=this._options.clickEvent||"click";this._boundElement[0].addEventListener(this._options.clickEvent,this._boundFunction,true)},getType:function(){return"WAIT_FOR_CLICK"},_elementClicked:function(e){if(!t(this._options.targetSelector).isAncestor(e.target)&&!t(this._options.rawTargetSelector).isAncestor(e.target)){return}if(this._options.suppressClick){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()}if(this._options.function){this._options.function()}},destroy:function(){if(this._boundElement&&this._boundElement.length>0){this._boundElement[0].removeEventListener(this._options.clickEvent,this._boundFunction,true)}e.Object.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.Tour.WaitForClick",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"WaitForEvent",superclass:e.Object,_memberVariables:[{name:"_boundElement",destroy:false},{name:"_boundFunction",destroy:false},{name:"_options",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this)},setup:function(e){this._options=e},show:function(){this._boundElement=t("body");this._boundFunction=this._eventHappened.bind(this);this._boundElement[0].addEventListener(this._options.event,this._boundFunction,true)},getType:function(){return"WAIT_FOR_EVENT"},_eventHappened:function(e){if(!t(this._options.targetSelector).isAncestor(e.target)&&!t(this._options.rawTargetSelector).isAncestor(e.target)){return}if(this._options.function){this._options.function()}},destroy:function(){this._boundElement[0].removeEventListener(this._options.event,this._boundFunction,true);e.Object.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.Tour.WaitForEvent",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BottomModal",superclass:e.Object,_memberVariables:[{name:"_options",destroy:false},{name:"_helpModalViewController",destroy:true},{name:"_helpModalWrapper",destroy:false},{name:"_leftButton",destroy:true},{name:"_rightButton",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this)},setup:function(e){this._options=e||{}},show:function(){this._helpModalViewController=i.getInstance("BentoBox.Widgets.HelpModalViewController");this._helpModalViewController.addDelegate(this);this._helpModalViewController.setTitleText(this._options.title);this._helpModalViewController.setContentHTML(this._options.body);if(!this._options.displayAlone){this._helpModalViewController.showBackButton();this._helpModalViewController.setTopClickable(false)}if(this._options.width){this._helpModalViewController.setWidth(options.width)}this._addLeftButton();this._addRightButton();this._addToBody()},_addLeftButton:function(){if(!this._options.leftButton){return}this._leftButton=c.Widgets.ButtonFactory.createButton({type:"Gmail",color:"blue",text:this._options.leftButton.name,onFunction:this._options.leftButton.function});this._helpModalViewController.addLeftButton(this._leftButton)},_addRightButton:function(){if(!this._options.rightButton){return}this._rightButton=c.Widgets.ButtonFactory.createButton({type:"Gmail",color:"blue",text:this._options.rightButton.name,onFunction:this._options.rightButton.function});this._helpModalViewController.addRightButton(this._RightButton)},_addToBody:function(){this._helpModalViewController.getView().getElement().addClass("streak__bottomModal");this._helpModalWrapper=r.addToComposeArea(this._helpModalViewController.getView().getElement())},backButtonClicked:function(){this._options.backButtonFunction()},closeClicked:function(){if(this._options&&this._options.closeClicked){this._options.closeClicked()}if(this._options&&this._options.finishFunction){this._options.finishFunction()}},getType:function(){return"BOTTOM_MODAL"},destroy:function(){if(this._helpModalWrapper){r.removeFromComposeArea(this._helpModalWrapper);this._helpModalWrapper.remove()}e.Object.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.Tour.BottomModal",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.Date;var s=function(e){};n.extend(s.prototype,{init:function(t,i,r){var o=this;o._totalPagesSeen=0;o._options=t;o._name=t.tourBookName;o._forceRun=i;o._isNotPersistant=t._isNotPersistant;o.resetDataStructs();if(!o.cssFile){o.cssFile=e.server+this.getResourceURL("css");e.$("body").append('<link rel="stylesheet" type="text/css" href="'+o.cssFile+'">')}var s=n.onceAfter(3,function(){if(r){r()}});if(this._localeClone){s()}else{this._localeClone=e.Locale.getClone();this._localeClone.override(this.getResourceURL("locale"),s)}if(this._html){s()}else{o._html=a.Modules.OverridableHTML.create({fileName:this.getResourceURL("html"),Locale:this._localeClone});o._html.loadHTML(s)}o.setUpTour();s()},setUpTour:function(){var e=this;e._currentViewURL=null;e._inTour=false;e._initialViewUrl=i.hash.partsString},resetDataStructs:function(){var e=this;e._state={};e._previousTransitions=[];e._seenPages=[];e._oldWidgets={};e._newWidgets={}},reset:function(t,n){var r=this;if(t&&!n){var a=r.getSavedState();if(e._.isReal(a)){r._previousTransitions=a._previousTransitions;r._currentIndex=a._currentIndex;r._seenPages=a._seenPages;r.loadInstanceSettings(a._instanceSettings)}else{r._currentIndex=0}}if(r._pages){if(!t||n){r._currentIndex=0}r._currentPage=r._pages[r._currentIndex]||r._pages[0]}if(r._currentPage&&r._currentPage.onEnter){r._currentViewURL=null}else{r._currentViewURL=i.hash.partsString}r._inTour=false},startTour:function(e){var t=this;this._inTour=true;if(e){this.recordEvent("startedTour")}t.recordChaptersActive(t._currentChapter);if(t.getPausedState()||!e){t._currentViewURL=i.hash.partsString;t._softExitTour();t.showReturnToTourPopUp()}else{t._oldWidgets=t._newWidgets;t.cleanUp();this.loadPage(this._currentPage)}},_clearActiveTour:function(){a.UserSettings.setSetting("tour/activeTour/"+this._name,null);a.UserSettings.saveSettings()},recordChaptersActive:function(e){if(this._isNotPersistant){return}a.UserSettings.setSetting("tour/activeTour/"+this._name,e);a.UserSettings.saveSettings()},getResourceURL:function(e){return"/tours/"+this._name+"/"+this._name+"."+e},setChapter:function(e,t,n,i){var r=this;if(n){}else{r._previousTransitions.push({index:r._currentIndex,pages:r._pages,chapterName:r._currentChapter});r._currentIndex=t}r._currentChapter=e;var a=r._options.Chapters[e];var o={};if(i){o.source=i}else{if(n){o.source="refresh"}else{o.source="trigger"}}r.recordEvent("changeChapterTo",o);r._pages=a.pages},shouldHandleViewChange:function(){var e=this;return e._inTour&&e._currentViewURL},viewChanged:function(e){var t=this;if(t._currentViewURL&&t._currentViewURL!==i.hash.partsString){t._softExitTour();t.showReturnToTourPopUp();t.recordPausedState(true)}},recordEvent:function(t,i){var r=this;var a={category:"TourPassive",eventName:t,tour:r._name,page:this._currentChapter+"-"+this._currentIndex,totalPagesSeen:r._totalPagesSeen};n.extend(a,i);e.BentoBox.Tracker.recordEvent(a)},recordExitEvent:function(){var t=this;e.BentoBox.Tracker.recordEvent({category:"tourExit",eventName:"Exit "+this._name,page:this._currentChapter+"-"+this._currentIndex,totalPagesSeen:t._totalPagesSeen})},convertHTMLandTranslations:function(e){var t=this;var i={};n.each(e,function(e,n){i[n]=t.determineTypeOfValue(e).processed});return i},determineTypeOfValue:function(e){var t=this;if(n.isArray(e)){var i=[];for(var r=0;r<e.length;r++){i.push(t.determineTypeOfValue(e[r]).processed)}return{type:typeof e,original:e,processed:i}}if(n.isObject(e)){var o={};for(var s in e){o[s]=t.determineTypeOfValue(e[s]).processed}return{type:typeof e,original:e,processed:o}}if(typeof e!=="string"){return{type:typeof e,original:e,processed:e}}if(e&&e.length>2){var l=e.length;var u;var c;var d=e;if(e[0]==="%"&&e[l-1]==="%"){u="TRANSLATION"}else if(e[0]==="*"&&e[l-1]==="*"){u="HTML"}else{u="STRING"}c=a.UI.processString(e,t._localeClone,t._html);return{type:u,processed:c,original:d}}else{return{type:"STRING",original:e,processed:e}}},cleanUpDataCreatedByTour:function(e){},showReturnToTourPopUp:function(){var e=this;var t=[{name:"Exit",onclick:function(){e.recordEvent("exitTourTooltip");e.cleanUp.call(e,true);e.cleanUpDataCreatedByTour(e);e.notifyDependenciesOfExit();e.recordPausedState(false)}},{name:"Continue",onclick:function(){e.recordEvent("resumeTour");e.recordPausedState(false);e.cleanUp.call(e,true);e.startTour(true);e._inTour=true}}];var i={buttons:t,attachTo:"#workflowStatusText",description:"If you would like to return to the tour click below",position:"left",title:"Back to tour",width:220};if(this._options.returnToTourTooltip){n.extend(i,this._options.returnToTourTooltip);if(this._options.returnToTourTooltip.exitButtonText){i.buttons[0].name=this._options.returnToTourTooltip.exitButtonText}if(this._options.returnToTourTooltip.continueButtonText){i.buttons[1].name=this._options.returnToTourTooltip.continueButtonText}}var r=a.Widgets.Tour.Tooltip.create(i);
if(!e._newWidgets["TOOLTIP"]){e._newWidgets["TOOLTIP"]=[]}e._newWidgets["TOOLTIP"].push(r);r.show()},notifyDependenciesOfExit:function(){if(this._options.exitCallback){this._options.exitCallback()}this._clearActiveTour();this.recordPausedState(false)},_softExitTour:function(){this._inTour=false;this.recordEvent("_softExitTour");this.cleanUp()},getFunction:function(e,t){if(!e){return null}var n=this;var i;t=t||[];if(typeof e==="string"){i=function(){n[e].apply(n,[].concat(t))}}else{e.args=e.args||[];i=function(){n[e.functionName].apply(n,e.args.concat(t))}}return function(){if(typeof e==="string"){n.recordEvent(e)}else{n.recordEvent(e.functionName)}i()}},getSavedState:function(){return e.BentoBox.UserSettings.get("tour/activeTourState/"+this._name)},getPausedState:function(){return a.UserSettings.get("tour/activeTourExitState/")},recordPausedState:function(e){if(this._isNotPersistant){return}if(e){a.UserSettings.setSetting("tour/activeTourExitState/",true);a.UserSettings.saveSettings()}else{a.UserSettings.setSetting("tour/activeTourExitState/",null);a.UserSettings.saveSettings()}},_clearOutState:function(){var e=this;a.UserSettings.setSetting("tour/activeTourState/"+this._name,null);a.UserSettings.saveSettings()},_recordState:function(){var e=this;if(this._isNotPersistant){return}a.UserSettings.setSetting("tour/activeTourState/"+this._name,{_seenPages:e._seenPages,_currentIndex:e._currentIndex,_previousTransitions:e._previousTransitions,_instanceSettings:e.getInstanceSettings()});a.UserSettings.saveSettings()},loadPage:function(e){var t=this;if(!n.isReal(t._seenPages)){t._seenPages=[]}t._seenPages.push(e);t._recordState();t.recordEvent("pageEnter");t.cleanUpNonReusedItems();if(e.onEnter){var i=t.getFunction(e.onEnter,function(){t.loadItems()});i()}else{t.loadItems()}},loadItems:function(){var e=this;var t=e._currentPage.itemsOnScreen;setTimeout(function(){e._newWidgets={};n.each(t,function(t){e.loadItem(t)});e.cleanUp();e._oldWidgets=n.clone(e._newWidgets)},5)},loadItem:function(e){var i=this;var r=null;e=i.convertHTMLandTranslations(e);r=i.getItem(e.type);var o;switch(e.type){case"MODAL":o={};t.extend(o,e,{cancelFunc:i.getFunction(e.leftButtonFunction),confirmFunc:i.getFunction(e.rightButtonFunction),linkFunc:i.getFunction(e.linkFunction)});if(r&&r.reuse){r.reuse(o)}else{r=a.Widgets.Tour.TourModal.create(o)}r.show();break;case"FUNCTION":var s=i[e.name];var l=n.extend({next:"next",previous:"previous"},e.callbacks);for(var u in l){l[u]=i.getFunction(l[u])}var c=[l];if(e.args){c=c.concat(e.args)}s.apply(i,c);var d=i[e.name+"Destroy"];if(d){r={destroy:d.bind(i)}}break;case"HIGHLIGHT":if(r&&r.reuse){r.reuse(e)}else{r=a.Widgets.Tour.Highlight.create(e)}r.show();break;case"OVERLAY":e.leftButtonFunction=i.getFunction(e.leftButtonFunction);e.rightButtonFunction=i.getFunction(e.rightButtonFunction);if(e.tips&&e.tips.length>0){for(var h=0;h<e.tips.length;h++){if(e.tips[h].buttons&&e.tips[h].buttons.length>0){for(var f=0;f<e.tips[h].buttons.length;f++){e.tips[h].buttons[f]["function"]=i.getFunction(e.tips[h].buttons[f]["function"])}}}}if(r&&r.reuse){r.reuse(e)}else{r=a.Widgets.Tour.Overlay.create(e)}r.show();break;case"TOOLTIP":if(!e.buttons){e.buttons=[{name:i._localeClone.getString("tour_previous"),"function":"previous"},{name:i._localeClone.getString("tour_next"),"function":"next"}]}e.offset=e.offset||{};o={title:e.title,body:e.html,targetSelector:e.targetID,placement:{position:e.position,left:e.offset.left,top:e.offset.top},earlyExitTourFunction:i.getFunction("exitTourAndRedirect")};if(e.buttons.length===1){o.rightButton={name:e.buttons[0].name,"function":i.getFunction(e.buttons[0]["function"])}}else if(e.buttons.length===2){o.leftButton={name:e.buttons[0].name,"function":i.getFunction(e.buttons[0]["function"])};o.rightButton={name:e.buttons[1].name,"function":i.getFunction(e.buttons[1]["function"])}}r=new a.Widgets.Tour.GmailTooltip;r.setup(o);r.show();break;case"WAIT_FOR_CLICK":o={targetSelector:e.targetSelector,"function":i.getFunction(e.function),suppressClick:e.suppressClick};r=new a.Widgets.Tour.WaitForClick;r.setup(o);r.show();break;case"BAR":o=t.extend({},e,{leftButtonFunction:i.getFunction(e.leftButtonFunction),rightButtonFunction:i.getFunction(e.rightButtonFunction),exitTourFunction:function(){i.exitTourAndRedirect()}});if(r&&r.reuse){r.reuse(o)}else{r=a.Widgets.Tour.Bar.create(o)}r.show();break;default:break}if(r){if(!i._newWidgets[e.type]){i._newWidgets[e.type]=[]}i._newWidgets[e.type].push(r)}return r},getItem:function(e){if(this._oldWidgets[e]&&this._oldWidgets[e].length>0){if(this._oldWidgets[e][0].reuse){return this._oldWidgets[e].pop()}}return null},cleanUp:function(e){var t=this;var n;var i;for(i in t._oldWidgets){for(n=0;n<t._oldWidgets[i].length;n++){if(t._oldWidgets[i][n].destroy){t._oldWidgets[i][n].destroy()}}}if(e){for(i in t._newWidgets){for(n=0;n<t._newWidgets[i].length;n++){if(t._newWidgets[i][n].destroy){t._newWidgets[i][n].destroy()}}}}},cleanUpNonReusedItems:function(){if(!this._oldWidgets){return}var e=Object.keys(this._oldWidgets);for(var t=0;t<e.length;t++){var n=this._oldWidgets[e[t]];var i=[];if(n){for(var r=0;r<n.length;r++){var a=n[r];if(!a){continue}else if(a.reuse){i.push(a)}else{a.destroy()}}}this._oldWidgets[e[t]]=i}}});a.Modules.Tour=a.Modules.Tour||{};a.Modules.TourBaseCore=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.Date;var s=function(e){};s.prototype=Object.create(a.Modules.TourBaseCore.prototype);n.extend(s.prototype,{exit:function(e){this.recordLeavingChapter(e);this.recordExitEvent();this.notifyDependenciesOfExit();this.cleanUpDataCreatedByTour();this._softExitTour();this.recordPausedState(false)},exitTourAndRedirect:function(){this.exit("exitTourAndRedirect");a.UI.setURL(this._initialViewUrl)},finish:function(){this.exit("finish")},next:function(){var e=this;e._currentIndex++;e._totalPagesSeen++;e._currentViewURL=null;e.recordEvent("pageExit");if(e._currentIndex<e._pages.length){if(e._currentPage.onExit&&e[e._currentPage.onExit]){e[e._currentPage.onExit]()}e._currentPage=e._pages[e._currentIndex];e.loadPage.call(e,e._currentPage)}else{e._currentIndex--}e._recordState()},previous:function(){var e=this;var t;e._currentIndex--;e._totalPagesSeen++;e.recordEvent("pageExit");if(e._currentIndex>=0||e._previousTransitions.length>0){if(e._currentIndex<0){var n=e._previousTransitions.pop();e._pages=n.pages;e._currentIndex=n.index;e.recordChaptersActive(n.chapterName)}else{if(e._currentPage.onExit&&e[e._currentPage.onExit]){e[e._currentPage.onExit]()}}e._currentPage=e._pages[e._currentIndex];if(e._currentPage.noHistory){e.previous();e._recordState();return}e.loadPage.call(e,e._currentPage)}else{e._currentIndex++}e._recordState()},recordLeavingChapter:function(e){if(this._currentChapter){this.recordEvent("leavingChapter",{pagesLeft:this._pages.length-this._currentIndex,destination:e,chapterAndPage:this._currentChapter+"/"+this._currentIndex});this.recordEvent("pageExit",{destination:e,chapterAndPage:this._currentChapter+"/"+this._currentIndex})}},changeChapterTo:function(e){this.recordLeavingChapter(e);var t=0;this.setChapter(e,t-1,false,"jsonFile");this.next();this.recordChaptersActive(e)},sampleCustomFunction:function(){console.log("Sample share custom fxn!")},sampleCustomFunctionDestroy:function(){console.log("destroying sample..")},loadPipelineView:function(t){this._currentViewURL=e.BentoBox.Data.getAllPipelines()[0].link();i.inboxSDK.Router.goto(e.BentoBox.Data.getAllPipelines()[0].link());if(t){t()}},loadBoxView:function(t){this._currentViewURL=e.BentoBox.Data.getAllBoxes()[0].link();i.inboxSDK.Router.goto(e.BentoBox.Data.getAllBoxes()[0].link());if(t){t()}},condition:function(e,t){if(this.evaluateWithContext(t)){e["true"]()}else{e["false"]()}},evaluateWithContext:function(r){return e.newFunction("TourBase","$","_","Gmail","BB","Date","context","return ("+r+");")(s,t,n,i,a,o,this)},intervalCondition:function(e,t,n,i){var r=this;var a=Math.max(500,n||500);var o=i||1e4;var s=0;var l=function(){s+=a;var n=r.evaluateWithContext(t);if(n){e.next()}else{if(s>o){setTimeout(function(){r.exit()},500);r.recordEvent("failedintervalCondition",{expression:t,delay:a,maxDelay:o})}else{setTimeout(l,a)}}};l()},waitForSelector:function(e,t){n.checkAndThenRun(function(){return i.$(e).length>0},t,300)},getInstanceSettings:function(){return{}},loadInstanceSettings:function(e){}});a.Modules.Tour=a.Modules.Tour||{};a.Modules.TourBase=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox,o=e.Date;var s={_tour:null,_tourOptions:null,initialized:false,init:function(t){var n=this;if(!n.initialized){e.Gmail.observe("viewChanged",function(e){if(n._tour&&n._tour.shouldHandleViewChange()){n._tour.viewChanged()}else{n.setOffViewTrigger(e);n.setOffViewExpressionTrigger()}},null,1e3);e.NotificationCenter.subscribe({eventName:"newComposeWindow",functionToCall:this.setOffComposeTrigger,observer:this});e.NotificationCenter.subscribe({eventName:"newReplyArea",functionToCall:this.setOffReplyTrigger,observer:this});n.initialized=true}if(t){t()}},initRunTour:function(e){var t=a.getUser().get("tourId");if(t){this.runTour(t,null,e)}else if(e){e()}},runTour:function(e,t,n){var i=this;this.getOptions(e,function(r){i._tourOptions=r;i._tourOptions.tourBookName=e;var a=false;if(t){a=true}else{t=i.getActiveChapter(e)}if(t){i._tourRunning=true;i._notifyTourRunning()}i.parseTriggers();r._isNotPersistant=false;if(t){i.startTourChapter(r,t,true,a)}if(n){n()}})},_notifyTourRunning:function(){a.trigger("tourRunning");e.NotificationCenter.postNotification({eventName:"tourStarting",sender:this})},_notifyTourStopped:function(){a.trigger("tourStoppedRunning");e.NotificationCenter.postNotification({eventName:"tourFinished",sender:this})},getOptions:function(t,n){new e.Request("GET",e.server,"/tours/"+t+"/"+t+".json",{isAnonymous:true}).getPromise().then(n)},getActiveChapter:function(e){return a.UserSettings.get("tour/activeTour/"+e)},parseTriggers:function(){this._initializeChapterTypeArrays();for(var e in this._tourOptions.Chapters){this._processTriggerForChapterName(e)}this.checkStateTriggers();this.setOffViewExpressionTrigger();this.setOffFirstLoadExpressionTrigger()},_initializeChapterTypeArrays:function(){this._viewExpressionChapters=[];this._composeChapters=[];this._replyChapters=[];this._firstLoadExpressionChapters=[];this._tourRunning=false},_processTriggerForChapterName:function(e){var t=this._tourOptions.Chapters[e];t.name=e;var n=t.trigger;if(!n){return}this._processTriggerForChapter(t)},_processTriggerForChapter:function(e){var t=[];this._flattenChapterTriggers(e.trigger,t);for(var n=0;n<t.length;n++){this._registerChapterByTriggerType(t[n],e)}},_flattenChapterTriggers:function(e,t){if(e.type==="OR"||e.type==="AND"){var n=e.list;for(var i=0;i<n.length;i++){this._flattenChapterTriggers(n[i],t)}}else if(e.type){t.push(e)}},_registerChapterByTriggerType:function(e,t){var n=e.type.toUpperCase();switch(n){case"VIEW_CHANGE":this._registerViewTrigger(e,t);break;case"VIEW_CHANGE_EXPRESSION":this._registerViewExpressionTrigger(e,t);break;case"USER_DATA":break;case"DATA":this._registerDataTrigger(e,t);break;case"DATA_STATE":this._registerDataStateTrigger(e,t);break;case"GMAIL_STATE":this._registerGmailStateTrigger(e,t);break;case"FIRST_LOAD_EXPRESSION":this._registerFirstLoadExpression(e,t);break}},_registerViewExpressionTrigger:function(e,t){this._viewExpressionChapters.push(t)},_registerDataStateTrigger:function(e,t){},_registerDataTrigger:function(e,t){},_registerGmailStateTrigger:function(e,t){switch(e.params){case"NEW_COMPOSE":this._composeChapters.push(t);break;case"NEW_REPLY":this._replyChapters.push(t);break}},_registerFirstLoadExpression:function(e,t){this._firstLoadExpressionChapters.push(t)},startTourChapter:function(e,t,n,i){var r=this;if(!n&&(r._tourRunning||r.seenChapterBefore(e,t))){return}r.markChapterAsSeen(e,t);var o=new a.Modules.Tours[e.className](e);e.exitCallback=function(){r._tourRunning=false;r._notifyTourStopped()};r.forceRun=n;o.init(e,n,function(){r._tourRunning=true;r._notifyTourRunning();o.setChapter(t,0,r.forceRun);o.reset(r.forceRun,i);o.startTour(!n||i)});this._tour=o},markChapterAsSeen:function(e,t){a.UserSettings.setSetting("tour/seenTours/"+e.id+"/"+t,true);a.UserSettings.saveSettings()},checkBoxesTrigger:function(t){if(t.condition==="==="){return e.BentoBox.Data.getAllBoxes()===parseInt(t.param,10)}return false},seenChapterBefore:function(e,t){var n=a.UserSettings.get("tour/seenTours/"+e.id+"/"+t)===true;return n},hasSeenChapterBefore:function(e){return a.UserSettings.get("tour/seenTours/"+this._tourOptions.id+"/"+e)===true},forceStartTourChapter:function(e){var t=this._helpTourOptions;var n=this;if(n._tourRunning||n._tourHelpRunning){return}n._tourHelpRunning=true;n._notifyTourRunning();var i=new a.Modules.Tours[t.className](t);t.exitCallback=function(){n._tourHelpRunning=false;n._notifyTourStopped()};n.forceRun=true;i.init(t,true,function(){i.setChapter(e,0,n.forceRun);i.reset(true,null);i.startTour(true)})},setOffViewTrigger:function(){if(this._viewTriggers){this.checkAndRunTour(this._viewTriggers)}},setOffViewExpressionTrigger:function(){this.checkAndRunTour(this._viewExpressionChapters)},setOffDataTrigger:function(){},setupPipelineTrigger:function(){},setOffComposeTrigger:function(){this.checkAndRunTour(this._composeChapters)},setOffReplyTrigger:function(){this.checkAndRunTour(this._replyChapters)},setOffFirstLoadExpressionTrigger:function(){this.checkAndRunTour(this._firstLoadExpressionChapters)},checkAndRunTour:function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var n=e[t];var i=this.shouldRunTour(n);if(i){this.startTourChapter(this._tourOptions,n.name,false);return}}}},shouldRunTour:function(e){var t=e.trigger;if(!t){return false}if(this._tourRunning){return false}if(this.seenChapterBefore(this._tourOptions,e.name)){return false}return this.evaluateList(e.trigger)},evaluateList:function(e){var t=true;var n=e.list;if(e.type==="OR"){for(var i=0;i<n.length;i++){t=this.evaluateList(n[i]);if(t){break}}}else if(e.type==="AND"){for(var i=0;i<n.length;i++){t=this.evaluateList(n[i]);if(!t){break}}}else{t=this._evaluateTrigger(e)}return t},_evaluateTrigger:function(e){var t=e.type.toUpperCase();switch(t){case"VIEW_CHANGE":return this._evaluateView(e.params);case"VIEW_CHANGE_EXPRESSION":return this._evaluateViewExpression(e.params);case"FIRST_LOAD_EXPRESSION":return this._evaluateViewExpression(e.params);case"GMAIL_STATE":return this._evaluateGmailState(e.params);case"DATA_STATE":return this._evaluateDataState(e.params);case"EXTRA_CONDITION_EXPRESSION":return this._evaluateViewExpression(e.params)}return false},_evaluateView:function(t){return t.toLowerCase()===e.Gmail.hash.parts[0].toLowerCase()},_evaluateViewExpression:function(r){return e.newFunction("TourRunner","$","_","Gmail","BB","Date","context","return ("+r+");")(s,t,n,i,a,o,this)},_evaluateDataState:function(t){if(t.collectionType.toUpperCase()==="BOX"){if(t.property.toUpperCase()==="COUNT"){var i=e.BentoBox.Data.getAllBoxes();if(t.created){i=n.filter(i,function(e){return e.get("creatorKey")===a.getUser().key()})}var r=typeof r==="string"?parseInt(t.variableValue,10):t.variableValue;var o=n.has(e.Utils.Operators,t.comparisonOperator)&&e.Utils.Operators[t.comparisonOperator];var s;if(o){try{s=o(i.length,r)}catch(l){e.BentoBox.logError("evaluateDataState error",l,{params:t})}}else{e.BentoBox.logError("evaluateDataState unknown operator",null,{params:t})}return s}}return false},_evaluateGmailState:function(){return true},checkStateTriggers:function(){var e=this;n.each(this._dataStateTriggers,function(t){e.checkAndRunTour(t)})},teardown:function(){if(this._tour&&this._tourRunning){this._tour._softExitTour();this._tour.recordPausedState(true)}},reup:function(){if(this._tour&&this._tourRunning){this._tour.showReturnToTourPopUp()}},isTourRunning:function(){return this._tourRunning||this._tourHelpRunning}};e.DependencyManager.addFunction({functionKey:"tourRunnerInitialized",functionToCall:s.init,functionContext:s,dependentFunctionKeys:["gmailLoaded","htmlLoaded","userSettingsInitialized","bentoBox.triggerFirstGmailViewChange"]});e.DependencyManager.addFunction({functionKey:"tourRunner.initRunTour",functionToCall:s.initRunTour,functionContext:s,dependentFunctionKeys:["tourRunnerInitialized"]});a.Modules.TourRunner=s})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.BentoBox;var o=function(e){a.Modules.TourBase.call(this,e);this.useCase="default";this.tourData=e.tourData};o.prototype=Object.create(a.Modules.TourBase.prototype);n.extend(o.prototype,{newPipelineModal:null,createdPipelines:[],fakeBoxes:[],createdBoxes:[],modifiedCollections:[],preload:function(e){this.getShareModal();if(e){e()}},getShareModal:function(){if(!this.shareStreakModal){this.shareStreakModal=a.Widgets.ShareStreak.create({modalOptions:{close:false,escClose:false,title:this._localeClone.getString("share_streak_modal_title"),confirmText:this._localeClone.getString("tour_next"),cancelText:this._localeClone.getString("tour_skip")},contactRequestFunction:"getTopContactsInStreak",modalDescription:this._localeClone.getString("share_streak_modal_description")})}return this.shareStreakModal},loadPipelineView:function(n){var r=this;if(a.UI.isPipelineView()){this._currentViewURL=i.hash.partsString;this.currentPipeline=a.Data.getPipeline(i.getConversationId());n();return}this._currentViewURL=this.currentPipeline.link();i.inboxSDK.Router.goto(this.currentPipeline.link());e.Utils.waitFor(function(){return t(".groups").length>0}).then(n)},setupPipeline:function(){var e=a.Data.getPipelineBoxes(this.currentPipeline.key());if(e.length<2){e._refresh=e.refresh;e.refresh=function(e){if(e){e()}};this.modifiedCollections.push(e);var t=null;for(var n in this.tourData.fakeBoxInformation.mapping){if(this._localeClone.getString(n)===this.currentPipeline.displayName()){t=n;break}}if(t){var i=this.tourData.fakeBoxInformation.data.names[this.tourData.fakeBoxInformation.mapping[t]];for(var r=1;r<i.length;r++){var o=this.createFakeBox(this.currentPipeline,i[r]);e.add(o)}}}if(this._options.tourData){if(this._options.tourData.stringModeMapping){var s=this._options.tourData.stringModeMapping;for(var n in s){var l=a.UI.processString(n);if(l===this.currentPipeline.displayName()){var u=s[n];this.useCase=u;this._localeClone.setMode(this.useCase);this._html.setMode(this.useCase);break}}}}},createFakeBox:function(t,i){var r=a.Models.Box.create({name:i,pipelineKey:t.key()});r.save=function(e){e()};r.link=function(){return t.link()};var o=this.tourData.fakeBoxInformation.data.notes[n.random(0,this.tourData.fakeBoxInformation.data.notes.length-1)];r.set("notes",o);var s=t.get("stageOrder");var l=s[n.random(0,s.length-1)];r.set("stageKey",l);var u="__new__"+e.Date.create().getTime()*Math.random();r.set("boxKey",u);r.set("newHash",u);var c=r.getFieldModels();for(var d=0;d<c.length;d++){var h=c[d];h.save=function(e){if(e){e()}};switch(h.get("type")){case"TEXT_INPUT":for(var f in this.tourData.fakeBoxInformation.data.fields){if(this._localeClone.getString(f)===t.getField(h.key()).displayName()){var p=this.tourData.fakeBoxInformation.data.fields[f];var m=p[n.random(0,p.length-1)];h.set("value",m);break}}break;case"DATE":var _=n.random(0,30);h.set("value",e.Date.create().addDays(-1*_).getTime()+"");break;case"PERSON":break}}this.fakeBoxes.push(r);return r},createBox:function(){var t=this;var n=null;for(var i in t.tourData.fakeBoxInformation.mapping){if(t._localeClone.getString(i)===t.currentPipeline.displayName()){n=i;break}}var r;if(n){r=t.tourData.fakeBoxInformation.data.names[t.tourData.fakeBoxInformation.mapping[n]]}if(!r||r.length===0){r=["Mike Roberts"]}var o=a.Models.Box.create({name:r[0],pipelineKey:this.currentPipeline.key(),stageKey:this.currentPipeline.getStages()[0].key()});a.Data.getPipelineBoxes(this.currentPipeline.key()).add(o);var s=o.save();e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",observer:this,filterParameters:{operationProgressId:s,operationIsComplete:true},functionToCall:function(){this.createdBoxes.push(o);this.currentBox=o;this.setupBox();this._recordState()}})},setupBox:function(){var t=this;if(this.currentBox.get("notes").length===0){this.currentBox.set("notes",t._localeClone.getString("tour_sample_box_notes"))}var i=this.currentBox.getFieldModels();for(var r=0;r<i.length;r++){var o=i[r];o.save=function(e){if(e){e()}};switch(o.get("type")){case"TEXT_INPUT":for(var s in this.tourData.fakeBoxInformation.data.fields){if(this._localeClone.getString(s)===this.currentPipeline.getField(o.key()).displayName()){var l=this.tourData.fakeBoxInformation.data.fields[s];var u=l[n.random(0,l.length-1)];o.set("value",u);break}}break;case"DATE":var c=n.random(0,30);o.set("value",e.Date.create().addDays(-1*c).getTime()+"");break;case"PERSON":break}}var d=a.Data.getGmailThreadCollectionForBox(this.currentBox.key(),null,true);if(d){if(d.length===0){var h=a.Models.GmailThread.create({subject:t._localeClone.getString("tour_sample_email_1_subject"),names:[t._localeClone.getString("tour_sample_email_1_name")],emailAddresses:[t._localeClone.getString("tour_sample_email_1_address")],lastEmailTimestamp:e.Date.ccreate().getTime()});h.link=function(){return t.currentBox.link()};h.save=function(e){if(e){e()}};d.add(h);var f=a.Models.GmailThread.create({subject:t._localeClone.getString("tour_sample_email_2_subject"),names:[t._localeClone.getString("tour_sample_email_2_name")],emailAddresses:[t._localeClone.getString("tour_sample_email_2_address")],lastEmailTimestamp:e.Date.ccreate("yesterday at 9pm").getTime()});f.link=function(){return t.currentBox.link()};f.save=function(e){if(e){e()}};d.add(f);var p=a.Models.GmailThread.create({subject:t._localeClone.getString("tour_sample_email_3_subject"),names:[t._localeClone.getString("tour_sample_email_3_name")],emailAddresses:[t._localeClone.getString("tour_sample_email_3_address")],lastEmailTimestamp:e.Date.ccreate("yesterday at 8am").getTime()});p.link=function(){return t.currentBox.link()};p.save=function(e){if(e){e()}};d.add(p)}}this.currentBox.refresh=function(e){if(e){e()}};d.refresh=function(e){if(e){e()}}},loadBoxView:function(n){var r=this;if(a.UI.isBoxView()){this._currentViewURL=i.hash.partsString;n();return}this._currentViewURL=this.currentBox.link();a.UI.setURL(this._currentViewURL);e.Utils.waitFor(function(){return t(".bb_overview").length>0}).then(n)},loadInbox:function(e){this._currentViewURL=i.Constants.Inbox;if(!i.isInboxView()){a.UI.setURL(i.Constants.Inbox,e)}else{e()}},pickPipeline:function(e){var t=this;this.newModalPipeline=a.Widgets.NewPipelineModal.create({title:"How Can Streak Help You?",subHeadingText:"Don't worry, you can change this later",showCancel:false,close:false,escClose:false,showConfirm:false,noPipelineChosenCallback:this.noPipelinePicked.bind(this),pipelineChosenCallback:e.next,pipelinePrecreateCallback:function(e){t.pipelinePicked(e)}});this.newModalPipeline.show()},pickPipelineDestroy:function(){this.newModalPipeline.close()},pipelinePicked:function(t){var n=this;this.recordEvent("pipelineCreated");this.currentPipeline=a.Data.getAllPipelines()[0];this.getShareModal().setPipelines([this.currentPipeline]);e.NotificationCenter.subscribe({eventName:"operationProgressUpdate",observer:this,filterParameters:{operationProgressId:t,operationIsComplete:true},unsubscribeImmediately:true,functionToCall:function(){this.createBox();this.setupPipeline()}})},noPipelinePicked:function(){this.changeChapterTo("noPipelineChosen")},shareStreak:function(e){var t=this;this.getShareModal().show({cancelFunction:function(){t.recordEvent("streakNotShared");t.recordEvent("streakShareModalClosed");e.next()},onPresave:function(n){t.recordEvent("streakShared",{value:n.length});t.recordEvent("streakShareModalClosed");e.next()}})},shareStreakDestroy:function(){this.getShareModal().close()},setupExistingPipeline:function(e){this.currentPipeline=n.max(a.Data.getAllPipelines(),function(e){return a.Data.getPipelineBoxes(e.key()).length});var t=a.Data.getPipelineBoxes(this.currentPipeline.key());if(t.length===0){this.createBox();this.setupPipeline()}else{this.currentBox=t[0]}if(e){e()}},cleanUpDataCreatedByTour:function(){for(var e=0;e<this.fakeBoxes.length;e++){this.fakeBoxes[e].postNotification("delete")}this.fakeBoxes.length=0;for(var e=0;e<this.createdBoxes.length;e++){this.createdBoxes[e].del()}this.createdBoxes.length=0;for(var e=0;e<this.modifiedCollections.length;e++){this.modifiedCollections[e].refresh=this.modifiedCollections[e]._refresh}this.modifiedCollections.length=0},getInstanceSettings:function(){var e={};if(this.createdPipelines&&this.createdPipelines.length>0){e.pipelineKeys=n.map(this.createdPipelines,function(e){return e.key()})}if(this.createdBoxes&&this.createdBoxes.length>0){e.boxKeys=n.map(this.createdBoxes,function(e){return e.key()})}if(this.currentPipeline){e.currentPipelineKey=this.currentPipeline.key()}if(this.currentBox){e.currentBoxKey=this.currentBox.key()}return e},loadInstanceSettings:function(e){if(e){this.createdPipelines=[];if(e.pipelineKeys&&e.pipelineKeys.length>0){for(var t=0;t<e.pipelineKeys.length;t++){var i=a.Data.getPipeline(e.pipelineKeys[t]);if(i){this.createdPipelines.push(i)}}}this.createdBoxes=[];if(e.boxKeys&&e.boxKeys.length>0){for(var t=0;t<e.boxKeys.length;t++){var r=a.Data.getBox(e.boxKeys[t]);if(r){this.createdBoxes.push(r)}}}if(e.currentPipelineKey){var i=a.Data.getPipeline(e.currentPipelineKey);if(i){this.currentPipeline=i}else{this.currentPipeline=a.Data.getAllPipelines()[0]}}else{if(a.Data.getAllPipelines().length>0){this.currentPipeline=a.Data.getAllPipelines()[0]}}if(e.currentBoxKey){var r=a.Data.getBox(e.currentBoxKey);if(r){this.currentBox=r}else if(this.createdBoxes.length>0){this.currentBox=this.createdBoxes[0]}else if(this.currentPipeline){var o=n.filter(a.Data.getPipelineBoxes(this.currentPipeline.key()),function(e){return e.isSavedOnServer()});if(o.length>0){this.currentBox=o[0]}}}else{if(a.Data.getAllBoxes().length>0){this.currentBox=a.Data.getAllBoxes()[0];if(this.currentBox.getPipeline().key()!==this.currentPipeline.key()){this.currentPipeline=this.currentBox.getPipeline()}}}if(this.currentPipeline){this.setupPipeline();if(!this.currentBox){this.createBox()}}if(this.currentBox){this.setupBox()}}}});a.Modules.Tours=a.Modules.Tours||{};a.Modules.Tours.FirstRunTour=o})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.HTML,a=e.APIRequester,o=e.BentoBox;var s=function(e,t){o.Tracker.trackStreakActive(t,{eventName:e})};var l=function(e){o.Modules.Tours.FirstRunTour.call(this,e)};l.prototype=Object.create(o.Modules.Tours.FirstRunTour.prototype);n.extend(l.prototype,{showIOSModal:function(e){var n=t(this._html.get("extendedTouriPhoneModalInner")());var i=n.find(".extendedTourIPhoneModalInput");var r=i.find("input");var l=n.find(".extendedTourIPhoneModalInputStatus");var u=o.Widgets.Button.create({name:"Send To My Phone",color:"blue",onFunc:function(t){s("send_ios_link_attempt");u.disable();c.getOkButton().disable();u.el.html("<div>Sending...</div>");var n=r.val();a.post("promos/ioslink",null,{phoneNumber:n}).getPromise().then(function(t){if(t.success){s("send_ios_link_successful");u.el.html("<div>Sent!</div>");setTimeout(function(){c.close();e.next()},2*1e3)}else{s("send_ios_link_failure");c.getOkButton().enable();u.enable();u.el.html("<div>Send To My Phone</div>");l.css("color","red");l.html("Sorry there was an error. Please go to www.streak.com/iphone on your iPhone.");l.show()}},function(){l.css("color","red");l.html("Sorry there was an error. Please go to www.streak.com/iphone on your iPhone.");l.show()},null,null,true)}});i.find(".extendedTourIPhoneModalInputButton").append(u.el);r.on("keydown",function(e){if(e.which===13){u.on()}});r.on("focus",function(e){i.addClass("acm")});r.on("blur",function(e){i.removeClass("acm")});t.tabChain([r,u.el]);var c=o.Widgets.Modal.create({title:"Get Streak for your iPhone",width:"550px",inner:n,showConfirm:true,showCancel:false,confirmText:"No thanks",doneButtonColor:"normal",onClose:e.next});c.show();setTimeout(function(){r.focus()},50)}});o.Modules.Tours=o.Modules.Tours||{};o.Modules.Tours.ExtendedTour=l})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={_downloadHelpFile:function(){var t=this;return new e.Request("GET",e.server,"/tours/help/help.json",{isAnonymous:true}).getPromise().then(function(e){t._helpFile=e})},_defaultAction:function(){if(this._isHelpVisibleByDefault()){this.getHelpViewController().show()}},_isHelpVisibleByDefault:function(){return!c.UserSettings.get("help/defaultHidden")},getHelpViewController:function(){if(!this._helpViewController){this._helpViewController=i.getInstance("BentoBox.Modules.Help.HelpViewController");this._helpViewController.setHelpFile(this._helpFile)}return this._helpViewController},startWatchingForTourClicks:function(){var e=this;r.elements.body[0].addEventListener("mousedown",function(t){if(t.target.tagName!=="A"){return}var n=t.target.href;if(n.indexOf("streakhelp://")===-1){return}var i=n.split("//")[1];if(!i){return}t.preventDefault();t.stopPropagation();t.stopImmediatePropagation();e.getHelpViewController().startChapter(i)},true);r.elements.body[0].addEventListener("click",function(e){if(e.target.tagName!=="A"){return}var t=e.target.href;if(t.indexOf("streakhelp://")===-1){return}var n=t.split("//")[1];if(!n){return}e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()},true)}};i.set("BentoBox.Modules.Help.HelpLoader",d);u.addFunction({functionKey:"helpFileLoaded",functionReference:function(){return d._downloadHelpFile()},dependentFunctionKeys:[]});u.addFunction({functionKey:"helpLoaderInitialized",functionReference:function(){},dependentFunctionKeys:["helpFileLoaded","htmlLoaded","localeLoaded"]});u.addFunction({functionKey:"helpLoaderDefaultActionTriggered",functionReference:function(){return d._defaultAction()},dependentFunctionKeys:["helpLoaderInitialized","userSettingsInitialized"]});u.addFunction({functionKey:"helpLoaderTourClickWatcher",functionReference:function(){return d.startWatchingForTourClicks()},dependentFunctionKeys:["helpLoaderInitialized","gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HelpView",superclass:s.View,_memberVariables:[{name:"_modalView",destroy:true},{name:"_modalWrapper",destroy:true}],_initialize:function(){s.View.prototype._initialize.call(this)},_setupElement:function(){},setModalView:function(e){this._modalView=e;this.getElement().addClass("streak__helpView")},getElement:function(){return this._modalView&&this._modalView.getElement()},show:function(){if(this._modalWrapper){r.readdToComposeArea(this._modalWrapper);return}this._modalWrapper=r.addToComposeArea(this.getElement(),350)},hide:function(){r.removeFromComposeArea(this._modalWrapper)}});i.set("BentoBox.Modules.Help.HelpView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HelpViewController",superclass:s.ViewController,_memberVariables:[{name:"_helpFile",destroy:false,set:true},{name:"_helpModalViewController",destroy:true},{name:"_searchableListViewController",destroy:true},{name:"_trackQueryDebouncer",destroy:false},{name:"_savedScrollPosition",destroy:true},{name:"_viewState",destroy:true},{name:"_currentTourChapterController",destroy:true}],_initialize:function(){s.ViewController.prototype._initialize.call(this);this._setupSearchableListViewController();this._setupHelpModalViewController();this._view.setModalView(this._helpModalViewController.getView());this._trackQueryDebouncer=n.debounce(this._trackQuery.bind(this),500)},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.Help.HelpView")
},_setupSearchableListViewController:function(){this._searchableListViewController=i.getInstance("BentoBox.Widgets.SearchableListViewController");this._searchableListViewController.setPlaceholder(c.Locale.getString("search_help"));this._searchableListViewController.setShouldLockSelection(false);this._setupNoSearchResultsMessage();this._searchableListViewController.getEventStream().filter(function(e){return e.eventName==="rowSelected"}).map(function(e){return e.rowData}).onValue(this,"_rowSelected")},_setupNoSearchResultsMessage:function(){var e=o.getElement("helpMenuNoSearchResults");var t=this;e.find("a").click(function(e){t.closeClicked();r.GmailComposeWindowRequester.requestNewComposeWindow(function(e){e.setToAddresses(["support@streak.com"]);e.setSubject("Help Topic Suggestion")});e.stopImmediatePropagation();e.preventDefault()});this._searchableListViewController.setEmptyViewMessage(e)},_setupHelpModalViewController:function(){this._helpModalViewController=i.getInstance("BentoBox.Widgets.HelpModalViewController");this._helpModalViewController.addDelegate(this);this._helpModalViewController.hideBackButton();this._helpModalViewController.setContentViewController(this._searchableListViewController);var e=this._searchableListViewController.getSearchInputViewController();this._helpModalViewController.setTitleViewController(e);this._helpModalViewController.setTitleText("Streak Help")},setHelpFile:function(e){this._helpFile=e;this._searchableListViewController.addDelegate(this);this._searchableListViewController.setDataSource(this)},_bindToTourEvents:function(){var e=this;l.subscribe({eventName:"tourStarting",functionToCall:function(){e._savedScrollPosition=e._searchableListViewController.getScrollPosition();e._view.hide()},observer:this});l.subscribe({eventName:"tourFinished",functionToCall:function(){e._view.show();e._searchableListViewController.focus();e._searchableListViewController.setScrollPosition(e._savedScrollPosition);e._currentTourChapterController=null},observer:this});l.subscribe({eventName:"tourHelpCloseClicked",functionToCall:function(){if(!e._currentTourChapterController){return}e.closeClicked()},observer:this})},_unbindFromTourEvents:function(){e.NotificationCenter.unsubscribe({observer:this})},show:function(e){this._bindToTourEvents();this._searchableListViewController.reset();this._view.show();if(e){this._helpModalViewController.restore()}this._searchableListViewController.focus();this._viewState="VISIBLE";c.UserSettings.set("help/defaultHidden",false);c.UserSettings.save()},getState:function(){return{searchText:this._searchableListViewController.getSearchText(),scrollPosition:this._searchableListViewController.getScrollPosition(),viewState:this._viewState}},setState:function(e){this._searchableListViewController.setSearchText(e.searchText);this._searchableListViewController.setScrollPosition(e.scrollPosition);switch(e.viewState){case"VISIBLE":this.show(true);break;case"HIDDEN":this.closeClicked();break;case"MINIMIZED":this._helpModalViewController.minimize();break}},closeClicked:function(){c.Tracker.track("help menu closed");this._view.hide();c.UserSettings.set("help/defaultHidden",true);if(this._hasNotSeenTopMenuTooltip()){this._showTopMenuTooltip()}this._unbindFromTourEvents();c.UserSettings.save();this._eventStream.push({eventName:"closeClicked"});this._viewState="HIDDEN"},minimizeClicked:function(){c.Tracker.track("help menu minimized");this._helpModalViewController.setIconClass("streak__helpView_icon");this._viewState="MINIMIZED"},restoreClicked:function(){c.Tracker.track("help menu restored");this._helpModalViewController.setIconClass("");this._searchableListViewController.focus();this._viewState="VISIBLE"},getNumberOfSections:function(){return this._helpFile.HelpMenu.length},getSectionTitle:function(e){return this._helpFile.HelpMenu[e].name},getNumberOfRows:function(e){return this._helpFile.HelpMenu[e].chapters.length},getRowData:function(e,t){return{text:this._helpFile.HelpMenu[e].chapters[t],chapterName:this._helpFile.HelpMenu[e].chapters[t]}},getRowSearchString:function(e,t){return this._helpFile.HelpMenu[e].chapters[t]+";"+this._helpFile.HelpMenu[e].name},keydown:function(t){if(e.jwerty.is("escape",t)){this.closeClicked()}},queryChange:function(e){this._trackQueryDebouncer(e)},_trackQuery:function(e){if(e){c.Tracker.track("help queried",{query:e})}},_rowSelected:function(e){this._currentTourChapterController=this.startChapter(e.chapterName)},doesChapterExist:function(e){return!!this._getChapterDefinition(e)},startChapter:function(e){var t=this._getChapterDefinition(e);if(!t){return}var n=new c.Tour.TourChapterViewController;n.run(t,this._helpFile.Chapters);return n},getChapterNames:function(){return n.map(this._helpFile.Chapters,function(e){return e.name})},_getChapterDefinition:function(e){return JSON.deepClone(n.find(this._helpFile.Chapters,function(t){return t.name.toUpperCase()===e.toUpperCase()}))},_hasNotSeenTopMenuTooltip:function(){return!c.UserSettings.get("help/seenTopMenuTooltip")},_showTopMenuTooltip:function(){this.startChapter("How to access Streak Help");c.UserSettings.set("help/seenTopMenuTooltip",true)},destroy:function(){this._unbindFromTourEvents();s.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Modules.Help.HelpViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.StateMachine,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=function(){this._menu=o.Widgets.Menu.create({maxHeight:450});this._shareButton=null;this._colorPicker=null;this._menuItems={rename:null,createSimilar:null,hide:null,show:null,deleteSeparator:null,"delete":null};this._currentPipeline=null;this._currentPipelineList=null;this._setup()};n.extend(s.prototype,{_setup:function(){this._createShareButton();this._menu.addSeparator();this._createColorPicker();this._menu.addSeparator();this._addModifyItems();this._menu.addSeparator();this._addMovePositionItems();this._addShowHideItems();this._addDeleteItems()},_createShareButton:function(){this._shareButton=o.Modules.PipelineView.ShareButton.create({isButton:false,isDark:true,iconAfter:false});this._shareButtonMenuItem=this._menu.addItem(this._shareButton.el)},_createColorPicker:function(){var e=this;this._colorPicker=o.Widgets.ColorPicker.create({label:o.Locale.getString("color_pipeline"),colorChosenFunc:function(t){isDefault=false;color=t;e._currentPipeline.setColor(color);e._currentPipeline.postNotification("colorChanged");e.track("pipelineColorChanged")},showRemove:true,removeColorFunc:function(){color={backgroundColor:"rgb(255, 173, 71)",textColor:"rgb(0, 0, 0)"};isDefault=true;e._currentPipeline.setColor(null);e._currentPipeline.postNotification("colorChanged");e.track("pipelineColorRemoved")}});this._menu.addSection(this._colorPicker.el)},_addModifyItems:function(){var e=this;this._addRenameItem();this._addCreateSimilarItem()},_addRenameItem:function(){var e=this;this._menuItems.rename=this._menu.addItem(o.Locale.getString("rename_pipeline"),function(){e.track("renamePipeline");o.Widgets.Modal.textboxModal({title:o.Locale.getString("rename_pipeline"),allowEmpty:false,startingText:e._currentPipeline.displayName(),callback:function(t){e._currentPipeline.set("name",t);e._currentPipeline.save()}})})},_addCreateSimilarItem:function(){var e=this;this._menuItems.createSimilar=this._menu.addItem(o.Locale.getString("create_similar_pipeline"),function(){o.Data.createSimilarPipeline(e._currentPipeline);e.track("createSimilarPipeline")})},_addMovePositionItems:function(){var e=this;this._menuItems.moveUp=this._menu.addItem(o.Locale.getString("move_up"),function(){var t=e._currentPipelineList.indexOf(e._currentPipeline.key());var i=e._currentPipelineList[t-1];e._currentPipelineList[t-1]=e._currentPipeline.key();e._currentPipelineList[t]=i;o.UserSettings.set("leftLink/pipelineSort",n.clone(e._currentPipelineList));o.UserSettings.save(true);e._currentPipeline.postNotification("navMenuOrderChanged");o.Data.getPipeline(i).postNotification("navMenuOrderChanged")});this._menuItems.moveDown=this._menu.addItem(o.Locale.getString("move_down"),function(){var t=e._currentPipelineList.indexOf(e._currentPipeline.key());var i=e._currentPipelineList[t+1];e._currentPipelineList[t+1]=e._currentPipeline.key();e._currentPipelineList[t]=i;o.UserSettings.set("leftLink/pipelineSort",n.clone(e._currentPipelineList));o.UserSettings.save(true);e._currentPipeline.postNotification("navMenuOrderChanged");o.Data.getPipeline(i).postNotification("navMenuOrderChanged")})},_addShowHideItems:function(){this._addShowItem();this._addHideItem()},_addShowItem:function(){var e=this;this._menuItems.show=this._menu.addItem(o.Locale.getString("unhide_pipeline"),function(){e._currentPipeline.setHidden(false);e.track("showPipeline")})},_addHideItem:function(){var e=this;this._menuItems.hide=this._menu.addItem(o.Locale.getString("hide_pipeline"),function(){e._currentPipeline.setHidden(true);e.track("hidePipeline")})},_addDeleteItems:function(){var e=this;this._menuItems.deleteSeparator=this._menu.addSeparator();this._menuItems["delete"]=this._menu.addItem(o.Locale.getString("delete_pipeline"),function(){e._deletePipeline(e._currentPipeline);e.track("deletePipeline")})},_deletePipeline:function(e){var t=o.Data.getPipelineBoxes(e.key());if(!n.isEmpty(t)){this._showCantDeletePipelineBecauseBoxes(e);return}var i=n.filter(o.Data.getAllSnippets(),function(t){return t.get("pipelineKey")===e.key()});var r="";var a=e.get("aclEntries");var s=a.length-1;var l=!n.isEmpty(i);var u=s>0;var c="<strong>"+i.length+" snippet"+(i.length>1?"s":"")+"</strong>";if(u||l){r+=" This pipeline has ";if(u){r+="<strong>"+s+" additional collaborator"+(s>1?"s":"")+"</strong>";if(e.get("orgWide")){r+=" and the <strong>"+e.get("organization").organizationId+" organization</strong>"}if(l){r+=" and "+c}}else{r+=c}}else{r='Press "OK" to delete this pipeline'}var d=o.Locale.getString("confirm_delete_pipeline")+e.displayName()+"?";o.Widgets.Modal.confirm(d,r,function(){e.del()})},_showCantDeletePipelineBecauseBoxes:function(e){var t=o.Locale.getString("boxes_cannot_delete_pipeline_body",{pipeline:e.displayNameText()});if(e.isHidden()){o.Widgets.Modal.create({title:o.Locale.getString("cannot_delete_pipeline"),inner:t,showConfirm:false}).show()}else{t+="<br /><br />"+o.Locale.getString("considered_hiding_pipeline");o.Widgets.Modal.create({title:o.Locale.getString("cannot_delete_pipeline"),inner:t,confirmText:o.Locale.getString("hide_pipeline_instead"),confirmFunc:function(){e.setHidden(true);o.ButterBarManager.showMessage(o.Locale.getString("pipeline_hidden"))}}).show()}},setCurrentPipeline:function(e){this._currentPipeline=e;this._currentPipelineList=o.UI.getSortedPipelineKeys().filter(function(e){return!o.Data.getPipeline(e).isHidden()});if(!e){return}this._menu.reset();this._updateShareButton();this._updateColorPicker();this._updateShowHideItems();this._updateDeleteItems();this._updateMoveItems();this._updateRenameButton()},getElement:function(){return this._menu.el},getCurrentPipeline:function(){return this._currentPipeline},_updateShareButton:function(){this._shareButton.setPipeline(this._currentPipeline);var e=o.Services.AccessManager.isAccessAllowed(this._currentPipeline,"Pipeline","CHANGE_PERMISSIONS");this._shareButton.setEnabled(e);this._shareButtonMenuItem.setEnabled(e)},_updateColorPicker:function(){this._colorPicker.updateColor(this._currentPipeline.getColor(),this._currentPipeline.displayName());this._colorPicker.showMenu()},_updateShowHideItems:function(){this._menuItems.show.hide();this._menuItems.hide.hide();if(this._currentPipeline.isHidden()){this._menuItems.show.show()}else{this._menuItems.hide.show()}},_updateDeleteItems:function(){var e=this._userCanDeletePipeline();this._menuItems.deleteSeparator.toggle(e);this._menuItems["delete"].toggle(e);this._menuItems["delete"].setEnabled(e)},_userCanDeletePipeline:function(){return o.Services.AccessManager.isAccessAllowed(this._currentPipeline,"Pipeline","DELETE")},_updateMoveItems:function(){this._menuItems.moveUp.hide();this._menuItems.moveDown.hide();if(this._currentPipeline.isHidden()){return}var e=this._currentPipelineList.indexOf(this._currentPipeline.key());if(e>0){this._menuItems.moveUp.show()}if(e<this._currentPipelineList.length-1){this._menuItems.moveDown.show()}},_updateRenameButton:function(){this._menuItems.rename.setEnabled(o.Services.AccessManager.isAccessAllowed(this._currentPipeline,"Pipeline","UPDATE"))},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}});function l(e){o.Modules.PipelineMenu=new s;if(e){e()}}e.DependencyManager.addFunction({functionKey:"leftLink.pipelineMenuInitialized",functionToCall:l,dependentFunctionKeys:["pipelineView.shareButtonInitialized","menuInitialized","widgets.colorPicker.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.StateMachine,r=e.Gmail,a=e.HTML,o=e.BentoBox;var s=function(){this._menu=o.Widgets.Menu.create();this._menuItems={showInInbox:null,rename:null,duplicate:null,"delete":null};this._currentPipeline=null;this._currentSavedView=null;this._setup()};n.extend(s.prototype,{_setup:function(){this._addShowInInboxItem();this._menu.addSeparator();this._addRenameItem();this._addDuplicateItem();this._addDeleteItem()},_addShowInInboxItem:function(){var e=this;this._menuItems.showInInbox=this._menu.addCheckItem(o.Locale.getString("saved_view_add_to_inbox"),function(t){if(t){e.track("addSavedViewToInbox");o.Modules.HeadsUpMasterController.addSection(e._currentSavedView.viewKey,e._currentPipeline.key())}else{e.track("removeSavedViewFromInbox");o.Modules.HeadsUpMasterController.removeSection(e._currentSavedView.viewKey)}})},_updateShowInInboxItem:function(){this._menuItems.showInInbox.setCheckboxState(o.Modules.PipelineView.SavedViewsController.externalIsInHeadsUp(this._currentSavedView.viewKey))},_addRenameItem:function(){var e=this;this._menuItems.rename=this._menu.addItem(o.Locale.getString("saved_view_rename"),function(){e.track("renameSavedView");o.Widgets.Modal.textboxModal({title:o.Locale.getString("saved_view_rename"),allowEmpty:false,startingText:e._currentSavedView.name,callback:function(t){e._currentSavedView.name=t;e._currentPipeline.updateSavedView(e._currentSavedView)}})})},_addDuplicateItem:function(){var e=this;this._menuItems.duplicate=this._menu.addItem(o.Locale.getString("saved_view_duplicate"),function(){e.track("duplicateSavedView");e._currentPipeline.addSavedView(e._currentSavedView.name+"*",e._currentSavedView.settings)})},_addDeleteItem:function(){var e=this;this._menuItems["delete"]=this._menu.addItem(o.Locale.getString("saved_view_delete"),function(){e.track("deleteSavedViewAttempt");var n=e._currentPipeline.get("numberOfTotalCollaborators")-1;var i=n>0;o.Widgets.Modal.confirmDelete(e._currentSavedView.name,function(){if(i){e.track("deleteSavedView2ndWarning");var r=["This pipeline has <storng>"+n+" additional collaborator"+(n+1?"s":"")+"</strong>"," and deleting this saved view will remove it for everyone. Are you absolutely sure you want to do this?"].join(" ");var a=o.Widgets.Modal.create({title:o.Locale.getString("confirm_delete_title",{item:e._currentSavedView.name}),confirmFunc:function(){t.modal.close();e.track("deleteSavedView2ndSuccess");o.Modules.PipelineView.SavedViewsController.externalDeleteSavedView(e._currentPipeline,e._currentSavedView)},confirmText:o.Locale.getString("delete"),inner:'<div class="superConfirm">'+r+"</div>",doneButtonColor:"red"});a.show(true);return true}else{e.track("deleteSavedViewSuccess");o.Modules.PipelineView.SavedViewsController.externalDeleteSavedView(e._currentPipeline,e._currentSavedView)}})})},_factorInPipelineEditability:function(){var e=this._isPipelineUpdateable();n.each(["rename","duplicate","delete"],function(t){this._menuItems[t].setEnabled(e)},this)},_isPipelineUpdateable:function(){return o.Services.AccessManager.isAccessAllowed(this._currentPipeline,"Pipeline","UPDATE")},setCurrentPipelineAndSavedView:function(e,t){this._currentPipeline=e;this._currentSavedView=t;if(!e||!t){return}this._updateShowInInboxItem();this._factorInPipelineEditability()},getElement:function(){return this._menu.el},track:function(e,t){o.Tracker.trackStreakActive(this.trackingContext,t,{eventName:e})}});function l(e){o.Modules.SavedViewsMenu=new s;if(e){e()}}e.DependencyManager.addFunction({functionKey:"leftLink.savedViewsMenuInitialized",functionToCall:l,dependentFunctionKeys:["menuInitialized","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.Library,s=e.jwerty,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.UI.ViewController;var h=e.UI.ViewController.prototype;SimpleBoxesMenuViewController=e.Class.subclass({className:"SimpleBoxesMenuViewController",superclass:d,_memberVariables:[{name:"_listViewController",destroy:true},{name:"_boxDetailViewController",destroy:true},{name:"_searchBoxViewController",destroy:true},{name:"_listModel",destroy:true},{name:"_excludedBoxKeys",destroy:true},{name:"_boxFilterFunction",destroy:false},{name:"_isMenuOpen",destroy:true}],_initialize:function(){h._initialize.call(this);this._listModel=o.getInstance("BentoBox.Widgets.ListView.ListViewBaseModel");this._listViewController=o.getInstance("BentoBox.Widgets.ListView.ListViewViewController");this._listViewController.addDelegate(this);this._listViewController.setDataSource(this._listModel);this._listModel.addDelegate(this._listViewController);this._searchBoxViewController=new c.Widgets.SearchSimpleVC;this._searchBoxViewController.addDelegate(this._listViewController);this._searchBoxViewController.addDelegate(this);this._searchBoxViewController.setPlaceholder(c.Locale.getString("add_linked_box"));this._boxDetailViewController=new c.Widgets.BoxesDetailsVC;this._view.setListView(this._listViewController.getView());this._view.setSearchBox(this._searchBoxViewController.getView());this._view.setBoxDetailPane(this._boxDetailViewController.getView());this._view.hideListContainer();this._blurTimeout},_setupView:function(){this._view=o.getInstance("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuView")},setExcludedBoxKeys:function(e){this._excludedBoxKeys={};if(!n.isArray(e)){return}for(var t=0;t<e.length;t++){this._excludedBoxKeys[e[t]]=true}},getFocusElement:function(){return this._searchBoxViewController.getFocusElement()},setBoxFilterFunction:function(e){this._boxFilterFunction=e},setEnabled:function(e){this._searchBoxViewController.setEnabled(e)},inputFocus:function(){clearTimeout(this._blurTimeout)},inputBlur:function(){var e=this;clearTimeout(this._blurTimeout);this._blurTimeout=setTimeout(function(){if(e._view){e._view.hideListContainer()}},250)},queryChange:function(e){this._listModel.removeAllSections();if(e.length===0){this._isMenuOpen=false;this._view.hideListContainer();return}this._isMenuOpen=true;this._view.showListContainer();var t=c.Services.BoxSearcher.searchNameByQuery(e,50);var i=this;t=n.filter(t,function(e){return!i._excludedBoxKeys[e.key()]});if(this._boxFilterFunction){t=n.filter(t,this._boxFilterFunction)}if(t.length===0){this._isMenuOpen=false;this._view.hideListContainer();return}this._listModel.addSection({rows:n.map(t,function(e){return{html:c.UI.getBoxListDisplayHTML(e),displayClass:"streak__boxListRow",data:e}})})},rowFocused:function(e){if(!e||!e.data){return}this._boxDetailViewController.setModel(e.data)},rowPressed:function(e){if(!e||!e.data){return}this._callDelegateFunction("boxChosen",e.data);this._searchBoxViewController.clearQuery();c.Tracker.track("simple boxes menu box chosen");this.inputFocus();this.focus()},emptyPressed:function(){this._callDelegateFunction("emptyPressed")},reset:function(){this._listModel.removeAllSections()},focus:function(){this._searchBoxViewController.focus()},setQuery:function(e){this._searchBoxViewController.setQuery(e)},getSearchBoxViewController:function(){return this._searchBoxViewController},isMenuOpen:function(){return this._isMenuOpen},keydown:function(e){if(s.is("tab",e)){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();this._listViewController.select()}}});o.set("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuViewController",SimpleBoxesMenuViewController)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.Library,s=e.NotificationCenter,l=e.DependencyManager,u=e.BentoBox;var c=e.Class.subclass({superclass:e.UI.View,_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=a.getElement("simpleBoxesMenu");this._listContainer=this._element.find(".streak__simpleBoxesMenu_listContainer");this._listContainer.detach()},setListView:function(e){this._listContainer.find(".streak__simpleBoxesMenu_list").html(e.getElement())},setSearchBox:function(e){this._element.find(".streak__simpleBoxesMenu_search").html(e.getElement())},setBoxDetailPane:function(e){this._listContainer.find(".streak__simpleBoxesMenu_boxDetails").html(e.getElement())},hideListContainer:function(){this._listContainer.detach()},showListContainer:function(){i.elements.body.append(this._listContainer);this._listContainer.containByScreen(this._element.find(".streak__simpleBoxesMenu_search"))},hideList:function(){this._element.find(".streak__simpleBoxesMenu_list").hide()},showList:function(){this._element.find(".streak__simpleBoxesMenu_list").show()}});o.set("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuView",c)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u=e.Class.subclass({className:"SidebarInjector",superclass:e.Object,_memberVariables:[{name:"_threadView",destroy:false,get:true},{name:"_options",destroy:false},{name:"_contentPanelView",destroy:false}],addSidebar:function(e){if(!this._contentPanelView){this._contentPanelView=this._threadView.addSidebarContentPanel(e)}return this._contentPanelView},removeSidebar:function(){if(this._contentPanelView){this._contentPanelView.remove()}this._contentPanelView=null},_initialize:function(t,n){e.Object.prototype._initialize.call(this);this._threadView=t;this._options=n;this._bindToEvents();var i=this;setTimeout(function(){i._checkInitialState()},1)},_bindToEvents:function(){e.NotificationCenter.subscribe({eventName:this._options.notificationCenterEventName,observer:this,filterParameters:{valueType:this._options.notificationCenterFilterValueType},functionToCall:this._handleNotification});this._threadView.on("destroy",this._options.destroy)},_handleNotification:function(e){var t=a.getActiveHexGmailThreadIdList(l.Services.Threads.HexGmailThreadIdExtractor);if(t.length===0){return}if(e.hexGmailThreadId!==t[0]){return}this._options.checkState(t[0],e)},_checkInitialState:function(){var e=a.getActiveHexGmailThreadIdList(l.Services.Threads.HexGmailThreadIdExtractor);if(e.length===0){return}this._options.checkState(e[0])},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.Object.prototype.destroy.call(this)}});l.Controllers.SidebarInjector=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:s.View,_memberVariables:[{name:"_inputView",destroy:false}],_initialize:function(){s.View.prototype._initialize.call(this);this._element=o.get("spreadsheetLinkedBoxes",true);return this},addLinkedBoxView:function(e){this._inputView.getElement().before(e.getElement())},setAddBoxInputView:function(e){this._inputView=e;this._element.append(e.getElement())}});i.set("BentoBox.Widgets.SpreadsheetLinkedBoxesView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.jwerty,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({superclass:s.ViewController,_memberVariables:[{name:"_box",destroy:false},{name:"_property",destroy:false},{name:"_simpleBoxesMenu",destroy:true},{name:"_pipelineKey",destroy:false},{name:"_temporaryBoxKeys",destroy:true},{name:"_linkedBoxViewControllers",destroy:true},{name:"_searchBoxViewController",destroy:false},{name:"_trackingContext",destroy:true}],_initialize:function(e){s.ViewController.prototype._initialize.call(this);this._simpleBoxesMenu=i.getInstance("BentoBox.Modules.SimpleBoxesMenu.SimpleBoxesMenuViewController");this._simpleBoxesMenu.setBoxFilterFunction(n.bind(this._boxFilterFunction,this));this._simpleBoxesMenu.addDelegate(this);this._searchBoxViewController=this._simpleBoxesMenu.getSearchBoxViewController();this._setupSearchBoxViewController();this._view.setAddBoxInputView(this._simpleBoxesMenu.getView());this._linkedBoxViewControllers=[];this._trackingContext=e.trackingContext;return this},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.SpreadsheetLinkedBoxesView")},setup:function(e){this.preDetach();this._setBox(e.model);this._setProperty(e.property);this._searchBoxViewController.clearQuery()},_setBox:function(e){this._box=e;this._temporaryBoxKeys=n.clone(this._box.get("linkedBoxKeys")||[])},_setProperty:function(e){this._property=e;var t=e.split(".");if(t.length>0){this._pipelineKey=t[1]}else{this._pipelineKey=null}this._simpleBoxesMenu.setExcludedBoxKeys(this._temporaryBoxKeys.concat(this._box.key()));this._renderLinkedBoxesInPipeline()},updateValue:function(){var e=this._box.get("linkedBoxKeys")||[];if(!JSON.isEqual(e,this._temporaryBoxKeys)){var t=i.get("BentoBox.Services.LinkedBoxesLimiter");if(this._temporaryBoxKeys.length>e){if(t.isLocked()){t.showGateway();this._temporaryBoxKeys=n.clone(this._box.get("linkedBoxKeys")||[]);return}}this.updateBoxes();d.Tracker.track("spreadsheet linked boxes updated");t.incrementUsage()}},updateBoxes:function(){var t=[this._box];var i;var r;var a;var o=this._box.get("linkedBoxKeys")||[];var s=n.difference(this._temporaryBoxKeys,o);var l=n.difference(o,this._temporaryBoxKeys);this._box.set("linkedBoxKeys",this._temporaryBoxKeys);for(r=0;r<l.length;r++){a=d.Data.getBox(l[r]);if(!a){continue}o=a.get("linkedBoxKeys")||[];o.removeVal(this._box.key());a.set("linkedBoxKeys",o);t.push(a)}for(r=0;r<s.length;r++){a=d.Data.getBox(s[r]);if(!a){continue}o=a.get("linkedBoxKeys")||[];o.push(this._box.key());a.set("linkedBoxKeys",o);t.push(a)}e.Model.saveAll(t)},_boxFilterFunction:function(e){return!this._pipelineKey||e.getPipeline().key()===this._pipelineKey},_renderLinkedBoxesInPipeline:function(){var e=this._getLinkedBoxKeysInPipeline();n.each(e,this._renderBoxInList,this)},_getLinkedBoxKeysInPipeline:function(){var e=this._box.get("linkedBoxKeys");if(!e){return[]}var t=this._pipelineKey;return n.chain(e).map(function(e){return d.Data.getBox(e)}).filter(function(e){return e&&(!t||e.getPipeline().key()===t)}).value()},_renderBoxInList:function(e){var t=i.getInstance("BentoBox.Widgets.SpreadsheetLinkedBoxViewController");t.setBox(e);t.addDelegate(this);this._linkedBoxViewControllers.push(t);this._view.addLinkedBoxView(t.getView())},_setupSearchBoxViewController:function(){this._searchBoxViewController.setPlaceholder("");this._searchBoxViewController.addDelegate(this)},keydown:function(e){if(l.is("escape",e)){this._temporaryBoxKeys=this._box.get("linkedBoxKeys");this._searchBoxViewController.getView().getElement().trigger("escapePressed")}else if(l.is("backspace",e)){if(!this._searchBoxViewController.isEmpty()){return}if(n.isEmpty(this._linkedBoxViewControllers)){return}var t=n.last(this._linkedBoxViewControllers);this.boxRemoved(t.getBox(),t)}},boxChosen:function(e){n.mutate("union",this._temporaryBoxKeys,[e.key()]);this._simpleBoxesMenu.setExcludedBoxKeys(this._temporaryBoxKeys);this._renderBoxInList(e)},boxClicked:function(e){r.inboxSDK.Router.goto(e.link())},boxRemoved:function(e,t){this._temporaryBoxKeys.removeVal(e.key());t.destroy();this._linkedBoxViewControllers.removeVal(t);this._simpleBoxesMenu.setExcludedBoxKeys(this._temporaryBoxKeys)},emptyPressed:function(){this._searchBoxViewController.getView().getElement().trigger("enterPressed")},getElement:function(){return this._view.getElement()},focus:function(e){if(!e){this._simpleBoxesMenu.reset()}this._simpleBoxesMenu.focus()},set:function(e){this._simpleBoxesMenu.reset();this._simpleBoxesMenu.setQuery(e)},preDetach:function(){n.each(this._linkedBoxViewControllers,function(e){e.destroy()});this._linkedBoxViewControllers.length=0}});e.Library.set("BentoBox.Widgets.SpreadsheetLinkedBoxesViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:s.View,_initialize:function(){s.View.prototype._initialize.call(this);this._element=o.get("spreadsheetLinkedBox",true);this._setupBindings();return this},setText:function(e){this._element.find(".streak__spreadsheetLinkedBox_text").html(e);this._element[0].setAttribute("title",e)},_setupBindings:function(){var e=this;this._element.find(".streak__spreadsheetLinkedBox_text").click(function(t){e._callDelegateFunction("textClicked")});this._element.find(".streak__spreadsheetLinkedBox_x").click(function(t){e._callDelegateFunction("xClicked");t.stopPropagation()})}});i.set("BentoBox.Widgets.SpreadsheetLinkedBoxView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:s.ViewController,_memberVariables:[{name:"_box",destroy:false}],_initialize:function(){s.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.SpreadsheetLinkedBoxView")},setBox:function(e){this._box=e;this._view.setText(e.displayName())},getBox:function(){return this._box},textClicked:function(){this._callDelegateFunction("boxClicked",this._box);c.Tracker.track("spreadsheet linked box link clicked")},xClicked:function(){this._callDelegateFunction("boxRemoved",this._box,this);c.Tracker.track("spreadsheet linked box x clicked")}});i.set("BentoBox.Widgets.SpreadsheetLinkedBoxViewController",d)})(Streak);Streak.BentoBox.Modules.Reports={};Streak.BentoBox.Modules.Reports.Constants={ANY_USER:"ANY_USER",ALL_USERS:"ALL_USERS",HOURLY:"HOURLY",DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY",LAST_SIXTY_MINUTES:"LAST_SIXTY_MINUTES",TODAY:"TODAY",THIS_WEEK:"THIS_WEEK",THIS_MONTH:"THIS_MONTH",THIS_YEAR:"THIS_YEAR",INTO_STAGE_COLOR:"rgb(68, 185, 132)",OUT_OF_STAGE_COLOR:"rgb(230, 101, 80)",ALL_STAGES:"ALL_STAGES",KNOWN_DEALSIZE_COLUMNS:["Deal Size","Investment Amount","Amount","Cost","Rent"],DEALSIZE_COLUMN_BLACKLIST:["Stage","Assigned To"],GATEWAY_DELAY:5e3};(function(e){var t=e.$,n=e._,i=e.BentoBox,r=e.BentoBox.Data,a=e.Date,o=e.Locale,s=e.BentoBox.Modules.Reports;var l=s.Constants;s.Utils={timeRangeToLocaleKey:function(e){if(e===s.Constants.LAST_SIXTY_MINUTES){return"time_range_last_sixty_minutes"}if(e===s.Constants.TODAY){return"time_range_this_day"}if(e===s.Constants.THIS_WEEK){return"time_range_this_week"}if(e===s.Constants.THIS_MONTH){return"time_range_this_month"}if(e===s.Constants.THIS_YEAR){return"time_range_this_year"}},timeGranularityToLocaleKey:function(e){if(e===s.Constants.HOURLY){return"time_granularity_hour"}if(e===s.Constants.DAILY){return"time_granularity_day"}if(e===s.Constants.WEEKLY){return"time_granularity_week"}if(e===s.Constants.MONTHLY){return"time_granularity_month"}if(e===s.Constants.YEARLY){return"time_granularity_year"}},bestUnitForDurationInSeconds:function(e){var t=5;var n=[{sizeInSeconds:1,nameTranslationKey:"seconds",numberAbbreviationTranslationKey:"number_seconds_abbreviated"},{sizeInSeconds:60,nameTranslationKey:"minutes",numberAbbreviationTranslationKey:"number_minutes_abbreviated"},{sizeInSeconds:60*60,nameTranslationKey:"hours",numberAbbreviationTranslationKey:"number_hours_abbreviated"},{sizeInSeconds:60*60*24,nameTranslationKey:"days",numberAbbreviationTranslationKey:"number_days_abbreviated"}];for(var i=0;i<n.length;i++){var r=n[n.length-i-1];if(r.sizeInSeconds*t<e){return r}}return n[0]},round:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n
},containsUser:function(e){if(n.contains(e.userFilter,s.Constants.ANY_USER)&&e.user!==s.Constants.ALL_USERS){return true}if(n.contains(e.userFilter,e.user)){return true}return false},shouldShowUserColumn:function(e){return!n.contains(e,s.Constants.ALL_USERS)},filterJsonParts:function(e){var t=e.parts;var n=[];for(var i=0;i<t.length;i++){var r=t[i];if(e.timeGranularity&&r.timeGranularity!==e.timeGranularity){continue}if(e.timeRange&&r.timeRange!==e.timeRange){continue}if(e.stageKey&&r.stageKey!==e.stageKey){continue}if(e.userFilter&&!s.Utils.containsUser({user:r.userKey,userFilter:e.userFilter})){continue}n.push(r)}return n},addUserNameToJsonParts:function(e){var t=e.parts;var n=e.users;for(var i=0;i<t.length;i++){var r=t[i];if(r.userKey==="ALL_USERS"){r.userName=o.getString("reports_all_users")}else{var a=n[r.userKey];if(a){r.userName=a.displayName}}}},usersFromPipeline:function(e){var t=e.pipeline;var n={};var r=i.Data.getPipelineBoxes(t.key());for(var a=0;a<r.length;a++){var o=r[a];var s=o.getAssignedToSharingEntries();for(var l=0;l<s.length;l++){var u=s[l];n[u.userKey]={userKey:u.userKey,displayName:u.displayName}}}return n},timeRangeLocalization:function(e){var t=this.timeRangeToLocaleKey(e);return o.getString(t)},timeGranularityLocalization:function(e){var t=s.Utils.timeGranularityToLocaleKey(e);return o.getString(t)},getBoxValueForColumn:function(e){var t=e.box;var n=e.column;var i=e.pipeline;if(n.columnType==="property"){return t.getGroupByValue(n.value.property)}else if(n.columnType==="field"){return t.getFieldGroupByValue(n.value.fieldKey)}},getBoxValueDisplayText:function(e){var t=e.column;var n=t.value.columnKey;var r=e.key;var o=e.pipeline;var s="no_value";if(n==="property|stageKey"){var l=o.getStage(r);if(l){s=o.getStage(r).displayNameText()}}else if(n.indexOf("property")>-1){var u=i.Models.Pipeline.getPropertyFilterAndGroupType(t.value.property);switch(u){case"DATE":var c=a.ccreate(r);if(c.isValid()){s=c.prettyDate(true)}break;default:s=r;break}}else if(n.indexOf("field")>-1){var d=n.split("|")[1];return i.Models.BoxField.getGroupByDisplayTextValue(r,o,d,n.granularity)}if(s==="no_value"){return"No Value"}return s},isColumnDate:function(e){var t=e.column;var n=e.pipeline;if(t.value.columnKey.indexOf("property")>-1){return i.Models.Pipeline.getPropertyFilterAndGroupType(t.value.property)==="DATE"}else{return n.getField(t.value.columnKey.split("|")[1])==="DATE"}},countWithSplitCredit:function(e,t){var i={};n.each(e,function(e){var r=t(e);var a=1/r.length;n.each(r,function(e){i[e]=(i[e]||0)+a})});return i},sumWithSplitCredit:function(e,t){var i={};n.each(e,function(e){var r=t.groupBy(e);var a=t.valueBy(e)/r.length;n.each(r,function(e){i[e]=(i[e]||0)+a})});return i},_getOrderedColumnsForPipeline:function(e){return i.UI.getPipelineColumnList(e,e.getGroupableSystemColumns())},_isStageColumn:function(e){return e.columnType==="property"&&e.value.property==="stageKey"},_isAssignedToColumn:function(e){return e.columnType==="property"&&e.value.property==="assignedToSharingEntries"},_isLinkedBoxColumn:function(e){return e.columnType==="property"&&e.value.property.indexOf("linkedBoxes")>-1},getOrderedColumnKeysForPipeline_exceptStageAndAssignedTo:function(e){var t=this._getOrderedColumnsForPipeline(e);var i=this;t=n.reject(t,function(e){return i._isStageColumn(e)||i._isAssignedToColumn(e)||i._isLinkedBoxColumn(e)});var r=[];for(var a=0;a<t.length;a++){var o=t[a];r.push(o.value.columnKey)}return r},getOrderedColumnKeysForPipeline:function(e){var t=this._getOrderedColumnsForPipeline(e);var n=[];for(var i=0;i<t.length;i++){var r=t[i];n.push(r.value.columnKey)}return n},getStageColumnKeyForPipeline:function(e){var t=this;var i=n.find(this.getColumnsForPipeline(e),function(e){return t._isStageColumn(e)});if(!i){return null}return i.value.columnKey},getAssignedToColumnKeyForPipeline:function(e){var t=this;var i=n.find(this.getColumnsForPipeline(e),function(e){return t._isAssignedToColumn(e)});if(!i){return null}return i.value.columnKey},getAllColumnsForPipeline:function(e){var t=i.UI.getPipelineColumnList(e,e.getAllSystemColumns().concat(i.Models.Pipeline.getGroupableSystemProperties()));var n={};for(var r=0;r<t.length;r++){var a=t[r];n[a.value.columnKey]=a}return n},getColumnsForPipeline:function(e){var t=i.UI.getPipelineColumnList(e,i.Models.Pipeline.getGroupableSystemProperties());var n={};for(var r=0;r<t.length;r++){var a=t[r];n[a.value.columnKey]=a}return n},getPrettyDateTimeStringFromSeconds:function(e){var t,n;var i=e/(60*60*24);if(i<1){var r=e/(60*60);if(r<1){var a=e/60;if(a<1){var s=Math.round(e);n=o.getString("number_seconds_abbreviated",{number:s});t=o.getString("number_seconds",{number:s})}else{var l=this._prettifyNumber(a);n=o.getString("number_minutes_abbreviated",{number:l});t=o.getString("number_minutes",{number:l})}}else{var u=this._prettifyNumber(r);n=o.getString("number_hours_abbreviated",{number:u});t=o.getString("number_hours",{number:u})}}else{var c=this._prettifyNumber(i);n=o.getString("number_days_abbreviated",{number:c});t=o.getString("number_days",{number:c})}return{shortTimeString:n,timeString:t}},_prettifyNumber:function(e){if(e>5){return Math.round(e)}else{return e.toFixed(1)}},unformatCurrency:function(e){var t=null;if(e==null)return t;if(typeof e==="number")return e;var n=(""+e).replace(/\((.*)\)/,"-$1").replace(/[^0-9-.,]/g,"");var i=/^-?(\d{1,3}(?:\.\d{3})*)(,\d{2}|-+)?$|^-?(\d{1,3}(?:,\d{3})*)(\.\d{2}|-+)?$|^-?(\d+)(\.\d+|-+)?$/;var r=i.exec(n);if(r){if(r[1]){var a=parseFloat(r[1].replace(/[^0-9]/,"")+"."+(r[2]||"").replace(/[^0-9]/,""))}else{if(r[3]){var a=parseFloat(r[3].replace(/[^0-9]/,"")+"."+(r[4]||"").replace(/[^0-9]/,""))}else{var a=parseFloat(r[5].replace(/[^0-9]/,"")+"."+(r[6]||"").replace(/[^0-9]/,""))}}return!isNaN(a)?a:t}else{return t}return!isNaN(a)?a:0},formatCurrency:function(e,t){if(!n.isFinite(e)){return"?"}if(!t){t="$"}var i=2,r={thousand:",",decimal:"."};var a=e<0?"-":"",o=parseInt(Math.abs(e).toFixed(i),10)+"",s=o.length>3?o.length%3:0;return a+t+(s?o.substr(0,s)+r.thousand:"")+o.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+r.thousand)+(i?r.decimal+Math.abs(e).toFixed(i).split(".")[1]:"")},deletePipelineSettings:function(e){var t=r.getPipeline(e);t.setUISettings("reporting",null)},delegateUnfoundMethods:function(e,t){return n.extend(this.bindAll(t),e)},guessDealsizeColumn:function(e){var t=n.find(e,function(e){for(var t=0;t<s.Constants.KNOWN_DEALSIZE_COLUMNS.length;t++){if(s.Constants.KNOWN_DEALSIZE_COLUMNS[t]===e.name){return true}}return false});return t},possibleDealsizeColumns:function(e,t){return n.filter(t,function(e){var t=s.Constants.DEALSIZE_COLUMN_BLACKLIST;for(var n=0;n<t.length;n++){if(e.name===t[n]){return false}}return true})}}})(Streak);(function(e){var t=e._;var n=e.BentoBox.Modules.Reports;var r=n.Constants;var a=e.Object;n.TimeseriesData=e.Class.subclass({superclass:a,memberVariables:[{name:"_users",destroy:false},{name:"_userColumns",destroy:false},{name:"_timestamps",destroy:false},{name:"_timeColumns",destroy:false},{name:"_timeColumnIndex",destroy:false},{name:"_data",destroy:false},{name:"_seriesStyles",destroy:false}],_initialize:function(){a.prototype._initialize.call(this);this._data=new google.visualization.DataTable;this._users=[];this._userColumns={};this._timestamps=[];this._timeColumns={};this._seriesStyles={};this._timeColumnIndex=this._data.addColumn("datetime","Time")},addPoint:function(e){var n=this._ensureUserColumnExists(e.series,e.tooltip);var i=this._ensureTimestampRowExists(e.time,e.tooltip);this._setPoint({rowIndex:i,columnIndex:n,value:e.value});if(t.isReal(e.tooltip)){this._setPoint({rowIndex:i,columnIndex:n+1,value:e.tooltip})}},setSeriesStyle:function(e){this._seriesStyles[e.series]=e.style},_setPoint:function(e){this._data.setCell(e.rowIndex,e.columnIndex,e.value)},_ensureUserColumnExists:function(e,n){if(!t.contains(this._users,e)){var i=this._data.addColumn("number",e);this._userColumns[e]=i;this._users.push(e);if(t.isReal(n)){this._data.addColumn({type:"string",role:"tooltip",p:{html:true}})}}return this._userColumns[e]},_ensureTimestampRowExists:function(e,n){var i=this._hashTimestamp(e);if(!t.contains(this._timestamps,i)){var r=this._data.addRow();this._setPoint({rowIndex:r,columnIndex:this._timeColumnIndex,value:e});this._timestamps.push(i);this._timeColumns[i]=r}return this._timeColumns[i]},_hashTimestamp:function(e){return e.getTime()},getVisualizationDataTable:function(){return this._data},getSeriesChartFormatter:function(){var e=[];for(i=0;i<this._users.length;i++){var t=this._users[i];var n=this._seriesStyles[t];if(n){this.styles.push(n)}else{this.styles.push({})}}}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineReportSettingsGlobalController",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);this._bindToEvents()},_bindToEvents:function(){var e=this;c.Data.getAllPipelines().watch("set",function(e){var t=e.property;var n=e.model;if(t!=="uiSettings"){return}l.postNotification({eventName:"pipelineReportSettings.changed",pipelineKey:n.key(),sender:this})},this)}});e.DependencyManager.addFunction({functionKey:"pipelineReportSettingsGlobalControllerInitialized",functionToCall:function(e){i.set("BentoBox.PipelineReportSettingsGlobalController",new d);if(e){e()}},dependentFunctionKeys:["data.pipelines.initialized"]})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Data,r=e.HTML,a=e.Locale,o=e.BentoBox.Modules.Reports,s=e.BentoBox.Tracker,l=e.UI;var u=l.View;o.YellowConfigureBarView=e.Class.subclass({superclass:u,memberVariables:[{name:"_text",destroy:false},{name:"_title",destroy:false},{name:"_button",destroy:false}],_initialize:function(){u.prototype._initialize.call(this);this._text=this._element.find(".streak__reports_configure_text");this._title=this._element.find(".streak__reports_configure_text_title");this._button=this._element.find(".streak__reports_configure_button");var e=this;this._confirmButton=n.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:n.Locale.getString("reports_configure").capitalize(),color:"blue",onFunction:function(){e._callDelegateFunction("configureButtonPressed")}});this._button.html(this._confirmButton.getElement())},_setupElement:function(){this._element=r.getElement("streak_reports__yellow_configure_bar")},setText:function(e){this._text.text(e)},setHTML:function(e){this._text.html(e)},setTitle:function(e){this._title.text(e)}})})(Streak);(function(e){var t=e._,n=e.$,i=e.BentoBox,r=e.BentoBox.Data,a=e.Locale,o=e.BentoBox.Modules.Reports,s=e.BentoBox.Tracker,l=e.UI;var u=l.ViewController;o.YellowConfigureBarViewController=e.Class.subclass({superclass:u,memberVariables:[{name:"_configureViewController",get:true,set:true,destroy:false}],_initialize:function(){u.prototype._initialize.call(this);this._view.setText(a.getString("reports_no_deal_size_columns_text"));this._view.setTitle(a.getString("reports_no_deal_size_columns_title"))},_setupView:function(){this._view=new o.YellowConfigureBarView},configureButtonPressed:function(){this.showConfigureView()},showConfigureView:function(){var e=this._configureViewController.getView().getElement();var t=this;var n=i.Widgets.Modal.create({title:a.getString("reports_configure_title"),inner:e,showConfirm:true,showCancel:false,width:475,confirmFunc:function(){t._configureViewController.save()},confirmText:a.getString("save")});n.show()}})})(Streak);Streak.BentoBox.Modules.Reports.Charts={};(function(e){var t=e._,n=e.UI,i=e.BentoBox.Modules.Reports,r=e.Locale,a=e.Utils,o=e.HTML;var s=e.UI.View;var l={BAR_HEIGHT:70};i.InOutView=e.Class.subclass({superclass:s,memberVariables:[{name:"_data",destroy:false},{name:"_backgroundColor",destroy:false},{name:"_textColor",destroy:false},{name:"_mainBox",destroy:false},{name:"_netBox",destroy:false},{name:"_inBar",destroy:false},{name:"_outBar",destroy:false},{name:"_inBarSpacer",destroy:false},{name:"_outBarSpacer",destroy:false}],_setupElement:function(){this._element=o.getElement("streak__reports_stage_report_in_out_box")},_initialize:function(){s.prototype._initialize.call(this);this._mainBox=this._element.find(".streak__reports_main_box");this._netBox=this._element.find(".streak__reports_net_label");this._inBar=this._element.find(".streak__inArrow .streak__reports_bar");this._outBar=this._element.find(".streak__outArrow .streak__reports_bar");this._inBarSpacer=this._element.find(".streak__inArrow .streak__reports_bar_spacer");this._outBarSpacer=this._element.find(".streak__outArrow .streak__reports_bar_spacer");this._data={};this._isSelected=false},setData:function(e){this._data=e;if(e){this._element.find(".streak__reports_inText").text(e.in);this._netBox.text(a.signedNumber(e.net));var t=this._element.find(".streak__reports_net_label");if(e.net>0){t.removeClass("streak__reports_none_color");t.removeClass("streak__reports_out_of_color");t.addClass("streak__reports_into_color")}else if(e.net<0){t.removeClass("streak__reports_none_color");t.removeClass("streak__reports_into_color");t.addClass("streak__reports_out_of_color")}else{t.addClass("streak__reports_none_color");t.removeClass("streak__reports_into_color");t.removeClass("streak__reports_out_of_color")}this._element.find(".streak__reports_outText").text(e.out);this._element.find(".streak__reports_inout_label").text(e.label);this._element.find(".streak__reports_inout_label").attr("data-tooltip",e.label);var n=this._barHeight(e.in,e.max);var i=this._barHeight(e.out,e.max);var r=l.BAR_HEIGHT-n;var o=l.BAR_HEIGHT-i;this._inBar.css({height:n+"px"});this._outBar.css({height:i+"px"});this._inBarSpacer.css({height:r+"px"});this._outBarSpacer.css({height:o+"px"})}else{this._element.find(".streak__reports_inText").text("");this._element.find(".streak__reports_outText").text("");this._element.find(".streak__reports_net").text("");this._element.find(".streak__reports_inout_label").text("")}this._redraw()},_barHeight:function(e,t){if(e==0){return 0}var n=Math.log(e)+1;var i=Math.log(t)+1;return n/i*l.BAR_HEIGHT},setBackgroundColor:function(e){this._backgroundColor=e;this._mainBox.css("background-color",e);this._netBox.css("border-color",e)},setTextColor:function(e){this._textColor=e;this._mainBox.css("color",e)},getZoomElement:function(){return this._mainBox},setZoomElementClickHandler:function(e){this.getZoomElement().click(e)},setSelected:function(){this._element.addClass("streak__reports_inout_selected")},setUnselected:function(){this._element.removeClass("streak__reports_inout_selected")},_redraw:function(){}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.UI,r=e.Locale,a=e.BentoBox.Modules.Reports;var o=e.Class.mixin(i.ChartViewController);a.Charts.StageInOutViewController=e.Class.subclass({superclass:o,memberVariables:[{name:"_data",destroy:false},{name:"_stageKey",get:true,destroy:false},{name:"_pipeline",get:true,destroy:false}],_setupView:function(){this._view=new a.InOutView},_retrieveData:function(){this._data=this._dataSource.getSummaryData(this._stageKey);this._view.setData(this._data)},setPipeline:function(e){this._pipeline=e;this._setupColors()},_setupColors:function(){var e="black";var t="white";if(this._stageKey&&this._pipeline){var i=n.UI.getStageColors(this._pipeline);e=i[this._stageKey].backgroundColor;t=i[this._stageKey].textColor}this._view.setBackgroundColor(e);this._view.setTextColor(t)},selectStageKey:function(e){var t=this;this._stageKey=e;this._setupColors();this._view.setZoomElementClickHandler(function(){t._notifySelected(e)})},_notifySelected:function(e){var t={view:this,stageKey:e};this._callDelegateFunction("stageInOutMainViewSelected",t)},select:function(){this._view.setSelected()},unselect:function(){this._view.setUnselected()}})})(Streak);(function(e){var t=e._,n=e.HTML,i=e.BentoBox.Modules.Reports;var r=e.UI.ChartView;i.SummaryDetailChartView=e.Class.subclass({superclass:r,memberVariables:[{name:"_selection",destroy:false,get:true},{name:"_detailer",destroy:false,set:true},{name:"_summaryElements",destroy:false}],_setupElement:function(){this._element=n.getElement("streak__reports_summarydetail_view")},_initialize:function(){r.prototype._initialize.call(this);var e=this;this._summaryElements={};this._element.find(".streak__reports_summarydetail_summary")[0].onscroll=function(){e._summaryAreaScrolled()}},_getBoxInParent:function(e,t){var n=t.offset().left;var i=t.offset().top;var r=e.offset().left;var a=e.offset().top;var o=e.outerWidth();var s=e.innerHeight();var l=r-n;var u=a-i;var c=l+o;var d=u+s;return{left:l,top:u,right:c,bottom:d,bottomLeft:{x:l,y:d},bottomRight:{x:c,y:d},topLeft:{x:l,y:u},topRight:{x:c,y:u}}},_redrawBackground:function(){var e=this._element.find(".streak__detail_zoom polygon");if(this.anySelected()){var t=this._selection;var n=this.getSummaryZoomElement(t);var i=this.getBackgroundElement();var r=this._getBoxInParent(n,i);var a=this.getDetailElement();var o=this._getBoxInParent(a,i);var s=r.bottomLeft;var l=r.bottomRight;var u=o.topLeft;var c=o.topRight;var d=[s,l,c,u,s];var h="";for(var f=0;f<d.length;f++){if(f>0){h+=" "}h+=d[f].x+","+d[f].y}e.attr("points",h);e.attr("visibility","visible")}else{e.attr("visibility","hidden")}},_summaryAreaScrolled:function(){this._redrawBackground()},setUnselected:function(){this._element.removeClass("streak__reports_summarydetail_selected")},setSelection:function(e){this._selection=e;this._loadDetailView();this._redrawBackground();this._element.addClass("streak__reports_summarydetail_selected")},anySelected:function(e){return this._selection!==null},addSummaryElement:function(e){var i=this._element.find(".streak__reports_summarydetail_summary");var r=t.size(this._summaryElements);if(r>0){var a=n.getElement("streak__reports_sumamrydetail_spacer");i.append(a)}i.append(e.getElement());this._summaryElements[r]=e;return r},getSummaryZoomElement:function(e){return this._summaryElements[e].getZoomElement()},getDetailElement:function(){return this._element.find(".streak__reports_summarydetail_detail")},getBackgroundElement:function(){return this._element.find(".streak__reports_summarydetail_background")},windowResized:function(){r.prototype.windowResized.call(this);this._redrawBackground()},_notifySelected:function(e){var t={view:this,index:e};this._callDelegateFunction("summarySelectionChanged",t)},_loadDetailView:function(){if(this.anySelected()){var e=this._detailer.getDetailViewForIndex(this.getSelection());this._element.find(".streak__reports_summarydetail_detail").html(e.getElement())}else{this._element.find(".streak__reports_summarydetail_detail").html("")}}})})(Streak);(function(e){var t=e._,n=e.HTML,i=e.BentoBox.Modules.Reports;var r=e.UI.ChartViewController;i.SummaryDetailChartViewController=e.Class.subclass({superclass:r,memberVariables:[{name:"_summaryDetailData",destroy:false},{name:"_currentDetailIndex",destroy:false}],_setupView:function(){this._view=new i.SummaryDetailChartView},_initialize:function(){r.prototype._initialize.call(this);this._summaryDetailData={};this._view.setDetailer(this)},getDetailViewForIndex:function(e){return this._summaryDetailData[e].detailViewController.getView()},_makeDetailViewFor:function(e){throw new Error("Implement _makeDetailViewFor")},_makeSummaryViewFor:function(e){throw new Error("Implement _makeSummaryViewFor")},setSelectedChart:function(e){this._selectedChart=e;this._redrawBackground()},addSummaryElement:function(e){var t=e.key;e.summaryViewController=this._makeSummaryViewFor(t);e.detailViewController=this._makeDetailViewFor(t);var n=this._view.addSummaryElement(e.summaryViewController.getView());e.index=n;this._summaryDetailData[n]=e},select:function(e){if(t.isReal(this._currentDetailIndex)){this._summaryDetailData[this._currentDetailIndex].summaryViewController.unselect()}if(e===null){this._view.setSelection(null);this._currentDetailIndex=null;this._view.setUnselected();return}var n=t.find(t.values(this._summaryDetailData),function(t){return t.key===e});if(n){this._view.setSelection(n.index);this._summaryDetailData[n.index].summaryViewController.select();this._currentDetailIndex=n.index}},_destroy:function(){for(var e=0;e<this._summaryDetailData.length;e++){var t=this._summaryDetailData[e];t.summaryViewController.destroy();t.summaryViewController.destroy()}r.prototype.destroy.call(this)}})})(Streak);Streak.BentoBox.Modules.Reports.ReportCards={};(function(e){var t=e.$,n=e.HTML,i=e.Locale,r=e.UI,a=e.BentoBox.Modules.Reports;var o=r.View;a.ReportCards.ReportCardView=e.Class.subclass({superclass:o,memberVariables:[{name:"_titleContainer",destroy:false},{name:"_toolbarContainer",destroy:false},{name:"_bodyContainer",destroy:false},{name:"_messageContainer",destroy:false},{name:"_numberOfMenuElementsInSection",destroy:true}],_initialize:function(){o.prototype._initialize.call(this);this._titleContainer=this._element.find(".streak__reportCard_title");this._toolbarContainer=this._element.find(".streak__reportCard_toolbar");this._bodyContainer=this._element.find(".streak__reportCard_body");this._messageContainer=this._element.find(".streak__reportCard_message");this._explanationElement=this._element.find(".streak__reportCard_explanation");this._numberOfMenuElementsInSection={}},_setupElement:function(){this._element=n.getElement("streak__reportCard")},setTitle:function(e){this._titleContainer.html(e)},setBody:function(e){this.hideMessage();this._bodyContainer.html(e.getElement())},hideMessage:function(){this._messageContainer.hide();this._bodyContainer.show()},setMessage:function(e){this._bodyContainer.hide();this._messageContainer.show();this._messageContainer.html('<div class="streak__reports_message">'+e+"</div>")},showExplanation:function(e){this._explanationElement.attr("data-tooltip",e);this._explanationElement.show()},hideExplanation:function(){this._explanationElement.hide()},addMenu:function(e){if(!e.view){e.view=e}if(!e.position){this.position=0}var t=0;for(var n in this._numberOfMenuElementsInSection){if(n<=e.position){var i=this._numberOfMenuElementsInSection[n];t=t+i}}if(this._toolbarContainer.length>0){if(t){var r=this._toolbarContainer.child(":nth-child("+t+")");r.after(e.view.getElement())}else{this._toolbarContainer.prepend(e.view.getElement())}}else{this._toolbarContainer.append(e.view.getElement())}this._numberOfMenuElementsInSection[e.position]=(this._numberOfMenuElementsInSection[e.position]||0)+1},showMenus:function(){this._toolbarContainer.show()},hideMenus:function(){this._toolbarContainer.hide()}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.Locale,r=e.BentoBox,a=e.BentoBox.Tracker,o=e.BentoBox.Modules.Reports;var s=n.ViewController;o.ReportCardViewController=e.Class.subclass({className:"ReportCardViewController",superclass:s,memberVariables:[{name:"_users",destroy:false},{name:"_titleLocaleKey",destroy:false},{name:"_relevantUserKeys",destroy:false},{name:"_bodyChartViewController",destroy:true},{name:"_userFilterMenu",destroy:true},{name:"_selectedUsers",get:true,destroy:false},{name:"_columnKey",destroy:false},{name:"_orderedColumnList",destroy:false},{name:"_orderedStageKeys",destroy:false},{name:"_pipeline",destroy:false},{name:"_reportName",destroy:false},{name:"_stageKey",destroy:false},{name:"_stageMenu",destroy:true},{name:"_stageMultipleSelectMenu",destroy:true},{name:"_selectedStageKeys",get:true,destroy:true},{name:"_allColumns",destroy:false}],_setupView:function(){this._view=new o.ReportCards.ReportCardView},_initialize:function(){s.prototype._initialize.call(this);this._selectedUsers=[o.Constants.ANY_USER];this._setupTrackingContext();this._gotReportData=false;this._view.setMessage(i.getString("notice_loading"));this.setupReportExplanation();this._view.hideMenus()},setupReportExplanation:function(){if(this._hasReportExplanation()){this._view.showExplanation(this._getReportExplanation())}else{this._view.hideExplanation()}},_hasUserFilterMenu:function(){return false},_setupTrackingContext:function(){this._trackingContext={widgetContext:"reportCard"}},_setupUserFilterMenu:function(){var e=this;if(!this._hasUserFilterMenu()){return}if(this._userFilterMenu){return}var t=this._getSortedUserFilterMenuItems();if(t.length){this._userFilterMenu=(new r.Widgets.CollapsibleMultiselectMenuViewController).create({buttonOptions:{type:"GmailIconArrow",color:"default",hasButtonToLeft:true,isFixedPosition:true,text:i.getString("people"),postOffFunction:function(){}},buttonPrefixHTML:'<span style="font-weight:normal">'+i.getString("people")+": </span>",collapseItem:{label:i.getString("reports_all_people"),value:[o.Constants.ANY_USER]},expandItem:{label:i.getString("reports_select_people")},selectAllItem:{label:i.getString("menu_select_all")},selectNoneItem:{label:i.getString("menu_select_none")},items:t});this._userFilterMenu.addDelegate(this);this._view.addMenu(this._userFilterMenu.getView())}},_getSortedUserFilterMenuItems:function(){this._relevantUserKeys=this._findRelevantUserKeys();var e=this._getSortedRelevantUserKeys();var t=[];for(var n=0;n<e.length;n++){var i=e[n];t.push({value:i,label:this._users[i].displayName,selected:o.Utils.containsUser({user:i,userFilter:this._selectedUsers})})}return t},_getSortedRelevantUserKeys:function(){var e=this._users;return t.chain(this._relevantUserKeys).filter(function(t){return!!e[t]}).sortBy(function(t){return e[t].displayName}).value()},_findRelevantUserKeys:function(){throw new Error("_findRelevantUserKeys must be defined to use a menu of people")},_getUserNameForPart:function(e){if(e.userKey!==o.Constants.ALL_USERS){var t=this._users[e.userKey];return t.displayName}else{return i.getString("reports_all_users")}},getTitle:function(){return i.getString(this._titleLocaleKey)},setBodyChartViewController:function(e){this._bodyChartViewController=e},windowResized:function(){if(this._bodyChartViewController&&this._bodyChartViewController.windowResized){this._bodyChartViewController.windowResized()}},multiselectMenuSelectionsChanged:function(e){if(e.delegator===this._userFilterMenu){a.trackStreakActive(this._trackingContext,{eventName:"userMenuChanged"});this.setSelectedUsers(e.selections)}if(e.delegator===this._stageMultipleSelectMenu){this.stageKeysSelectionChanged(e.selections)}if(this._refreshData){this._refreshData()}},setSelectedUsers:function(e){this._selectedUsers=e},_getPeopleSummary:function(){if(!this._selectedUsers){return""}if(this._selectedUsers.length===0){return i.getString("number_people",{number:this._selectedUsers.length})}if(this._selectedUsers[0]===o.Constants.ALL_USERS){return i.getString("reports_all_people")}if(this._selectedUsers[0]===o.Constants.ANY_USER){return i.getString("reports_all_people")}if(this._selectedUsers.length===1){return this._users[this._selectedUsers[0]].displayName}return i.getString("number_people",{number:this._selectedUsers.length})},_getReportExplanation:function(){return null},_hasReportExplanation:function(){return this._getReportExplanation()!==null},setPipeline:function(e){this._pipeline=e;this._orderedStageKeys=t.map(e.getStages(),function(e){return e.key()});this._columns=o.Utils.getColumnsForPipeline(this._pipeline);this._allColumns=o.Utils.getAllColumnsForPipeline(this._pipeline);this._setupColumnMenu();this._setupStageMenu();this._setupStageMultipleSelectMenu()},_hasStageMenu:function(){return false},_hasStageMultipleSelectMenu:function(){return false},_hasColumnMenu:function(){return false},_setupColumnMenu:function(){if(this._hasColumnMenu()&&!this._columnMenu){this._columnMenu=this._createColumnMenu();this._view.addMenu(this._columnMenu)}},_createColumnMenu:function(){var e=this;var n=r.Widgets.ButtonCustomDropdown.create({trackingContext:t.clone(this._trackingContext),prefixHTML:'<span style="font-weight:normal">'+i.getString("column")+": </span>",list:this._getColumnMenuItems(),changeFunc:function(t){e.columnSelectionChanged(t.value);a.trackStreakActive(e._trackingContext,{eventName:"columnMenuChanged"})},hasButtonToRight:true});return n},_getColumnMenuItems:function(){var e=[];for(var t in this._columns){var n=this._columns[t];e.push({name:n.name,value:t})}return e},_setupStageMenu:function(){if(this._hasStageMenu()&&!this._stageMenu){this._stageMenu=this._createStageMenu();this._view.addMenu(this._stageMenu)}},_createStageMenu:function(){var e=this;var n=r.Widgets.ButtonCustomDropdown.create({trackingContext:t.clone(this._trackingContext),prefixHTML:'<span style="font-weight:normal">'+i.getString("stage")+": </span>",list:this._getStageMenuItems(),changeFunc:function(t){e.stageKeySelectionChanged(t.value);a.trackStreakActive(e._trackingContext,{eventName:"stageMenuChanged"})},hasButtonToRight:true});return n},_getStageMenuItems:function(){var e=[];var t=this._orderedStageKeys;e.push({name:i.getString("none_selected"),value:null});for(var n=0;n<t.length;n++){var r=t[n];e.push({name:this._pipeline.getStage(r).displayName(),value:r})}return e},_setupStageMultipleSelectMenu:function(){if(this._hasStageMultipleSelectMenu()&&!this._stageMultipleSelectMenu){this._createStageMultipleSelectMenu();this._view.addMenu(this._stageMultipleSelectMenu.getView())}},_createStageMultipleSelectMenu:function(){var e=this;this._stageMultipleSelectMenu=(new r.Widgets.CollapsibleMultiselectMenuViewController).create({buttonOptions:{type:"GmailIconArrow",color:"default",hasButtonToLeft:true,isFixedPosition:true,text:i.getString("stage"),postOffFunction:function(){}},buttonPrefix:'<span style="font-weight:normal">'+i.getString("stage")+": </span>",collapseItem:{label:i.getString("reports_all_stages"),value:[o.Constants.ALL_STAGES]},expandItem:{label:i.getString("reports_select_stages")},selectAllItem:{label:i.getString("menu_select_all")},selectNoneItem:{label:i.getString("menu_select_none")},items:this._getOrderedStageItems()});this._stageMultipleSelectMenu.addDelegate(this)},_getOrderedStageItems:function(){var e=this._pipeline.getStages();var n=this;return t.map(e,function(e){return{value:e.key(),label:e.displayName(),selected:n._selectedStageKeys&&n._selectedStageKeys.indexOf(e.key())>-1}})},columnSelectionChanged:function(e){this._columnKey=e;if(this._columnMenu){this._columnMenu.setSelected(e)}},stageKeySelectionChanged:function(e){this._stageKey=e;this._stageMenu.setSelected(e)},stageKeysSelectionChanged:function(e){this._selectedStageKeys=e},selectStageKey:function(e){this._stageMenu.setSelected(e);this.stageKeySelectionChanged(e)}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.Locale,r=e.BentoBox,a=e.BentoBox.Tracker,o=e.BentoBox.Modules.Reports;var s=o.ReportCardViewController;o.ServerReportCardViewController=e.Class.subclass({className:"ServerReportCardViewController",superclass:s,memberVariables:[{name:"_json",destroy:false},{name:"_data",destroy:false},{name:"_gotReportData",destroy:false}],_handleReportDataSuccess:function(e){this._json=e;this._users=e.users;this._gotReportData=true;this._view.setBody(this._bodyChartViewController.getView());this._view.showMenus();this._refreshData({refreshUserFilterMenu:true,skipHandleReportDataSucessCallback:true})},_refreshData:function(e){this._view.setTitle(this.getTitle());if(!this._gotReportData){return}if(this._relevantUserKeys&&this._relevantUserKeys.length>0&&this.getSelectedUsers().length==0){this._view.setMessage(i.getString("reports_no_users_selected"))}else{this._view.hideMessage()}this._data=this._getFilteredDataFromJSON();if(this._hasUserFilterMenu()&&e&&e.refreshUserFilterMenu){this._setupUserFilterMenu()}this._callDelegateFunction("handleDataUpdated",this)},_getFilteredDataFromJSON:function(){throw new Error("_getFilteredDataFromJSON must be defined")},_handleReportDataFailure:function(){a.trackStreakActive(this._trackingContext,{eventName:"reportLoadFailed"});this._view.setMessage(i.getString("reports_load_failed"));this._callDelegateFunction("handleReportFailed",this)},multiselectMenuSelectionsChanged:function(e){s.prototype.multiselectMenuSelectionsChanged.call(this,e);if(e.delegator===this._userFilterMenu){this._refreshData({causedByUserSelectionChange:true})
}else if(e.delegator===this._stageMultipleSelectMenu){this._refreshData()}},_findRelevantUserKeys:function(){return Object.keys(this._json.users)},_getReportData:function(){e.APIRequester.get("pipelines/"+this._pipeline.key()+"/reports/"+this._reportName).getPromise().then(t.bind(this._handleReportDataSuccess,this),t.bind(this._handleReportDataFailure,this))},getChartData:function(){return this._data},setPipeline:function(e){s.prototype.setPipeline.call(this,e);this._getReportData()},columnSelectionChanged:function(e){s.prototype.columnSelectionChanged.call(this,e);this._refreshData()},stageKeySelectionChanged:function(e){s.prototype.stageKeySelectionChanged.call(this,e);this._refreshData()},setBodyChartViewController:function(e){s.prototype.setBodyChartViewController.call(this,e);this._bodyChartViewController.setDataSource(this)}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Tracker,r=e.BentoBox.Modules.Reports,a=e.Locale;var o=r.ServerReportCardViewController;r.ReportCards.TimeRangeReportCardViewController=e.Class.subclass({className:"TimeRangeReportCardViewController",superclass:o,memberVariables:[{name:"_timeRange",destroy:false},{name:"_timeRangeMenu",destroy:true}],_initialize:function(){o.prototype._initialize.call(this);this.setTimeRange(r.Constants.THIS_WEEK);this._setupTimeRangeMenu()},getTitle:function(){if(!this._titleLocaleKey){return null}var e=r.Utils.timeRangeLocalization(this._timeRange);return a.getString(this._titleLocaleKey,{timeRange:e,people:this._getPeopleSummary()})},_setupTimeRangeMenu:function(){var e=this;this._timeRangeMenu=n.Widgets.ButtonCustomDropdown.create({trackingContext:t.clone(this._trackingContext),prefixHTML:'<span style="font-weight:normal">'+a.getString("time_range")+": </span>",list:[{name:a.getString("time_range_this_day"),value:r.Constants.TODAY},{name:a.getString("time_range_this_week"),value:r.Constants.THIS_WEEK},{name:a.getString("time_range_this_month"),value:r.Constants.THIS_MONTH},{name:a.getString("time_range_this_year"),value:r.Constants.THIS_YEAR}],changeFunc:function(t){e.setTimeRange(t.value);i.trackStreakActive(e._trackingContext,{eventName:"timeRangeMenuChanged"})},hasButtonToRight:true});if(this._timeRangeMenu){this._timeRangeMenu.setSelected(this._timeRange);this._view.addMenu(this._timeRangeMenu)}},setTimeRange:function(e){this._timeRange=e;this._refreshData({refreshUserFilterMenu:true})},_getFilteredDataFromJSON:function(){if(!this._json){return null}var e=r.Utils.filterJsonParts({parts:this._json.parts,timeRange:this._timeRange,userFilter:this.getSelectedUsers()});r.Utils.addUserNameToJsonParts({parts:e,users:this._json.users});return e}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.Locale,r=e.BentoBox.Modules.Reports;var a={CHART_ITEM_HEIGHT:60,CHART_PADDING:0};var o=n.ChartViewController;r.Charts.StageChangeStageDetailViewController=e.Class.subclass({superclass:o,memberVariables:[{name:"_inColor",destroy:false},{name:"_outColor",destroy:false},{name:"_stageKey",set:true,destroy:false},{name:"_pipeline",set:true,destroy:false}],_setupView:function(){this._view=new n.BarChartView},_initialize:function(){o.prototype._initialize.call(this);this._view.setMinimum(0);this._view.setSeriesColors([r.Constants.INTO_STAGE_COLOR,r.Constants.OUT_OF_STAGE_COLOR]);this._view.setLegendWidth(250)},_retrieveData:function(){this._data=this._dataSource.getDetailData(this._stageKey);if(this._data){this._view.setHeight(a.CHART_ITEM_HEIGHT*this._data.length+a.CHART_PADDING);if(this._data.length>=15){this._view.setChartHeightPercentage(90)}else if(this._data.length>5){this._view.setChartHeightPercentage(80)}else{this._view.setChartHeightPercentage(null)}if(this._data.length===1){this._data.push(["",0,0])}}this._view.setData(this._data)}})})(Streak);(function(e){var t=e._,n=e.$,i=e.HTML,r=e.BentoBox.Modules.Reports;var a=r.SummaryDetailChartView;r.StageEventsTimeRangeSummaryDetailChartView=e.Class.subclass({superclass:a,_initialize:function(){a.prototype._initialize.call(this);var e=n(document.createElement("div"));e.addClass("streak__reports_yaxis_bar");this._element.find(".streak__reports_summarydetail_background").prepend(e)}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.Locale,r=e.BentoBox.Tracker,a=e.BentoBox.Modules.Reports;var o=a.SummaryDetailChartViewController;a.Charts.StageChangeSummaryDetailChartViewController=e.Class.subclass({superclass:o,memberVariables:[{name:"_data",destroy:false},{name:"_summaryData",destroy:false},{name:"_pipeline",destroy:false},{name:"_stages",destroy:false},{name:"_stageKeys",destroy:false},{name:"_detailViewControllers",destroy:true},{name:"_summaryViewControllers",destroy:true},{name:"_setupSummaryViewIsSetUp",destroy:false},{name:"_filterInactiveUsers",destroy:true,get:true,set:true}],_setupView:function(){this._view=new a.StageEventsTimeRangeSummaryDetailChartView},_initialize:function(){o.prototype._initialize.call(this);this._setupTrackingContext();this._detailViewControllers={};this._summaryViewControllers={};this._setupSummaryViewIsSetUp=false;this._filterInactiveUsers=false},_setupTrackingContext:function(){this._trackingContext={widgetContext:"stageEventsSummaryDetail"}},setPipeline:function(e){this._pipeline=e;this._stages=e.getStages();this._stageKeys=t.map(this._stages,function(e){return e.key()});this._setupSummaryView()},_retrieveData:function(){o.prototype._retrieveData.call(this);this._callDelegateFunction("handleDataUpdated",this)},getDetailData:function(e){if(!this._data){return null}return this._getSingleStageDataSplitByUserFromParts(e)},getSummaryData:function(e){if(!this._data){return null}var t=this._getSummaryDataForSingleStageFromParts(e);t.label=this._pipeline.getStage(e).displayName();return t},_getSingleStageDataSplitByUserFromParts:function(e){var t;if(this._filterInactiveUsers){t=this._data.sortBy(function(e){return-(e.in+e.out)})}else{t=this._data.sortBy("userName")}var n=[];var i=this._getHeaders();n.push(i);for(var r=0;r<t.length;r++){var a=t[r];if(e===a.stageKey){if(!(this._filterInactiveUsers&&a.in===0&&a.out===0)){n.push([a.userName,a.in,a.out])}}}return n},_getSummaryDataForSingleStageFromParts:function(e){var t=this._getSummaryDataForAllStagesFromParts();return{"in":t.in[e],out:t.out[e],net:t.net[e],max:t.max}},_getSummaryDataForAllStagesFromParts:function(){if(!this._data){return}var e=this._data;var n={};var i={};var r={};for(var a=0;a<e.length;a++){var o=e[a];var s=o.stageKey;n[s]=(n[s]||0)+o.in;i[s]=(i[s]||0)+o.out;r[s]=(r[s]||0)+o.netChange}return{"in":n,out:i,net:r,max:Math.max(t.max(t.values(n)),t.max(t.values(i)))}},_getHeaders:function(){var e=["reports_user","reports_stage_in","reports_stage_out"];return i.getStrings(e)},_makeDetailViewFor:function(e){if(t.isUndefined(this._detailViewControllers[e])){var n=new a.Charts.StageChangeStageDetailViewController;n.setDataSource(this);n.setPipeline(this._pipeline);n.setStageKey(e);this._detailViewControllers[e]=n}return n},_makeSummaryViewFor:function(e){var t=new a.Charts.StageInOutViewController;t.setPipeline(this._pipeline);t.selectStageKey(e);t.setDataSource(this);t.addDelegate(this);return t},handleDataUpdated:function(e){o.prototype.handleDataUpdated.call(this,e);this._setupSummaryView()},windowResized:function(){o.prototype.windowResized.call(this);t.each(this._detailViewControllers,function(e){e.windowResized()});t.each(this._summaryViewControllers,function(e){e.windowResized()})},_setupSummaryView:function(){if(!this._pipeline){return}if(!this._setupSummaryViewIsSetUp){this._setupSummaryViewIsSetUp=true;var e=this;t.each(this._stageKeys,function(t){e.addSummaryElement({key:t})})}},stageInOutMainViewSelected:function(e){r.trackStreakActive(this._trackingContext,{eventName:"stageEventsStageToggled"});this._callDelegateFunction("selectedStageKeyToggled",this,e.stageKey)}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Modules.Reports,r=e.Locale;var a=i.ReportCards.TimeRangeReportCardViewController;i.ReportCards.StageChangeViewController=e.Class.subclass({className:"StageChangeViewController",superclass:a,memberVariables:[{name:"_inColor",destroy:false},{name:"_outColor",destroy:false}],_initialize:function(){a.prototype._initialize.call(this);this._setupTrackingContext();this._reportName="StageEventsTimeRange";this._titleLocaleKey="report_title_stage_change";this.setBodyChartViewController(new i.Charts.StageChangeSummaryDetailChartViewController);this.configureBodyChartViewController();this._bodyChartViewController.addDelegate(this);this._view.setTitle(this.getTitle())},_hasStageMenu:function(){return true},_hasUserFilterMenu:function(){return true},_setupTrackingContext:function(){this._trackingContext={widgetContext:"stageChangeReportCard"}},configureBodyChartViewController:function(){if(this._selectedUsers&&this._selectedUsers[0]==="ANY_USER"){this._bodyChartViewController.setFilterInactiveUsers(true)}else{this._bodyChartViewController.setFilterInactiveUsers(false)}},setPipeline:function(e){a.prototype.setPipeline.call(this,e);this._bodyChartViewController.setPipeline(e)},selectedStageKeyToggled:function(e,t){if(this._stageKey===t){this.stageKeySelectionChanged(null)}else{this.stageKeySelectionChanged(t)}},selectedUsersChanged:function(e){a.prototype.selectedUsersChanged.call(this,e);this.configureBodyChartViewController()},selectStageKey:function(e,t){a.prototype.selectStageKey.call(this,t)},stageKeySelectionChanged:function(e){this._bodyChartViewController.select(e);a.prototype.stageKeySelectionChanged.call(this,e)},_findRelevantUserKeys:function(){var e=i.Utils.filterJsonParts({parts:this._json.parts,timeRange:this._timeRange});var t={};for(var n=0;n<e.length;n++){var r=e[n];if(r.userKey=="ALL_USERS"){continue}if(r.in!==0||r.out!==0){t[r.userKey]=true}}return Object.keys(t)},_getReportExplanation:function(){return r.getString("stage_change_report_explanation")}})})(Streak);(function(e){var t=e._,n=e.$,i=e.UI,r=e.HTML,a=e.Locale,o=e.BentoBox.Modules.Reports;var s={MIN_STAGE_WIDTH:110};var l=i.ChartView;o.TimeInStageChartView=e.Class.subclass({superclass:l,memberVariables:[{name:"_chartElement",destroy:false},{name:"_messageElement",destroy:false}],_setupElement:function(){this._element=r.getElement("streak__reports_timeInStage")},_initialize:function(){l.prototype._initialize.call(this);this._chartElement=this._element.find(".streak__reports_timeInStage_chart");this._messageElement=this._element.find(".streak__reports_timeInStage_message")},setStageConfigurations:function(e){this.reset();this._chartElement.css("minWidth",e.length*s.MIN_STAGE_WIDTH+"px");for(var t=0;t<e.length;t++){this._addStage(e[t])}},_addStage:function(e){var t=r.getElement("streak__reports_timeInStage_stage");t.css("background-color",e.backgroundColor);t.css("minWidth",s.MIN_STAGE_WIDTH+"px");t.css("color",e.textColor);t.find(".streak__reports_timeInStage_stage_name").text(e.name);var n=this._getTimeStrings(e.seconds);var i=a.getString("number_boxes",{number:e.boxes,pluralize:[e.boxes]});t.find(".streak__reports_timeInStage_stage_time").text(n.shortTimeString);t.css("width",e.percentage+"%");t.attr("data-tooltip",e.name+"\n"+n.timeString+"\n"+i);this._chartElement.append(t)},_getTimeStrings:function(e){var t,n;var i=e/(60*60*24);if(i<1){var r=e/(60*60);if(r<1){var o=e/60;if(o<1){var s=Math.round(e);n=a.getString("number_seconds_abbreviated",{number:s});t=a.getString("number_seconds",{number:s})}else{var l=this._prettifyNumber(o);n=a.getString("number_minutes_abbreviated",{number:l});t=a.getString("number_minutes",{number:l})}}else{var u=this._prettifyNumber(r);n=a.getString("number_hours_abbreviated",{number:u});t=a.getString("number_hours",{number:u})}}else{var c=this._prettifyNumber(i);n=a.getString("number_days_abbreviated",{number:c});t=a.getString("number_days",{number:c})}return{shortTimeString:n,timeString:t}},_prettifyNumber:function(e){if(e>5){return Math.round(e)}else{return e.toFixed(1)}},reset:function(){this._chartElement.empty();this._chartElement.show();this._messageElement.empty();this._messageElement.hide()},showMessage:function(e){this._chartElement.hide();this._messageElement.show();this._messageElement.html(e)}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.BentoBox,r=e.Locale,a=e.BentoBox.Tracker,o=e.BentoBox.Modules.Reports;var s=n.ChartViewController;o.ReportCards.TimeInStageChartViewController=e.Class.subclass({className:"TimeInStageChartViewController",superclass:s,memberVariables:[{name:"_pipeline",destroy:false},{name:"_stages",destroy:false},{name:"_stageKeys",destroy:false},{name:"_stageColors",destroy:false},{name:"_totalSecondsInStage",destroy:false},{name:"_timeRange",destroy:false,get:true,set:true}],_setupView:function(){this._view=new o.TimeInStageChartView},_initialize:function(){s.prototype._initialize.call(this);this._setupTrackingContext()},_setupTrackingContext:function(){this._trackingContext={widgetContext:"timeInStageChart"}},setPipeline:function(e){this._pipeline=e;this._stages=e.getStages();this._stageKeys=t.map(this._stages,function(e){return e.key()});this._stageColors=i.UI.getStageColors(this._pipeline);this._setupChart()},_setupChart:function(){if(!this._data){return}this._populateStageTimePercentages();if(this._totalSecondsInStage===0){var e=o.Utils.timeRangeLocalization(this._timeRange).toLowerCase();this._view.showMessage(r.getString("time_in_stage_no_data",{timeRange:e}));return}var n=[];for(var i=0;i<this._stageKeys.length;i++){var a=this._stageKeys[i];var s=t.find(this._data,function(e){return e.stageKey===a});if(!t.isUndefined(s)){var l=this._pipeline.getStage(s.stageKey);var u=this._stageColors[s.stageKey];var c=u.backgroundColor;var d=u.textColor;if(s.averageSecondsInStage>0){n.push({name:l.displayName(),backgroundColor:c,textColor:d,seconds:s.averageSecondsInStage,percentage:s.percentage,boxes:s.boxesExitingStage})}}}this._view.setStageConfigurations(n)},_populateStageTimePercentages:function(){this._totalSecondsInStage=0;for(var e=0;e<this._data.length;e++){var t=this._data[e];if(t.averageSecondsInStage){this._totalSecondsInStage+=t.averageSecondsInStage}}for(var e=0;e<this._data.length;e++){var t=this._data[e];if(t.averageSecondsInStage){t.percentage=100*(t.averageSecondsInStage/this._totalSecondsInStage)}else{t.percentage=0}}},handleDataUpdated:function(e){s.prototype.handleDataUpdated.call(this,e);this._setupChart()},windowResized:function(){this._setupChart()}})})(Streak);(function(e){var t=e._,n=e.BentoBox.Modules.Reports,i=e.UI,r=e.Locale;var a=n.ReportCards.TimeRangeReportCardViewController;n.ReportCards.TimeInStageViewController=e.Class.subclass({className:"TimeInStageViewController",superclass:a,_initialize:function(){a.prototype._initialize.call(this);this._selectedUsers=[n.Constants.ALL_USERS];this._setupTrackingContext();this._reportName="StageTimeTimeRange";this._titleLocaleKey="report_title_time_in_stage";this._view.setTitle(this.getTitle());this.setBodyChartViewController(new n.ReportCards.TimeInStageChartViewController)},setBodyChartViewController:function(e){a.prototype.setBodyChartViewController.call(this,e);e.setTimeRange(this._timeRange)},_setupTrackingContext:function(){this._trackingContext={widgetContext:"timeInStageReportCard"}},setTimeRange:function(e){a.prototype.setTimeRange.call(this,e);if(this._bodyChartViewController){this._bodyChartViewController.setTimeRange(e)}},setPipeline:function(e){a.prototype.setPipeline.call(this,e);this._bodyChartViewController.setPipeline(e)},_hasUserFilterMenu:function(){return false},_getFilteredDataFromJSON:function(){var e=a.prototype._getFilteredDataFromJSON.call(this);var t=[];for(var n=0;n<e.length;n++){var i=e[n];var r=i.averageSecondsInStage==="undefined"?0:i.averageSecondsInStage;t.push({stageKey:i.stageKey,averageSecondsInStage:r,boxesExitingStage:i.boxesExitingStage})}return t},_getReportExplanation:function(){return r.getString("time_in_stage_report_explanation")}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Data,r=e.Date,a=e.BentoBox.Modules.Reports,o=e.UI,s=e.Locale;var l=a.ServerReportCardViewController;a.ReportCards.ColumnSpecificChartViewController=e.Class.subclass({className:"ColumnSpecificChartViewController",superclass:l,memberVariables:[{name:"_chartView",destroy:false},{name:"_defaultColumn",get:true,set:true,destroy:false},{name:"_lastSelectedColumn",destroy:false},{name:"_lastSelectedUsers",destroy:false},{name:"_lastSelectedStageKeys",destroy:false},{name:"_totalBoxes",destroy:true}],_initialize:function(e){l.prototype._initialize.call(this);this._selectedUsers=[a.Constants.ALL_USERS];this._setupTrackingContext();this._reportName="ColumnSpecificRingChart";this._titleLocaleKey="report_title_column_specific_over_time";this._view.setTitle(this.getTitle());this._configureChartView();this.defaultColumn=null},getTitle:function(){if(!this._titleLocaleKey){return null}return s.getString(this._titleLocaleKey,{column:this.getColumnName(),people:this._getPeopleSummary()})},_setupTrackingContext:function(){this._trackingContext={widgetContext:"columnSpecificReportCard"}},setTotalBoxes:function(e){this._totalBoxes=e;this._chartView.setCenterLabelValue(this._totalBoxes);this._chartView.setCenterLabelUnit(s.getString("boxes").toLowerCase())},_hasStageMultipleSelectMenu:function(){return true},_hasUserFilterMenu:function(){return true},_hasColumnMenu:function(){return true},getColumnName:function(){if(this.getColumn()){return this.getColumn().name}else{return""}},_configureChartView:function(){this.setBodyChartViewController(new o.ChartViewController);var e=o.ChartFactory.createChart({type:"RING_CHART",height:300,chartArea:{width:"70%",height:"90%"},sliceVisibilityThreshold:1/72,pieHole:.5});this._chartView=e;this._bodyChartViewController.setView(e)},_getReportData:function(e){this._loadUserDataForPipeline();var n=this.getColumn();var r=[this._getHeaders()];var o=this._pipeline;if(n){var s=i.getPipelineBoxes(this._pipeline.key());var l=this.getSelectedStageKeys();if(l){s=t.filter(s,function(e){var n=e.get("stageKey");return t.contains(l,n)})}var u=this.getSelectedUsers();if(u&&!t.contains(u,a.Constants.ALL_USERS)){s=t.filter(s,function(e){var t=e.getAssignedToSharingEntries();if(a.Utils.containsUser({userFilter:u,user:e.get("creatorKey")})){return true}for(var n=0;n<t.length;n++){var i=t[n];if(a.Utils.containsUser({userFilter:u,user:i.userKey})){return true}}return false})}this.setTotalBoxes(s.length);var c=a.Utils.countWithSplitCredit(s,function(e){return a.Utils.getBoxValueForColumn({box:e,column:n,pipeline:o})});t.each(c,function(e,t){r.push([a.Utils.getBoxValueDisplayText({column:n,key:t,pipeline:o}),e])})}var d={users:this._users,data:r};var h={refreshUserFilterMenu:!(e&&e.causedByUserSelectionChange)};this._handleReportDataSuccess(d,h)},reportWorthShowing:function(){if(a.Utils.isColumnDate({column:this._allColumns[this._defaultColumn],pipeline:this._pipeline})){return false}var e=this._json.data;return!(e.length<=1||e.length==2&&e[1][0]!=="No Value")},_handleReportDataSuccess:function(e,t){this._json=e;this._users=e.users;this._gotReportData=true;this._view.setBody(this._bodyChartViewController.getView());this._view.showMenus();this._refreshData({refreshUserFilterMenu:t&&t.refreshUserFilterMenu,skipHandleReportDataSucessCallback:true})},_loadUserDataForPipeline:function(){this._users=a.Utils.usersFromPipeline({pipeline:this._pipeline})},_refreshData:function(e){if(this._filterOptionsChanged()){this._setLastFilterOptions();this._getReportData(e)}l.prototype._refreshData.call(this,e)},_getFilteredDataFromJSON:function(){return google.visualization.arrayToDataTable(this._json.data)},_filterOptionsChanged:function(){if(this.getSelectedStageKeys()!==this._lastSelectedStageKeys){return true}if(this.getSelectedUsers()!==this._lastSelectedUsers){return true}if(this._columnKey!==this._lastSelectedColumn){return true}return false},_setLastFilterOptions:function(){this._lastSelectedStageKeys=this.getSelectedStageKeys();this._lastSelectedUsers=this.getSelectedUsers();this._lastSelectedColumn=this._columnKey},_getHeaders:function(e){return["Value","Number of Boxes"]},_getReportExplanation:function(){return s.getString("column_specific_report_explanation",{column:this.getColumnName()})},getColumn:function(){if(this._columnKey){return this._columns[this._columnKey]}else{return null}},columnSelectionChanged:function(e){l.prototype.columnSelectionChanged.call(this,e);this.setupReportExplanation()},setPipeline:function(e){var t=l.prototype.setPipeline.call(this,e);if(this.getDefaultColumn()&&!this._columnKey){this.columnSelectionChanged(this.getDefaultColumn())}return t}})})(Streak);(function(e){var t=e.BentoBox.Modules.Reports;var n=t.ReportCards.ColumnSpecificChartViewController;t.ReportCards.AssignedToColumnChartViewController=e.Class.subclass({superclass:n,memberVariables:[],_initialize:function(){n.prototype._initialize.call(this)},_hasColumnMenu:function(){return false},_hasUserFilterMenu:function(){return false}})})(Streak);(function(e){var t=e.BentoBox.Modules.Reports;var n=t.ReportCards.ColumnSpecificChartViewController;t.ReportCards.StageColumnChartViewController=e.Class.subclass({superclass:n,memberVariables:[],_initialize:function(){n.prototype._initialize.call(this)},_hasColumnMenu:function(){return false},_hasStageMultipleSelectMenu:function(){return false}})})(Streak);Streak.BentoBox.Modules.Reports.PipelineReports={};(function(e){var t=e.HTML,n=e.BentoBox;var i=e.UI.View;n.Modules.Reports.PipelineReports.PipelineReportsView=e.Class.subclass({superclass:i,_setupElement:function(){this._element=t.getElement("streak__pipelineReports")},setPipelineName:function(e){this._element.find(".streak__reports_title").html(e)},setBackButton:function(e){this._element.find(".streak__reports_backButton").html(e.el)},addMenu:function(e){this._element.find(".streak__reports_toolbarButtons").append(e.getElement())},setReportCollectionView:function(e){this._element.find(".streak__reports_reportCollectionContainer").html(e.getElement())}})})(Streak);(function(e){var t=e._,n=e.$,i=e.BentoBox,r=e.Locale,a=e.HTML,o=e.UI,s=e.BentoBox.Modules.Reports;var l=s.ReportCards;var u=e.UI.ViewController;s.PipelineReports.PipelineReportsViewController=e.Class.subclass({className:"PipelineReportsViewController",superclass:u,memberVariables:[{name:"_pipeline",destroy:false},{name:"_reportCardCollectionViewController",destroy:true},{name:"_reportCardViewControllers",destroy:true},{name:"_trackingContext",destroy:false},{name:"_windowResizeListener",destroy:false},{name:"_reportsReady",destroy:false},{name:"_specialColumnsRow",destroy:false},{name:"_gateway",destroy:true},{name:"_paywallTimeout",destroy:false}],_setupView:function(){this._view=new s.PipelineReports.PipelineReportsView},_initialize:function(){u.prototype._initialize.call(this);this._reportCardViewControllers=[];this._reportsReady=[];this._setupTrackingContext();this._attachView();this._beginGateway();this._setupBackButton();this._setupReportsCollection();this._addWindowResizeListener();return this},_setupTrackingContext:function(){this._trackingContext={widgetContext:"pipelineReports"}},_attachView:function(){i.UI.getCanvas().append(this._view.getElement())},_beginGateway:function(){if(i.isFeatureEnabled("reports")){return}this._gateway=new i.Widgets.PaywallGatewayViewController({title:r.getString("reports_gateway_title"),text:r.getString("reports_gateway_text")});this._paywallTimeout=setTimeout(this._showGateway.bind(this),s.Constants.GATEWAY_DELAY)},_showGateway:function(){var e=this;i.Tracker.trackStreakActive({eventName:"reportsGatewayShown"},this._trackingContext);this._gateway.show({closed:function(t){if(!t){i.Tracker.trackStreakActive({eventName:"reportsGatewayCancelPressed"},e._trackingContext);history.back()}else{i.Tracker.trackStreakActive({eventName:"reportsGatewayUpgradePressed"},e._trackingContext)}}})},_setupBackButton:function(){var e=this;var t=i.Widgets.Button.create({isToggle:false,name:a.get("pipelineToolbarBackButton"),onFunc:function(){i.Tracker.trackStreakActive({eventName:"backButtonPressed"},e._trackingContext);history.back()}});this._view.setBackButton(t)},_setupReportsCollection:function(){this._reportCardCollectionViewController=new o.SplitRowsCollectionViewController;this._view.setReportCollectionView(this._reportCardCollectionViewController.getView());this._setupReportViews()},_setupReportViews:function(){this._specialColumnsRow=this._reportCardCollectionViewController.addRow();var e=[[l.TotalValueReportCardViewController,l.TotalValueByPersonReportCardViewController],[l.StageChangeViewController],[l.TimeInStageViewController]];for(var t=0;t<e.length;t++){var n=e[t];for(var i=0;i<n.length;i++){var r=n[i];this._setupCardViewController({reportCardViewControllerClass:r,newRow:i==0})}}},_setupCardViewController:function(e){var t=new e.reportCardViewControllerClass;t.addDelegate(this);this.addDelegate(t);if(e.newRow){var n=this._reportCardCollectionViewController.addRow()}else{var n=this._reportCardCollectionViewController.getLastRow()}this._reportCardCollectionViewController.addViewControllerToRow(t,n);this._reportCardViewControllers.push(t);return t},_addWindowResizeListener:function(){this._windowResizeListener=t.bind(t.debounce(this._handleWindowResize,100),this);window.addEventListener("resize",this._windowResizeListener)},_handleWindowResize:function(){this._callDelegateFunction("windowResized")},setPipeline:function(e){this._pipeline=e;this._setupTitle();this._setupColumnReports();this._callDelegateFunction("setPipeline",this._pipeline)},_setupTitle:function(){this._view.setPipelineName(i.Locale.getString("pipeline_reports_title",{pipeline:this._pipeline.displayName()}))},_setupColumnReports:function(){var e=s.Utils.getStageColumnKeyForPipeline(this._pipeline);if(e){var t=new l.StageColumnChartViewController;t.addDelegate(this);this.addDelegate(t);t.setDefaultColumn(e);t.setPipeline(this._pipeline);this._reportCardCollectionViewController.addViewControllerToRow(t,this._specialColumnsRow)}var n=s.Utils.getAssignedToColumnKeyForPipeline(this._pipeline);if(n){var i=new l.AssignedToColumnChartViewController;i.addDelegate(this);this.addDelegate(i);i.setDefaultColumn(n);i.setPipeline(this._pipeline);this._reportCardCollectionViewController.addViewControllerToRow(i,this._specialColumnsRow)}var r=s.Utils.getOrderedColumnKeysForPipeline_exceptStageAndAssignedTo(this._pipeline);var a=[];for(var o=0;o<r.length&&a.length<2;o++){var u=r[o];var c=new l.ColumnSpecificChartViewController;c.addDelegate(this);this.addDelegate(c);c.setDefaultColumn(u);c.setPipeline(this._pipeline);if(c.reportWorthShowing()){a.push(c)}}var d=null;for(var o=0;o<a.length;o++){var c=a[o];if(o%2==0){d=this._reportCardCollectionViewController.addRow()}this._reportCardCollectionViewController.addViewControllerToRow(c,d)}},handleReportFailed:function(e){this._handleReportReady(e)},_handleReportReady:function(e){if(this._reportsReady.indexOf(e)===-1){this._reportsReady.push(e)}},destroy:function(){this._removeWindowResizeListener();clearTimeout(this._paywallTimeout);u.prototype.destroy.call(this)},_removeWindowResizeListener:function(){window.removeEventListener("resize",this._windowResizeListener)}})})(Streak);(function(e){var t=e._,n=e.Gmail,i=e.DependencyManager,r=e.BentoBox,a=e.BentoBox.Tracker,o=e.BentoBox.Modules.Reports;var s=e.Object;o.PipelineReports.PipelineReportsMasterController=e.Class.subclass({superclass:s,memberVariables:[{name:"_pipelineReportsViewController",destroy:true}],_initialize:function(){s.prototype._initialize.call(this);n.inboxSDK.Router.handleCustomRoute("pipelinereports/:key",this._handleReportPage.bind(this))},_handleReportPage:function(e){var t=e.getParams().key;var n=r.Data.getPipeline(t);var i=new o.PipelineReports.PipelineReportsViewController;e.getElement().appendChild(i.getView().getElement()[0]);i.setPipeline(n);e.on("destroy",function(){i.destroy()});a.trackStreakActive({eventName:"goToPipelineReports"})}});e.DependencyManager.addFunction({functionKey:"pipelineReportsInitialized",functionToCall:function(e){o.PipelineReports.PipelineReportsMasterControllerInstance=new o.PipelineReports.PipelineReportsMasterController;if(e){e()}},dependentFunctionKeys:["htmlLoaded","localeLoaded","chartsInitialized","gmailLoaded"]})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.DependencyManager,r=e.Gmail,a=e.Library,o=e.Utils;var s=e.Object;var l=Messenger.getData("originalLocation")||location.hash;var u="loading/:locationHash";var c=e.Class.subclass({superclass:s,_memberVariables:[{name:"_deepLinkFunction",destroy:true},{name:"_routeViewChangeListener",destroy:false},{name:"_currentRouteID",destroy:false},{name:"_deepLinkKey",destroy:true},{name:"_deepLinkLoadingViewController",destroy:true},{name:"_initialLocationHash",destroy:true}],_initialize:function(){s.prototype._initialize.call(this);this._setInitialLocationHash(l);if(n.UI.isBentoBoxView(this._getInitialView())){this._bindAll()}},_setInitialLocationHash:function(e){if(e.indexOf("#")===-1){this._initialLocationHash="";return}var t=o.removePrefix(e,"#");while(t.startsWith("loading/")){t=o.removePrefix(t,"loading/")}this._initialLocationHash=t},_bindAll:function(){this._bindToGmailLoaded();this._bindToBentoBoxLoaded()},_handleLoadingView:function(e){r.validateAndCorrectURLHash();var t=new n.Modules.DeepLinkLoader.DeepLinkLoadingViewController(this._getInitialView());e.getElement().appendChild(t.getView().getElement()[0]);e.on("destroy",t.destroy.bind(t));n.Tracker.track("deepLinkLoading",{target:this._getInitialView()})},_bindToGmailLoaded:function(){e.NotificationCenter.subscribe({eventName:"gmailLoaded",functionToCall:this._gmailLoaded,observer:this})},_bindToBentoBoxLoaded:function(){e.NotificationCenter.subscribe({eventName:"bentoBoxIsReady",functionToCall:this._bentoBoxLoaded,observer:this})},_routeViewChanged:function(e){this._currentRouteID=e.getRouteID();if(!this._deepLinkLoadingEverShown){this._showDeepLinkLoading()}else if(this._currentRouteID===u){}else{this._hideDeepLinkLoading()}},_gmailLoaded:function(){this._routeViewChangeListener=r.inboxSDK.Router.handleAllRoutes(this._routeViewChanged.bind(this));r.inboxSDK.Router.handleCustomRoute(u,this._handleLoadingView.bind(this));this._showDeepLinkLoading()},_bentoBoxLoaded:function(){if(!this._deepLinkLoadingHidden){this._hideDeepLinkLoading()}},_showDeepLinkLoading:function(){if(this._deepLinkLoadingHidden){return}this._deepLinkLoadingEverShown=true;if(this._currentRouteID!==u){r.inboxSDK.Router.goto(u,this._initialLocationHash)}},_hideDeepLinkLoading:function(){this._deepLinkLoadingHidden=true;if(this._currentRouteID===u){this._goToInitiallyLoadedLocation()}},_goToInitiallyLoadedLocation:function(){n.UI.setURL(this._initialLocationHash)},_getInitialView:function(){return r.getStoredView(this._initialLocationHash.split("/"))},destroy:function(){this._routeViewChangeListener();e.NotificationCenter.unsubscribe({observer:this});s.prototype.destroy.call(this)}});a.set("BentoBox.Modules.DeepLinkLoader.DeepLinkLoaderMasterController",c);e.DependencyManager.addFunction({functionKey:"deepLinkLoaderMasterControllerInitialized",functionToCall:function(e){try{a.set("BentoBox.Modules.DeepLinkLoader.DeepLinkLoaderMasterControllerInstance",new c)}catch(t){n.logError("Problem in deepLinkLoader constructor",t)}if(e){e()}},dependentFunctionKeys:["gmailLoaded"]})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.Gmail,r=e.HTML,a=e.Library,o=e.UI;var s=e.UI.ViewController;var l=e.Class.subclass({superclass:s,memberVariables:[{name:"_loadingViewTarget",destroy:true}],_initialize:function(e){s.prototype._initialize.call(this);this._view.setLoadingTarget(e);this.setLoadedPercentage(1)},_setupView:function(){this._view=new n.Modules.DeepLinkLoader.DeepLinkLoadingView},setLoadedPercentage:function(e){this._view.setLoadedPercentage(e)}});a.set("BentoBox.Modules.DeepLinkLoader.DeepLinkLoadingViewController",l)})(Streak);(function(e){var t=e.HTML,n=e.BentoBox,i=e.Library,r=n.Locale;var a=e.UI.View;var o=e.Class.subclass({superclass:a,memberVariables:[{name:"_targetView",destroy:true},{name:"_loadingText",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);
this._element=t.getElement("streak__deepLinkLoading");this._loadingText=this._element.find(".streak__loadingText");this._loaderBar=this._element.find(".streak__loaderBar");return this},setLoadingTarget:function(e){this._targetView=e;var t=r.getString("loading");var n=t;if(e){var i="loading_"+e;var a=r.getString(i);if(i!==a){n=a}}this._loadingText.text(n)},setLoadedPercentage:function(e){e=e*100;this._loaderBar.find("div").css("width",e+"%")}});i.set("BentoBox.Modules.DeepLinkLoader.DeepLinkLoadingView",o)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.ViewController,memberVariables:[{name:"_plainTextOnly",defaultValue:true,destroy:true},{name:"_isMultiline",defaultValue:true,destroy:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);if(t&&t.plainTextOnly!==undefined){this._plainTextOnly=t.plainTextOnly}if(this._plainTextOnly){this._view.addClass("streak__gmailTextarea_textOnly")}if(t&&n.isReal(t.multiline)){this._isMultiline=t.multiline}if(!this._isMultiline){this._view.setAsSingleLine()}if(t&&t.noBorder){this._view.addClass("streak__gmailTextarea_noBorder")}},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.GmailTextareaView")},focus:function(){this._view.focus()},setTabIndex:function(e){this._view.setTabIndex(e)},getHTML:function(){return this._view.getHTML()},setHTML:function(e){return this._view.setHTML(e)},getText:function(){return this._view.getText()},setText:function(e){return this._view.setText(e)},insertTextAtCursor:function(e){this._view.insertTextAtCursor(e)},keydown:function(e){if(e.which===13&&!this._isMultiline){e.preventDefault()}this._callDelegateFunction("keydown",e)},keypress:function(e){this._callDelegateFunction("keypress",e)},keyup:function(e){this._callDelegateFunction("keyup",e)},input:function(e){this._callDelegateFunction("input",e)},getEventStream:function(){return this._view.getEventStream()},selectAllText:function(){this._view.selectAllText()},setCursorToEnd:function(){this._view.setCursorToEnd()},isCursorAtEnd:function(){return this._view.isCursorAtEnd()},isCursorAtStart:function(){return this._view.isCursorAtStart()},setEnabled:function(e){if(e){this._view.enable()}else{this._view.disable()}},setPlaceholderText:function(e){this._view.setPlaceholderText(e)}});i.set("BentoBox.Widgets.GmailTextareaViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[{name:"_innerElement",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t('<div class="streak__gmailTextarea" tabindex="-1"></div>');this._innerElement=t('<div class="R5 streak__placeholder" contenteditable="true"></div>');this._element.html(this._innerElement);this._element.addClass("aco");var e=this;this._element.val=function(t){if(t){e.setHTML(t);return this}else{return e.getHTML()}};this._innerElement.val=this._element.val;this._setupBindings()},_setupBindings:function(){var e=this;this._element.focus(function(){e._innerElement.focus()});this._innerElement.focus(function(){if(e.isDisabled()){return}e._element.removeClass("aco");e._element.addClass("acm");e._eventStream.push({eventName:"focus",html:e.getHTML(),text:e.getText()})});this._innerElement.blur(function(){if(e.isDisabled()){return}e._element.removeClass("acm");e._element.addClass("aco");e._eventStream.push({eventName:"blur",html:e.getHTML(),text:e.getText()})});this._innerElement[0].addEventListener("keydown",function(t){if(e.isDisabled()){return}e._callDelegateFunction("keydown",t);e._eventStream.push({eventName:"keydown",event:t})},true);this._innerElement[0].addEventListener("keypress",function(t){if(e.isDisabled()){return}e._callDelegateFunction("keypress",t);e._eventStream.push({eventName:"keypress",event:t,html:e.getHTML(),text:e.getText()})},true);this._innerElement[0].addEventListener("keyup",function(t){if(e.isDisabled()){return}e._callDelegateFunction("keyup",t);e._eventStream.push({eventName:"keyup",event:t,html:e.getHTML(),text:e.getText()})},true);this._innerElement[0].addEventListener("input",function(t){if(e.isDisabled()){return}e._callDelegateFunction("input",t);e._eventStream.push({eventName:"input",event:t,html:e.getHTML(),text:e.getText()})},true);this._innerElement[0].addEventListener("click",function(t){if(e.isDisabled()){return}e._callDelegateFunction("click",t);e._eventStream.push({eventName:"click",event:t,html:e.getHTML(),text:e.getText()})});this._innerElement[0].addEventListener("mouseover",function(t){if(e.isDisabled()){return}e._callDelegateFunction("mouseover",t);e._eventStream.push({eventName:"mouseover",event:t})});this._innerElement[0].addEventListener("mouseleave",function(t){if(e.isDisabled()){return}e._callDelegateFunction("mouseleave",t);e._eventStream.push({eventName:"mouseleave",event:t})})},getTextInput:function(){return this._innerElement},getHTML:function(){return this._innerElement[0].innerHTML},setHTML:function(e){this._innerElement[0].innerHTML=e},getText:function(){return this._innerElement.plainText()},setText:function(e){this._innerElement.text(e)},insertTextAtCursor:function(e){this._innerElement.insertTextAtCaret(e)},focus:function(){this._innerElement.focus();this._innerElement.caret().goToEnd()},blur:function(){this._innerElement.blur()},setTabIndex:function(e){this._innerElement[0].setAttribute("tabindex",e)},selectAllText:function(){this._innerElement.selectContents()},setCursorToEnd:function(){this._innerElement.caret().goToEnd()},isCursorAtEnd:function(){return this._innerElement.caret().start>=this.getText().length},isCursorAtStart:function(){return this._innerElement.caret().start===0},setAsSingleLine:function(){this._innerElement.addClass("streak__gmailTextarea_singleLine")},showBorder:function(){this._element.removeClass("streak__gmailTextarea_noToggleBorder");if(this._element.hasClass("acm")||this._element.hasClass("aco")){return}this._element.addClass("aco")},hideBorder:function(){this._element.addClass("streak__gmailTextarea_noToggleBorder");this._element.removeClass("aco")},isDisabled:function(){return this._innerElement.prop("contenteditable")==="false"},disable:function(){this._innerElement.prop("contenteditable",false)},enable:function(){this._innerElement.prop("contenteditable",true)},setPlaceholderText:function(e){this._innerElement.attr("data-placeholder",e)}});i.set("BentoBox.Widgets.GmailTextareaView",d)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"CreditCardFormView",superclass:r,_memberVariables:[{name:"_cardNumberElement",destroy:true},{name:"_expirationDateElement",destroy:true},{name:"_securityCodeElement",destroy:true},{name:"_nameElement",destroy:true},{name:"_agreementElement",destroy:true}],_initialize:function(){r.prototype._initialize.call(this)},_setupElement:function(){this._element=n.getElement("streak__credit_card_form")},setCardNumberInput:function(e){this._cardNumberElement=e.getElement();this._element.find(".streak__credit_card_number_wrapper").html(this._cardNumberElement)},setExpiryInput:function(e){this._expirationDateElement=e.getElement();this._element.find(".streak__expiration_date_wrapper").html(this._expirationDateElement)},setSecurityCodeInput:function(e){this._securityCodeElement=e.getElement();this._element.find(".streak__security_code_wrapper").html(this._securityCodeElement)},setNameInput:function(e){this._nameElement=e.getElement();this._element.find(".streak__full_name_wrapper").html(this._nameElement)},setTermsOfServiceAgreementInput:function(e){this._agreementElement=e.getElement();this._element.find(".streak__terms_of_service_wrapper").html(this._agreementElement)}});t.set("BentoBox.Widgets.CreditCardFormView",a)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.NotificationCenter,r=e.Stripe,a=e.UI;var o=a.ViewController;var s=e.Class.subclass({className:"CreditCardFormViewController",superclass:o,_memberVariables:[{name:"_creditCardInput",destroy:true},{name:"_expiryInput",destroy:true},{name:"_securityCodeInput",destroy:true},{name:"_nameInput",destroy:true},{name:"_agreement",destroy:true}],_initialize:function(e){o.prototype._initialize.call(this);this._setupCreditCardInput();this._setupExpiryInput();this._setupSecurityCodeInput();this._setupNameInput();this._setupTermsOfServiceAgreementInput()},_setupView:function(){this._view=n.getInstance("BentoBox.Widgets.CreditCardFormView")},_setupCreditCardInput:function(){if(!this._creditCardInput){this._creditCardInput=n.getInstance("BentoBox.Widgets.CreditCardViewController")}this._view.setCardNumberInput(this._creditCardInput.getView())},_setupExpiryInput:function(){if(!this._expiryInput){this._expiryInput=n.getInstance("BentoBox.Widgets.ExpirationDateViewController")}this._view.setExpiryInput(this._expiryInput.getView())},_setupSecurityCodeInput:function(){if(!this._securityCodeInput){this._securityCodeInput=n.getInstance("BentoBox.Widgets.SecurityCodeViewController")}this._view.setSecurityCodeInput(this._securityCodeInput.getView())},_setupNameInput:function(){if(!this._nameInput){this._nameInput=n.getInstance("BentoBox.Widgets.NameViewController")}this._view.setNameInput(this._nameInput.getView())},_setupTermsOfServiceAgreementInput:function(){if(!this._agreement){this._agreement=n.getInstance("BentoBox.Widgets.TermsOfServiceAgreementViewController")}this._view.setTermsOfServiceAgreementInput(this._agreement.getView())},focus:function(){this._creditCardInput.focus()},isFormValid:function(){return this._creditCardInput.isCreditCard()&&this._expiryInput.isExpirationDate()&&this._securityCodeInput.isSecurityCode()&&this._nameInput.isName()&&this._agreement.agreesToTerms()},updateFormValidity:function(){this._creditCardInput.highlightEmptyOrInvalid();this._expiryInput.highlightEmptyOrInvalid();this._securityCodeInput.highlightEmptyOrInvalid();this._nameInput.highlightEmptyOrInvalid();this._agreement.highlightHasNotAgreed()},getPaymentFormInformation:function(){return{number:this._creditCardInput.getCard(),cvc:this._securityCodeInput.getSecurityCode(),exp_month:this._expiryInput.getExpirationMonth(),exp_year:this._expiryInput.getExpirationYear(),name:this._nameInput.getName()}}});n.set("BentoBox.Widgets.CreditCardFormViewController",s)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"CreditCardView",superclass:r,_memberVariables:[],_initialize:function(){r.prototype._initialize.call(this)},_setupElement:function(){this._element=n.getElement("streak_credit_card_input")},getInput:function(){return this._element.find("input")},setValid:function(e){this.getInput().toggleClass("invalid",!e)},hideCardType:function(){this._element.find(".streak__creditCard_backgroundLogos").show();this._element.find(".streak__creditCard_logo").hide()},setCardType:function(e){this._element.find(".streak__creditCard_logo").show();this._element.find(".streak__creditCard_logo")[0].setAttribute("class","streak__creditCard_logo streak__creditCardLogo_"+e)},hideCardLogos:function(){this._element.find(".streak__creditCard_backgroundLogos").hide()},focus:function(){this.getInput().focus()}});t.set("BentoBox.Widgets.CreditCardView",a)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.NotificationCenter,r=e.Stripe,a=e.UI;var o=a.ViewController;var s=e.Class.subclass({className:"CreditCardViewController",superclass:o,_memberVariables:[{name:"_card",get:true,destroy:true},{name:"_highlightInvalidWhileTyping",defaultValue:false,destroy:true}],_initialize:function(e){e=e||{};o.prototype._initialize.call(this);this._setupStripeFormatting();this._bindInput();if(typeof e.highlightInvalidWhileTyping!=="undefined"){this._highlightInvalidWhileTyping=e._highlightInvalidWhileTyping}},highlightEmptyOrInvalid:function(){this._view.setValid(!this.isEmpty()&&this.isCreditCard())},_highlightInvalidOnly:function(){this._view.setValid(this.isEmpty()||this.isCreditCard())},_setupView:function(){this._view=n.getInstance("BentoBox.Widgets.CreditCardView")},isEmpty:function(){return!this._card},getCardType:function(){return t.payment.cardType(this._card)},isCreditCard:function(){return r.card.validateCardNumber(this._card)&&t.payment.validateCardNumber(this._card,this.getCardType())},focus:function(){this._view.focus()},_setupStripeFormatting:function(){this._view.getInput().payment("formatCardNumber")},_bindInput:function(){var e=this;this._view.getInput().on("input",function(){e._card=e._view.getInput().val();if(e._highlightInvalidWhileTyping){e._highlightInvalidOnly()}var t=e.getCardType();if(t){e._view.setCardType(t);e._view.hideCardLogos()}else{e._view.hideCardType()}if(e._card.length>4){e._view.hideCardLogos()}})}});n.set("BentoBox.Widgets.CreditCardViewController",s)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"ExpirationDateView",superclass:r,_memberVariables:[],_initialize:function(){r.prototype._initialize.call(this)},_setupElement:function(){this._element=n.getElement("streak__expiration_date")},setValid:function(e){this._element.toggleClass("invalid",!e)}});t.set("BentoBox.Widgets.ExpirationDateView",a)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.NotificationCenter,r=e.UI;var a=r.ViewController;var o=e.Class.subclass({className:"ExpirationDateViewController",superclass:a,_memberVariables:[{name:"_expiry",get:true,destroy:true},{name:"_highlightInvalidWhileTyping",defaultValue:false,destroy:true}],_initialize:function(e){e=e||{};a.prototype._initialize.call(this);this._setupStripeFormatting();this._bindInput();if(typeof e.highlightInvalidWhileTyping!=="undefined"){this._highlightInvalidWhileTyping=e._highlightInvalidWhileTyping}},highlightEmptyOrInvalid:function(){this._view.setValid(!this.isEmpty()&&this.isExpirationDate())},_highlightInvalidOnly:function(){this._view.setValid(this.isEmpty()||this.isExpirationDate())},_setupView:function(){this._view=n.getInstance("BentoBox.Widgets.ExpirationDateView")},isEmpty:function(){return!this._expiry},isExpirationDate:function(){return t.payment.validateCardExpiry(this._expiry)},getExpirationMonth:function(){return this.getExpiry().month},getExpirationYear:function(){return this.getExpiry().year},_setupStripeFormatting:function(){this._view.getElement().payment("formatCardExpiry")},_bindInput:function(){var e=this;this._view.getElement().on("input",function(){e._expiry=e._view.getElement().payment("cardExpiryVal");if(e._highlightInvalidWhileTyping){e._highlightInvalidOnly()}})}});n.set("BentoBox.Widgets.ExpirationDateViewController",o)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"NameView",superclass:r,_memberVariables:[],_initialize:function(){r.prototype._initialize.call(this)},_setupElement:function(){this._element=n.getElement("streak__full_name")},setValid:function(e){this._element.toggleClass("invalid",!e)}});t.set("BentoBox.Widgets.NameView",a)})(Streak);(function(e){var t=e.Library,n=e.NotificationCenter,i=e.UI;var r=i.ViewController;var a=e.Class.subclass({className:"NameViewController",superclass:r,_memberVariables:[{name:"_name",get:true,destroy:true},{name:"_highlightInvalidWhileTyping",defaultValue:false,destroy:true}],_initialize:function(e){e=e||{};r.prototype._initialize.call(this);this._bindInput();if(typeof e.highlightInvalidWhileTyping!=="undefined"){this._highlightInvalidWhileTyping=e._highlightInvalidWhileTyping}},highlightEmptyOrInvalid:function(){this._view.setValid(!this.isEmpty()&&this.isName())},_highlightInvalidOnly:function(){this._view.setValid(this.isEmpty()||this.isName())},_setupView:function(){this._view=t.getInstance("BentoBox.Widgets.NameView")},isEmpty:function(){return!this._name},isName:function(){return!this.isEmpty()},_bindInput:function(){var e=this;this._view.getElement().on("input",function(){e._name=e._view.getElement().val();if(e._highlightInvalidWhileTyping){e._highlightInvalidOnly()}})}});t.set("BentoBox.Widgets.NameViewController",a)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"SecurityCodeView",superclass:r,_memberVariables:[],_initialize:function(){r.prototype._initialize.call(this)},_setupElement:function(){this._element=n.getElement("streak__security_code")},setValid:function(e){this._element.toggleClass("invalid",!e)}});t.set("BentoBox.Widgets.SecurityCodeView",a)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.UI;var r=i.ViewController;var a=e.Class.subclass({className:"SecurityCodeViewController",superclass:r,_memberVariables:[{name:"_securityCode",get:true,destroy:true},{name:"_highlightInvalidWhileTyping",defaultValue:false,destroy:true}],_initialize:function(e){e=e||{};r.prototype._initialize.call(this);this._setupStripeFormatting();this._bindInput();if(typeof e.highlightInvalidWhileTyping!=="undefined"){this._highlightInvalidWhileTyping=e._highlightInvalidWhileTyping}},highlightEmptyOrInvalid:function(){this._view.setValid(!this.isEmpty()&&this.isSecurityCode())},_highlightInvalidOnly:function(){this._view.setValid(this.isEmpty()||this.isSecurityCode())},_setupView:function(){this._view=n.getInstance("BentoBox.Widgets.SecurityCodeView")},isEmpty:function(){return!this._securityCode},isSecurityCode:function(){return t.payment.validateCardCVC(this._securityCode)},_setupStripeFormatting:function(){this._view.getElement().payment("formatCardCVC")},_bindInput:function(){var e=this;this._view.getElement().on("input",function(){e._securityCode=e._view.getElement().val();if(e._highlightInvalidWhileTyping){e._highlightInvalidOnly()}})}});n.set("BentoBox.Widgets.SecurityCodeViewController",a)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"TermsOfServiceAgreementView",superclass:r,_memberVariables:[{name:"_checkbox",destroy:true,get:true}],_initialize:function(){r.prototype._initialize.call(this);this._checkbox=this._element.find("input[type=checkbox]")},_setupElement:function(){this._element=n.getElement("streak__terms_of_service_agreement")},setValid:function(e){this._element.toggleClass("invalid",!e)},isChecked:function(){return this._checkbox[0].checked}});t.set("BentoBox.Widgets.TermsOfServiceAgreementView",a)})(Streak);(function(e){var t=e.Library,n=e.NotificationCenter,i=e.UI;var r=i.ViewController;var a=e.Class.subclass({className:"TermsOfServiceAgreementViewController",superclass:r,_memberVariables:[{name:"_checked",destroy:true},{name:"_highlightHasNotAgreedOnToggle",defaultValue:true,destroy:true}],_initialize:function(e){e=e||{};r.prototype._initialize.call(this);this._setupStripeFormatting();this._bindInput();if(typeof e.highlightHasNotAgreedOnToggle!=="undefined"){this._highlightHasNotAgreedOnToggle=e.highlightHasNotAgreedOnToggle}},highlightHasNotAgreed:function(){this._view.setValid(this.agreesToTerms())},agreesToTerms:function(){return this._checked},_setupView:function(){this._view=t.getInstance("BentoBox.Widgets.TermsOfServiceAgreementView")},_setupStripeFormatting:function(){this._view.getElement().payment("formatCardCVC")},_bindInput:function(){var e=this;this._view.getCheckbox().click(function(){e._checked=e._view.isChecked();if(e._highlightHasNotAgreedOnToggle){e.highlightHasNotAgreed()}})}});t.set("BentoBox.Widgets.TermsOfServiceAgreementViewController",a)})(Streak);(function(e){var t=e.HTML,n=e.BentoBox,i=e.Library;var r=e.UI.View;var a=e.Class.subclass({superclass:r,className:"PaywallView",memberVariables:[{name:"_backButtonElement",destroy:true},{name:"_sections",destroy:true},{name:"_selectedSectionName",get:true,set:true,destroy:true},{name:"_planElements",destroy:true},{name:"_personPicker",get:true,destroy:true},{name:"_teamEmails",destroy:true},{name:"_teamEmailsMore",destroy:true},{name:"_numberOfTeamMembers",destroy:true},{name:"_planName",destroy:true},{name:"_planCostPerUserPerMonth",destroy:true},{name:"_planFeatures",destroy:true},{name:"_planMore",destroy:true},{name:"_totalCost",destroy:true},{name:"_planContainer",destroy:true},{name:"_hasDiscount",destroy:true,defaultValue:false},{name:"_hasTotalOriginalCost",destroy:true,defaultValue:false},{name:"_paywallTracker",destroy:false}],_initialize:function(e){r.prototype._initialize.call(this);this._paywallTracker=e;this._backButtonElement=this._element.find(".streak__backButton");this._sections={plan:{topElement:this._element.find(".streak__paywall_topnav .streak__paywall_topnav_select_plan"),bottomElement:this._element.find(".streak__paywall_bottom .streak__paywall_select_plan")},team:{topElement:this._element.find(".streak__paywall_topnav .streak__paywall_topnav_select_users"),bottomElement:this._element.find(".streak__paywall_bottom .streak__paywall_select_users")},payment:{topElement:this._element.find(".streak__paywall_topnav .streak__paywall_topnav_payment_info"),bottomElement:this._element.find(".streak__paywall_bottom .streak__paywall_payment_info")}};this._teamEmails=this._element.find(".streak__paywall_topnav_emails");this._teamEmailsMore=this._element.find(".streak__paywall_topnav_select_users .streak__paywall_topnav_more");this._numberOfTeamMembers=this._element.find(".streak__paywall_numberOfTeamMembers");this._planName=this._element.find(".streak__paywall_selected_plan_name");this._planCostPerUserPerMonth=this._element.find(".streak__paywall_plan_cost_per_user");this._planFeatures=this._element.find(".streak__paywall_topnav_features");this._planMore=this._element.find(".streak__paywall_topnav_select_plan .streak__paywall_topnav_more");this._planDiscountWrapper=this._element.find(".streak__paywall_topnav_select_plan .streak__discount_area");this._totalDiscountWrapper=this._element.find(".streak__paywall_topnav_payment_info .streak__discount_area");this._planDiscountPercentage=this._element.find(".streak__paywall_topnav .streak__discount_percentage");this._planOriginalCost=this._element.find(".streak__paywall_topnav .streak__original_cost_per_user");this._totalOriginalCost=this._element.find(".streak__paywall_topnav .streak__original_cost_total");this._totalCost=this._element.find(".streak__paywall_total_price");this._setupBackButton();this.markSectionCompleted("team",false);this.markSectionCompleted("plan",false);this.markSectionCompleted("payment",false);this._setupTopNavigationClickEvents()},_setupBackButton:function(){if(!this._backButton){var e=this;var i=t.get("pipelineToolbarBackButton");this._backButton=n.Widgets.Button.create({isToggle:false,name:i,onFunc:function(){e._paywallTracker.track("paywall.upgrade.backButton.pressed");history.back()}});this._backButtonElement.html(this._backButton.el)}},setTeamView:function(e){var t=this._element.find(".streak__paywall_select_users");t.html(e.getElement())},setPlansView:function(e){var t=this._element.find(".streak__paywall_select_plan");t.html(e.getElement())},setPaymentView:function(e){var t=this._element.find(".streak__paywall_payment_info");t.html(e.getElement())},selectSection:function(e,t){var n=this.getSelectedSectionName();if(!this._sections[e]){throw new Error("Invalid section selected")}else if(n===e){return}this._paywallTracker.track("paywall.section."+e+".selected",{oldSection:this.getSelectedSectionName()});if(n){var i=this._sections[this.getSelectedSectionName()];i.topElement.removeClass("selected");i.bottomElement.removeClass("selected")}var r=this._sections[e];this.setSelectedSectionName(e);r.topElement.addClass("selected");r.bottomElement.addClass("selected");this._callDelegateFunction("sectionChanged",e,n,t)},_isSectionComplete:function(e){if(!this._sections[e]){throw new Error("Invalid section selected")}var t=this._sections[e];return t.topElement.hasClass("complete")},markSectionCompleted:function(e,t){if(!this._sections[e]){throw new Error("Invalid section selected")}else if(typeof t==="undefined"){throw new Error("Complete not passed into markSectionCompleted")}var n=this._sections[e];if(t){n.topElement.addClass("complete");n.bottomElement.addClass("complete")}else{n.topElement.removeClass("complete");n.bottomElement.removeClass("complete")}},_setupTopNavigationClickEvents:function(){for(var e in this._sections){this._setupTopNavigationClickEvent(e,this._sections[e])}},_setupTopNavigationClickEvent:function(e,t){var n=this;t.topElement.click(function(){n._paywallTracker.track("paywall.topNav.clicked",{sectionName:e});n.selectSection(e)})},_setupElement:function(){this._element=t.getElement("streak__paywall")},setTeamEmailAddresses:function(e){var t=3;var i=Math.max(e.length-t,0);var r=e.slice(0,t);this._teamEmails.text(r.join(", "));this._teamEmailsMore.text("+ "+i+" more");this._numberOfTeamMembers.text(n.Locale.getString("payment_users_selected",{users:e.length}));if(i>0){this._teamEmailsMore.show()}else{this._teamEmailsMore.hide()}},showTeamLoading:function(e){this._sections.team.topElement.toggleClass("streak__loading",e)},setSelectedPlanName:function(e){this._planName.text(e)},setSelectedPlanCostPerUserPerMonth:function(e){if(e)e=this.formatMoney(e);this._planCostPerUserPerMonth.text(e)},setPlanDiscountPercentage:function(e){if(e)e=e.toFixed(0);this._planDiscountPercentage.text(e);this._hasDiscount=e&&e!==0;this._checkHidePlanDiscount();this._checkHideTotalDiscount()},setPlanOriginalCostPerUserPerMonth:function(e){if(e)e=this.formatMoney(e);this._planOriginalCost.text(e);this._checkHidePlanDiscount()},setTotalOriginalCost:function(e){if(e)e=this.formatMoney(e);this._totalOriginalCost.text(e);this._hasTotalOriginalCost=e&&e!==0;this._checkHideTotalDiscount()},_checkHidePlanDiscount:function(){if(this._hasDiscount){this._planDiscountWrapper.show().css("display","")}else{this._planDiscountWrapper.hide()}},_checkHideTotalDiscount:function(){if(this._hasDiscount&&this._hasTotalOriginalCost){this._totalDiscountWrapper.show().css("display","")}else{this._totalDiscountWrapper.hide()}},setPlanFeatureSummary:function(e){var t=4;var n=Math.max(e.length-t,0);var i=e.slice(0,t);this._planFeatures.text(i.join(", "));this._planMore.text("+ "+n+" more");if(n>0){this._planMore.show()}else{this._planMore.hide()}},setTotalCost:function(e){if(e)e=this.formatMoney(e);this._totalCost.text(e)},formatMoney:function(e){if(typeof e==="undefined"||e===null){return e}if(e.toString()===e.toFixed(0)){return e.toFixed(0)}else{return e.toFixed(2)}}});i.set("BentoBox.Modules.Paywall.PaywallView",a)})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.Gmail,r=e.Library,a=n.Locale,o=n.UI,s=e.NotificationCenter;var l=5;var u="enterprise";var c=e.UI.ViewController;var d=e.Class.subclass({superclass:c,className:"PaywallViewController",memberVariables:[{name:"_loadingViewTarget",destroy:true},{name:"_model",destroy:true},{name:"_paywallTracker",destroy:true},{name:"_teamViewController",destroy:true},{name:"_plansViewController",destroy:true},{name:"_paymentViewController",destroy:true}],_initialize:function(){this._paywallTracker=new n.Modules.Paywall.PaywallTracker;c.prototype._initialize.call(this);this._model=new n.Modules.Paywall.PaywallModel;this._setupTeamViewController();this._setupPlansViewController();this._setupPaymentViewController();this._model.addDelegate(this)},_setupView:function(){this._view=new n.Modules.Paywall.PaywallView(this._paywallTracker)},setPlanInstanceKey:function(e){if(e){this._model.setPlanInstanceByKey(e)}else{this._model.setPlanInstance(null)}this._paywallTracker.track("paywall.upgrade.loaded",{planInstanceKey:e})},setStartingSection:function(e){this._view.selectSection(e)},teamChanged:function(){var e=this._model.getTeamEmailAddresses();this._view.setTeamEmailAddresses(e);var t=this._model.isTeamSet();this._view.markSectionCompleted("team",t)},planChanged:function(){var e=this._model.getSelectedPlanKey();var t=this._model.isPlanSet();this._view.markSectionCompleted("plan",t);if(t){var n=this._model.getPlanName(e);this._view.setSelectedPlanName(n);var i=this._model.getPlanCostPerUserPerMonth(e);this._view.setSelectedPlanCostPerUserPerMonth(i);var r=this._model.getPlanFeatureSummary(e);this._view.setPlanFeatureSummary(r);var a=this._model.getDiscountPercentage(e);this._view.setPlanDiscountPercentage(a);var o=this._model.getBasePlanCostPerUserPerMonth(e);this._view.setPlanOriginalCostPerUserPerMonth(o);var s=this._model.getBaseTotalCostPerMonth(e);this._view.setTotalOriginalCost(s)}else{this._view.setSelectedPlanName(null);this._view.setSelectedPlanCostPerUserPerMonth(null);this._view.setPlanFeatureSummary([]);this._view.setPlanDiscountPercentage(null);this._view.setPlanOriginalCostPerUserPerMonth(null);this._view.setTotalOriginalCost(null)}},discountChanged:function(){if(this._model.isPlanSet()){this._view.setTotalOriginalCost(this._model.getBaseTotalCostPerMonth());this._view.setSelectedPlanCostPerUserPerMonth(this._model.getPlanCostPerUserPerMonth());this._view.setPlanDiscountPercentage(this._model.getDiscountPercentage());this._view.setPlanOriginalCostPerUserPerMonth(this._model.getBasePlanCostPerUserPerMonth())}else{this._view.setPlanDiscountPercentage(null);this._view.setPlanOriginalCostPerUserPerMonth(null);this._view.setTotalOriginalCost(null);this._view.setSelectedPlanCostPerUserPerMonth(null)}},totalPaymentChanged:function(){this._view.setTotalCost(this._model.getPaymentTotalPerMonth());this._view.setTotalOriginalCost(this._model.getBaseTotalCostPerMonth())},planUpgradeClicked:function(){this._view.selectSection("team")},teamContinueButtonPressed:function(){this._view.selectSection("payment")},subscribeWithBillingComplete:function(e){var t=this;return this._createAndActivatePlanInstance().then(function(){n.Data.getParticipatingPlans().refresh();n.Data.getBillingPlanInstances().refresh();t._planSubscriptionSuccessful()})},sectionChanged:function(e,t,i){i=i||{};if(e==="payment"){this._ensurePaymentControllerExists();var r;var o=this._model.getSelectedPlanKey();var s=this._model.getTeam().length;if(o==null){r=a.getString("payment_plan_not_set")}else if(s===0){if(!this._teamViewController.hasLoadedSuggestions()){r=a.getString("payment_team_not_loaded")}else{r=a.getString("payment_team_not_set")}}else if(!this._planRequirementsCheck(o,s)){r=true}if(r&&!i.overrideCheck){if(r!==true){n.ButterBarManager.showError(r,{messageKey:"paywall-error"})}this._view.selectSection(t);return}this._paymentViewController.focus()}var l=e==="team";this._teamViewController.focus(l)},setUpgradeParameters:function(e,i){var r=this;var a=this._model.getPlanInstance();if(i){var o=function(e){return e.getCollaboratorLimit()&&e.getCollaboratorLimit()<i};var s=n.Data.getPlanCollection();s.afterLoad().then(function(){if(a){var e=t.find(s,function(e){return e.getPlanId()===a.getPlanId()});if(!o(e)){return}}var l=t.filter(t.reject(s,o),function(e){return e.get("visibleToUsers")});if(l.length>0){var u=t.min(l,function(e){return e.get("price")});r._model.setSelectedPlanKey(u.getPlanId())}else{n.logError("no eligible plans found",null,{numberOfPeopleNeededOnNewPlan:i})}})}if(e.length>0){r._teamViewController.whenDefaultTeamSuggestionsLoaded().then(function(){for(var t=0;t<e.length;t++){var n=e[t];r._model.addTeamMember({email:n.user.email})}})}},_setupTeamViewController:function(){this._teamViewController=new n.Modules.Paywall.TeamViewController({model:this._model,tracker:this._paywallTracker});this._teamViewController.addDelegate(this);this._view.setTeamView(this._teamViewController.getView())},_setupPlansViewController:function(){this._plansViewController=new n.Modules.Paywall.PlansViewController({model:this._model,tracker:this._paywallTracker});this._plansViewController.addDelegate(this);this._view.setPlansView(this._plansViewController.getView())},_setupPaymentViewController:function(){this._paymentViewController=new n.Modules.Paywall.PaymentViewController({model:this._model,tracker:this._paywallTracker});this._paymentViewController.setDelegate(this);
this._view.setPaymentView(this._paymentViewController.getView())},_ensurePaymentControllerExists:function(){if(!this._paymentViewController){this._setupPaymentViewController()}},_planSubscriptionSuccessful:function(){i.inboxSDK.Router.goto("account")},_createAndActivatePlanInstance:function(){var e=this;if(!this._model.getPlanInstance()||this._model.isPlanInstanceDirty()){return this._createPlanInstance({emailAddresses:this._model.getTeamEmailAddresses(),planId:this._model.getSelectedPlanKey(),existingPlanInstance:this._model.getPlanInstance()}).then(function(e){return e.activate()})}else{return this._model.getPlanInstance().activate()}},_planRequirementsCheck:function(e,t){if(e==u&&t<l){n.ButterBarManager.showError(n.Locale.getString("payment_subscribe_minimum",{minimum_users:l,plan:this._model.getPlanName(e)}),{messageKey:"paywall-error"});return false}return true},_createPlanInstance:function(i){var r=this;return new e.RSVP.Promise(function(e,a){if(!r._planRequirementsCheck(i.planId,i.emailAddresses.length)){var o=new Error("Minimum number of users not met.");o.errorMessage="Minimum number of users not met.";a(o);return}var s={userEmailList:i.emailAddresses,planId:i.planId};if(i.existingPlanInstance){var l=["trialPeriodDays","enrollmentType","discountPercentage"];t.each(l,function(e){var n=i.existingPlanInstance.get(e);if(t.isReal(n)){s[e]=n}})}var u=new n.Models.PlanInstance(s);u.save(e.bind(null,u),a)})},hasDefaultTeamSuggestionLoaded:function(e){this._view.showTeamLoading(!e)},destroy:function(){this._paywallTracker.track("paywall.upgrade.unloaded");e.UI.ViewController.prototype.destroy.call(this)}});r.set("BentoBox.Modules.Paywall.PaywallViewController",d)})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.Library;var r=e.UI.Delegator;var a=e.Class.subclass({superclass:r,className:"PaywallModel",memberVariables:[{name:"_selectedPlanKey",get:true,destroy:true},{name:"_team",get:true,destroy:false},{name:"_userHasCard",destroy:false,set:true,get:true},{name:"_planInstance",destroy:false,get:true},{name:"_plans",destroy:false},{name:"_participatingPlans",destroy:false},{name:"_billingAdminPlanInstances",destroy:false}],_initialize:function(){r.prototype._initialize.call(this);this._team=[];this._bindToPlanChanges();this._refreshPlans()},setPlanInstanceByKey:function(e,i){var r=this._billingAdminPlanInstances.getByKey(e);if(r&&this.getPlanForKey(r.getPlanId())){this.setPlanInstance(r)}else{var a=this;this._startLoadingPlanInstance();var o=t.after(2,function(){var t=a._billingAdminPlanInstances.getByKey(e);if(t){a.setPlanInstance(t)}else{if(i)i();console.error("Couldn't load planInstance with key "+e)}});n.Data.getPlanCollection().refresh(o);this._loadUserPlans(o)}},setPlanInstance:function(e){if(e&&e.get("endDate")){n.ButterBarManager.showError("Can not edit already completed plan instance");n.logError("User tried to edit expired plan",null,e.key());e=null}this._planInstance=e;if(e&&e.getPlanId()){this.setSelectedPlanKey(e.getPlanId())}else{this.setSelectedPlanKey()}if(e&&e.getPlanId()){if(this.getPlanForKey(e.getPlanId())){this._setTeam(t.map(e.get("emails"),function(e){return{email:e}}));this._callDelegateFunction("plansChanged",this)}}else{this._setTeam([{email:n.getUser().getEmail()}])}this._callDelegateFunction("planInstanceChanged",e);this._callDelegateFunction("discountChanged",this);this._callDelegateFunction("trialPeriodDaysChanged",this);this._callDelegateFunction("totalPaymentChanged",this)},addTeamMember:function(e){if(!this._team){this._team=[]}if(t.find(this._team,function(t){return t.email===e.email})){return}this._team.push(e);this._callDelegateFunction("teamChanged",this);this._callDelegateFunction("totalPaymentChanged",this)},removeTeamMember:function(e){if(this._team){var n=this._team.length;this._team=t.filter(this._team,function(t){return e.email!==t.email});if(n!=this._team.length){this._callDelegateFunction("teamChanged",this);this._callDelegateFunction("totalPaymentChanged",this)}}},isTeamSet:function(){return this._team&&this._team.length>0},getTeamEmailAddresses:function(){var e=[];for(var t=0;t<this._team.length;t++){e.push(this._team[t].email)}return e},getPlanForKey:function(e){e=e||this.getSelectedPlanKey();return t.find(n.Data.getPlanCollection(),function(t){return t.get("planId")===e})},getPlanName:function(e){return this.getPlanForKey(e).getLocalizedName()},getPlanCostPerUserPerMonth:function(e){var t=this.getBasePlanCostPerUserPerMonth(e);var n=this.getDiscountPercentage(e);if(n){return t*((100-n)/100)}else{return t}},getDiscountPercentage:function(e){e=e||this.getSelectedPlanKey();var t=this.getPlanForKey(e).get("defaultDiscountPercentage");if(this._planInstance&&this._planInstance.getPlanId()===e){var n=this._planInstance.get("discountPercentage");if(n)return n}if(t)return t;return 0},getTrialPeriodDays:function(e){e=e||this.getSelectedPlanKey();var t=this.getPlanForKey(e).get("defaultTrialPeriodDays");if(this._planInstance&&this._planInstance.getPlanId()===e){var n=this._planInstance.get("trialPeriodDays");if(n)return n}if(t)return t;return 0},getBasePlanCostPerUserPerMonth:function(e){return this.getPlanForKey(e).get("price")},getPlanFeatureSummary:function(e){return this.getPlanForKey(e).getSummaryFeatures()},getPlanFeatureDescription:function(e){return this.getPlanForKey(e).getDescriptionFeatures()},getPlanLearnMoreText:function(e){return this.getPlanForKey(e).getLearnMoreText()},getCollaboratorLimit:function(e){return this.getPlanForKey(e).getCollaboratorLimit()},getPlanKeys:function(){var e=t.map(t.filter(n.Data.getPlanCollection(),function(e){return e.get("visibleToUsers")}),function(e){return e.get("planId")});if(this._planInstance&&this._planInstance.getPlanId()&&!t.contains(e,this._planInstance.getPlanId())){return e.concat([this._planInstance.getPlanId()])}else{return e}},isPlanSet:function(){return!!this._selectedPlanKey},setSelectedPlanKey:function(e){this._selectedPlanKey=e;this._callDelegateFunction("planChanged",this,{planKey:e});this._callDelegateFunction("totalPaymentChanged",this)},isPaymentTotalSet:function(){return this.isPlanSet()&&this.isTeamSet()},getPaymentTotalPerMonth:function(){return this.isPaymentTotalSet()?this._getNumberOfTeamMembers()*this.getPlanCostPerUserPerMonth():0},getBaseTotalCostPerMonth:function(){return this.isPaymentTotalSet()?this._getNumberOfTeamMembers()*this.getBasePlanCostPerUserPerMonth():0},topNavIconToShow:function(){if(!this._participatingPlans||!this._billingAdminPlanInstances){return n.Modules.TopNav.PAYWALL_ICON.NONE}var e=t.filter(this._billingAdminPlanInstances,function(e){return e.isActive()});var i=this._participatingPlans.length>0||e.length>0;if(i){return n.Modules.TopNav.PAYWALL_ICON.ACCOUNT}else{return n.Modules.TopNav.PAYWALL_ICON.UPGRADE}},isPlanInstanceDirty:function(){if(!this._planInstance)throw new Error("isPlanInstanceDirty can only be called if paywallModel.getPlanInstance() exists");var e=this._planInstance.getPlanId();var n=this._planInstance.get("emails")||[];n=n.sort();var i=this.getSelectedPlanKey();if(!this.getTeamEmailAddresses())throw new Error("team email addresses were missing in isPlanInstanceDirty");var r=this.getTeamEmailAddresses().sort();return!t.isEqual(e,i)||!t.isEqual(n,r)},shouldAcceptDefaultTeamAutomatically:function(){return this._planInstance&&!this._planInstance.isActive()},_refreshPlans:function(e){var i=function(){};if(e){i=t.after(2,e)}n.Data.getPlanCollection().refresh(i);this._loadUserPlans(i)},_startLoadingPlanInstance:function(){this._setTeam([]);this._callDelegateFunction("planInstanceCleared")},_bindToPlanChanges:function(e){n.Data.getPlanCollection().watch("collectionChange",function(){this._callDelegateFunction("plansChanged",this)},this)},_loadUserPlans:function(e){var n=this;var i=t.after(2,function(){if(e)e()});this._loadUserParticipatingPlans(i);this._loadUserBillingPlanInstances(i)},_loadUserParticipatingPlans:function(e){this._participatingPlans=n.Data.getParticipatingPlans();this._participatingPlans.refresh(e)},_loadUserBillingPlanInstances:function(e){this._billingAdminPlanInstances=n.Data.getBillingPlanInstances();this._billingAdminPlanInstances.refresh(e)},_setTeam:function(e){this._team=e;this._callDelegateFunction("teamChanged",this);this._callDelegateFunction("totalPaymentChanged",this)},_getNumberOfTeamMembers:function(){return this.isTeamSet()?this._team.length:0},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.UI.Delegator.prototype.destroy.call(this)}});i.set("BentoBox.Modules.Paywall.PaywallModel",a)})(Streak);(function(e){var t=e.Library,n=e.BentoBox.Tracker;var i=e.Object;var r=e.Class.subclass({className:"PaywallTracker",superclass:i,_memberVariables:[{name:"_currentSession",destroy:true}],_initialize:function(){i.prototype._initialize.call(this);this._currentSession=e.guid()},track:function(e,t){if(typeof t!=="undefined"&&typeof t!=="object"){console.error("params is bad in PaywallTracker.track")}t=t||{};t.session=this._currentSession;n.track(e,t)}});t.set("BentoBox.Modules.Paywall.PaywallTracker",r)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PaywallViewMasterController",superclass:e.Object,_memberVariables:[{name:"_peopleToAdd",destroy:false},{name:"_numberOfPeopleNeededOnNewPlan",destroy:false}],_initialize:function(){e.Object.prototype._initialize.call(this);r.inboxSDK.Router.handleCustomRoute(["upgrade","upgrade/:key","upgrade/:key/start/:section","upgrade/start/:section"],this._handleUpgradeView.bind(this))},showPaywall:function(e){this._peopleToAdd=e.peopleToAdd||[];this._numberOfPeopleNeededOnNewPlan=e.numberOfPeopleNeededOnNewPlan;var t={};var i="upgrade";var a=n.filter(c.Data.getBillingPlanInstances(),function(e){return e.isActive()});if(a.length>0){t.key=a[0].key();i+="/:key"}i+="/start/:section";t.section=this._peopleToAdd.length>0?"team":"plan";r.inboxSDK.Router.goto(i,t)},_handleUpgradeView:function(e){var t=e.getParams();var n=null;var i="plan";if(t.key){n=t.key}if(t.section){i=t.section}var r=new c.Modules.Paywall.PaywallViewController;r.setPlanInstanceKey(n);if(i){r.setStartingSection(i)}if(this._peopleToAdd){r.setUpgradeParameters(this._peopleToAdd,this._numberOfPeopleNeededOnNewPlan)}this._peopleToAdd=null;this._numberOfPeopleNeededOnNewPlan=null;e.getElement().appendChild(r.getView().getElement()[0]);e.on("destroy",r.destroy.bind(r))}});e.DependencyManager.addFunction({functionKey:"paywallViewMasterControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.PaywallViewMasterController",new d)},dependentFunctionKeys:["htmlLoaded","localeLoaded","userLoggedIn","gmailLoaded"]})})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=i.View;var a=e.Class.subclass({className:"AccountPlanView",superclass:r,_memberVariables:[{name:"_upgradeButton",destroy:true}],_initialize:function(){r.prototype._initialize.call(this);this._upgradePlanButton=this._element.find(".streak__account_upgrade_plan");this._changeTeamButton=this._element.find(".streak__account_change_team");this._featureList=this._element.find(".streak__plan_feature_list");this._pricePerUser=this._element.find(".streak__account_plan_cost");this._name=this._element.find(".streak__account_plan_name");this._numberOfUsers=this._element.find(".streak__account_user_count");this._userList=this._element.find(".streak__plan_user_list")},_setupElement:function(){this._element=n.getElement("streak__account_plan")},setUpgradePlanButton:function(e){this._upgradePlanButton.html(e.getElement())},setChangeTeamButton:function(e){this._changeTeamButton.html(e.getElement())},setFeatures:function(e){this._featureList.text(e.join(", "))},setPricePerUser:function(e){this._pricePerUser.text(e)},setName:function(e){this._name.text(e)},setUsers:function(e){this._numberOfUsers.text(e.length);if(e.length!==0){this._userList.show().css("display","");this._userList.text(e.join(", "))}else{this._userList.hide()}},setNoUsers:function(){this._element.addClass("streak__no_users")},setIsParticipant:function(e){if(!e){this._element.find(".streak__hide_if_participating").remove()}}});t.set("BentoBox.Modules.Paywall.AccountPlanView",a)})(Streak);(function(e){var t=e.BentoBox,n=e.Library,i=t.Locale;var r=e.UI.ViewController;var a=e.Class.subclass({className:"AccountPlanViewController",superclass:r,memberVariables:[{name:"_plan",destroy:false,get:true},{name:"_planInstance",destroy:false},{name:"_upgradePlanButton",destroy:true},{name:"_changeTeamButton",destroy:true}],_initialize:function(e){r.prototype._initialize.call(this);this._plan=e.plan;this._planInstance=e.planInstance;var t=!this._planInstance;if(e&&typeof e.isParticipant!=="undefined"){t=e.isParticipant}this._view.setIsParticipant(t);this._setupUpgradePlanButton();this._setupChangeTeamButton();this._setupPlanFeatures();this._setupPlanInstanceUsers();this._setupPlanCost();this._setupPlanName()},setIsParticipant:function(e){this._view.setIsParticipant(e)},_setupUpgradePlanButton:function(){if(!this._planInstance){return}if(!this._upgradePlanButton){this._upgradePlanButton=t.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:i.getString("account_upgrade_plan"),color:"blue",onFunction:this.upgradePlanButtonClicked.bind(this)})}this._view.setUpgradePlanButton(this._upgradePlanButton)},_setupChangeTeamButton:function(){if(!this._planInstance){return}if(!this._upgradeButton){this._upgradeButton=t.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:i.getString("account_change_team"),color:"blue",onFunction:this.changeTeamButtonClicked.bind(this)})}this._view.setChangeTeamButton(this._upgradeButton)},_setupPlanFeatures:function(){this._view.setFeatures(this._plan.getSummaryFeatures())},_setupPlanInstanceUsers:function(){if(this._planInstance){var e=this._planInstance.get("emails")||[];this._view.setUsers(e)}else{this._view.setNoUsers()}},_setupPlanCost:function(){if(!this._planInstance){return}var e=this._planInstance.get("totalPrice")/this._planInstance.get("numUsers");var n=t.Modules.Reports.Utils.formatCurrency(e,"$");this._view.setPricePerUser(n)},_setupPlanName:function(){this._view.setName(this._plan.getLocalizedName())},upgradePlanButtonClicked:function(){t.Tracker.track("paywall.account.upgrade.clicked",{planInstanceKey:this._planInstance.get("key")});this._callDelegateFunction("upgradePlanButtonClicked",this._planInstance)},changeTeamButtonClicked:function(){t.Tracker.track("paywall.account.changeTeam.clicked",{planInstanceKey:this._planInstance.get("key")});this._callDelegateFunction("changeTeamButtonClicked",this._planInstance)},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.AccountPlanView")}});n.set("BentoBox.Modules.Paywall.AccountPlanViewController",a)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI,r=e.BentoBox;var a=i.View;var o=e.Class.subclass({className:"AccountView",superclass:a,_memberVariables:[{name:"_participatingPlans",destroy:true},{name:"_billingPlans",destroy:true},{name:"_participatingPlansSection",destroy:true},{name:"_billingPlansSection",destroy:true},{name:"_paymentChanger",destroy:true},{name:"_invoices",destroy:true},{name:"_invoicesSection",destroy:true},{name:"_loadingIndicator",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._participatingPlans=this._element.find(".streak__participating_plans");this._participatingPlansSection=this._element.find(".streak__participating_plans_section");this._billingPlans=this._element.find(".streak__billing_plans");this._billingPlansSection=this._element.find(".streak__billing_plans_section");this._paymentChanger=this._element.find(".streak__payment_changer");this._invoices=this._element.find(".streak__account_invoices");this._invoicesSection=this._element.find(".streak__billing_history_section")},_setupElement:function(){this._element=n.getElement("streak__account_page")},addParticipatingPlanView:function(e){this._participatingPlansSection.show().css("display","");this._participatingPlans.append(e.getElement())},addBillingPlanView:function(e){this._billingPlansSection.show().css("display","");this._billingPlans.append(e.getElement())},setPaymentChangerView:function(e){this._paymentChanger.html(e.getElement())},hideParticipatingPlans:function(){this._participatingPlansSection.hide()},hideBillingPlans:function(){this._billingPlansSection.hide()},removeAllParticipatingPlanViews:function(){this._participatingPlans.html(null)},removeAllBillingPlanViews:function(){this._billingPlans.html(null)},hideSharingSettings:function(){this._element.find(".streak__account_restrictedSharing").hide()},showSharingSettings:function(){this._element.find(".streak__account_restrictedSharing").fastShow("-webkit-flex")},setSharingToggleElement:function(e){this._element.find(".streak__account_restictedSharing_toggle").html(e)},setSecurityReportToggleElement:function(e){this._element.find(".streak__account_securityReport_toggle").html(e)},setAutomaticInvoiceEmailToggleElement:function(e){this._element.find(".streak__account_automaticInvoiceEmail_toggle").html(e)},showInvoiceSettings:function(){this._element.find(".streak__account_invoiceSettings").fastShow("-webkit-flex")},hideInvoiceSettings:function(){this._element.find(".streak__account_invoiceSettings").hide()},showInvoices:function(e){if(e){this._invoicesSection.toggle(e).css("display","")}else{this._invoicesSection.toggle(e)}},setLoading:function(e){if(e){if(this._loadingIndicator){this.setLoading(false)}this._loadingIndicator=r.ButterBarManager.showLoading();return this._loadingIndicator.destroy.bind(this._loadingIndicator)}else{this._loadingIndicator.destroy();this._loadingIndicator=null}},setInvoices:function(e){this._invoices.html(e.getElement())}});t.set("BentoBox.Modules.Paywall.AccountView",o)})(Streak);(function(e){var t=e._,n=e.$,i=e.BentoBox,r=e.Gmail,a=e.Library,o=i.UI;var s=e.UI.ViewController;var l=e.Class.subclass({className:"AccountViewController",superclass:s,memberVariables:[{name:"_plans",destroy:false},{name:"_participatingPlans",destroy:false},{name:"_billingAdminPlanInstances",destroy:false},{name:"_participatingPlanViewControllers",destroy:true},{name:"_billingPlanViewControllers",destroy:true},{name:"_invoiceCollectionViewController",destroy:true},{name:"_paymentChangerViewController",destroy:true},{name:"_viewVisible",destroy:true,defaultValue:false},{name:"_restrictSharing",destroy:true}],_initialize:function(){s.prototype._initialize.call(this);this._participatingPlanViewControllers=[];this._billingPlanViewControllers=[];this._setupPaymentChangerViewController();this._view.hideSharingSettings();this._view.hideInvoiceSettings();this._setupPlans();this._setupInvoices()},_setupPaymentChangerViewController:function(){this._paymentChangerViewController=new i.Modules.Paywall.PaymentChangerViewController;this._view.setPaymentChangerView(this._paymentChangerViewController.getView())},_setupPlans:function(){if(!this._plans){this._plans=i.Data.getPlanCollection()}if(!this._participatingPlans){this._participatingPlans=i.Data.getParticipatingPlans();this._participatingPlans.watch("collectionChange",this._renderParticipatingPlans,this)}this._renderParticipatingPlans();if(!this._billingAdminPlanInstances){this._billingAdminPlanInstances=i.Data.getBillingPlanInstances();this._billingAdminPlanInstances.watch("collectionChange",this._renderBillingAdminPlanInstances,this)}this._renderBillingAdminPlanInstances()},_setupInvoices:function(){if(!this._invoiceCollectionViewController){this._invoiceCollectionViewController=new i.Modules.Paywall.InvoiceCollectionViewController;this._invoiceCollectionViewController.addDelegate(this)}this._view.setInvoices(this._invoiceCollectionViewController.getView())},_renderParticipatingPlans:function(){this._removeAllParticipatingPlans();if(this._participatingPlans.length===0||this._plans.length===0){this._view.hideParticipatingPlans();return}for(var e=0;e<this._participatingPlans.length;e++){var t=this._participatingPlans[e];this._addParticipatingPlan(t)}},_renderBillingAdminPlanInstances:function(){var e=this.getActiveBillingPlanInstances();this._removeAllBillingPlans();if(e.length===0||this._plans.length===0){this._view.hideBillingPlans();return}for(var n=0;n<e.length;n++){var i=e[n];var r=i.getPlanId();var a=t.find(this._plans,function(e){return e.get("planId")===r});this._addBillingPlan(i,a);var o=t.find(this._participatingPlanViewControllers,function(e){var t=e.getPlan();var n=t.get("planId");return n===r});if(o){o.setIsParticipant(false)}}this._setupSharingSettings();this._setupInvoiceSettings()},getActiveBillingPlanInstances:function(){var e=[];if(!this._billingAdminPlanInstances){return[]}for(var t=0;t<this._billingAdminPlanInstances.length;t++){var n=this._billingAdminPlanInstances[t];if(n.isActive()){e.push(n)}}return e},_addParticipatingPlan:function(e){var t=new i.Modules.Paywall.AccountPlanViewController({plan:e,isParticipant:!this._isBillingAdmin(e)});this._participatingPlanViewControllers.push(t);t.addDelegate(this);this._view.addParticipatingPlanView(t.getView())},_addBillingPlan:function(e,t){var n=new i.Modules.Paywall.AccountPlanViewController({plan:t,planInstance:e,isParticipant:false});this._billingPlanViewControllers.push(n);n.addDelegate(this);this._view.addBillingPlanView(n.getView())},_isBillingAdmin:function(e){var n=e.get("planId");var i=this.getActiveBillingPlanInstances();return!!t.find(i,function(e){return e.getPlanId()===n})},_removeAllBillingPlans:function(){this._view.removeAllBillingPlanViews();this._billingPlanViewControllers=[]},_removeAllParticipatingPlans:function(){this._view.removeAllParticipatingPlanViews();this._participatingPlanViewControllers=[]},_setupView:function(){this._view=new i.Modules.Paywall.AccountView},_setupSharingSettings:function(){var e=i.getUser();if(!this.isBillingAdminForAnyPlan()){this._view.hideSharingSettings();return}if(i.Constants.EMAIL_BLACK_LIST.indexOf(e.getDomain())>-1){this._view.hideSharingSettings();return}this._view.showSharingSettings();var t=this;var n=r.widgets.getCheckbox(i.Locale.getString("restrict_sharing_checkbox"),e.isExternalSharingRestricted());n.bind("change",function(){if(!i.isFeatureEnabled("accountRestrictions")){t._showSecurityPaywall();n.setChecked(false);i.Tracker.track("restrictedSharingPaywall");return}var r=n.isChecked();e.setIsExternalSharingRestricted(r);e.save()});this._view.setSharingToggleElement(n);var a=r.widgets.getCheckbox(i.Locale.getString("security_report_checkbox"),e.isSecurityReportEnabled());a.bind("change",function(){if(!i.isFeatureEnabled("accountRestrictions")){t._showSecurityPaywall();a.setChecked(false);i.Tracker.track("securityReportPaywall");return}var n=a.isChecked();e.setIsSecurityReportEnabled(n);e.save()});this._view.setSecurityReportToggleElement(a)},_setupInvoiceSettings:function(){var e=i.getUser();if(!this.isBillingAdminForAnyPlan()){this._view.hideInvoiceSettings();return}if(!i.isFeatureEnabled("AutoInvoiceMailing")){this._view.hideInvoiceSettings();return}this._view.showInvoiceSettings();var t=r.widgets.getCheckbox(i.Locale.getString("invoice_email_checkbox"),e.isAutomaticInvoiceEmailEnabled());t.bind("change",function(){var n=t.isChecked();e.setAutomaticInvoiceEmailEnabled(n);e.save()});this._view.setAutomaticInvoiceEmailToggleElement(t)},isBillingAdminForAnyPlan:function(){return this.getActiveBillingPlanInstances().length>0},_showSecurityPaywall:function(){new i.Widgets.PaywallGatewayViewController({title:"Feature Not Available",text:"This feature is not available on your current plan. Please upgrade to a higher tier plan to enable this feature."}).show()},upgradePlanButtonClicked:function(e){r.inboxSDK.Router.goto("upgrade/:key/start/:section",{key:e.get("key"),section:"plan"})},changeTeamButtonClicked:function(e){r.inboxSDK.Router.goto("upgrade/:key/start/:section",{key:e.get("key"),section:"team"})},invoicesPresent:function(e){this._view.showInvoices(e)},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});e.UI.ViewController.prototype.destroy.call(this)}});a.set("BentoBox.Modules.Paywall.AccountViewController",l)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"AccountViewMasterController",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);r.inboxSDK.Router.handleCustomRoute("account",this._handleAccountView.bind(this))},_handleAccountView:function(e){var t=new c.Modules.Paywall.AccountViewController;e.getElement().appendChild(t.getView().getElement()[0]);e.on("destroy",t.destroy.bind(t))}});e.DependencyManager.addFunction({functionKey:"accountViewMasterControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.AccountViewMasterController",new d)},dependentFunctionKeys:["htmlLoaded","localeLoaded","userLoggedIn","gmailLoaded"]})})(Streak);(function(e){var t=e.Library,n=e._,i=e.HTML,r=e.UI,a=e.BentoBox;var o=r.View;var s={};s["MasterCard"]=s["Discover"]="**** **** **** ";s["American Express"]="**** ****** *";s["Diners Club"]="**** ****** ";var l="****";var u=e.Class.subclass({className:"PaymentChangerView",superclass:o,_memberVariables:[{name:"_cardNo",destroy:true},{name:"_cardExpiration",destroy:true},{name:"_changeButton",destroy:true},{name:"_changeScreen",destroy:true},{name:"_updateButton",destroy:true}],_initialize:function(){o.prototype._initialize.call(this);this._cardNo=this._element.find(".streak__plan_card_no");this._cardName=this._element.find(".streak__plan_card_name");this._cardType=this._element.find(".streak__plan_card_type");this._cardExpiration=this._element.find(".streak__plan_card_expiry");this._changeButton=this._element.find(".streak__plan_card_change_btn");this._changeScreen=this._element.find(".streak__plan_card_change_screen");this._creditCardForm=this._element.find(".streak__changer_credit_card_form");this._updateButton=this._element.find(".streak__changer_update_button")},_setupElement:function(){this._element=i.getElement("streak__payment_changer")},hide:function(){this._element.hide()},show:function(){this._element.show().css("display","")},setCard:function(e){this._cardNo.text(this._getStarsForCard(e)+e.last4);this._cardName.text(e.name);this._cardType.text(e.type);this._cardExpiration.text(this._formatExpiration(e.expMonth,e.expYear))},setCreditCardFormView:function(e){this._creditCardForm.html(e.getElement())},_getStarsForCard:function(e){if(n.has(s,e.type)){return s[e.type]}else{return l}},_formatExpiration:function(e,t){var n=""+e;var i=n.length<2?"0":"";return i+n+"/"+t},setChangeButton:function(e){this._changeButton.html(e.getElement())},setUpdateButton:function(e){this._updateButton.html(e.getElement())},showChangeScreen:function(){this._changeScreen.show()},hideChangeScreen:function(){this._changeScreen.hide()},toggleChangeScreen:function(){this._changeScreen.toggle()}});t.set("BentoBox.Modules.Paywall.PaymentChangerView",u)})(Streak);(function(e){var t=e._,n=e.$,i=e.BentoBox,r=i.Locale,a=e.Gmail,o=e.Stripe,s=e.Library,l=i.UI;var u=e.UI.ViewController;var c=e.Class.subclass({className:"AccountViewController",superclass:u,memberVariables:[{name:"_changeButton",destroy:true},{name:"_changeScreenVisible",destroy:true},{name:"_creditCardForm",destroy:true},{name:"_updateButton",destroy:true}],_initialize:function(){u.prototype._initialize.call(this);this._hide();this._setupChangeButton();this._setupUpdateButton();this.cleanup()},_setupView:function(){this._view=s.getInstance("BentoBox.Modules.Paywall.PaymentChangerView")},cleanup:function(){this._hideChangeScreen();this._setUpdateButtonBusy(false);this.loadCard()},loadCard:function(){var t=this;e.APIRequester.get("users/me/cards").getPromise().then(function(e){if(e.length>0){var n=e[0];t._setCard(n);t._show()}else{t._hide()}},function(){i.ButterBarManager.showError("Failed to load card information")})},_setCard:function(e){this._view.setCard(e)},_setupChangeButton:function(){var e=this;if(!this._changeButton){this._changeButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:r.getString("change"),color:"blue",onFunction:function(){e._toggleChangeScreen();i.Tracker.track("change card clicked")}})}this._view.setChangeButton(this._changeButton)},_setupCreditCardForm:function(){if(!this._creditCardForm){var e=this;this._creditCardForm=s.getInstance("BentoBox.Widgets.CreditCardFormViewController")}this._view.setCreditCardFormView(this._creditCardForm.getView())},_destroyCreditCardForm:function(){if(this._creditCardForm){this._creditCardForm.destroy();this._creditCardForm=null}},_setupUpdateButton:function(){var e=this;if(!this._updateButton){this._updateButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:r.getString("payment_change_card"),color:"blue",onFunction:function(){e._updateButtonClicked();i.Tracker.track("update card attempted")}})}this._view.setUpdateButton(this._updateButton)},_setUpdateButtonBusy:function(e){if(e){this._updateButton.disable()}else{this._updateButton.enable()}},_updateButtonClicked:function(){var e=this;this._updateFormValidity();if(!this._isFormValid()){return}this._setUpdateButtonBusy(true);var t=i.ButterBarManager.showSaving();var n=function(n){t.reject();e._setUpdateButtonBusy(false);i.ButterBarManager.showError({message:(n?n.message||n.error||n:false)||r.getString("error_unknown")})};e._makeNewStripeToken().then(function(i){e._setUserStripeCardToken(i).then(function(){t.resolve();e.cleanup()},n)},n)},_makeNewStripeToken:function(){var t=this;return new e.Promise(function(e,n){o.card.createToken(t._getPaymentFormInformation(),function(t,i){if(i.error){console.error("Error with Stripe response",i);n(i.error)}else{console.log("Card confirmed with Stripe");e(i.id)}})})},_show:function(){this._view.show()},_hide:function(){this._view.hide()},_showChangeScreen:function(){this._changeScreenVisible=true;this._view.showChangeScreen();this._setupCreditCardForm()},_hideChangeScreen:function(){this._changeScreenVisible=false;this._view.hideChangeScreen();this._destroyCreditCardForm()},_toggleChangeScreen:function(){if(this._changeScreenVisible){this._hideChangeScreen()}else{this._showChangeScreen()}},_updateFormValidity:function(){this._creditCardForm.updateFormValidity()},_isFormValid:function(){return this._creditCardForm.isFormValid()},_setUserStripeCardToken:function(t){return e.APIRequester.put("users/me/cards",null,{cardToken:t}).getPromise()},_getPaymentFormInformation:function(){return this._creditCardForm.getPaymentFormInformation()}});s.set("BentoBox.Modules.Paywall.PaymentChangerViewController",c)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.BentoBox;var a=e.Class.subclass({className:"PaymentContactsChooserEntryView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=i.getElement("paymentContactsChooserContact")},setContent:function(e,n,i){var a=t(r.Contacts.suggestionTemplate({image:e,name:n,tag:i})).children().unwrap();this._element.find(".aclRowContent").append(a)},setButton:function(e){var t=this._element.find(".streak__paywall_contact_selectButton");t.html(e.getElement())}});n.set("BentoBox.Widgets.PaymentContactsChooserEntryView",a)})(Streak);(function(e){var t=e.Library,n=e.BentoBox;var i=e.Class.subclass({className:"PaymentContactsChooserEntryViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_person",destroy:true,get:true},{name:"_button",destroy:true},{name:"_paywallTracker",destroy:false}],_initialize:function(t){this._paywallTracker=t.tracker;e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=t.getInstance("BentoBox.Widgets.PaymentContactsChooserEntryView");this._setupButton()},setPerson:function(t){var n=t.imageUrl?t.imageUrl:e.server+e.combinedPath+"images/unknownContact.png";
var i=t.fullName||t.email;var r=t.fullName?t.email:"&nbsp;";this._view.setContent(n,i,r);this._person=t},_setupButton:function(){var e=this;var t=n.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:n.Locale.getString("payment_add_to_team"),color:"default",onFunction:function(){e._paywallTracker.track("paywall.team.memberAdded",{person:e._person.email});e._callDelegateFunction("addTeamMember",e._person)}});this._view.setButton(t)}});t.set("BentoBox.Widgets.PaymentContactsChooserEntryViewController",i)})(Streak);(function(e){var t=e._,n=e.Library,i=e.UI,r=e.BentoBox;var a=e.Class.subclass({className:"PaymentContactsChooserViewController",superclass:i.ViewController,_memberVariables:[{name:"_contactEntryViewControllers",destroy:true},{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false},{name:"_autosuggestedContacts",destroy:true},{name:"_visibleAutosuggestions",destroy:true},{name:"_loadingContacts",destroy:true}],_initialize:function(e){this._model=e.model;this._paywallTracker=e.tracker;i.ViewController.prototype._initialize.call(this);this._contactEntryViewControllers=[];this._visibleAutosuggestions=[];this.startContactLoading();this._model.addDelegate(this)},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.PaymentContactsChooserView")},startContactLoading:function(){var e=this;this._view.showLoading();this._loadingContacts=true;r.Contacts.getTopContactsInStreak(30).then(function(n){this._loadingContacts=false;n=n||[];if(n.length===0){e._autosuggestedContacts=[];e._view.setAreThereAutosuggestedContacts(false)}else{e._autosuggestedContacts=t(n).chain().filter(function(e){return e.email!==r.getUser().get("email")&&e.fullName!==e.email}).value()}e.updateAutosuggestedContacts()})},_addAutosuggestedContact:function(e){var t=new r.Widgets.PaymentContactsChooserEntryViewController({tracker:this._paywallTracker});t.setPerson(e);t.addDelegate(this);this._view.addSuggestedContactEntryView(t.getView());this._contactEntryViewControllers[e.email]=t;this._visibleAutosuggestions.push(e);this._view.setAreThereAutosuggestedContacts(this._visibleAutosuggestions.length>0)},_removeAutosuggestedContact:function(e){this._view.removeSuggestedContactEntryView(this._contactEntryViewControllers[e.email].getView());this._visibleAutosuggestions=t.without(this._visibleAutosuggestions,e);this._contactEntryViewControllers[e.email]=undefined;this._view.setAreThereAutosuggestedContacts(this._visibleAutosuggestions.length>0)},addTeamMember:function(e){this._model.addTeamMember(e)},teamChanged:function(){this.updateAutosuggestedContacts()},updateAutosuggestedContacts:function(){if(this._autosuggestedContacts){var e=t.pluck(this._model.getTeam(),"email");var n=t.filter(this._autosuggestedContacts,function(t){return e.indexOf(t.email)==-1});var i=t.pluck(n,"email");var r=t.pluck(this._visibleAutosuggestions,"email");var a=t.filter(n,function(e){return r.indexOf(e.email)==-1});var o=t.filter(this._visibleAutosuggestions,function(e){return i.indexOf(e.email)==-1});var s=this;t.each(a,function(e){s._addAutosuggestedContact(e)});t.each(o,function(e){s._removeAutosuggestedContact(e)})}if(this._loadingContacts){return}this._view.setAreThereAutosuggestedContacts(this._visibleAutosuggestions.length>0)}});n.set("BentoBox.Modules.Paywall.PaymentContactsChooserViewController",a)})(Streak);(function(e){var t=e.Library,n=e.UI,i=e.HTML;var r=e.Class.subclass({className:"PaymentContactsChooserView",superclass:n.View,_memberVariables:[{name:"_empty",destroy:true},{name:"_listElement",destroy:true},{name:"_loadingElement",destroy:true}],_initialize:function(){n.View.prototype._initialize.call(this)},_setupElement:function(){this._element=i.getElement("streak__paymentContactsChooserContact_list");this._listElement=this._element.find(".streak__list");this._loadingElement=this._element.find(".streak__loading");this._empty=this._element.find(".streak__empty")},setAreThereAutosuggestedContacts:function(e){this.hideLoading();if(e){this._empty.hide();this._listElement.show()}else{this._listElement.hide();this._empty.show()}},showLoading:function(){this._listElement.hide();this._empty.hide();this._loadingElement.show()},hideLoading:function(){this._loadingElement.hide()},addSubView:function(e){this._listElement.append(e.getElement())},addSuggestedContactEntryView:function(e){this.addSubView(e)},removeSuggestedContactEntryView:function(e){e.getElement().remove()}});t.set("BentoBox.Modules.Paywall.PaymentContactsChooserView",r)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.BentoBox;var a=e.Class.subclass({className:"PaymentContactsChosenEntryView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=i.getElement("paymentContactsChosenContact")},clickRemove:function(e){this._element.find(".ar9").click(e)},setContent:function(e,n,i){var a=t(r.Contacts.suggestionTemplate({image:e,name:n,tag:i})).children().unwrap();this._element.find(".streak__contactContent").append(a)}});n.set("BentoBox.Widgets.PaymentContactsChosenEntryView",a)})(Streak);(function(e){var t=e.Library;var n=e.Class.subclass({className:"PaymentContactsChosenEntryViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_person",destroy:false,get:true},{name:"_paywallTracker",destroy:false}],_initialize:function(t){this._paywallTracker=t.tracker;e.UI.ViewController.prototype._initialize.call(this);var n=this;this._view.clickRemove(function(){n._paywallTracker.track("paywall.team.memberRemoved",{person:n._person.email});n._callDelegateFunction("removeTeamMember",n._person)})},_setupView:function(){this._view=t.getInstance("BentoBox.Widgets.PaymentContactsChosenEntryView")},setPerson:function(t){var n=t.imageUrl||t.image||e.server+e.combinedPath+"images/unknownContact.png";var i=t.fullName||t.email;var r=t.fullName?t.email:"&nbsp;";this._view.setContent(n,i,r);this._person=t},removeTeamMember:function(e){this._callDelegateFunction("removeTeamMember",e)}});t.set("BentoBox.Widgets.PaymentContactsChosenEntryViewController",n)})(Streak);(function(e){var t=e.Library,n=e.UI;var i=e.Class.subclass({className:"PaymentContactsChosenView",superclass:n.View,_memberVariables:[{name:"_noTeamElement",destroy:true}],_initialize:function(){n.View.prototype._initialize.call(this)},addChosenContactView:function(e){this.prependSubView(e);this._noTeamElement.hide()},removeChosenContactView:function(e){this.removeSubview(e);if(this._element.children().length<=1){this._noTeamElement.show()}},setElement:function(e){this._element=e;this._noTeamElement=this._element.find(".streak__no_team")},removeSubview:function(e){e.getElement().remove()}});t.set("BentoBox.Modules.Paywall.PaymentContactsChosenView",i)})(Streak);(function(e){var t=e._,n=e.Library,i=e.BentoBox,r=e.UI;var a=e.Class.subclass({className:"PaymentContactsChosenViewController",superclass:r.ViewController,_memberVariables:[{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false},{name:"_chosenContacts",destroy:false},{name:"_chosenContactEntryViewControllers",destroy:true},{name:"_teamSuggestions",destroy:false},{name:"_teamSuggestionsAlreadyAdded",destroy:true,defaultValue:false},{name:"_hasFocus",destroy:true,defaultValue:false},{name:"_acceptDefaultTeamSuggestionsAutomatically",destroy:true,defaultValue:false},{name:"_defaultTeamSuggestionsDeferred",destroy:true}],_initialize:function(e){this._model=e.model;this._paywallTracker=e.tracker;r.ViewController.prototype._initialize.call(this);this._chosenContacts=[];this._chosenContactEntryViewControllers={};this._model.addDelegate(this);this.hasDefaultTeamSuggestionLoaded(false)},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.PaymentContactsChosenView")},planInstanceCleared:function(){this._clearTeam();this._acceptDefaultTeamSuggestionsAutomatically=false;this._defaultTeamSuggestionsDeferred=null},initializeTeam:function(t){this._clearTeam();this._teamSuggestions=null;this._defaultTeamSuggestionsDeferred=e.Promise.defer();var n=this;this.getTeamSuggestions({planInstance:t}).then(function(e){if(!n._defaultTeamSuggestionsDeferred){return}n._teamSuggestions=e;n._addTeamSuggestions();n.hasDefaultTeamSuggestionLoaded(true);n._defaultTeamSuggestionsDeferred.resolve()},function(e){if(!n._defaultTeamSuggestionsDeferred){return}n._teamSuggestions=[];console.error("Error retrieving suggestions",e);n.hasDefaultTeamSuggestionLoaded(true);n._defaultTeamSuggestionsDeferred.resolve()})},whenDefaultTeamSuggestionsLoaded:function(){if(this._defaultTeamSuggestionsDeferred){return this._defaultTeamSuggestionsDeferred.promise}throw new Error("whenDefaultTeamSuggestionsLoaded called in between planInstanceCleared clear and initializeTeam")},addChosenContact:function(e){if(this._chosenContactEntryViewControllers[e.email]){return}var t=new i.Widgets.PaymentContactsChosenEntryViewController({tracker:this._paywallTracker});t.setPerson(e);t.addDelegate(this);this._view.addChosenContactView(t.getView());this._chosenContacts.push(e);this._chosenContactEntryViewControllers[e.email]=t;i.ButterBarManager.hideMessage("paywall-error")},removeChosenContact:function(e){var n=this._chosenContactEntryViewControllers[e.email];this._view.removeChosenContactView(n.getView());this._chosenContacts=t.without(this._chosenContacts,e);this._chosenContactEntryViewControllers[e.email]=undefined},hasLoadedSuggestions:function(){return this._teamSuggestions!==null},_addTeamSuggestions:function(){if(this._teamSuggestionsAlreadyAdded){return}if(!(this._hasFocus||this._acceptDefaultTeamSuggestionsAutomatically)){return}if(!this._teamSuggestions){return}if(this._model.isTeamSet()){this._teamSuggestionsAlreadyAdded=true;return}this._teamSuggestionsAlreadyAdded=true;for(var e=0;e<this._teamSuggestions.length;e++){this._model.addTeamMember(this._teamSuggestions[e])}},teamChanged:function(){this._updateDisplayedContacts()},_clearTeam:function(){this._teamSuggestionsAlreadyAdded=false;this.hasDefaultTeamSuggestionLoaded(false)},_updateDisplayedContacts:function(){var e=this._model.getTeam();var n=this._chosenContacts;var i=t.difference(n,e);var r=t.difference(e,n);for(var a=0;a<i.length;a++){var o=i[a];this.removeChosenContact(o)}for(a=0;a<r.length;a++){var s=r[a];this.addChosenContact(s)}},removeTeamMember:function(e){this._model.removeTeamMember(e)},getTeamSuggestions:function(t){var n={};if(t.planInstance){n.planInstanceKey=t.planInstance.get("key")}return e.APIRequester.get("users/me/teamsuggestion",n).getPromise()},hasDefaultTeamSuggestionLoaded:function(e){this._callDelegateFunction("hasDefaultTeamSuggestionLoaded",e)},focus:function(e){this._hasFocus=e;this._addTeamSuggestions()},acceptDefaultTeamAutomatically:function(){this._acceptDefaultTeamSuggestionsAutomatically=true;this._addTeamSuggestions()}});n.set("BentoBox.Modules.Paywall.PaymentContactsChosenViewController",a)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI,r=e.BentoBox;var a=e.Class.subclass({className:"TeamView",superclass:i.View,_memberVariables:[{name:"_teamPicker",destroy:true},{name:"_chosenTeam",destroy:true},{name:"_numberOfTeamMembersElement",destroy:true}],_initialize:function(){i.View.prototype._initialize.call(this);this._teamPicker=this._element.find(".streak__paywall_team_picker_list");this._chosenTeam=this._element.find(".streak__team_summary");this._numberOfTeamMembersElement=this._element.find(".streak__team_numberOfMembers")},_setupElement:function(){this._element=n.getElement("streak__paywall_select_users")},setAddPersonButton:function(e){var t=this._element.find(".streak__add_more_button");t.html(e.getElement())},setPersonPicker:function(e){var t=this._element.find(".streak__add_more_textbox");t.html(e.getElement())},setTeamContinueButton:function(e){var t=this._element.find(".streak__team_continue_button");t.html(e.getElement())},getChosenContactListElement:function(){return this._chosenTeam},setContactChooser:function(e){this._teamPicker.html(e.getElement())},setNumberOfTeamMembers:function(e){this._numberOfTeamMembersElement.text(r.Locale.getString("payment_your_team",{teamsize:e}))}});t.set("BentoBox.Modules.Paywall.TeamView",a)})(Streak);(function(e){var t=e.Library,n=e.UI,i=e.BentoBox;var r=e.Class.subclass({className:"TeamViewController",superclass:n.ViewController,_memberVariables:[{name:"_teamContinueButton",destroy:true},{name:"_personPicker",get:true,destroy:true},{name:"_addPersonButton",destroy:true},{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false},{name:"_chosenContactsViewController",destroy:true},{name:"_contactChooserViewController",destroy:true}],_initialize:function(e){n.ViewController.prototype._initialize.call(this);this._model=e.model;this._paywallTracker=e.tracker;this._setupContinueTeamButton();this._setupPersonPicker();this._setupChosenContactViewController();this._model.addDelegate(this)},_setupView:function(){this._view=t.getInstance("BentoBox.Modules.Paywall.TeamView")},_setupContinueTeamButton:function(){if(!this._teamContinueButton){var e=this;this._teamContinueButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",html:i.Locale.getString("continue_to_next_step")+" &#x279c;",color:"blue",onFunction:function(){e._paywallTracker.track("paywall.team.continueButton.clicked");e._callDelegateFunction("teamContinueButtonPressed")}})}this._view.setTeamContinueButton(this._teamContinueButton)},_setupPersonPicker:function(){if(!this._personPicker){var e=this;this._personPicker=new i.Widgets.PersonPickerViewController({contactSelectedCallback:function(t){e.addTeamMember(t)}})}this._view.setPersonPicker(this._personPicker.getView())},_setupAddPersonButton:function(){if(!this._addPersonButton){var e=this;this._addPersonButton=i.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:i.Locale.getString("add"),onFunction:function(){e._personPicker.selectItem()}})}this._view.setAddPersonButton(this._addPersonButton)},_setupContactChooserViewController:function(){this._contactChooserViewController=new i.Modules.Paywall.PaymentContactsChooserViewController({model:this._model,tracker:this._paywallTracker});this._view.setContactChooser(this._contactChooserViewController.getView())},_setupChosenContactViewController:function(){this._chosenContactsViewController=new i.Modules.Paywall.PaymentContactsChosenViewController({model:this._model,tracker:this._paywallTracker});this._chosenContactsViewController.addDelegate(this);this._chosenContactsViewController.getView().setElement(this._view.getChosenContactListElement())},addTeamMember:function(e){this._model.addTeamMember(e)},teamChanged:function(){this._updateExcludedPeople();this._view.setNumberOfTeamMembers(this._model.getTeamEmailAddresses().length)},hasLoadedSuggestions:function(){return this._chosenContactsViewController.hasLoadedSuggestions()},whenDefaultTeamSuggestionsLoaded:function(){return this._chosenContactsViewController.whenDefaultTeamSuggestionsLoaded()},focus:function(e){if(!this._contactChooserViewController&&e){this._setupContactChooserViewController()}this._chosenContactsViewController.focus(e)},_updateExcludedPeople:function(){var e=this._model.getTeam();this.getPersonPicker().setExcluded(e)},planInstanceChanged:function(e){this._chosenContactsViewController.initializeTeam(e);if(this._model.shouldAcceptDefaultTeamAutomatically()){this._chosenContactsViewController.acceptDefaultTeamAutomatically()}},hasDefaultTeamSuggestionLoaded:function(e){this._callDelegateFunction("hasDefaultTeamSuggestionLoaded",e)}});t.set("BentoBox.Modules.Paywall.TeamViewController",r)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=e.Class.subclass({className:"PlanView",superclass:r.View,_memberVariables:[{name:"_plan",destroy:false,get:true},{name:"_upgradeButton",destroy:true,get:true},{name:"_emailSupport",destroy:true,defaultValue:false},{name:"_phoneSupport",destroy:true,defaultValue:false}],_initialize:function(){r.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t(i.getElement("streak__paywall_plan"))},setPlanName:function(e){this._element.find(".streak__plan_name").text(e)},setPlanCost:function(e){this._element.find(".streak__cost").text(e)},setTopColor:function(e){if(e){var t=this._element.find(".streak__plan_summary_color_bar");t.css("background-color",e);t.show()}},addFeatureKey:function(e){if(e=="emailSupport"){this._emailSupport=true;this.updateSupportLevel()}else if(e=="phoneSupport"){this._phoneSupport=true;this.updateSupportLevel()}else{this.showFeature(e,true)}},removeFeatureKey:function(e){if(e=="emailSupport"){this._emailSupport=false;this.updateSupportLevel()}else if(e=="phoneSupport"){this._phoneSupport=false;this.updateSupportLevel()}else{this.showFeature(e,false)}},showFeature:function(e,t){if(t){this._element.find(".streak__plan_feature_description_"+e).show();this._element.find(".streak__plan_feature_description_no_"+e).hide()}else{this._element.find(".streak__plan_feature_description_"+e).hide();this._element.find(".streak__plan_feature_description_no_"+e).show()}},updateSupportLevel:function(){if(this._phoneSupport){this._element.find(".streak__plan_feature_description_no_emailSupport").hide();this._element.find(".streak__plan_feature_description_emailSupport").hide();this._element.find(".streak__plan_feature_description_phoneSupport").show()}else if(this._emailSupport){this._element.find(".streak__plan_feature_description_no_emailSupport").hide();this._element.find(".streak__plan_feature_description_emailSupport").show();this._element.find(".streak__plan_feature_description_phoneSupport").hide()}else{this._element.find(".streak__plan_feature_description_no_emailSupport").show();this._element.find(".streak__plan_feature_description_emailSupport").hide();this._element.find(".streak__plan_feature_description_phoneSupport").hide()}},setLearnMore:function(e){if(e){var t=this._element.find(".streak__learn_more");t.attr("data-tooltip",e);t.css("visibility","visible")}},showDiscount:function(){this._element.find(".streak__plan_discount").show().css("display","")},hideDiscount:function(){this._element.find(".streak__plan_discount").hide()},setDiscountPercentage:function(e){this._element.find(".streak__plan_discount .streak__discount_percentage").text(e)},setOriginalCost:function(e){this._element.find(".streak__plan_discount .streak__original_cost_per_user").text(e)},setTrialPeriod:function(e){var t=this._element.find(".streak__refund_text");var n=this._element.find(".streak__trialPeriodDays");var i=this._element.find(".streak__trialPeriod_text");n.text(e);if(e===0){t.show().css("display","");i.hide()}else{t.hide();i.show().css("display","")}},setUpgradeButton:function(e){this._upgradeButton=e;var t=this._element.find(".streak__upgrade_button");t.html(this._upgradeButton.getElement())},setCollaboratorLimit:function(e){var t;if(typeof e==="number"){t=true}else if(e===null){t=false}else{throw new Error("setCollaboratorLimit got invalid limit")}this._element.find(".streak__plan_feature_description_unlimitedCollaborators").toggle(!t);this._element.find(".streak__plan_feature_description_limitedCollaborators").text(e).toggle(t)}});n.set("BentoBox.Modules.Paywall.PlanView",a)})(Streak);(function(e){var t=e._,n=e.Library,i=e.UI,r=e.BentoBox,a=r.Locale;var o=i.ViewController;var s=e.Class.subclass({className:"PlanViewController",superclass:o,_memberVariables:[{name:"_upgradeButton",destroy:true},{name:"_planKey",destroy:true},{name:"_topColor",destroy:true},{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false}],_initialize:function(e){this._model=e.model;this._paywallTracker=e.tracker;o.prototype._initialize.call(this);this._planKey=e.planKey;this._topColor=e.topColor;this._view.setTopColor(this._topColor);var n=this._model.getPlanName(this._planKey);this._view.setPlanName(n);var i=this._model.getPlanCostPerUserPerMonth(this._planKey);this._view.setPlanCost(i);var r=this._model.getCollaboratorLimit(this._planKey);this._view.setCollaboratorLimit(r);this._refreshDiscount();var a=this._model.getPlanFeatureDescription(this._planKey);t.each(a,this._view.addFeatureKey,this._view);var s=this._model.getPlanLearnMoreText(this._planKey);this._view.setLearnMore(s);this._refreshTrialPeriod();this._setupUpgradeButton();this._model.addDelegate(this)},_setupUpgradeButton:function(){this._upgradeButton=r.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:this.getButtonTextForPlan(),color:this.getButtonColorForPlan(),onFunction:this.planUpgradeClicked.bind(this)});this._view.setUpgradeButton(this._upgradeButton)},planUpgradeClicked:function(){this._paywallTracker.track("paywall.plan.continue.clicked",{planKey:this._planKey});this._model.setSelectedPlanKey(this._planKey);this._callDelegateFunction("planUpgradeClicked")},planChanged:function(){r.ButterBarManager.hideMessage("paywall-error");this._upgradeButton.setHTML(this.getButtonTextForPlan()+" &#x279c;");this._upgradeButton.setColor(this.getButtonColorForPlan())},discountChanged:function(){this._refreshDiscount()},trialPeriodDaysChanged:function(){this._refreshTrialPeriod()},_refreshDiscount:function(){var e=this._model.getDiscountPercentage(this._planKey);var t=this._model.getBasePlanCostPerUserPerMonth(this._planKey);if(e&&e!==0){this._view.showDiscount();this._view.setDiscountPercentage(e);this._view.setOriginalCost(t)}else{this._view.hideDiscount()}},_refreshTrialPeriod:function(){var e=this._model.getTrialPeriodDays(this._planKey)||0;this._view.setTrialPeriod(e)},getButtonTextForPlan:function(){if(!this._model){return a.getString("payment_upgrade")}var e=this._model.getSelectedPlanKey();if(!e){return a.getString("payment_upgrade")}var t=this._model.getPlanCostPerUserPerMonth(this._planKey);if(this._planKey===e){return a.getString("payment_keep_plan")}else if(t<this._model.getPlanCostPerUserPerMonth(e)){return a.getString("payment_downgrade")}else{return a.getString("payment_upgrade")}},getButtonColorForPlan:function(){if(!this._model){return"blue"}var e=this._model.getSelectedPlanKey();if(this._planKey===e){return"green"}else{return"blue"}},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.PlanView")}});n.set("BentoBox.Modules.Paywall.PlanViewController",s)})(Streak);(function(e){var t=e.$,n=e.Library,i=e.HTML,r=e.UI,a=e.Locale;var o=r.View;var s=e.Class.subclass({className:"PlansView",superclass:o,_memberVariables:[],_initialize:function(){o.prototype._initialize.call(this);this._plansWrapper=this._element.find(".streak__plans_wrapper")},_setupElement:function(){this._element=t(i.getElement("streak__paywall_plans"))},addPlan:function(e){this._plansWrapper.append(e.getElement())},clearPlans:function(){this._plansWrapper.html(null)},setHelpButton:function(e,t){this._element.find(".streak__"+e+"_description").html(t.getElement())},getTextForHelpButton:function(e){return a.getString("feature_description_"+e)},showCurrentFreePlan:function(){this._element.find(".streak__plans_currentFreePlan").show()},hideCurrentFreePlan:function(){this._element.find(".streak__plans_currentFreePlan").hide()}});n.set("BentoBox.Modules.Paywall.PlansView",s)})(Streak);(function(e){var t=e._,n=e.Library,i=e.UI,r=e.BentoBox;var a={BEST_COLOR:"#00a551",WORST_COLOR:"#ee4036",DEFAULT_COLOR:"#fff100"};var o=e.Class.subclass({className:"PlansViewController",superclass:i.ViewController,_memberVariables:[{name:"_colorForPlan",destroy:true},{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false},{name:"_planViews",destroy:true},{name:"_planViewControllers",destroy:true,defaultValue:[]}],_initialize:function(e){this._model=e.model;this._paywallTracker=e.tracker;i.ViewController.prototype._initialize.call(this);this._colorForPlan={};this._setupHelpLinks();this._addPlans();this._model.addDelegate(this)},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.PlansView")},planUpgradeClicked:function(){this._callDelegateFunction("planUpgradeClicked")},plansChanged:function(){this._addPlans()},colorForPlan:function(e,t){var n=t>=3?t-2:t;var i=t>=3?t-1:-1;if(e==n){return a.BEST_COLOR}else if(e==i){return a.WORST_COLOR}else{return a.DEFAULT_COLOR}},_addPlans:function(){var e=this._model.getPlanKeys();var n=this;e=t.sortBy(e,function(e){return n._model.getPlanCostPerUserPerMonth(e)});this._removeAllPlans();for(var i=0;i<e.length;i++){var r=e[i];var a=this.colorForPlan(i,e.length);this._addPlan({planKey:r,topColor:a})}this._setupCurrentFreePlan()},_addPlan:function(e){e=t.extend(e,{model:this._model,tracker:this._paywallTracker});var n=new r.Modules.Paywall.PlanViewController(e);n.addDelegate(this);this._planViewControllers.push(n);this._view.addPlan(n.getView())},_removeAllPlans:function(){this._planViews=[];this._view.clearPlans()},_setupHelpLinks:function(){var e=[{feature:"collaboratorLimits",helpChapter:"Limits on Streak Collaborators"},{feature:"unlimitedBoxes",helpChapter:"Limits on Streak Data"},{feature:"linkedBoxes",helpChapter:"What are Linked Boxes?"},{feature:"emailFilters",helpChapter:"What are Email Filters?"},{feature:"formulaFields",helpChapter:"What are Formulas?"},{feature:"reports",helpChapter:"What are Reports?"},{feature:"calendarEvents",helpChapter:"What are Calendar Events?"},{feature:"tasks",helpChapter:"What are Tasks?"},{feature:"callLogs",helpChapter:"What are Call Logs And Meeting Notes?"},{feature:"advancedPermissions",helpChapter:"What are Permission Roles?"},{feature:"customPermissionRoles",helpChapter:"What are Custom Permission Roles?"},{feature:"unlimitedEmailTools",helpChapter:"What Are The Email Tool Limits?"},{feature:"support",helpChapter:"What is Premium Support?"}];t.each(e,this._setupHelpLink.bind(this))},_setupHelpLink:function(e){var t=this;var i=r.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:t._view.getTextForHelpButton(e.feature),onFunction:function(){var t=n.get("BentoBox.Modules.Help.HelpLoader");t.getHelpViewController().startChapter(e.helpChapter)}});this._view.setHelpButton(e.feature,i)},_setupCurrentFreePlan:function(){if(!this._model||!this._model.getSelectedPlanKey()){this._view.showCurrentFreePlan()}else{this._view.hideCurrentFreePlan()}}});n.set("BentoBox.Modules.Paywall.PlansViewController",o)})(Streak);(function(e){var t=e.Library,n=e.HTML,i=e.UI;var r=e.Class.subclass({className:"PaymentView",superclass:i.View,_memberVariables:[{name:"_creditCardForm",destroy:true}],_initialize:function(){i.View.prototype._initialize.call(this);this._stripeAlert=this._element.find(".streak__stripe_error");this._creditCardForm=this._element.find(".streak__payment_credit_card_form")},_setupElement:function(){this._element=n.getElement("streak__paywall_payment")},setContinueButton:function(e){var t=this._element.find(".streak__subscribe_button");t.html(e.getElement())},setCreditCardFormView:function(e){this._creditCardForm.html(e.getElement())},setStripeError:function(e){this._stripeAlert.text(e)},setChangeCardButton:function(e){this._element.find(".streak__payment_changeCard").html("or, ");this._element.find(".streak__payment_changeCard").append(e.getElement())},showLoading:function(){this._element.find(".streak__payment_loading").show();this._creditCardForm.hide();this._element.find(".streak__card_filled_in").hide();this._element.find(".streak__payment_changeCard").hide()},showThereIsAnExistingCreditCard:function(){this._element.find(".streak__payment_loading").hide();this._creditCardForm.hide();this._element.find(".streak__card_filled_in").show();this._element.find(".streak__payment_changeCard").show()},showCreditCardForm:function(){this._element.find(".streak__payment_loading").hide();this._element.find(".streak__card_filled_in").hide();this._creditCardForm.show();this._element.find(".streak__payment_changeCard").hide()}});t.set("BentoBox.Modules.Paywall.PaymentView",r)})(Streak);(function(e){var t=e._,n=e.$,i=e.Library,r=e.UI,a=e.BentoBox,o=a.Locale,s=e.Stripe,l=a.ButterBarManager;var u=e.Class.subclass({className:"PaymentViewController",superclass:r.ViewController,_memberVariables:[{name:"_model",destroy:false},{name:"_paywallTracker",destroy:false},{name:"_continueButton",destroy:true},{name:"_userHasBillingInfo",destroy:false},{name:"_changeCardButton",destroy:true},{name:"_shouldOverrideCard",destroy:true,defaultValue:false}],_initialize:function(e){this._model=e.model;this._paywallTracker=e.tracker;r.ViewController.prototype._initialize.call(this);this._setupContinueButton();this._setupCreditCardForm();this._setupChangeCardButton();this._model.addDelegate(this);this._updateButtonEnabled();this._view.showLoading()},planInstanceChanged:function(){this._view.showLoading();var e=this;this._doesUserHaveExistingCard().then(function(t){e._model.setUserHasCard(t);e._setUserHasBillingInfo(t);if(t){e._view.showThereIsAnExistingCreditCard()}else{e._view.showCreditCardForm()}})},teamChanged:function(){this._updateButtonEnabled()},planChanged:function(){this._updateButtonEnabled()},focus:function(){if(this._userHasBillingInfo){this._shouldOverrideCard=false;this._view.showThereIsAnExistingCreditCard();return}this._creditCardForm.focus()},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.Paywall.PaymentView")},_setupCreditCardForm:function(){if(!this._creditCardForm){var e=this;this._creditCardForm=i.getInstance("BentoBox.Widgets.CreditCardFormViewController")}this._view.setCreditCardFormView(this._creditCardForm.getView())},_setupContinueButton:function(){if(!this._continueButton){var e=this;this._continueButton=a.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:o.getString("payment_subscribe"),color:"blue",onFunction:function(){e._buyPlanButtonClicked()}});this._continueButton.getElement().attr("tabindex",0);this._updateButtonEnabled()}this._view.setContinueButton(this._continueButton)},_setupChangeCardButton:function(){var e=this;this._changeCardButton=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:o.getString("payment_change_card"),onFunction:function(){e._view.showCreditCardForm();e._shouldOverrideCard=true}});this._view.setChangeCardButton(this._changeCardButton)},_setUserHasBillingInfo:function(e){this._userHasBillingInfo=e;this._updateButtonEnabled()},_updateButtonEnabled:function(){var e=this._continueButtonShouldBeEnabled();if(e){this._continueButton.enable()}else{this._continueButton.disable()}},_continueButtonShouldBeEnabled:function(){if(!this._model)return false;return this._model.isPlanSet()&&this._model.isTeamSet()&&this._userHasBillingInfo!==null},_buyPlanButtonClicked:function(){this._updateFormValidity({emptyIsValid:false});if(!this._continueButtonShouldBeEnabled()){return}if(this._userHasBillingInfo&&!this._shouldOverrideCard){this._paywallTracker.track("paywall.payment.subscribe.clicked",{valid:true,hasBillingInfo:true});this._showSubscribingMessage();this._setButtonToPaying(true);this._delegate.subscribeWithBillingComplete().then(this._subscribedSuccessfully.bind(this),this._problemWithSubscribing.bind(this))}else if(this._isFormValid({emptyIsValid:false})){this._paywallTracker.track("paywall.payment.subscribe.clicked",{valid:true,hasBillingInfo:false});this._showSubscribingMessage();this._setButtonToPaying(true);this._setupBillingForUser().then(this._delegate.subscribeWithBillingComplete.bind(this._delegate)).then(this._subscribedSuccessfully.bind(this)).catch(this._problemWithSubscribing.bind(this))}else{this._paywallTracker.track("paywall.payment.subscribe.clicked",{valid:false,hasBillingInfo:false})}},_setupBillingForUser:function(){return this._makeNewStripeToken().then(this._setUserStripeCardToken)},_doesUserHaveExistingCard:function(){return e.APIRequester.get("users/me/cards").getPromise().then(function(e){var t=e.length>0&&e[0].id!==undefined;return t})},_setUserStripeCardToken:function(t){return e.APIRequester.put("users/me/cards",{cardToken:t}).getPromise()},_updateFormValidity:function(){return this._creditCardForm.updateFormValidity()},_isFormValid:function(){return this._creditCardForm.isFormValid()
},_showSubscribingMessage:function(){l.showMessage(o.getString("payment_subscribing"),{priority:1,time:l.FOREVER,messageKey:"paywall"})},_subscribedSuccessfully:function(){this._setButtonToPaying(false);l.showMessage(o.getString("payment_subscribed"),{priority:100,messageKey:"paywall"})},_problemWithSubscribing:function(e){this._setButtonToPaying(false);var t=o.getString("payment_subscription_failed");if(!e){l.showError(t,{messageKey:"paywall"});a.logError("Problem with subscription payment\nerror: no error object")}else{t=a.Locale.getString(e.errorMessage||e.stripeMessage||t);l.showError(t,{messageKey:"paywall"});a.logError("Problem with subscription payment\nerror:"+t,e)}},_setButtonToPaying:function(e){if(e){this._continueButton.disable();this._continueButton.setText(o.getString("payment_purchasing"))}else{this._continueButton.setText(o.getString("payment_subscribe"));this._continueButton.enable()}},_makeNewStripeToken:function(){var t=this;return new e.RSVP.Promise(function(e,n){s.card.createToken(t._getPaymentFormInformation(),function(i,r){if(r.error){var a=new Error("Bad response from server");a.response=r;a.details={response:r};if(r.error.type==="card_error"){t._stripeError(r)}n(a)}else{e(r.id)}})})},_getPaymentFormInformation:function(){return this._creditCardForm.getPaymentFormInformation()},_stripeError:function(e){this._view.setStripeError(e.error.message)}});i.set("BentoBox.Modules.Paywall.PaymentViewController",u)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"InvoiceView",superclass:a,_memberVariables:[{name:"_amount",destroy:true},{name:"_users",destroy:true},{name:"_description",destroy:true},{name:"_dateRange",destroy:true},{name:"_seeDetails",destroy:true},{name:"_lineItemElements",destroy:true},{name:"_lineItemElementsVisible",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._amount=this._element.find(".streak__invoice_amount");this._users=this._element.find(".streak__invoice_users");this._description=this._element.find(".streak__invoice_description");this._dateRange=this._element.find(".streak__invoice_date_range");this._seeDetails=this._element.find(".streak__invoice_see_details");this._emailInvoice=this._element.find(".streak__invoice_email_invoice");this._lineItemElements=t()},_setupElement:function(){this._element=t(i.getElement("streak__invoice_view"))},addInvoiceLineItem:function(e){var t=e.getElement();if(this._lineItemElementsVisible){this._element.append(t)}this._lineItemElements=this._lineItemElements.add(t)},showSeeLessDetails:function(e){if(e){this._seeDetails.toggle(e).css("display","")}else{this._seeDetails.toggle(e)}},setSeeDetailsButton:function(e){this._seeDetails.html(e.getElement())},setEmailInvoiceButton:function(e){this._emailInvoice.html(e.getElement())},clearLineItems:function(){this._lineItemElements.remove();this._lineItemElements=t()},setUsers:function(e){this._users.html(e)},setPlan:function(e){this._description.html(e)},setDateRange:function(e){this._dateRange.html(e)},setCost:function(e){this._amount.html(e)},setLineItemsVisibility:function(e){if(e&&!this._lineItemElementsVisible){this._element.append(this._lineItemElements)}else if(!e&&this._lineItemElementsVisible){this._lineItemElements.detach()}this._lineItemElementsVisible=e}});n.set("BentoBox.Modules.Paywall.InvoiceView",o)})(Streak);(function(e){var t=e._,n=e.Date,i=e.Library,r=e.UI,a=e.BentoBox,o=a.Locale;var s=r.ViewController;var l=e.Class.subclass({className:"InvoiceViewController",superclass:s,_memberVariables:[{name:"_invoice",destroy:false},{name:"_lineItemViewControllers",destroy:true},{name:"_seeDetailsButton",destroy:true},{name:"_hideDetailsButton",destroy:true}],_initialize:function(e){s.prototype._initialize.call(this);this._lineItemViewControllers=[];this._invoice=e;this._setupHeaderRow();this._setupSeeDetailsButton();this._setupHideDetailsButton();this._setupEmailInvoiceButton();this._view.showSeeLessDetails(this._hasMultipleLineItems());this._view.setLineItemsVisibility(false)},initializeInDOM:function(){this._setupLineItems()},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.Paywall.InvoiceView")},_setupLineItems:function(){var e=this;t.each(this._invoice.lines.data.slice(0,1),function(t){e._addInvoiceLineItem(t,{isHeader:true})});t.each(this._invoice.lines.data.slice(1),function(t){e._addInvoiceLineItem(t,{isHeader:false})})},_setupSeeDetailsButton:function(){if(!this._seeDetailsButton){var e=this;this._seeDetailsButton=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:o.getString("see_details"),color:"blue",onFunction:function(){e._seeDetailsButtonPressed();a.Tracker.track("display invoice details")}})}this._view.setSeeDetailsButton(this._seeDetailsButton)},_setupHideDetailsButton:function(){if(!this._hideDetailsButton){var e=this;this._hideDetailsButton=a.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:o.getString("hide_details"),color:"blue",onFunction:function(){e._hideDetailsButtonPressed()}})}},_setupEmailInvoiceButton:function(){if(!this._emailInvoiceButton&&this._invoice&&this._invoice.id){this._emailInvoiceButton=i.getInstance("BentoBox.Widgets.EmailInvoiceButtonController",this._invoice.id)}this._view.setEmailInvoiceButton(this._emailInvoiceButton.getButton())},_seeDetailsButtonPressed:function(){this._view.setSeeDetailsButton(this._hideDetailsButton);this._view.setLineItemsVisibility(true)},_hideDetailsButtonPressed:function(){this._view.setSeeDetailsButton(this._seeDetailsButton);this._view.setLineItemsVisibility(false)},_setupHeaderRow:function(){var e;if(this._hasMultipleLineItems()){this._view.setUsers(o.getString("invoice_multiple_users"));this._view.setPlan(o.getString("invoice_multiple_plans"));this._view.setDateRange(this.getDateRange());e=o.getString('<span class="streak__actualCost"><afterDiscount></span>',{afterDiscount:this.getAmountAfterDiscount()});this._view.setCost(e)}else{var t;if(this._invoice&&this._invoice.lines&&this._invoice.lines.data&&this._invoice.lines.data.length>0){t=this._invoice.lines.data[0]}else{return}this._view.setUsers(o.getString("invoice_users",{users:t.quantity}));if(t.plan&&t.plan.name){var n=t.plan.name;this._view.setPlan(n)}this._view.setDateRange(this.getDateRange());if(!this.hasDiscount()){e=o.getString('<span class="streak__actualCost"><afterDiscount></span>',{afterDiscount:this.getAmountAfterDiscount()});this._view.setCost(e)}else{var i=this.getAmountBeforeDiscount();var r=this.getDiscountPercentage();var a=this.getAmountAfterDiscount();e=o.getString('<span class="streak__originalCost"><beforeDiscount></span> <span class="streak__actualCost"><afterDiscount></span> (<discountPercentage>% discount)',{beforeDiscount:i,discountPercentage:r,afterDiscount:a});this._view.setCost(e)}}},getStartDate:function(){if(this._invoice&&this._invoice.periodStart){return new n(this._invoice.periodStart*1e3)}return null},getEndDate:function(){if(this._invoice&&this._invoice.lines){var e=t.last(this._invoice.lines.data);return n.create(e.period.end*1e3)}return null},getDateRange:function(){var e=i.get("BentoBox.Modules.Paywall.InvoiceUtils");var t=this.getStartDate();var n=this.getEndDate();return e.displayDateRange(t,n)},hasDiscount:function(){return this._invoice&&this._invoice.discount},getAmountBeforeDiscount:function(){var e=i.get("BentoBox.Modules.Paywall.InvoiceUtils");if(this._invoice.subtotal){return e.displayStripeCurrency(this._invoice.subtotal,this._invoice.currency||"usd")}return""},getAmountAfterDiscount:function(){var e=i.get("BentoBox.Modules.Paywall.InvoiceUtils");if(this._invoice.total){return e.displayStripeCurrency(this._invoice.total,this._invoice.currency||"usd")}return""},getDiscountPercentage:function(){if(this._invoice&&this._invoice.discount&&this._invoice.discount.coupon){return this._invoice.discount.coupon.percentOff}return null},_hasMultipleLineItems:function(){return this._invoice.lines.data.length>1},_addInvoiceLineItem:function(e,t){var n=i.getInstance("BentoBox.Modules.Paywall.InvoiceLineItemViewController",e,t);this._lineItemViewControllers.push(n);this._view.addInvoiceLineItem(n.getView())}});i.set("BentoBox.Modules.Paywall.InvoiceViewController",l)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"InvoiceCollectionView",superclass:a,_memberVariables:[],_initialize:function(){a.prototype._initialize.call(this)},_setupElement:function(){this._element=t(i.getElement("streak__invoice_collection_view"))},addInvoice:function(e){this._element.append(e.getElement())},removeAllInvoices:function(){this._element.find(".streak__invoice").remove()}});n.set("BentoBox.Modules.Paywall.InvoiceCollectionView",o)})(Streak);(function(e){var t=e._,n=e.Library,i=e.UI;var r=i.ViewController;var a=e.Class.subclass({className:"InvoiceCollectionViewController",superclass:r,_memberVariables:[{name:"_invoices",destroy:false},{name:"_invoiceViewControllers",destroy:true}],_initialize:function(){r.prototype._initialize.call(this);this._invoices=[];this._invoiceViewControllers=[];this.refresh()},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.InvoiceCollectionView")},refresh:function(){e.APIRequester.get("users/me/invoices").getPromise().then(this._invoicesChanged.bind(this))},_addInvoices:function(e){t.each(e,this._addInvoice.bind(this))},_addInvoice:function(e){if(e.paid||t.all(e.lines.data,"paid")){var i=n.getInstance("BentoBox.Modules.Paywall.InvoiceViewController",e);this._invoiceViewControllers.push(i);this._view.addInvoice(i.getView());i.initializeInDOM()}},_invoicesChanged:function(e){this._invoices=e;this._removeAllInvoices();this._addInvoices(e);var t=e&&e.length>0;this._callDelegateFunction("invoicesPresent",t)},_removeAllInvoices:function(){this._view.removeAllInvoices()}});n.set("BentoBox.Modules.Paywall.InvoiceCollectionViewController",a)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"InvoiceLineItemView",superclass:a,_memberVariables:[{name:"_amount",destroy:true},{name:"_users",destroy:true},{name:"_description",destroy:true},{name:"_dateRange",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._amount=this._element.find(".streak__invoice_amount");this._users=this._element.find(".streak__invoice_users");this._description=this._element.find(".streak__invoice_description");this._dateRange=this._element.find(".streak__invoice_date_range")},_setupElement:function(){this._element=t(i.getElement("streak__invoice_line_item_view"))},setDescription:function(e){this._description.html(e)},setDateRange:function(e){this._dateRange.html(e)},setAmount:function(e){this._amount.html(e)},setUsers:function(e){this._users.html(e)}});n.set("BentoBox.Modules.Paywall.InvoiceLineItemView",o)})(Streak);(function(e){var t=e._,n=e.Library,i=e.Date,r=e.UI,a=e.BentoBox.Locale;var o=r.ViewController;var s=e.Class.subclass({className:"InvoiceLineItemViewController",superclass:o,_memberVariables:[],_initialize:function(e,n){o.prototype._initialize.call(this);n=n||{};t.defaults(n,{isHeader:true});this._lineItem=e;this._view.setDescription(this.getDescription());this._view.setDateRange(this.getDateRange());this._view.setAmount(a.getString('<span class="streak__actualCost"><afterDiscount></span>',{afterDiscount:this.getAmount()}));var i=this.getUsers();if(i){this._view.setUsers(a.getString("invoice_users",{users:i}))}},_setupView:function(){this._view=n.getInstance("BentoBox.Modules.Paywall.InvoiceLineItemView")},getDescription:function(){if(this._lineItem&&this._lineItem.description){return this._lineItem.description}else if(this._lineItem&&this._lineItem.quantity&&this._lineItem.plan){var e=n.get("BentoBox.Modules.Paywall.InvoiceUtils");var t=e.displayStripeCurrency(this._lineItem.plan.amount,this._lineItem.plan.currency||"usd");var i=a.getString("subscription_to_plan_description",{users:this._lineItem.quantity,plan:this._lineItem.plan.name,amount:t});return i}return""},getStartDate:function(){if(this._lineItem&&this._lineItem.period&&this._lineItem.period.start){return new i(this._lineItem.period.start*1e3)}return null},getEndDate:function(){if(this._lineItem&&this._lineItem.period&&this._lineItem.period.end){return new i(this._lineItem.period.end*1e3)}return null},getDateRange:function(){var e=n.get("BentoBox.Modules.Paywall.InvoiceUtils");var t=this.getStartDate();var i=this.getEndDate();return e.displayDateRange(t,i)},getAmount:function(){var e=n.get("BentoBox.Modules.Paywall.InvoiceUtils");if(this._lineItem.amount){return e.displayStripeCurrency(this._lineItem.amount,this._lineItem.currency||"usd")}return""},getUsers:function(){if(!this.isHeader){return""}else if(this._lineItem.quantity){return this._lineItem.quantity}return""}});n.set("BentoBox.Modules.Paywall.InvoiceLineItemViewController",s)})(Streak);(function(e){var t=e.Library,n=e.BentoBox;var i={displayStripeCurrency:function(e,t){if(t!=="usd"){n.logError("Currency from Stripe was not in USD");return e+" "+t}var i=e;var r=i/100;return"$"+r},displayDateRange:function(e,t){if(e)e=e.customFormat("shortDate");if(t)t=t.customFormat("shortDate");if(e&&t){return e+" - "+t}else if(e&&!t){return e+" - "}else if(!e&&t){return" - "+t}else if(!e&&!t){return""}}};n.Modules.Paywall=n.Modules.Paywall||{};n.Modules.Paywall.InvoiceUtils=i;t.set("BentoBox.Modules.Paywall.InvoiceUtils",i)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=i.get("Operations.AjaxRequestOperation");var h=e.Class.subclass({className:"EmailInvoiceOperation",superclass:d,_memberVariables:[],_initialize:function(e){d.prototype._initialize.call(this,{url:"users/me/invoices/"+e.invoiceId+"/email",method:"POST",params:{json:""},tags:["emailInvoice"],dependentTags:[]})}});i.set("BentoBox.Modules.Paywall.EmailInvoiceOperation",h)})(Streak);(function(e){var t=e.BentoBox,n=e.HTML,i=e.BentoBox.Modules.Reports,r=e.UI;var a=r.View;i.DealSizeSelectionMenuView=e.Class.subclass({className:"DealSizeSelectionMenuView",superclass:a,memberVariables:[{name:"_dropdown",destroy:false}],_initialize:function(){a.prototype._initialize.call(this);this._dropdown=this._element.find(".streak__reports_deal_size_dropdown")},_setupElement:function(){this._element=n.getElement("streak__reports_deal_size_selection_menu")},setDropdown:function(e){var t=e.getElement();t.addClass("streak__reports_deal_size_dropdown");this._dropdown.html(t)}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.UI,r=e.HTML,a=e.BentoBox.Modules.Reports,o=e.BentoBox.Tracker;var s=i.ViewController;a.DealSizeSelectionMenuViewController=e.Class.subclass({className:"DealSizeSelectionMenuViewController",superclass:s,memberVariables:[{name:"_confirmButton",destroy:false},{name:"_columns",destroy:false},{name:"_dealSizeColumnMenu",destroy:false},{name:"_dataSource",destroy:false},{name:"_trackingContext",destroy:false}],_initialize:function(){s.prototype._initialize.call(this);this._setupTrackingContext()},_setupView:function(){this._view=new a.DealSizeSelectionMenuView},setColumns:function(e){this._columns=[this.getDefaultColumn()].concat(t.map(e,function(e){return{name:e.name,value:e}}));this._setupDealSizeColumn()},getDefaultColumn:function(){return{name:"No Column",value:null}},_setupDealSizeColumn:function(){var e=this;this._dealSizeColumnMenu=n.Widgets.ButtonCustomDropdown.create({trackingContext:t.clone(this._trackingContext),list:this._columns,changeFunc:function(t){e.dealSizeColumnChanged(t.value);o.trackStreakActive(e._trackingContext,{eventName:"dealSizeColumnMenuChanged"})},comparisonFunction:function(e,n){if(t.isNotReal(e)){return t.isNotReal(n)}if(t.isNotReal(n)){return false}return e.value.columnKey===n.value.columnKey},hasButtonToRight:true});this._view.setDropdown(this._dealSizeColumnMenu)},setDataSource:function(e){this._dataSource=e},save:function(){this._callDelegateFunction("confirmButtonPressed")},dealSizeColumnChanged:function(e){this._callDelegateFunction("dealSizeColumnChanged",e)},setSelectedDealSizeColumn:function(e){this._dealSizeColumnMenu.setSelected(e)},getSelectedDealSizeColumn:function(){return this._dealSizeColumnMenu.getSelected()},_setupTrackingContext:function(){this._trackingContext={widgetContext:"reportCard"}}})})(Streak);(function(e){var t=e.$,n=e.BentoBox,i=e.HTML,r=e.Locale,a=e.BentoBox.Modules.Reports,o=e.UI;var s=a.ReportCards.ReportCardView;a.ReportCards.DealSizeBasedReportCardView=e.Class.subclass({superclass:s,memberVariables:[{name:"_bottomView",destroy:false},{name:"_topView",destroy:false},{name:"_transparent",destroy:false}],_initialize:function(){s.prototype._initialize.call(this);this._topView=this._element.find(".streak__reports_top_view");this._bottomView=this._element.find(".streak__reports_bottom_view")},_setupElement:function(){this._reportCard=i.getElement("streak__reportCard");this._element=i.getElement("streak_dealSizeBasedReportCard");this._element.find(".streak__reports_bottom_view").append(this._reportCard);this._element.find("* .streak__reportCard").removeClass("streak__reportCard")},hideTopView:function(){this._topView.hide();this._bottomView.fadeTo("fast",1)},showTopView:function(){this._topView.show();this._bottomView.fadeTo("fast",.2)},setTopView:function(e){this._topView.html(e.getElement())}})})(Streak);(function(e){var t=e._,n=e.UI,i=e.Locale,r=e.BentoBox,a=e.BentoBox.Tracker,o=e.BentoBox.Modules.Reports,s=e.NotificationCenter;var l=o.ReportCardViewController;o.ReportCards.DealSizeBasedReportCardViewController=e.Class.subclass({superclass:l,memberVariables:[{name:"_configureWarning",destroy:true},{name:"_dealSizeColumnKey",destroy:false},{name:"_dealSizeSelectionMenuViewController",destroy:true},{name:"_mainBodyViewController",destroy:true},{name:"_pipelineSettingListenUnbinder",destroy:true},{name:"_possibleDealsizeColumns",destroy:false},{name:"_reportRealBodyView",destroy:false},{name:"_yellowConfigureBarViewController",destroy:true}],_initialize:function(){l.prototype._initialize.call(this);this._setupValueColumnSelection();this._setupConfigureWarning();this._view.setTitle(this.getTitle());this.showDealSizeSelectionView();this._setupXButton()},setPipeline:function(e){l.prototype.setPipeline.call(this,e);this._possibleDealsizeColumns=o.Utils.possibleDealsizeColumns(this._pipeline,r.UI.getPipelineColumnList(this._pipeline,null,true));this._dealSizeSelectionMenuViewController.setColumns(this._possibleDealsizeColumns);s.unsubscribe({observer:this});s.subscribe({eventName:"pipelineReportSettings.changed",filterParameters:{pipelineKey:e.key()},functionToCall:this.pipelineSettingsUpdated,observer:this});this.pipelineSettingsUpdated()},destroy:function(){l.prototype._initialize.call(this);if(this._pipelineSettingListenUnbinder){this._pipelineSettingListenUnbinder()}},_setupView:function(){this._view=new o.ReportCards.DealSizeBasedReportCardView},_setupValueColumnSelection:function(){this._dealSizeSelectionMenuViewController=new o.DealSizeSelectionMenuViewController;this._dealSizeSelectionMenuViewController.addDelegate(this)},_setupConfigureWarning:function(){this._yellowConfigureBarViewController=new o.YellowConfigureBarViewController;this._yellowConfigureBarViewController.setConfigureViewController(this._dealSizeSelectionMenuViewController);this._view.setTopView(this._yellowConfigureBarViewController.getView())},showMainView:function(){this._view.hideTopView();this._view.hideMessage();this._view.showMenus()},showDealSizeSelectionView:function(){this._view.showTopView();this._view.hideMessage();this._view.hideMenus()},_setupXButton:function(){if(!this._xButton){this._xButton=this._createXButton();this._view.addMenu({view:this._xButton,position:1})}},_createXButton:function(){var e=this;var t=r.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:"X",onFunction:function(){e.xButtonPressed()}});return t},setGlobalDealSizeColumnKey:function(e){if(this._pipeline){this._pipeline.setUISettings("reporting/dealSizeColumn",e)}},getGlobalDealSizeColumnKey:function(){if(this._pipeline){return this._pipeline.getUISettingsByPath("reporting/dealSizeColumn")}},confirmButtonPressed:function(){this.setGlobalDealSizeColumnKey(this._dealSizeColumnKey);this._inColumnSelectionMenu=this._dealSizeColumnKey===null;this.updateMode()},dealSizeColumnChanged:function(e){this._dealSizeColumnKey=e?e.value.columnKey:null},xButtonPressed:function(){if(this._pipeline){this._pipeline.setUISettings("reporting/dealSizeColumn",null)}},updateMode:function(){if(this._inColumnSelectionMenu){this.showDealSizeSelectionView()}else{if(this._dealSizeColumnKey===null){}else{this.showMainView()}}},pipelineSettingsUpdated:function(){var e=this.getGlobalDealSizeColumnKey();var t;if(e){t=this._allColumns[e]}else{t=o.Utils.guessDealsizeColumn(this._possibleDealsizeColumns);if(!t&&this._possibleDealsizeColumns.length>0){t=this._possibleDealsizeColumns[0]}}this._dealSizeSelectionMenuViewController.setSelectedDealSizeColumn(t);var n=this._dealSizeSelectionMenuViewController.getSelectedDealSizeColumn();this._dealSizeColumnKey=n.value?n.value.value.columnKey:null;this._inColumnSelectionMenu=!e;this.updateMode()}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Data,r=e.Locale,a=e.BentoBox.Modules.Reports,o=e.BentoBox.Tracker,s=e.UI;var l=a.ReportCards.DealSizeBasedReportCardViewController;a.ReportCards.TotalValueByPersonReportCardViewController=e.Class.subclass({className:"TotalValueByPersonReportCardViewController",superclass:l,memberVariables:[{name:"_totalMoney",destroy:true}],_initialize:function(){l.prototype._initialize.call(this);this._setupFakeData();this._configureChartView()},_configureChartView:function(){var e=new s.ChartViewController;var t=s.ChartFactory.createChart({type:"RING_CHART",height:300,chartArea:{width:"70%",height:"90%"},pieSliceText:"value",sliceVisibilityThreshold:1/72,pieHole:.5});this._chartView=t;e.setView(t);e.setDataSource(this);this.setBodyChartViewController(e);this._view.setBody(t)},getTitle:function(){return r.getString("report_title_total_value_by_person")},getChartData:function(){if(this._pipeline&&this.getGlobalDealSizeColumnKey()!==null){return this._data}else{return this._fakeData}},_updateChartData:function(){var e=this._columns[this.getGlobalDealSizeColumnKey()];var n=[this._getHeaders()];if(!e){return n}var r=i.getPipelineBoxes(this._pipeline.key());var o=this._columns[a.Utils.getAssignedToColumnKeyForPipeline(this._pipeline)];var s=this._pipeline;var l=this.getSelectedStageKeys();if(l){r=t.filter(r,function(e){var n=e.get("stageKey");return t.contains(l,n)})}var u=a.Utils.sumWithSplitCredit(r,{valueBy:function(t){return a.Utils.unformatCurrency(a.Utils.getBoxValueForColumn({box:t,column:e,pipeline:s}))||0},groupBy:function(e){return a.Utils.getBoxValueForColumn({box:e,column:o,pipeline:s})}});t.each(u,function(t,i){var r=a.Utils.getBoxValueDisplayText({column:e,key:i,pipeline:s});if(r==="No Value"){r="Not Assigned"}n.push([r,t])});var c=t.chain(r).map(function(t){return a.Utils.unformatCurrency(a.Utils.getBoxValueForColumn({box:t,column:e,pipeline:s}))||0}).value().sum();this.setTotalMoney(c);n=google.visualization.arrayToDataTable(n);var d=new google.visualization.NumberFormat({prefix:"$",negativeColor:"red",negativeParens:true});d.format(n,1);this._data=n;return this._data},_getHeaders:function(){return["Value","Value"]},setTotalMoney:function(e){this._totalMoney=e;this._chartView.setCenterLabelValue(a.Utils.formatCurrency(this._totalMoney));this._chartView.setCenterLabelUnit(null)},setPipeline:function(e){l.prototype.setPipeline.call(this,e);this._updateChartData();this._callDelegateFunction("handleDataUpdated")},pipelineSettingsUpdated:function(e){l.prototype.pipelineSettingsUpdated.call(this,e);this._updateChartData();this._callDelegateFunction("handleDataUpdated")},stageKeysSelectionChanged:function(e){l.prototype.stageKeysSelectionChanged.call(this,e);this._updateChartData();this._callDelegateFunction("handleDataUpdated")},_setupFakeData:function(){this._fakeData=[["",""],["Foo",1/6],["Bar",1/3],["Baz",1/2]];this._totalMoney=null},_hasStageMultipleSelectMenu:function(){return true}})})(Streak);(function(e){var t=e._,n=e.BentoBox,i=e.BentoBox.Data,r=e.Locale,a=e.BentoBox.Modules.Reports,o=e.BentoBox.Tracker,s=e.UI;var l=a.ReportCards.DealSizeBasedReportCardViewController;a.ReportCards.TotalValueReportCardViewController=e.Class.subclass({className:"TotalValueReportCardViewController",superclass:l,memberVariables:[{name:"_chartViewController",destroy:false}],_initialize:function(){l.prototype._initialize.call(this);this._setupFakeData();this._setupChartViewController()},getTitle:function(){return r.getString("report_title_total_value")},getChartData:function(){if(this._pipeline&&this.getGlobalDealSizeColumnKey()!==null){return this._data}else{return this._fakeData}},_setupChartViewController:function(){this._chartViewController=new s.ViewController;this._chartViewController.getView().addClass("streak__reports_total_value_report_dollar_amount");this.setBodyChartViewController(this._chartViewController);this._view.setBody(this._chartViewController.getView())},_updateChartData:function(){var e=this._columns[this.getGlobalDealSizeColumnKey()];if(!e){return this._fakeData}var n=i.getPipelineBoxes(this._pipeline.key());var r=this._pipeline;var o=this.getSelectedStageKeys();if(o&&t.contains(o,a.Constants.ALL_STAGES)){}else if(o){n=t.filter(n,function(e){var n=e.get("stageKey");return t.contains(o,n)})}var s=t.chain(n).map(function(t){return a.Utils.unformatCurrency(a.Utils.getBoxValueForColumn({box:t,column:e,pipeline:r}))||0}).value().sum();this._data=s;return this._data},_updateView:function(){this._chartViewController.getView().getElement().html(a.Utils.formatCurrency(this.getChartData()))},_getHeaders:function(){return["Value","Value"]},setPipeline:function(e){l.prototype.setPipeline.call(this,e);this._updateChartData();this._updateView()},pipelineSettingsUpdated:function(e){l.prototype.pipelineSettingsUpdated.call(this,e);this._updateChartData();this._updateView()},stageKeysSelectionChanged:function(e){l.prototype.stageKeysSelectionChanged.call(this,e);this._updateChartData();this._updateView()},_setupFakeData:function(){this._fakeData="?"},_hasStageMultipleSelectMenu:function(){return true}})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=function(e){c.Modules.Tours.ExtendedTour.call(this,e);this._composeWindowViewController=null;this._searchValue=null;this._shareModal=i.getInstance("BentoBox.Modules.PixelTrackingShareModalViewController")};d.prototype=Object.create(c.Modules.Tours.ExtendedTour.prototype);n.extend(d.prototype,{openComposeWindow:function(e){var t=this;r.GmailComposeWindowRequester.requestNewComposeWindow(function(n){t._composeWindowViewController=n;e()})},openComposeToolbarOverflow:function(e){var t=this;r.GmailComposeWindowRequester.requestNewComposeWindow(function(n){t._composeWindowViewController=n;t._composeWindowViewController.openComposeToolbarOverflow().then(e)})},closeComposeWindow:function(){if(!this._composeWindowViewController.isDestroyed()){try{this._composeWindowViewController.close()}catch(e){}}},ensureTrackedSearchLinkVisible:function(e){r.inboxSDK.NavMenu.SENT_MAIL.setCollapsed(false);setTimeout(function(){e()},100)},showHasTrackingInSearch:function(e){this._searchValue=r.getSearchInput().val();r.getSearchInput().val("has:tracking");e()},restoreSearch:function(){r.getSearchInput().val(this._searchValue)},showPixelTrackingShareModal:function(e){this._shareModal.show(function(){e.next()})},setDefaultTrackingStatusOn:function(){this._setDefaultTrackingStatus("enabled")},setDefaultTrackingStatusOff:function(){this._setDefaultTrackingStatus("disabled")},_setDefaultTrackingStatus:function(e){c.Data.streakSettings.setSettingValue("tracking_default_on_setting",[e]);this.exit();l.postNotification({eventName:"defaultTrackingSettingChanged",sender:this})}});i.set("BentoBox.Modules.Tours.PixelTrackingTour",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.ViewController,_memberVariables:[{name:"_doneButton",destroy:false},{name:"_contactsChooserViewController",destroy:true},{name:"_emailBodyTextarea",destroy:true},{name:"_selectedContacts",destroy:false},{name:"_doneCallback",destroy:false}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.PixelTrackingShareModalView");this._setupElements()},_setupElements:function(){this._setupContactsChooser();this._setupEmailBody();this._setupModal()},_setupContactsChooser:function(){this._contactsChooserViewController=i.getInstance("BentoBox.Widgets.ContactsChooserViewController");this._contactsChooserViewController.addDelegate(this);this._view.setContactsChooserView(this._contactsChooserViewController.getView())},_setupEmailBody:function(){this._emailBodyTextarea=i.getInstance("BentoBox.Widgets.GmailTextareaViewController",{plainTextOnly:false});this._view.setEmailBodyView(this._emailBodyTextarea.getView());this._emailBodyTextarea.setHTML("Hey there, <br><br>I just started using Streak's awesome extension for tracking emails. It lets you know when people open the emails you send. I'm using it and you should too! <a href=\"https://www.streak.com/email-tracking-in-gmail\">Download it here.</a>")},_setupModal:function(){var e=this;this._view.setupModal(n.bind(this._sendEmails,this),n.bind(this._cancel,this))},_cancel:function(){this._doneCallback()},_sendEmails:function(){this._view.showSending();var e=this._createEmailPackages();var t=e.length;var n=this;c.Services.PixelTrackingLimiter.registerInvitesSent(this._getSelectedEmailAddresses());c.MailHelper.sendMultipleEmails({emailPackages:e,finishedSendingCallback:function(){n._doneCallback();n.destroy()}});c.Tracker.track("sharing pixel tracking",{numberOfEmails:t});n._view.hideModalButtons();return true},_getSelectedEmailAddresses:function(){return n.pluck(this._selectedContacts,"email")},_createEmailPackages:function(){var e=this._emailBodyTextarea.getHTML();return n.map(this._selectedContacts,function(t){return{toAddresses:[t.email],body:e,subject:"Try out Streak's Email Tracking extension!"}})},selectedContactsChanged:function(e){this._selectedContacts=e;if(e.length>=5){this._doneButton.enable()}else{this._doneButton.disable()}},show:function(e){this._doneCallback=e;this._doneButton=this._view.show();this._doneButton.disable();c.Tracker.track("share pixel tracking prompt")}});i.set("BentoBox.Modules.PixelTrackingShareModalViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[{name:"_modal",destroy:true},{name:"_doneButton",destroy:false},{name:"_cancelButton",destroy:false}],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.getElement("pixelTrackingShareModal");this._element.find(".streak__pixelTrackingShareModal_setup").show();this._element.find(".streak__pixelTrackingShareModal_sending").hide()},setupModal:function(e,t){this._modal=c.Widgets.Modal.create({title:"Unlock Unlimited Email Tracking",inner:this._element,confirmFunc:e,confirmText:"Unlock Unlimited",cancelFunc:t,width:"510px"})},setContactsChooserView:function(e){this._element.find(".streak__pixelTrackingShareModal_chooseContacts").html(e.getElement())},setEmailBodyView:function(e){this._element.find(".streak__pixelTrackingShareModal_emailBodyInput").html(e.getElement())},show:function(){this._modal.show();return this._modal.getOkButton()},showSending:function(){this._element.find(".streak__pixelTrackingShareModal_setup").hide();
this._element.find(".streak__pixelTrackingShareModal_sending").show()},hideModalButtons:function(){this._modal.getOkButton().getElement().hide();this._modal.getCancelButton().getElement().hide()}});i.set("BentoBox.Modules.PixelTrackingShareModalView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=o.getElement("contactsChooserContact")},setContent:function(e,n,i){var r=t(c.Contacts.suggestionTemplate({image:e,name:n,tag:i})).children().unwrap();this._element.find(".aclRowContent").append(r)},setCheckbox:function(e){this._element.find(".selectionCheckbox").html(e)},setChecked:function(e){this._element.toggleClass("bbChecked",e)}});i.set("BentoBox.Widgets.ContactsChooserEntryView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.ViewController,_memberVariables:[{name:"_checkbox",destroy:true},{name:"_person",destroy:false,get:true}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.ContactsChooserEntryView");this._setupCheckbox();this._bindEvents()},_setupCheckbox:function(){this._checkbox=r.widgets.getCheckbox("");this._view.setCheckbox(this._checkbox);var e=this;this._checkbox.bind("change",function(){e._view.setChecked(e.isChecked());e._callDelegateFunction("entryCheckStateChanged")})},_bindEvents:function(){var e=this;this._view.getElement().on("click",function(){e._checkbox.click()})},setChecked:function(e){this._checkbox.setChecked(e);this._view.setChecked(e)},isChecked:function(){return this._checkbox.isChecked()},setPerson:function(e){var t=e.imageUrl;var n=e.fullName||e.email;var i=e.fullName?e.email:"&nbsp;";this._view.setContent(t,n,i);this._person=e}});i.set("BentoBox.Widgets.ContactsChooserEntryViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=o.getElement("contactsChooser")},showIndexingMessage:function(){this._element.find(".streak__contactsChooser_list").hide();this._element.find(".streak__contactsChooser_indexing").show();this._element.find(".streak__contactsChooser_noContacts").hide()},showNoContacts:function(){this._element.find(".streak__contactsChooser_list").hide();this._element.find(".streak__contactsChooser_indexing").hide();this._element.find(".streak__contactsChooser_noContacts").show()},addContactEntryView:function(e,t){this._element.find(".streak__contactsChooser_list").show();this._element.find(".streak__contactsChooser_indexing").fastHide();this._element.find(".streak__contactsChooser_noContacts").fastHide();var n="append";if(t){n="prepend"}this._element.find(".streak__contactsChooser_list")[n](e.getElement())},setPersonPickerView:function(e){this._element.find(".streak__contactsChooser_input").append(e.getElement())},setAddButtonView:function(e){this._element.find(".streak__contactsChooser_input").append(e.getElement())}});i.set("BentoBox.Widgets.ContactsChooserView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({superclass:e.UI.ViewController,_memberVariables:[{name:"_personPicker",destroy:true},{name:"_addPersonButton",destroy:true},{name:"_excludedPeople",destroy:true},{name:"_contactEntryViewControllers",destroy:true},{name:"_contactsRequestFunction",destroy:true}],_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.ContactsChooserView")},_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._contactEntryViewControllers=[];this._excludedPeople=[];this._contactsRequestFunction=t||"getTopContactsNotInStreak";this._view.showIndexingMessage();this._setupPersonPicker();this._setupAddPersonButton();this._setupTopContacts()},_setupPersonPicker:function(){var e=this;this._personPicker=c.Widgets.PersonPicker.create({selectFunc:function(t){e._renderContact(t,true);e.entryCheckStateChanged()},allowName:false});this._view.setPersonPickerView(this._personPicker)},_setupAddPersonButton:function(){var e=this;this._addPersonButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:c.Locale.getString("add"),onFunction:function(){e._personPicker.selectItem()}});this._view.setAddButtonView(this._addPersonButton)},_setupTopContacts:function(){var e=this;c.Contacts[this._contactsRequestFunction](50).then(function(t){t=t||[];if(t.length===0){e._view.showNoContacts()}else{n(t).chain().filter(function(e){return e.email!==c.getUser().get("email")&&e.fullName!==e.email}).each(function(t){e._renderContact(t,false)})}})},_renderContact:function(e,t){var n=i.getInstance("BentoBox.Widgets.ContactsChooserEntryViewController");n.setPerson(e);n.setChecked(t);n.addDelegate(this);this._view.addContactEntryView(n.getView(),t);this._contactEntryViewControllers.push(n);this._excludedPeople.push(e.email);this._updateExcludedPeople()},_updateExcludedPeople:function(){this._personPicker.setExcluded(this._excludedPeople)},entryCheckStateChanged:function(){this._callDelegateFunction("selectedContactsChanged",this.getSelectedContacts())},getSelectedContacts:function(){return n.chain(this._contactEntryViewControllers).filter(function(e){return e.isChecked()}).map(function(e){return e.getPerson()}).value()}});i.set("BentoBox.Widgets.ContactsChooserViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d;var h=e.Class.subclass({className:"RapportiveSidebarViewController",superclass:s.ViewController,_memberVariables:[{name:"_contentPanelView",destroy:true}],_initialize:function(e){s.ViewController.prototype._initialize.call(this);var t=document.createElement("div");t.style.display="none";this._contentPanelView=e.addSidebarContentPanel({title:"rapportive",orderHint:3,iconClass:"streak__rapportive_icon",el:t});this._contentPanelView.on("activate",this._removeHideRapportiveCSSRule);this._contentPanelView.on("deactivate",this._addHideRapportiveCSSRule);e.on("destroy",this.destroy.bind(this))},_addHideRapportiveCSSRule:function(){if(d){return}d=e.CSSStyleManipulator.addRule("#rapportive-sidebar {visibility: hidden;}")},_removeHideRapportiveCSSRule:function(){if(d){d.destroy();d=null}},destroy:function(){if(d){d.destroy();d=null}s.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Modules.RapportiveSidebarViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SearchableListViewController",superclass:s.ViewController,_memberVariables:[{name:"_dataSource",destroy:false,set:true},{name:"_searchViewController",destroy:true},{name:"_listViewController",destroy:true},{name:"_visibleSectionsAndRows",destroy:true},{name:"_shouldLockSelection",destroy:false,set:true},{name:"_emptyViewMessage",destroy:true,set:true,get:true},{name:"_noSearchResults",destroy:true}],_initialize:function(){s.ViewController.prototype._initialize.call(this);this._shouldLockSelection=true;this._view.addClass("streak__searchableList");this._visibleSectionsAndRows=[];this._setupSearchController();this._setupListController();this._searchViewController.addDelegate(this._listViewController)},_setupSearchController:function(){this._searchViewController=new c.Widgets.SearchSimpleVC;this._searchViewController.addDelegate(this);this._view.addSubView(this._searchViewController.getView())},_setupListController:function(){this._listViewController=new c.Widgets.ListView.ListViewViewController;this._listViewController.addDelegate(this);this.addDelegate(this._listViewController);this._view.addSubView(this._listViewController.getView())},setPlaceholder:function(e){this._searchViewController.setPlaceholder(e)},setDataSource:function(e){this._dataSource=e;this._listViewController.setDataSource(this);this.queryChange()},_setupVisibleSectionsAndRows:function(){var e=this._searchViewController.getQuery().toLowerCase();this._visibleSectionsAndRows.length=0;var t=this._dataSource.getNumberOfSections();for(var n=0;n<t;n++){var i=this._dataSource.getNumberOfRows(n);var r=[];for(var a=0;a<i;a++){var o=this._dataSource.getRowSearchString(n,a);if(this._doesQueryMatchSearchString(e,o)){r.push(a)}}if(r.length>0){this._addVisibleSection(n,r)}}this._noSearchResults=this._visibleSectionsAndRows.length===0;if(this._noSearchResults&&!!this._emptyViewMessage){this._addVisibleSection(0,[])}},_doesQueryMatchSearchString:function(e,t){return!e||t&&t.toLowerCase().indexOf(e)>-1},_addVisibleSection:function(e,t){this._visibleSectionsAndRows.push({sectionIndex:e,matchingRowIndexes:t})},getSearchInputViewController:function(){return this._searchViewController},numberOfSections:function(){return this._visibleSectionsAndRows.length},sectionShouldShow:function(e){return true},numberOfRowsForSection:function(e){if(e<0){return 0}var t=this._visibleSectionsAndRows[e];return t.matchingRowIndexes.length},infoForRow:function(e,t){var n=this._visibleSectionsAndRows[e];var i=n.sectionIndex;var r=n.matchingRowIndexes[t];return this._dataSource.getRowData(i,r)},sectionTitle:function(e){var t=this._visibleSectionsAndRows[e];return this._dataSource.getSectionTitle(t.sectionIndex)},sectionAfterTitleIconClass:function(e){var t=this._visibleSectionsAndRows[e];if(this._dataSource.getSectionAfterTitleIconClass){return this._dataSource.getSectionAfterTitleIconClass(t.sectionIndex)}return null},doesSectionToggle:function(){return true},focus:function(){this._searchViewController.focus()},reset:function(){this._listViewController.reset()},dataUpdated:function(){this.queryChange()},rowFocused:function(e){this._callDelegateFunction("rowHighlighted",e);this._eventStream.push({eventName:"rowHighlighted",rowData:e})},rowPressed:function(e){this._callDelegateFunction("rowSelected",e);this._eventStream.push({eventName:"rowSelected",rowData:e});if(!this._shouldLockSelection){this._listViewController.reset()}},dontHighlightOnDataChange:function(){if(this._dataSource&&this._dataSource.dontHighlightOnDataChange){return this._dataSource.dontHighlightOnDataChange()}return false},queryChange:function(){this._setupVisibleSectionsAndRows();this._callDelegateFunction("dataChanged");this._eventStream.push({eventName:"dataChanged"});this._callDelegateFunction("queryChange",this._searchViewController.getQuery());this._eventStream.push({eventName:"queryChange",query:this._searchViewController.getQuery()})},keydown:function(e){this._callDelegateFunction("keydown",e);this._eventStream.push({eventName:"keydown",event:e})},isSectionFreeForm:function(e){return!!this._emptyViewMessage&&this._noSearchResults},getSectionFreeFormElement:function(e){return this._emptyViewMessage.clone(true)},getScrollPosition:function(){return this._listViewController.getScrollPosition()},setScrollPosition:function(e){this._listViewController.setScrollPosition(e)},dontHighlightOnDataChange:function(){return this._dataSource&&this._dataSource.dontHighlightOnDataChange&&this._dataSource.dontHighlightOnDataChange()},clearQuery:function(){this._searchViewController.clearQuery()},getSearchText:function(){return this._searchViewController.getQuery()},setSearchText:function(e){this._searchViewController.setQuery(e)}});i.set("BentoBox.Widgets.SearchableListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"NoticeView",superclass:s.View,_memberVariables:[{name:"_innerMessage",destroy:true}],_initialize:function(){s.View.prototype._initialize.call(this)},_setupElement:function(){s.View.prototype._setupElement.call(this);this._element.addClass("b8 streak__notice");this._innerMessage=t(document.createElement("div"));this._innerMessage.addClass("vh");this._element.html(this._innerMessage)},setMessage:function(e){this._innerMessage[0].innerHTML=e},show:function(){r.elements.body.append(this._element)},hide:function(){this._element.detach()}});i.set("BentoBox.UI.NoticeView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"NoticeViewController",superclass:s.ViewController,_memberVariables:[{name:"_currentlyShowing",destroy:false},{name:"_currentTimeout",destroy:false}],_initialize:function(){s.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.UI.NoticeView")},show:function(e,t){clearTimeout(this._currentTimeout);this._view.setMessage(e);this._view.show();if(t){this._currentTimeout=setTimeout(this.hide.bind(this),t)}},hide:function(){this._view.hide()}});i.set("BentoBox.UI.NoticeViewController",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HelpModalView",superclass:s.View,_memberVariables:[],_initialize:function(){s.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.getElement("helpModal");this._bindToElements()},_bindToElements:function(){this._bindToTopClick();this._bindToBackButton();this._bindToMinimize();this._bindToRestore();this._bindToClose()},_bindToTopClick:function(){var e=this;this._element.find(".streak__helpModal_top").on("click",function(n){if(n.target.tagName==="INPUT"||t(n.target).parents("input").length>0){return}e._callDelegateFunction("topClicked")})},toggleTopClickableClass:function(e){this._element.find(".streak__helpModal_top").toggleClass("streak__helpModal_topClickable",e)},_bindToBackButton:function(){var e=this;this._element.find(".streak__helpModal_top_backButton").on("click",function(t){e._callDelegateFunction("backButtonClicked");t.stopPropagation()})},_bindToMinimize:function(){var e=this;this._element.find(".streak__helpModal_top_buttons_minimize").on("click",function(t){e._callDelegateFunction("minimizeClicked");t.stopPropagation()})},_bindToRestore:function(){var e=this;this._element.find(".streak__helpModal_top_buttons_restore").on("click",function(t){e._callDelegateFunction("restoreClicked");t.stopPropagation()})},_bindToClose:function(){var e=this;this._element.find(".streak__helpModal_top_buttons_close").on("click",function(t){e._callDelegateFunction("closeClicked");t.stopPropagation()})},showBackButton:function(){this._element.find(".streak__helpModal_top_backButton").show()},hideBackButton:function(){this._element.find(".streak__helpModal_top_backButton").hide()},setIconClass:function(e){this._element.find("[role=streak__icon]")[0].setAttribute("class",e)},setTitleText:function(e){this._element.find(".streak__helpModal_top_main").html(e)},setTitleView:function(e){this._element.find(".streak__helpModal_top_main").html(e.getElement())},hideContent:function(){this._element.find(".streak__helpModal_content").hide()},showContent:function(){this._element.find(".streak__helpModal_content").show()},showMinimize:function(){this._element.find(".streak__helpModal_top_buttons_minimize").show()},hideMinimize:function(){this._element.find(".streak__helpModal_top_buttons_minimize").hide()},showRestore:function(){this._element.find(".streak__helpModal_top_buttons_restore").show()},hideRestore:function(){this._element.find(".streak__helpModal_top_buttons_restore").hide()},showClose:function(){this._element.find(".streak__helpModal_top_buttons_close").show()},hideClose:function(){this._element.find(".streak__helpModal_top_buttons_close").hide()},setContentHTML:function(e){this._element.find(".streak__helpModal_content").html(e)},setContentView:function(e){this._element.find(".streak__helpModal_content").html(e.getElement())},addClass:function(e){this._element.addClass(e)},removeClass:function(e){this._element.removeClass(e)},hideLowerButtonArea:function(){this._element.find(".streak__helpModal_buttonArea").hide()},showLowerButtonArea:function(){this._element.find(".streak__helpModal_buttonArea").show()},addLeftButton:function(e){this._element.find(".streak__helpModal_buttonArea_left").html(e.getElement())},addRightButton:function(e){this._element.find(".streak__helpModal_buttonArea_right").html(e.getElement())},setWidth:function(e){this._element.width(e)}});i.set("BentoBox.Widgets.HelpModalView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"HelpModalViewController",superclass:s.ViewController,_memberVariables:[{name:"_titleText",destroy:false},{name:"_titleViewController",destroy:false},{name:"_isTopClickable",destroy:false,defaultValue:true},{name:"_isMinimized",destroy:false,defaultValue:false}],_initialize:function(){s.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.HelpModalView");this._view.hideBackButton();this._view.showMinimize();this._view.hideRestore();this._view.hideLowerButtonArea();this._view.toggleTopClickableClass(this._isTopClickable)},topClicked:function(){if(!this._isTopClickable){return}if(this._isMinimized){this.restoreClicked();return}this.minimizeClicked()},minimize:function(){this.minimizeClicked()},minimizeClicked:function(){if(this._isMinimized){return}this._view.hideContent();this._view.showRestore();this._view.hideMinimize();if(this._titleViewController){this._titleViewController.getView().getElement().detach()}if(this._titleText){this._view.setTitleText(this._titleText)}this._isMinimized=true;this._view.addClass("streak__helpModal_minimized");this._callDelegateFunction("minimizeClicked")},restore:function(){this.restoreClicked()},restoreClicked:function(){if(!this._isMinimized){return}this._view.showContent();this._view.hideRestore();this._view.showMinimize();this._view.removeClass("streak__helpModal_minimized");if(this._titleViewController){this._view.setTitleView(this._titleViewController.getView())}this._isMinimized=false;this._callDelegateFunction("restoreClicked")},closeClicked:function(){this._callDelegateFunction("closeClicked")},backButtonClicked:function(){this._callDelegateFunction("backButtonClicked")},showBackButton:function(){this._view.showBackButton()},hideBackButton:function(){this._view.hideBackButton()},setIconClass:function(e){this._view.setIconClass(e)},setTitleText:function(e){this._titleText=e;if(!this._titleViewController){this._view.setTitleText(e)}},setTitleViewController:function(e){this._titleViewController=e;this._view.setTitleView(e.getView())},setContentHTML:function(e){this._view.setContentHTML(e)},setContentViewController:function(e){this._view.setContentView(e.getView())},setTopClickable:function(e){this._isTopClickable=e;this._view.toggleTopClickableClass(e)},showMinimize:function(){this._view.showMinimize()},hideMinimize:function(){this._view.hideMinimize()},showClose:function(){this._view.showClose()},hideClose:function(){this._view.hideClose()},addLeftButton:function(e){this._view.showLowerButtonArea();this._view.addLeftButton(e)},addRightButton:function(e){this._view.showLowerButtonArea();this._view.addRightButton()},setWidth:function(e){this._view.setWidth(e)}});i.set("BentoBox.Widgets.HelpModalViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=15,h=32,f=32,p=15;var m=e.Class.subclass({className:"TooltipViewController",superclass:s.ViewController,_memberVariables:[{name:"_leftButton",destroy:true},{name:"_rightButton",destroy:true},{name:"_target",destroy:false},{name:"_targetSelector",destroy:false},{name:"_placement",destroy:false},{name:"_elementChecker",destroy:true}],_initialize:function(){s.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.TooltipView")},setTitle:function(e){this._view.setTitle(e)},setContent:function(e){this._view.setContent(e)},setActionContent:function(e){this._view.showActionBox();this._view.setActionContent(e)},addLeftButton:function(e,t){this._view.showActionBox();this._leftButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:e,onFunction:t});this._view.addLeftButton(this._leftButton)},addRightButton:function(e,t){this._view.showActionBox();this._rightButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:e,onFunction:t});this._view.addRightButton(this._rightButton)},removeLeftButton:function(){if(this._leftButton){this._leftButton.destroy()}if(this._rightButton){return}this._view.hideActionBox()},removeRightButton:function(){if(this._RightButton){this._RightButton.destroy()}if(this._leftButton){return}this._view.hideActionBox()},setTarget:function(e){this._target=t(e);this._targetSelector=e},setPlacement:function(e){this._placement=e},closeClicked:function(){this._callDelegateFunction("closeClicked")},hideClose:function(){this._view.hideClose()},show:function(){this._view.hideArrow();this._view.show();if(this._target.length===0){this._target=t(this._targetSelector)}if(this._target.length===0){c.logError("tooltip: failed to find element",null,{targetSelector:this._targetSelector});this._callDelegateFunction("elementNotFound");return}var e=this._target.getBoundingBox(true);var n=this._view.getElement().getBoundingBox(true);var i;if(this._placement){i=this._getPlacementBoundingBox(e,n)}else{i=this._getAutomaticPlacementBoundingBox(e,n)}var r=this._containBoundingBox(i.value);this._setPositionAtBoundingBox(r);this._setArrowPosition(i.type,r,e);this._startCheckingForTarget()},addArrowClass:function(e){this._view.addArrowClass(e)},_getPlacementBoundingBox:function(e,t){var n=this["_get"+this._placement.position.capitalize()+"PositionBoundingBox"](e,t);if(this._placement.top){var i=0;if(this._placement.tipOffsetFromArrow&&this._placement.tipOffsetFromArrow.top){i=this._placement.tipOffsetFromArrow.top}n[0].y=e[0].y-t.height/2+this._placement.top+i;n[1].y=n[0].y+t.height}if(this._placement.left){var r=0;if(this._placement.tipOffsetFromArrow&&this._placement.tipOffsetFromArrow.left){r=this._placement.tipOffsetFromArrow.left}n[0].x=e[0].x-t.width/2+this._placement.left+r;n[1].x=n[0].x+t.width}return{type:this._placement.position,value:n}},_getAutomaticPlacementBoundingBox:function(e,t){var n=[{type:"top",value:this._getTopPositionBoundingBox(e,t)},{type:"left",value:this._getLeftPositionBoundingBox(e,t)},{type:"right",value:this._getRightPositionBoundingBox(e,t)},{type:"bottom",value:this._getBottomPositionBoundingBox(e,t)}];var i=this._figureOutBestBoundingBox(n);return i},_getTopPositionBoundingBox:function(e,t){var n=e[0].y-t.height-d;var i=e[0].x+e.width/2-t.width/2;return[{x:i,y:n},{x:i+t.width,y:n+t.height}]},_getRightPositionBoundingBox:function(e,t){var n=e[1].x+p;var i=e[0].y+e.height/2-t.height/2;return[{x:n,y:i},{x:n+t.width,y:i+t.height}]},_getBottomPositionBoundingBox:function(e,t){var n=e[1].y+d;var i=e[0].x+e.width/2-t.width/2;return[{x:i,y:n},{x:i+t.width,y:n+t.height}]},_getLeftPositionBoundingBox:function(e,t){var n=e[0].x-p-t.width;var i=e[0].y+e.height/2-t.height/2;return[{x:n,y:i},{x:n+t.width,y:i+t.height}]},_figureOutBestBoundingBox:function(e){for(var t=0;t<e.length;t++){e[t].smallestDistance=this._getSmallestDistance(e[t])}return n.sortBy(e,function(e){return e.smallestDistance}).reverse()[0]},_getSmallestDistance:function(e){var t=[e.value[0].y,e.value[0].x,document.body.clientWidth-e.value[1].x,document.body.clientHeight-e.value[1].y];return n.sortBy(t,function(e){return e})[0]},_containBoundingBox:function(e){var t=e[1].y-e[0].y;var n=e[1].x-e[0].x;if(e[0].y<-1){e[0].y=0;e[1].y=e[0].y+t}else if(e[1].y>document.body.clientHeight){e[0].y=document.body.clientHeight-t;e[1].y=e[0].y+t}if(e[0].x<-1){e[0].x=0;e[1].x=e[0].x+n}else if(e[1].x>document.body.clientWidth){e[0].x=document.body.clientWidth-n-20;e[1].x=e[0].x+n}return e},_setPositionAtBoundingBox:function(e){this._view.setPosition({top:e[0].y,left:e[0].x})},_setArrowPosition:function(e,t,n){var i={};if(this._placement&&this._placement.tipOffsetFromArrow){this._setArrowPositionWithPlacement(e,t);return}switch(e){case"top":i.top=t[1].y;i.left=(t[0].x+t[1].x)/2-h/2;break;case"left":i.top=(t[0].y+t[1].y)/2-f/2;i.left=t[1].x;break;case"right":i.top=(t[0].y+t[1].y)/2-f/2;i.left=t[0].x-h/2+1;break;case"bottom":i.top=t[0].y-d+1;i.left=(t[0].x+t[1].x)/2-(h-2)/2;break}this._view.showArrow(e,i)},_setArrowPositionWithPlacement:function(e,t){var n={};switch(e){case"top":n.top=t[1].y;n.left=(t[0].x+t[1].x)/2-h/2;break;case"left":n.top=(t[0].y+t[1].y)/2-f/2;n.left=t[1].x;break;case"right":n.top=(t[0].y+t[1].y)/2-f/2;n.left=t[0].x-p;break;case"bottom":n.top=t[0].y-d+1;n.left=(t[0].x+t[1].x)/2-(h-2)/2;break}if(this._placement.tipOffsetFromArrow){if(this._placement.tipOffsetFromArrow.top){n.top-=this._placement.tipOffsetFromArrow.top}if(this._placement.tipOffsetFromArrow.left){n.left-=this._placement.tipOffsetFromArrow.left}}this._view.showArrow(e,n)},_startCheckingForTarget:function(){var e=this;this._elementChecker=n.repeatEvery(function(){if(e._target.isVisible()){return}e._callDelegateFunction("elementNoLongerFound");e.destroy()},500,true)}});i.set("BentoBox.Widgets.TooltipViewController",m)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TooltipView",superclass:s.View,_memberVariables:[{name:"_tooltipArrow",destroy:true}],_initialize:function(){s.View.prototype._initialize.call(this);this._bindToClose()},_setupElement:function(){this._element=o.getElement("tooltip");this._tooltipArrow=o.getElement("tooltip_arrow")},_bindToClose:function(){var e=this;this._element.find(".streak__tooltip_close").on("click",function(t){e._callDelegateFunction("closeClicked")})},setTitle:function(e){this._element.find(".streak__tooltip_header_title")[0].innerHTML=e},setContent:function(e){this._element.find(".streak__tooltip_main_content").html(e)},setActionContent:function(e){this._element.find(".streak__tooltip_main_actionBox_content").html(e)},hideClose:function(){this._element.find(".streak__tooltip_close").hide()},addLeftButton:function(e){this._element.find(".streak__tooltip_main_actionBox_left").html(e.getElement())},addRightButton:function(e){this._element.find(".streak__tooltip_main_actionBox_right").html(e.getElement())},showActionBox:function(){this._element.find(".streak__tooltip_main_content").addClass("streak__tooltip_main_content_withActionBox");this._element.find(".streak__tooltip_main_actionBox")[0].style.display="flex"},hideActionBox:function(){this._element.find(".streak__tooltip_main_content").removeClass("streak__tooltip_main_content_withActionBox");this._element.find(".streak__tooltip_main_actionBox")[0].style.display="none"},show:function(){r.elements.body.append(this._element)},setPosition:function(e){this._element.css(e)},showArrow:function(e,t){r.elements.body.append(this._tooltipArrow);this._tooltipArrow[0].setAttribute("class","streak__tooltip_arrow streak__tooltip_arrow_"+e);this._tooltipArrow.css(t);this._tooltipArrow.show()},hideArrow:function(){this._tooltipArrow.hide()},addArrowClass:function(e){this._tooltipArrow.addClass(e)}});i.set("BentoBox.Widgets.TooltipView",d)})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"PaywallGatewayView",superclass:a,_memberVariables:[{name:"_text",destroy:true},{name:"_upgradeButton",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._text=this._element.find(".streak__paywallGateway_text");this._upgradeButton=this._element.find(".streak__paywallGateway_upgradeButton")},_setupElement:function(){this._element=t(i.getElement("streak__paywallGateway"))},setText:function(e){this._text.html(e)},setUpgradeButton:function(e){this._upgradeButton.html(e.getElement())}});n.set("BentoBox.Widgets.PaywallGatewayView",o)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.UI,a=e.BentoBox;var o=r.ViewController;var s=e.Class.subclass({className:"PaywallGatewayViewController",superclass:o,_memberVariables:[{name:"_onUpgradeClick",destroy:true},{name:"_modal",destroy:true},{name:"_options",destroy:true}],_initialize:function(e){this._options=n.defaults(e||{},{text:a.Locale.getString("paywall_gateway_default_text"),title:a.Locale.getString("paywall_gateway_default_title")});o.prototype._initialize.call(this);this._view.setText(this._options.text);this._setupButton()},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.PaywallGatewayView")},_setupButton:function(){if(!this._upgradeButton){var e=this;this._upgradeButton=i.getInstance("BentoBox.Widgets.PaywallUpgradeButtonViewController",{onClick:function(){e.upgradeClicked()}})}this._view.setUpgradeButton(this._upgradeButton.getView())},upgradeClicked:function(){this._modal.wasUpgradeClicked=true;this._modal.close()},show:function(e){e=n.defaults(e||{},{closed:t.noop});var i=this;this._modal=a.Widgets.Modal.create({title:this._options.title,onClose:function(){e.closed(i._modal.wasUpgradeClicked)},inner:this._view.getElement(),showConfirm:false,showCancel:false});this._modal.show()}});e.DependencyManager.addFunction({functionKey:"PaywallGatewayViewControllerReady",functionToCall:function(e){i.set("BentoBox.Widgets.PaywallGatewayViewController",s);e()},dependentFunctionKeys:["htmlLoaded","localeLoaded","userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e.Library,i=e.HTML,r=e.UI;var a=r.View;var o=e.Class.subclass({className:"PaywallUpgradeButtonView",superclass:a,_memberVariables:[{name:"_upgradeDiv",destroy:true},{name:"_contactBillingAdmin",destroy:true},{name:"_loading",destroy:true}],_initialize:function(){a.prototype._initialize.call(this);this._contactBillingAdmin=this._element.find(".streak__contactBillingAdmin");this._upgradeDiv=this._element.find(".streak__upgradeButton");this._loading=this._element.find(".streak__paywall_upgrade_button_loading");this._upgradeDiv.hide();this._contactBillingAdmin.hide()},_setupElement:function(){this._element=t(i.getElement("paywallUpgradeButton"))},setUpgradeButton:function(e){this._upgradeDiv.html(e.getElement())},showUpgradeButton:function(e){if(e){this._upgradeDiv.show().css("display","");this._contactBillingAdmin.hide()}else{this._contactBillingAdmin.show().css("display","");this._upgradeDiv.hide()}this._loading.hide()}});n.set("BentoBox.Widgets.PaywallUpgradeButtonView",o)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.BentoBox;var o=e.UI.ViewController;var s=e.Class.subclass({className:"PaywallUpgradeButtonViewController",superclass:o,_memberVariables:[{name:"_options",destroy:false},{name:"_participatingPlans",destroy:false},{name:"_billingAdminPlanInstances",destroy:false},{name:"_billingAdminPlanInstance",destroy:false}],_initialize:function(e){this._options=n.defaults(e,{onClick:t.noop});o.prototype._initialize.call(this);this._setupButton();this._loadPlanInformation()},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.PaywallUpgradeButtonView")},_setupButton:function(){if(!this._upgradeButton){var e=this;this._upgradeButton=a.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:a.Locale.getString("paywall_upgrade_button"),onFunction:function(){e.buttonClicked();
e._options.onClick()}});this._upgradeButton.addClass("streak__bigButton")}this._view.setUpgradeButton(this._upgradeButton)},_loadPlanInformation:function(){this._participatingPlans=a.Data.getParticipatingPlans();this._billingAdminPlanInstances=a.Data.getBillingPlanInstances();if(!this._participatingPlans.getHasLoaded())this._participatingPlans.refresh(this._setupPlanInformation.bind(this));if(!this._billingAdminPlanInstances.getHasLoaded())this._billingAdminPlanInstances.refresh(this._setupPlanInformation.bind(this));if(this._participatingPlans.getHasLoaded()&&this._billingAdminPlanInstances.getHasLoaded()){this._setupPlanInformation();return}},_setupPlanInformation:function(){if(!this._participatingPlans.getHasLoaded())return;if(!this._billingAdminPlanInstances.getHasLoaded())return;this._billingAdminPlanInstance=n.filter(this._billingAdminPlanInstances,function(e){return e.isActive()})[0];if(this._billingAdminPlanInstance){this._view.showUpgradeButton(true)}else{if(this._participatingPlans.length>0){this._view.showUpgradeButton(false)}else{this._view.showUpgradeButton(true)}}},buttonClicked:function(){if(this._billingAdminPlanInstance){r.inboxSDK.Router.goto("upgrade/:key/start/:section",{key:this._billingAdminPlanInstance.get("key"),section:"plan"})}else{r.inboxSDK.Router.goto("upgrade")}}});i.set("BentoBox.Widgets.PaywallUpgradeButtonViewController",s)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailTooltip",superclass:e.Object,_memberVariables:[{name:"_options",destroy:false},{name:"_tooltipViewController",destroy:true}],_initialize:function(){e.Object.prototype._initialize.call(this)},setup:function(e){this._options=e;this._tooltipViewController=i.getInstance("BentoBox.Widgets.TooltipViewController")},show:function(){this._tooltipViewController.setTitle(this._options.title);this._tooltipViewController.setContent(this._options.body);this._tooltipViewController.setTarget(this._options.targetSelector);if(this._options.actionContent){this._tooltipViewController.setActionContent(this._options.actionContent)}if(this._options.leftButton){this._tooltipViewController.addLeftButton(this._options.leftButton.name,this._options.leftButton.function)}if(this._options.rightButton){this._tooltipViewController.addRightButton(this._options.rightButton.name,this._options.rightButton.function)}if(this._options.placement){this._tooltipViewController.setPlacement(this._options.placement)}this._tooltipViewController.addDelegate(this);this._tooltipViewController.show()},closeClicked:function(){this._options.earlyExitTourFunction("tooltip close clicked")},elementNotFound:function(){this._options.earlyExitTourFunction("tooltip element not found")},elementNoLongerFound:function(){this._options.earlyExitTourFunction("tooltip element disappeared")},getType:function(){return"GMAIL_TOOLTIP"}});i.set("BentoBox.Widgets.Tour.GmailTooltip",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=["demimoohidhmolhbphaklnmokjhjgjlf","fmdomiplhgolgpibfdjjhgbcbkdcfkmk","gakklmehjhhdfjjgnmpkjoemjmeomnli","dheionainndbbpoacpnopgmnihkcmnkl","kdadialhpiikehpdeejjeiikopddkjem","mlomiejdfkolichcflejclcbmpeaniij","bmihblnpomgpjkfddepdpdafhhepdbek","hpioniioecjjbhbnnbhcifmgmoiibalo"];var h=e.Class.subclass({className:"BadExtensionNotifierGlobalController",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);if(this._checkDisabled()){return}var t=this;Messenger.sendMessage("extensionListRequest",null,"extensionListResponse",this._checkExtensions.bind(this))},_checkDisabled:function(){return c.LocalSettings.get("warnings/extensionConflictNoticeDisabled")},_disableCheck:function(){c.LocalSettings.set("warnings/extensionConflictNoticeDisabled",true)},_checkExtensions:function(e){var t=n.chain(e).filter(function(e){return!e.isApp&&e.mayDisable&&e.enabled}).filter(function(e){return d.indexOf(e.id)>-1}).pluck("name").value();if(t.length===0){return}this._showWarning(t)},_showWarning:function(e){var n=t(document.createElement("div"));n[0].innerHTML=o.getString("badExtensionNotifier");var i=t(document.createElement("ul"));for(var r=0;r<e.length;r++){i.append("<li><b>"+e[r]+"</b></li>")}n.append(i);var a=this;var s=c.Widgets.Modal.create({title:"Streak Extension Conflicts Found",inner:n,showCancel:false,showLink:true,linkText:"Don't show me this again",linkFunc:function(){a._disableCheck();s.close()}});s.show()}});e.DependencyManager.addFunction({functionKey:"badExtensionNotifierGlobalControllerInitialized",functionReference:function(){i.set("BentoBox.Services.BadExtensionNotifierGlobalController",new h)},dependentFunctionKeys:["htmlLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=r.GmailThreadListViewProvider;var h=e.Class.subclass({className:"PixelTrackerRecentViewsThreadListProvider",superclass:d,_memberVariables:[{name:"_trackedThreads",destroy:false},{name:"_defer",destroy:true}],_initialize:function(){d.prototype._initialize.call(this)},getRelevantRequestParameters:function(){return{q:"label:all before:5000/01/01",view:"tl"}},start:function(t){this._defer=e.RSVP.defer();this._getListOfRecentlyReadTrackedThreads()},getCrapFormatThreads:function(e,t){return this._defer.promise},_getListOfRecentlyReadTrackedThreads:function(){e.APIRequester.get("trackedthreads/recent").getPromise().then(this._handleListOfRecentlyReadTrackedThreads.bind(this),this._defer.reject.bind(this._defer))},_handleListOfRecentlyReadTrackedThreads:function(e){this._trackedThreads=f(e);this._registerTrackedThreads();var t=p(this._trackedThreads);this._defer.resolve(r.GmailThreadRequester.getGmailThreadsForRFCMessageIds(t).then(this._handleGmailThreads.bind(this)))},_registerTrackedThreads:function(){for(var e=0;e<this._trackedThreads.length;e++){var t=this._trackedThreads[e];c.Services.Threads.ThreadInfoOperationManager.updateThreadStorerTrackedThreadFor(t.hexGmailThreadId,t)}},_handleGmailThreads:function(e){c.Services.Threads.ThreadMetaDataCreator.processCrapFormatThreads(e);e=this._sortGmailThreadsBasedOnTrackedThreads(e);this._addThreadIdToSubjectSpan(e);e.reverse();return e},_sortGmailThreadsBasedOnTrackedThreads:function(e){var t={};for(var i=0;i<e.length;i++){t[e[i][0]]=e[i]}var r=n.sortBy(this._trackedThreads,function(e){return e.newestViewDate});var a=[];for(i=0;i<r.length;i++){var o=r[i];var s=t[o.hexGmailThreadId];if(s){a.push(s)}}return a},_addThreadIdToSubjectSpan:function(e){for(var t=0;t<e.length;t++){e[t][7]=e[t][7].replace("<span",'<span streakthreadid="'+n.escape(e[t][0])+'"')}}});function f(e){return n.filter(e,function(e){return!!e.mostRecentLinkFirstViewDate&&!!e.mostRecentRfcMessageId})}function p(e){var t=[];if(!e){return t}for(var n=0;n<e.length;n++){var i=e[n];if(i.mostRecentRfcMessageId){t.push(i.mostRecentRfcMessageId)}}return t}i.set("BentoBox.Modules.PixelTrackerRecentViewsThreadListProvider",h);r.GmailThreadListViewRegister.registerProvider(h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Date,a=e.Gmail,o=e.Locale,s=e.HTML,l=e.BentoBox.Data,u=e.BentoBox;var c={TRACKED_KEY:"label:all before:5000/01/01",URL_KEY:"label%3Aall+before%3A5000%2F01%2F01",SEARCH_URL:"label:all before:5000/01/01",SEARCH_REPLACEMENT:"is:recentlyviewed"};c.TRACKED_KEY_REGEX=new RegExp(c.TRACKED_KEY,"img");c.REPLACE_KEY_REGEX=new RegExp(c.SEARCH_REPLACEMENT,"img");var d={CONSTANTS:c,init:function(){this._setupSearchLink();this._setupSearchBarOverride()},_setupSearchLink:function(){a.inboxSDK.NavMenu.SENT_MAIL.addNavItem({name:u.Locale.getString("pixel_track_recent_views_link"),routeID:a.inboxSDK.Router.NativeRouteIDs.SEARCH,routeParams:{query:c.SEARCH_URL,page:1},orderHint:1})},_setupSearchBarOverride:function(){var e=this;a.GmailSearchBarContentReplacer.addManipulation({applyDisplayManipulation:function(e){return e.replace(c.TRACKED_KEY_REGEX,c.SEARCH_REPLACEMENT)},applyValueManipulation:function(e){return e.replace(c.REPLACE_KEY_REGEX,'"'+c.TRACKED_KEY+'"')}})},_doesURLHaveTrackingSearch:function(){return location.hash.indexOf(c.URL_KEY)>-1}};e.DependencyManager.addFunction({functionKey:"pixelTrackerRecentViewsSearchInitialized",functionReference:d.init,functionContext:d,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","enabledFeaturesControllerInitialized","pixelTrackerSearchInitialized","threadInfoOperationManagerInitialized"]});u.Modules.PixelTrackerRecentViewsSearch=d;var h=function(e,t){u.Tracker.trackStreakActive(t,{eventName:e})}})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PixelTrackerRecentViewsInboxRowManipulationSource",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getTableManipulation:function(){if(!c.Modules.PixelTrackerUtils.isRecentViewsResultsPage()){return}if(r.isVerticalSplitPreviewPane()){return}return{type:"COLUMN_WIDTH",columnName:"DATE",width:125}},getRowManipulation:function(e,t){if(!c.Modules.PixelTrackerUtils.isRecentViewsResultsPage()){return}var n=c.Services.Threads.ThreadStorer.getTrackedThread(e);if(!n){return}var r=i.getInstance("BentoBox.Modules.PixelTrackerRecentViewsInboxRowManipulation");r.setTrackedThread(n);return r}});e.DependencyManager.addFunction({functionKey:"pixelTrackerRecentViewsInboxRowManipulationSourceInitialized",functionReference:function(){var e=new d;i.set("BentoBox.Modules.PixelTrackerRecentViewsInboxRowManipulationSource",e);r.InboxManipulator.addDataSource(e)},dependentFunctionKeys:["inboxManipulatorInitialized","threadsInitialized","htmlLoaded","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PixelTrackerRecentViewsInboxRowManipulation",superclass:r.InboxManipulator.InboxRowManipulationBase,_memberVariables:[{name:"_trackedThread",destroy:false,set:true},{name:"_element",destroy:true},{name:"_originalDate",destroy:false}],_initialize:function(){r.InboxManipulator.InboxRowManipulationBase.prototype._initialize.call(this)},setThreadDOMRow:function(e){this._threadDOMRow=e;this._originalDate=e.date.html()},getManipulationType:function(){return"REPLACE_CONTENT"},getColumnName:function(){return"DATE"},getElement:function(){if(this._element){return this._element}this._element=t(document.createElement("span"));var n;var i=e.moment(this._trackedThread.newestViewDate);var r=i.fromNow();n='<span class="streak__pixelTrackerRecentViews_readDate" title="'+i.format()+'">'+r+"</span>";if(this._threadDOMRow.isUnread){n="<b>"+n+"</b>"}this._element[0].innerHTML=n;return this._element}});i.set("BentoBox.Modules.PixelTrackerRecentViewsInboxRowManipulation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SchedulerView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.get("scheduler",true)},setTitleText:function(e){this._element.find(".streak__scheduler_title").text(e)},setDateInputView:function(e){this._element.find(".streak__scheduler_dateInputWrapper").html(e.getElement())},addFrequentlyUsedTime:function(e,n){var i=t(document.createElement("li"));i.text(e);i.click(n);this._element.find(".streak__scheduler_frequentlyUsed_list").append(i)},setConfirmTimeLabelText:function(e){this._element.find(".streak__scheduler_confirmTime strong").text(e+":")},setConfirmTimeStringText:function(e){this._element.find(".streak__scheduler_confirmTimeString").text(e)},addActionButton:function(e){this._element.find(".streak__scheduler_buttons").append(e.getElement())},setHintText:function(e){this._element.find(".streak__scheduler_hint").text(e)},insertElementBeforeConfirmTime:function(e){var n=t(document.createElement("div"));n.addClass("streak__scheduler_addedSection");n.append(e);this._element.find(".streak__scheduler_confirmTime").before(n)}});i.set("BentoBox.Widgets.SchedulerView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SchedulerViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_model",destroy:false,set:true},{name:"_dateProperty",destroy:false,set:true},{name:"_dateInputViewController",destroy:true},{name:"_confirmButton",destroy:true},{name:"_cancelButton",destroy:true}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._setupDateInput();this._setupFrequentlyUsedTimes();this._setupButtons()},_setupView:function(){this._view=new c.Widgets.SchedulerView},focus:function(){this._dateInputViewController.focus()},setTitleText:function(e){this._view.setTitleText(e);return this},insertElementBeforeConfirmTime:function(e){this._view.insertElementBeforeConfirmTime(e);return this},setConfirmTimeLabelText:function(e){this._view.setConfirmTimeLabelText(e);return this},setConfirmCallback:function(e){this._confirmButton.setOnFunction(e);return this},setCancelCallback:function(e){this._cancelButton.setOnFunction(e);return this},setConfirmText:function(e){this._confirmButton.setText(e);return this},setHintText:function(e){this._view.setHintText(e);return this},setCancelText:function(e){this._cancelButton.setText(e);return this},showCancelButton:function(){this._cancelButton.getElement().fastShow("inline-block");return this},hideCancelButton:function(){this._cancelButton.getElement().hide();return this},setModel:function(e){this._model=e;this._updateView();this._updateDateInput();return this},setDateProperty:function(e){this._dateProperty=e;this._updateView();this._updateDateInput();return this},disable:function(){this._confirmButton.disable();this._cancelButton.disable()},enable:function(){this._confirmButton.enable();this._cancelButton.enable()},_setupDateInput:function(){this._dateInputViewController=new c.Widgets.GmailTextareaViewController({plainTextOnly:true});this._view.setDateInputView(this._dateInputViewController.getView());this._dateInputViewController.addDelegate({keydown:this._dateInputKeydown.bind(this),keyup:this._dateInputKeyUp.bind(this)});this._dateInputViewController.setTabIndex(1)},_dateInputKeydown:function(t){if(e.jwerty.is("enter",t)){t.preventDefault();this._confirmButton.on()}},_dateInputKeyUp:function(t){if(e.jwerty.is("enter",t)){return}var n=this._dateInputViewController.getText();var i=e.Date.create(n);if(i.isValid()){this._model.set(this._dateProperty,i.getTime())}this._updateView(i)},_setupFrequentlyUsedTimes:function(){var e=[{text:c.Locale.getString("send_later_one_hour"),dateText:"one hour from now"},{text:c.Locale.getString("send_later_tomorrow_8"),dateText:"tomorrow at 8am"},{text:c.Locale.getString("send_later_monday"),dateText:"next monday at 8am"},{text:c.Locale.getString("send_later_week"),dateText:"one week from today at 8am"},{text:c.Locale.getString("send_later_month"),dateText:"beginning of next month at 8am"},{text:c.Locale.getString("send_later_six"),dateText:"six months from now at 8am"}];for(var t=0;t<e.length;t++){this._addFrequentyUsedTime(e[t])}},_addFrequentyUsedTime:function(e){var t=this;this._view.addFrequentlyUsedTime(e.text,function(){c.Tracker.track("scheduler.frequentlyUsedTimeClicked",{time:e.dateText});var n=a.create(e.dateText);t._model.set(t._dateProperty,n.getTime());t._updateView();t._updateDateInput()})},_setupButtons:function(){this._setupCancelButton();this._setupConfirmButton()},_setupConfirmButton:function(){this._confirmButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"red",text:c.Locale.getString("save"),onFunction:t.noop});this._view.addActionButton(this._confirmButton);this._confirmButton.setTabIndex(1)},_setupCancelButton:function(){this._cancelButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",text:c.Locale.getString("cancel"),onFunction:t.noop});this._view.addActionButton(this._cancelButton);this._cancelButton.setTabIndex(1)},_updateView:function(e){if(!this._model||!this._dateProperty){return}var t=this._model.get(this._dateProperty);e=e||a.create(t);this._confirmButton.disable();if(!e.isValid()){this._view.setConfirmTimeStringText(c.Locale.getString("send_later_invalid_date"));return}if(e.isBefore(a.now())){this._view.setConfirmTimeStringText(c.Locale.getString("send_later_future_date"));return}this._view.setConfirmTimeStringText(e.customFormat("longWithTimezone"));this._confirmButton.enable()},_updateDateInput:function(){if(!this._model||!this._dateProperty){return}var e=this._model.get(this._dateProperty);var t=a.create(e);if(t.isValid()){this._dateInputViewController.setHTML(t.customFormat("long"))}else{this._dateInputViewController.setHTML("")}}});e.DependencyManager.addFunction({functionKey:"schedulerViewControllerInitialized",functionReference:function(){i.set("BentoBox.Widgets.SchedulerViewController",d)},dependentFunctionKeys:["htmlLoaded","localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterOnComposeMenuViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_schedulerViewController",destroy:true},{name:"_replyConditionalCheckbox",destroy:true},{name:"_bumpLaterModel",destroy:false},{name:"_bumpLaterPatch",destroy:false},{name:"_stateNotifier",destroy:false}],use:function(e,t){this._bumpLaterModel=e;this._bumpLaterPatch=this._bumpLaterModel.createPatch();this._stateNotifier=t;if(this._bumpLaterModel.get("bumpDate")){this._schedulerViewController.showCancelButton();this._schedulerViewController.setCancelText(c.Locale.getString("cancel_bump_later"));this._schedulerViewController.setConfirmText(c.Locale.getString("save"))}else{this._bumpLaterPatch.set("onlyBumpIfNoResponse",true);this._schedulerViewController.hideCancelButton();this._schedulerViewController.setConfirmText(c.Locale.getString("bump_later"))}this._replyConditionalCheckbox.setChecked(!!this._bumpLaterPatch.get("onlyBumpIfNoResponse"));this._schedulerViewController.setModel(this._bumpLaterPatch)},focus:function(){this._schedulerViewController.focus()},getElement:function(){return this._view.getElement()},_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=c.Widgets.Menu.create();this._view.getElement().addClass("streak__bumpLaterMenu streak__sdk_menu");this._view.getElement().removeClass("J-M");this._setupSchedulerViewController();this._setupReplyConditionalCheckbox()},_setupSchedulerViewController:function(){this._schedulerViewController=new c.Widgets.SchedulerViewController;this._schedulerViewController.setTitleText(c.Locale.getString("bump_later_scheduler_title")).setConfirmTimeLabelText(c.Locale.getString("bump_later_confirm_label")).setHintText(c.Locale.getString("bump_later_scheduler_hint")).showCancelButton().setDateProperty("bumpDate").setConfirmCallback(this._saveBumpLater.bind(this)).setCancelCallback(this._cancelBumpLater.bind(this));this._view.addSection(this._schedulerViewController.getView().getElement())},_setupReplyConditionalCheckbox:function(){this._replyConditionalCheckbox=r.widgets.getCheckbox(c.Locale.getString("bump_later_reply_condition"));var e=this;var t=this._replyConditionalCheckbox;this._replyConditionalCheckbox.on("change",function(){e._bumpLaterPatch.set("onlyBumpIfNoResponse",t.isChecked())});this._schedulerViewController.insertElementBeforeConfirmTime(this._replyConditionalCheckbox);this._replyConditionalCheckbox[0].setAttribute("tabindex",1)},_saveBumpLater:function(){this._bumpLaterPatch.commit();if(this._bumpLaterModel.isSavedOnServer()){this._bumpLaterModel.save()}this._stateNotifier.saved();c.Tracker.track("bumpLaterCreated",{widget:"compose"});c.Tracker.track("bumpLaterSaved",{widget:"compose"})},_cancelBumpLater:function(){this._bumpLaterPatch.destroy();if(this._bumpLaterModel.isSavedOnServer()){this._bumpLaterModel.del()}c.Tracker.track("bumpLaterCanceled",{widget:"compose"});this._stateNotifier.canceled()}});e.DependencyManager.addFunction({functionKey:"bumpLaterOnComposeMenuViewControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.BumpLaterOnComposeMenuViewController",new d)},dependentFunctionKeys:["schedulerViewControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Bacon,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=["sendLater"];var f=e.Class.subclass({className:"BumpLaterOnComposeButton",superclass:d.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_bumpLaterModel",destroy:false},{name:"_shouldLoad",destroy:false,defaultValue:true},{name:"_isBumpLaterScheduled",destroy:false,defaultValue:false},{name:"_buttonOptions",destroy:false},{name:"_buttonOptionStream",destroy:false},{name:"_menuDropdown",destroy:false},{name:"_sending",destroy:true,defaultValue:false}],_initialize:function(){d.Modules.ComposeViewControllerBase.prototype._initialize.apply(this,n.toArray(arguments))},initialize:function(e){this._composeWindowViewController=e;this._buttonOptionStream=new i.Bus;this._setupBumpLaterModel();this._setupMenuButton();return this},_setupBumpLaterModel:function(){this._bumpLaterModel=new d.Models.BumpLater},_setupMenuButton:function(){var e=this;this._composeWindowViewController.getComposeView().addButton(this._buttonOptionStream);this._buttonOptions={iconClass:"streak__snoozeIcon",tooltip:d.Locale.getString("bump_later_compose_button_tooltip"),hasDropdown:true,type:"MODIFIER",orderHint:0,onClick:function(t){d.Tracker.track("bumpLaterMenuShown",{widget:"compose"});d.Modules.BumpLaterOnComposeMenuViewController.use(e._bumpLaterModel,e);t.dropdown.el.appendChild(d.Modules.BumpLaterOnComposeMenuViewController.getElement()[0]);e._menuDropdown=t.dropdown;d.Modules.BumpLaterOnComposeMenuViewController.focus()}};this._buttonOptionStream.push(this._buttonOptions)},saved:function(){if(this._menuDropdown){this._menuDropdown.close()}this._isBumpLaterScheduled=true;this._buttonOptions.iconClass="streak__snoozeIcon streak__snoozeIcon_active";this._buttonOptions.tooltip=d.Locale.getString("bump_later_indicator_tooltip",{date:this._bumpLaterModel.getBumpDateObject().customFormat("pixelTrack")});this._buttonOptionStream.push(this._buttonOptions)},canceled:function(){if(this._menuDropdown){this._menuDropdown.close()}this._bumpLaterModel.set("bumpDate",null);this._bumpLaterModel.set("onlyBumpIfNoResponse",null);this._isBumpLaterScheduled=false;this._composeWindowViewController.setModuleInactive("bumpLater");this._buttonOptions.iconClass="streak__snoozeIcon";this._buttonOptions.tooltip=d.Locale.getString("bump_later_compose_button_tooltip");this._buttonOptionStream.push(this._buttonOptions)},activeModulesChanged:function(e){this._buttonOptions.enabled=true;this._buttonOptions.tooltip=d.Locale.getString("bump_later_compose_button_tooltip");if(e.indexOf("sendLater")>-1){this._buttonOptions.enabled=false;this._buttonOptions.tooltip=d.Locale.getString("bump_later_off_because_send_later")}if(e.indexOf("mailMerge")>-1){this._buttonOptions.enabled=false}this._buttonOptionStream.push(this._buttonOptions)},composeClose:function(){if(!this._sending&&this._isBumpLaterScheduled){d.ButterBarManager.showMessage(d.Locale.getString("bump_later_canceled_message"))}},_disableBumpLaterButton:function(e){if(!e){return}this._buttonOptions.tooltip=e;this._buttonOptionStream.push(this._buttonOptions)},aboutToSend:function(){if(!this._isBumpLaterScheduled){return}this._sending=true;var t=this._bumpLaterModel;e.NotificationCenter.subscribe({eventName:"rfcMessageIdForSentEmailFound",filterParameters:{composeid:this._composeWindowViewController.getComposeid()},observer:this,functionToCall:function(e){this._createBumpLater(t,e.threadMetaData)}})},_createBumpLater:function(t,n){var i=n.hexGmailThreadId;var r=n.rfcMessageId;var a=n.subject;t.set("gmailThreadId",i);t.set("subject",a);t.set("rfcMessageId",r);t.save();d.Data.getAllBumpLaters().add(t);e.NotificationCenter.postNotification({eventName:"snoozedEmailSent",sender:this})},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});d.Modules.ComposeViewControllerBase.prototype.destroy.call(this)}});r.set("BentoBox.Modules.BumpLaterOnComposeButton",f);c.addFunction({functionKey:"bumpLaterOnComposeButtonInitialized",functionReference:function(e){a.GmailComposeManager.registerModifierModule({getViewControllers:function(){return[new f]}})},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","gmailLoaded","userLoggedIn","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){"use strict";var t=e.$,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.BentoBox;var s=e.Class.subclass({className:"BumpLaterButton",superclass:e.Object,memberVariables:[{name:"_menuButton",destroy:true}],_initialize:function(){var t=this;e.Object.prototype._initialize.call(this);this._menuButton=o.Widgets.Buttons.ButtonFactory.createMenuButton({type:"GmailIconArrow",iconClass:"streak__snoozeIcon",text:o.Locale.getString("bump_later"),isFixedPosition:true,menu:o.Modules.BumpLaterOnThreadsMenuViewController,useCapture:false,preOnFunction:function(){o.Modules.BumpLaterOnThreadsMenuViewController.use(t);o.Tracker.track("bumpLaterMenuShown",{widget:"bumpLaterButton"})},postOnFunction:function(){o.Modules.BumpLaterOnThreadsMenuViewController.focus()}});this._menuButton.addClass("streak__bumpLaterButton");o.Keyboard.bindChord("w,s",function(){if(t._menuButton.getElement().is(":visible")){setTimeout(function(){t._menuButton.on()},10);o.Tracker.track("bumpLaterMenuShown",{widget:"bumpLaterButton"})}},o.Locale.getString("keyboard_bump_later_button_description"))},getElement:function(){return this._menuButton.getElement()},saved:function(e){this._menuButton.off();if(!e){r.getArchiveButton().simulateRawClick();setTimeout(function(){o.ButterBarManager.showMessage(o.Locale.getString("bump_later_archive_message"),{hideOnViewChanged:false})},50)}},canceled:function(){this._menuButton.off()}});e.DependencyManager.addFunction({functionKey:"bumpLaterButtonInitialized",functionReference:function(){var e=new s;o.Services.ToolbarManager.registerButton({element:e.getElement(),showFor:"threadSelection",placement:"archiveGroup",orderHint:1})},dependentFunctionKeys:["threadsInitialized","localeLoaded","gmailLoaded","userLoggedIn","bumpLaterOnThreadsMenuViewControllerInitialized","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterOnThreadsMenuViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_schedulerViewController",destroy:true},{name:"_replyConditionalCheckbox",destroy:true},{name:"_removeMenuItem",destroy:true},{name:"_hexGmailThreadIdList",destroy:true},{name:"_bumpLaterModel",destroy:false},{name:"_bumpLaterPatch",destroy:false},{name:"_stateNotifier",destroy:false}],use:function(e){this._stateNotifier=e;if(this._removeMenuItem){this._removeMenuItem.remove();this._removeMenuItem=null}this._schedulerViewController.getView().getElement().show();this._hexGmailThreadIdList=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);var t=c.Services.Threads.ThreadStorer.getBumpLaterCollectionList(this._hexGmailThreadIdList);var i=n(t).chain().compact().map(function(e){return e.getActiveBumpLater()}).compact().value();if(this._bumpLatersShouldBeRemoved(t,i)){this._setupMenuForRemove(t,i);return}this._setupMenuForUpdatingOrCreatingBumpLater(i)},focus:function(){this._schedulerViewController.focus()},getElement:function(){return this._view.getElement()},_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=c.Widgets.Menu.create();this._view.getElement().addClass("streak__bumpLaterMenu");this._setupSchedulerViewController();this._setupReplyConditionalCheckbox()},_setupSchedulerViewController:function(){this._schedulerViewController=new c.Widgets.SchedulerViewController;this._schedulerViewController.setTitleText(c.Locale.getString("bump_later_scheduler_title")).setConfirmTimeLabelText(c.Locale.getString("bump_later_confirm_label")).setHintText(c.Locale.getString("bump_later_scheduler_hint")).showCancelButton().setDateProperty("bumpDate").setConfirmCallback(this._scheduledConfirmed.bind(this)).setCancelCallback(this._cancelBumpLater.bind(this));this._view.addSection(this._schedulerViewController.getView().getElement())},_setupReplyConditionalCheckbox:function(){this._replyConditionalCheckbox=r.widgets.getCheckbox(c.Locale.getString("bump_later_reply_condition"));var e=this;var t=this._replyConditionalCheckbox;this._replyConditionalCheckbox.on("change",function(){e._bumpLaterPatch.set("onlyBumpIfNoResponse",t.isChecked())});this._schedulerViewController.insertElementBeforeConfirmTime(this._replyConditionalCheckbox);this._replyConditionalCheckbox[0].setAttribute("tabindex",1)},_bumpLatersShouldBeRemoved:function(e,t){return e.length>1&&t.length>0},_setupMenuForRemove:function(t,n){this._schedulerViewController.getView().getElement().hide();var i=c.Locale.getString(this._hexGmailThreadIdList.length===1?"cancel_bump_later":"cancel_multiple_bump_laters");var r=this;this._removeMenuItem=this._view.addItem(i,function(){e.Model.deleteAll(n);r._stateNotifier.canceled()})},_setupMenuForUpdatingOrCreatingBumpLater:function(e){if(this._hexGmailThreadIdList.length===1){if(e.length===1){this._bumpLaterModel=e[0]}else{this._bumpLaterModel=c.Models.BumpLater.create()}}else{this._bumpLaterModel=c.Models.BumpLater.create()}this._bumpLaterPatch=this._bumpLaterModel.createPatch();this._replyConditionalCheckbox.setChecked(!!this._bumpLaterPatch.get("onlyBumpIfNoResponse"));this._schedulerViewController.setModel(this._bumpLaterPatch);if(this._bumpLaterModel.isSavedOnServer()){this._schedulerViewController.showCancelButton();this._schedulerViewController.setCancelText(c.Locale.getString("cancel_bump_later"));this._schedulerViewController.setConfirmText(c.Locale.getString("save"))}else{this._schedulerViewController.hideCancelButton();this._schedulerViewController.setConfirmText(c.Locale.getString("bump_later"))}},_scheduledConfirmed:function(){var e=this;this._bumpLaterPatch.commit();this._schedulerViewController.disable();if(this._bumpLaterModel.isSavedOnServer()){this._bumpLaterModel.save(function(){e._schedulerViewController.enable();e._stateNotifier.saved(false)},function(t){e._schedulerViewController.enable();e._stateNotifier.saved(true)});c.Tracker.track("bumpLaterUpdated",{widget:"bumpLaterButton"})}if(this._hexGmailThreadIdList.length===1){this._saveBumpLater(this._bumpLaterModel,this._hexGmailThreadIdList[0]).then(function(){e._schedulerViewController.enable();e._stateNotifier.saved(false)},function(t){e._schedulerViewController.enable();e._stateNotifier.saved(true)});c.Tracker.track("bumpLaterCreated",{widget:"bumpLaterButton",numberOfThreads:this._hexGmailThreadIdList.length})}if(this._hexGmailThreadIdList.length>1){this._createMultipleBumpLaters().then(function(){e._schedulerViewController.enable();e._stateNotifier.saved(false)},function(t){e._schedulerViewController.enable();e._stateNotifier.saved(true)});c.Tracker.track("bumpLaterCreated",{widget:"bumpLaterButton",numberOfThreads:this._hexGmailThreadIdList.length})
}c.Tracker.track("bumpLaterSaved",{widget:"bumpLaterButton"})},_createMultipleBumpLaters:function(){var t=[];for(var n=0;n<this._hexGmailThreadIdList.length;n++){var i=this._hexGmailThreadIdList[n];if(!i){continue}var r=c.Models.BumpLater.create();r.set("bumpDate",this._bumpLaterModel.get("bumpDate"));r.set("onlyBumpIfNoResponse",this._bumpLaterModel.get("onlyBumpIfNoResponse"));t.push(this._saveBumpLater(r,i))}return e.RSVP.all(t)},_saveBumpLater:function(t,n){return new e.Promise(function(e,i){var a=c.Services.Threads.ThreadStorer.getThreadMetaData(n);t.set("gmailThreadId",n);t.set("subject",a.subject);var o=n;if(a.messageIds&&a.messageIds.length>1){o=a.messageIds[1]}r.RFCMessageIdExtractor.getRFCMessageIdForThread(o,function(n){t.set("rfcMessageId",n);t.save(e,i)});c.Data.getAllBumpLaters().add(t)})},_cancelBumpLater:function(){this._bumpLaterPatch.destroy();if(this._bumpLaterModel.isSavedOnServer()){this._bumpLaterModel.del()}this._stateNotifier.canceled();c.Tracker.track("bumpLaterCanceled",{widget:"bumpLaterButton"});return}});e.DependencyManager.addFunction({functionKey:"bumpLaterOnThreadsMenuViewControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.BumpLaterOnThreadsMenuViewController",new d)},dependentFunctionKeys:["schedulerViewControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterIndicatorInboxRowManipulation",superclass:r.InboxManipulator.InboxRowManipulationBase,_memberVariables:[{name:"_bumpLaterModel",destroy:false,set:true},{name:"_threadDOMRow",destroy:false,set:true},{name:"_element",destroy:true}],_initialize:function(e,t){r.InboxManipulator.InboxRowManipulationBase.prototype._initialize.call(this);this._bumpLaterModel=e;this._threadDOMRow=t;this._setupElement()},_setupElement:function(){if(!this._threadDOMRow||!this._threadDOMRow.starHolder){return}var e=t("<span class='as ar streak__snoozeIcon'></span>");if(this._bumpLaterModel){e.removeClass("streak__snoozeIcon_scheduled")}else{e.addClass("streak__snoozeIcon_scheduled")}if(this._threadDOMRow.type==="vertical"){e.addClass("streak__snoozeIcon_indicator_verticalPreviewPane");this._threadDOMRow.starHolder.addClass("streak__snoozeIcon_holder")}else if(this._doesRowHaveAttachment()){e.addClass("streak__snoozeIcon_withAttachment")}if(this._bumpLaterModel){e[0].setAttribute("data-tooltip",c.Locale.getString("bump_later_indicator_tooltip",{date:this._bumpLaterModel.getBumpDateObject().customFormat("long")}))}if(this._threadDOMRow.attachmentsContainer){this._threadDOMRow.attachmentsContainer.addClass("streak__snoozeIcon_present")}this._element=e},_doesRowHaveAttachment:function(){return this._threadDOMRow.attachmentsContainer.find("img").length>0||this._threadDOMRow.attachmentsContainer.find(".streak__pt_eye_indicator").length>0},getManipulationType:function(){return"PREPEND_ELEMENT"},getColumnName:function(){var e="ATTACHMENTS";if(this._threadDOMRow.type==="vertical"){e="STAR"}return e},getElement:function(){return this._element}});e.DependencyManager.addFunction({functionKey:"bumpLaterIndicatorInboxRowManipulationInitialized",functionReference:function(){r.InboxManipulator.addDataSource({getRowManipulation:function(e,t){if(c.Modules.BumpLaterThreadListSearch.isYourView()){return null}var n=c.Services.Threads.ThreadStorer.getBumpLaterCollection(e);if(!n||n.length===0){return null}var i=n.getActiveBumpLater();var r=new d(i,t);return r}})},dependentFunctionKeys:["inboxManipulatorInitialized","threadsInitialized","htmlLoaded","enabledFeaturesControllerInitialized"]});i.set("BentoBox.Modules.BumpLaterIndicatorInboxRowManipulation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterThreadListProvider",superclass:r.GmailThreadListViewProvider,_memberVariables:[{name:"_defer",destroy:true}],_initialize:function(){r.GmailThreadListViewProvider.prototype._initialize.call(this)},getRelevantRequestParameters:function(){return{q:"label:all before:5001/01/01",view:"tl"}},start:function(t){this._defer=e.RSVP.defer();this._refreshAllBumpLaters()},getCrapFormatThreads:function(e,t){return this._defer.promise},_refreshAllBumpLaters:function(){c.Data.getAllBumpLaters().refresh(n.bind(this._handleBumpLatersRefreshed,this))},_handleBumpLatersRefreshed:function(){var e=this._getActiveBumpLaters();var t=n.map(e,function(e){return e.get("firstRecentRfcMessageId")});this._defer.resolve(r.GmailThreadRequester.getGmailThreadsForRFCMessageIds(t).then(this._handleGmailThreads.bind(this)))},_getActiveBumpLaters:function(){return n(c.Services.Threads.ThreadStorer.getAllBumpLaterCollections()).chain().compact().map(function(e){return e.getActiveBumpLater()}).compact().value()},_handleGmailThreads:function(e){c.Services.Threads.ThreadMetaDataCreator.processCrapFormatThreads(e);var t=this._sortGmailThreadsBasedOnBumpLaterTime(e);this._addThreadIdToSubjectSpan(t);return t},_sortGmailThreadsBasedOnBumpLaterTime:function(e){var t={};for(var i=0;i<e.length;i++){t[e[i][0]]=e[i]}var r=this._getActiveBumpLaters();var a=n.sortBy(r,function(e){return e.getBumpDateObject().getTime()});var o=[];for(i=0;i<a.length;i++){var s=a[i].get("gmailThreadId");var l=t[s];if(l){o.push(l)}}return o},_addThreadIdToSubjectSpan:function(e){for(var t=0;t<e.length;t++){e[t][7]=e[t][7].replace("<span",'<span streakthreadid="'+n.escape(e[t][0])+'"')}}});i.set("BentoBox.Modules.BumpLaterThreadListProvider",d);e.DependencyManager.addFunction({functionKey:"bumpLaterThreadListProviderInitialized",functionReference:function(){r.GmailThreadListViewRegister.registerProvider(d)},dependentFunctionKeys:["userLoggedIn","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Date,a=e.Gmail,o=e.Locale,s=e.HTML,l=e.BentoBox.Data,u=e.BentoBox;var c={BUMP_LATER_KEY:"label:all before:5001/01/01",URL_KEY:"label%3Aall+before%3A5001%2F01%2F01",SEARCH_URL:"label:all before:5001/01/01",SEARCH_REPLACEMENT:"is:snoozed"};c.BUMP_LATER_KEY_REGEX=new RegExp(c.BUMP_LATER_KEY,"img");c.REPLACE_KEY_REGEX=new RegExp(c.SEARCH_REPLACEMENT,"img");var d={CONSTANTS:c,init:function(){this._setupSearchLink();this._setupSearchBarOverride()},isYourView:function(){return location.hash==="#search/label%3Aall+before%3A5001%2F01%2F01"&&a.getMainList()&&(a.getMainList().find("[streakthreadid]").length>0||a.getMainList().find("[streakhiderow]").length>0)},_setupSearchLink:function(){a.inboxSDK.NavMenu.addNavItem({name:u.Locale.getString("bump_later_link"),routeID:a.inboxSDK.Router.NativeRouteIDs.SEARCH,routeParams:{query:c.SEARCH_URL,page:1},orderHint:1})},_setupSearchBarOverride:function(){var e=this;a.GmailSearchBarContentReplacer.addManipulation({applyDisplayManipulation:function(e){return e.replace(c.BUMP_LATER_KEY_REGEX,c.SEARCH_REPLACEMENT)},applyValueManipulation:function(e){return e.replace(c.REPLACE_KEY_REGEX,'"'+c.BUMP_LATER_KEY+'"')}})},_doesURLHaveTrackingSearch:function(){return location.hash.indexOf(c.URL_KEY)>-1}};e.DependencyManager.addFunction({functionKey:"bumpLaterThreadListSearchInitialized",functionReference:d.init,functionContext:d,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","enabledFeaturesControllerInitialized"]});u.Modules.BumpLaterThreadListSearch=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterThreadListInboxRowManipulation",superclass:r.InboxManipulator.InboxRowManipulationBase,_memberVariables:[{name:"_bumpLater",destroy:false},{name:"_threadDOMRow",destroy:false},{name:"_element",destroy:true},{name:"_originalDate",destroy:false}],_initialize:function(e,t){r.InboxManipulator.InboxRowManipulationBase.prototype._initialize.call(this);this._bumpLater=e;this._threadDOMRow=t},getManipulationType:function(){return"REPLACE_CONTENT"},getColumnName:function(){return"DATE"},getElement:function(){if(this._element){return this._element}this._element=t(document.createElement("span"));var n;var i=e.moment(this._bumpLater.get("bumpDate"));var r=this._bumpLater.getBumpDateObject().customFormat("pixelTrack");var a=c.Locale.getString("returning_in",{date:i.fromNow(true)});if(this._bumpLater.getBumpDateObject().isPast()){a=c.Locale.getString("returning_in",{date:c.Locale.getString("any_second_now")})}n='<span class="streak__pixelTrackerRecentViews_readDate" title="'+r+'">'+a+"</span>";if(this._threadDOMRow.isUnread){n="<b>"+n+"</b>"}this._element[0].innerHTML=n;return this._element}});e.DependencyManager.addFunction({functionKey:"bumpLaterThreadListInboxRowManipulationInitialized",functionReference:function(){r.InboxManipulator.addDataSource({getTableManipulation:function(){if(!c.Modules.BumpLaterThreadListSearch.isYourView()){return null}if(r.isVerticalSplitPreviewPane()){return null}return{type:"COLUMN_WIDTH",columnName:"DATE",width:175}},getRowManipulation:function(e,t){if(!c.Modules.BumpLaterThreadListSearch.isYourView()){return null}var n=c.Services.Threads.ThreadStorer.getBumpLaterCollection(e);if(!n){return null}var i=n.getActiveBumpLater();if(!i){return null}var r=new d(i,t);return r}})},dependentFunctionKeys:["inboxManipulatorInitialized","threadsInitialized","htmlLoaded","enabledFeaturesControllerInitialized"]});i.set("BentoBox.Modules.BumpLaterThreadListInboxRowManipulation",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterSidebarView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=o.get("bumpLaterSidebar",true)},hideActiveBumpLater:function(){this._element.find(".streak__bumpLaterSidebar_active").hide()},showActiveBumpLater:function(){this._element.find(".streak__bumpLaterSidebar_active").show()},setActiveBumpLaterView:function(e){this._element.find(".streak__bumpLaterSidebar_activeEntry").html(e.getElement())},setEditActiveBumpLaterButton:function(e){this._element.find(".streak__bumpLaterSidebar_editButton").html(e.getElement())},setDeleteActiveBumpLaterButton:function(e){this._element.find(".streak__bumpLaterSidebar_deleteButton").html(e.getElement())},clearPastBumpLaters:function(){this._element.find(".streak__bumpLaterSidebar_pastEntries").empty()},addBumpLaterView:function(e){this._element.find(".streak__bumpLaterSidebar_pastEntries").append(e.getElement())},hidePastBumpLaterList:function(){this._element.find(".streak__bumpLaterSidebar_past").hide()},showPastBumpLaterList:function(){this._element.find(".streak__bumpLaterSidebar_past").show()}});i.set("BentoBox.Modules.BumpLaterSidebarView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BumpLaterSidebarViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_bumpLaterCollection",destroy:false,set:true},{name:"_threadMetaData",destroy:false},{name:"_bumpLaterModel",destroy:false},{name:"_editBumpLaterButton",destroy:true},{name:"_deleteBumpLaterButton",destroy:true}],_initialize:function(t,n){e.UI.ViewController.prototype._initialize.call(this);this._setupEditBumpLaterButton();this._setupDeleteBumpLaterButton();this._threadMetaData=n;this.setBumpLaterCollection(t)},_setupView:function(){this._view=new c.Modules.BumpLaterSidebarView},setBumpLaterCollection:function(e){this._bumpLaterModel=null;this._bumpLaterCollection=e;this._render();e.watch("change",this._render,this)},_setupEditBumpLaterButton:function(){var e=this;this._editBumpLaterButton=c.Widgets.Buttons.ButtonFactory.createMenuButton({type:"Text",color:"blue",text:c.Locale.getString("edit_bump_later"),isFixedPosition:true,isRightAligned:true,menu:c.Modules.BumpLaterOnThreadsMenuViewController,preOnFunction:function(){c.Modules.BumpLaterOnThreadsMenuViewController.use(e);c.Tracker.track("bumpLaterMenuShow",{widget:"sidebar"})},postOnFunction:function(){c.Modules.BumpLaterOnThreadsMenuViewController.focus()}});this._view.setEditActiveBumpLaterButton(this._editBumpLaterButton)},saved:function(){this._editBumpLaterButton.off();this._renderActiveBumpLater()},canceled:function(){this._editBumpLaterButton.off()},_setupDeleteBumpLaterButton:function(){var e=this;this._deleteBumpLaterButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:c.Locale.getString("cancel"),onFunction:function(){if(e._bumpLaterModel&&e._bumpLaterModel.isSavedOnServer()){e._bumpLaterModel.del()}}});this._view.setDeleteActiveBumpLaterButton(this._deleteBumpLaterButton)},_render:function(){if(this._bumpLaterCollection){this._bumpLaterModel=this._bumpLaterCollection.getActiveBumpLater()}else{this.destroy();return}this._renderPastBumpLaters();if(this._bumpLaterModel){this._renderActiveBumpLater()}else{this._view.hideActiveBumpLater()}},_renderPastBumpLaters:function(){var e=false;this._view.clearPastBumpLaters();for(var t=0;t<this._bumpLaterCollection.length;t++){var n=this._bumpLaterCollection[t];if(n.isActive()){continue}var i=this._renderBumpLater(n);this._view.addBumpLaterView(i);e=true}if(e){this._view.showPastBumpLaterList()}else{this._view.hidePastBumpLaterList()}},_renderActiveBumpLater:function(){this._view.showActiveBumpLater();var e=this._renderBumpLater(this._bumpLaterModel);this._view.setActiveBumpLaterView(e)},_renderBumpLater:function(t){var n=new c.Widgets.DetailListEntryView;n.addIconClass("streak__snoozeIcon").setText(e.moment(t.getBumpDateObject()).fromNow()).setTextTooltip(t.getBumpDateObject().customFormat("pixelTrack"));if(t.get("onlyBumpIfNoResponse")){n.setExtraDetailsText(c.Locale.getString("bump_later_reply_condition"))}return n}});e.DependencyManager.addFunction({functionKey:"bumpLaterSidebarViewControllerInitialized",functionReference:function(){i.set("BentoBox.Modules.BumpLaterSidebarViewController",d)},dependentFunctionKeys:["schedulerViewControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Date,r=e.Eventer,a=e.Gmail,o=e.Model,s=e.Collection,l=e.BentoBox;var u=e.Class.subclass({className:"BumpLaterSidebarController",superclass:e.Object,_memberVariables:[{name:"_sidebarInjector",destroy:true},{name:"_sidebarOptions",destroy:false},{name:"_bumpLaterSidebarViewController",destroy:true}],_initialize:function(e){this._sidebarOptions={title:l.Locale.getString("bump_later"),iconClass:"streak__snoozeIcon",el:document.createElement("div"),orderHint:4};this._sidebarInjector=new l.Controllers.SidebarInjector(e,{notificationCenterEventName:"threadStorerDataChanged",notificationCenterFilterValueType:"bumpLaterCollection",checkState:this._handleBumpLaterCollectionSet.bind(this),destroy:this.destroy.bind(this)})},_handleBumpLaterCollectionSet:function(e,t){var n;if(t){n=t.value}else{n=l.Services.Threads.ThreadStorer.getBumpLaterCollection(e)}this._loadBumpLaterSidebarViewController(n,e)},_loadBumpLaterSidebarViewController:function(e,t){var n=l.Services.Threads.ThreadStorer.getThreadMetaData(t);if(!e||e.length===0){this._destroySidebar();return}else{if(this._bumpLaterSidebarViewController){this._bumpLaterSidebarViewController.setBumpLaterCollection(e)}else{this._bumpLaterSidebarViewController=new l.Modules.BumpLaterSidebarViewController(e,n);this._sidebarOptions.el.appendChild(this._bumpLaterSidebarViewController.getView().getElement()[0]);this._sidebarInjector.addSidebar(this._sidebarOptions)}}},_destroySidebar:function(){if(this._bumpLaterSidebarViewController){this._bumpLaterSidebarViewController.destroy();this._bumpLaterSidebarViewController=null;this._sidebarInjector.removeSidebar()}}});e.DependencyManager.addFunction({functionKey:"bumpLaterSidebarControllerInitialized",functionReference:function(){a.inboxSDK.Conversations.registerThreadViewHandler(function(e){new u(e)})},dependentFunctionKeys:["gmailLoaded"]});l.Controllers.BumpLaterSidebarController=u})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"DetailListEntryView",superclass:e.UI.View,_memberVariables:[],addIconClass:function(e){this._element.find(".streak__detailListEntry_icon").addClass(e);return this},addIconTooltip:function(e){this._element.find(".streak__detailListEntry_icon")[0].setAttribute("data-tooltip",e);return this},setText:function(e){this._element.find(".streak__detailListEntry_text").text(e);return this},setTextTooltip:function(e){this._element.find(".streak__detailListEntry_text")[0].setAttribute("data-tooltip",e);return this},setExtraDetailsText:function(e){this._element.find(".streak__detailListEntry_extraDetailsText").text(e);return this},_initialize:function(t){if(!d.prototype.template){d.prototype.template=o.get("detailListEntry")}e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("streak__detailListEntry");this._element[0].innerHTML=d.prototype.template()}});i.set("BentoBox.Widgets.DetailListEntryView",d)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.NotificationCenter,o=e.DependencyManager,s=e.BentoBox;var l=r.GmailThreadListViewProvider;var u=e.Class.subclass({className:"AwaitingReplyThreadListProvider",superclass:l,_memberVariables:[{name:"_promise",destroy:true}],getRelevantRequestParameters:function(){return{q:"label:all before:5002/01/01",view:"tl"}},start:function(t){var n=this;this._promise=e.APIRequester.get("email/awaitingreply").getPromise().then(function(e){return r.GmailThreadRequester.getGmailThreadsForRFCMessageIds(e)}).then(function(e){s.Services.Threads.ThreadMetaDataCreator.processCrapFormatThreads(e);n._addThreadIdToSubjectSpan(e);return e})},getCrapFormatThreads:function(e,t){return this._promise},_addThreadIdToSubjectSpan:function(e){for(var t=0;t<e.length;t++){e[t][7]=e[t][7].replace("<span",'<span streakthreadid="'+n.escape(e[t][0])+'"')}}});i.set("BentoBox.Modules.AwaitingReplyThreadListProvider",u);e.DependencyManager.addFunction({functionKey:"awaitingReplyThreadListProviderInitialized",functionReference:function(){r.GmailThreadListViewRegister.registerProvider(u)},dependentFunctionKeys:["userLoggedIn","enabledFeaturesControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Date,a=e.Gmail,o=e.Locale,s=e.HTML,l=e.BentoBox.Data,u=e.BentoBox;var c={AWAITING_REPLY_KEY:"label:all before:5002/01/01",URL_KEY:"label%3Aall+before%3A5002%2F01%2F01",SEARCH_URL:"label:all before:5002/01/01",SEARCH_REPLACEMENT:"is:awaiting"};c.AWAITING_REPLY_KEY_REGEX=new RegExp(c.AWAITING_REPLY_KEY,"img");c.REPLACE_KEY_REGEX=new RegExp(c.SEARCH_REPLACEMENT,"img");var d={CONSTANTS:c,init:function(){this._setupSearchLink();this._setupSearchBarOverride()},_setupSearchLink:function(){a.inboxSDK.NavMenu.SENT_MAIL.addNavItem({name:u.Locale.getString("awaiting_reply_link"),routeID:a.inboxSDK.Router.NativeRouteIDs.SEARCH,routeParams:{query:c.SEARCH_URL,page:1},orderHint:3})},_setupSearchBarOverride:function(){var e=this;a.GmailSearchBarContentReplacer.addManipulation({applyDisplayManipulation:function(e){return e.replace(c.AWAITING_REPLY_KEY_REGEX,c.SEARCH_REPLACEMENT)},applyValueManipulation:function(e){return e.replace(c.REPLACE_KEY_REGEX,'"'+c.AWAITING_REPLY_KEY+'"')}})},_doesURLHaveTrackingSearch:function(){return location.hash.indexOf(c.URL_KEY)>-1}};e.DependencyManager.addFunction({functionKey:"awaitingReplyThreadListSearchInitialized",functionReference:d.init,functionContext:d,dependentFunctionKeys:["gmailLoaded","htmlLoaded","localeLoaded","enabledFeaturesControllerInitialized","pixelTrackerSearchInitialized"]});u.Modules.AwaitingReplyThreadListSearch=d})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailBodySpanLinkFixer",superclass:r.GmailEmailBodyManipulation,_memberVariables:[],_initialize:function(){r.GmailEmailBodyManipulation.prototype._initialize.call(this)},applyBodyManipulation:function(e){var i=this;var r=e.find('span[hspace*="streak-'+this._getSpanType()+'"]');n.each(r,function(e){var n=i._getSpanKey(e);if(i._isKeyValid(n)){i._replaceSpanWithClickableLink(t(e),n)}})},_getSpanType:function(){throw new Error("must define span type")},_getSpanKey:function(e){var t=e.getAttribute("hspace");var i=t.split("-");if(i.length<3){return null}else if(i.length>3){return n.drop(i,2).join("-")}else{return i[2]}},_replaceSpanWithClickableLink:function(e,n){var i=t('<a href="#">');e.before(i);e.detach();i.append(e);var r=this;i.click(function(e){r._linkClicked(n);e.preventDefault();e.stopPropagation()})}});i.set("BentoBox.Modules.EmailBodySpanLinkFixer",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailBodyBoxLinkFixer",superclass:c.Modules.EmailBodySpanLinkFixer,_memberVariables:[],_initialize:function(){r.GmailEmailBodyManipulation.prototype._initialize.call(this)},_getSpanType:function(){return"box"},_isKeyValid:function(e){var t=c.Data.getBox(e);if(!t){return false}this._associateReminderBoxKeyWithThreadId(e);return true},_associateReminderBoxKeyWithThreadId:function(e){var t=r.getActiveHexGmailThreadIdList(c.Services.Threads.HexGmailThreadIdExtractor);if(t.length>0){c.Services.Threads.ThreadStorer.setReminderBoxKey(t[0],e)}},_linkClicked:function(e){var t=c.Data.getBox(e);r.inboxSDK.Router.goto(t.link())}});i.set("BentoBox.Modules.EmailBodyBoxLinkFixer",d);r.GmailEmailBodyManipulator.registerManipulation(new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailBodyHelpTourLinkFixer",superclass:c.Modules.EmailBodySpanLinkFixer,_memberVariables:[],_initialize:function(){r.GmailEmailBodyManipulation.prototype._initialize.call(this)},_getSpanType:function(){return"helpChapter"},applyBodyManipulation:function(e){c.Modules.EmailBodySpanLinkFixer.prototype.applyBodyManipulation.call(this,e);this._findAndReplaceHelpChaptersInText(e)},_findAndReplaceHelpChaptersInText:function(e){n.each(e,this._findAndReplaceTourNames.bind(this))},_tourNameRegex:/(tour:\s?)"([^"\n]*)"/gi,_findAndReplaceTourNames:function(e){if(e.nodeType===Node.TEXT_NODE&&this._tourNameRegex.test(e.data)){this._breakTourNamesFromTextNode(e)}else{n.each(e.childNodes,this._findAndReplaceTourNames.bind(this))}},_breakTourNamesFromTextNode:function(e){var n=t(e);var i=e.data;var r=0;var a;var o=null;var s=function(e){if(e.length==0)return;if(o){o.data+=e}else{o=document.createTextNode(e);n.before(o)}};this._tourNameRegex.lastIndex=0;while(a=this._tourNameRegex.exec(i)){s(i.slice(r,a.index));r=this._tourNameRegex.lastIndex;var l=a[1];var u=a[2];if(this._isKeyValid(u)){s(l);n.before(this._newClickableLinkOfTour(u));o=null}else{s(a[0])}}s(i.slice(r));n.remove()},_isKeyValid:function(e){return c.Modules.Help.HelpLoader.getHelpViewController().doesChapterExist(e)},_newClickableLinkOfTour:function(e){var n=t("<a href='#' />").text(e);var i=this;n.click(function(t){c.Tracker.track("tourTextLinkClicked",{tourName:e});i._linkClicked(e);t.preventDefault();t.stopPropagation()});return n},_linkClicked:function(e){c.Modules.Help.HelpLoader.getHelpViewController().startChapter(e)}});e.DependencyManager.addFunction({functionKey:"emailBodyHelpTourLinkFixerInitialized",functionReference:function(){i.set("BentoBox.Modules.EmailBodyHelpTourLinkFixer",d);r.GmailEmailBodyManipulator.registerManipulation(new d)},dependentFunctionKeys:["helpLoaderInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailBodyPipelineLinkFixer",superclass:c.Modules.EmailBodySpanLinkFixer,_memberVariables:[],_initialize:function(){r.GmailEmailBodyManipulation.prototype._initialize.call(this)},_getSpanType:function(){return"pipeline"},_isKeyValid:function(e){var t=c.Data.getPipeline(e);return!!t},_linkClicked:function(e){var t=c.Data.getPipeline(e);r.inboxSDK.Router.goto(t.link())}});i.set("BentoBox.Modules.EmailBodyPipelineLinkFixer",d);r.GmailEmailBodyManipulator.registerManipulation(new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"StreakLinkFixer",superclass:r.GmailEmailBodyManipulation,_memberVariables:[],_initialize:function(){e.Gmail.GmailEmailBodyManipulation.prototype._initialize.call(this)},applyBodyManipulation:function(e){var t=e.find('a[href*="streak.com"]');n.each(t,this._convertStreakLinkToGmailLink,this);var i=e.find('a[href*="mail.google.com"]');n(i).filter(this.isLinkRelevant,this).each(this._overrideClickEvent,this)},_convertStreakLinkToGmailLink:function(e){var t=e.href.match(/^https?:\/\/(www\.)?streak\.com\/?#(.+)/);if(t){e.href=document.URL.split("#")[0]+"#"+t[2]}},isLinkRelevant:function(e){var t=e.href.split("#");var n=t[0];var i=t[1];return t.length===2&&n.indexOf("mail.google.com")!==-1&&c.UI.isBentoBoxView(r.getStoredView(i.split("/")))},_overrideClickEvent:function(e){t(e).click(function(t){c.UI.setURL(e.href.split("#")[1]);t.preventDefault();t.stopPropagation()})}});i.set("BentoBox.Modules.StreakLinkFixer",d);r.GmailEmailBodyManipulator.registerManipulation(new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"EmailBodyInlineImageResizer",superclass:r.GmailEmailBodyManipulation,_memberVariables:[],_initialize:function(){e.Gmail.GmailEmailBodyManipulation.prototype._initialize.call(this)},applyBodyManipulation:function(e){var n=e.find("img");var i=[];for(var r=0;r<n.length;r++){var a=t(n[r]);if(!a[0].complete){i.push(a);continue}if(!this._isImgElementRelevant(a)){continue}this._addResizeToImg(a)}if(i.length>0){this._waitForIncompleteImages(i)}},_isImgElementRelevant:function(e){if(e[0].naturalWidth>e[0].width||e[0].naturalHeight>e[0].height){return e.parent(".streak__imageResizeWrapper").length===0}},_waitForIncompleteImages:function(e){var t=this;n.each(e,function(e){e[0].addEventListener("load",function(){if(t._isImgElementRelevant(e)&&e.isInBody()){t._addResizeToImg(e)}})})},_addResizeToImg:function(e){var n=t(document.createElement("span"));n.addClass("streak__imageResizeWrapper");var i=t('<span class="GI T-I T-I-awv GJ streak__imgeResizeButton">'+c.Locale.getString("expand")+"</span>");i.easyHoverClass("GK");i.hide();n.hover(function(){i.show()},function(){i.hide()});var r={height:e[0].height,width:e[0].width};var a={height:e[0].naturalHeight,width:e[0].naturalWidth};var o=false;i.click(function(t){o=!o;var n=o?a:r;e[0].width=n.width;e[0].height=n.height;i.text(c.Locale.getString(o?"mm_restore":"expand"));t.stopImmediatePropagation();t.preventDefault()});e.before(n);n.append(e);n.append(i)}});e.DependencyManager.addFunction({functionKey:"EmailBodyInlineImageResizerInitialized",functionReference:function(){i.set("BentoBox.Modules.EmailBodyInlineImageResizer",d);r.GmailEmailBodyManipulator.registerManipulation(new d)},dependentFunctionKeys:["localeLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SpreadsheetFormulaView",superclass:e.UI.View,_memberVariables:[{name:"_scopeChooserElement",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this.addClass("streak__spreadsheetFormula");this._setupScopeChooser();this.getElement().append(this._scopeChooserElement)},_setupScopeChooser:function(){this._scopeChooserElement=o.getElement("formulaScopeChooser");this._bindHelpLink();this._bindScopeLinks()},_bindHelpLink:function(){var e=this;this._scopeChooserElement.find(".streak__formulaScopeChooser_helpButton")[0].addEventListener("click",function(t){e._delegate.helpButtonClicked()},true)},_bindScopeLinks:function(){var e=this;this._scopeChooserElement.find(".streak__formulaScopeChooser_all")[0].addEventListener("click",function(t){e._delegate.allScopeClicked()},true);this._scopeChooserElement.find(".streak__formulaScopeChooser_stage")[0].addEventListener("click",function(t){e._delegate.stageScopeClicked()},true);this._scopeChooserElement.find(".streak__formulaScopeChooser_box")[0].addEventListener("click",function(t){e._delegate.boxScopeClicked()},true)},setTextInputView:function(e){this.prependSubView(e)},showAllScopeActive:function(){this._resetActiveScope();this._scopeChooserElement.find(".streak__formulaScopeChooser_all").addClass("streak__formulaScopeChooser_active")},showStageScopeActive:function(){this._resetActiveScope();this._scopeChooserElement.find(".streak__formulaScopeChooser_stage").addClass("streak__formulaScopeChooser_active")},showBoxScopeActive:function(){this._resetActiveScope();this._scopeChooserElement.find(".streak__formulaScopeChooser_box").addClass("streak__formulaScopeChooser_active")},_resetActiveScope:function(){this._scopeChooserElement.find(".streak__formulaScopeChooser_links > span").removeClass("streak__formulaScopeChooser_active")}});i.set("BentoBox.Widgets.SpreadsheetFormulaView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"SpreadsheetFormulaViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_scope",destroy:false},{name:"_stageKey",destroy:false},{name:"_gmailTextareaViewController",destroy:true},{name:"_formulaHelpViewController",destroy:true},{name:"_options",destroy:false},{name:"_model",destroy:false},{name:"_property",destroy:false},{name:"_currentValue",destroy:false}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._formulaHelpViewController=new d.Widgets.FormulaHelpViewController},_setupView:function(){this._view=new d.Widgets.SpreadsheetFormulaView;this._setupTextInput()},_setupTextInput:function(){this._gmailTextareaViewController=new d.Widgets.GmailTextareaViewController({plainTextOnly:true,multiline:true,noBorder:true});this._view.setTextInputView(this._gmailTextareaViewController.getView());this._gmailTextareaViewController.getEventStream().onValue(this,"_gmailTextareaEvent")},_gmailTextareaEvent:function(e){if(e.eventName!=="keydown"){return}var t=this;var n=e.event;var r=this.getElement();if(i.is("escape",n)){t._gmailTextareaViewController.setText(t._currentValue);r.trigger("escapePressed")}else if(i.is("ctrl+enter/cmd+enter/meta+enter",n)){this._gmailTextareaViewController.insertTextAtCursor("\n")}else if(i.is("enter",n)){r.trigger("enterPressed")}},setup:function(e){this._pipeline=e.pipeline;this._box=e.box;this._stageKey=e.stageKey;this._scope=null;this._initialScope=null;this._options=e;this._model=e.model;this._property=e.property;this._determineScope()},focus:function(){var e=this;setTimeout(function(){e._formulaHelpViewController.activate();e._focus()},100);this._focus()},_focus:function(){this._currentValue=this.getValue();this._gmailTextareaViewController.focus();this._gmailTextareaViewController.setCursorToEnd()},set:function(e){this._gmailTextareaViewController.setText(e);this.focus()},getValue:function(){return this._currentValue},updateValue:function(){this._formulaHelpViewController.deactivate();
try{if(!this._gmailTextareaViewController.getText()&&!this._currentValue){return}}catch(e){return}var t=r.get("BentoBox.Services.FormulaColumnLimiter");if(t.isLocked()){t.showGateway();return}t.incrementUsage();this.track();var n=this._stripEqualSign();if(this._scope===this._initialScope){if(this._gmailTextareaViewController.getText()===(this._currentValue||"").trim()){return}}var i=this._model.getRelevantFormula(this._scope,this._stageKey,this._box);this._markBoxesUpdating(n,i);this._model.setAndSaveFormulaSection(this._scope,this._stageKey,this._box,n)},allScopeClicked:function(){this._setScopeToAll()},stageScopeClicked:function(){this._setScopeToStage()},boxScopeClicked:function(){this._setScopeToBox()},_determineScope:function(){if(this._model.doesFormulaSectionExistForBox(this._box)){this._setScopeToBox()}else if(this._model.doesFormulaSectionExistForStage(this._stageKey)){this._setScopeToStage()}else{this._setScopeToAll()}this._initialScope=this._scope},_setScopeToAll:function(){this._scope="ALL";this._updateDisplay()},_setScopeToStage:function(){this._scope="STAGE";this._updateDisplay()},_setScopeToBox:function(){this._scope="BOX";this._updateDisplay()},_updateDisplay:function(){if(this._scope==="ALL"){this._view.showAllScopeActive()}else if(this._scope==="STAGE"){this._view.showStageScopeActive()}else if(this._scope==="BOX"){this._view.showBoxScopeActive()}this._setupCursorOutline();this._setCurrentValue();this._gmailTextareaViewController.focus()},_setupCursorOutline:function(){this._options.cursor.removeCursorRange("streak__cursorAffect");switch(this._scope){case"ALL":this._options.cursor.addCursorRange({startCoord:[1,this._options.coord[1]],endCoord:[this._options.tableModel.getNumberOfNonHeaderRows(),this._options.coord[1]],cssClass:"streak__cursorAffect"});break;case"STAGE":var e=this._options.tableModel.getRowOfNextGroup(this._stageKey);if(e===-1){this._options.spreadsheetRedrawFunction();return}this._options.cursor.addCursorRange({startCoord:[this._options.coord[0]+1,this._options.coord[1]],endCoord:[e-1,this._options.coord[1]],cssClass:"streak__cursorAffect"});break}this._options.spreadsheetRedrawFunction()},_setCurrentValue:function(){this._currentValue="= "+this._model.getRelevantFormula(this._scope,this._stageKey,this._box);this._gmailTextareaViewController.setText(this._currentValue)},_stripEqualSign:function(){var e=this._gmailTextareaViewController.getText();if(!e.match(/\s*\=.*/)){return e}return e.replace(/\s*\=\s*(.*)/,"$1")},_markBoxesUpdating:function(e,t){var i;if(this._scope===this._initialScope){i=this._scope}else{if(e===t){i=this._initialScope}else{i=this._scope}}this._box.markFieldCalculating(this._model.key());var r=this;switch(i){case"STAGE":n.chain(d.Data.getPipelineBoxes(this._pipeline.key())).filter(function(e){return e.get("stageKey")===r._stageKey}).each(function(e){e.markFieldCalculating(r._model.key())});break;case"ALL":n.chain(d.Data.getPipelineBoxes(this._pipeline.key())).filter(function(e){if(r._model.doesFormulaSectionExistForBox(e)){return false}if(r._model.doesFormulaSectionExistForStage(e.get("stageKey"))){return false}return true}).each(function(e){e.markFieldCalculating(r._model.key())});break}this._options.spreadsheetRedrawFunction()},helpButtonClicked:function(){this._formulaHelpViewController.forceOpen()},preDetach:function(){this._options.cursor.removeCursorRange("streak__cursorAffect");this._options.spreadsheetRedrawFunction()},getElement:function(){return this._view.getElement()},track:function(){d.Tracker.trackStreakActive({property:this._property,widget:"spreadsheetFormula"})}});r.set("BentoBox.Widgets.SpreadsheetFormulaViewController",h)})(Streak);(function(e){var t=e._,n=e.Library,i=e.DependencyManager,r=e.BentoBox,a=e.Locale;var o=1;var s=e.Class.subclass({superclass:e.BentoBox.Services.FeatureLimiter,_memberVariables:[],_initialize:function(){e.BentoBox.Services.FeatureLimiter.prototype._initialize.call(this)},_getFeatureKey:function(){return"formulaFields"},_getGatewayTitle:function(){return a.getString("formula_column_gateway_title")},_getGatewayBodyText:function(){return a.getString("formula_column_gateway_text")},_getLimit:function(){return o}});i.addFunction({functionKey:"FormulaColumnLimiterInitialized",functionReference:function(e){n.set("BentoBox.Services.FormulaColumnLimiter",new s)},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"InboxListView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._rowTemplate=o.get("inboxListRow")},_setupElement:function(){this._element=o.getElement("inboxList")},empty:function(){this._element.find(".streak__inboxListEntries").empty()},addEntry:function(e){var n=t(this._rowTemplate(e));this._element.find(".streak__inboxListEntries").append(n);if(e.clickCallback){n.click(e.clickCallback)}}});i.set("BentoBox.Widgets.InboxListView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"InboxListViewController",superclass:e.UI.ViewController,_memberVariables:[],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.InboxListView")},empty:function(){this._view.empty()},addEntry:function(e){this._view.addEntry(e)}});i.set("BentoBox.Widgets.InboxListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=r.GmailThreadListViewProvider;var h=e.Class.subclass({className:"HexGmailThreadIdAdderThreadListProvider",superclass:d,_memberVariables:[],_initialize:function(){d.prototype._initialize.call(this)},getRelevantRequestParameters:function(){return{view:"tl"}},isCustomList:function(){return false},start:function(e){},getCrapFormatThreads:function(t,n){var i=this;return new e.RSVP.Promise(function(e,t){e(i._getThreadsWithHexGmailThreadIdsAdded(n))})},_getThreadsWithHexGmailThreadIdsAdded:function(e){var t=r.ThreadResponseProcessor.extractThreads(e);if(!t){return null}for(var n=0;n<t.length;n++){var i=t[n];i[15]="streakthreadid "+i[0]}return t}});e.DependencyManager.addFunction({functionKey:"hexGmailThreadIdAdderThreadListProviderInitialized",functionReference:function(){if(!c.isFeatureEnabled("hexGmailThreadIdAdder")&&!r.isVerticalSplitPreviewPane()){return}i.set("BentoBox.HexGmailThreadIdAdderThreadListProvider",h);r.GmailThreadListViewRegister.registerProvider(h)},dependentFunctionKeys:["enabledFeaturesControllerInitialized","gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SmartCheckboxViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_model",destroy:false},{name:"_property",destroy:false},{name:"_unsubscribeFunction",destroy:false}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._model=t.model;this._property=t.property;this._subscribeToModelEventStream();this._subscribeToViewEventStream();this._view.setIsChecked(!!this._model.get(this._property))},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.GmailCheckboxView");this._view.addClass("smartInput")},_subscribeToModelEventStream:function(){var e=this;this._unsubscribeFunction=this._model.getEventStream().filter(function(t){return t.property===e._property&&t.eventName==="set"}).map(function(e){return!!e.newValue}).onValue(function(t){e._view.setIsChecked(t)})},_subscribeToViewEventStream:function(){var e=this;this._view.getEventStream().onValue(function(t){var n=t.isChecked;e._model.set(e._property,n);e._model.save();c.Tracker.track("boxDataEdited",{widget:"smartCheckbox"})})},focus:function(){this._view.focus()},getElement:function(){return this._view.getElement()},setEnabled:function(e){this._view.setEnabled(e)},destroy:function(){if(this._unsubscribeFunction){this._unsubscribeFunction()}e.UI.ViewController.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.SmartCheckboxViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SmartTextDropdownModel",superclass:c.Widgets.ListView.ListViewBaseModel,_memberVariables:[{name:"_text",destroy:false},{name:"_currentlySelectedKey",destroy:false},{name:"_optionSource",destroy:false,set:true},{name:"_listRows",destroy:true},{name:"_shouldHighlight",destroy:true,defaultValue:false}],_initialize:function(){c.Widgets.ListView.ListViewBaseModel.prototype._initialize.call(this)},setText:function(e){this._text=e.trim();this._refresh()},setCurrentlySelectedKey:function(e){this._currentlySelectedKey=e;this._refresh()},_refresh:function(){this._sections=[];var e=this._currentlySelectedKey;this._text=this._text||"";var t=this._text;var i=this._text.toLowerCase();var r=false;var a=this;this._shouldHighlight=false;this._listRows=n.chain(this._optionSource.getOptions()).map(function(n){r=r||n.name===t;var o=i.length>0&&n.name.toLowerCase().indexOf(i)===0;a._shouldHighlight=a._shouldHighlight||o;return{text:n.name,option:n,isHighlighted:o,isSelected:n.key===e}}).value();if(this._listRows.length===0&&!this._text){this._addNoOptionsMessageSection();this._sections.push({isSeparator:true})}else if(this._listRows.length>0){this._sections.push({rows:this._listRows});this._sections.push({isSeparator:true})}var o=r||!i;this._addCreateOptionSection(o);this._callDelegateFunction("dataChanged")},_addNoOptionsMessageSection:function(){this._sections.push({isFreeForm:true,element:'<div class="streak__listViewRow_disabled streak__dropdown_noOptions">'+c.Locale.getString("dropdown_no_options")+"</div>"})},_addCreateOptionSection:function(e){var t;if(this._text&&!e){t=c.Locale.getString("dropdown_create_text_option",{option:this._text})}else{t=c.Locale.getString("dropdown_create_option")}this._sections.push({rows:[{text:t,isCreateNew:true,isDisabled:e,optionName:this._text,displayClass:e?"streak__listViewRow_disabled":null,isNotHighlightable:e}]})},isSectionSeparator:function(e){return this._sections[e].isSeparator},isSectionFreeForm:function(e){return this._sections[e].isFreeForm},getSectionFreeFormElement:function(e){return this._sections[e].element},dontHighlightOnDataChange:function(){return!this._shouldHighlight}});i.set("BentoBox.Widgets.SmartTextDropdownModel",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SmartTextDropdownViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_model",destroy:false},{name:"_property",destroy:false},{name:"_optionSource",destroy:false},{name:"_unsubscribeFunction",destroy:true},{name:"_gmailTextareaViewController",destroy:true},{name:"_listViewController",destroy:true},{name:"_menuListWrapper",destroy:true},{name:"_smartTextDropdownModel",destroy:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._view.getElement().addClass("smartInput streak__smartTextDropdown");this._model=t.model;this._property=t.property;this._optionSource=t.optionSource;this._smartTextDropdownModel=new c.Widgets.SmartTextDropdownModel;this._smartTextDropdownModel.setOptionSource(this._optionSource);this._setupViewControllers();this._subscribeToViewControllerEventStreams();this._subscribeToModelEventStream();this._bindToViewEvents();this._displayValue(this._model.get(this._property))},setEnabled:function(e){this._gmailTextareaViewController.setEnabled(e)},_setupViewControllers:function(){this._listViewController=new c.Widgets.ListView.ListViewViewController;this._listViewController.setDataSource(this._smartTextDropdownModel);this._menuListWrapper=c.Widgets.Menu.create();this._menuListWrapper.addSection(this._listViewController.getView().getElement());this._menuListWrapper.getElement().addClass("streak__smartTextDropdown_menu");this._gmailTextareaViewController=new c.Widgets.GmailTextareaViewController({plainTextOnly:true,multiline:false});this._gmailTextareaViewController.addDelegate(this._listViewController);this._view.addSubView(this._gmailTextareaViewController.getView())},_subscribeToViewControllerEventStreams:function(){var t=this;var n=this._gmailTextareaViewController.getEventStream().filter(function(e){return e.eventName==="focus"||e.eventName==="blur"}).toProperty();var i=this._gmailTextareaViewController.getEventStream().filter(function(e){return e.eventName==="blur"}).delay(150);var r=n.sampledBy(i);i.combine(r,function(e,t){return e.eventName===t.eventName}).filter(function(e){return e}).onValue(function(){if(!t._optionSource){return}t._detachMenu();var e=t._optionSource.getOption(t._model.get(t._property));if(e){t._gmailTextareaViewController.setText(e.name)}else{t._gmailTextareaViewController.setText("")}});this._gmailTextareaViewController.getEventStream().filter(function(e){return e.eventName==="focus"}).delay(10).onValue(function(){t._selectAllText()});this._gmailTextareaViewController.getEventStream().filter(function(e){return e.eventName==="focus"||e.eventName==="click"}).onValue(function(e){t._displayMenu();t._smartTextDropdownModel.setText(e.text)});this._gmailTextareaViewController.getEventStream().filter(function(e){return e.eventName==="input"}).onValue(function(e){t._displayMenu();t._smartTextDropdownModel.setText(e.text)});this._gmailTextareaViewController.getEventStream().filter(function(t){return t.eventName==="keydown"&&t.event.which===e.jwerty.KEYS.keys.tab}).onValue(function(e){if(t._listViewController.isRowHighlighted()){var n=t._listViewController.getHighlightedRowData();if(n){t._tryToSetValueBasedOnKey(n.option.key,true)}}else{t._tryToSetValueBasedOnText(true)}});this._gmailTextareaViewController.getEventStream().filter(function(n){return n.eventName==="keydown"&&n.event.which===e.jwerty.KEYS.keys.right&&t._gmailTextareaViewController.isCursorAtEnd()}).onValue(function(e){e.event.preventDefault()});this._gmailTextareaViewController.getEventStream().filter(function(n){return n.eventName==="keydown"&&n.event.which===e.jwerty.KEYS.keys.left&&t._gmailTextareaViewController.isCursorAtStart()}).onValue(function(e){e.event.preventDefault()});this._listViewController.getEventStream().filter(function(e){return e.eventName==="rowPressed"&&e.rowData.isCreateNew===true}).onValue(function(e){if(e.rowData.isDisabled){t._listViewController.refresh()}else{t._createNewOption(e.rowData.optionName);t._detachMenu()}});this._listViewController.getEventStream().filter(function(e){return e.eventName==="rowPressed"&&!e.rowData.isCreateNew}).map(function(e){return e.rowData.option.key}).onValue(function(e){t._tryToSetValueBasedOnKey(e)});this._listViewController.getEventStream().filter(function(e){return e.eventName==="movedRow"}).onValue(function(e){if(e.rowData.isCreateNew){t._gmailTextareaViewController.setText(e.rowData.optionName)}else{t._gmailTextareaViewController.setText(e.rowData.option.name)}t._gmailTextareaViewController.selectAllText()})},_subscribeToModelEventStream:function(){var e=this;this._unsubscribeFunction=this._model.getEventStream().filter(function(t){return t.property===e._property&&t.eventName==="set"}).map(function(e){return e.newValue}).onValue(function(t){e._displayValue(t)})},_bindToViewEvents:function(){var e=this;this._view.getElement()[0].setAttribute("tabindex",-1);this._view.getElement().bind("focus",function(t){e._gmailTextareaViewController.focus()})},_selectAllText:function(){this._gmailTextareaViewController.selectAllText()},_displayMenu:function(){if(!this._menuListWrapper){return}var e=this._menuListWrapper.getElement();if(e.isVisible()){return}r.elements.body.append(e);e[0].style.position="fixed";e.containByScreen(this._gmailTextareaViewController.getView().getElement())},_tryToSetValueBasedOnText:function(e){var t=this._gmailTextareaViewController.getText().trim();if(t){this._showNoSelectionError();return}if(this._model.get(this._property)){this._model.set(this._property,"");this._model.save();c.Tracker.track("columnDropdown.setValue")}this._detachMenu(e)},_tryToSetValueBasedOnKey:function(e,t){if(this._model.get(this._property)===e){this._detachMenu(t);return}var n=this._optionSource.getOption(e);if(!n.key){c.ButterBarManager.showError({message:c.Locale.getString("option_not_available_yet"),time:6*1e3});return}this._model.set(this._property,e);this._model.save();this._detachMenu(t);c.Tracker.track("columnDropdown.setValue")},_showNoSelectionError:function(){c.ButterBarManager.showError({message:c.Locale.getString("dropdown_option_error"),time:6*1e3})},_setValue:function(e){var t=this._optionSource.getOption(e);if(e&&t){this._gmailTextareaViewController.setText(t.name);this._smartTextDropdownModel.setText(t.name);this._smartTextDropdownModel.setCurrentlySelectedKey(t.key)}else{this._gmailTextareaViewController.setText("");this._smartTextDropdownModel.setText("");this._smartTextDropdownModel.setCurrentlySelectedKey("")}},_displayValue:function(e){var t=this._optionSource.getOption(e);if(e&&t){this._gmailTextareaViewController.setText(t.name);this._smartTextDropdownModel.setText(t.name);this._smartTextDropdownModel.setCurrentlySelectedKey(t.key)}else{this._gmailTextareaViewController.setText("");this._smartTextDropdownModel.setText("");this._smartTextDropdownModel.setCurrentlySelectedKey("")}},_detachMenu:function(e){if(this._menuListWrapper){this._menuListWrapper.getElement().detach()}},_createNewOption:function(e){if(!e){return}this._optionSource.addOptionAndSet(e,this._model);c.Tracker.track("columnDropdown.addNewOption")},getElement:function(){return this._view.getElement()}});i.set("BentoBox.Widgets.SmartTextDropdownViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SpreadsheetSmartTextDropdownViewController",superclass:c.Widgets.SmartTextDropdownViewController,_memberVariables:[],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._smartTextDropdownModel=new c.Widgets.SmartTextDropdownModel;this._setupViewControllers();this._subscribeToViewControllerEventStreams();this._bindToViewEvents()},focus:function(){this._gmailTextareaViewController.focus()},set:function(e){this.focus();var t=this;setTimeout(function(){t._gmailTextareaViewController.setText(e);t._smartTextDropdownModel.setText(e);t._gmailTextareaViewController.setCursorToEnd()},20)},setup:function(e){if(this._unsubscribeFunction){this._unsubscribeFunction()}this._model=e.model;this._property=e.property;this._optionSource=e.optionSource;this._smartTextDropdownModel.setOptionSource(this._optionSource);this._subscribeToModelEventStream();this._setValue(this._model.get(this._property));this._gmailTextareaViewController.focus()},updateValue:function(){},_subscribeToViewControllerEventStreams:function(){c.Widgets.SmartTextDropdownViewController.prototype._subscribeToViewControllerEventStreams.call(this);var t=this;this._gmailTextareaViewController.getEventStream().filter(function(t){return t.eventName==="keydown"&&t.event.which===e.jwerty.KEYS.keys.escape}).onValue(function(){t._triggerEvent("escapePressed")})},_displayMenu:function(){if(!this._menuListWrapper){return}var e=this._menuListWrapper.getElement();e.addClass("streak__spreadsheetSmartTextDropdown_menu");r.elements.body.append(e);e[0].style.position="fixed";e.containByScreen(this._gmailTextareaViewController.getView().getElement())},_detachMenu:function(e){c.Widgets.SmartTextDropdownViewController.prototype._detachMenu.call(this);if(e){return}this._triggerEvent("enterPressed")},_triggerEvent:function(e){this._view.getElement().trigger(e)}});i.set("BentoBox.Widgets.SpreadsheetSmartTextDropdownViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GroupedLinkListView",superclass:e.UI.View,_memberVariables:[{name:"_currentList",destroy:false}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element.addClass("streak__groupedLinkList")},startNewSection:function(e){var n=t(document.createElement("h3"));n.text(e);this._element.append(n);this._currentList=t(document.createElement("ul"));this._element.append(this._currentList)},addItem:function(e,n){var i=t(document.createElement("li"));var r=t(document.createElement("span"));r[0].setAttribute("title",e);r.text(e);i.append(r);if(n.clickCallback){i.click(n.clickCallback)}if(n.actionClass){var a=t(document.createElement("span"));a[0].setAttribute("class",n.actionClass);if(n.actionClickCallback){a.click(n.actionClickCallback)}}this._currentList.append(i)},addView:function(e){this._currentList.append(e.getElement())}});i.set("BentoBox.Widgets.GroupedLinkListView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GroupedLinkListViewController",superclass:e.UI.ViewController,_memberVariables:[],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.GroupedLinkListView")},startNewSection:function(e){this._view.startNewSection(e)},addItem:function(e,t){this._view.addItem(e,t)}});i.set("BentoBox.Widgets.GroupedLinkListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxesGroupedLinkListViewController",superclass:c.Widgets.GroupedLinkListViewController,_memberVariables:[{name:"_widgetName",destroy:false,set:true}],_initialize:function(e){c.Widgets.GroupedLinkListViewController.prototype._initialize.call(this);if(e){this._renderBoxes(e)}},setBoxes:function(e){this._view.empty();this._renderBoxes(e)},_renderBoxes:function(e){var t=this;var i;n.chain(e).sortBy(function(e){return e.get("lastUpdatedTimestamp")}).sortBy(function(e){return e.displayName()}).sortBy(function(e){var t=e.getPipeline().get("stageOrder");return t.indexOf(e.get("stageKey"))}).groupBy(function(e){return e.getPipeline().key()}).tap(function(e){i=e}).keys().map(function(e){return c.Data.getPipeline(e)}).sortBy(function(e){return e.displayName()}).each(function(e){t._view.startNewSection(e.displayName());t._renderPipelineBoxes(i[e.key()])})},_renderPipelineBoxes:function(e){for(var t=0;t<e.length;t++){this._renderBox(e[t])}},_renderBox:function(e){var t=this;this._view.addItem(e.displayName(),{clickCallback:function(){r.inboxSDK.Router.goto(e.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:t._widgetName})}})}});i.set("BentoBox.Widgets.BoxesGroupedLinkListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MultipleActionBoxesGroupedLinkListViewController",superclass:c.Widgets.BoxesGroupedLinkListViewController,_memberVariables:[{name:"_actions",destroy:true,set:true},{name:"_mainActionCallback",destroy:false,set:true},{name:"_actionMenu",destroy:true},{name:"_currentBox",destroy:false},{name:"_listItems",destroy:true,defaultValue:[]}],_initialize:function(){c.Widgets.BoxesGroupedLinkListViewController.prototype._initialize.call(this);this._setupActionMenu()},_setupActionMenu:function(){this._actionMenu=c.Widgets.Menu.create()},setActions:function(e){this._actionMenu.empty();if(!e){return}for(var t=0;t<e.length;t++){this._addMenuAction(e[t])}},_addMenuAction:function(e){var t=this;this._actionMenu.addItem(e.text,function(){e.callback(t._currentBox)})},_renderBox:function(e){var t=this;var n=c.Widgets.Buttons.ButtonFactory.createSplitMenuButton({type:"TextArrow",color:"blue",text:e.displayNameText(),menu:this._actionMenu,isRightAligned:true,menuClickTriggersOff:true,onFunction:function(){t._mainActionCallback(e)},preOnFunction:function(){t._currentBox=e}});this._view.addView(n);this._listItems.push(n)}});i.set("BentoBox.Widgets.MultipleActionBoxesGroupedLinkListViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"RelatedBoxesView",superclass:e.UI.View,_memberVariables:[{name:"_collapseWidget",destroy:true},{name:"_bodyElement",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._bodyElement=t(document.createElement("div"));this._collapseWidget=c.Widgets.CollapseSection.create({title:c.Locale.getString("related_boxes"),bodyEl:this._bodyElement,startOpen:true,localToggleStateKey:"sidebarRelatedBoxes"});this._collapseWidget.el.addClass("streak__sidebar_relatedBoxes");this._element=this._collapseWidget.el},setListOfBoxesView:function(e){this._bodyElement.append(e.getElement())}});i.set("BentoBox.Modules.RelatedBoxesView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"RelatedBoxesViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_multipleActionBoxesGroupedLinkListViewController",destroy:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._setupListViewController();this._multipleActionBoxesGroupedLinkListViewController.setBoxes(t);this._view.setListOfBoxesView(this._multipleActionBoxesGroupedLinkListViewController.getView());this._widgetName="relatedBoxes"},_setupView:function(){this._view=new c.Modules.RelatedBoxesView},_setupListViewController:function(){this._multipleActionBoxesGroupedLinkListViewController=new c.Widgets.MultipleActionBoxesGroupedLinkListViewController;this._multipleActionBoxesGroupedLinkListViewController.setActions([{text:c.Locale.getString("go_to_box"),callback:function(e){r.inboxSDK.Router.goto(e.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:self._widgetName,actionArea:"menuAction"})}},{text:c.Locale.getString("add_current_thread_to_box"),callback:function(e){var t=c.Services.Threads.ThreadMetaDataCreator.getActiveThreadMetaDataList();c.Modules.BoxesMenu.BoxAndGmailThreadCreator.createGmailThreads(e.key(),t);c.Tracker.track("addThreadsToBox",{threadCount:t.length,context:"relatedBoxes",actionArea:"menuAction"})}}]);this._multipleActionBoxesGroupedLinkListViewController.setMainActionCallback(function(e){r.inboxSDK.Router.goto(e.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:self._widgetName,actionArea:"mainLink"})})}});i.set("BentoBox.Modules.RelatedBoxesViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"BoxSidebarRelatedBoxesViewController",superclass:c.Modules.RelatedBoxesViewController,_memberVariables:[{name:"_currentBox",destroy:false,set:true}],_initialize:function(e,t){c.Modules.RelatedBoxesViewController.prototype._initialize.call(this,e);this._currentBox=t;this._widgetName="boxSidebarRelatedBoxes"},_setupListViewController:function(){this._multipleActionBoxesGroupedLinkListViewController=new c.Widgets.MultipleActionBoxesGroupedLinkListViewController;var e=this;this._multipleActionBoxesGroupedLinkListViewController.setActions([{text:c.Locale.getString("go_to_box"),callback:function(t){r.inboxSDK.Router.goto(t.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:e._widgetName,actionArea:"menuAction"})}},{text:c.Locale.getString("add_to_linked_boxes"),callback:function(t){e._currentBox.addLinkedBox(t);c.Tracker.track("addLinkedBox",{widget:"boxSidebarRelatedBoxes",context:"boxSidebarRelatedBoxes"})}}]);this._multipleActionBoxesGroupedLinkListViewController.setMainActionCallback(function(t){r.inboxSDK.Router.goto(t.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:e._widgetName,actionArea:"mainLink"})})}});i.set("BentoBox.Modules.BoxSidebarRelatedBoxesViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"RelatedBoxesOnComposeViewController",superclass:c.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_element",destroy:true}],_initialize:function(){c.Modules.ComposeViewControllerBase.prototype._initialize.call(this)},initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){var e=this._composeWindowViewController.getModuleStorageValue("relatedBoxes");return e&&e.length>0&&this._composeWindowViewController.getActiveModules().indexOf("mailMerge")===-1},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"NEW_RECIPIENT_ROW"},getModificationElement:function(){this._setupElement();return this._element},activeModulesChanged:function(e){if(e.indexOf("mailMerge")>-1){this._composeWindowViewController.reloadModification(this);return}},addressesChanged:function(){this._recomputeRelatedBoxes();this._composeWindowViewController.reloadModification(this)},moduleStorageValueChanged:function(e,t){if(e==="threadBox"){this._recomputeRelatedBoxes();this._composeWindowViewController.reloadModification(this)}},_recomputeRelatedBoxes:function(){var e=this._composeWindowViewController.getToContacts();var t=n.pluck(e,"emailAddress");var i=c.Services.BoxSearcher.getBoxesWithOverlappingEmailAddresses(t,this._composeWindowViewController.getModuleStorageValue("threadBox"));this._composeWindowViewController.setModuleStorageValue("relatedBoxes",i);if(i.length>0&&c.LocalSettings.get("relatedBoxes/isComposeSidebarVisible")){this._composeWindowViewController.setModuleActive("relatedBoxes")}else{this._composeWindowViewController.setModuleInactive("relatedBoxes")}},_setupElement:function(){var e=this._composeWindowViewController.getModuleStorageValue("relatedBoxes");if(!this._element){if(!e||e.length===0){return}this._element=t(document.createElement("div"));this._element.addClass("streak__composeRelatedBoxes")}this._element.text(c.Locale.getString("compose_related_boxes",{number:e.length}));var n=c.LocalSettings.get("relatedBoxes/isComposeSidebarVisible");var i=c.Locale.getString(n?"hide":"show");var r=this;var a=c.Widgets.Buttons.ButtonFactory.createButton({type:"Text",text:i,onFunction:function(){n=!n;c.LocalSettings.set("relatedBoxes/isComposeSidebarVisible",n);if(n){r._composeWindowViewController.setModuleActive("relatedBoxes");a.setText(c.Locale.getString("hide"));c.Tracker.track("showComposeRelatedBoxes")}else{r._composeWindowViewController.setModuleInactive("relatedBoxes");a.setText(c.Locale.getString("show"));c.Tracker.track("hideComposeRelatedBoxes")}}});this._element.append(a.getElement())}});i.set("BentoBox.Modules.RelatedBoxesOnComposeViewController",d);u.addFunction({functionKey:"relatedBoxesOnComposeViewController",functionReference:function(){r.GmailComposeManager.registerModifierModule({getViewControllers:function(){return[new d]}})},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","data.boxes.initialized","data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"RelatedBoxesOnComposeSidebarViewController",superclass:c.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_multipleActionBoxesGroupedLinkListViewController",destroy:true},{name:"_isVisible",destroy:false,defaultValue:false}],_initialize:function(){c.Modules.ComposeViewControllerBase.prototype._initialize.call(this)
},initialize:function(e){this._composeWindowViewController=e},shouldProcessModification:function(){var e=this._composeWindowViewController.getModuleStorageValue("relatedBoxes");this._isVisible=e&&e.length>0&&this._composeWindowViewController.getActiveModules().indexOf("mailMerge")===-1&&this._composeWindowViewController.getActiveModules().indexOf("relatedBoxes")>-1;return this._isVisible},getModificationType:function(){return"ADD_ELEMENT"},getModificationArea:function(){return"EXTERNAL_SIDEBAR"},getModificationElement:function(){this._setupGroupedLinkListViewController();return this._multipleActionBoxesGroupedLinkListViewController.getView().getElement()},getWidth:function(){return 220},getModificationTitle:function(){return c.Locale.getString("related_boxes")},activeModulesChanged:function(e){if(e.indexOf("mailMerge")>-1){this._composeWindowViewController.reloadModification(this);return}if(e.indexOf("relatedBoxes")>-1){this._composeWindowViewController.reloadModification(this);return}if(e.indexOf("relatedBoxes")===-1&&this._isVisible){this._composeWindowViewController.reloadModification(this);return}},moduleStorageValueChanged:function(e,t){if(e==="relatedBoxes"){this._composeWindowViewController.reloadModification(this)}},_setupGroupedLinkListViewController:function(){var e=this;if(!this._multipleActionBoxesGroupedLinkListViewController){this._multipleActionBoxesGroupedLinkListViewController=new c.Widgets.MultipleActionBoxesGroupedLinkListViewController;this._multipleActionBoxesGroupedLinkListViewController.setMainActionCallback(function(t){r.inboxSDK.Router.goto(t.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:e._widgetName,context:"mainLink"})});this._multipleActionBoxesGroupedLinkListViewController.setWidgetName("relatedBoxesOnComposeSidebar")}var t=[{text:c.Locale.getString("go_to_box"),callback:function(t){r.inboxSDK.Router.goto(t.link());c.Tracker.track("boxesGroupedLinkListClicked",{widget:e._widgetName,context:"menuAction"})}}];if(this._composeWindowViewController.getModuleStorageValue("threadBox")){t.push({text:c.Locale.getString("add_to_linked_boxes"),callback:function(t){e._composeWindowViewController.getModuleStorageValue("threadBox").addLinkedBox(t);c.Tracker.track("addLinkedBox",{context:"relatedBoxesComposeSidebar"})}})}else{t.push({text:c.Locale.getString("add_current_email_to_box"),callback:function(t){e._composeWindowViewController.setModuleStorageValue("threadBox",t);e._composeWindowViewController.setModuleActive("threadBox");e._composeWindowViewController.notify("threadAddedToBox",t);c.Tracker.track("addBoxToCompose",{context:"relatedBoxesComposeSidebar"})}})}this._multipleActionBoxesGroupedLinkListViewController.setActions(t);this._multipleActionBoxesGroupedLinkListViewController.setBoxes(this._composeWindowViewController.getModuleStorageValue("relatedBoxes"))}});i.set("BentoBox.Modules.RelatedBoxesOnComposeSidebarViewController",d);u.addFunction({functionKey:"relatedBoxesOnComposeSidebarViewController",functionReference:function(){r.GmailComposeManager.registerModifierModule({getViewControllers:function(){return[new d]}})},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","data.boxes.initialized","data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MultipleActionListItemView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this)},_setupElement:function(){this._element=t(document.createElement("div"));this._element.addClass("streak__multipleActionListItem");this._element[0].innerHTML='<div class="streak__multipleActionListItem_text"></div><div class="streak__multipleActionListItem_actions"></div>'},setText:function(e){this._element.find(".streak__multipleActionListItem_text").text(e)},addActionLink:function(e){this._element.find(".streak__multipleActionListItem_actions").append(e.getElement())}});i.set("BentoBox.Widgets.MultipleActionListItemView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"MultipleActionListItemViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_mainText",destroy:false},{name:"_actionLinks",destroy:true,defaultValue:[]}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._view.setText(t)},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.MultipleActionListItemView")},addActionLink:function(e){this._view.addActionLink(e);this._actionLinks.push(e)}});i.set("BentoBox.Widgets.MultipleActionListItemViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineSummaryLimiter",superclass:e.BentoBox.Services.FeatureLimiter,_memberVariables:[],_initialize:function(){e.BentoBox.Services.FeatureLimiter.prototype._initialize.call(this)},_getFeatureKey:function(){return"pipelineColumnAggregate"},_getGatewayTitle:function(){return c.Locale.getString("column_aggregates_gateway_title")},_getGatewayBodyText:function(){return c.Locale.getString("column_aggregates_gateway_text")},_getLimit:function(){return 1}});u.addFunction({functionKey:"PipelineSummaryLimiterInitialized",functionReference:function(){i.set("BentoBox.Services.PipelineSummaryLimiter",new d)},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"RapportiveComposeFixer",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);if(!c.Services.RapportiveStatusController.isEnabled()){return}this._startMonitoringComposeArea()},_startMonitoringComposeArea:function(){r.addTimerObserver(this._fixComposeWindowContainer.bind(this));l.getNotificationStream().filter(function(e){return e.eventName==="newComposeWindow"&&c.UI.isBentoBoxView()}).delay(100).onValue(this._fixComposeWindowContainer.bind(this))},_fixComposeWindowContainer:function(e){if(!c.UI.isBentoBoxView()){return}if(r.GmailComposeWindowMasterController.getComposeWindows().length===0){return}var t=r.getComposeWindowContainerElement();var n=t[0].style.marginRight;if(n===""){return}t[0].style.marginRight="";var i=r.GmailComposeWindowMasterController.getComposeWindows()[0];i.minimize();i.restore()}});e.DependencyManager.addFunction({functionKey:"RapportiveComposeFixerInitialized",functionReference:function(){i.set("BentoBox.Modules.RapportiveComposeFixer",new d)},dependentFunctionKeys:["userLoggedIn","gmailLoaded"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TagView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._setupBindings()},_setupElement:function(){e.UI.View.prototype._setupElement.call(this);this._element[0].innerHTML='<div class="vN"><div class="vT streak__tag_text"></div><div class="vM streak__tag_x"></div></div>';this._element.addClass("streak__tag vR");this._element[0].setAttribute("tabindex",-1)},setText:function(e){this._element.find(".streak__tag_text").text(e);this._element[0].setAttribute("data-tooltip",e)},focus:function(){this._element.focus()},_setupBindings:function(){var e=this;this._element.on("click",function(t){e._element.focus();t.preventDefault();t.stopPropagation()});this._element.focus(function(t){e._element.addClass("vS");e._eventStream.push({eventName:"focus",event:t})});this._element.blur(function(t){e._element.removeClass("vS")});this._element.find(".streak__tag_x").on("mousedown",function(t){e._eventStream.push({eventName:"xClicked",event:t});t.stopPropagation()});this._element.on("keypress",function(t){e._eventStream.push({eventName:"keypress",event:t,which:t.which})});this._element[0].addEventListener("keydown",function(t){e._eventStream.push({eventName:"keydown",event:t,which:t.which});t.preventDefault();t.stopPropagation();t.stopImmediatePropagation()},true)}});i.set("BentoBox.Widgets.TagView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TagViewController",superclass:e.UI.ViewController,_memberVariables:[],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);if(t){this.setText(t)}},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.TagView")},setText:function(e){this._view.setText(e)},focus:function(){this._view.focus()}});i.set("BentoBox.Widgets.TagViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SmartTagsModel",superclass:c.Widgets.ListView.ListViewBaseModel,_memberVariables:[{name:"_text",destroy:false},{name:"_currentlySelectedKeys",destroy:false,defaultValue:[]},{name:"_newOptions",destroy:false,defaultValue:[]},{name:"_optionSource",destroy:false,set:true},{name:"_listRows",destroy:true},{name:"_shouldHighlight",destroy:true,defaultValue:false}],_initialize:function(){c.Widgets.ListView.ListViewBaseModel.prototype._initialize.call(this)},setText:function(e){this._text=e.trim();this._refresh()},setCurrentlySelectedKeys:function(e){this._currentlySelectedKeys=e||[];this._refresh()},addNewOption:function(e){this._newOptions.push({tag:e})},clearNewOptions:function(){this._newOptions=[]},_refresh:function(){this._sections=[];var e=this._text||"";var t=e.toLowerCase();var i=false;var r=this;this._shouldHighlight=false;this._listRows=n.chain(this._optionSource.getOptions()).concat(this._newOptions).sortBy(function(e){return e.tag.toLowerCase()}).filter(function(e){return e.tag.toLowerCase().indexOf(t)===0}).map(function(n){i=i||n.tag===e;var a=t.length>0&&n.tag.toLowerCase().indexOf(t)===0;r._shouldHighlight=r._shouldHighlight||a;return{text:n.tag,option:n,isHighlighted:a,isSelected:r._currentlySelectedKeys.indexOf(n.key||n.tag)>-1}}).value();if(this._listRows.length===0){if(this._text){this._addNoMatchingOptionsMessageSection()}else{this._addNoOptionsMessageSection()}this._sections.push({isSeparator:true})}else if(this._listRows.length>0){this._sections.push({rows:this._listRows});this._sections.push({isSeparator:true})}var a=i||!t;this._addCreateOptionSection(a);this._callDelegateFunction("dataChanged")},_addNoMatchingOptionsMessageSection:function(){this._sections.push({isFreeForm:true,element:'<div class="streak__listViewRow_disabled streak__dropdown_noOptions">'+c.Locale.getString("tag_no_matching_options")+"</div>"})},_addNoOptionsMessageSection:function(){this._sections.push({isFreeForm:true,element:'<div class="streak__listViewRow_disabled streak__dropdown_noOptions">'+c.Locale.getString("tag_no_options")+"</div>"})},_addCreateOptionSection:function(e){var t;if(this._text&&!e){t=c.Locale.getString("tag_create_text_option",{option:this._text})}else{t=c.Locale.getString("tag_create_option")}this._sections.push({rows:[{text:t,isCreateNew:true,isDisabled:e,displayClass:e?"streak__listViewRow_disabled":null}]})},isSectionSeparator:function(e){return this._sections[e].isSeparator},isSectionFreeForm:function(e){return this._sections[e].isFreeForm},getSectionFreeFormElement:function(e){return this._sections[e].element},dontHighlightOnDataChange:function(){return!this._shouldHighlight}});i.set("BentoBox.Widgets.SmartTagsModel",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"SmartTagsView",superclass:e.UI.View,_memberVariables:[{name:"_enabled",destroy:false,defaultValue:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._setupEvents()},_setupElement:function(){e.UI.View.prototype._setupElement.call(this);this.addClass("smartInput streak__smartTags");this._element[0].setAttribute("tabindex",-1);this._element[0].innerHTML='<div class="R5"><div class="streak__smartTags_read"></div><div class="streak__smartTags_edit"></div></div>'},showRead:function(){this._element.find(".streak__smartTags_read").show();this._element.find(".streak__smartTags_edit").hide()},showEdit:function(){this._element.find(".streak__smartTags_read").hide();this._element.find(".streak__smartTags_edit").show()},setReadText:function(e){this._element.find(".streak__smartTags_read").text(e)},addTagView:function(e){this._element.find(".streak__smartTags_edit").prepend(e.getElement())},setTextInputView:function(e){this._element.find(".streak__smartTags_edit").append(e.getElement())},showGreyBorder:function(){this._element.removeClass("acm streak__transparentBorder");this._element.addClass("aco")},showBlueBorder:function(){this._element.addClass("acm");this._element.removeClass("aco streak__transparentBorder")},removeBorder:function(){this._element.removeClass("acm aco");this._element.addClass("streak__transparentBorder")},_setupEvents:function(){var e=this;this._element.click(function(t){if(!e._enabled){return}e._eventStream.push({eventName:"click",event:t})});this._element.focus(function(t){if(!e._enabled){return}e._eventStream.push({eventName:"focus",event:t})});this._element.mouseover(function(t){if(!e._enabled){return}e._eventStream.push({eventName:"mouseover",event:t})});this._element.mouseleave(function(t){if(!e._enabled){return}e._eventStream.push({eventName:"mouseleave",event:t})})},setEnabled:function(e){this._enabled=e;var t=this._element.find(".R5");if(e){t.removeProp("contenteditable")}else{t.prop("contenteditable",false)}}});i.set("BentoBox.Widgets.SmartTagsView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.jwerty,r=e.Library,a=e.Gmail,o=e.Date,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"SmartTagsViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_model",destroy:false},{name:"_property",destroy:false},{name:"_tagKeys",destroy:false},{name:"_newTags",destroy:false},{name:"_optionSource",destroy:false},{name:"_unsubscribeFunction",destroy:true},{name:"_gmailTextareaViewController",destroy:true},{name:"_listViewController",destroy:true},{name:"_menuListWrapper",destroy:true},{name:"_smartTagsModel",destroy:true},{name:"_tagViewControllers",destroy:true,defaultValue:{}},{name:"_alwaysShowBorder",destroy:true},{name:"_inEditMode",destroy:true,defaultValue:true}],_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._model=t.model;this._property=t.property;this._tagKeys=this._model.get(this._property)||[];this._alwaysShowBorder=t.alwaysShowBorder;this._optionSource=t.optionSource;this._smartTagsModel=new d.Widgets.SmartTagsModel;this._smartTagsModel.setOptionSource(this._optionSource);this._setupViewControllers();this._subscribeToViewEvents();this._subscribeToViewControllerEventStreams();this._subscribeToModelEventStream();this._updateDisplayValue();this._showRead()},setEnabled:function(e){this._gmailTextareaViewController.setEnabled(e);this._view.setEnabled(e)},_setupView:function(){this._view=r.getInstance("BentoBox.Widgets.SmartTagsView")},_setupViewControllers:function(){this._listViewController=new d.Widgets.ListView.ListViewViewController;this._listViewController.setDataSource(this._smartTagsModel);this._menuListWrapper=d.Widgets.Menu.create();this._menuListWrapper.addSection(this._listViewController.getView().getElement());this._menuListWrapper.getElement().addClass("streak__smartTags_menu");this._gmailTextareaViewController=new d.Widgets.GmailTextareaViewController({plainTextOnly:true,multiline:false,noBorder:true});this._gmailTextareaViewController.addDelegate(this._listViewController);this._view.setTextInputView(this._gmailTextareaViewController.getView())},_subscribeToViewEvents:function(){var e=this;this._view.getEventStream().filter(function(e){return e.eventName==="click"||e.eventName==="focus"}).onValue(function(t){e._viewFocused()});this._view.getEventStream().filter(function(t){return t.eventName==="mouseover"&&!e._alwaysShowBorder&&!e._inEditMode}).onValue(function(){e._view.showGreyBorder()});this._view.getEventStream().filter(function(t){return t.eventName==="mouseleave"&&!e._alwaysShowBorder&&!e._inEditMode&&!e._areNoTagsSet()}).onValue(function(){e._view.removeBorder()})},_viewFocused:function(){if(this._inEditMode){this._gmailTextareaViewController.focus();return}this._showEdit();this._gmailTextareaViewController.focus();this._inEditMode=true},_subscribeToModelEventStream:function(){var e=this;this._unsubscribeFunction=this._model.getEventStream().filter(function(t){return t.property===e._property&&t.eventName==="set"&&!e._inEditMode}).onValue(function(t){e._tagKeys=t.newValue||[];e._updateDisplayValue()})},_subscribeToViewControllerEventStreams:function(){var e=this;this._gmailTextareaViewController.getEventStream().onValue(this,"_gmailTextareaEvent");this._listViewController.getEventStream().onValue(this,"_listViewControllerEvent")},_gmailTextareaEvent:function(e){switch(e.eventName){case"focus":this._textInputFocused();break;case"input":this._textInputChanged();break;case"keydown":var t=e.event;if(i.is("tab",t)){this._tabPressed(t)}else if(i.is("shift+tab",t)){this._tabPressed(t)}else if(i.is("right",t)){this._rightPressed(t)}else if(i.is("left",t)){this._leftPressed(t)}else if(i.is("delete/backspace",t)){this._deletePressed(t)}else if(i.is("escape",t)){this._escapePressed(t)}break}},_textInputFocused:function(){this._resetMenu()},_textInputChanged:function(){this._smartTagsModel.setText(this._gmailTextareaViewController.getText());this._displayMenu()},_tabPressed:function(e){e.preventDefault();e.stopPropagation();if(this._listViewController.isRowHighlighted()){var t=this._listViewController.getHighlightedRowData();if(t){if(!t.isDisabled){if(t.isCreateNew){this._createNewOption()}else{this._tryToSetValueBasedOnKey(t.option.key,true)}}}this._resetTextInput();return}this._resetTextInput();this._setAndSaveTagKeys();this._showRead();if(e.shiftKey){this._view.getElement().trigger("shiftTabPressed")}else{this._view.getElement().trigger("tabPressed")}},_rightPressed:function(e){if(this._gmailTextareaViewController.isCursorAtEnd()){e.preventDefault()}},_leftPressed:function(e){if(!this._gmailTextareaViewController.isCursorAtStart()){return}e.preventDefault();if(!this._gmailTextareaViewController.getText()){this._moveToLeftTag()}},_deletePressed:function(e){if(this._gmailTextareaViewController.getText()){return}if(this._gmailTextareaViewController.isCursorAtStart()){this._removeLastTag()}},_escapePressed:function(e){e.preventDefault();e.stopPropagation();this._smartTagsModel.clearNewOptions();this._tagKeys=n.clone(this._model.get(this._property)||[]);this._newTags=[];this._updateDisplayValue();this._showRead();this._view.getElement().trigger("escapePressed")},_listViewControllerEvent:function(e){switch(e.eventName){case"rowPressed":var t=e.rowData;if(t.isCreateNew===true){this._createNewPressed(e.rowData)}else if(!t.isSelected){this._rowPressed(t)}else{this._resetMenu()}break;case"emptyPressed":this._enterPressed();break}},_createNewPressed:function(e){if(e.isDisabled){this._listViewController.refresh()}else{this._createNewOption();this._resetTextInput();this._resetMenu()}},_rowPressed:function(e){var t=e.option.key||e.option.tag;this._tryToSetValueBasedOnKey(t);this._resetTextInput();this._gmailTextareaViewController.focus()},_tryToSetValueBasedOnText:function(e){var t=this._gmailTextareaViewController.getText().trim();if(t){this._showNoSelectionError();return}this._detachMenu(e)},_tryToSetValueBasedOnKey:function(e,t){var n=this._getCurrentValue();n.push(e);this._updateDisplayValue();this._resetMenu();d.Tracker.track("smartTags.setValue")},_showNoSelectionError:function(){d.ButterBarManager.showError({message:d.Locale.getString("tag_option_error"),time:6*1e3})},_updateDisplayValue:function(){this._clearTags();this._renderTags();this._view.setReadText(this._getReadDisplayValue(this._tagKeys))},_getReadDisplayValue:function(e){if(!e){return""}var t=this;return n.chain(e).map(function(e){return t._optionSource.getOption(e).tag}).value().join(", ")},_clearTags:function(){var e=n.keys(this._tagViewControllers);for(var t=0;t<e.length;t++){this._tagViewControllers[e[t]].destroy()}this._tagViewControllers={}},_renderTags:function(){for(var e=this._tagKeys.length-1;e>=0;e--){this._renderTag(this._tagKeys[e])}},_renderTag:function(e){var t=this._optionSource.getOption(e);if(!t){return}var n=new d.Widgets.TagViewController(t.tag);this._subscribeToTagEvents(n,e);this._addTagViewControllerToView(n);this._tagViewControllers[e]=n},_subscribeToTagEvents:function(e,t){var n=this;e.getEventStream().filter(function(e){return e.eventName==="focus"}).onValue(function(){n._detachMenu()});var r=e.getEventStream().filter(function(e){return e.eventName==="xClicked"});r.onValue(function(){n._removeTag(t)});r.delay(50).onValue(function(){n._gmailTextareaViewController.focus()});e.getEventStream().filter(function(e){return e.eventName==="keydown"}).map(function(e){return e.event}).onValue(function(e){if(i.is("left",e)){n._moveToLeftTag(t)}else if(i.is("right",e)){n._moveToRightTag(t)}else if(i.is("enter",e)){n._enterPressed(e)}else if(i.is("delete/backspace",e)){n._removeTag(t);n._gmailTextareaViewController.focus()}else if(i.is("tab",e)){if(e.shiftKey){n._view.getElement().trigger("shiftTabPressed")}else{n._view.getElement().trigger("tabPressed")}}else if(i.is("escape",e)){n._escapePressed(e)}})},_addTagViewControllerToView:function(e){this._view.addTagView(e.getView())},_moveToLeftTag:function(e){var t=this._getCurrentValue();if(!t||t.length===0){return}var i;if(!e){i=n.last(t)}else{var r=t.indexOf(e);if(r===0||r===-1){return}i=t[r-1]}this._tagViewControllers[i].focus()},_moveToRightTag:function(e){var t=this._getCurrentValue();if(!t||t.length===0){return}var n=t.indexOf(e);if(n===-1){return}if(n===t.length-1){this._gmailTextareaViewController.focus();return}var i=t[n+1];this._tagViewControllers[i].focus()},_removeLastTag:function(){var e=this._getCurrentValue();if(!e||e.length===0){return}var t=n.last(e);this._removeTag(t)},_removeTag:function(e){var t=this._tagViewControllers[e];if(t){delete this._tagViewControllers[e];t.destroy()}var n=this._getCurrentValue();n.removeVal(e);this._resetMenu();this._updateDisplayValue()},_getCurrentValue:function(){return this._tagKeys},_enterPressed:function(){this._setAndSaveTagKeys();this._showRead()},_showRead:function(){this._inEditMode=false;this._view.showRead();this._detachMenu();this._gmailTextareaViewController.setText("");if(this._alwaysShowBorder){this._view.showGreyBorder();return}if(this._areNoTagsSet()){this._view.showGreyBorder()}else{this._view.removeBorder()}this._view.getElement().unbindBodyCloseAndStop()},_areNoTagsSet:function(){var e=this._getCurrentValue();return!e||e.length===0},_showEdit:function(){this._smartTagsModel.clearNewOptions();this._tagKeys=n.clone(this._model.get(this._property)||[]);this._newTags=[];this._resetMenu();this._view.showEdit();this._view.showBlueBorder();this._setupBodyCloseAndStop()},_detachMenu:function(e){if(this._menuListWrapper){this._menuListWrapper.getElement().detach()}},_resetTextInput:function(){this._gmailTextareaViewController.setText("");this._smartTagsModel.setText("")},_resetMenu:function(){this._smartTagsModel.setCurrentlySelectedKeys(this._getCurrentValue());this._displayMenu()},_displayMenu:function(){if(!this._menuListWrapper){return}var e={widthBuffer:6,heightBuffer:6,leftBuffer:3,topBuffer:3};var t=this._menuListWrapper.getElement();if(t.isVisible()){t.containByScreen(this._gmailTextareaViewController.getView().getElement(),e);return}a.elements.body.append(t);t[0].style.position="fixed";t.containByScreen(this._gmailTextareaViewController.getView().getElement(),e)},_setupBodyCloseAndStop:function(){var e=this;this._view.getElement().bodyCloseAndStop({closeFunction:function(){e._showRead();e._setAndSaveTagKeys()},body:a.elements.body,stop:this._menuListWrapper.getElement()})},_createNewOption:function(){var e=this._gmailTextareaViewController.getText();if(!e){return}this._newTags.push(e);this._tagKeys.push(e);this._smartTagsModel.addNewOption(e);this._updateDisplayValue();d.Tracker.track("smartTags.addNewOption")},_setAndSaveTagKeys:function(){d.Tracker.track("smartTags.updateTags");this._optionSource.updateTags(this._newTags,this._tagKeys,this._model);this._updateDisplayValue()},getElement:function(){return this._view.getElement()},destroy:function(){this._view.getElement().unbindBodyCloseAndStop();e.UI.ViewController.prototype.destroy.call(this)}});r.set("BentoBox.Widgets.SmartTagsViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.BentoBox.Widgets.SmartTagsViewController;var h=e.Class.subclass({className:"SpreadsheetSmartTagsViewController",superclass:d,_memberVariables:[],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._inEditMode=true;this._smartTagsModel=new c.Widgets.SmartTagsModel;this._setupViewControllers();this._subscribeToViewEvents();this._subscribeToViewControllerEventStreams()},_setupView:function(){this._view=i.getInstance("BentoBox.Widgets.SmartTagsView")},focus:function(){this._showEdit();this._resetTextInput();this._resetMenu();this._updateDisplayValue();this._gmailTextareaViewController.focus()},set:function(e){this.focus();var t=this;setTimeout(function(){t._gmailTextareaViewController.setText(e);t._textInputChanged();t._gmailTextareaViewController.setCursorToEnd()},20)},setup:function(e){if(this._unsubscribeFunction){this._unsubscribeFunction()}this._model=e.model;this._property=e.property;this._optionSource=e.optionSource;this._smartTagsModel.setOptionSource(this._optionSource)},updateValue:function(){this._detachMenu();this._setAndSaveTagKeys()},_subscribeToViewEvents:function(){var e=this;this._view.getEventStream().filter(function(e){return e.eventName==="click"||e.eventName==="focus"}).onValue(function(t){e._viewFocused()})},_setupViewControllers:function(){d.prototype._setupViewControllers.call(this);this._menuListWrapper.getElement().addClass("streak__spreadsheetSmartTags_menu");var e=this._menuListWrapper.getElement()},_updateDisplayValue:function(){this._clearTags();this._renderTags()},_showEdit:function(){this._smartTagsModel.clearNewOptions();this._tagKeys=n.clone(this._model.get(this._property)||[]);this._newTags=[];this._resetMenu();this._view.showEdit()},_enterPressed:function(){this._view.getElement().trigger("enterPressed")}});i.set("BentoBox.Widgets.SpreadsheetSmartTagsViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailCheckboxView",superclass:e.UI.View,_memberVariables:[{name:"_initialText",destroy:true}],_initialize:function(t){this._initialText=t;e.UI.View.prototype._initialize.call(this)},setIsChecked:function(e){this._element.setChecked(e)},isChecked:function(){return this._element.isChecked()},setText:function(e){this._element.find("span").text(e)},getText:function(){return this._element.find("span").text()},focus:function(){this._element.focus()},setEnabled:function(e){this._element.setEnabled(e)},enable:function(){this._element.enable()},disable:function(){this._element.disable()},_setupElement:function(){this._element=r.widgets.getCheckbox(this._initialText);this._bindToEvents()},_bindToEvents:function(){var e=this;this._element.bind("change",function(){e._eventStream.push({eventName:"valueChanged",isChecked:e.isChecked()})})},getCheckStream:function(){return this._eventStream.filter(function(e){return e.eventName==="valueChanged"}).map(function(e){return e.isChecked})},whenChanged:function(e){this.getCheckStream().onValue(e)}});i.set("BentoBox.Widgets.GmailCheckboxView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.jwerty,d=e.BentoBox;var h=e.Class.subclass({className:"GmailTextCalendarViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_gmailTextareaViewController",destroy:true},{name:"_pickdate",destroy:false},{name:"_shouldIncludeTime",destroy:true,defaultValue:true},{name:"_shouldAutoClose",destroy:true,defaultValue:true},{name:"_date",destroy:true,set:true,get:true}],_initialize:function(t){if(t){this._shouldIncludeTime=n.isReal(t.shouldIncludeTime)?t.shouldIncludeTime:true;this._shouldAutoClose=n.isReal(t.shouldAutoClose)?t.shouldAutoClose:true}e.UI.ViewController.prototype._initialize.call(this)},setDateString:function(e){var t=a.create(e);this.setDate(t)},setDate:function(e){if(e&&!e.isValid()){e=null}this._date=e;this._updatePickdateDate();this._updateDisplay()},focus:function(){this._gmailTextareaViewController.focus()},setText:function(e){this._gmailTextareaViewController.setText(e)},setCursorToEnd:function(){this._gmailTextareaViewController.setCursorToEnd()},setEnabled:function(e){this._gmailTextareaViewController.setEnabled(e)},showCalendar:function(){this._showCalendar()},hideCalendar:function(){this._hideCalendar()},setPlaceholderText:function(e){this._gmailTextareaViewController.setPlaceholderText(e)},_setupView:function(){this._gmailTextareaViewController=new d.Widgets.GmailTextareaViewController({multiline:false,plainTextOnly:true});this._view=this._gmailTextareaViewController.getView();this._view.addClass("streak__gmailTextCalendar");this._pickdate=this._view.getTextInput().pickdate({animationDuration:0,body:r.elements.body,allowEmpty:true,appendTo:this._view.getElement(),useFixedPosition:true,autoClose:this._shouldAutoClose,onSelect:this._calendarDateSelected.bind(this),onClose:this._calendarClosed.bind(this)});this._view.getEventStream().onValue(this,"_textInputEvent")},_textInputEvent:function(e){switch(e.eventName){case"focus":this._showCalendar();break;case"keydown":if(c.is("tab/shift+tab",e.event)){this._extractAndSetDateFromText()}break}},_calendarDateSelected:function(e){this._gmailTextareaViewController.setText(e.prettyDate(true))},_calendarClosed:function(e){this._extractAndSetDateFromText();if(e){this._view.blur();this._getTextInput().trigger("enterPressed")}},_extractAndSetDateFromText:function(){var e=this._gmailTextareaViewController.getText();if(!e){if(!this._date){return}this.setDate(null);this._eventStream.push({eventName:"dateSelected",date:this._date});return}var t=a.create(e);if(t.isValid()){if(this._date&&t.getTime()===this._date.getTime()){this.setDate(t);return}this.setDate(t);this._eventStream.push({eventName:"dateSelected",date:this._date})}else{this.setDate(this._date)}},_showCalendar:function(){this._updatePickdateDate();this._pickdate.showCalendar()},_hideCalendar:function(){this._pickdate.hideCalendar()},_updatePickdateDate:function(){if(this._date){this._getTextInput().data("time",this._date.getTime())}else{this._getTextInput().data("time",null)}},_getTextInput:function(){return this._gmailTextareaViewController.getView().getTextInput()},_updateDisplay:function(){if(!this._date){this._gmailTextareaViewController.setText("");return}this._gmailTextareaViewController.setText(this._date.prettyDate(true))}});i.set("BentoBox.Widgets.GmailTextCalendarViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;
var d=e.Class.subclass({className:"SmartTextCalendarViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_gmailTextCalendarViewController",destroy:true},{name:"_model",destroy:false},{name:"_property",destroy:false},{name:"_alwaysShowBorder",destroy:true},{name:"_unsubscribeFunction",destroy:false}],_initialize:function(t){this._model=t.model;this._property=t.property;this._alwaysShowBorder=t.alwaysShowBorder;e.UI.ViewController.prototype._initialize.call(this);this._subscribeToModelEventStream();this._updateBorderDisplay();if(this._model){this._gmailTextCalendarViewController.setDateString(this._model.get(this._property));this._gmailTextCalendarViewController.setEnabled(this._model.getIsEditable())}},_setupView:function(){this._gmailTextCalendarViewController=new c.Widgets.GmailTextCalendarViewController({shouldIncludeTime:false});this._view=this._gmailTextCalendarViewController.getView();this._view.addClass("smartInput");this._gmailTextCalendarViewController.getEventStream().onValue(this,"_gmailTextCalendarEvent")},_subscribeToModelEventStream:function(){var e=this;this._unsubscribeFunction=this._model.getEventStream().filter(function(t){return t.property===e._property&&t.eventName==="set"}).map(function(e){return e.newValue}).onValue(function(t){e._gmailTextCalendarViewController.setDateString(t)})},focus:function(){this._gmailTextCalendarViewController.focus()},getElement:function(){return this._view.getElement()},setEnabled:function(e){this._gmailTextCalendarViewController.setEnabled(e)},_gmailTextCalendarEvent:function(t){switch(t.eventName){case"dateSelected":var n=t.date;if(n){this._model.set(this._property,t.date.getTime())}else{this._model.set(this._property,"")}this._model.save();this._updateBorderDisplay();c.Tracker.track("dateFieldChanged");break;case"keydown":if(e.jwerty.is("tab",t.event)){this.getElement().trigger("tabPressed")}else if(e.jwerty.is("shift+tab",t.event)){this.getElement().trigger("shiftTabPressed")}break;case"mouseover":if(this._alwaysShowBorder){return}this._view.showBorder();break;case"mouseleave":this._updateBorderDisplay();break}},_updateBorderDisplay:function(){if(this._alwaysShowBorder){return}if(this._model.get(this._property)){this._view.hideBorder()}else{this._view.showBorder()}}});i.set("BentoBox.Widgets.SmartTextCalendarViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=c.Widgets.SmartTextCalendarViewController;var h=e.Class.subclass({className:"SpreadsheetSmartTextCalendarViewController",superclass:d,_memberVariables:[{name:"_parentElement",destroy:false}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._gmailTextCalendarViewController=new c.Widgets.GmailTextCalendarViewController({shouldIncludeTime:false,shouldAutoClose:false});this._view=this._gmailTextCalendarViewController.getView();this._view.addClass("smartInput");this._gmailTextCalendarViewController.getEventStream().onValue(this,"_gmailTextCalendarEvent")},set:function(e){this.focus();var t=this;setTimeout(function(){t._gmailTextCalendarViewController.setText(e);t._gmailTextCalendarViewController.setCursorToEnd()},20)},setup:function(e){this._model=e.model;this._property=e.property;this._gmailTextCalendarViewController.setDateString(this._model.get(this._property))},updateValue:function(){this._gmailTextCalendarViewController.hideCalendar()},_gmailTextCalendarEvent:function(t){switch(t.eventName){case"dateSelected":var n=t.date;if(n){this._model.set(this._property,t.date.getTime())}else{this._model.set(this._property,"")}this._model.save();this.getElement().trigger("escapePressed");c.Tracker.track("dateFieldChanged");break;case"keydown":if(e.jwerty.is("escape",t.event)){this._gmailTextCalendarViewController.setDateString(this._model.get(this._property));this.getElement().trigger("escapePressed")}else if(e.jwerty.is("enter",t.event)){this.getElement().trigger("enterPressed")}break}}});i.set("BentoBox.Widgets.SpreadsheetSmartTextCalendarViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.Library,s=e.NotificationCenter,l=e.DependencyManager,u=e.BentoBox;var c=e.Class.subclass({className:"DocSendFileOptionsView",superclass:e.UI.View,_memberVariables:[{name:"_allowAnonymousViewing",destroy:true},{name:"_allowDownloading",destroy:true},{name:"_expireCheckbox",destroy:true},{name:"_passcodeCheckbox",destroy:true},{name:"_expireTimeHour",destroy:true},{name:"_expireTimeDate",destroy:true},{name:"_passcode",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._setupWidgets();this.resetState()},_setupElement:function(){this._element=a.getElement("docsend_main_options_container")},resetState:function(){this._allowAnonymousViewing.setIsChecked(false);this._allowDownloading.setIsChecked(false);this._expireCheckbox.setIsChecked(false);this._passcodeCheckbox.setIsChecked(false);this._expireTimeHour.resetCurrentTime();this._expireTimeDate.setDate(r.create("one day from now"));this._expireTimeDate.setText("");this._passcode.setText("");this._expireTimeHour.disable();this._expireTimeDate.setEnabled(false);this._passcode.setEnabled(false)},afterOpening:function(){this._setupTabOrder();this.focus()},focus:function(){this._allowAnonymousViewing.focus()},setSubmitButton:function(e){this._submitButton=e;this._element.find(".docsend_submit").html(e.getElement())},setChangeDocumentButton:function(e){this._changeDocumentButton=e;this._element.find(".docsend_change_document").html(e.getElement())},setDocumentName:function(e){this._element.find(".docsend_document_name").text(e)},getOptions:function(){var e={allowAnonymousViewing:this._allowAnonymousViewing.isChecked(),allowDownloading:this._allowDownloading.isChecked(),expires:this._expireCheckbox.isChecked(),hasPasscode:this._passcodeCheckbox.isChecked(),passcode:this._passcode.getText()};if(e.expires){e.expireTime=this._constructExpireTime()}return e},_setupWidgets:function(){this._allowAnonymousViewing=new u.Widgets.GmailCheckboxView("Allow anonymous viewing");this._allowDownloading=new u.Widgets.GmailCheckboxView("Allow downloading");this._expireCheckbox=new u.Widgets.GmailCheckboxView("Expire:");this._passcodeCheckbox=new u.Widgets.GmailCheckboxView("Passcode:");this._expireTimeHour=new u.Widgets.TimePickerButtonMenuViewController;this._expireTimeDate=new u.Widgets.GmailTextCalendarViewController({shouldIncludeTime:false,shouldAutoClose:true});this._passcode=new u.Widgets.GmailTextareaViewController({multiline:false});this._element.find(".docsend_allow_anonymous_viewing").html(this._allowAnonymousViewing.getElement());this._element.find(".docsend_allow_downloading").html(this._allowDownloading.getElement());this._element.find(".docsend_expire_toggle").html(this._expireCheckbox.getElement());this._element.find(".docsend_passcode_toggle").html(this._passcodeCheckbox.getElement());this._element.find(".docsend_expire_hour").html(this._expireTimeHour.getView().getElement());this._element.find(".docsend_expire_date").html(this._expireTimeDate.getView().getElement());this._element.find(".docsend_passcode").html(this._passcode.getView().getElement());this._expireTimeDate.setPlaceholderText("Pick Date");this._setupContentEditability()},_setupContentEditability:function(){this._expireCheckbox.getEventStream().filter(function(e){return e.eventName==="valueChanged"}).map(function(e){return e.isChecked}).onValue(this,"_setExpireContentEditable");this._passcodeCheckbox.getEventStream().filter(function(e){return e.eventName==="valueChanged"}).map(function(e){return e.isChecked}).onValue(this,"_setPasscodeContentEditable")},_setExpireContentEditable:function(e){if(e){this._expireTimeHour.enable()}else{this._expireTimeHour.disable()}this._expireTimeDate.setEnabled(e);this._setupTabOrder()},_setPasscodeContentEditable:function(e){this._passcode.setEnabled(e);this._setupTabOrder()},_setupTabOrder:function(){var e=[this._submitButton.getElement(),this._changeDocumentButton.getElement(),this._allowAnonymousViewing.getElement(),this._allowDownloading.getElement(),this._expireCheckbox.getElement()];if(this._expireCheckbox.isChecked()){e.push(this._expireTimeHour.getView().getElement());e.push(this._expireTimeDate.getView().getElement())}e.push(this._passcodeCheckbox.getElement());if(this._passcodeCheckbox.isChecked()){e.push(this._passcode.getView().getElement())}t.tabChain(e)},_constructExpireTime:function(){var e=this._expireTimeDate.getDate()||new r;var t=this._expireTimeHour.getCurrentTime();e.setHours(t.getHours());e.setMinutes(t.getMinutes());return e}});o.set("BentoBox.Modules.DocSend.DocSendFileOptionsView",c)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"DocSendFileOptionsViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_documentInfo",destroy:true},{name:"_changeDocumentButton",destroy:true},{name:"_submitButton",destroy:true}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.DocSend.DocSendFileOptionsView");this._createSubmitButton()},setDocumentInfo:function(e){this._documentInfo=e;this._view.setDocumentName(e.name)},afterOpening:function(){this.getView().afterOpening()},createChangeDocumentButton:function(e){this._changeDocumentButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Text",color:"blue",text:c.Locale.getString("change_lower"),onFunction:e});this._view.setChangeDocumentButton(this._changeDocumentButton)},_createSubmitButton:function(){this._submitButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"green",text:c.Locale.getString("docSend_insert_link"),onFunction:this._submit.bind(this)});this._view.setSubmitButton(this._submitButton)},_submit:function(){var e=this._view.getOptions();e.documentInfo=this._documentInfo;this._eventStream.push({eventName:"submit",options:e})}});i.set("BentoBox.Modules.DocSend.DocSendFileOptionsViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Gmail,r=e.Date,a=e.HTML,o=e.Library,s=e.NotificationCenter,l=e.DependencyManager,u=e.BentoBox;var c=e.Class.subclass({className:"DocSendMenuView",superclass:e.UI.View,_memberVariables:[{name:"_loadingPanel",destroy:true},{name:"_docListPanel",destroy:true},{name:"_docOptionsPanel",destroy:true},{name:"_loginPanel",destroy:true},{name:"_errorPanel",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=a.getElement("docsend_main_menu_container");this._setupStates()},setListView:function(e){this._docListPanel.find(".docsend_doc_list_container").html(e.getElement())},setOptionsView:function(e){this._docOptionsPanel.find(".docsend_doc_options_container").html(e.getElement())},setLoginButton:function(e){this._element.find(".docsend_login_button").html(e.getElement())},showLoadingPanel:function(){this._hideAllPanels();this._loadingPanel.show().css("display","-webkit-flex")},showNoDocsPanel:function(){this._hideAllPanels();this._docListPanel.show();this._noDocsPanel.show()},addGoToDocSendButton:function(e){this._noDocsPanel.find(".docsend__goToDocSendHolder").append(e.getElement())},showDocListPanel:function(){this._hideAllPanels();this._docListPanel.show()},showDocOptionsPanel:function(){this._hideAllPanels();this._docOptionsPanel.show()},showLoginPanel:function(){this._hideAllPanels();this._loginPanel.show()},show3rdPartyCookiesWarning:function(){this._loginPanel.find(".docsend_3rd_party_cookies").show()},showErrorPanel:function(){this._hideAllPanels();this._errorPanel.show()},_setupStates:function(){this._loadingPanel=this._element.find(".docsend_loading_panel");this._noDocsPanel=this._element.find(".docsend_noDocs_panel");this._docListPanel=this._element.find(".docsend_doc_list_panel");this._docOptionsPanel=this._element.find(".docsend_doc_options_panel");this._loginPanel=this._element.find(".docsend_login_panel");this._errorPanel=this._element.find(".docsend_error_panel")},_hideAllPanels:function(){this._loadingPanel.hide();this._noDocsPanel.hide();this._docListPanel.hide();this._docOptionsPanel.hide();this._loginPanel.hide();this._errorPanel.hide()}});o.set("BentoBox.Modules.DocSend.DocSendMenuView",c)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"DocSendDataAccess",superclass:e.Object,_memberVariables:[],getDocList:function(){var t=new e.RelayRequest({method:"GET",url:"https://docsend.com/api/gmail/documents",xhrFields:{withCredentials:true}});return t.getPromise().then(function(e){return JSON.parse(e)})},createLink:function(t){var n=new e.RelayRequest({method:"POST",url:"https://docsend.com/api/gmail/links",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:t}),xhrFields:{withCredentials:true}});return n.getPromise().then(function(e){return JSON.parse(e)})},updateLink:function(t,n){var i=new e.RelayRequest({method:"PUT",url:"https://docsend.com/api/gmail/links/"+t,headers:{"Content-Type":"application/json"},body:JSON.stringify({link:n}),xhrFields:{withCredentials:true}});return i.getPromise()}});i.set("BentoBox.Modules.DocSend.DocSendDataAccess",new d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.Bacon,s=e.HTML,l=e.UI,u=e.NotificationCenter,c=e.DependencyManager,d=e.BentoBox;var h=e.Class.subclass({className:"DocSendMenuViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_searchableListViewController",destroy:true},{name:"_folders",destroy:true},{name:"_loginAttempted",destroy:false,defaultValue:false},{name:"_goToDocSendButton",destroy:true},{name:"_docOptionsViewController",destroy:true,get:true}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._folders=[];this._setupGoToDocSendButton();this._setupSearchableListViewController();this._setupDocOptionsViewController();this._setupLoginButton()},getElement:function(){return this._view.getElement()},resetState:function(){this._view.showLoadingPanel();this._refreshDocs();this._docOptionsViewController.getView().resetState()},_setupView:function(){this._view=i.getInstance("BentoBox.Modules.DocSend.DocSendMenuView")},_setupGoToDocSendButton:function(){this._goToDocSendButton=d.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"green",text:"Go to DocSend",onFunction:function(){window.open("https://docsend.com")}});this._view.addGoToDocSendButton(this._goToDocSendButton)},_setupSearchableListViewController:function(){this._searchableListViewController=i.getInstance("BentoBox.Widgets.SearchableListViewController");this._searchableListViewController.setShouldLockSelection(false);this._searchableListViewController.getEventStream().filter(function(e){return e.eventName==="rowSelected"}).map(function(e){return e.rowData}).onValue(this,"_documentSelected");this._searchableListViewController.setDataSource(this);this._view.setListView(this._searchableListViewController.getView())},_setupDocOptionsViewController:function(){this._docOptionsViewController=i.getInstance("BentoBox.Modules.DocSend.DocSendFileOptionsViewController");this._docOptionsViewController.createChangeDocumentButton(this._showSearchableDocumentList.bind(this));this._view.setOptionsView(this._docOptionsViewController.getView())},_setupLoginButton:function(){var e=d.Widgets.Buttons.ButtonFactory.createButton({type:"Gmail",color:"blue",text:"Sign In Now",onFunction:this._showLoginWindow.bind(this)});this._view.setLoginButton(e)},_showLoginWindow:function(){var e=this;var t=810;var n=768;var i=window.screenX+(window.outerWidth/2-n/2);var r=window.screenY+(window.outerHeight/2-t/2);o.fromEventTarget(window,"message").filter(function(e){return e.origin==="https://docsend.com"&&e.data&&e.data.windowClose}).take(1).onValue(function(){e._loginAttempted=true;e._refreshDocs()});window.open("https://docsend.com/api/gmail/login","DocSend Login","height="+t+",width="+n+",left="+i+",top="+r+",toolbar=0,resizable=0,menubar=0,location=0,status=0,scrollbars=0")},_refreshDocs:function(){var e=this;d.Modules.DocSend.DocSendDataAccess.getDocList().then(function(t){e._setupListViewWithDocumentFolders(t.folders)}).catch(this.handleDocSendRequestError.bind(this))},handleDocSendRequestError:function(e){d.logError("DocSend error",e);if(e&&e.xhr&&e.xhr.status===401){this._view.showLoginPanel();if(this._loginAttempted){this._view.show3rdPartyCookiesWarning()}}else{this._view.showErrorPanel()}},_setupListViewWithDocumentFolders:function(e){this._folders=e;if(this._noDocumentsExist()){this._view.showNoDocsPanel();return}this._searchableListViewController.dataUpdated();this._showSearchableDocumentList()},_noDocumentsExist:function(){return n.all(this._folders,function(e){return n.isEmpty(e.documents)})},_showSearchableDocumentList:function(){this._searchableListViewController.clearQuery();this._view.showDocListPanel();this._searchableListViewController.focus()},getNumberOfSections:function(){return this._folders.length},getSectionTitle:function(e){return this._folders[e].name},getSectionAfterTitleIconClass:function(e){var t=this._folders[e];return t.teamIcon?"streak__docsend_team":null},getNumberOfRows:function(e){return this._folders[e].documents.length},getRowData:function(e,t){var i=this._folders[e].documents[t];var r={doc:i};if(i.teamIcon){r.html="<span>"+n.escape(i.name)+"</span>"+'<span class="streak__bbIcon streak__docsend_team"></span>'}else{r.text=i.name}return r},getRowSearchString:function(e,t){return this._folders[e].documents[t].name},dontHighlightOnDataChange:function(){return true},_documentSelected:function(e){d.Tracker.track("docsend document selected");this._docOptionsViewController.setDocumentInfo(e.doc);this._view.showDocOptionsPanel();this._docOptionsViewController.afterOpening()}});i.set("BentoBox.Modules.DocSend.DocSendMenuViewController",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"DocSendOnComposeViewController",superclass:c.Modules.ComposeViewControllerBase,_memberVariables:[{name:"_menu",destroy:true}],_initialize:function(){c.Modules.ComposeViewControllerBase.prototype._initialize.apply(this,n.toArray(arguments))},initialize:function(e){this._composeWindowViewController=e;this._setupMenuButton();return this},_setupMenuButton:function(){this._setupMenuViewController();var e=this;this._composeWindowViewController.getComposeView().addButton({iconClass:"docSendIcon",tooltip:c.Locale.getString("docSend_tooltip"),type:"MODIFIER",orderHint:10,hasDropdown:true,onClick:function(t){if(e._anyLinksInUserSelection()){t.dropdown.close();return}e._menu.resetState();t.dropdown.el.appendChild(e._menu.getElement()[0]);c.Tracker.track("docsend compose opened")}})},_anyLinksInUserSelection:function(){return n.any(this._getAllComposeWindowLinks(),function(e){return window.getSelection().containsNode(e,true)})},_setupMenuViewController:function(){this._menu=new c.Modules.DocSend.DocSendMenuViewController;this._menu.getDocOptionsViewController().getEventStream().filter(function(e){return e.eventName==="submit"}).map(function(e){return e.options}).onValue(this,"_createDocumentLink")},_createDocumentLink:function(e){var t={recipients:this._composeWindowViewController.getToEmailAddresses(),document_id:e.documentInfo.id,allow_anonymous:e.allowAnonymousViewing,downloadable:e.allowDownloading};if(e.expires){t.expire_at=e.expireTime.getTime()/1e3;if(e.expireTime.getTime()<a.now()){c.ButterBarManager.showMessage("Please enter a valid expiration date.",{messageKey:"DocSendInvalidExpire"});return}else{c.ButterBarManager.hideMessage("DocSendInvalidExpire")}}if(e.hasPasscode){t.passcode=e.passcode;if(t.passcode.length===0){c.ButterBarManager.showMessage("Please enter a valid passcode.",{messageKey:"DocSendInvalidPasscode"});return}else{c.ButterBarManager.hideMessage("DocSendInvalidPasscode")}}var n=this;c.Modules.DocSend.DocSendDataAccess.createLink(t).then(function(t){c.Tracker.track("docsend link inserted",{documentOptions:e});var i=t.link.fullUrl+"?id="+t.link.id;n._composeWindowViewController.getComposeView().insertLinkIntoBodyAtCursor(e.documentInfo.name,i)}).catch(this._menu.handleDocSendRequestError.bind(this._menu));this._menu.getView().showLoadingPanel()},aboutToSend:function(){var e=this._composeWindowViewController.getToEmailAddresses();var t=this._gatherLinkIds();n.each(t,function(t){c.Modules.DocSend.DocSendDataAccess.updateLink(t,{recipients:e})})},_gatherLinkIds:function(){return n.chain(this._getAllComposeWindowLinks()).filter(this._isaDocSendLink).map(this._removeAndReturnIdFromLink).value()},_getAllComposeWindowLinks:function(){return this._composeWindowViewController.getEditor().find("a")},_isaDocSendLink:function(e){return e.href.slice(8,25)==="docsend.com/view/"},_removeAndReturnIdFromLink:function(e){var n=e.href.match(/(.+)\?id=(\d+)/);t(e).attr("href",n[1]);return parseInt(n[2])},destroy:function(){e.NotificationCenter.unsubscribe({observer:this});c.Modules.ComposeViewControllerBase.prototype.destroy.call(this)}});i.set("BentoBox.Modules.DocSend.DocSendOnComposeViewController",d);u.addFunction({functionKey:"docSendOnComposeViewControllerInitialized",functionReference:function(e){var t={getViewControllers:function(){return[new d]}};r.GmailComposeManager.registerModifierModule(t);r.GmailReplyManager.registerModifierModule(t);c.Tracker.track("docsend loaded")},dependentFunctionKeys:["gmailComposeWindowMasterControllerInitialized","gmailLoaded","localeLoaded","htmlLoaded","docsendEnabled"]});u.addFunction({functionKey:"docSendFirstRunInitialized",functionReference:function(e){if(!c.LocalSettings.get("docSendFirstRunSeen")){c.Modules.Help.HelpLoader.getHelpViewController().startChapter("DocSend First Run");c.LocalSettings.set("docSendFirstRunSeen",true)}},dependentFunctionKeys:["docSendOnComposeViewControllerInitialized","helpLoaderInitialized","localSettingsInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TimePickerButtonMenuViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_currentTime",destroy:true,get:true,set:true},{name:"_minuteGranularity",destroy:true},{name:"_buttonMenu",destroy:true},{name:"_menu",destroy:true}],_initialize:function(t,i){if(n.isReal(i)){this._currentTime=i}else{this._currentTime=a.create()}this._currentTime.setMinutes(0);this._currentTime.setSeconds(0);this._minuteGranularity=t||60;e.UI.ViewController.prototype._initialize.call(this)},resetCurrentTime:function(){this._currentTime=a.create();this._currentTime.setMinutes(0);this._currentTime.setSeconds(0);this._updateCurrentTime()},setCurrentTime:function(e){this._setCurrentTime(e)},disable:function(){this._buttonMenu.disable()},enable:function(){this._buttonMenu.enable()},_setupView:function(){this._setupMenu();this._setupButtonMenu();this._view=this._buttonMenu},_setupMenu:function(){this._menu=c.Widgets.Menu.create();var e=24*60/this._minuteGranularity;for(var t=0;t<e;t++){var n=a.create("12AM");var i=this._minuteGranularity*t;n.addMinutes(i);this._addTimeEntry(n)}},_addTimeEntry:function(e){var t=this;this._menu.addItem(e.customFormat("shortTime"),function(n){n.stopPropagation();t._setCurrentTime(e);t._eventStream.push({eventName:"timeChanged",value:e})})},_setupButtonMenu:function(){this._buttonMenu=c.Widgets.Buttons.ButtonFactory.createMenuButton({type:"GmailArrow",color:"default",text:this._currentTime.customFormat("shortTime"),menu:this._menu,isFixedPosition:true,isRightAligned:true,menuClickTriggersOff:true});this._buttonMenu.setTabIndex(-1)},_setCurrentTime:function(e){this._currentTime=e;this._updateCurrentTime()},_updateCurrentTime:function(){this._buttonMenu.setText(this._currentTime.customFormat("shortTime"))}});i.set("BentoBox.Widgets.TimePickerButtonMenuViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={menuClickTriggersOff:false,itemList:[]};var h=function(t){var i=n.extend({},d,t);i.menu=c.Widgets.Menu.create();c.Widgets.Buttons.FixedPositionMenuButton.call(this,i);this._eventStream=new e.Bacon.Bus;this._itemListMap={};this._currentlySelectedValue=null;this._defaultText=i.defaultText;this.setItemList(i.itemList);this._updateButtonText()};h.prototype=Object.create(c.Widgets.Buttons.FixedPositionMenuButton.prototype);n.extend(h.prototype,{setItemList:function(e){this.options.menu.empty();this._itemListMap={};this._itemList=e||[];n.each(this._itemList,this._addListItem,this)},setCurrentlySelectedValue:function(e){this._currentlySelectedValue=e;this.updateItemListSelectedState();this._updateButtonText()},getCurrentlySelectedValue:function(){return this._currentlySelectedValue},getEventStream:function(){return this._eventStream},getMenu:function(){return this.options.menu},whenSelectedValueChanged:function(e){return this._eventStream.filter(function(e){return e.eventName==="selectedValueChanged"}).map(function(e){return e.currentlySelectedValue}).onValue(e)},_addListItem:function(e){if(!e){return}if(e==="__separator"){this.options.menu.addSeparator();return}var t;if(e.displayHTML){t=displayHTML}else if(e.displayText){t=n.escape(e.displayText)}if(!t){return}var i=this;var r=this.options.menu.addCheckItem(t,function(t){i._updateSelectedValue(t,e.value)});this._itemListMap[e.value]=r},_updateSelectedValue:function(e,t){if(e){this._currentlySelectedValue=t}else if(this._currentlySelectedValue===t){this._currentlySelectedValue=null}this.updateItemListSelectedState();this._eventStream.push({eventName:"selectedValueChanged",currentlySelectedValue:n.clone(this._currentlySelectedValue)});this._updateButtonText();this.off()},_updateItemSelectedState:function(e){var t=this._itemListMap[e];if(t){t.setCheckboxState(this._currentlySelectedValue===e)}},updateItemListSelectedState:function(){var e=n.keys(this._itemListMap);n.each(e,this._updateItemSelectedState,this)},_updateButtonText:function(){var e=n.escape(this._defaultText);if(this._currentlySelectedValue){var t=this;var i=n.find(this._itemList,function(e){return e.value===t._currentlySelectedValue});if(i){if(i.displayText){e=n.escape(i.displayText)}else if(i.displayHTML){e=i.displayHTML}}}this.setHTML(e)}});i.set("BentoBox.Widgets.Buttons.ChecklistMenuButton",h)})(Streak);(function(e){"use strict";var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d={menuClickTriggersOff:false,itemList:[]};var h=function(t){var i=n.extend({},d,t);i.menu=c.Widgets.Menu.create();i.menu.getElement().addClass("streak__multiSelectMenu");c.Widgets.Buttons.FixedPositionMenuButton.call(this,i);this._eventStream=new e.Bacon.Bus;this._itemListMap={};this._currentlySelectedValues=[];this._defaultText=i.defaultText;this.setItemList(i.itemList);this._updateButtonText()};h.prototype=Object.create(c.Widgets.Buttons.FixedPositionMenuButton.prototype);n.extend(h.prototype,{setItemList:function(e){this.options.menu.empty();this._itemListMap={};this._itemList=e||[];for(var t=0;t<this._itemList.length;t++){this._addListItem(this._itemList[t])}},setCurrentlySelectedValues:function(e){this._currentlySelectedValues=e||[];var t=n.keys(this._itemListMap);for(var i=0;i<t.length;i++){this._updateItemSelectedState(t[i])}this._updateButtonText()},getCurrentlySelectedValues:function(){return this._currentlySelectedValues},getEventStream:function(){return this._eventStream},_addListItem:function(e){if(!e){return}if(e==="__separator"){this.options.menu.addSeparator();return}var t;if(e.displayHTML){t=displayHTML}else if(e.displayText){t=n.escape(e.displayText)}if(!t){return}var i=this;var r=this.options.menu.addCheckItem(t,function(t){i._updateSelectedValue(t,e.value)});this._itemListMap[JSON.stringify(e.value)]=r},_updateSelectedValue:function(e,t){if(e){this._currentlySelectedValues.push(t)}else{this._currentlySelectedValues=n.withoutPlus(this._currentlySelectedValues,t,function(e,t){return JSON.stringify(e)===JSON.stringify(t)})}this._eventStream.push({eventName:"selectedValuesChanged",currentlySelectedValues:n.clone(this._currentlySelectedValues)});this._updateButtonText()},_updateItemSelectedState:function(e){var t=this._itemListMap[e];if(!t){return}var n=false;for(var i=0;i<this._currentlySelectedValues.length;i++){if(JSON.stringify(this._currentlySelectedValues[i])===e){n=true;break}}t.setCheckboxState(n)},_updateButtonText:function(){var e;if(this._currentlySelectedValues.length===0){e=n.escape(this._defaultText)}else if(this._currentlySelectedValues.length===1){var t;for(var i=0;i<this._itemList.length;i++){if(JSON.stringify(this._itemList[i].value)===JSON.stringify(this._currentlySelectedValues[0])){t=this._itemList[i];break}}if(t){if(t.displayText){e=n.escape(t.displayText)}else if(t.displayHTML){e=t.displayHTML}}}else{e=n.escape(c.Locale.getString("multiselect_chosen",{number:this._currentlySelectedValues.length}))}if(!e){e=n.escape(this._defaultText)}this.setHTML(e)},destroy:function(){this._eventStream.end();this._eventStream=null;if(this.options&&this.options.menu){this.options.menu.destroy()}this.options=null;c.Widgets.Buttons.FixedPositionMenuButton.prototype.destroy.call(this)}});i.set("BentoBox.Widgets.Buttons.MultiSelectMenuButton",h)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"FormulaHelpViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_unbindFunction",destroy:true},{name:"_initialHelpState",destroy:true}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this)},_setupView:function(){var e=this},forceOpen:function(){c.LocalSettings.set("formulaHelp/state","open");this.activate()},activate:function(){this._initialHelpState=null;var e=c.LocalSettings.get("formulaHelp/state");if(e==="closed"){return}this._initialHelpState=c.Modules.Help.HelpLoader.getHelpViewController().getState();var t=this;this._unbindFunction=c.Modules.Help.HelpLoader.getHelpViewController().getEventStream().onValue(function(e){if(e.eventName==="closeClicked"){t._closeClicked()}});l.subscribe({eventName:"tourHelpCloseClicked",functionToCall:this._closeClicked,observer:this});this._showFormulaHelp()},deactivate:function(){if(this._unbindFunction){this._unbindFunction()}if(this._initialHelpState){c.Modules.Help.HelpLoader.getHelpViewController().setState(this._initialHelpState)}c.Tour.TourChapterViewController.stopCurrentTour()},_closeClicked:function(){c.Tracker.track("formula help menu closed");c.LocalSettings.set("formulaHelp/state","closed")},_showFormulaHelp:function(){c.Modules.Help.HelpLoader.getHelpViewController().setState({searchText:"Formula Columns",scrollPosition:0,viewState:"VISIBLE"});c.Modules.Help.HelpLoader.getHelpViewController().startChapter("Formula Column Examples")},destroy:function(){l.unsubscribe({observer:this})}});i.set("BentoBox.Widgets.FormulaHelpViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"CustomPermissionSetCreatorModalView",superclass:e.UI.View,_memberVariables:[{name:"_modal",destroy:true,get:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=o.getElement("customPermissionsRoleModal");this._setupModal()},showModal:function(){this._modal.show()},getPermissionOptionsTable:function(){return this._element.find(".streak__permission_options tbody")
},addNameField:function(e){this._element.find(".streak__permission_set_name").html(e.getElement())},_setupModal:function(){this._modal=c.Widgets.Modal.create({title:c.Locale.getString("custom_permission_modal_title"),showCancel:true,confirmText:c.Locale.getString("custom_permission_modal_confirm"),inner:this._element,width:"470px"})}});i.set("BentoBox.Services.PipelineSharingSettings.CustomPermissionSetCreatorModalView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"CustomPermissionSetCreatorModalViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_permissionOptions",destroy:true},{name:"_nameField",destroy:true},{name:"_checkboxViews",destroy:true,defaultValue:[]}],_initialize:function(){e.UI.ViewController.prototype._initialize.call(this);this._setupPermissionOptions();this._setupTableWithPermissionOptions(this._permissionOptions);this._paywallCustomPermissionRoles()},_setupView:function(){this._view=i.getInstance("BentoBox.Services.PipelineSharingSettings.CustomPermissionSetCreatorModalView");this._setupNameWidget();this._view.showModal()},_setupNameWidget:function(){this._nameField=new c.Widgets.GmailTextareaViewController({multiline:false});this._nameField.setPlaceholderText(c.Locale.getString("permission_set_name"));this._view.addNameField(this._nameField.getView())},_setupPermissionOptions:function(){this._permissionOptions=["View Boxes","Update Boxes","Create Boxes","Delete Boxes","Update Threads","Create Threads","Delete Threads","Update Comments","Create Comments","Delete Comments","Update Files","Create Files","Delete Files","Update Reminders","Create Reminders","Delete Reminders","View Reports","Export Newsfeed","Update Box Field","Update Pipeline","Delete Pipeline","Update Stages","Create Stages","Delete Stages","Update Snippets","Create Snippets","Delete Snippets","Import Boxes","Update Column","Create Column","Delete Column","View Newsfeed"]},_setupTableWithPermissionOptions:function(e){var i=this._view.getPermissionOptionsTable();var r=this;var a=null;n.each(e,function(e,n){if(n%3==0){i.append(a);a=t("<tr>")}var o=new c.Widgets.GmailCheckboxView(e);r._checkboxViews.push(o);var s=t("<td>");s.html(o.getElement());a.append(s)});i.append(a)},_paywallCustomPermissionRoles:function(){var e=this;this._view.getModal().setConfirmFunc(function(){c.Tracker.track("show custom permission roles gateway",{checkedPermissions:e._getCheckedPermissions()});e._view.getModal().close();new c.Widgets.PaywallGatewayViewController({title:c.Locale.getString("custom_permission_roles_gateway_title"),text:c.Locale.getString("custom_permission_roles_gateway_text")}).show()})},_getCheckedPermissions:function(){return n.chain(this._checkboxViews).filter(function(e){return e.isChecked()}).map(function(e){return e.getText()}).value()}});i.set("BentoBox.Services.PipelineSharingSettings.CustomPermissionSetCreatorModalViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineSharingSettingsContactEntryView",superclass:e.UI.View,_memberVariables:[],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=o.getElement("aclRow")},setupRowInfo:function(e){this._element.find(".name").prepend(e.name);this._element.find(".email").html(e.email);this._element.find(".image").html(e.image)},addRoleMenuButton:function(e){this.setStatus(e.getElement())},setStatus:function(e){this._element.find(".status").html(e)},getRemoveButton:function(){return this._element.find(".remove")},addRemoveButton:function(e){this.getRemoveButton().html(e.getElement())}});i.set("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsContactEntryView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineSharingSettingsContactEntryViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_person",destroy:false},{name:"_advancedPermissionsList",destroy:true},{name:"_roleMenuButton",destroy:true},{name:"_closeButton",destroy:true},{name:"_hasAdminOption",destroy:false,set:true}],_initialize:function(t){this._person=t;e.UI.ViewController.prototype._initialize.call(this)},setupRemoveButton:function(e){this._closeButton=c.Widgets.Buttons.ButtonFactory.createButton({type:"X",onFunction:e});this._view.addRemoveButton(this._closeButton)},_setupView:function(){this._view=i.getInstance("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsContactEntryView");var e=this._person;this._view.setupRowInfo({name:e.fullName||e.email,email:e.fullName===e.email?"":e.email,image:this._constructImage(e.imageUrl)});this._view.setStatus(c.Locale.getString(e.permissionSetName))},_isAdmin:function(e){return e.permissionSetName==="__adminPermissionSet__"},setupRoleMenu:function(e){var t=this;this._advancedPermissionsList=n.map(this._getPermissionMenuOptions(e),function(e){return{displayText:c.Locale.getString(e),value:e}});this._roleMenuButton=c.Widgets.Buttons.ButtonFactory.createChecklistMenuButton({type:"TextArrow",itemList:this._advancedPermissionsList,defaultText:c.Locale.getString("default_permission_dropdown_text"),preOnFunction:function(){c.Tracker.track("open permission role menu");t._roleMenuButton.getMenu().reset();t._roleMenuButton.updateItemListSelectedState()}});this._roleMenuButton.setCurrentlySelectedValue(this._person.permissionSetName);this._roleMenuButton.whenSelectedValueChanged(function(e){if(e===t._person.permissionSetName){return}if(c.isFeatureEnabled("advancedPermissions")){c.Tracker.track("sharing role changed",{permissionSetName:e});t._person.permissionSetName=e;return}c.Tracker.track("sharing role attempted",{permissionSetName:e});t._roleMenuButton.setCurrentlySelectedValue(t._person.permissionSetName);c.Tracker.track("show advanced permission gateway");new c.Widgets.PaywallGatewayViewController({title:c.Locale.getString("advanced_permissions_gateway_title"),text:c.Locale.getString("advanced_permissions_gateway_text")}).show()});var i=this._roleMenuButton.getMenu();i.getElement().addClass("permissionsRoleMenu");i.addSeparator();i.addItem(c.Locale.getString("create_custom_permission"),this._setupCustomPermissionModal.bind(this));this._view.addRoleMenuButton(this._roleMenuButton)},_setupCustomPermissionModal:function(){c.Tracker.track("open custom permission roles model");this._roleMenuButton.off();i.getInstance("BentoBox.Services.PipelineSharingSettings.CustomPermissionSetCreatorModalViewController")},_getPermissionMenuOptions:function(e){var t=c.Services.PipelineAccessManagerController.getDefaultPermissionSets();return n(t).pick(this._displayableOption,this).keys().sort().value()},_displayableOption:function(e,t){return e.userAssignable||this._hasAdminOption&&t==="__adminPermissionSet__"},_constructImage:function(e){return e?'<img src="'+e+'" />':'<div class="noUserImageWrapper"><div class="noUserImage"></div></div>'}});i.set("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsContactEntryViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineSharingSettingsModalView",superclass:e.UI.View,_memberVariables:[{name:"_modal",destroy:true,get:true},{name:"_advancedOptionsButton",destroy:true}],_initialize:function(){e.UI.View.prototype._initialize.call(this);this._element=o.getElement("shareSettingsButtonModal");this._setupModal()},_setupModal:function(){this._modal=c.Widgets.Modal.create({title:c.Locale.getString("share_settings"),showCancel:true,confirmText:c.Locale.getString("save"),inner:this._element,width:"500px"})},addSharingRestrictionCheckbox:function(e){this._element.find(".restrictSharingToOrgCheck").html(e.getElement())},addOrgWideCheckbox:function(e){this._element.find(".shareOrgCheck").html(e.getElement())},addAdvancedOptionsButton:function(e){this._element.find(".sharingOptionsHeader").append(e.getElement());this._advancedOptionsButton=e},addPersonPickerView:function(e){this._element.find(".sharingEnter").append(e.getElement())},showModal:function(){this._modal.show()},showWarning:function(e){this._element.find(".streak__shareModal_warning").show().html(e)},hideWarning:function(){this._element.find(".streak__shareModal_warning").hide()},setPrivate:function(){this.getPrivateButton().addClass("active");this.getSharedButton().removeClass("active");this._element.find(".sharingOptionsWrapper").hide()},setShared:function(){this.getPrivateButton().removeClass("active");this.getSharedButton().addClass("active");this._element.find(".sharingOptionsWrapper").show()},getPrivateButton:function(){return this._element.find(".private")},getSharedButton:function(){return this._element.find(".shared")},setOrgName:function(e){this._element.find(".orgName").text(e)},toggleOrgOwnerUI:function(e){this._element.find(".shareOrg").toggle(e);this._advancedOptionsButton.getElement().toggle(e)},showSharingRestriction:function(){this._element.find(".advancedOptionsLoading").hide();this._element.find(".restrictOrgMessage").show();this._element.find(".restrictSharingToOrgCheck").show()},hideSharingRestriction:function(){this._element.find(".advancedOptionsLoading").show();this._element.find(".restrictOrgMessage").hide();this._element.find(".restrictSharingToOrgCheck").hide()},removeACLRows:function(){this._element.find(".acl").empty()},addACLRow:function(e){this._element.find(".acl").append(e.getView().getElement())},showAdvancedOptions:function(){this._element.find(".restrictOrg").show();this._advancedOptionsButton.setHTML(c.Locale.getString("hide_advanced_options"))},hideAdvancedOptions:function(){this._element.find(".restrictOrg").hide();this._advancedOptionsButton.setHTML(c.Locale.getString("show_advanced_options"))}});i.set("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsModalView",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"PipelineSharingSettingsModalViewController",superclass:e.UI.ViewController,_memberVariables:[{name:"_pipeline",destroy:false},{name:"_isPrivate",destroy:false},{name:"_modelPatch",destroy:true},{name:"_personPicker",destroy:true},{name:"_restrictSharingToOrgCheckbox",destroy:true},{name:"_shareWithOrgCheckbox",destroy:true}],show:function(){this._view.showModal()},_initialize:function(t){e.UI.ViewController.prototype._initialize.call(this);this._pipeline=t;if(!t){throw new Error("Tried to setup a pipeline sharing settings modal with no pipeline.")}this._modelPatch=this._pipeline.createPatch();this._modelPatch.set("aclEntries",n.clone(this._modelPatch.get("aclEntries")));this._isPrivate=this._initiallyIsPrivate();this._updateOrgRestictedSharingStatus();this._shareWithOrgCheckbox.setIsChecked(this._modelPatch.get("orgWide"));this._updatePersonPickerChoices();this._updateDisplay();this._view.getModal().setConfirmFunc(this._saveSharingSettings.bind(this))},_setupView:function(){this._view=i.getInstance("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsModalView");this._setupPrivateAndSharedButtons();this._setupPersonPicker();this._setupAdvancedOptionsButton();this._setupOrgSharingCheckboxes()},_setupPrivateAndSharedButtons:function(){var e=this;this._view.getPrivateButton().click(function(t){e._attemptToMakePipelinePrivate();t.preventDefault()});this._view.getSharedButton().click(function(t){e._isPrivate=false;e._updateDisplay();e._personPicker.focus();t.preventDefault()})},_attemptToMakePipelinePrivate:function(){if(this._userIsAdmin()){this._isPrivate=true;this._updateDisplay()}else{this._view.showWarning(c.Locale.getString("cant_make_pipeline_private"))}},_setupPersonPicker:function(){var e=this;this._personPicker=new c.Widgets.PersonPickerViewController({contactSelectedCallback:function(t){if(!t.email){e._view.showWarning(c.Locale.getString("invalid_email_address"));return}if(!e._isPersonValidInOrg(t)){e._view.showWarning(c.Locale.getString("restricted_person",{org:e._modelPatch.get("organization").organizationId}));return}if(!t.permissionSetName){t.permissionSetName="__editAllPermissionSet__"}e._acl().push(t);e._newACLRow(t).getView().getElement().scrollintoview({duration:0});e._updatePersonPickerChoices();e._updateDisplay();c.Tracker.track("sharing contact added")}});this._view.addPersonPickerView(this._personPicker.getView())},_isPersonValidInOrg:function(e){return!this._modelPatch.get("sharingRestrictedToOrg")||this._pipelineDomain()===e.email.split("@")[1].toLowerCase()||c.Data.getBillingPlanInstances().filter(function(e){return e.isActive()}).length>0},_updatePersonPickerChoices:function(){this._personPicker.setExcluded(this._acl())},_setupAdvancedOptionsButton:function(){var e=c.Widgets.Buttons.ButtonFactory.createToggleButton({type:"Text",text:c.Locale.getString("show_advanced_options"),onFunction:this._view.showAdvancedOptions.bind(this._view),offFunction:this._view.hideAdvancedOptions.bind(this._view)});this._view.addAdvancedOptionsButton(e)},_setupOrgSharingCheckboxes:function(){this._restrictSharingToOrgCheckbox=new c.Widgets.GmailCheckboxView;this._shareWithOrgCheckbox=new c.Widgets.GmailCheckboxView;this._restrictSharingToOrgCheckbox.getCheckStream().onValue(this,"_setSharingRestriction");this._shareWithOrgCheckbox.getCheckStream().onValue(this,"_setOrgWide");this._view.addSharingRestrictionCheckbox(this._restrictSharingToOrgCheckbox);this._view.addOrgWideCheckbox(this._shareWithOrgCheckbox)},_setSharingRestriction:function(e){this._modelPatch.set("sharingRestrictedToOrg",e)},_setOrgWide:function(e){this._modelPatch.set("orgWide",e)},_initiallyIsPrivate:function(){return!this._modelPatch.get("orgWide")&&this._acl().length===1},_updateOrgRestictedSharingStatus:function(){this._view.hideSharingRestriction();var e=this;this._pipeline.didBillingAdminRestrictSharingToOrg().then(function(t){e._view.showSharingRestriction();if(t){e._restrictSharingToOrgCheckbox.disable()}e._restrictSharingToOrgCheckbox.setIsChecked(t||e._modelPatch.get("sharingRestrictedToOrg"))})},_updateDisplay:function(){this._handleOrgOwnership();this._view.hideWarning();if(this._isPrivate){this._view.setPrivate()}else{this._view.setShared()}this._view.removeACLRows();var e=n.filter(this._acl(),this._isAdmin);var t=n.reject(this._acl(),this._isAdmin);n.each(e.concat(t),this._newACLRow,this)},_handleOrgOwnership:function(){var e=this._pipelineDomain();var t=this._isOrgOwner(e);if(t){this._view.setOrgName(e.capitalize())}this._view.toggleOrgOwnerUI(t)},_isOrgOwner:function(e){return!n.contains(c.Constants.EMAIL_BLACK_LIST,e)&&this._userIsAdmin()},_newACLRow:function(e){var t=this;var n=new c.Services.PipelineSharingSettings.PipelineSharingSettingsContactEntryViewController(e);if(this._canEditPerson(e)){n.setupRemoveButton(function(){if(t._admins().length===1&&t._isAdmin(e)){t._warnAboutNoAdmins();return}n.destroy();t._acl().removeVal(e);t._updatePersonPickerChoices();c.Tracker.track("sharing contact removed")});n.setHasAdminOption(this._userIsAdmin());n.setupRoleMenu(this._modelPatch)}this._view.addACLRow(n);return n},_canEditPerson:function(e){return this._userIsAdmin()||!this._isAdmin(e)},_saveSharingSettings:function(e){var t=this;var n=!this._userIsntRemovingOwnAccess();if(this._noAdminsInAcl()){var i=this._userAclEntry();i.permissionSetName="__adminPermissionSet__";this._updateDisplay();this._warnAboutNoAdmins();return}if(!e&&n){this._informUserRemovingOwnAccess();return true}if(this._isPrivate){this._modelPatch.set("orgWide",false);var r=[this._userAclEntry()];this._modelPatch.set("aclEntries",r);c.Tracker.track("made private")}this._modelPatch.commit();this._pipeline.save();if(n){c.Tracker.track("removing own access");this._pipeline.remove()}this.destroy();c.Tracker.track("save sharing settings")},_pipelineDomain:function(){var e=this._modelPatch.get("organization").organizationId.toLowerCase();if(n.contains(e,"@")){return e.split("@")[1]}else{return e}},_warnAboutNoAdmins:function(){this._view.showWarning(c.Locale.getString("no_admins_in_pipeline_warning"))},_noAdminsInAcl:function(){return n.isEmpty(this._admins())},_admins:function(){return n.filter(this._acl(),this._isAdmin)},_userIsAdmin:function(){return this._isAdmin(this._userAclEntry())},_userAclEntry:function(){return n.find(this._acl(),this._isUser)},_isAdmin:function(e){return e&&e.permissionSetName==="__adminPermissionSet__"},_userIsntRemovingOwnAccess:function(){return n.any(this._acl(),this._isUser)},_isUser:function(e){return e&&e.email&&e.email.toLowerCase()===c.getUser().getEmail().toLowerCase()},_informUserRemovingOwnAccess:function(){this._view.showWarning(c.Locale.getString("removing_own_access_warning"));this._view.getModal().getOkButton().getElement().text(c.Locale.getString("confirm"));this._view.getModal().setConfirmFunc(this._saveSharingSettings.bind(this,true))},_acl:function(){return this._modelPatch.get("aclEntries")}});i.set("BentoBox.Services.PipelineSharingSettings.PipelineSharingSettingsModalViewController",d)})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"AccessManager",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this)},getPipelinePermissionsMap:function(e){var t={};var i=c.Data.getAllPipelines();n.each(i,function(n){t[n.key()]=this.arePermissionsAllowed(n,e)},this);return t},isAccessAllowed:function(e,t,i){var r=c.getUser().get("key");var a;var o=n.find(e.get("aclEntries"),function(e){return e.userKey===r});if(o){a=o.permissionSetName}if(!a){a="__defaultOrgPermissionSet__"}var s=c.Services.PipelineAccessManagerController.getDefaultPermissionSets();var l=s[a];if(!l){l=s["__defaultOrgPermissionSet__"]}return n.any(l.permissions,function(e){return e.entityType===t&&e.action===i})},arePermissionsAllowed:function(e,t){var i=this;return n.all(t,function(t){if(t.actions){return n.all(t.actions,function(n){return i.isAccessAllowed(e,t.entityType,n)})}else{return i.isAccessAllowed(e,t.entityType,t.action)}})}});e.DependencyManager.addFunction({functionKey:"accessManagerInitialized",functionReference:function(){i.set("BentoBox.Services.AccessManager",new d)},dependentFunctionKeys:["pipelineAccessManagerControllerInitialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox,d=e.APIRequester;var h=e.Class.subclass({className:"PipelineAccessManagerController",superclass:e.Object,_memberVariables:[{name:"_defaultPermissionSets",destroy:true,get:true}],_initialize:function(){e.Object.prototype._initialize.call(this);this._setupWatcher()},_setupWatcher:function(){c.Data.getAllPipelines().watch("change",this._handlePipelineChange,this)},_handlePipelineChange:function(e){if(!e.model||e.property!=="aclEntries"){return}var t=c.Data.getPipelineBoxes(e.model.key());t.refresh()},setupDefaultPermissionSets:function(){var e=this;return d.get("pipelines/permissions/default").getPromise().then(function(t){e._defaultPermissionSets=t})}});e.DependencyManager.addFunction({functionKey:"pipelineAccessManagerControllerInitialized",functionReference:function(){var e=new h;i.set("BentoBox.Services.PipelineAccessManagerController",e);return e.setupDefaultPermissionSets()},dependentFunctionKeys:["data.pipelines.initialized"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"TimezoneUpdater",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);this._setUsersTimezone()},_setUsersTimezone:function(){e.APIRequester.post("users/me/timezone",{offsetMinutes:(new a).getTimezoneOffset()})}});e.DependencyManager.addFunction({functionKey:"TiemzoneUpdaterInitialized",functionReference:function(){i.set("BentoBox.Services.TimezoneUpdater",new d)},dependentFunctionKeys:["userLoggedIn"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=e.Class.subclass({className:"GmailEventTracker",superclass:e.Object,_memberVariables:[],_initialize:function(){e.Object.prototype._initialize.call(this);r.observe("conversationThreadLoadedEvent",this._wrappedConversationLoaded.bind(this));this._setupAttachmentModalMonitoring()},_wrappedConversationLoaded:function(){var e=this;try{this._conversationLoaded()}catch(t){setTimeout(function(){if(r.isConversationVisible()){e._wrappedConversationLoaded()}},300)}},_conversationLoaded:function(){var e={};var t=r.getCurrentOpenEmailMessages();e.numberOfOpenEmails=t.length;e.numberOfEmailsWithAttachments=0;e.maxAttachmentsPerEmail=0;e.totalNumberOfAttachments=0;e.numberOfDriveAttachments=0;e.numberOfLinks=0;e.numberOfDropboxLinks=0;e.numberOfDriveLinks=0;e.numberOfInlineImages=0;var n={};var i=[];var a=[];var o=[];for(var s=0;s<t.length;s++){var l=t[s];if(this._hasAttachments(l)){var u=this._processAttachments(l);i.push(u);this._bindToAllDownloads(l,u)}else{i.push(null)}a.push(this._getMessageLinkStats(l));o.push(this._getMessageImageStats(l))}for(var s=0;s<i.length;s++){var u=i[s];if(!u){continue}e.numberOfEmailsWithAttachments++;e.totalNumberOfAttachments+=u.numberOfAttachments;e.numberOfDriveAttachments+=u.numberOfDriveAttachments;e.maxAttachmentsPerEmail=Math.max(e.maxAttachmentsPerEmail,u.numberOfAttachments);for(var d in u.mimeTypeStats){n[d]=(n[d]||0)+u.mimeTypeStats[d]}}for(var s=0;s<a.length;s++){var h=a[s];if(!h){continue}e.numberOfLinks+=h.numberOfLinks;e.numberOfDropboxLinks+=h.numberOfDropboxLinks;e.numberOfDriveLinks+=h.numberOfDriveLinks}for(var s=0;s<o.length;s++){var f=o[s];if(!f){continue}e.numberOfInlineImages+=f.numberOfInlineImages}c.Tracker.trackGmail("conversationLoaded",e,n)},_hasAttachments:function(e){return e.find(".aQH > span").length>0},_processAttachments:function(e){var n=[];var i=e.find(".aQH > span");for(var r=0;r<i.length;r++){n.push(this._processAttachment(t(i[r])))}var a={numberOfAttachments:i.length,numberOfDriveAttachments:0,mimeTypeStats:{}};for(var r=0;r<n.length;r++){var o=n[r];if(!o){continue}if(o.isDrive){a.numberOfDriveAttachments++}a.mimeTypeStats[o.mimeType]=(a.mimeTypeStats[o.mimeType]||0)+1;this._bindToAttachmentDownloads(t(i[r]),o)}return a},_processAttachment:function(e){var t={};var n=e[0].getAttribute("download_url");var i=n.split(":");if(i.length!==4){return null}t.mimeType=i[0];var r=i[3];t.isDrive=r.indexOf("googleusercontent")>-1;return t},_bindToAttachmentDownloads:function(e,t){e.find("a").click(function(e){c.Tracker.trackGmail("preview attachment",t)});e.find(".aSK").click(function(e){c.Tracker.trackGmail("download attachment",t)});e.find(".aQu").click(function(e){c.Tracker.trackGmail("save attachment to drive",t)})},_bindToAllDownloads:function(e,t){var n=e.find(".aZi");if(n.length===0){return}n.find(".aZh").parent().parent().click(function(e){c.Tracker.trackGmail("download all",t)});n.find(".aZg").parent().parent().click(function(e){c.Tracker.trackGmail("save all to drive",t)});n.find(".aZk").parent().parent().click(function(e){c.Tracker.trackGmail("share all on g+",t)})},_getMessageLinkStats:function(e){var n=e.find(".a3s:first > [dir] a");if(n.length===0){return null}var i={numberOfLinks:0,numberOfDropboxLinks:0,numberOfDriveLinks:0};for(var r=0;r<n.length;r++){var a=n[r];if(t(a).parents().filter(".adL").length>0){continue}var o=a.href;if(!o){continue}i.numberOfLinks++;if(o.indexOf("dropbox.com")>-1){i.numberOfDropboxLinks++}if(o.indexOf("drive.google.")>-1||o.indexOf("docs.google.")>-1){i.numberOfDriveLinks++}}return i},_getMessageImageStats:function(e){var t=e.find(".a3s:first > [dir] img");if(t.length===0){return null}return{numberOfInlineImages:t.length}},_setupAttachmentModalMonitoring:function(){e.NotificationCenter.subscribe({eventName:"newAttachmentAdded",observer:this,functionToCall:function(){c.Tracker.trackGmail("attachment added")}});var t=new MutationObserver(function(e){var t=n.chain(e).pluck("addedNodes").map(n.toArray).flatten().filter(function(e){return e.getAttribute("role")==="alertdialog"}).first().value();if(!t){return}var i=t.querySelector("[role=heading]");if(i){if(i.textContent.indexOf("exceeds the 25MB")>-1){c.Tracker.trackGmail("large attachment suggest drive");return}}var r=t.querySelector(".Kj-JD-Jz");if(r){if(r.textContent.indexOf("exceeds the maximum")>-1){c.Tracker.trackGmail("large attachment from drag and drop");return}}});t.observe(r.elements.body[0],{childList:true})}});e.DependencyManager.addFunction({functionKey:"gmailEventTrackerInitialized",functionReference:function(){if(!c.isFeatureEnabled("gmailTracking")){return}i.set("BentoBox.Services.GmailEventTracker",new d)},dependentFunctionKeys:["enabledFeaturesControllerInitialized","gmail.bindWatchers"]})})(Streak);(function(e){var t=e.jQuery,n=e._,i=e.Library,r=e.Gmail,a=e.Date,o=e.HTML,s=e.UI,l=e.NotificationCenter,u=e.DependencyManager,c=e.BentoBox;var d=function(){c.Modules.ComposeViewControllerBase.call(this);this._stats={clickOnInsertFile:0,clickOnInsertDriveFile:0,clickOnInsertPhoto:0,clickOnInsertLink:0,numberOfAttachments:0,numberOfDriveFiles:0,numberOfLinks:0,numberOfDriveLinks:0,numberOfDropboxLinks:0,numberOfImages:0,isReply:false}};d.prototype=Object.create(c.Modules.ComposeViewControllerBase.prototype);n.extend(d.prototype,{initialize:function(e){this._composeWindowViewController=e;this._bindToAttachmentButtons()},aboutToSend:function(){var e=this._composeWindowViewController.getAttachmentDOMElements();this._processAttachments(e);this._processDriveFiles(this._composeWindowViewController.getEditor());this._processLinks(this._composeWindowViewController.getEditor());this._processImages(this._composeWindowViewController.getEditor());this._stats.isReply=this._composeWindowViewController.isReply&&this._composeWindowViewController.isReply();c.Tracker.trackGmail("sent email",this._stats)},_bindToAttachmentButtons:function(){var e=this;var t=this._composeWindowViewController.getInsertLinkButton();if(t&&t.length>0){t[0].addEventListener("mousedown",function(t){e._stats.clickOnInsertLink++},true)}var n=this._composeWindowViewController.getAttachFilesButton();if(n&&n.length>0){n[0].addEventListener("mousedown",function(t){e._stats.clickOnInsertFile++},true)}var i=this._composeWindowViewController.getInsertDriveFileButton();if(i&&i.length>0){i[0].addEventListener("mousedown",function(t){e._stats.clickOnInsertDriveFile++},true)}var r=this._composeWindowViewController.getInsetPhotoButton();if(r&&r.length>0){r[0].addEventListener("mousedown",function(t){e._stats.clickOnInsertPhoto++},true)}},_processAttachments:function(e){this._stats.numberOfAttachments=e.length},_processDriveFiles:function(e){this._stats.numberOfDriveLinks=0;var t=e.find(".gmail_drive_chip");if(t.length===0){return}this._stats.numberOfDriveFiles=t.length},_processLinks:function(e){this._stats.numberOfLinks=0;this._stats.numberOfDriveLinks=0;this._stats.numberOfDropboxLinks=0;var n=e.find("a");for(var i=0;i<n.length;i++){var r=t(n[i]);if(r.parents().filter(".gmail_drive_chip").length>0){continue}var a=r[0].href;if(!a){continue}this._stats.numberOfLinks++;if(a.indexOf("docs.google")>-1||a.indexOf("drive.google")>-1){this._stats.numberOfDriveLinks++}if(a.indexOf("dropbox.com")>-1){this._stats.numberOfDropboxLinks++}}},_processImages:function(e){this._stats.numberOfImages=0;var n=e.find("img");if(n.length===0){return}for(var i=0;i<n.length;i++){var r=n[i];if(t(r).parents().filter(".gmail_drive_chip").length>0){continue}this._stats.numberOfImages++}}});u.addFunction({functionKey:"gmailComposeEventTrackerInitialized",functionReference:function(){if(!c.isFeatureEnabled("gmailTracking")){return}r.GmailComposeManager.registerModifierModule({getViewControllers:function(){return new d}});r.GmailReplyManager.registerModifierModule({getViewControllers:function(){return new d}})},dependentFunctionKeys:["gmailReplyAreaMasterControllerInitialized","gmailComposeWindowMasterControllerInitialized","enabledFeaturesControllerInitialized"]})})(Streak);
